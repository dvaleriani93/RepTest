function ArrayList(c){Array.call(this);if(c){if(typeof(c)=="number"){}else{if(c instanceof ArrayList){var b=c.Count();for(var a=0;a<b;a++){this.Add(c[a])}}}}}ArrayList.prototype=new Array();ArrayList.prototype.toString=function(){return this.join(",")};ArrayList.prototype.Add=function(a){this.push(a)};ArrayList.prototype.Get=function(a){return this[a]};ArrayList.prototype.Count=function(){return this.length};ArrayList.prototype.Clear=function(){this.splice(0,this.length)};ArrayList.prototype.Remove=function(b){var c=this.length;for(var a=0;a<c;a++){if(b==this[a]){this.splice(a,1);break}}};ArrayList.prototype.RemoveAt=function(a){this.splice(a,1)};ArrayList.prototype.SortFunction=function(d,c){return d.CompareTo(c)};ArrayList.prototype.Sort=function(){if(this.Count()==0){return}if(this[0]&&this[0].CompareTo){this.sort(this.SortFunction)}else{this.sort()}};ArrayList.prototype.Insert=function(a,b){this.splice(a,0,b)};ArrayList.prototype.Clone=function(){var a=new ArrayList();a.AddRange(this);return a};ArrayList.prototype.AddRange=function(d){var b=d.Count();for(var a=0;a<b;a++){this.Add(d[a])}};ArrayList.prototype.Contains=function(b){var c=this.length;for(var a=0;a<c;a++){if(b==this[a]){return true}}return false};ArrayList.prototype.IndexOf=function(b){var c=this.length;for(var a=0;a<c;a++){if(b==this[a]){return a}}return -1};base64={};base64.PADCHAR="=";base64.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";base64.getbyte64=function(c,b){var a=base64.ALPHA.indexOf(c.charAt(b));if(a==-1){throw"Cannot decode base64"}return a};base64.decode=function(d){d=""+d;var g=base64.getbyte64;var f,c,e;var b=d.length;if(b==0){return d}if(b%4!=0){throw"Cannot decode base64"}f=0;if(d.charAt(b-1)==base64.PADCHAR){f=1;if(d.charAt(b-2)==base64.PADCHAR){f=2}b-=4}var a=[];for(c=0;c<b;c+=4){e=(g(d,c)<<18)|(g(d,c+1)<<12)|(g(d,c+2)<<6)|g(d,c+3);a.push(String.fromCharCode(e>>16,(e>>8)&255,e&255))}switch(f){case 1:e=(g(d,c)<<18)|(g(d,c+1)<<12)|(g(d,c+2)<<6);a.push(String.fromCharCode(e>>16,(e>>8)&255));break;case 2:e=(g(d,c)<<18)|(g(d,c+1)<<12);a.push(String.fromCharCode(e>>16));break}return a.join("")};base64.getbyte=function(c,b){var a=c.charCodeAt(b);if(a>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return a};base64.encode=function(e){if(arguments.length!=1){throw"SyntaxError: Not enough arguments"}var b=base64.PADCHAR;var g=base64.ALPHA;var f=base64.getbyte;var d,h;var a=[];e=""+e;var c=e.length-e.length%3;if(e.length==0){return e}for(d=0;d<c;d+=3){h=(f(e,d)<<16)|(f(e,d+1)<<8)|f(e,d+2);a.push(g.charAt(h>>18));a.push(g.charAt((h>>12)&63));a.push(g.charAt((h>>6)&63));a.push(g.charAt(h&63))}switch(e.length-c){case 1:h=f(e,d)<<16;a.push(g.charAt(h>>18)+g.charAt((h>>12)&63)+b+b);break;case 2:h=(f(e,d)<<16)|(f(e,d+1)<<8);a.push(g.charAt(h>>18)+g.charAt((h>>12)&63)+g.charAt((h>>6)&63)+b);break}return a.join("")};if(self.atob==undefined){self.atob=base64.decode}if(self.btoa==undefined){self.btoa=base64.encode}function Collection(a){this.coll=a||(new ArrayList())}Collection.prototype.GetNative=function(){return this.coll};Collection.prototype.Add=function(a){this.coll.Add(a)};Collection.prototype.Get=function(a){return this.coll[a]};Collection.prototype.GetString=function(a){return this.coll[a]};Collection.prototype.GetInteger=function(a){return this.coll[a]};Collection.prototype.RemoveLast=function(){this.coll.RemoveAt(this.coll.Count()-1)};Collection.prototype.Clear=function(){this.coll.Clear()};Collection.prototype.Count=function(){return this.coll.Count()};if(String.prototype.trim==undefined){String.prototype.trim=function(){return(this.trimLeft().trimRight())}}if(String.prototype.trimLeft==undefined){String.prototype.trimLeft=function(){if(this.length==0){return this}if(this===" "){return""}var a=0;while(" \t\n\v\f\r".indexOf(this.charAt(a))!=-1){a++}return this.substr(a)}}if(String.prototype.trimRight==undefined){String.prototype.trimRight=function(){if(this.length==0){return this}if(this===" "){return""}var a=this.length-1;while(" \t\n\v\f\r".indexOf(this.charAt(a))!=-1){a--}return this.substr(0,a+1)}}if(String.prototype.startsWith==undefined){String.prototype.startsWith=function(a){return(this.substr(0,a.length)==a)}}if(String.prototype.endsWith==undefined){String.prototype.endsWith=function(a){return(this.substr(this.length-a.length)==a)}}if(String.prototype.equals==undefined){String.prototype.equals=function(a){return(this+""==a)}}if(String.compare==undefined){String.compare=function(c,a,b){if(b){c=c.toLowerCase();a=a.toLowerCase()}if(c>a){return 1}else{if(c<a){return -1}else{return 0}}}}if(String.prototype.remove==undefined){String.prototype.remove=function(a,d){var c=this.substring(0,a);var b="";if(a+d<this.length){b=this.substring(a+d)}return c+b}}if(String.prototype.insert==undefined){String.prototype.insert=function(a,d){if(a>=this.length){return this.concat(d)}var c=this.substring(0,a);var b=this.substring(a);return c+d+b}}if(String.prototype.Replace==undefined){String.prototype.Replace=function(b,a){return this.replace(new RegExp(b,"g"),a)}}if(String.prototype.toHex==undefined){String.prototype.toHex=function(c){var b="";for(var a=0;a<c.length;a++){b+=(c.charCodeAt(a)<16?"0":"")+c.charCodeAt(a).toString(16).toUpperCase()}return b}}if(String.isDigit==undefined){String.isDigit=function(a){return(a>="0"&&a<="9")}}if(Array.resize==undefined){Array.resize=function(d,a){var c=d.length;if(a<c){d.splice(a,c-a)}else{for(var b=c;b<a;b++){d.push(undefined)}}}}if(Array.copy==undefined){Array.copy=function(e,a,f,b,d){for(var c=0;c<d;c++){f[b+c]=e[a+c]}}}if(Array.prototype.copyTo==undefined){Array.prototype.copyTo=function(c,a){for(var b=a;b<this.length;b++){c[b]=this[b]}}}if(Array.prototype.remove==undefined){Array.prototype.remove=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){this.splice(a,1);return}}}}if(Object.keys==undefined){Object.keys=function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(b)}}return a}}if(Object.prototype.clone==undefined){Object.prototype.clone=function(){var a=new (Object(this).constructor);var c=Object.keys(this);for(var b=0;b<c.length;b++){var e=c[b];var d=this[e];switch(typeof(d)){case"object":a[e]=(d===null?null:d.clone());break;case"function":break;default:a[e]=this[e];break}}return a}}Object.prototype.getClassName=function(){if(this.constructor.prototype.constructor.name!=undefined){return this.constructor.prototype.constructor.name}else{var a=this.constructor.toString().match(/function\s*(\w+)/);if(a&&a.length==2){return a[1]}}return undefined};Object.prototype.getConstructorName=function(){if(this.prototype.constructor.name!=undefined){return this.prototype.constructor.name}else{var a=this.prototype.constructor.toString().match(/function\s*(\w+)/);if(a&&a.length==2){return a[1]}}return undefined};Object.prototype.ToString=function(){return this.toString()};Boolean.prototype.toString=function(){return(this==true?"-1":"0")};if(Date.prototype.dstOffset==undefined){Date.prototype.dstOffset=function(){var a=new Date(this.getFullYear(),0,1);var c=new Date(this.getFullYear(),6,1);var b=Math.max(a.getTimezoneOffset(),c.getTimezoneOffset());return(this.getTimezoneOffset()<b?3600000:0)}}if(self.myPostMessage==undefined){self.myPostMessage=function(a){self.postMessage(a)}}function WriteToConsoleError(a){WriteToConsole(a,"error")}function WriteToConsoleOutput(a){WriteToConsole(a,"output")}function WriteToConsole(b,a){var c="";if(self.RD4_ServerSession){c="(SS '"+self.RD4_ServerSession.SessionName+"') "}else{c="(Main Application) "}if(typeof(b)=="object"){if(b.stack){c+=b.stack}else{if(b.message){c+=b.message}else{c+=JSON.stringify(b)}}}else{c+=b}myPostMessage({type:"debug",channel:a,message:c})}function TryOpenDatabase(c,a,f,e){for(var d=0;d<30*5;d++){var b=openDatabaseSync(c,a,f,e);if(b!=null){return b}if(d==0){myPostMessage({type:"db",name:c,ver:a,desc:f,size:e})}IDL.Sleep(200)}return null}self.BlobBuilder=self.MozBlobBuilder||self.WebKitBlobBuilder||self.BlobBuilder;self.URL=self.webkitURL||self.URL;self.requestFileSystemSync=self.webkitRequestFileSystemSync||self.requestFileSystemSync;if(!self.openDatabaseSync){WriteToConsoleOutput("Using remote SQLite driver");var sendRemoteDBCmd=function(c,f,e){var b=new XMLHttpRequest();try{var a=self.location.protocol+"//"+self.location.hostname;if(self.location.port.length>0){a+=":"+self.location.port}a+=self.location.pathname;b.open("POST",a+"?WCI=QUERY",false);b.send(JSON.stringify({name:c,cmd:f,data:e}));return JSON.parse(b.responseText)}catch(d){WriteToConsoleError("Error while sending remote command (DB="+c+", CMD="+f+"): "+d);if(b.responseText){throw new Error(b.responseText)}else{throw d}}};self.openDatabaseSync=function(c,a,f,d){var e=function(l,h){var k={};k.executeSql=function(s,r){if(r&&r.length){var q=false;var o=0;for(var m=0;m<s.length;m++){if(s[m]=="'"){q=!q}else{if(s[m]=="?"&&!q){var n=r[o];if(typeof n=="string"){n="'"+n.replace(/\'/g,"''")+"'"}s=s.substring(0,m)+n+s.substring(m+1);m+=(n+"").length-1;o++}}}}return sendRemoteDBCmd(c,"QUERY",s)};try{if(h){sendRemoteDBCmd(c,"BEGINTRANS")}l(k);if(h){sendRemoteDBCmd(c,"COMMITTRANS")}}catch(g){WriteToConsoleError("Error while executing commands (DB="+c+"): "+g);if(h){try{sendRemoteDBCmd(c,"ROLLBACKTRANS")}catch(j){}}throw g}};var b={};b.transaction=function(g){return e(g,true)};b.readTransaction=function(g){return e(g,false)};b.close=function(){try{sendRemoteDBCmd(c,"CLOSE")}catch(g){WriteToConsoleError("Can't close database (DB="+c+"): "+g)}};return b}}function BitArray(b){Array.call(this);if(b){if(typeof(b)=="number"){var c=Math.floor(b);for(var a=0;a<c;a++){this.push(false)}}}}BitArray.prototype=new Array();BitArray.prototype.SetAll=function(b){var c=this.length;for(var a=0;a<c;a++){this[a]=b}}
/* @source http://purl.eligrey.com/github/BlobBuilder.js/blob/master/BlobBuilder.js */
;self.BlobBuilder=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||(function(k){var c=function(x){return Object.prototype.toString.call(x).match(/^\[object\s(.*)\]$/)[1]};var v=function(){this.data=[]};var u=function(z,x,y){this.data=z;this.size=z.length;this.type=x;this.encoding=y};var l=v.prototype;var t=u.prototype;var o=k.FileReaderSync;var a=function(x){this.code=this[this.name=x]};var m=("NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR").split(" ");var s=m.length;var q=k.URL||k.webkitURL||k;var r=q.createObjectURL;var b=q.revokeObjectURL;var e=q;var j=k.btoa;var f=k.atob;var n=false;var h=function(x){n=!x};var d=k.ArrayBuffer;var g=k.Uint8Array;v.fake=t.fake=true;while(s--){a.prototype[m[s]]=s+1}if(!q.createObjectURL){e=k.URL={}}e.createObjectURL=function(y){var z=y.type;var x;if(z===null){z="application/octet-stream"}if(y instanceof u){x="data:"+z;if(y.encoding==="base64"){return x+";base64,"+y.data}else{if(y.encoding==="URI"){return x+","+decodeURIComponent(y.data)}}if(j){return x+";base64,"+j(y.data)}else{return x+","+encodeURIComponent(y.data)}}else{if(real_create_object_url){return real_create_object_url.call(q,y)}}};e.revokeObjectURL=function(x){if(x.substring(0,5)!=="data:"&&real_revoke_object_url){real_revoke_object_url.call(q,x)}};l.append=function(B){var C=this.data;if(g&&B instanceof d){if(n){C.push(String.fromCharCode.apply(String,new g(B)))}else{var y=new g(B);var A=y.length;for(var z=0;z<A;z++){C.push(String.fromCharCode(y[z]))}}}else{if(c(B)==="Blob"||c(B)==="File"){if(o){var x=new o;C.push(x.readAsBinaryString(B))}else{throw new a("NOT_READABLE_ERR")}}else{if(B instanceof u){if(B.encoding==="base64"&&f){C.push(f(B.data))}else{if(B.encoding==="URI"){C.push(decodeURIComponent(B.data))}else{if(B.encoding==="raw"){C.push(B.data)}}}}else{if(typeof B!=="string"){B+=""}C.push(unescape(encodeURIComponent(B)))}}}};l.getBlob=function(x){if(!arguments.length){x=null}return new u(this.data.join(""),x,"raw")};l.toString=function(){return"[object BlobBuilder]"};t.slice=function(A,x,z){var y=arguments.length;if(y<3){z=null}return new u(this.data.slice(A,y>1?x:this.data.length),z,this.encoding)};t.toString=function(){return"[object Blob]"};return v}(self));DTTEngine.LEV_NONE=0;DTTEngine.LEV_EXCEPT=1;DTTEngine.LEV_PROCS=2;DTTEngine.LEV_CTRLBLCKS=3;DTTEngine.LEV_QUERY=4;DTTEngine.LEV_STATEM=5;DTTEngine.IT_NULL=-1;DTTEngine.IT_LOOPDET=0;DTTEngine.IT_ENTERPROC=1;DTTEngine.IT_EXITPROC=2;DTTEngine.IT_IF=3;DTTEngine.IT_ENTERIF=4;DTTEngine.IT_ENTERELSE=5;DTTEngine.IT_ENDIF=6;DTTEngine.IT_ASSIGN=7;DTTEngine.IT_ERROR=8;DTTEngine.IT_BREAK=9;DTTEngine.IT_EXCEPTION=10;DTTEngine.IT_RETURN=11;DTTEngine.IT_SUBPROC=12;DTTEngine.IT_FOREACH=13;DTTEngine.IT_ENDFOREACH=14;DTTEngine.IT_DBDATASRC=15;DTTEngine.IT_IMDBDATASRC=16;DTTEngine.IT_WHILE=17;DTTEngine.IT_ENDWHILE=18;DTTEngine.IT_QUERY=19;DTTEngine.IT_ENDQUERY=20;DTTEngine.IT_PARAMETER=21;DTTEngine.IT_TOKEN=22;DTTEngine.IT_CONTINUE=23;DTTEngine.IT_SWITCH=24;DTTEngine.IT_ENTERSWITCH=25;DTTEngine.IT_ENDSWITCH=26;DTTEngine.IT_FORI=27;DTTEngine.IT_ENDFORI=28;DTTEngine.IT_MESSAGE=48;DTTEngine.IT_MESSAGE_TK=49;DTTEngine.IT_USER=50;DTTEngine.IT_TRACE=100;DTTEngine.IT_TEST=200;DTTEngine.STMT_QRY_DELETE=256;DTTEngine.STMT_QRY_UPDATE=512;DTTEngine.STMT_QRY_INSVAL=768;DTTEngine.STMT_QRY_INSSEL=1024;DTTEngine.STMT_QRY_SELVAR=1280;DTTEngine.STMT_QRY_SELECT=1536;DTTEngine.STMT_QRY_SELCOL=1792;DTTEngine.PT_EVENT=0;DTTEngine.PT_EVENT_RECUR=1;DTTEngine.PT_FUNCTION=2;DTTEngine.PT_PROCEDURE=3;DTTEngine.PT_PROC_ITEM=4;DTTEngine.DTTMSG_NONE=0;DTTEngine.DTTMSG_VERB=4;DTTEngine.DTTMSG_INFO=3;DTTEngine.DTTMSG_WARN=2;DTTEngine.DTTMSG_ERROR=1;DTTEngine.TRC_ITMAIN=1;DTTEngine.TRC_ITFORM=2;DTTEngine.TRC_ITFRAME=3;DTTEngine.TRC_ITPANEL=4;DTTEngine.TRC_ITTREE=5;DTTEngine.TRC_ITTABBED=6;DTTEngine.TRC_ITCOMMAND=7;DTTEngine.TRC_ITMENU=8;DTTEngine.TRC_ITTOOLBAR=9;DTTEngine.TRC_ITBUTBAR=10;DTTEngine.TRC_ITCAPTBAR=11;DTTEngine.TRC_ITERROR=12;DTTEngine.TRC_MAINCAPTION=1;DTTEngine.TRC_MAININDIC=2;DTTEngine.TRC_FORMINDIC=3;DTTEngine.TRC_FORMCAPTION=4;DTTEngine.TRC_FORMMESSAGE=5;DTTEngine.TRC_FRAMECAPTION=6;DTTEngine.TRC_PANCAPTION=7;DTTEngine.TRC_PANFLDVALUE=8;DTTEngine.TRC_TREECAPTION=9;DTTEngine.TRC_TREENODE=10;DTTEngine.TRC_TABCAPTION=11;DTTEngine.TRC_CMDCAPTION=12;DTTEngine.TRC_CMDCOMMAND=13;DTTEngine.TRC_ERRNUMBER=14;DTTEngine.TRC_ERRDESCR=15;DTTEngine.TST_APPLOGUP=1;DTTEngine.TST_APPLOGIN=2;DTTEngine.TST_FRMMENU=10;DTTEngine.TST_FRMCLOSE=11;DTTEngine.TST_FRMSELECT=12;DTTEngine.TST_TREEEXP=20;DTTEngine.TST_TREECLK=21;DTTEngine.TST_TREENCHK=22;DTTEngine.TST_PANROWSEL=30;DTTEngine.TST_PANLOCK=31;DTTEngine.TST_PANTOOLBAR=32;DTTEngine.TST_PANCHGPG=33;DTTEngine.TST_PANSORT=34;DTTEngine.TST_PANLOOKUP=35;DTTEngine.TST_PANMSELTLB=36;DTTEngine.TST_FLDCHG=40;DTTEngine.TST_FLDACT=41;DTTEngine.TST_CMDSET=50;DTTEngine.TST_CMD=51;DTTEngine.TST_TABSELPG=60;DTTEngine.TST_BOOKTOOLBAR=70;DTTEngine.TST_MENU=80;DTTEngine.TST_BLOB=81;DTTEngine.TST_TOOLBAR=82;DTTEngine.TST_INDIC=83;DTTEngine.TST_CLOSEALL=84;DTTEngine.TST_ERROR=85;DTTEngine.TST_LOGOFF=86;DTTEngine.TST_TERM=87;function DTTEngine(){this.Requests=new ArrayList();this.AttRequest=null;this.AttItem=null;this.AttID=0;this.AlreadyInit=false;this.CurrentIndLevel=0;this.ShowTime;this.SnapshotLoaded=false;this.ProfileTicks=0;this.Procs=new HashTableSrv();this.ProcLoaded=false;this.ProcShowed=true;this.HiddenMessages=new ArrayList();this.BreakPoints=new ArrayList();this.flTestHorizontal;this.Level=DTTEngine.LEV_NONE;this.MsgLevel=DTTEngine.DTTMSG_NONE;this.TraceEnabled=false;this.TestEnabled=false;this.HelpGeneration=false;this.HelpGenerationActive=false;this.TestRunning;this.RecordRunning=false;this.NextSessionID=-1;this.RunMode="";this.FixedDebugFile="";this.ShowLevel;this.ShowMsgLevel;this.ShowRequest="";this.LastCmdRes="";this.MaxLoopCycles;this.LoggedLoops;this.MaxStackLoops;this.MaxRecToDump;this.TraceRecToDump;this.RequestsToPassive;this.RequestsToPerm;this.PassiveLevel;this.PassiveMsgLevel;this.PassiveTraceEnabled;this.PermSaveToDB;this.Enabled=true;this.DB;this.DBClass;this.SQLSessInsert;this.SQLSessUpdate;this.SessionID;this.SQLReqInsert;this.SQLItemInsert;this.SQLGetSessID;this.SQLGetReqID;this.SQLGetItemID;this.SQLSessLoad;this.SQLReqLoad;this.SQLItemLoad;this.SQLSubItemLoad;this.Name="";this.Description="";this.UserID;this.SessionTestSrcID;this.RefDTTObj=null;this.HelpEnabled;this.HelpSMTPServer;this.HelpSMTPUsername;this.HelpSMTPPassword;this.HelpAddress;this.HelpSubject;this.HelpName;this.HelpRecallTo;this.HelpReplyTo;this.HelpDescription;this.HelpAutoSendMail;this.LastSentTime;this.LastSentReqID;this.HelpReqIdx;this.HelpTotItems;this.HelpErrors;this.MaskGuid="";this.MaskIndLevel=-1;this.ItemCollect=true;this.LevelCollect=0;this.ItemVisible=true;this.LevelVisible=0;this.DTTStarted=false;this.DTT2File=false;this.DTTFileName="";this.ShowRecurr=true;this.MainFrm}DTTEngine.prototype.GetTickCount=function(){return new Date().getTime()};DTTEngine.prototype.Init=function(f,e,d,a,c,b){if(this.AlreadyInit){return}if(f>0){WriteToConsoleOutput("DTT_LEVEL="+f);WriteToConsoleOutput("DTT_MSGLEVEL="+e);this.DTTStarted=true}this.AlreadyInit=true;this.Level=b.getRTCObj().GetConst("2644B5C1-6387-4E9A-9481-F2A973A4CCD0",f);this.MsgLevel=b.getRTCObj().GetConst("97A1A665-A117-42A0-8C40-48079EE5F2CD",e);this.ShowLevel=f;this.ShowMsgLevel=e;this.TraceEnabled=d;this.TestEnabled=a;this.HelpGeneration=c;this.TraceRecToDump=b.getRTCObj().GetConst("B85E1BB7-E7C0-4D6B-BAB6-EFC98B1FF5B7",1);if(!this.TraceEnabled){this.MaxLoopCycles=1000;this.MaxStackLoops=32}else{this.MaxLoopCycles=1000000;this.MaxStackLoops=100}this.MaxLoopCycles=b.getRTCObj().GetConst("78A3F157-59CD-43CF-9002-2DCDD4D639D7",this.MaxLoopCycles);this.LoggedLoops=b.getRTCObj().GetConst("F899CBB9-4C90-40A3-B90C-95852DA339A1",10);this.MaxStackLoops=b.getRTCObj().GetConst("8138A398-AFF0-46E5-8614-4ADA34FD090F",this.MaxStackLoops);this.MaxRecToDump=b.getRTCObj().GetConst("1EDC9C1F-11C6-4FDF-A4B2-0905D2CC6E2C",10);this.RequestsToPassive=b.getRTCObj().GetConst("062349E2-029E-4171-BADF-401D041F1E3B",50);this.RequestsToPerm=b.getRTCObj().GetConst("22E56642-C0DA-45A5-A1AD-F4FF05E8D38F",100);this.PassiveLevel=(this.TestEnabled?this.Level:DTTEngine.LEV_EXCEPT);this.PassiveMsgLevel=(this.TestEnabled?this.MsgLevel:DTTEngine.DTTMSG_WARN);this.PassiveTraceEnabled=this.TestEnabled;this.PermSaveToDB=(b.getRTCObj().GetConst("3CD4F00A-A42D-4CD0-B05F-5A5A8C45F295",false)!=0);this.HelpEnabled=(b.getRTCObj().GetConst("81048684-4515-4A09-872C-0D3FC2817664",this.TraceEnabled)!=0);this.HelpAutoSendMail=(b.getRTCObj().GetConst("A4FDFFD5-6590-40E0-B469-4B54ED031ADA",false)!=0);this.HelpSMTPServer=b.getRTCObj().GetConst("45949632-FE35-43E5-9E86-1200433A037A","");this.HelpSMTPUsername=b.getRTCObj().GetConst("8FADF024-10DB-40fa-90A4-3851B2960E86","");this.HelpSMTPPassword=b.getRTCObj().GetConst("FDFF0513-6FD7-49d1-8F45-9F1AB86D5291","");this.HelpAddress=b.getRTCObj().GetConst("769E5A70-9153-4075-8A74-91BF4E76E277","");this.HelpSubject=b.getRTCObj().GetConst("BBF7F8EF-C0E3-4C4C-9F40-F888A2018706","");this.HelpName=b.getRTCObj().GetConst("D2C579BC-9E31-4A77-B2AC-9D46310D9B58","");this.HelpDescription=b.getRTCObj().GetConst("1F9CB062-5F43-47E8-BA4A-BE84DB22BD99","");this.HelpRecallTo=b.getRTCObj().GetConst("7A90FA60-E29F-42B3-A206-C66BA869F095","");this.HelpReplyTo=b.getRTCObj().GetConst("92E2D505-5147-473E-B454-3E6B6337FBFC","");this.LastSentTime=new Date(0);this.LastSentReqID=-1};DTTEngine.prototype.InitDB=function(a,b){this.DB=a;this.DBClass=b;this.PrepareSQLcommands()};DTTEngine.prototype.Render=function(b,c,g){if(this.Level==DTTEngine.LEV_NONE&&!this.SnapshotLoaded){return}if(!this.Enabled&&!this.SnapshotLoaded){return}if(c.equals("")){b.WriteStrDbgMain("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgMain("<meta http-equiv='X-UA-Compatible' content='IE=EmulateIE7' />");b.WriteStrDbgMain("<title>Debug Window</title>");b.WriteStrDbgMain("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgMain("<script src='dttRD4.js' type='text/javascript'><\/script></head>");b.WriteStrDbgMain("<script>");b.WriteStrDbgMain(b.UrlForDTT(Glb.ITEM_DTT,"Req","","","ItemList")+";");b.WriteStrDbgMain(b.UrlForDTT(Glb.ITEM_DTT,"Cmd","","","CmdForm")+";");b.WriteStrDbgMain("<\/script>");b.WriteStrDbgMain("<frameset cols='"+(this.IsTouch()?"220px":"20%")+", *'>");if(this.RefDTTObj==null){b.WriteStrDbgMain("<frameset rows='*, 80' >")}b.WriteStrDbgMain("<frame name='ItemList' src='' noresize>");if(this.RefDTTObj==null){b.WriteStrDbgMain("<frame name='CmdForm' noresize scrolling=no src='' ></frameset>")}b.WriteStrDbgMain("<frame name='Detail' src=''>");b.WriteStrDbgMain("</frameset></html>")}else{if(c.equals("FORM")){try{if(g.GetAttribute("par1")=="FLTMSG"){this.ShowMsgLevel=new IDVariant(g.GetAttribute("par2")).intValue()}if(g.GetAttribute("par1")=="FLTIT"){this.ShowLevel=new IDVariant(g.GetAttribute("par2")).intValue()}}catch(h){}b.WriteStrDbgReqTop("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqTop("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqTop("<script src='dttRD4.js' type='text/javascript'><\/script>");var f=this.GetRequest(this.ShowRequest);if(f!=null){f.RenderCaption(b,true,(this.RefDTTObj!=null))}}else{if(c.equals("RECUR")){this.ShowRecurr=!this.ShowRecurr;b.WriteStrDbgReqTop("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqTop("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqTop("<script src='dttRD4.js' type='text/javascript'><\/script>");var f=this.GetRequest(this.ShowRequest);if(f!=null){f.RenderCaption(b,true,(this.RefDTTObj!=null))}}else{if(c.equals("Req")){this.RenderRequest(b,g)}else{if(c.equals("Cmd")){this.RenderCmdForm(b)}else{if(c.equals("CMDFRM")){this.LastCmdRes=this.ParseCommand(g.GetAttribute("par2"),b);this.RenderCmdForm(b)}else{if(c.equals("TIMER")){this.ShowTime=!this.ShowTime;this.RenderRequest(b)}else{if(c.equals("START")||c.equals("STOP")){this.DTTStarted=!this.DTTStarted;this.RenderRequest(b)}else{if(c.equals("PSHOW")){this.ProcShowed=!this.ProcShowed;this.RenderRequest(b)}else{if(c.length>3&&(c.substr(0,3).equals("COL")||c.substr(0,3).equals("VIS"))){this.ProcCommand(c,b);this.Render(b,"REQPRC"+c.substr(39));return}if(c.length>3&&c.substr(0,3).equals("RES")){this.ResetProcs(b);this.Render(b,"REQPRC"+c.substr(6));return}if(c.length>5&&(c.substr(0,5).equals("EXPIT")||c.substr(0,5).equals("CMPIT"))){var d=c.indexOf("REF");if(d>=0){this.ShowRequest=c.substr(d+3);var f=this.RefDTTObj.GetRequest(this.ShowRequest);if(f!=null){f.ExpandItem(c.substr(5),c.substr(0,5).equals("EXPIT"),false)}}this.Render(b,"REF"+this.ShowRequest);return}if(c.length>3&&c.substr(0,3).equals("REQ")){this.ShowRequest=c.substr(6);if(c.length>6&&c.substr(3,3).equals("TOP")){b.WriteStrDbgReqTop("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqTop("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqTop("<script src='dttRD4.js' type='text/javascript'><\/script>");var f=this.GetRequest(c.substr(6));if(f!=null){f.RenderCaption(b,false,(this.RefDTTObj!=null))}}else{if(c.length>6&&c.substr(3,3).equals("REF")){var a;if(this.RefDTTObj!=null){a=this.RefDTTObj.GetRequest(c.substr(6))}else{a=null}b.WriteStrDbgReqRef("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqRef("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqRef("<script src='dttRD4.js' type='text/javascript'><\/script>");if(this.RefDTTObj!=null){b.WriteStrDbgReqRef("<script language='javascript' type='text/javascript'>");b.WriteStrDbgReqRef("function onBodyScroll() {");b.WriteStrDbgDetail(" try {");b.WriteStrDbgReqRef("  parent.ReqChk.document.body.scrollTop = parent.ReqRef.document.body.scrollTop;");b.WriteStrDbgReqRef("  parent.ReqChk.document.body.scrollLeft = parent.ReqRef.document.body.scrollLeft;");b.WriteStrDbgReqRef(" } catch (e) {}");b.WriteStrDbgReqRef("}");b.WriteStrDbgReqRef("<\/script>")}b.WriteStrDbgReqRef("</head>");var f=this.GetRequest(c.substr(6));if(f!=null){f.Render(b,this.ShowTime,"",a)}}else{if(c.length>6&&c.substr(3,3).equals("CHK")){var a=this.GetRequest(c.substr(6));b.WriteStrDbgReqRef("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqRef("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqRef("<script src='dttRD4.js' type='text/javascript'><\/script>");b.WriteStrDbgReqRef("<script language='javascript' type='text/javascript'>");b.WriteStrDbgReqRef("function onBodyScroll() {");b.WriteStrDbgReqRef(" try {");b.WriteStrDbgReqRef("  parent.ReqRef.document.body.scrollTop = parent.ReqChk.document.body.scrollTop;");b.WriteStrDbgReqRef("  parent.ReqRef.document.body.scrollLeft = parent.ReqChk.document.body.scrollLeft;");b.WriteStrDbgReqRef(" } catch (e) {}");b.WriteStrDbgReqRef("}");b.WriteStrDbgReqRef("<\/script>");b.WriteStrDbgReqRef("</head>");var f=this.RefDTTObj.GetRequest(c.substr(6));if(f!=null){f.Render(b,this.ShowTime,"chk",a)}}else{if(c.length>6&&c.substr(3,3).equals("PRC")){b.WriteStrDbgReqPrc("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqPrc("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqPrc("<script src='dttRD4.js' type='text/javascript'><\/script>");var f=this.GetRequest(c.substr(6));if(f!=null){f.RenderProcs(b,this.Procs)}}}}}}else{if(c.length>6&&c.substr(0,6).equals("ROTATE")){this.flTestHorizontal=!this.flTestHorizontal;this.Render(b,c.substr(6))}else{b.WriteStrDbgDetail("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgDetail("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgDetail("<script src='dttRD4.js' type='text/javascript'><\/script>");b.WriteStrDbgDetail("<script>");b.WriteStrDbgDetail(b.UrlForDTT(Glb.ITEM_DTT,"REQTOP"+c,"","","ReqTop")+";");b.WriteStrDbgDetail(b.UrlForDTT(Glb.ITEM_DTT,"REQREF"+c,"","","ReqRef")+";");b.WriteStrDbgDetail(b.UrlForDTT(Glb.ITEM_DTT,"REQPRC"+c,"","","ReqPrc")+";");if(this.RefDTTObj!=null){b.WriteStrDbgDetail(b.UrlForDTT(Glb.ITEM_DTT,"REQCHK"+c,"","","ReqChk")+";")}b.WriteStrDbgDetail("<\/script>");b.WriteStrDbgDetail("<frameset rows='25, *"+(this.ProcShowed?", "+this.GetRequest(c).ProcSize(this.Procs):"")+"' >");b.WriteStrDbgDetail("<frame name='ReqTop' frameborder=0 noresize scrolling=no src='' >");if(this.RefDTTObj!=null){b.WriteStrDbgDetail("<frameset "+(this.flTestHorizontal?"rows":"cols")+"='50%, 50%'>")}b.WriteStrDbgDetail("<frame name='ReqRef' src='' >");if(this.RefDTTObj!=null){b.WriteStrDbgDetail("<frame name='ReqChk' src='' >");b.WriteStrDbgDetail("</frameset>")}if(this.ProcShowed){b.WriteStrDbgDetail("<frame name='ReqPrc' frameborder=1 src='' >")}b.WriteStrDbgDetail("</frameset></html>")}}}}}}}}}}}};DTTEngine.prototype.RenderRequest=function(c,g){c.WriteStrDbgItemList("<html><head>");c.WriteStrDbgItemList("<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");c.WriteStrDbgItemList("<link rel=stylesheet type='text/css' href='dtt.css'></head>");c.WriteStrDbgItemList("<script language='javascript' src='dttRD4.js'><\/script>");c.WriteStrDbgItemList("<script language='javascript' type='text/javascript'>");c.WriteStrDbgItemList("var ReqsNum="+this.AttID+";\n");c.WriteStrDbgItemList("<\/script>");c.WriteStrDbgItemList("<body style='overflow:hidden;height:100%'>");c.WriteStrDbgItemList("<table class='SesHdr'><tr><td>Session</td><td>");c.WriteStrDbgItemList("<a href='javascript:refreshreqlist()'><img title='Refresh request list' src='dttimg/rotate.gif'></a>&nbsp;&nbsp;&nbsp;&nbsp;");c.WriteStrDbgItemList("<a href='javascript:showprof()'><img title='Show profile data' src='dttimg/timer.gif'></a>&nbsp;");if(this.DTTStarted){c.WriteStrDbgItemList("<a  href='javascript:"+c.UrlForDTT(Glb.ITEM_DTT,"STOP")+"'><img title='DTT is enabled. Click to stop collecting debug data' src='dttimg/tstart.gif'></a>")}else{c.WriteStrDbgItemList("<a href='javascript:"+c.UrlForDTT(Glb.ITEM_DTT,"START")+"'><img title='DTT is disabled. Click to start collecting debug data' src='dttimg/tstop.gif'></a>")}c.WriteStrDbgItemList("&nbsp;<a href='javascript:"+c.UrlForDTT(Glb.ITEM_DTT,"PSHOW")+" gf(window.parent.frames,\"Detail\").resendLastEvent(\"Detail\");'><img title='Open/close method window' src='dttimg/tstmt.gif'></a>");c.WriteStrDbgItemList("</td></tr></table>");if(this.Requests.Count()==0){c.WriteStrDbgItemList("<br><center>(No requests available)</center>")}else{c.WriteStrDbgItemList("<div id='reqlist' style='overflow-y:auto; height:calc(100% - 25px);'>");c.WriteStrDbgItemList("<table class='ReqList'>");for(var b=0;b<this.Requests.length;b++){var f=this.Requests[b];c.WriteStrDbgItemList("<tr><td>");c.WriteStrDbgItemList("<img src='dttimg/"+f.GetIcon()+"'></td><td>");c.WriteStrDbgItemList("<a title='"+Glb.HTMLEncode(f.Description)+"' href='javascript:showreq(\""+f.ID+"\")'>");c.WriteStrDbgItemList("<span id='R"+f.ID+"'");if(f.Matches==DTTRequest.REQ_DIFFERS){c.WriteStrDbgItemList(" style='background-color:yellow'")}else{if(f.Matches==DTTRequest.REQ_MISSING){c.WriteStrDbgItemList(" style='background-color:#FF8080'")}else{if(f.HasBP(c)){c.WriteStrDbgItemList(" style='background-color:lightgreen'")}}}c.WriteStrDbgItemList(">"+Glb.HTMLEncode(f.Name,false,true)+"</span>");if(this.ShowTime){c.WriteStrDbgItemList(" ("+f.ElapsedTime+" ms)")}c.WriteStrDbgItemList("</a></td></tr>")}c.WriteStrDbgItemList("</table>");c.WriteStrDbgItemList("</div>")}c.WriteStrDbgItemList("</body>");if(g){var e=g.GetAttribute("par1");var d=g.GetAttribute("par2");var a="";if(e!="0"){a+="showreq("+e+",true); "}if(d!="0"){a+='document.getElementById("reqlist").scrollTop = '+d+"; "}if(a){c.WriteStrDbgItemList('<script language="javascript" type="text/javascript">'+a+"<\/script>")}}c.WriteStrDbgItemList("</html>")};DTTEngine.prototype.RenderCmdForm=function(a){a.WriteStrDbgCmdForm("<html><head>");a.WriteStrDbgCmdForm("<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");a.WriteStrDbgCmdForm("<link rel=stylesheet type='text/css' href='dtt.css'></head>");a.WriteStrDbgCmdForm("<script src='dttRD4.js' type='text/javascript'><\/script>");a.WriteStrDbgCmdForm("<body class='CmdFrm' onload='document.getElementById('CMD').focus()'>");a.WriteStrDbgCmdForm("Command: (HM #, SM, AB g, RB, SS n)<br>");a.WriteStrDbgCmdForm("<input type='text' class='CmdEdit' id='CMD' name='CMD' style='width:100%'");a.WriteStrDbgCmdForm(' ondrop=\'gf(window.parent.frames,"Detail").resendLastEvent("Detail");gf(window.parent.frames,"ItemList").resendLastEvent("ItemList");\'');a.WriteStrDbgCmdForm("onkeypress='if (event.keyCode == 13) {"+a.UrlForDTT(Glb.ITEM_DTT,"CMDFRM","CMD","this.value","",false)+'; gf(window.parent.parent.frames,"Detail").resendLastEvent("Detail");gf(window.parent.frames,"ItemList").resendLastEvent("ItemList");}\'');a.WriteStrDbgCmdForm("><br>");a.WriteStrDbgCmdForm(this.LastCmdRes);a.WriteStrDbgCmdForm("</body></html>")};DTTEngine.prototype.GetRequest=function(a){try{var f=parseInt(a,10);for(var b=0;b<this.Requests.length;b++){var c=this.Requests[b];if(c.ID==f){return c}}}catch(d){WriteToConsoleError("[DTTEngine.GetRequest] Exception while getting request: "+d)}return null};DTTEngine.prototype.GetTicks=function(){if(this.AttRequest==null){return -1}else{return this.GetTickCount()-this.AttRequest.StartTicks-this.ProfileTicks}};DTTEngine.prototype.MaskDebugItems=function(a){if(!this.ItemCollect){return true}if(this.MaskGuid==null){this.MaskGuid=""}if(this.MaskGuid.equals(a)&&this.MaskIndLevel-1==this.CurrentIndLevel){this.MaskGuid="";this.MaskIndLevel=-1;return false}return(this.MaskIndLevel!=-1&&this.CurrentIndLevel>=this.MaskIndLevel)};DTTEngine.prototype.Add=function(a,b,c){this.AddItem(c,DTTEngine.IT_USER,"",b,"",a)};DTTEngine.prototype.AddMsg=function(f,d,e,c,a,b){if(b==undefined){b=""}if(!this.ItemCollect){return}if(f<=this.MsgLevel){this.AddItem(f,DTTEngine.IT_MESSAGE,d,e,c,a,this.AdaptVariant(b))}else{this.AttItem=null}};DTTEngine.prototype.AddMsgToken=function(a,e,g){if(g==undefined){g=new IDVariant("")}if(!this.MaskDebugItems(a)&&(this.AttRequest!=null)){var c=null;var f=this.AttRequest.Items.length;for(var b=0;b<f;b++){c=this.AttRequest.Items[b];if(c.ItemType==DTTEngine.IT_MESSAGE){break}}if(c!=null){var d=new DTTItem();d.IndLevel=this.CurrentIndLevel;d.ItemType=DTTEngine.IT_MESSAGE_TK;d.MsgType=0;d.ObjGuid=(a==null?"":a);d.ObjName=(e==null?"":e);d.ObjType=0;d.ObjValue=this.AdaptVariant(g);if(c.SubItem==null){c.SubItem=new ArrayList()}c.SubItem.Add(d)}}else{AttItem=null}};DTTEngine.prototype.AddTraceItem=function(e,c,d,a,b){if(b==undefined){b=new IDVariant("")}if(this.TraceEnabled){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_TRACE,e,c,d,a,this.AdaptVariant(b));return true}else{this.AttItem=null;return false}};DTTEngine.prototype.AddTraceToken=function(a,j,b,d,e){if(!(d instanceof IDVariant)){d=new IDVariant(d)}if(this.TraceEnabled&&!this.MaskDebugItems(a)&&this.AttRequest!=null){var h=null;var f=this.AttRequest.Items.length;for(var g=0;g<f;g++){h=this.AttRequest.Items[g];if(h.ItemType==DTTEngine.IT_TRACE){break}}if(h!=null){var c=new DTTItem();c.ItemType=DTTEngine.IT_TOKEN;c.IndLevel=this.CurrentIndLevel;c.MsgType=0;c.ObjGuid=a;c.ObjType=j;c.ObjName=b;c.ObjValue=this.AdaptVariant(d);c.ObjDescription=e;if(h.SubItem==null){h.SubItem=new ArrayList()}h.SubItem.Add(c)}}else{this.AttItem=null}};DTTEngine.prototype.AddTestItem=function(e,c,d,a,b){if(b==undefined){b=new IDVariant("")}if(typeof(b)=="number"){b=new IDVariant(b)}if(this.TestEnabled){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_TEST,e,c,d,a,b);return true}else{this.AttItem=null;return false}};DTTEngine.prototype.AddHelpItem=function(a,g,b,e,f){if(this.TestEnabled&&this.HelpGenerationActive&&this.AttRequest!=null){var d=this.AttRequest.Items[0];var c=new DTTHelpItem();if(a!=0){c.x=a}if(g!=0){c.y=g}if(b!=0){c.w=b}if(e!=0){c.h=e}c.Text=f;d.HelpItem=c}};DTTEngine.prototype.AddItem=function(g,f,d,e,c,a,b){if(b==undefined){b=new IDVariant("")}if(typeof(b)=="number"){b=new IDVariant(b)}if(this.AttRequest==null){return}if(!this.ItemCollect){return}if(f!=DTTEngine.IT_USER&&!this.DTT2File){if(c.length>255){c=c.substr(0,252)+"..."}if(a.length>255){a=a.substr(0,252)+"..."}}this.AttItem=new DTTItem();this.AttItem.Visible=this.ItemVisible;this.AttItem.IndLevel=this.CurrentIndLevel;this.AttItem.MsgType=g;this.AttItem.ItemType=f;this.AttItem.ObjGuid=(d==null?"":d);this.AttItem.ObjType=e;this.AttItem.ObjName=(c==null?"":c);this.AttItem.ObjDescription=(a==null?"":a);this.AttItem.ObjValue=this.AdaptVariant(b);this.AttItem.TickCount=this.GetTicks();this.AttRequest.Add(this.AttItem)};DTTEngine.prototype.AddRequest=function(a){this.MainFrm=a;this.LoadProcs(a);if(this.Level==DTTEngine.LEV_NONE){return}if(!this.Enabled){return}this.AttID++;this.AttRequest=new DTTRequest();this.AttRequest.InitRequest(this.AttID);if(this.HelpGenerationActive){this.CreateNewHelpItem()}this.CurrentIndLevel=1;this.MaskGuid="";this.MaskIndLevel=-1;this.ItemVisible=true;this.LevelVisible=0;this.ItemCollect=this.DTTStarted;this.LevelCollect=(this.DTTStarted?0:-1);this.Requests.Add(this.AttRequest);this.AttItem=null};DTTEngine.prototype.CreateNewHelpItem=function(){if(this.AttRequest!=null){if(this.AttRequest.HelpItem==null){AttRequest.HelpItem=new DTTHelpItem();AttRequest.HelpItem.x=800;AttRequest.HelpItem.y=20;AttRequest.HelpItem.Delay=0;AttRequest.HelpVerItem=new DTTHelpItem();AttRequest.HelpVerItem.x=800;AttRequest.HelpVerItem.y=20;AttRequest.HelpVerItem.Delay=60}}};DTTEngine.prototype.CancelRequest=function(){if(this.AttRequest==null||!this.Enabled){this.MainFrm=null;return}if(this.Requests.Count()>0){this.Requests.RemoveAt(this.Requests.Count()-1)}this.AttID--;this.AttRequest=null;this.MainFrm=null};DTTEngine.prototype.EndRequest=function(l){if(l==undefined){l=true}if(this.AttRequest==null||!this.Enabled){if(l){this.MainFrm=null}return}this.AttRequest.EndRequest();if(this.HelpGenerationActive&&this.Requests.Count()>1){var o=this.Requests[this.Requests.Count()-2];if(o.HelpVerItem!=null){if(o.HelpVerItem.Text.equals("")){var q="";var b=0;var g;var f=this.AttRequest.Items.Count();for(var d=0;d<f;d++){var h=this.AttRequest.Items[d];if(h.ItemType==DTTEngine.IT_TEST&&h.ObjType!=DTTEngine.TST_TERM){b++}}g=1;for(var d=0;d<f;d++){var h=this.AttRequest.Items[d];if(h.ItemType==DTTEngine.IT_TEST&&h.ObjType!=DTTEngine.TST_TERM){if(b>1){if(g>1){q=q+"<br>\r\n"}q=q+g+") ";g++}q=q+h.HelpItem.Text}}o.HelpVerItem.Text=q}}}if(this.AttRequest.Items.Count()==0&&this.DTTStarted&&this.AttRequest.NamePriority<DTTRequest.PRI_CMD){if(this.Requests.Count()>0){this.Requests.RemoveAt(this.Requests.Count()-1)}if(l){this.MainFrm=null}return}if(this.DTT2File){if(this.DTTFileName.length==0){this.DTTFileName="dtt"+IDL.Format(new IDVariant(IDL.Now()),new IDVariant("yyyymmdd_hhnnss"),null).stringValue();if(this.MainFrm.IsServerSession()){this.DTTFileName+="_SS_"+this.MainFrm.SessionName}else{if(this.MainFrm.WebApiObject.IsWebApiRequest){this.DTTFileName+="_WEBAPI"}}this.DTTFileName+=".log";if(this.MainFrm.ShellObject.IsInsideShell()){this.DTTFileName=this.MainFrm.TempPath()+"/"+this.DTTFileName;if(VBFiles.FileExists(new IDVariant(this.DTTFileName))){this.DTTFileName=this.DTTFileName.substr(0,this.DTTFileName.length-4)+"_"+(Math.ceil(Math.random()*1000))+".log"}var m=this.MainFrm.VBFile.FreeFile();this.MainFrm.VBFile.OpenForOutput(new IDVariant(this.DTTFileName),m,true);this.MainFrm.VBFile.WriteLine(m,new IDVariant(new Date()));this.MainFrm.VBFile.Close(m)}else{var k=requestFileSystemSync(TEMPORARY,5*1024*1024);var j;try{j=k.root.getFile(this.DTTFileName,{create:true,exclusive:true})}catch(n){this.DTTFileName=this.DTTFileName.substr(0,this.DTTFileName.length-4)+"_"+(Math.ceil(Math.random()*1000))+".log";j=k.root.getFile(this.DTTFileName,{create:true})}var c=j.createWriter();var a=new Blob([new Date()+""],{type:"text/plain"});c.write(a);this.DTTFileName=j.toURL()}}this.AttRequest.SaveToFile(this.Level,this.DTTFileName);if(this.Requests.Count()>0){this.Requests.RemoveAt(this.Requests.Count()-1)}if(l){this.MainFrm=null}this.AttRequest=null;return}if(this.TraceEnabled||this.TestEnabled){this.CompactRequests()}if(this.HelpAutoSendMail){var e=false;var f=this.AttRequest.Items.Count();for(var d=0;d<f;d++){h=this.AttRequest.Items[d];if(h.ItemType==DTTEngine.IT_LOOPDET||h.ItemType==DTTEngine.IT_EXCEPTION||h.ItemType==DTTEngine.IT_ERROR){e=true;break}}if(e){this.HelpSubject="Error occurred in application "+thisMainFrm.Caption();thisSendHelpMail(true)}}if(l){this.MainFrm=null}this.AttRequest=null};DTTEngine.prototype.SetRequestName=function(a,c,b){if(this.AttRequest!=null){this.AttRequest.SetName(a,c,b)}};DTTEngine.prototype.ShowReqErrors=function(){if(this.AttRequest==null){return}if(this.AttRequest.State==DTTEngine.DTTMSG_ERROR){var a=this.MainFrm;var b=false;if(a.UseRD&&a.ParamsObj().UseRD3&&a.ParamsObj().EnableRichTooltip){b=true}else{if(a.AlertMessage().stringValue().length==0){if(a.UseRD&&a.ParamsObj().UseRD3){b=true}else{if(a.UseRD&&!a.ParamsObj().UseRD3&&a.RDStatus==Glb.RD_ACTIVE){b=true}else{if(!a.UseRD){b=true}}}}}if(b){var c="Unexpected error occurred in the last request.\nOpen the debug window for details";if(a.UseRD&&a.ParamsObj().UseRD3&&a.ParamsObj().EnableRichTooltip){if(a.IsMobile()){a.ShowTooltip(c,a.Caption().stringValue(),"",-1,48,2,(this.Requests.Count>=3?0:500),10000,false,-1,-1,"error",false)}else{a.ShowTooltip(c,a.Caption().stringValue(),"header-debug-image",-1,-1,2,(this.Requests.Count>=3?0:500),10000,false,-1,-1,"error",true)}a.SoundAction("play","error")}else{a.set_AlertMessage(new IDVariant(c))}}}};DTTEngine.prototype.EnterProc=function(a,c,d,e,b){if(this.AttRequest!=null){if(!this.AttRequest.EnterProc(a,this)){this.AddItem(DTTEngine.DTTMSG_ERROR,DTTEngine.IT_LOOPDET,a,e,c,"Stack loop",this.MaxStackLoops);return false}this.AttItem=null;this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENTERPROC,a,e,c,d,b);if(this.AttItem!=null&&this.MaskDebugItems(a)){this.AttItem.Visible=false;this.AttItem.ObjName="*";this.AttItem=null}else{var f=this.Procs[a];if(f!=null){if(this.ItemVisible&&!f.Visible){this.ItemVisible=false;this.LevelVisible=this.CurrentIndLevel}if(this.ItemCollect&&!f.Collect){this.ItemCollect=false;this.LevelCollect=this.CurrentIndLevel}}}}this.CurrentIndLevel++;return true};DTTEngine.prototype.ExitProc=function(b,d,a,j,g){if(this.AttRequest!=null){var f=new Date().getTime();this.AttRequest.ExitProc(b);var h=null;var k=this.AttRequest.Items.Count();for(var c=0;c<k;c++){var e=this.AttRequest.Items[c];if(e.ObjGuid.equals(b)&&e.ItemType==DTTEngine.IT_ENTERPROC&&this.CurrentIndLevel-1>=e.IndLevel){if(!e.Visible&&e.ObjName.equals("*")){this.AttRequest.Items.Remove(e);h=e}this.CurrentIndLevel=e.IndLevel;break}}if(!this.ItemVisible&&this.CurrentIndLevel<=this.LevelVisible){this.ItemVisible=true}if(!this.ItemCollect&&this.CurrentIndLevel<=this.LevelCollect){this.ItemCollect=true}if(!this.MaskDebugItems(b)){this.ProfileTicks=new Date().getTime()-f;this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_EXITPROC,b,j,d,a,g);if(h!=null){this.AttItem.TotalTickCount=h.TickCount}}else{this.AttItem=null}}else{this.AttItem=null}this.ProfileTicks=0};DTTEngine.prototype.AddException=function(a,d,h,g,c){if(c==undefined){c=false}if(this.MaskDebugItems(a)){this.MaskGuid="";this.MaskIndLevel=-1}this.AddItem((c?DTTEngine.DTTMSG_WARN:DTTEngine.DTTMSG_ERROR),DTTEngine.IT_EXCEPTION,a,0,d,g.toString());if(g.stack){var f=g.stack.split("\n");for(var b=1;b<f.length;b++){this.AddParameter(this.Guid,"",b+"",f[b])}}WriteToConsoleError(d+": "+h+" - "+g.toString()+(g.stack?"\n"+g.stack:""))};DTTEngine.prototype.AddBreak=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_BREAK,b,0,a,c)}else{this.AttItem=null}};DTTEngine.prototype.AddContinue=function(b,a,e){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_CONTINUE,b,0,a,e)}else{this.AttItem=null}if(this.AttRequest!=null){for(var c=this.AttRequest.Items.Count()-1;c>=0;c--){var d=this.AttRequest.Items[c];if(d.ObjGuid.equals(b)&&(d.ItemType==DTTEngine.IT_WHILE||d.ItemType==DTTEngine.IT_FOREACH||d.ItemType==DTTEngine.IT_FORI)&&this.CurrentIndLevel-1>=d.IndLevel){this.CurrentIndLevel=d.IndLevel+1;break}}}};DTTEngine.prototype.AddError=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_ERROR,DTTEngine.IT_ERROR,b,0,a,c)}else{this.AttItem=null}};DTTEngine.prototype.AddForEach=function(b,a,c){this.AttItem=null;this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_FOREACH,b,0,a,c);if(this.AttItem!=null&&this.MaskDebugItems(b)){this.AttItem.Visible=false;this.AttItem.ObjName="*";this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.AddIMDBDataSource=function(k,g){if(g==undefined){g=null}if(this.AttRequest!=null){var h=null;var j=this.AttRequest.Items.Count();for(var e=0;e<j;e++){h=this.AttRequest.Items[e];if(h.ItemType==DTTEngine.IT_QUERY||h.ItemType==DTTEngine.IT_FOREACH){break}}if(h!=null){if(!this.MaskDebugItems(h.ObjGuid)){var d=new DTTItem();var b=g;if(b==null){b=this.MainFrm.getIMDB()}d.IndLevel=this.CurrentIndLevel;d.ItemType=DTTEngine.IT_IMDBDATASRC;d.MsgType=DTTEngine.DTTMSG_INFO;d.RecordCount=b.TblNumRows(k);d.ObjType=b.TblNumField(k);d.SubItem=new ArrayList();var c=new DTTItem();var l="";for(var f=0;f<b.TblNumField(k);f++){l+=b.FldCode(k,f)+"§"}c.ObjValue=new IDVariant(l);d.SubItem.Add(c);b.TblMoveFirst(k,0);for(var a=1;a<=(b.TblNumRows(k)<this.MaxRecToDump?b.TblNumRows(k):this.MaxRecToDump);a++){c=new DTTItem();l="";for(var f=0;f<b.TblNumField(k);f++){l+=b.Value(k,f,0)+"§"}c.ObjValue=new IDVariant(l);d.SubItem.Add(c);b.TblMoveNext(k,0)}b.TblMoveFirst(k,0);if(h.SubItem==null){h.SubItem=new ArrayList()}h.SubItem.Add(d);if(d.RecordCount>1&&h.ObjType==DTTEngine.STMT_QRY_SELVAR){h.MsgType=DTTEngine.DTTMSG_WARN}}}}else{this.AttItem=null}};DTTEngine.prototype.AddDBDataSource=function(m,d){if(this.AttRequest!=null){var h=null;var k=this.AttRequest.Items.Count();for(var g=0;g<k;g++){h=this.AttRequest.Items[g];if(h.ItemType==DTTEngine.IT_QUERY||h.ItemType==DTTEngine.IT_FOREACH){break}}if(h!=null){if(h.ObjValue.stringValue().equals("")){h.ObjValue=new IDVariant(d)}if(!this.MaskDebugItems(h.ObjGuid)){try{var f=new DTTItem();var n;f.IndLevel=this.CurrentIndLevel;f.ItemType=DTTEngine.IT_DBDATASRC;f.MsgType=DTTEngine.DTTMSG_INFO;f.RecordCount=m.RecordCount();f.ObjType=m.GetNumFields();f.SubItem=new ArrayList();var c=new DTTItem();var l;n="";for(l=1;l<=m.GetNumFields();l++){n+=m.GetName(l)+"§"}c.ObjValue=new IDVariant(n);f.SubItem.Add(c);if(m.RecordCount()>0){m.MoveFirst();for(var a=1;a<=(m.RecordCount()<this.MaxRecToDump?m.RecordCount():this.MaxRecToDump);a++){c=new DTTItem();n="";for(l=1;l<=m.GetNumFields();l++){var b=m.Get(l);if(b.Type==IDVariant.BLOB){n+="BLOB DATA§"}else{n+=b.toString()+"§"}}c.ObjValue=new IDVariant(n);f.SubItem.Add(c);m.MoveNext()}m.MoveFirst()}if(h.SubItem==null){h.SubItem=new ArrayList()}h.SubItem.Add(f);if(f.RecordCount>1&&h.ObjType==DTTEngine.STMT_QRY_SELVAR){h.MsgType=DTTEngine.DTTMSG_WARN}}catch(j){}}}}else{this.AttItem=null}};DTTEngine.prototype.EndForEach=function(b,a,g,f){if(this.AttRequest!=null){var e=this.AttRequest.Items.Count();for(var c=0;c<e;c++){var d=this.AttRequest.Items[c];if(d.ObjGuid.equals(b)&&d.ItemType==DTTEngine.IT_FOREACH&&this.CurrentIndLevel-1>=d.IndLevel){if(!d.Visible&&d.ObjName.equals("*")){this.AttRequest.Items.Remove(d)}this.CurrentIndLevel=d.IndLevel;break}}if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDFOREACH,b,0,a,g,f)}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.AddForI=function(b,a,c){this.AttItem=null;this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_FORI,b,0,a,c);if(this.AttItem!=null&&this.MaskDebugItems(b)){this.AttItem.Visible=false;this.AttItem.ObjName="*";this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.EndForI=function(b,a,g,f){if(this.AttRequest!=null){var e=this.AttRequest.Items.Count();for(var c=0;c<e;c++){var d=this.AttRequest.Items[c];if(d.ObjGuid.equals(b)&&d.ItemType==DTTEngine.IT_FORI&&this.CurrentIndLevel-1>=d.IndLevel){if(!d.Visible&&d.ObjName.equals("*")){this.AttRequest.Items.Remove(d)}this.CurrentIndLevel=d.IndLevel;break}}if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDFORI,b,0,a,g,f)}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.CheckLoop=function(a,e){if(this.AttRequest==null){return true}if(this.LoggedLoops>0&&e>this.LoggedLoops&&(this.MaskIndLevel==-1||this.CurrentIndLevel<this.MaskIndLevel)){this.MaskGuid=a;this.MaskIndLevel=this.CurrentIndLevel}if(this.MaxLoopCycles>0&&e>this.MaxLoopCycles){var f="";var d=this.AttRequest.Items.Count();for(var b=0;b<d;b++){var c=this.AttRequest.Items[b];if(c.IndLevel==this.CurrentIndLevel-1&&c.ObjGuid.equals(a)&&(c.ItemType==DTTEngine.IT_ENDFOREACH||c.ItemType==DTTEngine.IT_ENDWHILE||c.ItemType==DTTEngine.IT_ENDFORI)&&(this.MaskIndLevel==-1||this.CurrentIndLevel<this.MaskIndLevel)){f="STRANO ERRORE"}if(c.IndLevel==this.CurrentIndLevel-1&&c.ObjGuid.equals(a)&&(c.ItemType==DTTEngine.IT_FOREACH||c.ItemType==DTTEngine.IT_WHILE||c.ItemType==DTTEngine.IT_FORI)){this.AddItem(DTTEngine.DTTMSG_ERROR,DTTEngine.IT_LOOPDET,a,0,"",f,e-1);return false}}}if(this.MaskGuid!=a&&e>1){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_MESSAGE,a,199,"Iteration step","-------- End Iteration "+(e-1)+" --------")}return true};DTTEngine.prototype.AddIf=function(b,a,c){this.AttItem=null;this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_IF,b,0,a,c);if(this.AttItem!=null&&this.MaskDebugItems(b)){this.AttItem.Visible=false;this.AttItem.ObjName="*";this.AttItem=null}};DTTEngine.prototype.EnterIf=function(b,a,c){this.CurrentIndLevel++;if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENTERIF,b,0,a,c)}else{this.AttItem=null}};DTTEngine.prototype.EnterElse=function(b,a,d,c){this.CurrentIndLevel++;if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENTERELSE,b,0,a,d)}else{this.AttItem=null}};DTTEngine.prototype.EndIfBlk=function(a){if(this.AttRequest!=null){var d=this.AttRequest.Items.Count();for(var b=0;b<d;b++){var c=this.AttRequest.Items[b];if(c.ObjGuid.equals(a)&&c.ItemType==DTTEngine.IT_IF&&this.CurrentIndLevel>=c.IndLevel){if(!c.Visible&&c.ObjName.equals("*")){this.AttRequest.Items.Remove(c)}this.CurrentIndLevel=c.IndLevel;break}}if(!this.MaskDebugItems(a)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDIF,a,0,"","")}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.AddSwitch=function(b,a,c){this.AttItem=null;this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_SWITCH,b,0,a,c);if(this.AttItem!=null&&this.MaskDebugItems(b)){this.AttItem.Visible=false;this.AttItem.ObjName="*";this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.EnterSwitch=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENTERSWITCH,b,0,a,c)}else{this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.EndSwitchBlk=function(a){if(this.AttRequest!=null){var d=this.AttRequest.Items.Count();for(var b=0;b<d;b++){var c=this.AttRequest.Items[b];if(c.ObjGuid.equals(a)&&c.ItemType==DTTEngine.IT_SWITCH&&this.CurrentIndLevel>=c.IndLevel){if(!c.Visible&&c.ObjName.equals("*")){this.AttRequest.Items.Remove(c)}this.CurrentIndLevel=c.IndLevel;break}}if(!this.MaskDebugItems(a)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDSWITCH,a,0,"","")}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.AddReturn=function(b,a,d,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_RETURN,b,0,a,d,this.AdaptVariant(c))}else{this.AttItem=null}};DTTEngine.prototype.AddWhile=function(b,a,c){this.AttItem=null;this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_WHILE,b,0,a,c);if(this.AttItem!=null&&this.MaskDebugItems(b)){this.AttItem.Visible=false;this.AttItem.ObjName="*";this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.EndWhile=function(b,a,g,f){if(this.AttRequest!=null){var e=this.AttRequest.Items.Count();for(var c=0;c<e;c++){var d=this.AttRequest.Items[c];if(d.ObjGuid.equals(b)&&d.ItemType==DTTEngine.IT_WHILE&&this.CurrentIndLevel-1>=d.IndLevel){if(!d.Visible&&d.ObjName.equals("*")){this.AttRequest.Items.Remove(d)}this.CurrentIndLevel=d.IndLevel;break}}if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDWHILE,b,0,a,g,f)}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.AddToken=function(h,a,j,b,d){if(typeof(d)!="object"){d=new IDVariant(d)}if(!this.MaskDebugItems(h)&&this.AttRequest!=null){var f=this.AttItem;if(h!=null&&!h.equals("")){var g=this.AttRequest.Items.Count();for(var e=0;e<g;e++){f=this.AttRequest.Items[e];if(f.ObjGuid.equals(h)){break}}}if(f!=null){var c=new DTTItem();c.ItemType=DTTEngine.IT_TOKEN;c.IndLevel=this.CurrentIndLevel;c.MsgType=DTTEngine.DTTMSG_INFO;c.ObjGuid=(a==null?"":a);c.ObjName=b;c.ObjType=j;c.ObjValue=this.AdaptVariant(d);if(f.SubItem==null){f.SubItem=new ArrayList()}f.SubItem.Add(c)}}else{this.AttItem=null}};DTTEngine.prototype.AddQuery=function(b,a,d,c,e){if(!this.MaskDebugItems(b)){e=e.Replace("\r\n","");this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_QUERY,b,c,a,d,e)}else{this.AttItem=null}};DTTEngine.prototype.EndQuery=function(a){if(!this.MaskDebugItems(a)&&this.AttRequest!=null){var f=null;var g=this.AttRequest.Items.Count();for(var b=0;b<g;b++){f=this.AttRequest.Items[b];if(f.ObjGuid.equals(a)&&(f.ItemType==DTTEngine.IT_QUERY||f.ItemType==DTTEngine.IT_FOREACH)){break}}var h=0;if(f.ItemType==DTTEngine.IT_QUERY){switch(f.ObjType){case DTTEngine.STMT_QRY_DELETE:h=2000;break;case DTTEngine.STMT_QRY_UPDATE:h=2000;break;case DTTEngine.STMT_QRY_INSVAL:h=400;break;case DTTEngine.STMT_QRY_INSSEL:h=4000;break;case DTTEngine.STMT_QRY_SELVAR:h=400;break;case DTTEngine.STMT_QRY_SELECT:h=4000;break;case DTTEngine.STMT_QRY_SELCOL:h=4000;break}}else{h=4000}g=this.AttRequest.Items.Count();for(var b=0;b<g;b++){var e=this.AttRequest.Items[b];if(e.ItemType==DTTEngine.IT_ENDFOREACH||e.ItemType==DTTEngine.IT_ENDWHILE){break}if(e.ItemType==DTTEngine.IT_FOREACH||e.ItemType==DTTEngine.IT_WHILE){h/=4;break}}var d=this.GetTicks()-f.TickCount;if(d>h){var c=new DTTItem();c.IndLevel=this.CurrentIndLevel;c.ItemType=DTTEngine.IT_ENDQUERY;c.MsgType=DTTEngine.DTTMSG_WARN;c.ObjDescription="The query took too much: "+d+" ms";c.ObjValue=new IDVariant(d);f.MsgType=DTTEngine.DTTMSG_WARN;if(f.SubItem==null){f.SubItem=new ArrayList()}f.SubItem.Add(c)}}else{this.AttItem=null}};DTTEngine.prototype.AddSubProc=function(a,b,c){if(!this.MaskDebugItems(a)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_SUBPROC,a,0,b,c)}else{this.AttItem=null}};DTTEngine.prototype.AddParameter=function(f,b,d,e){if(e==undefined){e=new IDVariant(e)}if(!this.MaskDebugItems(f)&&this.AttRequest!=null){var g=this.AttItem;if(f!=null&&!f.equals("")){var h=this.AttRequest.Items.Count();for(var c=0;c<h;c++){g=this.AttRequest.Items[c];if(g.ObjGuid.equals(f)){break}}}if(g!=null){var a=new DTTItem();a.IndLevel=this.CurrentIndLevel;a.ItemType=DTTEngine.IT_PARAMETER;a.MsgType=DTTEngine.DTTMSG_INFO;a.ObjGuid=(b==null?"":b);a.ObjName=d;a.ObjType=0;a.ObjValue=this.AdaptVariant(e);if(g.SubItem==null){g.SubItem=new ArrayList()}g.SubItem.Add(a)}}else{this.AttItem=null}};DTTEngine.prototype.AddAssign=function(b,a,d,c){if(typeof(c)!="object"){c=new IDVariant(c)}if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ASSIGN,b,0,a,d,c)}else{this.AttItem=null}};DTTEngine.prototype.AddAssignNewValue=function(a,e,g){if(!this.MaskDebugItems(a)&&this.AttRequest!=null){var c=null;var f=this.AttRequest.Items.Count();for(var b=0;b<f;b++){c=this.AttRequest.Items[b];if(c.ObjGuid.equals(a)&&c.ItemType==DTTEngine.IT_ASSIGN){break}}if(c!=null){var d=new DTTItem();d.IndLevel=this.CurrentIndLevel;d.ItemType=DTTEngine.IT_PARAMETER;d.MsgType=0;d.ObjGuid=(e==null?"":e);d.ObjValue=this.AdaptVariant(g);if(c.SubItem==null){c.SubItem=new ArrayList()}c.SubItem.Add(d)}}else{this.AttItem=null}};DTTEngine.prototype.AdaptVariant=function(b){if(b==null){return new IDVariant("Null")}if(b instanceof IDVariant){if(b.Type==IDVariant.NULL){return new IDVariant("Null")}if(b.Type==IDVariant.BLOB){return new IDVariant("BLOB")}if(b.Type==IDVariant.DATETIME){var d;var c=b.Value;var e=IDVariant.DefaultDateMask.replace("MM","mm");if(c.getFullYear()==1899&&(c.getMonth()+1)==12&&c.getDate()==30){d="hh:nn:ss"}else{if(c.getHours()==0&&c.getMinutes()==0&&c.getSeconds()==0){d=e}else{d=e+" hh:nn:ss"}}return IDL.FormatDate(c,d)}return new IDVariant(b)}if(b instanceof IDDocument){return new IDVariant(b.GetClass().GetClassName())}if(b instanceof Object&&b.toString){return new IDVariant(b.toString())}if(b instanceof Object&&b.constructor&&b.constructor.toString){var a=b.constructor.toString().match(/function\s*(\w+)/);if(a&&a.length==2){return new IDVariant(a[1])}}return new IDVariant(b+"")};DTTEngine.prototype.ParseCommand=function(k,m){var d;var j="";var b=k.indexOf(" ");if(b==-1){d=k}else{d=k.substr(0,b).trim();j=k.substr(b+1).trim()}d=d.toUpperCase();var a=j;j=j.toUpperCase();if(d.equals("SM")){this.HiddenMessages.Clear();return"All messages shown"}else{if(d.equals("RB")){var o;if(j.equals("")){this.BreakPoints.Clear();o="All breakpoints removed"}else{o="Breakpoint "+j+" not found";for(var n=0;n<this.BreakPoints.length;n++){if(this.BreakPoints[n].equals(j)){this.BreakPoints.RemoveAt(n);o="Breakpoint "+j+" removed";break}}}for(var g=0;g<this.Requests.length;g++){var l=this.Requests[g];l.HasBP(m,true)}return o}else{if(d.equals("AB")){if(j.equals("")){return"Invalid breakpoint"}else{if(this.BreakPoints.Count()>7){return"Too many breakpoints (max 8)"}else{for(var n=0;n<this.BreakPoints.length;n++){if(this.BreakPoints[n].equals(j)){return""}}this.BreakPoints.Add(j);for(var g=0;g<this.Requests.length;g++){var l=this.Requests[g];l.HasBP(m,true)}return"Breakpoint "+j+" added"}}}else{if(d.equals("HM")){try{var f=parseInt(j,10);if(f>0&&f<1000){this.HiddenMessages.Add(f);return"message #"+j+" hidden"}else{return"Invalid message number"}}catch(h){return"Invalid message number"}}else{if(d.equals("SS")){if(!a.equals(m.Request.SESSNAME)){return"<SCRIPT>sendToApplication('IWDTT', '', '', '' , null, '"+a+"');</SCRIPT>"}else{return"Session debug already open"}}else{return k+" not recognized"}}}}}};DTTEngine.prototype.IsMsgHidden=function(b){for(var a=0;a<this.HiddenMessages.length;a++){if(this.HiddenMessages[a]==b){return true}}return false};DTTEngine.prototype.HideMessage=function(b){for(var a=0;a<this.HiddenMessages.length;a++){if(this.HiddenMessages[a]==b){return}}this.HiddenMessages.Add(b)};DTTEngine.prototype.CompactRequests=function(){if(this.Requests.Count()>this.RequestsToPassive){var b=null;var c=null;for(var a=0;a<this.Requests.length;a++){var d=this.Requests[a];if(b==null&&d.Condition==DTTRequest.REQ_ACTIVE){b=d;if(Requests.Count()<=this.RequestsToPerm){break}}if(c==null&&Requests.Count()>thisRequestsToPerm&&d.Condition==DTTRequest.REQ_PASSIVE){c=d}}if(b!=null){this.MoveReqToPassive(b)}if(c!=null){this.MoveReqToPermanent(c)}}};DTTEngine.prototype.MoveReqToPassive=function(c){c.Condition=DTTRequest.REQ_PASSIVE;var b=new ArrayList();var d=c.Items.length;for(itemi=0;itemi<d;itemi++){var a=c.Items[itemi];var e=false;if(a.ItemType==DTTEngine.IT_MESSAGE){e=(a.MsgType>this.PassiveMsgLevel)}else{if(a.ItemType==DTTEngine.IT_TRACE){e=!this.PassiveTraceEnabled}else{e=(a.Level()>this.PassiveLevel)}}if(!e){b.Add(a)}}c.Items=b};DTTEngine.prototype.MoveReqToPermanent=function(b){this.Requests.Remove(b);if(this.DB!=null&&this.Enabled&&this.PermSaveToDB){try{this.MainFrm.OpenConnection(this.DB);this.DB.BeginTrans();this.CreateSession();b.SaveToDB(this);this.DB.CommitTrans()}catch(c){WriteToConsoleError("[DTTEngine.MoveReqToPermanent] Exception: "+c);try{this.DB.RollbackTrans()}catch(a){}}}};DTTEngine.prototype.PrepareSQLcommands=function(){};DTTEngine.prototype.CreateSession=function(){if(this.SessionID==0){this.SQLSessInsert.ClearParameters();if(this.Requests.Count()==0){this.SQLSessInsert.AddParameter(IDL.Now())}else{this.SQLSessInsert.AddParameter(new IDVariant(this.Requests[0].StartTime))}if(this.Name.equals("")){this.SQLSessInsert.AddParameter(new IDVariant())}else{this.SQLSessInsert.AddParameter(new IDVariant(this.Name.length>50?this.Name.substr(0,50):this.Name))}this.SQLSessInsert.AddParameter(new IDVariant(this.UserID));if(this.Description.equals("")){this.SQLSessInsert.AddParameter(new IDVariant())}else{this.SQLSessInsert.AddParameter(new IDVariant(this.Description.length>250?this.Description.substr(0,250):this.Description))}var a=this.MainFrm;this.SQLSessInsert.AddParameter(new IDVariant(a.HostName().length>100?a.HostName().substr(0,100):a.HostName()));this.MainFrm.OpenConnection(this.DB);this.DB.ExecuteIDPS(this.SQLSessInsert,false);var b=this.DB.ExecuteIDPS(this.SQLGetSessID,true);if(!b.EOF()){b.MoveFirst()}this.SessionID=b.Get(1).intValue()}};DTTEngine.prototype.SaveSession=function(a,g,h){var c="";var d="";var k;this.EndRequest(false);try{if(a||h){c=this.TakeSnapshot(a,h);if(h){d=c}}if(g){var b=this.Requests.length;for(var f=0;f<b;f++){k=this.Requests[f];if(k.Condition==DTTRequest.REQ_ACTIVE){this.MoveReqToPassive(k)}}if(!a){while(this.Requests.Count()>0){this.MoveReqToPermanent(this.Requests[0])}}else{this.Requests.Clear()}if(this.DB!=null&&this.SessionID!=0){var l=this.MainFrm;this.SQLSessUpdate.ClearParameters();this.SQLSessUpdate.AddParameter(IDL.Now());if(this.Name.length==0){this.SQLSessUpdate.AddParameter(new IDVariant("[Empty]"))}else{this.SQLSessUpdate.AddParameter(new IDVariant(this.Name.length>50?this.Name.substr(0,50):this.Name))}this.SQLSessUpdate.AddParameter(new IDVariant(this.UserID));if(this.Description.length==0){this.SQLSessUpdate.AddParameter(new IDVariant())}else{this.SQLSessUpdate.AddParameter(new IDVariant(this.Description.length>250?this.Description.substr(0,250):this.Description))}this.SQLSessUpdate.AddParameter(new IDVariant(l.HostName().length>100?l.HostName().substr(0,100):l.HostName()));if(this.TestRunning){this.SQLSessUpdate.AddParameter(new IDVariant(this.SessionTestSrcID))}else{this.SQLSessUpdate.AddParameter(new IDVariant())}this.SQLSessUpdate.AddParameter(new IDVariant(this.SessionID));this.MainFrm.OpenConnection(this.DB);this.DB.ExecuteIDPS(this.SQLSessUpdate,false)}}}catch(j){WriteToConsoleError("[DTTEngine.SaveSession] Exception while saving current session: "+j)}this.MainFrm=null;return d};DTTEngine.prototype.EndSession=function(a,b){if(b==undefined){b=true}this.MainFrm=a;if(this.RecordRunning||this.TestRunning){this.SaveSession(b,true,false);if(this.DB!=null&&this.TestRunning){this.UpdateFlags()}}if(this.TraceEnabled&&this.PermSaveToDB){while(this.Requests.Count()>0){var c=this.Requests[0];if(c.Condition==DTTRequest.REQ_ACTIVE){this.MoveReqToPassive(c)}this.MoveReqToPermanent(c)}if(this.DB!=null&&this.SessionID!=0){try{this.SQLSessUpdate.ClearParameters();this.SQLSessUpdate.AddParameter(IDL.Now());this.SQLSessUpdate.AddParameter(new IDVariant(this.Name.length==0?"[Empty]":(this.Name.length>50?this.Name.substr(0,50):Name)));this.SQLSessUpdate.AddParameter(new IDVariant(this.UserID));this.SQLSessUpdate.AddParameter(new IDVariant(this.Description.length==0?null:(this.Description.length>250?this.Description.substr(0,250):this.Description)));this.SQLSessUpdate.AddParameter(new IDVariant(a.HostName().length>100?a.HostName().substr(0,100):a.HostName()));this.SQLSessUpdate.AddParameter(new IDVariant());this.SQLSessUpdate.AddParameter(new IDVariant(this.SessionID));this.MainFrm.OpenConnection(this.DB);this.DB.ExecuteIDPS(this.SQLSessUpdate,false)}catch(d){WriteToConsoleError("[DTTEngine::EndSession] Can't update the DTT Trace session (ID="+this.SessionID+"): "+d.message)}}}this.MainFrm=null;this.TestRunning=false};DTTEngine.prototype.UpdateFlags=function(){};DTTEngine.prototype.LoadFromDB=function(c,h,g){if(h==undefined){h=true}if(g==undefined){g=true}try{if(g){var d="select SessID, SessSnapshot from DTTSessions where SessID = "+c;var b=new IDPreparedStatement(true);b.SetCommand(this.SQL);this.MainFrm.OpenConnection(this.DB);var m=this.DB.ExecuteIDPS(b,true);if(!m.EOF()){m.MoveFirst()}var l=this.MainFrm;var a=Glb.SaveBlob(l,m.Get(2)).stringValue();if(a.length>0){this.LoadSnapshot(a);this.SessionID=c;b.SetCommand("select SessName, SessDescr from DTTSessions where SessID = "+c);m=this.DB.ExecuteIDPS(b,true);if(!m.EOF()){m.MoveFirst()}this.Name=(m.Get(1).Type==IDVariant.NULL?"[Empty]":m.Get(1).stringValue());this.Description=m.Get(2).stringValue();return true}}this.Requests.Clear();this.AttID=0;this.Name="";this.UserID=0;this.Description="";this.SQLSessLoad.ClearParameters();this.SQLSessLoad.AddParameter(new IDVariant(c));this.MainFrm.OpenConnection(this.DB);var k=this.DB.ExecuteIDPS(this.SQLSessLoad,true);if(!k.EOF()){k.MoveFirst()}this.Name=k.Get(1).stringValue();this.UserID=k.Get(2).intValue();this.Description=k.Get(3).stringValue();this.SQLReqLoad.ClearParameters();this.SQLReqLoad.AddParameter(new IDVariant(c));var n=this.DB.ExecuteIDPS(this.SQLReqLoad,true);if(!n.EOF()){n.MoveFirst()}var j;while(!n.EOF()){j=new DTTRequest();j.LoadFromDB(this,n);this.AttID++;this.Requests.Add(j);n.MoveNext()}this.AttID++;this.Enabled=false;this.ShowLevel=DTTEngine.LEV_STATEM;this.ShowMsgLevel=DTTEngine.DTTMSG_INFO;return true}catch(f){WriteToConsoleError("[DTTEngine.LoadFromDB] Exception while loading session from DB: "+f);return false}};DTTEngine.prototype.TakeSnapshot=function(g,h,a){if(a==undefined){a=false}var c="";try{var d=new ProXMLDocument();var m=d.CreateElement("Session");d.AppendChild(m);if(this.Requests.Count()==0){m.SetAttribute("StartTime",IDL.Now().stringValue())}else{m.SetAttribute("StartTime",this.Requests[0].StartTime.toString())}if(!this.Name.equals("")){m.SetAttribute("Name",this.Name)}m.SetAttribute("UserID",this.UserID+"");if(!this.Description.equals("")){m.SetAttribute("Description",this.Description)}m.SetAttribute("HostName",this.MainFrm.HostName());var b=this.Requests.length;for(var f=0;f<b;f++){var l=this.Requests[f];l.TakeSnapshot(d,m)}var k=this.FixedDebugFile;if((h||g)&&k.length==0){while(true){c="XML"+(Math.floor(Math.random()*2147483647))+(a?".zip":".xml");k=this.MainFrm.TempPath()+"/"+c}}if(a){}else{d.Save(k)}if(g&&this.SessionID==0){this.CreateSession()}if(g&&this.SessionID!=-1){var n=new IDCachedRowSet();this.MainFrm.OpenConnection(this.DB);n.setCommand("select SessID, SessSnapshot from DTTSessions where SessID = "+this.SessionID);n.setUpdatable();n.execute(new ArrayList(),this.DB);if(!n.EOF()){n.MoveFirst()}n.setTableName("DTTSessions");Glb.LoadBlob(this.MainFrm,n,2,k,this.DB)}if(!h){c=""}else{c="temp/"+c}return c}catch(j){WriteToConsoleError("[DTTEngine.TakeSnapshot] Exception while taking snapshot: "+j);return""}};DTTEngine.prototype.CompressStream=function(c,b,a){};DTTEngine.prototype.LoadSnapshot=function(a){try{var b=new ProXMLDocument();b.Load(a);this.Requests.Clear();this.AttID=0;this.Name="";this.UserID=0;this.Description="";var g=null;for(var c=0;c<b.ChildNodes.length;c++){g=b.ChildNodes[c];if(g.NodeType==1){break}}if(g==null){return}this.Name=g.GetAttribute("Name");this.UserID=new IDVariant(g.GetAttribute("UserID")).intValue();this.Description=g.GetAttribute("Description");for(var c=0;c<g.ChildNodes.length;c++){var h=g.ChildNodes[c];if(h.NodeType==1){var d=new DTTRequest();d.LoadSnapshot(h);this.AttID++;d.ID=this.AttID;this.Requests.Add(d)}}this.AttID++;this.Enabled=false;this.ShowLevel=DTTEngine.LEV_STATEM;this.ShowMsgLevel=DTTEngine.DTTMSG_INFO}catch(f){WriteToConsoleError("[DTTEngine.LoadSnapshot] Exception while loading snapshot: "+f)}};DTTEngine.prototype.CanSendHelpMail=function(b){var c=true;if(b){if(this.LastSentReqID!=-1){var a=(this.Requests.Count()>this.RequestsToPassive?this.RequestsToPassive:this.Requests.Count());c=((this.AttID-this.LastSentReqID)>a/2)}}else{if(this.LastSentTime.getTime()!=0){c=(new Date().getTime()-LastSentTime.getTime())>5*60*1000}}return c};DTTEngine.prototype.SendHelpMail=function(f){if(f==undefined){f=false}var k=new IDVariant(false);var c;var h="";var j=this.MainFrm;try{if(!this.CanSendHelpMail(f)){return false}h=j.RealPath+"/"+this.TakeSnapshot(false,true);if(this.HelpSubject.equals("")){this.HelpSubject=IDL.FormatMessage(new IDVariant(j.RTCObj.GetConst("6EADA0F9-2C85-40F5-9E49-EA399BA28F97","Help request from |1")),new IDVariant(this.HelpName)).stringValue()}if(this.HelpDescription.equals("")){this.HelpDescription=this.Description}c=new IDMailer();if(!this.HelpSMTPServer.equals("")){c.SetRelayServer(this.HelpSMTPServer,this.HelpSMTPUsername,this.HelpSMTPPassword)}if(!this.HelpAddress.equals("")){c.AddToAddress(this.HelpAddress)}if(!this.HelpReplyTo.equals("")){c.FromAddress=this.HelpReplyTo;c.AddReplyToAddress(this.HelpReplyTo)}else{var b=j.Caption().stringValue().toLowerCase();for(var d=0;d<b.length;d++){if(!((b.charCodeAt(d)>=32+65&&b.charCodeAt(d)<=32+90)||(b.charCodeAt(d)>=48&&b.charCodeAt(d)<=57))){b=b.substring(0,d)+String.fromCharCode(32)+b.substring(d+1)}}b="dtt@"+b.Replace(" ","")+".com";c.FromAddress=b}if(!this.HelpSubject.equals("")){c.Subject=this.HelpSubject}var l;var a="\r\n";l="Session data: "+a;l+=("   Session ID : "+this.SessionID+a);l+=("   Session Name : "+this.Name+a);l+=("   Session Description : "+this.Description+a);l+=("   Session User ID : "+this.UserID+a);l+=("   Session Host Address : "+j.HostName()+a);l+=("------------------------------------------------------------------------"+a+a);if(f){l+=(j.RTCObj.GetConst("A29A4CF5-CA86-4F41-9DA8-D3E6A65A7637","This e-mail has been automatically sent because an error occurred")+a+a)}else{l+=(IDL.FormatMessage(new IDVariant(j.RTCObj.GetConst("74E56F3B-E786-40DE-9D78-34B192302EF3","The user |1 is requesting help. Please call |2")),new IDVariant(this.HelpName),new IDVariant(this.HelpRecallTo))+a+a)}l+=("------------------------------------------------------------------------"+a);l+=this.HelpDescription;c.Body=l;c.AddAttachment(h);j.OnSendHelpMail(c,new IDVariant(f),k);if(k.isTrue()){return false}c.SendMail();this.LastSentReqID=this.AttID;this.LastSentTime=new Date();if(!f){j.set_AlertMessage(new IDVariant(j.RTCObj.GetConst("46197C41-9EBF-460D-BECE-509C9401476F","La richiesta di aiuto è stata inoltrata con successo.")))}return true}catch(g){if(!f){j.set_AlertMessage(IDL.FormatMessage(new IDVariant(j.RTCObj.GetConst("474DFD5B-6AAA-4D65-A017-DED22B940B83","La richiesta di aiuto non è stata inoltrata. Contattare il servizio di assistenza (|1 - |2)")),new IDVariant(-1),new IDVariant(g.message)))}return false}};DTTEngine.prototype.GetDTTID=function(a,b){if(b==undefined){b=new IDVariant("")}if(typeof(b)!="object"){b=new IDVariant(b)}if(this.TestEnabled){return"id='"+this.Guid+(!b.stringValue().equals("")?"-"+b.stringValue():"")+"' "}else{return""}};DTTEngine.prototype.RenderTest=function(a,b){};DTTEngine.prototype.RenderTestCode=function(a){};DTTEngine.prototype.RenderHelp=function(a,b){};DTTEngine.prototype.CheckDiff=function(a,b,d){this.MainFrm=a;this.RefDTTObj=new DTTEngine();this.RefDTTObj.Init(0,0,false,false,false,a);this.RefDTTObj.InitDB(this.DB,this.DBClass);this.RefDTTObj.AddRequest(a);var c=RefDTTObj.LoadFromDB(d);this.RefDTTObj.EndRequest();var e=this.LoadFromDB(b);if(!e||!c){RefDTTObj=null;a.WriteStrDbgMain("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");a.WriteStrDbgMain("<link rel=stylesheet type='text/css' href='dtt.css'></head>");a.WriteStrDbgMain("<body>");if(!c){a.WriteStrDbgMain("<b>Session "+d+" not found.</b><br>")}if(!e){a.WriteStrDbgMain("<b>Session "+b+" not found.</b><br>")}a.WriteStrDbgMain("</body></html>");this.MainFrm=null;return}this.ComputeDiff(RefDTTObj,this);this.Render(a,"");this.MainFrm=null};DTTEngine.prototype.ComputeDiff=function(b,f){var d;var c;var e=f.Requests.length;for(var a=0;a<e;a++){d=f.Requests[a];c=this.RefSess.GetRequest(d.ID+"");if(c!=null){d.CheckDiff(c)}}};DTTEngine.prototype.DumpGUIDsToFile=function(b,a){};DTTEngine.prototype.SetHelpSrc=function(a){if(this.AttRequest!=null){this.AttRequest.HelpHTML=a}};DTTEngine.prototype.ProcCommand=function(h,b){var k=h.substr(0,3);var e=h.substr(3,36);var j=this.Procs[e];if(j==null){j=new DTTItem();j.Collect=true;j.Visible=true;j.ObjGuid=e;this.Procs[e]=j}if(k.equals("VIS")){j.Visible=!j.Visible}if(k.equals("COL")){j.Collect=!j.Collect}this.SaveProcs(b);var f=this.Requests.length;for(var a=0;a<f;a++){var d=this.Requests[a];d.ProcCommand(h,this.Procs)}};DTTEngine.prototype.SaveProcs=function(a){};DTTEngine.prototype.LoadProcs=function(a){};DTTEngine.prototype.ResetProcs=function(c){var e=this.Procs.length;for(var a=0;a<e;a++){var g=this.Procs[a];if(!g.Visible){g.Visible=true;var f=this.Requests.length;for(var b=0;b<f;b++){var d=this.Requests[b];d.ProcCommand("VIS"+g.ObjGuid,this.Procs)}}if(!g.Collect){g.Collect=true;var f=this.Requests.length;for(var b=0;b<f;b++){var d=this.Requests[b];d.ProcCommand("COL"+g.ObjGuid,this.Procs)}}}this.Procs.Clear();this.SaveProcs(c)};DTTEngine.prototype.IsEmptyRequest=function(){if(this.AttRequest!=null){return this.AttRequest.Items.Count()==0}else{return true}};DTTEngine.prototype.IsTouch=function(){if(this.isTouch==undefined){if(!RD4_WebEntryPoint){this.isTouch=false}else{if(RD4_WebEntryPoint.BrowserInfo()<5){this.isTouch=false}else{if(RD4_WebEntryPoint.Request&&RD4_WebEntryPoint.Request.Headers.Referer&&RD4_WebEntryPoint.Request.Headers.Referer.length>0){this.isTouch=false}else{this.isTouch=(RD4_WebEntryPoint.BrowserInfo()>=5)}}}}return this.isTouch};function DTTHelpItem(){this.x=160;this.y=20;this.w=200;this.h=100;this.Delay=3;this.Text="";this.Hide=false}DTTHelpItem.prototype.TakeSnapshot=function(b,d,c){var a=b.CreateElement(c);d.AppendChild(a);a.SetAttribute("Left",this.x+"");a.SetAttribute("Top",this.y+"");a.SetAttribute("Width",this.w+"");a.SetAttribute("Height",this.h+"");a.SetAttribute("Text",this.Text);a.SetAttribute("Delay",this.Delay+"");a.SetAttribute("Hide",(this.Hide?"-1":"0"))};DTTHelpItem.prototype.LoadSnapshot=function(a){this.x=new IDVariant(a.GetAttribute("Left")).intValue();this.y=new IDVariant(a.GetAttribute("Top")).intValue();this.w=new IDVariant(a.GetAttribute("Width")).intValue();this.h=new IDVariant(a.GetAttribute("Height")).intValue();this.Text=a.GetAttribute("Text");this.Delay=new IDVariant(a.GetAttribute("Delay")).dblValue();this.Hide=new IDVariant(a.GetAttribute("Hide")).booleanValue()};function DTTItem(){this.IndLevel;this.MsgType;this.ItemType;this.ObjGuid="";this.ObjType;this.ObjName="";this.ObjDescription="";this.ObjValue=new IDVariant();this.RecordCount;this.TickCount;this.NumOpenDiv=0;this.Visible=true;this.Collect=true;this.TotalTickCount=0;this.NetTickCount=0;this.TotalNetTickCount=0;this.ForceCbp=-1;this.ItemID;this.SubItem;this.HelpItem=null}DTTItem.prototype.RenderDots=function(c,e,a,f,b){var d=this.IndLevel;if(this.ItemType==DTTEngine.IT_ENTERELSE){d--}var g=(a*(d-1)+4);c.WriteStrDbgReqRef("<div class='ItemList'><img align='absmiddle' src='dttimg/empty.gif'>");c.WriteStrDbgReqRef("<span style='width:"+(g+(f?78:0))+"px;display:inline-block'></span>");c.WriteStrDbgReqRef("<a href='javascript:"+c.UrlForDTT(Glb.ITEM_DTT,"EXPIT"+e+"REF"+b)+"' title='click to expand'>");c.WriteStrDbgReqRef("<img align='absmiddle' src='dttimg/dot.gif'>");c.WriteStrDbgReqRef("</a></div>")};DTTItem.prototype.Render=function(q,l,h,s,f,m,b,a,c,g,t){var e="";var o;var r;var j;var d=false;var k=false;this.NumOpenDiv=t;if(this.ItemType==DTTEngine.IT_NULL&&this.IndLevel==-999){return t}if(g!=null){d=g.ItemType==DTTEngine.IT_ENTERIF}if(this.ItemType==DTTEngine.IT_ENTERPROC||(this.ItemType==DTTEngine.IT_IF&&d)||this.ItemType==DTTEngine.IT_ENTERELSE||this.ItemType==DTTEngine.IT_FOREACH||this.ItemType==DTTEngine.IT_WHILE||this.ItemType==DTTEngine.IT_FORI||this.ItemType==DTTEngine.IT_SWITCH){k=true;t++}if(this.ItemType==DTTEngine.IT_ENTERIF){f.set(new IDVariant("enter.gif"));return t}o=this.IndLevel;if(this.ItemType==DTTEngine.IT_ENTERELSE){o--}r=(s*(o-1)+4);if(!f.toString().equals("")){r=r-16;if(r<0){r=0}}if(this.ForceCbp==-1){j=this.FindBP(q,this)}else{j=this.ForceCbp}e=this.GetNote(a);if(h>0&&((this.ItemType==DTTEngine.IT_ENTERPROC&&this.IndLevel==1)||(this.ItemType==DTTEngine.IT_NULL&&this.IndLevel==-1))){q.WriteStrDbgReqRef("<hr noshade color='gray' size=1px>")}if(!a){q.WriteStrDbgReqRef("<div id=dblk"+h+" class='"+this.GetItemClass()+"' style='"+(!e.equals("")?"border-left-color:blue;":"")+(j!=0?"background-color:"+this.Colors(j)+";":"")+"'>");if(m){q.WriteStrDbgReqRef("<span class='ItemTime' style='width:40px'>"+this.TickCount+"</span>");q.WriteStrDbgReqRef("<span class='ItemTime' style='width:40px'>");if(this.TickCount-b.intValue()>100){q.WriteStrDbgReqRef("("+(this.TickCount-b.intValue())+")")}q.WriteStrDbgReqRef("&nbsp;&nbsp;</span>");b.set(new IDVariant(this.TickCount))}if(!e.equals("")){q.WriteStrDbgReqRef("<a href='javascript:dt(\"it"+h+"\")'>")}if(this.MsgType==DTTEngine.DTTMSG_WARN||this.MsgType==DTTEngine.DTTMSG_ERROR){q.WriteStrDbgReqRef("<img name='"+(this.MsgType==DTTEngine.DTTMSG_WARN?"warn":"stop")+"' align='absmiddle' src='dttimg/"+this.GetIcon()+"'>")}else{q.WriteStrDbgReqRef("<img "+(j!=0?"name='brkpt' ":"")+"align='absmiddle' src='dttimg/"+this.GetIcon()+"'>")}if(!e.equals("")){q.WriteStrDbgReqRef("</a>")}q.WriteStrDbgReqRef("<span style='width:"+r+"px;display:inline-block'></span>");if(!f.toString().equals("")){q.WriteStrDbgReqRef("<img align='absmiddle' src='dttimg/"+f.toString()+"'>");f.set(new IDVariant(""))}if(!this.ObjGuid.equals("")&&!q.DTTObj.IsTouch()){q.WriteStrDbgReqRef("<a href='pgid://"+this.ObjGuid+"'>")}q.WriteStrDbgReqRef("<img "+(this.ItemType==DTTEngine.IT_ENTERPROC?"name='proc"+this.ObjGuid+"'":"")+" align='absmiddle' src='dttimg/"+this.GetObjIcon()+"'>");if(!this.ObjGuid.equals("")){q.WriteStrDbgReqRef("</a>")}if(k){q.WriteStrDbgReqRef("<img id=tblk"+h+l+" style='cursor:hand' onclick='de(\"blk"+h+"\");' align='absmiddle' src='dttimg/cmp.gif'>")}q.WriteStrDbgReqRef("&nbsp;<span title='"+this.GetTitle()+"'>"+this.GetName()+"</span></div>");if(!e.equals("")){q.WriteStrDbgReqRef("<div id='it"+h+l+"' style='left:"+(42+(s*(o-1))+(m?78:0))+"px' class='ItemNote'>");q.WriteStrDbgReqRef("<table cellpadding=1 cellspacing=0 class='NoteTbl'>"+e+"</table></div>")}}else{q.WriteStrDbgReqRef("<div class='ItemList' style='"+(j!=0?"background-color:"+this.Colors(j)+";":"")+"'>");q.WriteStrDbgReqRef("<img align='absmiddle' src='dttimg/empty.gif'></div>");if(!e.equals("")){q.WriteStrDbgReqRef("<div id='it"+h+l+"' style='left:"+(42+(s*(o-1))+(m?78:0))+"px' class='ItemNote'>");q.WriteStrDbgReqRef("<table cellpadding=1 cellspacing=0 class='NoteTbl' style='background-color:white;color:white'>"+e+"</table></div>")}}if(k){q.WriteStrDbgReqRef("<div id='blk"+h+l+"' style='display:block'>")}if(this.ItemType==DTTEngine.IT_ENTERELSE||this.ItemType==DTTEngine.IT_ENTERSWITCH){f.set(new IDVariant("enter.gif"))}return t};DTTItem.prototype.GetIcon=function(){switch(this.MsgType){case DTTEngine.DTTMSG_INFO:case DTTEngine.DTTMSG_VERB:return"info.gif";case DTTEngine.DTTMSG_ERROR:return"stop.gif";case DTTEngine.DTTMSG_WARN:return"warn.gif"}return""};DTTItem.prototype.GetObjIcon=function(){switch(this.ItemType){case DTTEngine.IT_LOOPDET:return"loopdet.gif";case DTTEngine.IT_ENTERPROC:switch(this.ObjType){case DTTEngine.PT_EVENT:return"event.gif";case DTTEngine.PT_EVENT_RECUR:return"event_recur.gif";case DTTEngine.PT_FUNCTION:return"funct.gif";case DTTEngine.PT_PROCEDURE:return"proc.gif";case DTTEngine.PT_PROC_ITEM:return"stmt.gif"}break;case DTTEngine.IT_EXITPROC:return"exit.gif";case DTTEngine.IT_IF:return"if.gif";case DTTEngine.IT_ENTERIF:return"enter.gif";case DTTEngine.IT_ENTERELSE:return"else.gif";case DTTEngine.IT_ENDIF:return"exit.gif";case DTTEngine.IT_ASSIGN:return"assign.gif";case DTTEngine.IT_ERROR:return"error.gif";case DTTEngine.IT_BREAK:return"break.gif";case DTTEngine.IT_CONTINUE:return"cont.gif";case DTTEngine.IT_EXCEPTION:return"stop.gif";case DTTEngine.IT_RETURN:return"return.gif";case DTTEngine.IT_SUBPROC:return"stmt.gif";case DTTEngine.IT_FOREACH:return"loop.gif";case DTTEngine.IT_ENDFOREACH:return"exit.gif";case DTTEngine.IT_DBDATASRC:return"query.gif";case DTTEngine.IT_IMDBDATASRC:return"query.gif";case DTTEngine.IT_WHILE:return"loop.gif";case DTTEngine.IT_ENDWHILE:return"exit.gif";case DTTEngine.IT_FORI:return"fori.gif";case DTTEngine.IT_ENDFORI:return"exit.gif";case DTTEngine.IT_SWITCH:return"switch.gif";case DTTEngine.IT_ENTERSWITCH:return"case.gif";case DTTEngine.IT_ENDSWITCH:return"exit.gif";case DTTEngine.IT_QUERY:switch(this.ObjType){case DTTEngine.STMT_QRY_DELETE:return"qrydel.gif";case DTTEngine.STMT_QRY_UPDATE:return"qryupd.gif";case DTTEngine.STMT_QRY_INSVAL:return"insval.gif";case DTTEngine.STMT_QRY_INSSEL:return"insrow.gif";case DTTEngine.STMT_QRY_SELVAR:return"selvar.gif";case DTTEngine.STMT_QRY_SELECT:return"query.gif";case DTTEngine.STMT_QRY_SELCOL:return"query.gif"}break;case DTTEngine.IT_ENDQUERY:return"query.gif";case DTTEngine.IT_MESSAGE:return"msg.gif";case DTTEngine.IT_USER:return"user.gif";case DTTEngine.IT_TRACE:switch(this.ObjType){case DTTEngine.TRC_ITMAIN:return"cliapp.gif";case DTTEngine.TRC_ITFORM:return"form.gif";case DTTEngine.TRC_ITFRAME:return"trace.gif";case DTTEngine.TRC_ITPANEL:return"panel.gif";case DTTEngine.TRC_ITTREE:return"tree.gif";case DTTEngine.TRC_ITTABBED:return"tabbed.gif";case DTTEngine.TRC_ITCOMMAND:return"command.gif";case DTTEngine.TRC_ITMENU:return"cmdset.gif";case DTTEngine.TRC_ITTOOLBAR:return"cmdset.gif";case DTTEngine.TRC_ITBUTBAR:return"cmdset.gif";case DTTEngine.TRC_ITCAPTBAR:return"cmdset.gif";case DTTEngine.TRC_ITERROR:return"warn.gif"}break}return""};DTTItem.prototype.GetName=function(d){if(d==undefined){d=false}var c="";var a="";var e=null;switch(this.ItemType){case DTTEngine.IT_LOOPDET:return"LOOP DETECTED (BREAK after "+this.ObjValue.ToString()+" loops - "+this.ObjDescription+")";case DTTEngine.IT_ENTERPROC:case DTTEngine.IT_SUBPROC:c=(!this.ObjValue.ToString().equals("")?this.ObjValue.ToString()+".":"")+this.ObjName;a=" (";if(this.SubItem!=null){for(var b=0;b<this.SubItem.length;b++){e=this.SubItem[b];c+=a+e.ObjValue.ToString();a=", "}c=c+(this.SubItem.Count()>0?")":"")}return(d?c:Glb.HTMLEncode(c,true).replace(new RegExp(" ","g"),"&nbsp;"));case DTTEngine.IT_EXITPROC:return"end";case DTTEngine.IT_ENTERIF:return"";case DTTEngine.IT_ENTERELSE:return"else";case DTTEngine.IT_ENDIF:return"end if";case DTTEngine.IT_ASSIGN:c=(d?this.ObjName:Glb.HTMLEncode(this.ObjName));if(this.SubItem!=null){e=this.SubItem[this.SubItem.Count()-1];if(d){c+="     "}else{c+="</span><span style='color:blue'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}c+=("["+(d?e.ObjValue.ToString():Glb.HTMLEncode(e.ObjValue.ToString(),true).replace(new RegExp(" ","g"),"&nbsp;"))+"]")}return c;case DTTEngine.IT_BREAK:return"break";case DTTEngine.IT_CONTINUE:return"continue";case DTTEngine.IT_EXCEPTION:return"("+(d?this.ObjName:Glb.HTMLEncode(this.ObjName))+") Err "+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString(),true))+": "+(d?this.ObjDescription:Glb.HTMLEncode(this.ObjDescription,false,true));case DTTEngine.IT_RETURN:return"return "+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString(),true).replace(new RegExp(" ","g"),"&nbsp;"));case DTTEngine.IT_ENDFOREACH:return"end loop ("+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString()))+" loops)";case DTTEngine.IT_ENDFORI:return"end loop ("+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString()))+" loops)";case DTTEngine.IT_ENDWHILE:return"end while ("+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString()))+" loops)";case DTTEngine.IT_MESSAGE:case DTTEngine.IT_USER:return IDL.Format(new IDVariant(this.ObjType),new IDVariant("000"),null).ToString()+" - "+(d?this.ObjDescription:Glb.HTMLEncode(this.ObjDescription,false,false).replace(new RegExp(" ","g"),"&nbsp;"));case DTTEngine.IT_ERROR:return(d?this.ObjName:Glb.HTMLEncode(this.ObjName))+": "+(d?this.ObjDescription:Glb.HTMLEncode(this.ObjDescription,false,true));case DTTEngine.IT_FOREACH:case DTTEngine.IT_QUERY:c=(d?this.ObjName:Glb.HTMLEncode(this.ObjName,false,true));if(this.SubItem!=null){for(var b=0;b<this.SubItem.length;b++){e=this.SubItem[b];if(e.ItemType==DTTEngine.IT_IMDBDATASRC||e.ItemType==DTTEngine.IT_DBDATASRC){c+=(" ("+e.RecordCount+" records)")}}}return c;case DTTEngine.IT_TRACE:c=Glb.HTMLEncode(this.ObjName);if(this.SubItem!=null){if(d){c+=("     ["+this.SubItem[0].ObjValue.stringValue()+"]")}else{c+=("</span><span style='color:blue'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;["+Glb.HTMLEncode(this.SubItem[0].ObjValue.stringValue(),true)+"]")}}return c;default:return(d?this.ObjName:Glb.HTMLEncode(this.ObjName))}};DTTItem.prototype.GetTitle=function(){switch(this.ItemType){case DTTEngine.IT_MESSAGE:case DTTEngine.IT_USER:return"MsgID = "+this.ObjType+" - "+Glb.HTMLEncode(this.ObjName,false,true);case DTTEngine.IT_EXCEPTION:case DTTEngine.IT_ERROR:return"";default:return Glb.HTMLEncode(this.ObjDescription)}};DTTItem.prototype.GetNote=function(e){var c="";var d;var b;var g="";var f="";if(e){f=" style='background-color:white;color:white'"}switch(this.ItemType){case DTTEngine.IT_ENTERPROC:case DTTEngine.IT_IF:case DTTEngine.IT_SUBPROC:case DTTEngine.IT_WHILE:case DTTEngine.IT_SWITCH:case DTTEngine.IT_ENTERSWITCH:c="";if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];c+=("<tr><td>"+Glb.HTMLEncode(d.ObjName)+"</td><td> = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</td></tr>")}}return c;case DTTEngine.IT_ASSIGN:c="<tr><td>Old Value = "+Glb.HTMLEncode(this.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</td></tr>";if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];if(d.ItemType==DTTEngine.IT_TOKEN){c+=("<tr><td>"+Glb.HTMLEncode(d.ObjName)+" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</td></tr>")}}}return c;case DTTEngine.IT_MESSAGE:case DTTEngine.IT_USER:c="";if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];if(d.ItemType==DTTEngine.IT_PARAMETER){c+=("<tr><td>"+Glb.HTMLEncode(d.ObjName)+" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true)+"</td></tr>")}if(d.ItemType==DTTEngine.IT_MESSAGE_TK){c+=("<tr><td>"+Glb.HTMLEncode(d.ObjName));if(!d.ObjValue.ToString().equals("")){c+=(" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;"))}c+="</td></tr>"}}}return c;case DTTEngine.IT_EXCEPTION:c="";if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];if(d.ItemType==DTTEngine.IT_PARAMETER){c+=("<tr><td>"+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</td></tr>")}}}return c;case DTTEngine.IT_FOREACH:case DTTEngine.IT_FORI:case DTTEngine.IT_QUERY:if(this.ItemType==DTTEngine.IT_QUERY&&!this.ObjValue.ToString().equals("")){c+=("<div class='SQL'"+(e?f:"")+">"+Glb.HTMLEncode(this.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"<br></div>")}if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];if(d.ItemType==DTTEngine.IT_ENDQUERY){this.MsgType=DTTEngine.DTTMSG_WARN;c+=("<div class='Warn'"+(e?f:"")+">Query took too long to execute: "+d.ObjValue.ToString()+" ms</div>")}if(d.ItemType==DTTEngine.IT_PARAMETER){c+=("<div class='SQL'"+(e?f:"")+">"+Glb.HTMLEncode(d.ObjName)+" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</div>")}if(d.ItemType==DTTEngine.IT_TOKEN){c+=("<div class='SQL'"+(e?f:"")+">"+Glb.HTMLEncode(d.ObjName)+" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</div>")}if(d.ItemType==DTTEngine.IT_IMDBDATASRC||d.ItemType==DTTEngine.IT_DBDATASRC){if(this.ObjValue.ToString().equals("")&&!d.ObjValue.ToString().equals("")){c+=("<div class='SQL'"+(e?f:"")+">"+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"<br></div>")}if(d.ItemType==DTTEngine.IT_IMDBDATASRC){c+=("<div class='SQL'"+(e?f:"")+">IMDB Data Source<br></div>")}if(d.SubItem!=null){if(d.SubItem.Count()>1){c+=("<table class='SQLTbl'"+(e?f:"")+">");for(b=0;b<d.SubItem.Count();b++){g=(d.SubItem[b]).ObjValue.ToString();if(g.length>0&&g.charAt(g.length-1)=="§"){g=g.substr(0,g.length-1)}g=Glb.HTMLEncode(g).Replace(" ","&nbsp;");g=g.Replace("&#167;","</td><td>");c+=("<tr><td>"+g+"</td></tr>")}c+="</table>"}}}}}return c;case DTTEngine.IT_TRACE:if(this.SubItem!=null){switch(this.ObjType){case DTTEngine.TRC_ITMAIN:c=this.RenderGenTrace();break;case DTTEngine.TRC_ITFORM:c=this.RenderGenTrace();break;case DTTEngine.TRC_ITPANEL:c=this.RenderPanelTrace();break;case DTTEngine.TRC_ITTREE:c=this.RenderTreeTrace();break;case DTTEngine.TRC_ITTABBED:c=this.RenderGenTrace();break;case DTTEngine.TRC_ITMENU:c=this.RenderCmdTrace();break;case DTTEngine.TRC_ITTOOLBAR:c=this.RenderCmdTrace();break;case DTTEngine.TRC_ITBUTBAR:c=this.RenderCmdTrace();break;case DTTEngine.TRC_ITCAPTBAR:c=this.RenderCmdTrace();break;case DTTEngine.TRC_ITERROR:c=this.RenderGenTrace();break}}return c}return""};DTTItem.prototype.Level=function(){switch(this.ItemType){case DTTEngine.IT_LOOPDET:case DTTEngine.IT_EXCEPTION:return DTTEngine.LEV_EXCEPT;case DTTEngine.IT_ENTERPROC:case DTTEngine.IT_EXITPROC:return DTTEngine.LEV_PROCS;case DTTEngine.IT_IF:case DTTEngine.IT_ENTERIF:case DTTEngine.IT_ENTERELSE:case DTTEngine.IT_ENTERSWITCH:case DTTEngine.IT_ENDIF:case DTTEngine.IT_ERROR:case DTTEngine.IT_BREAK:case DTTEngine.IT_CONTINUE:case DTTEngine.IT_RETURN:case DTTEngine.IT_FOREACH:case DTTEngine.IT_ENDFOREACH:case DTTEngine.IT_WHILE:case DTTEngine.IT_ENDWHILE:case DTTEngine.IT_SWITCH:case DTTEngine.IT_ENDSWITCH:case DTTEngine.IT_FORI:case DTTEngine.IT_ENDFORI:return DTTEngine.LEV_CTRLBLCKS;case DTTEngine.IT_ASSIGN:case DTTEngine.IT_SUBPROC:return DTTEngine.LEV_STATEM;case DTTEngine.IT_QUERY:case DTTEngine.IT_ENDQUERY:return DTTEngine.LEV_QUERY}return 0};DTTItem.prototype.FindBP=function(a,e){var g=0;for(var c=0;c<a.DTTObj.BreakPoints.length;c++){var b=a.DTTObj.BreakPoints[c];g++;if(e.ObjGuid.equals(b)){return g}if(e.SubItem!=null){for(var d=0;d<e.SubItem.length;d++){var f=e.SubItem[d];if(f.ObjGuid.equals(b)){return g}}}}return 0};DTTItem.prototype.RenderGenTrace=function(){var e;var d="";var b="";var c="";for(var a=0;a<this.SubItem.length;a++){e=this.SubItem[a];c="";if(e.ForceCbp!=-1){c=" style='background-color:"+this.Colors(e.ForceCbp)+"'"}switch(e.ObjType){case DTTEngine.TRC_MAINCAPTION:case DTTEngine.TRC_FORMCAPTION:case DTTEngine.TRC_FRAMECAPTION:case DTTEngine.TRC_TABCAPTION:d+=("<tr><td><img src='dttimg/"+this.GetObjIcon()+"'></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");b=e.GetExtToken("PG",false);if(!b.equals("")){d+=("<tr class='TraceToken'><td></td><td>Page Selected</td><td"+c+">= "+b+"</td></tr>")}break;case DTTEngine.TRC_MAININDIC:case DTTEngine.TRC_FORMINDIC:d+=("<tr><td><img src='dttimg/indic.gif'></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");break;case DTTEngine.TRC_FORMMESSAGE:d+=("<tr><td><img src='dttimg/msg.gif'></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");break;case DTTEngine.TRC_ERRNUMBER:d+=("<tr><td><img src='dttimg/stop.gif'></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");break;case DTTEngine.TRC_ERRDESCR:d+=("<tr class='TraceToken'><td></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");break}}return d};DTTItem.prototype.RenderPanelTrace=function(){var n=0;var C;var H;var M;var j;var U;var D;var T;var Y="";var Q;var g;var B;var A;var u;var o;var b="";var P="";var aa;var l;var G;var V;var S;var E;var m;var q;var J;var I;var L;var X;var K;var z;var f;var ab;var a=0;var W=0;var e=0;var O="";var k="";var R=null;var N=0;var F=0;var d="";var v="";G=-1;var Z=false;while(N<2){EndFor:{for(var t=0;t<this.SubItem.length;t++){R=this.SubItem[t];d="";v="";if(R.ForceCbp!=-1){d="background-color:"+this.Colors(R.ForceCbp);v=" style='"+d+"'"}switch(R.ObjType){case DTTEngine.TRC_PANCAPTION:if(N==0){n=(new IDVariant(R.GetExtToken("NF",true))).intValue();a=(n>0?(this.SubItem.Count()-1)/n:0);C=(new IDVariant(R.GetExtToken("LAY",true))).intValue();H=(new IDVariant(R.GetExtToken("U",true))).intValue()!=0;M=(new IDVariant(R.GetExtToken("D",true))).intValue()!=0;j=(new IDVariant(R.GetExtToken("I",true))).intValue()!=0;U=(new IDVariant(R.GetExtToken("S",true))).intValue()!=0;D=(new IDVariant(R.GetExtToken("L",true))).intValue()!=0;T=(new IDVariant(R.GetExtToken("ST",true))).intValue();Q=(new IDVariant(R.GetExtToken("NR",true))).intValue();B=(new IDVariant(R.GetExtToken("AR",true))).intValue();g=(new IDVariant(R.GetExtToken("AP",true))).intValue();A=(new IDVariant(R.GetExtToken("PG",true))).intValue();u=(new IDVariant(R.GetExtToken("V",true))).intValue();o=(new IDVariant(R.GetExtToken("C",true))).intValue();b=R.GetExtToken("ERR",false);W=(new IDVariant(R.GetExtToken("TW",true))).intValue();e=(new IDVariant(R.GetExtToken("TH",true))).intValue();switch(T){case 0:Y="NONE";break;case 1:Y="QBE";break;case 2:Y="DATA";break;case 3:Y="UPDATED";break}O+=("<tr><td><img src='dttimg/panel.gif'></td><td colspan=2"+v+">");O+=(Glb.HTMLEncode(R.ObjValue.stringValue())+"</td></tr>");if(!H&&!j&&!M){O+=("<tr><td></td><td"+v+">Read Only</td><td class='TraceToken'"+v+">&nbsp;TRUE</td></tr>")}else{if(!H){O+=("<tr><td></td><td"+v+">Can Update</td><td class='TraceToken'"+v+">&nbsp;FALSE</td></tr>")}if(!j){O+=("<tr><td></td><td"+v+">Can Insert</td><td class='TraceToken'"+v+">&nbsp;FALSE</td></tr>")}if(!M){O+=("<tr><td></td><td"+v+">Can Delete</td><td class='TraceToken'"+v+">&nbsp;FALSE</td></tr>")}if(!U){O+=("<tr><td></td><td"+v+">Can Select</td><td class='TraceToken'"+v+">&nbsp;FALSE</td></tr>")}}if(D){O+=("<tr><td></td><td"+v+">Locked</td><td class='TraceToken'"+v+">&nbsp;TRUE</td></tr>")}O+=("<tr><td></td><td"+v+">Status</td><td class='TraceToken'"+v+">&nbsp;"+Y+"</td></tr>");O+=("<tr><td></td><td"+v+">Num. Rows</td><td class='TraceToken'"+v+">&nbsp;"+Q+"</td></tr>");O+=("<tr><td></td><td"+v+">Actual Pos.</td><td class='TraceToken'"+v+">&nbsp;"+g+"</td></tr>");O+=("<tr><td></td><td"+v+">Selected Row</td><td class='TraceToken'"+v+">&nbsp;"+(B+1)+"</td></tr>");O+=("<tr><td></td><td"+v+">Selected Page</td><td class='TraceToken'"+v+">&nbsp;"+(A+1)+"</td></tr>");if(u==0){O+=("<tr><td></td><td"+v+">Visible</td><td class='TraceToken'"+v+">&nbsp;FALSE</td></tr>")}if(o!=0){O+=("<tr><td></td><td"+v+">Collapsed</td><td class='TraceToken'"+v+">&nbsp;TRUE</td></tr>")}aa=0;while(!b.equals("")){aa++;l=b.indexOf("§");if(l==-1){break}P=b.substr(0,l);b=b.substr(l+1);if(!P.equals("")){O+=("<tr><td></td><td"+v+">Error Row "+aa+"</td><td class='TraceToken'"+v+">&nbsp;"+P+"</td></tr>")}}}break;case DTTEngine.TRC_PANFLDVALUE:if(G==-1){if(R.ObjDescription.indexOf("X=")!=-1){G=1;O+=("<tr><td colspan=3><br><div class='pantrc' style='width:"+W+"px;height:"+e+"px'>")}else{G=0;if(a>1){O+="<tr><td colspan=3><br><table cellpadding=3px cellspacing=0px style='border-collapse:collapse'>"}}}V=(new IDVariant(R.GetExtToken("E",true))).intValue()!=0;S=(new IDVariant(R.GetExtToken("V",true))).intValue()!=0;E=(new IDVariant(R.GetExtToken("P",true))).intValue()!=0;m=(new IDVariant(R.GetExtToken("VS",true))).intValue();q=(new IDVariant(R.GetExtToken("PI",true))).intValue();P=R.GetExtToken("ERR",false);if(G==1){if(N==0){if(S&&E){J=(new IDVariant(R.GetExtToken("X",true))).intValue();I=(new IDVariant(R.GetExtToken("Y",true))).intValue();L=(new IDVariant(R.GetExtToken("W",true))).intValue();X=(new IDVariant(R.GetExtToken("H",true))).intValue();K=(new IDVariant(R.GetExtToken("HX",true))).intValue();z=(new IDVariant(R.GetExtToken("HY",true))).intValue();f=(new IDVariant(R.GetExtToken("HW",true))).intValue();ab=(new IDVariant(R.GetExtToken("HH",true))).intValue();if(f!=0&&ab!=0){O+=("<div class='panhdr' style='left:"+K+"px;top:"+z+"px;width:"+f+"px;height:"+ab+"px;"+d+"'>");O+=(Glb.HTMLEncode(R.ObjName)+"</div>")}k="npf";if(!V){k="dpf"}if(q>0){k="lpf"}if(q==-1){k="spf"}O+=("<div title='"+P+"' class='pan"+k+"' style='left:"+J+"px;top:"+I+"px;width:"+L+"px;height:"+X+"px;"+d+"'>");O+=(Glb.HTMLEncode(q==-1?R.ObjName:R.ObjValue.stringValue())+"</div>")}}else{if(!S||!E){k="pfldhid";O+=("<tr><td"+v+"><img src='dttimg/"+k+".gif'></td><td"+(!V?" class='DisPFld'":"")+v+">"+Glb.HTMLEncode(R.ObjName)+"</td><td"+v+">");O+=(Glb.HTMLEncode(R.ObjValue.stringValue())+"</td></tr>");if(!P.equals("")){O+=("<tr class='TraceToken'><td></td><td>Error</td><td>&nbsp;"+P+"</td></tr>")}}}}else{if(a==1){k="pfield";if(q>0){k="pfldlook"}if(q==-1){k="pfldstat"}if(!S||!E){k="pfldhid"}O+=("<tr><td><img src='dttimg/"+k+".gif'></td><td"+(!V?" class='DisPFld'":"")+v+">"+Glb.HTMLEncode(R.ObjName)+"</td><td"+v+">");O+=(Glb.HTMLEncode(R.ObjValue.stringValue())+"</td></tr>");if(!P.equals("")){O+=("<tr class='TraceToken'><td></td><td>Error</td><td>&nbsp;"+P+"</td></tr>")}}else{k="npf";if(!V){k="dpf"}if(q>0){k="lpf"}if(q==-1){k="spf"}if(!S||!E){k="hpf"}if(F==0){O+="<tr>"}if(N==0){O+=("<td class='"+k+"h'>"+Glb.HTMLEncode(R.ObjName)+"</td>")}else{O+=("<td class='"+k+"' title='"+P+"'>"+Glb.HTMLEncode(R.ObjValue.stringValue())+"</td>")}F++;if(F==n){F=0;O+="</tr>";if(N==0){Z=true;break}}}}break}if(Z){Z=false;break}}}if(G==0&&a==1){break}if(G==0&&N==1){O+="</table></td></tr>"}if(G==1&&N==0){O+="</div></td></tr>"}N++}return O};DTTItem.prototype.RenderTreeTrace=function(){var a;var c;var e;var j="";var h="";var d;var b;var g="";for(var f=0;f<this.SubItem.length;f++){b=this.SubItem[f];g="";if(b.ForceCbp!=-1){g=" style='background-color:"+this.Colors(b.ForceCbp)+"'"}switch(b.ObjType){case DTTEngine.TRC_TREECAPTION:a=(new IDVariant(b.GetExtToken("E",true))).intValue()!=0;c=(new IDVariant(b.GetExtToken("V",true))).intValue()!=0;if(!c){h="&nbsp;HIDDEN"}else{if(!a){h="&nbsp;DISABLED"}}j+=("<tr><td><img src='dttimg/tree.gif'></td><td"+g+">");j+=(Glb.HTMLEncode(b.ObjValue.stringValue())+"</td><td class='TraceToken'"+g+">"+h+"</td></tr>");break;case DTTEngine.TRC_TREENODE:e=(new IDVariant(b.GetExtToken("L",true))).intValue();d=(new IDVariant(b.GetExtToken("S",true))).intValue();j+=("<tr class='treetrc'><td></td><td "+(d==1?"class='selnode'":"")+g+"><span style='width:"+(16*e)+"'></span>");j+=(Glb.HTMLEncode(b.ObjValue.stringValue())+"</td><td></td></tr>");break}}return j};DTTItem.prototype.RenderCmdTrace=function(){var c;var f;var e="";var b="";var g;var d="";for(var a=0;a<this.SubItem.length;a++){g=this.SubItem[a];d="";if(g.ForceCbp!=-1){d=" style='background-color:"+this.Colors(g.ForceCbp)+"'"}c=(new IDVariant(g.GetExtToken("E",true))).intValue()!=0;f=(new IDVariant(g.GetExtToken("V",true))).intValue()!=0;if(!f){b="HIDDEN"}else{if(!c){b="DISABLED"}}if(!c||!f){switch(g.ObjType){case DTTEngine.TRC_CMDCAPTION:e+=("<tr><td><img src='dttimg/cmdset.gif'></td><td"+d+">");e+=(Glb.HTMLEncode(g.ObjValue.stringValue())+"</td><td class='TraceToken'"+d+">&nbsp;"+b+"</td></tr>");break;case DTTEngine.TRC_CMDCOMMAND:e+=("<tr><td><img src='dttimg/command.gif'></td><td"+d+">");e+=(Glb.HTMLEncode(g.ObjValue.stringValue())+"</td><td class='TraceToken'"+d+">&nbsp;"+b+"</td></tr>");break}}}return e};DTTItem.prototype.GetExtToken=function(b,a){var d;var c=-1;d=this.ObjDescription.indexOf(b+"=");if(d!=-1){if(a){try{c=this.ObjDescription.indexOf(" ",d)}catch(e){c=-1}}if(c==-1){c=this.ObjDescription.length}return this.ObjDescription.substr(d+b.length+1,c-(d+b.length+1))}return""};DTTItem.prototype.Val=function(a){try{return parseint(a,10)}catch(b){return 0}};DTTItem.prototype.SaveToDB=function(f,e,d){if(e.RequestID<1){return}f.SQLItemInsert.ClearParameters();f.SQLItemInsert.AddParameter(new IDVariant(this.IndLevel));f.SQLItemInsert.AddParameter(new IDVariant(this.ItemType));f.SQLItemInsert.AddParameter(new IDVariant(this.MsgType));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjGuid));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjType));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjName.length>250?this.ObjName.substr(0,250):this.ObjName));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjDescription.length>250?this.ObjDescription.substr(0,250):this.ObjDescription));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjValue.ToString().length>250?this.ObjValue.ToString().substr(0,250):this.ObjValue.ToString()));f.SQLItemInsert.AddParameter(new IDVariant(this.RecordCount));f.SQLItemInsert.AddParameter(new IDVariant(this.TickCount));if(d==null){f.SQLItemInsert.AddParameter(new IDVariant())}else{f.SQLItemInsert.AddParameter(new IDVariant(d.ItemID))}f.SQLItemInsert.AddParameter(new IDVariant(e.RequestID));f.DB.ExecuteIDPS(f.SQLItemInsert,false);if(this.SubItem!=null){var a=f.DB.ExecuteIDPS(f.SQLGetItemID,true);if(!a.EOF()){a.MoveFirst()}ItemID=a.Get(1).intValue();var c;for(var b=0;b<this.SubItem.length;b++){c=this.SubItem[b];c.SaveToDB(f,e,this)}}};DTTItem.prototype.LoadFromDB=function(e,d,b,a){this.IndLevel=a.Get(2).intValue();this.ItemType=a.Get(3).intValue();this.MsgType=a.Get(4).intValue();this.ObjGuid=a.Get(5).stringValue();this.ObjType=a.Get(6).intValue();this.ObjName=a.Get(7).stringValue();this.ObjDescription=a.Get(8).stringValue();this.ObjValue=a.Get(9);this.RecordCount=a.Get(10).intValue();this.TickCount=a.Get(11).intValue();e.SQLSubItemLoad.ClearParameters();e.SQLSubItemLoad.AddParameter(new IDVariant(d.ID));e.SQLSubItemLoad.AddParameter(a.Get(1));var f=e.DB.ExecuteIDPS(e.SQLSubItemLoad,true);if(!f.EOF()){f.MoveFirst()}if(f.RecordCount()>0){this.SubItem=new ArrayList();var c;while(!f.EOF()){c=new DTTItem();c.LoadFromDB(e,d,this,f);this.SubItem.Add(c);f.MoveNext()}}};DTTItem.prototype.TakeSnapshot=function(a,d){var e=a.CreateElement("Item");d.AppendChild(e);e.SetAttribute("Level",this.IndLevel+"");e.SetAttribute("Type",this.ItemType+"");e.SetAttribute("MsgType",this.MsgType+"");e.SetAttribute("Guid",this.ObjGuid);e.SetAttribute("ObjType",this.ObjType+"");e.SetAttribute("Name",this.ObjName);e.SetAttribute("Description",this.ObjDescription);e.SetAttribute("Value",this.ObjValue.stringValue());e.SetAttribute("RecordCount",this.RecordCount+"");e.SetAttribute("Elapsed",this.TickCount+"");if(this.HelpItem!=null){this.HelpItem.TakeSnapshot(a,e,"HelpItem")}if(this.SubItem!=null){var c;for(var b=0;b<this.SubItem.length;b++){c=this.SubItem[b];c.TakeSnapshot(a,e)}}};DTTItem.prototype.LoadSnapshot=function(d,b){var e;var c;this.IndLevel=new IDVariant(d.GetAttribute("Level")).intValue();this.ItemType=new IDVariant(d.GetAttribute("Type")).intValue();this.MsgType=new IDVariant(d.GetAttribute("MsgType")).intValue();this.ObjGuid=d.GetAttribute("Guid");this.ObjType=new IDVariant(d.GetAttribute("ObjType")).intValue();this.ObjName=d.GetAttribute("Name");this.ObjDescription=d.GetAttribute("Description");this.ObjValue=new IDVariant(d.GetAttribute("Value"));this.RecordCount=new IDVariant(d.GetAttribute("RecordCount")).intValue();this.TickCount=new IDVariant(d.GetAttribute("Elapsed")).intValue();if(d.ChildNodes.length>0){this.SubItem=new ArrayList();for(var a=0;a<d.ChildNodes.length;a++){e=d.ChildNodes[a];if(e.NodeType==1){if(e.tagName.equals("HelpItem")){this.HelpItem=new DTTHelpItem();this.HelpItem.LoadSnapshot(e)}else{if(e.tagName.equals("Item")){c=new DTTItem();c.LoadSnapshot(e,this);this.SubItem.Add(c)}}}}}};DTTItem.prototype.RenderTestCode=function(c,b){if(this.ItemType!=DTTEngine.IT_TEST){return""}var d="";var a="";if(this.ObjValue.Type!=IDVariant.NULL&&!this.ObjValue.stringValue().equals("")){a="-"+this.ObjValue.stringValue()}switch(this.ObjType){case DTTEngine.TST_APPLOGUP:d=d+"    SetObjectValue('"+this.ObjGuid+"',"+Glb.JSEncode(this.ObjName)+");\r\n";break;case DTTEngine.TST_APPLOGIN:d=d+"    ClickObject('LOGIN');\r\n";break;case DTTEngine.TST_TERM:d=d+"    EndReplay();\r\n";if(c.NextSessionID!=-1){d=d+"    document.getElementById('stepname').innerHTML = 'Loading next test...';\r\n";d=d+"    var NextURL = '"+b.UrlFor(Glb.ITEM_TEST,"CP",true)+"' + RunMode + '"+c.NextSessionID+(c.HelpGenerationActive?"-H":"")+"';\r\n";d=d+"    document.location.assign(NextURL);\r\n"}else{d=d+"    if (ErrorMessages.length == 0) top.window.close();\r\n"}break;case DTTEngine.TST_LOGOFF:d=d+"    ClickObject('LOGOFF');\r\n";break;case DTTEngine.TST_FLDCHG:d=d+"    SetObjectValue("+Glb.JSEncode(this.ObjGuid+a)+","+Glb.JSEncode(this.ObjDescription)+");\r\n";break;default:d=d+"    ClickObject("+Glb.JSEncode(this.ObjGuid+a)+");\r\n";break}return d};DTTItem.prototype.IsPrintable=function(){if(this.ItemType==DTTEngine.IT_ENTERIF||this.ItemType==DTTEngine.IT_NULL||this.ItemType==DTTEngine.IT_TEST){return false}return true};DTTItem.prototype.Equals=function(a){if(this.ItemType!=a.ItemType||!this.ObjGuid.equals(a.ObjGuid)||this.ObjType!=a.ObjType){return false}return true};DTTItem.prototype.IsReallyTheSame=function(a){var d;var c;var h=true;if(this.ItemType==DTTEngine.IT_NULL||a.ItemType==DTTEngine.IT_NULL){return true}if(this.ItemType!=a.ItemType||!this.ObjGuid.equals(a.ObjGuid)||this.ObjType!=a.ObjType){return false}switch(this.ItemType){case DTTEngine.IT_ENTERPROC:case DTTEngine.IT_IF:case DTTEngine.IT_SUBPROC:case DTTEngine.IT_WHILE:if(!this.ObjName.equals(a.ObjName)||!this.ObjValue.equals(a.ObjValue)||this.ObjType!=a.ObjType||(this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(d=0;d<this.SubItem.Count();d++){var f=this.SubItem[d];var e=a.SubItem[d];if(f.ItemType!=e.ItemType||!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}}break;case DTTEngine.IT_ASSIGN:if(!this.ObjName.equals(a.ObjName)||!this.ObjValue.equals(a.ObjValue)||(this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(d=0;d<this.SubItem.Count();d++){var f=this.SubItem[d];var e=a.SubItem[d];if(f.ItemType!=e.ItemType){f.ForceCbp=1;e.ForceCbp=1;h=false}if(f.ItemType==DTTEngine.IT_TOKEN){if(!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}}}break;case DTTEngine.IT_EXCEPTION:if(!this.ObjName.equals(a.ObjName)||!this.ObjValue.equals(a.ObjValue)){return false}case DTTEngine.IT_RETURN:if(!this.ObjValue.equals(a.ObjValue)){return false}case DTTEngine.IT_MESSAGE:case DTTEngine.IT_USER:if(!this.ObjName.equals(a.ObjName)||!this.ObjValue.equals(a.ObjValue)){return false}if(this.ObjType!=a.ObjType){return false}if(!this.ObjDescription.equals(a.ObjDescription)){return false}if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(d=0;d<this.SubItem.Count();d++){var f=this.SubItem[d];var e=a.SubItem[d];if(f.ItemType!=e.ItemType){f.ForceCbp=1;e.ForceCbp=1;h=false}if(f.ItemType==DTTEngine.IT_PARAMETER||f.ItemType==DTTEngine.IT_MESSAGE_TK){if(!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}}}break;case DTTEngine.IT_FOREACH:case DTTEngine.IT_QUERY:if(!this.ObjValue.equals(a.ObjValue)){return false}if(this.ObjType!=a.ObjType){return false}if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(d=0;d<this.SubItem.Count();d++){var f=this.SubItem[d];var e=a.SubItem[d];if(f.ItemType!=e.ItemType){f.ForceCbp=1;e.ForceCbp=1;h=false}if(this.ItemType==DTTEngine.IT_FOREACH&&d==0){if(!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}if(f.ItemType==DTTEngine.IT_ENDQUERY){if(!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}if(f.ItemType==DTTEngine.IT_PARAMETER){if(!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}if(f.ItemType==DTTEngine.IT_TOKEN){if(!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}if(f.ItemType==DTTEngine.IT_IMDBDATASRC||f.ItemType==DTTEngine.IT_DBDATASRC){if(!f.ObjValue.equals(e.ObjValue)||(f.SubItem==null)!=(e.SubItem==null)){f.ForceCbp=1;e.ForceCbp=1;h=false}if(f.SubItem!=null){if(f.SubItem.Count()!=e.SubItem.Count()){f.ForceCbp=1;e.ForceCbp=1;return false}for(c=0;c<f.SubItem.Count();c++){var g=f.SubItem[c];var b=e.SubItem[c];if(!g.ObjValue.equals(b.ObjValue)){g.ForceCbp=1;b.ForceCbp=1;h=false}}}}}}break;case DTTEngine.IT_TRACE:if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){switch(this.ObjType){case DTTEngine.TRC_ITMAIN:if(!this.IsReallyTheSameGen(a)){return false}break;case DTTEngine.TRC_ITFORM:if(!this.IsReallyTheSameGen(a)){return false}break;case DTTEngine.TRC_ITPANEL:if(!this.IsReallyTheSamePanel(a)){return false}break;case DTTEngine.TRC_ITTREE:if(!this.IsReallyTheSameTree(a)){return false}break;case DTTEngine.TRC_ITTABBED:if(!this.IsReallyTheSameGen(a)){return false}break;case DTTEngine.TRC_ITMENU:if(!this.IsReallyTheSameCmd(a)){return false}break;case DTTEngine.TRC_ITTOOLBAR:if(!this.IsReallyTheSameCmd(a)){return false}break;case DTTEngine.TRC_ITBUTBAR:if(!this.IsReallyTheSameCmd(a)){return false}break;case DTTEngine.TRC_ITCAPTBAR:if(!this.IsReallyTheSameCmd(a)){return false}break;case DTTEngine.TRC_ITERROR:if(!this.IsReallyTheSameGen(a)){return false}break}}break}return h};DTTItem.prototype.IsReallyTheSameGen=function(a){var b;var e=true;if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(b=0;b<this.SubItem.Count();b++){var d=this.SubItem[b];var c=a.SubItem[b];if(d.ObjType!=c.ObjType){d.ForceCbp=1;c.ForceCbp=1;e=false}switch(d.ObjType){case DTTEngine.TRC_MAINCAPTION:case DTTEngine.TRC_FORMCAPTION:case DTTEngine.TRC_FRAMECAPTION:case DTTEngine.TRC_TABCAPTION:if(!d.ObjName.equals(c.ObjName)||!d.ObjValue.equals(c.ObjValue)||!d.ObjDescription.equals(c.ObjDescription)){d.ForceCbp=1;c.ForceCbp=1;e=false}break;case DTTEngine.TRC_MAININDIC:case DTTEngine.TRC_FORMINDIC:case DTTEngine.TRC_FORMMESSAGE:case DTTEngine.TRC_ERRNUMBER:case DTTEngine.TRC_ERRDESCR:if(!d.ObjName.equals(c.ObjName)||!d.ObjValue.equals(c.ObjValue)){d.ForceCbp=1;c.ForceCbp=1;e=false}break}}}return e};DTTItem.prototype.IsReallyTheSameTree=function(a){var b;var e=true;if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(b=0;b<this.SubItem.Count();b++){var d=this.SubItem[b];var c=a.SubItem[b];if(d.ObjType!=c.ObjType){d.ForceCbp=1;c.ForceCbp=1;e=false}switch(d.ObjType){case DTTEngine.TRC_TREECAPTION:if(!d.ObjDescription.equals(c.ObjDescription)){d.ForceCbp=1;c.ForceCbp=1;e=false}break;case DTTEngine.TRC_TREENODE:if(!d.ObjDescription.equals(c.ObjDescription)||!d.ObjValue.equals(c.ObjValue)){d.ForceCbp=1;c.ForceCbp=1;e=false}break}}}return e};DTTItem.prototype.IsReallyTheSameCmd=function(a){var b;var e=true;if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count){return false}for(b=0;b<this.SubItem.Count();b++){var d=this.SubItem[b];var c=a.SubItem[b];if(!d.ObjDescription.equals(c.ObjDescription)||d.ObjType!=c.ObjType||d.ObjType==DTTEngine.TRC_CMDCAPTION||d.ObjType==DTTEngine.TRC_CMDCOMMAND){if(!d.ObjValue.equals(c.ObjValue)){d.ForceCbp=1;c.ForceCbp=1;e=false}}}}return e};DTTItem.prototype.IsReallyTheSamePanel=function(k){var f;var c;var g=new Array(2);var a=new Array(2);var b=new Array(2);var e=new Array(2);var j=new Array(2);c=true;if((this.SubItem==null)!=(k.SubItem==null)){return false}if(this.SubItem!=null){g[0]=-1;g[1]=-1;if(this.SubItem.Count()!=k.SubItem.Count()){return false}for(f=0;f<this.SubItem.Count();f++){var d=this.SubItem[f];var h=k.SubItem[f];if(d.ObjType!=h.ObjType){d.ForceCbp=1;h.ForceCbp=1;c=false}switch(d.ObjType){case DTTEngine.TRC_PANCAPTION:if(!d.ObjDescription.equals(h.ObjDescription)||!d.ObjValue.equals(h.ObjValue)){d.ForceCbp=1;h.ForceCbp=1;c=false}break;case DTTEngine.TRC_PANFLDVALUE:a[0]=(new IDVariant(d.GetExtToken("E",true))).intValue()!=0;b[0]=(new IDVariant(d.GetExtToken("V",true))).intValue()!=0;e[0]=(new IDVariant(d.GetExtToken("P",true))).intValue()!=0;j[0]=(new IDVariant(d.GetExtToken("VS",true))).intValue();if(g[0]==-1){if(d.ObjDescription.indexOf("X=")!=-1){g[0]=1}else{g[0]=0}}a[1]=(new IDVariant(h.GetExtToken("E",true))).intValue()!=0;b[1]=(new IDVariant(h.GetExtToken("V",true))).intValue()!=0;e[1]=(new IDVariant(h.GetExtToken("P",true))).intValue()!=0;j[1]=(new IDVariant(h.GetExtToken("VS",true))).intValue();if(g[1]==-1){if(h.ObjDescription.indexOf("X=")!=-1){g[1]=1}else{g[1]=0}}if(!d.ObjName.equals(h.ObjName)||!d.ObjValue.equals(h.ObjValue)||g[0]!=g[1]||a[0]!=a[1]||b[0]!=b[1]||e[0]!=e[1]||j[0]!=j[1]){d.ForceCbp=1;h.ForceCbp=1;c=false}break}}}return c};DTTItem.prototype.DumpGUIDsToFile=function(a){};DTTItem.prototype.Colors=function(a){switch(a){case 1:return"yellow";case 2:return"lightgreen";case 3:return"orange";case 4:return"lightblue";case 5:return"pink";case 6:return"#FF4040";case 7:return"#CC6600";case 8:return"#D0D0D0"}return""};DTTItem.prototype.RenderProc=function(b,a){b.WriteStrDbgReqPrc("<tr><td class='ProcItem' title='"+Glb.HTMLEncode(this.ObjDescription)+"'>");b.WriteStrDbgReqPrc("<a href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"COL"+this.ObjGuid+a)+"'><img align='absmiddle' alt='Collect debug data?' src='dttimg/"+(this.Collect?"myes":"mno")+".gif'></a>&nbsp;");b.WriteStrDbgReqPrc("<a href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"VIS"+this.ObjGuid+a)+";parent.ReqRef.resendLastEvent(\"ReqRef\");'><img align='absmiddle' alt='Show debug data?' src='dttimg/"+(this.Visible?"myes":"mno")+".gif'></a>&nbsp;");b.WriteStrDbgReqPrc("<img align='absmiddle' style='cursor:hand' onclick='findit(\"proc"+this.ObjGuid+"\")' src='dttimg/"+this.GetObjIcon()+"'>&nbsp;"+Glb.HTMLEncode(this.ObjValue+"."+this.ObjName));b.WriteStrDbgReqPrc("</td><td class=ProcTime>"+this.TotalNetTickCount+"</td><td class=ProcTime>"+this.TotalTickCount+"</td><td class=ProcTime>"+this.RecordCount+"</td><td class=ProcTool>&nbsp;</td></tr>")};DTTItem.prototype.GetItemClass=function(){switch(this.ItemType){case DTTEngine.IT_MESSAGE:return"ItemMsg";case DTTEngine.IT_QUERY:return"ItemQry";case DTTEngine.IT_USER:return"ItemUser";default:return"ItemList"}};DTTItem.prototype.SaveToFile=function(b,m){var a="";var h;var l;var d="";var c;l=this.TickCount+"";for(h=l.length;h<8;h++){l=" "+l}a+=l;if(this.TickCount-b.intValue()>100){l=" ("+(this.TickCount-b.intValue())+")"}else{l=""}for(h=l.length;h<8;h++){l+=" "}a+=l;b.set(new IDVariant(this.TickCount));if(this.MsgType==DTTEngine.DTTMSG_ERROR){a+="[ERR]   "}else{if(this.MsgType==DTTEngine.DTTMSG_WARN){a+="[WARN]  "}else{a+="[INFO]  "}}var k="";if(!m){var n=this.IndLevel;if(this.ItemType==DTTEngine.IT_ENTERELSE){n--}var o=2*(n-1)+4;l="";for(h=0;h<o;h++){l+=" "}k=l}a+=k+this.GetName(true)+"\n";if(this.ItemType==DTTEngine.IT_FOREACH||this.ItemType==DTTEngine.IT_QUERY){k+="                        ";if(this.ItemType==DTTEngine.IT_QUERY&&!this.ObjValue.stringValue().equals("")){a+=k+"SQL = "+this.ObjValue.ToString()+"\n"}if(this.SubItem!=null){for(var g=0;g<this.SubItem.Count();g++){c=this.SubItem[g];if(c.ItemType==DTTEngine.IT_ENDQUERY){a+=k+"Warning, query took too long to execute: "+c.ObjValue.ToString()+" ms\n"}if(c.ItemType==DTTEngine.IT_PARAMETER||c.ItemType==DTTEngine.IT_TOKEN){a+=k+c.ObjName+" = "+c.ObjValue.ToString()+"\n"}if(c.ItemType==DTTEngine.IT_IMDBDATASRC||c.ItemType==DTTEngine.IT_DBDATASRC){if(this.ObjValue.ToString().equals("")&&!c.ObjValue.ToString().equals("")){a+=k+c.ObjValue.ToString()+"\n"}if(c.ItemType==DTTEngine.IT_IMDBDATASRC){a+=k+"IMDB Data Source\n"}if(c.SubItem!=null&&c.SubItem.Count()>1){for(h=0;h<c.SubItem.Count();h++){d=c.SubItem[h].ObjValue.ToString();l="";var f=0;for(var q=0;q<d.length;q++){if(d[q]=="§"){if(q-f>20){l+=d.substr(f,17)+"..."}else{for(var e=q-f;e<20;e++){l+=" "}l+=d.substr(f,q-f)}f=q+1}}a+=k+l+"\n"}}}}}}return a};function DTTRequest(){this.Items=new ArrayList();this.StackTrace=new ArrayList();this.Procs=new HashTableSrv();this.ID;this.Name;this.Description;this.State;this.Condition;this.HelpHTML;this.HelpHide=false;this.HelpItem;this.HelpVerItem;this.StartTime;this.StartTicks;this.ElapsedTime;this.NamePriority;this.Matches=DTTRequest.REQ_MATCHES;this.RequestID;this.iHasBP=-1;this.MaxIndLevel;this.ProcsScanned=false}DTTRequest.PRI_NONE=0;DTTRequest.PRI_ITEM=10;DTTRequest.PRI_DATA=30;DTTRequest.PRI_CMD=50;DTTRequest.REQ_MATCHES=0;DTTRequest.REQ_DIFFERS=1;DTTRequest.REQ_MISSING=2;DTTRequest.REQ_ACTIVE=1;DTTRequest.REQ_PASSIVE=2;DTTRequest.prototype.RenderCaption=function(b,a,d){var c;b.WriteStrDbgReqTop("</head>");if(a){b.WriteStrDbgReqTop("<body onload='refreshdetails(); ItemsCount="+this.Items.Count()+";'>")}else{b.WriteStrDbgReqTop("<body onload='ItemsCount="+this.Items.Count()+"'>")}b.WriteStrDbgReqTop("<table class='ReqHdr'><tr><td>Request ID: "+this.ID+" - Name: "+Glb.HTMLEncode(this.Name,false,true)+" - Elapsed: "+this.ElapsedTime+"ms</td><td>");if(this.State<=DTTEngine.DTTMSG_WARN){b.WriteStrDbgReqTop("<a href='javascript:findit(\"warn\")'><img title='Find the warning' src='dttimg/twarn.gif'></a>&nbsp;");if(this.State==DTTEngine.DTTMSG_ERROR){b.WriteStrDbgReqTop("<a href='javascript:findit(\"stop\")'><img title='Find the error' src='dttimg/tstop.gif'></a>&nbsp;")}}if(b.DTTObj.BreakPoints.Count()>0){b.WriteStrDbgReqTop("<a href='javascript:findit(\"brkpt\")'><img title='Find the next breakpoint' src='dttimg/command.gif'></a>&nbsp;")}if(d){b.WriteStrDbgReqTop('<a href="javascript:rotateView()"><img title="Rotate frames" src="dttimg/rotate.gif"></a>&nbsp;')}b.WriteStrDbgReqTop("<a href='javascript:showall(\"block\")'><img title='Show all notes' src='dttimg/showall.gif'></a>");b.WriteStrDbgReqTop("&nbsp;<a href='javascript:showall(\"none\")'><img title='Hide all notes' src='dttimg/hideall.gif'></a>");b.WriteStrDbgReqTop("&nbsp;<a href='javascript:expall(true)'><img title='Expand all blocks' src='dttimg/expall.gif'></a>");b.WriteStrDbgReqTop("&nbsp;<a href='javascript:expall(false)'><img title='Compress all blocks' src='dttimg/cmpall.gif'></a>");b.WriteStrDbgReqTop("&nbsp;&nbsp;<a href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"RECUR")+"'><img title='"+(b.DTTObj.ShowRecurr?"Hide":"Show")+" recurrent events' src='dttimg/trecur"+(b.DTTObj.ShowRecurr?"h":"")+".gif'></a>");b.WriteStrDbgReqTop("</td><td><form class='DttFlt' >");b.WriteStrDbgReqTop("<select class='DttFlt' title='Filter Messages' onchange='"+b.UrlForDTT(Glb.ITEM_DTT,"FORM","FLTMSG","this.value","",false)+"' name='FLTMSG'>");for(c=0;c<=b.DTTObj.MsgLevel;c++){b.WriteStrDbgReqTop("<option value='"+c+"'"+(b.DTTObj.ShowMsgLevel==c?" selected>":">"));switch(c){case 0:b.WriteStrDbgReqTop("None");break;case 1:b.WriteStrDbgReqTop("Error");break;case 2:b.WriteStrDbgReqTop("Warning");break;case 3:b.WriteStrDbgReqTop("Info");break;case 4:b.WriteStrDbgReqTop("Verbose");break}}b.WriteStrDbgReqTop("</select>&nbsp;");b.WriteStrDbgReqTop("<select class='DttFlt' title='Filter Items' onchange='"+b.UrlForDTT(Glb.ITEM_DTT,"FORM","FLTIT","this.value","",false)+"' name='FLTIT'>");for(c=0;c<=b.DTTObj.Level;c++){b.WriteStrDbgReqTop("<option value='"+c+"'"+(b.DTTObj.ShowLevel==c?" selected>":">"));switch(c){case 0:b.WriteStrDbgReqTop("None");break;case 1:b.WriteStrDbgReqTop("Exceptions");break;case 2:b.WriteStrDbgReqTop("Procedures");break;case 3:b.WriteStrDbgReqTop("Ctrl Blocks");break;case 4:b.WriteStrDbgReqTop("Queries");break;case 5:b.WriteStrDbgReqTop("Statements");break}}b.WriteStrDbgReqTop("</select>&nbsp;");b.WriteStrDbgReqTop("</form></td></tr></table></body></html>")};DTTRequest.prototype.Render=function(m,z,s,n){var y=0;var B=0;var g=null;var o=null;var v=null;var q=0;var d=new IDVariant("");var k=new IDVariant(0);var r=false;var b=false;var a=0;var l="";var e=null;var u=0;var x=0;if(n==null){m.WriteStrDbgReqRef("<body style='overflow:hidden;'>")}else{m.WriteStrDbgReqRef("<body onscroll='javascript:onBodyScroll()'>")}m.WriteStrDbgReqRef("<div style='overflow:scroll; width:"+(m.DTTObj.IsTouch()?"700px":"100%")+"; height:100%'>");q=16;y=0;if(this.MaxIndLevel>20){q=8}if(this.MaxIndLevel>40){q=4}if(this.MaxIndLevel>80){q=3}if(this.MaxIndLevel>120){q=2}if(this.MaxIndLevel>200){q=1}l="";for(var C=0;C<this.Items.Count();C++){g=this.Items[C];B++;b=false;if(g.ItemType!=DTTEngine.IT_TRACE){if(g.ItemType==DTTEngine.IT_MESSAGE||g.ItemType==DTTEngine.IT_USER){if(g.MsgType>m.DTTObj.ShowMsgLevel){b=true}if(m.DTTObj.IsMsgHidden(g.ObjType)){b=true}}else{if(g.Level()>m.DTTObj.ShowLevel){b=true}}if(g.ItemType==DTTEngine.IT_TEST){b=true}}if(g.ItemType==DTTEngine.IT_NULL){var f=g.ObjValue.Value;if(f.ItemType!=DTTEngine.IT_TRACE){if(f.ItemType==DTTEngine.IT_MESSAGE||f.ItemType==DTTEngine.IT_USER){if(f.MsgType>m.DTTObj.ShowMsgLevel){b=true}if(m.DTTObj.IsMsgHidden(f.ObjType)){b=true}}else{if(f.Level()>m.DTTObj.ShowLevel){b=true}}}if(f.ItemType==DTTEngine.IT_TEST){b=true}}if(!b&&!m.DTTObj.ShowRecurr){if(!l.equals("")){if(g.ItemType==DTTEngine.IT_EXITPROC&&g.ObjGuid.equals(l)&&g.ObjType==DTTEngine.PT_EVENT_RECUR){l=""}b=true}else{if(g.ItemType==DTTEngine.IT_ENTERPROC&&g.ObjType==DTTEngine.PT_EVENT_RECUR){l=g.ObjGuid;b=true}}}if(!b){if(v!=null&&!g.Visible&&v.Visible){}b=!g.Visible}if(!b){y++;r=false;a=g.ForceCbp;if(g.ItemType==DTTEngine.IT_NULL&&g.IndLevel!=-999){g=g.ObjValue.Value;a=g.ForceCbp;g.ForceCbp=-1;r=true}if(g.ItemType==DTTEngine.IT_IF){if(this.Items[C+1]!=undefined){e=this.Items[C+1]}else{e=null}}else{e=null}u=g.Render(m,s,y,q,d,z,k,r,v,e,u);if(g.ItemType==DTTEngine.IT_ENDIF||g.ItemType==DTTEngine.IT_EXITPROC||g.ItemType==DTTEngine.IT_BREAK||g.ItemType==DTTEngine.IT_CONTINUE){var t=null;for(var h=0;h<this.Items.Count();h++){o=this.Items[h];if(g.ItemType==DTTEngine.IT_ENDIF&&o.ItemType==DTTEngine.IT_IF&&o.ObjGuid.equals(g.ObjGuid)&&o.IndLevel==g.IndLevel){t=o}if(g.ItemType==DTTEngine.IT_EXITPROC&&o.ItemType==DTTEngine.IT_ENTERPROC&&o.ObjGuid.equals(g.ObjGuid)&&o.IndLevel<=g.IndLevel){t=o}if(g.ItemType==DTTEngine.IT_BREAK&&(o.ItemType==DTTEngine.IT_FOREACH||o.ItemType==DTTEngine.IT_WHILE||o.ItemType==DTTEngine.IT_FORI||o.ItemType==DTTEngine.IT_SWITCH)&&o.IndLevel<g.IndLevel){t=o}if(g.ItemType==DTTEngine.IT_CONTINUE&&(o.ItemType==DTTEngine.IT_FOREACH||o.ItemType==DTTEngine.IT_WHILE||o.ItemType==DTTEngine.IT_FORI)&&o.IndLevel<g.IndLevel){t=o}if(o==g){break}}if(t!=null){var A=u-1-(g.ItemType==DTTEngine.IT_BREAK||g.ItemType==DTTEngine.IT_CONTINUE?1:0);for(x=t.NumOpenDiv;x<=A;x++){m.WriteStrDbgReqRef("</div>");u=u-1}}}if(g.ItemType==DTTEngine.IT_ENDFOREACH||g.ItemType==DTTEngine.IT_ENDWHILE||g.ItemType==DTTEngine.IT_ENDFORI||g.ItemType==DTTEngine.IT_ENDSWITCH){m.WriteStrDbgReqRef("</div>");u=u-1}g.ForceCbp=a}v=g}m.WriteStrDbgReqRef("</div>");m.WriteStrDbgReqRef("</body></html>")};DTTRequest.prototype.GetTickCount=function(){return new Date().getTime()};DTTRequest.prototype.InitRequest=function(a){this.ID=a;this.Name="Request "+this.ID;this.StartTime=new Date();this.StartTicks=this.GetTickCount();this.NamePriority=DTTRequest.PRI_NONE;this.Condition=DTTRequest.REQ_ACTIVE;this.State=DTTEngine.DTTMSG_INFO};DTTRequest.prototype.EndRequest=function(){this.ElapsedTime=this.GetTickCount()-this.StartTicks;var b=new ArrayList();var c;for(var a=0;a<this.Items.Count();a++){c=this.Items[a];if(c.IndLevel>this.MaxIndLevel){this.MaxIndLevel=c.IndLevel}if(c.MsgType<this.State){this.State=c.MsgType}b.Insert(0,c)}this.Items=b};DTTRequest.prototype.SetName=function(c,b,a){if(a<=this.NamePriority){return}this.Name=c;this.Description=b;this.NamePriority=a};DTTRequest.prototype.Add=function(a){this.Items.Insert(0,a);if(a.MsgType<this.State){this.State=a.MsgType}};DTTRequest.prototype.EnterProc=function(a,b){this.StackTrace.Insert(0,a);var d=0;for(var c=0;c<this.StackTrace.length;c++){if(this.StackTrace[c].equals(a)){d++}}if(b.MaxStackLoops>0&&d>b.MaxStackLoops){return false}else{return true}};DTTRequest.prototype.ExitProc=function(a){for(var b=0;b<this.StackTrace.length;b++){if(this.StackTrace[b].equals(a)){this.StackTrace.Remove(a);return}}WriteToConsoleError("[DTTRequest::ExitProc] Guid "+a+" not found!!!")};DTTRequest.prototype.GetIcon=function(a){if(a==undefined){a=0}if(this.Items.length==0){return"empty.gif"}switch(this.State){case DTTEngine.DTTMSG_INFO:return"info.gif";case DTTEngine.DTTMSG_ERROR:return"stop.gif";case DTTEngine.DTTMSG_WARN:return"warn.gif"}return""};DTTRequest.prototype.SaveToDB=function(c){if(c.SessionID<1){return}c.SQLReqInsert.ClearParameters();c.SQLReqInsert.AddParameter(new IDVariant(this.Name));c.SQLReqInsert.AddParameter(new IDVariant(this.Description));c.SQLReqInsert.AddParameter(new IDVariant(this.State));c.SQLReqInsert.AddParameter(new IDVariant(this.StartTime));c.SQLReqInsert.AddParameter(new IDVariant(this.ElapsedTime));c.SQLReqInsert.AddParameter(new IDVariant(c.SessionID));c.DB.ExecuteIDPS(c.SQLReqInsert,false);var a=c.DB.ExecuteIDPS(c.SQLGetReqID,true);if(!a.EOF()){a.MoveFirst()}this.RequestID=a.Get(1).intValue();var d;for(var b=0;b<this.Items.length;b++){d=this.Items[b];d.SaveToDB(c,this,null)}};DTTRequest.prototype.LoadFromDB=function(d,b){this.ID=b.Get(1).intValue();this.Name=b.Get(2).stringValue();this.Description=b.Get(3).stringValue();this.State=b.Get(4).intValue();this.StartTime=b.Get(5).dateValue();this.ElapsedTime=b.Get(6).intValue();d.SQLItemLoad.ClearParameters();d.SQLItemLoad.AddParameter(new IDVariant(this.ID));var f=d.DB.ExecuteIDPS(d.SQLItemLoad,true);if(!f.EOF()){f.MoveFirst()}if(f.RecordCount()>0){var e;while(!f.EOF()){e=new DTTItem();e.LoadFromDB(d,this,null,f);this.Items.Add(e);f.MoveNext()}}var a;this.MaxIndLevel=0;for(var c=0;c<this.Items.length;c++){a=this.Items[c];if(a.IndLevel>this.MaxIndLevel){this.MaxIndLevel=a.IndLevel}}};DTTRequest.prototype.TakeSnapshot=function(a,d){var e=a.CreateElement("Request");d.AppendChild(e);e.SetAttribute("Name",this.Name);e.SetAttribute("Description",this.Description);e.SetAttribute("State",this.State+"");e.SetAttribute("StartTime",this.DateToStr(this.StartTime));e.SetAttribute("ElapsedTime",this.ElapsedTime+"");e.SetAttribute("HelpHTML",this.HelpHTML);e.SetAttribute("HelpHide",this.HelpHide+"");if(this.HelpItem!=null){this.HelpItem.TakeSnapshot(a,e,"HelpItem");this.HelpVerItem.TakeSnapshot(a,e,"HelpVerifyItem")}var b;for(var c=0;c<this.Items.length;c++){b=this.Items[c];b.TakeSnapshot(a,e)}};DTTRequest.prototype.LoadSnapshot=function(d){var e;var b;this.Name=d.GetAttribute("Name");this.Description=d.GetAttribute("Description");this.State=new IDVariant(d.GetAttribute("State")).intValue();this.StartTime=StrToDate(d.GetAttribute("StartTime"));this.ElapsedTime=new IDVariant(d.GetAttribute("ElapsedTime")).intValue();this.HelpHTML=new IDVariant(d.GetAttribute("HelpHTML")).stringValue();this.HelpHide=(new IDVariant(d.GetAttribute("HelpHide")).intValue()!=0);if(d.ChildNodes.length>0){for(var a=0;a<d.ChildNodes.length;a++){e=d.ChildNodes[a];if(e.NodeType==3){if(e.tagName.equals("HelpItem")){this.HelpItem=new DTTHelpItem();this.HelpItem.LoadSnapshot(e)}else{if(e.tagName.equals("HelpVerifyItem")){this.HelpVerItem=new DTTHelpItem();this.HelpVerItem.LoadSnapshot(e)}else{if(e.tagName.equals("Item")){b=new DTTItem();b.LoadSnapshot(e,null);this.Items.Add(b)}}}}}}this.MaxIndLevel=0;for(var c=0;c<this.Items.length;c++){b=this.Items[c];if(b.IndLevel>this.MaxIndLevel){this.MaxIndLevel=b.IndLevel}}};DTTRequest.prototype.RenderTestCode=function(c,a){var e;var d="";var b=false;for(var f=0;f<this.Items.length;f++){e=this.Items[f];d=d+e.RenderTestCode(c,a);if(e.ItemType==DTTEngine.IT_TEST&&e.ObjType!=DTTEngine.TST_FLDCHG){b=true}}if(!b&&this.ID>1){d=d+"    ClickObjectByName('refx');\r\n"}return d};DTTRequest.prototype.CheckDiff=function(b){var e;var q;var f;var d;var c;var o;var m=0;var h=0;var l=this.GetDiffVector(b);for(var a=0;a<l.length;a++){o=l[a];f=(o.intValue()/1000000)+m;d=(o.intValue()%1000000)+h;if(f!=d){if(f>d){for(c=d;c<=f-1;c++){var g=this.Items[c];e=new DTTItem();e.ItemType=DTTEngine.IT_NULL;e.MsgType=DTTEngine.DTTMSG_WARN;e.ObjGuid=g.ObjGuid;if(!g.IsPrintable()){e.IndLevel=-999}else{if(g.ItemType==DTTEngine.IT_ENTERPROC&&g.IndLevel==1){e.IndLevel=-1}}e.ObjValue.Type=IDVariant.BLOB;e.ObjValue.Value=g;b.Items.Insert(c,e);this.Matches=DTTRequest.REQ_MISSING;g.ForceCbp=6}h=h+f-d}else{for(c=f;c<=d-1;c++){var n=b.Items[c];e=new DTTItem();e.ItemType=DTTEngine.IT_NULL;e.MsgType=DTTEngine.DTTMSG_WARN;e.ObjGuid=n.ObjGuid;if(!n.IsPrintable()){e.IndLevel=-999}else{if(n.ItemType==DTTEngine.IT_ENTERPROC&&n.IndLevel==1){e.IndLevel=-1}}e.ObjValue.Type=IDVariant.BLOB;e.ObjValue.Value=n;Items.Insert(c,e);this.Matches=DTTRequest.REQ_MISSING;n.ForceCbp=6}m=m+d-f}}else{e=this.Items[f];q=b.Items[d];if(!e.IsReallyTheSame(q)){e.ForceCbp=1;q.ForceCbp=1;if(this.Matches==DTTRequest.REQ_MATCHES){this.Matches=DTTRequest.REQ_DIFFERS}}}}};DTTRequest.prototype.GetDiffVector=function(a){var c;var b;var h;var e;var k;c=this.Items.Count();b=a.Items.Count();k=new Array(c+1);for(var d=0;d<c+1;d++){k[d]=new Array(b+1)}for(h=c-1;h>=0;h--){for(e=b-1;e>=0;e--){var g=this.Items[h];var l=a.Items[e];if(g.equals(l)){k[h][e]=1+k[h+1][e+1]}else{k[h][e]=(k[h+1][e]>k[h][e+1]?k[h+1][e]:k[h][e+1])}}}var f=new ArrayList();h=0;e=0;while(h<c&&e<b){var g=this.Items[h];var l=a.Items[e];if(g.equals(l)){f.Add(new IDVariant(h*1000000+e));h++;e++}else{if(k[h+1][e]>=k[h][e+1]){h++}else{e++}}}return f};DTTRequest.prototype.DumpGUIDsToFile=function(c){var a;for(var b=0;b<this.Items.length;b++){a=this.Items[b];a.DumpGUIDsToFile(c)}};DTTRequest.DateToStr=function(b){var a=IDL.FormatDate(b,"dd-MM-yyyy HH:mm:ss:FFF");if(a.length>11&&a.substr(11).equals("00:00:00")){a=a.substr(0,10)}return a};DTTRequest.StrToDate=function(c){var b;try{b=new Date(Date.parse(c))}catch(a){WriteToConsoleError("[DTTRequest::StrToDate] Can't convert "+c+" to Date");b=new Date(0)}return b};DTTRequest.prototype.ExpandItem=function(h,g,a){var e=0;var j=0;var d=0;for(var b=0;b<this.Items.length;b++){var f=this.Items[b];j++;if(j==e){d=f.IndLevel}if(j>e){if(f.IndLevel==d){break}if(a||f.IndLevel==d+(f.ItemType==DTTEngine.IT_ENTERELSE?2:1)||!g){f.Visible=g}}}};DTTRequest.prototype.ScanProcs=function(j){var c=new ArrayList();var h=0;if(!this.ProcsScanned){this.ProcsScanned=true;for(var f=0;f<this.Items.length;f++){var e=this.Items[f];if(e.ItemType==DTTEngine.IT_ENTERPROC){var a=this.Procs[e.ObjGuid];if(a==null){a=new DTTItem();a.ItemType=DTTEngine.IT_ENTERPROC;a.ObjGuid=e.ObjGuid;a.ObjName=e.ObjName;a.ObjValue=e.ObjValue;a.ObjType=(e.ObjType==DTTEngine.PT_PROCEDURE?DTTEngine.PT_PROC_ITEM:e.ObjType);a.ObjDescription=e.ObjDescription;a.TickCount=e.TickCount;a.NetTickCount=e.TickCount;a.RecordCount=1;a.ItemID=h++;var d=j[e.ObjGuid];if(d==null){a.Visible=true;a.Collect=true}else{a.Visible=d.Visible;a.Collect=d.Collect}this.Procs[a.ObjGuid]=a}else{a.RecordCount++;if(a.TickCount==0){a.TickCount=e.TickCount}a.NetTickCount=e.TickCount}if(c.Count()>0){var g=c[c.Count()-1];g.TotalNetTickCount=g.TotalNetTickCount+(e.TickCount-g.NetTickCount);g.NetTickCount=0}c.Add(a)}if(e.ItemType==DTTEngine.IT_EXITPROC){var a=this.Procs[e.ObjGuid];if(a!=null){if(e.TotalTickCount>0){a.RecordCount++;if(a.TickCount==0){a.TickCount=e.TotalTickCount}a.NetTickCount=e.TotalTickCount;if(c.Count()>0){var g=c[c.Count()-1];g.NetTickCount=0}c.Add(a)}a.TotalTickCount=a.TotalTickCount+e.TickCount-a.TickCount;a.TickCount=0;a.TotalNetTickCount=a.TotalNetTickCount+(e.TickCount-a.NetTickCount)}while(c.Count()>0){var b;b=c[c.Count()-1];c.RemoveAt(c.Count()-1);var g=b;if(g.ObjGuid.equals(e.ObjGuid)){if(c.Count()>0){g=c[c.Count()-1];g.NetTickCount=e.TickCount}break}}}}}};DTTRequest.prototype.RenderProcs=function(a,b){this.ScanProcs(b);a.WriteStrDbgReqPrc("<table cellspacing=0 cellpadding=0 class='ProcTable'>");a.WriteStrDbgReqPrc('<thead class="ProcTableHead">');a.WriteStrDbgReqPrc("<tr><td class='ProcHdr'>Method Name</td><td class='ProcHdr' style='text-align:right'>Time</td>");a.WriteStrDbgReqPrc("<td class='ProcHdr' style='text-align:right'>Time Total</td><td class='ProcHdr' style='text-align:right'>Call Count</td>");a.WriteStrDbgReqPrc("<td class='ProcHdr' style='text-align:center'><a href='javascript:"+a.UrlForDTT(Glb.ITEM_DTT,"RESPRC"+this.ID)+"'><img alt='WARNING: Click to reset all methods status!' src='dttimg/mno.gif' border=0></a></td></tr>");a.WriteStrDbgReqPrc("</thead>");var g=this.Procs.values();var e=0;while(e<this.Procs.count()){for(var d=0;d<g.length;d++){var f=g[d];if(f.ItemID==e){f.RenderProc(a,this.ID);break}}e++}};DTTRequest.prototype.ProcCommand=function(f,q){var m=f.substr(0,3);var k=f.substr(3,36);var a=this.Procs[k];if(a!=null){if(m.equals("VIS")){a.Visible=!a.Visible;var n=true;var l=false;var o=0;for(var j=0;j<this.Items.length;j++){var h=this.Items[j];if(n){if(h.ItemType==DTTEngine.IT_ENTERPROC||h.ItemType==DTTEngine.IT_EXITPROC){var d=q[h.ObjGuid];if(d!=null){if(!d.Visible){n=false;o=h.IndLevel;l=true}}}}else{if(h.IndLevel<=o){n=true}}h.Visible=n||l;l=false}}if(m.equals("COL")){a.Collect=!a.Collect}}};DTTRequest.prototype.HasBP=function(a,d){if(d==undefined){d=false}if(this.iHasBP==-1||d){for(var b=0;b<this.Items.length;b++){var c=this.Items[b];if(c.FindBP(a,c)!=0){this.iHasBP=1;return true}}this.iHasBP=0}return(this.iHasBP==0?false:true)};DTTRequest.prototype.ProcSize=function(a){var b;this.ScanProcs(a);b=this.Procs.count()*20+32;if(b>300){b=300}return b};DTTRequest.prototype.SaveToFile=function(q,d){var o=(q==DTTEngine.LEV_QUERY);var k=new ArrayList();for(var g=0;g<this.Items.Count();g++){e=this.Items[g];if(e.ItemType==DTTEngine.IT_NULL&&e.IndLevel==-999){continue}if(e.ItemType==DTTEngine.IT_TRACE||e.ItemType==DTTEngine.IT_TEST){continue}if(e.ItemType==DTTEngine.IT_ENTERIF){continue}if(o&&(e.ItemType!=DTTEngine.IT_FOREACH&&e.ItemType!=DTTEngine.IT_QUERY)){continue}k.Add(e)}if(k.Count()==0){return}var b=new IDVariant(0);try{var n="\n-------- ReqID: "+this.ID+" - Name: "+this.Name+" - Time: "+new Date()+" ";for(var f=n.length;f<80;f++){n+="-"}n+="\n";var l,c;if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var l=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForOutput(new IDVariant(d),l,true)}else{var j=requestFileSystemSync(TEMPORARY,5*1024*1024);var h=j.root.getFile(d.substring(d.lastIndexOf("/")+1),{create:true});c=h.createWriter();c.seek(c.length)}for(var f=0;f<k.Count();f++){var e=k[f];n+=e.SaveToFile(b,o);if((f%100)==0||f==k.Count()-1){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){RD4_WebEntryPoint.VBFile.WriteLine(l,new IDVariant(n))}else{var a=new Blob([n],{type:"text/plain"});c.write(a)}n=""}}if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){RD4_WebEntryPoint.VBFile.Close(l)}}catch(m){WriteToConsoleError(m)}};function GUID(){this.iGuid=this.NewGuid()}GUID.prototype.NewGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:(b&3|8);return a.toString(16)})};GUID.prototype.ToString=function(){return this.iGuid.toUpperCase()};GUID.prototype.toAscii85=function(){return GUID.GUID2DocID(this.iGuid)};GUID.encode85=function(d,e,c){var b=3+c*4;var a=(d[b]<0?d[b]+256:d[b])*16777216;b--;a+=(d[b]<0?d[b]+256:d[b])*65536;b--;a+=(d[b]<0?d[b]+256:d[b])*256;b--;a+=(d[b]<0?d[b]+256:d[b]);e[4+c*5]=String.fromCharCode((a/52200625)+40);a=a%52200625;e[3+c*5]=String.fromCharCode((a/614125)+40);a=a%614125;e[2+c*5]=String.fromCharCode((a/7225)+40);a=a%7225;e[1+c*5]=String.fromCharCode((a/85)+40);a=a%85;e[0+c*5]=String.fromCharCode((a)+40)};GUID.decode85=function(d,e,c){var b=4+c*5;var a=(d[b].charCodeAt(0)-40)*52200625;b--;a+=(d[b].charCodeAt(0)-40)*614125;b--;a+=(d[b].charCodeAt(0)-40)*7225;b--;a+=(d[b].charCodeAt(0)-40)*85;b--;a+=(d[b].charCodeAt(0)-40)*1;b--;e[3+c*4]=(a/16777216)&255;a=a%16777216;e[2+c*4]=(a/65536)&255;a=a%65536;e[1+c*4]=(a/256)&255;a=a%256;e[0+c*4]=(a)&255};GUID.HexFull=function(d,b){var c=d.toString(16).toUpperCase();for(var a=c.length;a<b;a++){c=c.insert(0,"0")}return c};GUID.GUID2Str=function(a){var f;var c;var b;var g;var e;var d=new Array(8);b=(a[0]<0?a[0]+256:a[0])+(a[1]<0?a[1]+256:a[1])*256;c=(a[2]<0?a[2]+256:a[2])+(a[3]<0?a[3]+256:a[3])*256;g=(a[4]<0?a[4]+256:a[4])+(a[5]<0?a[5]+256:a[5])*256;e=(a[6]<0?a[6]+256:a[6])+(a[7]<0?a[7]+256:a[7])*256;for(f=0;f<8;f++){d[f]=a[8+f]}var h="";h=h+GUID.HexFull(c,4);h=h+GUID.HexFull(b,4);h=h+"-";h=h+GUID.HexFull(g,4);h=h+"-";h=h+GUID.HexFull(e,4);h=h+"-";for(f=0;f<8;f++){h=h+GUID.HexFull((d[f]<0?d[f]+256:d[f]),2);if(f==1){h=h+"-"}}return h};GUID.GUID2DocID=function(c){var a=new Array(16);var d=new Array(20);a[0]=parseInt(c.substr(6,2),16);a[1]=parseInt(c.substr(4,2),16);a[2]=parseInt(c.substr(2,2),16);a[3]=parseInt(c.substr(0,2),16);a[4]=parseInt(c.substr(11,2),16);a[5]=parseInt(c.substr(9,2),16);a[6]=parseInt(c.substr(16,2),16);a[7]=parseInt(c.substr(14,2),16);a[8]=parseInt(c.substr(19,2),16);a[9]=parseInt(c.substr(21,2),16);a[10]=parseInt(c.substr(24,2),16);a[11]=parseInt(c.substr(26,2),16);a[12]=parseInt(c.substr(28,2),16);a[13]=parseInt(c.substr(30,2),16);a[14]=parseInt(c.substr(32,2),16);a[15]=parseInt(c.substr(34,2),16);GUID.encode85(a,d,0);GUID.encode85(a,d,1);GUID.encode85(a,d,2);GUID.encode85(a,d,3);var b=d.join("");return b};GUID.DocID2GUID=function(d){var a=new Array(20);var b=new Array(16);for(var c=0;c<20;c++){a[c]=d.charAt(c)}GUID.decode85(a,b,0);GUID.decode85(a,b,1);GUID.decode85(a,b,2);GUID.decode85(a,b,3);return GUID.GUID2Str(b)};function HashTableSrv(){Object.call(this)}HashTableSrv.prototype.count=function(){return Object.keys(this).length};HashTableSrv.prototype.add=function(a,b){this[a.toString()]=b};HashTableSrv.prototype.remove=function(a){delete this[a.toString()]};HashTableSrv.prototype.clear=function(){var b=Object.keys(this);for(var a=0;a<b.length;a++){delete this[b[a]]}};HashTableSrv.prototype.keys=function(){return Object.keys(this)};HashTableSrv.prototype.values=function(){var a=new Array();var c=Object.keys(this);for(var b=0;b<c.length;b++){a.push(this[c[b]])}return a};HashTableSrv.prototype.containsKey=function(a){return this[a]!==undefined};function IDArray(b){this.arr=new ArrayList();if(b instanceof Array){for(var c=0;c<b.length;c++){this.arr.Add(IDMap.Wrap(b[c]))}}}IDArray.prototype.Size=function(){return this.arr.Count()};IDArray.prototype.GetNative=function(){return this.arr};IDArray.prototype.set_Value=function(b,a){this.EnsureLength(b.intValue()+1);this.arr[b.intValue()]=new IDVariant(a)};IDArray.prototype.get_Value=function(b){var a=this.arr[b.intValue()];if(a==null){return new IDVariant()}if(a==IDVariant.TRUE||a==IDVariant.FALSE){a=new IDVariant(a)}if(a instanceof IDVariant){return a}return new IDVariant()};IDArray.prototype.add_Value=function(a){this.arr.Add(new IDVariant(a));return new IDVariant(this.Size()-1)};IDArray.prototype.Remove=function(a){this.arr.RemoveAt(a.intValue())};IDArray.prototype.Clear=function(){this.arr.Clear()};IDArray.prototype.set_Object=function(b,a){this.EnsureLength(b.intValue()+1);this.arr[b.intValue()]=a};IDArray.prototype.get_Object=function(b){var a=this.arr[b.intValue()];if(a instanceof IDVariant&&a.Type==IDVariant.NULL){return null}else{return a}};IDArray.prototype.add_Object=function(a){this.arr.Add(a);return new IDVariant(this.Size()-1)};IDArray.prototype.Sort=function(){this.arr.Sort()};IDArray.prototype.set_Boolean=function(b,a){this.set_Object(b,IDMap.Wrap(a))};IDArray.prototype.add_Boolean=function(a){return this.add_Object(IDMap.Wrap(a))};IDArray.prototype.EnsureLength=function(b){for(var a=this.arr.Count();a<b;a++){this.arr.Add(new IDVariant())}};IDArray.prototype.FindValue=function(c,b){for(var a=0;a<this.arr.Count();a++){var d=this.arr.Get(a);if(d==null||!(d instanceof IDVariant)){continue}if(b&&d.compareTo(c)==0){return new IDVariant(a)}else{if(!b&&d.CompareToIgnoreCase(c)==0){return new IDVariant(a)}}}return new IDVariant(-1)};IDArray.prototype.FindObject=function(b){for(var a=0;a<this.arr.Count();a++){var c=this.arr.Get(a);if(c==null){continue}if(c==b){return new IDVariant(a)}}return new IDVariant(-1)};IDArray.prototype.GetDataType=function(a){return new IDVariant(IDMap.GetDataType(this.arr[a.intValue()]))};IDArray.prototype.ToJSON=function(a){var d="[";for(var b=0;b<this.arr.length;b++){if(b>0){d+=","}var c=this.arr[b];if(c instanceof IDMap){if(a.indexOf(c)!=-1){throw new Error("Circular reference for array index "+b)}a.push(c);d+=c.ToJSON(a)}else{if(c instanceof IDArray){if(a.indexOf(c)!=-1){throw new Error("Circular reference for array index "+b)}a.push(c);d+=c.ToJSON(a)}else{if(c instanceof IDVariant){d+=c.ToJSON()}else{d+="null"}}}}d+="]";return d};function IDCachedRowSetMetaData(){this.Columns=null;this.ColumnsMap=null}self.RowSetMetaDataImpl=IDCachedRowSetMetaData;IDCachedRowSetMetaData.prototype.setColumnName=function(b,a){if(b>0&&b<=this.Columns.length){this.Columns[b-1].ColumnName=a;this.ColumnsMap[a]=b-1}};IDCachedRowSetMetaData.prototype.setColumnType=function(b,a){if(b>0&&b<=this.Columns.length){this.Columns[b-1].DataType=IDCachedRowSetMetaData.GetCSharpType(a)}};IDCachedRowSetMetaData.prototype.setColumnCount=function(a){this.Columns=new Array(a);this.ColumnsMap=new HashTableSrv();for(var b=0;b<a;b++){var c=new Object();c.ColumnName="";c.DataType=IDVariant.NULL;c.MaxLength=0;this.Columns[b]=c}};IDCachedRowSetMetaData.prototype.getColumnName=function(a){if(a>0&&a<=this.Columns.length){return this.Columns[a-1].ColumnName}};IDCachedRowSetMetaData.prototype.getColumnType=function(a){if(a>0&&a<=this.Columns.length){return this.Columns[a-1].DataType}return null};IDCachedRowSetMetaData.prototype.getColumnCount=function(){return this.Columns.length};IDCachedRowSetMetaData.prototype.getColumnDisplaySize=function(a){if(a>0&&a<=this.Columns.length){return this.Columns[a-1].MaxLength}return -1};IDCachedRowSetMetaData.prototype.getScale=function(a){if(a>0&&a<=this.Columns.length){return -1}return -1};IDCachedRowSetMetaData.GetCSharpType=function(a){return a};IDCachedRowSetMetaData.GetSQLType=function(a){switch(a){case IDVariant.DECIMAL:return 2;case IDVariant.INTEGER:return 4;case IDVariant.FLOAT:return 8;case IDVariant.STRING:return 12;case IDVariant.DATETIME:return 93;case IDVariant.BLOB:return 2004}return -1};IDCachedRowSetMetaData.ToSQLType=function(a){switch(a){case 2:return IDVariant.DECIMAL;case 4:return IDVariant.INTEGER;case 8:return IDVariant.FLOAT;case 12:case -1:return IDVariant.STRING;case 93:return IDVariant.DATETIME;case -4:case 2004:return IDVariant.BLOB}return null};function MySQLResultSet(){this.insertId=0;this.rowsAffected=0;this.rows=new MySQLResultSetRowList()}function MySQLResultSetRowList(){}MySQLResultSetRowList.prototype=Array.prototype;MySQLResultSetRowList.prototype.item=function(a){return this[a]};function IDCachedRowSet(){this.IntDS=null;this.IntCmd=null;this.Parameters=null;this.MaxRows=0;this.ReadOnly=true;this.CurrentRow;this.CursorPos;this.flOpen=false;this.UnboundCols=null;this.TableName=null;this._insertRow=null;this.onInsertRow=false;this.pQuery=null;this.MetaData=null;this.SortCriteria=new Array(16);this.originalValues=new Array()}IDCachedRowSet.prototype.getCommand=function(){return this.IntCmd};IDCachedRowSet.prototype.checkCursor=function(){if(this.Bof()||this.EOF()){throw new Error("Invalid cursor position")}};IDCachedRowSet.prototype.checkIndex=function(a){if(a<1||(this.RecordCount()>0&&a>this.GetNumFields())){throw new Error("Invalid column index")}};IDCachedRowSet.prototype.setMaxRows=function(a){this.MaxRows=a};IDCachedRowSet.prototype.getMaxRows=function(){return this.MaxRows};IDCachedRowSet.prototype.absolute=function(a){if(a>0){if(a>this.RecordCount()){this.CursorPos=this.IntDS.rows.length+1}else{this.CursorPos=a}}else{this.CursorPos=0}if(this.EOF()||this.Bof()){return false}return true};IDCachedRowSet.prototype.acceptChanges=function(b){if(b==undefined){b=null}if(this.onInsertRow){throw new Error("Invalid operation while on insert row")}if(b!=null){var a=(b.Transaction!=null);if(!a&&b.TransactionIsolation!=2){b.BeginTrans()}IDCachedRowSet.prototype.acceptChangesTR=function(){try{this.Update(b)}finally{if(!a&&b.TransactionIsolation!=2){b.CommitTrans()}}};b.ExecuteTrans(IDCachedRowSet.prototype.acceptChangesTR,this)}};IDCachedRowSet.prototype.deleteRow=function(){this.checkCursor();this.originalValues[this.CursorPos-1]=-2};IDCachedRowSet.prototype.execute=function(f,e){this.Parameters=new ArrayList();if(f!=null&&this.IntCmd.indexOf("?")!=-1){for(var b=0;b<f.Count();b++){var a=f[b];var d=null;if(a.Type==IDVariant.NULL){d=null}else{if(a.Type==IDVariant.DATETIME){d=IDL.CSql(a,IDL.FMT_DAT1,e).Replace("#","")}else{d=a.Value}}this.Parameters.Add(d)}}var c=false;if(e!=null){c=(e.Transaction!=null);if(!c&&e.TransactionIsolation!=2){e.BeginTrans()}}IDCachedRowSet.prototype.executeTR=function(){try{var g=e.ExecuteSQL(this.IntCmd,this.Parameters);this.populate(g)}finally{if(!c&&e.TransactionIsolation!=2&&e!=null){e.CommitTrans()}}};e.ExecuteTrans(IDCachedRowSet.prototype.executeTR,this);this.flOpen=true;this.CursorPos=0};IDCachedRowSet.prototype.findColumn=function(f){try{var a=this.getMetaData().ColumnsMap[f];if(a>=0){return a+1}a=this.getMetaData().ColumnsMap['"'+f+'"'];if(a>=0){return a+1}var d=this.getMetaData().ColumnsMap;var g=f.toLowerCase();for(var b in d){if(b.toLowerCase()==g||b.toLowerCase()=='"'+g+'"'){a=d[b];if(a>=0){return a+1}}}}catch(c){}return -1};IDCachedRowSet.prototype.getBinaryStream=function(c){var a=this.getBlob(this.GetName(c));if(a!=null){return a}return null};IDCachedRowSet.prototype.getBlob=function(a){this.checkIndex(a);this.checkCursor();return this.Get(a,IDVariant.BLOB).Value};IDCachedRowSet.prototype.getCurrentRow=function(){if(this.onInsertRow==true){return this._insertRow}return this.IntDS.rows.item(this.CursorPos-1)};IDCachedRowSet.prototype.getRow=function(){return this.CursorPos};IDCachedRowSet.prototype.insertRow=function(){if(this.onInsertRow==false){throw new Error("Not on insert row")}this.originalValues[this.RecordCount()]=-1;this.IntDS.rows.push(this._insertRow)};IDCachedRowSet.prototype.moveToCurrentRow=function(){if(this.onInsertRow!=false){this.CursorPos=this.CurrentRow;this.onInsertRow=false;this._insertRow=null}};IDCachedRowSet.prototype.moveToInsertRow=function(){if(this._insertRow==null){this._insertRow=new Object();for(var a=1;a<=this.getMetaData().getColumnCount();a++){this._insertRow[this.getMetaData().getColumnName(a)]=null}}this.onInsertRow=true;this.CurrentRow=this.CursorPos;this.CursorPos=-1};IDCachedRowSet.prototype.populate=function(h){if(this.ReadOnly){this.IntDS=h}else{this.IntDS=new MySQLResultSet();this.IntDS.rowsAffected=h.rowsAffected;try{this.IntDS.insertId=h.insertId}catch(f){}var c=h.rows.length;if(this.MaxRows>0){c=Math.min(c,this.MaxRows)}for(var b=0;b<c;b++){var k=new Object();var g=h.rows.item(b);var d=Object.keys(g);for(var a=0;a<d.length;a++){k[d[a]]=g[d[a]]}this.IntDS.rows.push(k)}}if(this.RecordCount()>0){this.flOpen=true;this.CursorPos=0}};IDCachedRowSet.prototype.refreshRow=function(){this.checkCursor();if(this.onInsertRow){throw new Error("Invalid cursor position.")}this.RejectRowChanges(this.CursorPos-1)};IDCachedRowSet.prototype.restoreOriginal=function(){for(var a=0;a<this.RecordCount();a++){this.RejectRowChanges(a)}};IDCachedRowSet.prototype.setCommand=function(a){if(this.IntCmd!=a){this.IntCmd=a;this.MetaData=null}};IDCachedRowSet.prototype.setOriginalRow=function(a){if(this.onInsertRow){throw new Error("Invalid operation on Insert Row")}this.AcceptRowChanges(this.CursorPos-1)};IDCachedRowSet.prototype.size=function(){try{if(this.IntDS!=null){return this.IntDS.rows.length}}catch(a){}return 0};IDCachedRowSet.prototype.setTableName=function(a){this.TableName=a};IDCachedRowSet.prototype.updateBinaryStream=function(d,c){this.checkIndex(d);this.checkCursor();var b=this.GetName(d);var e=this.getCurrentRow()[b];var a=c.stringValue();this.getCurrentRow()[b]=a;if(!this.onInsertRow&&a!=e){this.OnValueRowChange(this.CursorPos-1,b,e)}};IDCachedRowSet.prototype.updateNull=function(b){this.checkIndex(b);this.checkCursor();var a=this.GetName(b);var c=this.getCurrentRow()[a];this.getCurrentRow()[a]=null;if(!this.onInsertRow&&c!=null){this.OnValueRowChange(this.CursorPos-1,a,c)}};IDCachedRowSet.prototype.updateRow=function(){if(this.onInsertRow){throw new Error("updateRow called while on insert row")}};IDCachedRowSet.prototype.isColUnbound=function(a){if(this.UnboundCols!=null&&a<=this.UnboundCols.length){return this.UnboundCols[a-1]}else{return false}};IDCachedRowSet.prototype.setColUnbound=function(c,a){if(this.UnboundCols==null){this.UnboundCols=new Array(this.GetNumFields())}if(this.UnboundCols!=null&&c<=this.UnboundCols.length){this.UnboundCols[c-1]=a}};IDCachedRowSet.prototype.hasUnboundCol=function(){for(var a=0;a<this.UnboundCols.length;a++){if(this.UnboundCols[a]){return true}}return false};IDCachedRowSet.prototype.setOriginalValue=function(a){this.AcceptRowChanges(this.CursorPos-1)};IDCachedRowSet.prototype.getParams=function(){return this.Parameters};IDCachedRowSet.prototype.getMetaData=function(m){if(m==undefined){m=false}if(this.MetaData!=null){return this.MetaData}this.MetaData=new IDCachedRowSetMetaData();var o=this.GetColumnNamesByIntCmd();this.MetaData.setColumnCount(o.length);for(var e=0;e<o.length;e++){this.MetaData.setColumnName(e+1,o[e])}if(m){return this.MetaData}if(this.pQuery&&this.pQuery.Index==0&&this.pQuery.Parent){var a=this.pQuery.Parent;for(var d=1;d<=this.MetaData.getColumnCount();d++){for(var g=0;g<a.UMaster();g++){var k=a.MasterFields[g];if(k.Code==this.MetaData.getColumnName(d)){this.MetaData.setColumnType(d,k.DataType);break}}}}else{var h=this.MetaData.getColumnCount();for(var e=0;e<this.RecordCount();e++){var n=this.IntDS.rows.item(e);for(var d=1;d<=this.MetaData.getColumnCount();d++){var b=this.MetaData.getColumnName(d);var c=this.MetaData.getColumnType(d);if(c==Glb.DT_UNSPEC||c==Glb.DT_NUM_INTEGER||c==Glb.DT_NUM_FLOAT){var l=n[b];switch(typeof(l)){case"string":if(l.startsWith("QkxPQ")){c=Glb.DT_DOC_OLE}else{var j=l.replace(/,/g,".");var g=parseFloat(j);if(!isNaN(g)&&(g.toString()==j)){c=Glb.DT_NUM_FLOAT}else{c=Glb.DT_CHAR}}break;case"boolean":case"number":if(c!=Glb.DT_NUM_FLOAT){if(l%1==0){c=Glb.DT_NUM_INTEGER}else{c=Glb.DT_NUM_FLOAT}}break;case"object":if(l instanceof Date){c=Glb.DT_DATETIME}break}if(c!=Glb.DT_UNSPEC){this.MetaData.setColumnType(d,c);if(c!=Glb.DT_NUM_INTEGER&&c!=Glb.DT_NUM_FLOAT){h--}}}}if(h==0){break}}}return this.MetaData};IDCachedRowSet.prototype.setMetaData=function(a){this.IntDS=new MySQLResultSet();this.MetaData=a};IDCachedRowSet.prototype.setReadOnly=function(){this.ReadOnly=true};IDCachedRowSet.prototype.setUpdatable=function(){this.ReadOnly=false;if(this.IntDS&&!(this.IntDS instanceof MySQLResultSet)){this.populate(this.IntDS)}};IDCachedRowSet.prototype.CopyFrom=function(b){this.IntDS=new MySQLResultSet();for(var a=0;a<b.IntDS.rows.length;a++){this.IntDS.rows.push(b.IntDS.rows.item(a).clone())}this.MetaData=b.MetaData;this.IntCmd=b.IntCmd;this.MaxRows=b.MaxRows;this.ReadOnly=b.ReadOnly;this.onInsertRow=b.onInsertRow;this._insertRow=b._insertRow;this.CurrentRow=b.CurrentRow;this.CursorPos=b.CursorPos;this.TableName=b.TableName;this.UnboundCols=null;if(b.UnboundCols!=null){this.UnboundCols=b.UnboundCols.clone()}this.flOpen=b.flOpen};IDCachedRowSet.prototype.Get=function(b,c){if(c==undefined){c=0}var d;if(typeof(b)=="string"){d=this.findColumn(b)}if(typeof(b)=="number"){d=b}b=this.GetName(d);this.checkIndex(d);var a=IDVariant.convertObject(this.getCurrentRow()[b]);if(this.getMetaData().getColumnType(d)!=Glb.DT_UNSPEC&&a.Type!=IDVariant.NULL){a.changeType(IDL.DataType2IDVariantType(this.getMetaData().getColumnType(d)))}if(c!=0&&a.Type!=IDVariant.NULL){a.changeType(c)}return a};IDCachedRowSet.prototype.Set=function(c,b){var e;if(typeof(c)=="string"){e=this.findColumn(c)}if(typeof(c)=="number"){e=c}c=this.GetName(e);this.checkIndex(e);if(b.Type==IDVariant.BLOB){b.changeType(IDVariant.STRING);if(this.getMetaData().getColumnType(e)==Glb.DT_UNSPEC){this.getMetaData().setColumnType(e,Glb.DT_DOC_OLE)}}var d=this.getCurrentRow()[c];var a=b.Value;this.getCurrentRow()[c]=a;if(!this.onInsertRow&&a!=d){this.OnValueRowChange(this.CursorPos-1,c,d);if(this.pQuery!=null){this.pQuery.OnValueChange(this.CursorPos-1,e-1,b)}}if(this.isColUnbound(e)){this.setOriginalValue(e)}};IDCachedRowSet.prototype.GetNumFields=function(){if(this.getMetaData()){return this.getMetaData().getColumnCount()}else{return null}};IDCachedRowSet.prototype.GetName=function(a){this.checkIndex(a);if(this.getMetaData()){return this.getMetaData().getColumnName(a)}else{return null}};IDCachedRowSet.prototype.GetAlias=function(e){var a="";var d=this.GetName(e);var b=this.IntCmd.indexOf("."+d+" ");if(b>0){var c=this.IntCmd.substring(0,b).lastIndexOf(" ");if(c>0){a=this.IntCmd.substring(c,b+1)}}return a};IDCachedRowSet.prototype.BookMark=function(){return this.getRow()};IDCachedRowSet.prototype.EOF=function(){return this.CursorPos>this.RecordCount()||this.RecordCount()==0};IDCachedRowSet.prototype.Bof=function(){return this.CursorPos==0||this.RecordCount()==0};IDCachedRowSet.prototype.MoveNext=function(){if(this.CursorPos<0||this.CursorPos>=this.RecordCount()+1){throw new Error("Invalid Cursor position")}if(this.CursorPos<=this.RecordCount()){this.CursorPos++}};IDCachedRowSet.prototype.MovePrevious=function(){if(this.CursorPos<=0||this.CursorPos>this.RecordCount()+1){throw new Error("Invalid Cursor position")}if(this.CursorPos>=1){this.CursorPos--}};IDCachedRowSet.prototype.MoveLast=function(){this.CursorPos=this.RecordCount()};IDCachedRowSet.prototype.MoveFirst=function(){this.CursorPos=1};IDCachedRowSet.prototype.IsOpen=function(){return this.IntDS!=null};IDCachedRowSet.prototype.RecordCount=function(){if(this.MaxRows>0){return Math.min(this.MaxRows,this.size())}else{return this.size()}};IDCachedRowSet.prototype.Close=function(){this.IntDS=null;this.flOpen=false};IDCachedRowSet.prototype.AddNew=function(b){var b=new ArrayList();for(var a=0;a<this.GetNumFields();a++){b.Add(new IDVariant())}this.AddRow(b);this.MoveLast()};IDCachedRowSet.prototype.AddRow=function(e){var b={};this.IntDS.rows.push(b);for(var c=0;c<e.Count();c++){var d=this.GetName(c+1);if(e[c]!=null&&e[c] instanceof IDVariant){var a=new IDVariant(e[c]);if(a.Type!=IDVariant.NULL){var f=this.getMetaData().getColumnType(c+1);if(f!=Glb.DT_UNSPEC){a.changeType(IDL.DataType2IDVariantType(f))}}b[d]=a.Value}else{b[d]=e[c]}}this.flOpen=true};IDCachedRowSet.prototype.PrepareForValueSource=function(){this.IntDS=new MySQLResultSet();this.MetaData=new IDCachedRowSetMetaData();this.MetaData.setColumnCount(2);this.MetaData.setColumnName(1,"Code");this.MetaData.setColumnType(1,Glb.DT_CHAR);this.MetaData.setColumnName(2,"Description");this.MetaData.setColumnType(2,Glb.DT_CHAR)};IDCachedRowSet.prototype.AddValueSourceRow=function(a,b){var c=new Object();c[this.GetName(1)]=a;c[this.GetName(2)]=b;this.IntDS.rows.push(c)};IDCachedRowSet.prototype.GetObjectDirect=function(a,d){this.checkIndex(d);if(a>this.RecordCount()||this.RecordCount()==0||a==0){throw new Error("Invalid cursor position")}try{var c=this.IntDS.rows.item(a-1)[this.GetName(d)];return c}catch(b){return null}};IDCachedRowSet.prototype.SubstuteParameters=function(f,b){if(b==Glb.DBT_DB2400||b==Glb.DBT_ODBC){return f}var a=Glb.ParamsPrefixDB(b);var e=false;var d=1;for(var c=0;c<f.length;c++){if(f.charAt(c)=="'"){e=!e}else{if(!e&&f.charAt(c)=="?"){if(a=="?"&&c+1<f.length&&f.charAt(c+1)=="P"){continue}f=f.substr(0,c)+a+"P"+d+++f.substr(c+1)}}}return f};IDCachedRowSet.prototype.ClearSort=function(){for(var a=0;a<this.SortCriteria.length;a++){this.SortCriteria[a]=0}};IDCachedRowSet.prototype.SortBy=function(b){for(var c=0;c<this.SortCriteria.length;c++){if(!this.SortCriteria[c]){var a;if(b.Type==IDVariant.STRING){var d=b.stringValue().trim();if(d.toUpperCase().endsWith(" ASC")){a=this.findColumn(d.substr(0,d.length-4).trim())}else{if(d.toUpperCase().endsWith(" DESC")){a=-this.findColumn(d.substr(0,d.length-5).trim())}else{a=this.findColumn(d)}}}else{a=b.intValue();if(Math.abs(a)>this.GetNumFields()){throw new Error("Cannot sort by column "+Math.abs(a)+" because the recorset only has "+this.GetNumFields()+" columns")}}this.SortCriteria[c]=a;break}}};IDCachedRowSet.prototype.GetSortCriteria=function(a){if(a>0&&a<=this.SortCriteria.length){return this.SortCriteria[a-1]}else{return 0}};IDCachedRowSet.prototype.EnableSort=function(){var b=this.SortCriteria;var f=this.getMetaData();var c=this.RecordCount();var e=new Array(c);for(var a=0;a<c;a++){e[a]=this.IntDS.rows.item(a)}function d(j,h){var g=0;for(var k=0;k<b.length&&g==0;k++){if(b[k]==0){continue}try{var m=j[f.getColumnName(Math.abs(b[k]))];var l=h[f.getColumnName(Math.abs(b[k]))];if(m==null){g=(l==null)?0:-1}else{if(l==null){g=(m==null)?0:1}else{if(typeof(m)=="string"&&typeof(l)=="string"){g=(String.compare(m,l,true))}else{if(m==l){g=0}else{g=(m>l?1:-1)}}}}if(b[k]<0){g=-g}}catch(n){WriteToConsoleError("Errore in Order By"+n)}}return g}e=e.sort(d);this.IntDS=new MySQLResultSet();for(var a=0;a<c;a++){this.IntDS.rows.push(e[a])}};IDCachedRowSet.prototype.getDebugInfo=function(b,d){var l="";try{if(d.length>0){var k=this.Get(d);l=k.getDebugInfo(b,"")}else{if(b==1){var h="";h+='<recordset count="'+this.RecordCount()+'" position="'+this.BookMark()+'" >';h+="<columns>";var j=this.GetNumFields();for(var g=0;g<j;g++){h+='<column name="'+this.GetName(g+1)+'" type="'+IDCachedRowSetMetaData.GetSQLType(this.getMetaData().getColumnType(g+1))+'" size="'+this.getMetaData().getColumnDisplaySize(g+1)+'" />'}h+="</columns>";h+="<rows>";for(var a=1;a<=this.RecordCount();a++){h+="<row";for(var g=1;g<=j;g++){var k=IDVariant.convertObject(this.GetObjectDirect(a,g));h+=" c"+g+'="'+IDVariant.encodeTextForXml(k.ToString())+'"'}h+=" />"}h+="</rows>";h+="</recordset>";l=h.toString()}else{l='<recordset count="'+this.RecordCount()+'" position="'+this.BookMark()+'" />'}}}catch(f){}return l};IDCachedRowSet.prototype.SaveToXML=function(c){if(c==undefined){c=false}if(this.IntDS==null){return""}if(this.getMetaData()==null){return""}try{var b=new XMLDoc();var a=b.AddNewElement("RS");this.SaveToXMLNode(a);return b.SaveToString()}catch(d){if(this.pQuery!=null&&this.pQuery.Parent!=null&&this.pQuery.Parent.MainFrm!=null){this.pQuery.Parent.MainFrm.DTTObj.AddException("","IDCachedRowSet::SaveToXML","Exception while saving to XML",d)}else{WriteToConsoleError("[IDCachedRowSet::SaveToXML] Exception while saving to XML: "+d)}return""}};IDCachedRowSet.prototype.SaveToXMLNode=function(g){if(!this.IsOpen()){return}var e=this.getMetaData();var a=g.AddNewElement("MD");var j=this.GetNumFields();for(var f=1;f<=j;f++){var d=a.AddNewElement("Column");d.SetAttribute("Name",e.getColumnName(f));d.SetAttribute("Type",IDL.Type2DT(e.getColumnType(f)).toString())}var h=g.AddNewElement("Rows");for(var b=1;b<=this.size();b++){var l=h.AddNewElement("Row");l.set_IsArrayChild(true);for(var f=1;f<=j;f++){var k=IDVariant.convertObject(this.GetObjectDirect(b,f));if(k.Type!=IDVariant.NULL){if(k.Type==IDVariant.DATETIME){l.SetAttribute("c"+f,IDL.Format(k,new IDVariant("dd/mm/yyyy hh:nn:ss"),null).stringValue())}else{l.SetAttribute("c"+f,k.stringValue())}}}}};IDCachedRowSet.prototype.LoadFromXML=function(a,d){if(d==undefined){d=false}try{var c=new XMLDoc();if(!c.LoadFromString(a)){return false}if(!c.HasNextNode()){throw new Error("Empty XML document")}var b=c.GetNextNode();if(b.Name().equals("xml")){b=c.GetNextNode()}if(!b.Name().equals("RS")){throw new Error("Wrong node type: expected 'RS', got '"+b.Name()+"'")}this.LoadFromXMLNode(b);return true}catch(f){if(this.pQuery!=null&&this.pQuery.Parent!=null&&this.pQuery.Parent.MainFrm!=null){this.pQuery.Parent.MainFrm.DTTObj.AddException("","IDCachedRowSet::LoadFromXML","Exception while loading from XML",f)}else{WriteToConsoleError("[IDCachedRowSet::LoadFromML] Exception while loading from XML: "+f)}return false}};IDCachedRowSet.prototype.LoadFromXMLNode=function(h){this.IntDS=new MySQLResultSet();var a=h.GetNextNode();var c=0;if(a){if(!a.Name().equals("MD")){throw new Error("Wrong node type: expected 'MD', got '"+a.Name()+"'")}c=a.GetNode().childNodes.length;this.MetaData=new IDCachedRowSetMetaData();this.MetaData.setColumnCount(c);var g=new Array(c);for(var f=0;a.HasNextNode();f++){var b=a.GetNextNode();this.MetaData.setColumnName(f+1,b.GetAttribute("Name"));g[f]=parseInt(b.GetAttribute("Type"),10);this.MetaData.setColumnType(f+1,IDCachedRowSetMetaData.GetCSharpType(g[f]))}}this.RemoveAllRows();var j=h.GetNextNode();if(j){if(!j.Name().equals("Rows")){throw new Error("Wrong node type: expected 'Rows', got '"+j.Name()+"'")}while(j.HasNextNode()){var m=j.GetNextNode();if(!m.Name().equals("Row")){throw new Error("Wrong node type: expected 'Row', got '"+m.Name()+"'")}var l=new ArrayList();for(var f=0;f<c;f++){l.Add(new IDVariant())}for(var f=0;m.HasNextAttribute();f++){var k=new IDVariant();var d=new IDVariant();m.GetNextAttribute(d,k);if(d.stringValue().startsWith("c")){var e=parseInt(d.stringValue().substr(1),10);l[e-1]=k;if(g[e-1]==Glb.DT_DOC_OLE){k.Type=IDVariant.BLOB}}}this.AddRow(l)}}this.MoveFirst()};IDCachedRowSet.prototype.RemoveAllRows=function(){if(this.IntDS!=null){this.IntDS.rows.splice(0,this.IntDS.rows.length)}};IDCachedRowSet.prototype.Update=function(m){this.IntDS.insertId=0;this.IntDS.rowsAffected=0;if(this.originalValues.length==0){return}var c=null;for(var x=0;x<this.RecordCount();x++){var l=this.originalValues[x];if(l!==undefined){var b=this.IntDS.rows.item(x);var q=Object.keys(b);var s="";var t=new Array();switch(l){case -1:var y="";var u="";for(var g=0;g<q.length;g++){var h=q[g];var k=b[h];if(k===null||k===undefined||this.isColUnbound(g+1)){continue}y+=(y.length>0?", ":"")+h;u+=(u.length>0?", ":"")+"?";t.push(k)}if(y.length>0){s="INSERT INTO "+this.TableName+"("+y+") VALUES ("+u+")"}break;case -2:s="DELETE FROM "+this.TableName+" WHERE ";var q=Object.keys(b);for(var g=0;g<q.length;g++){if(this.isColUnbound(g+1)){continue}var h=q[g];var k=b[h];if(g>0){s+=" AND "}if(k===null){s+=h+" IS NULL"}else{s+=h+" = ?";t.push(k)}}break;default:var y="";var u="";var o=new Array();var q=Object.keys(b);for(var g=0;g<q.length;g++){if(this.isColUnbound(g+1)){continue}var h=q[g];var f=b[h];var j=(l[h]!==undefined?l[h]:b[h]);if(l[h]!==undefined&&l[h]!=b[h]){if(y.length>0){y+=", "}y+=h+" = ?";t.push(f)}if(u.length>0){u+=" AND "}if(j===null){u+=h+" IS NULL"}else{u+=h+" = ?";o.push(j)}}if(y.length>0){s="UPDATE "+this.TableName+" SET "+y+" WHERE "+u;t=t.concat(o)}break}if(s.length>0){for(var n=0;n<t.length;n++){var d=t[n];if(d instanceof Date){t[n]=IDL.CSql(new IDVariant(d),IDL.FMT_DAT1,m).Replace("#","")}}if(this.pQuery){var a=(l==-1?DTTEngine.STMT_QRY_INSVAL:(l==-2?DTTEngine.STMT_QRY_DELETE:DTTEngine.STMT_QRY_UPDATE));this.pQuery.Parent.MainFrm.DTTObj.AddQuery("RS.AcceptChanges",this.pQuery.Parent.GetDTTCaption()+" - "+(l==-2?"DeleteRecords":"UpdateRecords"),"RS.AcceptChanges",a,s);for(var n=0;n<t.length;n++){this.pQuery.Parent.MainFrm.DTTObj.AddParameter("RS.AcceptChanges",this.pQuery.Parent.GetDTTCaption(),"Param "+(n+1),t[n])}}c=m.ExecuteSQL(s,t,true);if(this.pQuery){this.pQuery.Parent.MainFrm.DTTObj.EndQuery("DB.AcceptChanges")}}if(l==-2){this.IntDS.rows.splice(x,1);this.originalValues.splice(x,1);x--}else{this.AcceptRowChanges(x)}}}if(c){try{this.IntDS.insertId=c.insertId}catch(r){}this.IntDS.rowsAffected=c.rowsAffected}};IDCachedRowSet.prototype.AcceptRowChanges=function(a){this.originalValues[a]=undefined};IDCachedRowSet.prototype.RejectRowChanges=function(d){var a=this.originalValues[d];if(a!==undefined){var f=this.IntDS.rows.item(d);var e=Object.keys(f);for(var b=0;b<e.length;b++){var c=e[b];if(a[c]!==undefined){f[c]=a[c]}}this.originalValues[d]=undefined}};IDCachedRowSet.prototype.OnValueRowChange=function(c,a,b){if(this.originalValues[c]==-1){return}if(this.originalValues[c]==undefined){this.originalValues[c]=new HashTableSrv()}if(this.originalValues[c][a]==undefined){this.originalValues[c][a]=b}};IDCachedRowSet.prototype.GetColumnNamesByIntCmd=function(){var m=new Array();if(this.IntCmd){var f=false;var q=0;var n=new Array();if(this.IntDS&&this.IntDS.rows.length>0){n=Object.keys(this.IntDS.rows.item(0))}for(var g=0;g<this.IntCmd.length;g++){var o=false;var d=false;var l=this.IntCmd.charAt(g);switch(l){case"'":f=!f;break;case"(":if(!f){q++}break;case")":if(!f){q--}break;case",":if(!f&&q==0){o=true}break;case"f":case"F":if(!f&&q==0&&this.IntCmd.substr(g-1,6).toUpperCase().trim()=="FROM"){o=true;d=true}break}if(o||g==this.IntCmd.length-1){if(g==this.IntCmd.length-1){g++}var r=this.IntCmd.substr(0,g).trimRight();var a=r.charAt(r.length-1)=='"';for(var e=r.length-2;e>0;e--){if(((IDL.IsWhiteSpace(r.charAt(e))||r.charAt(e)==",")&&!a)||(r.charAt(e)=='"'&&a)||r.charAt(e)=="."){var h=r.substring(e+1,r.length-(a?1:0));if(h=="*"){for(var b=0;b<n.length;b++){m.push(n[b])}}else{for(var b=0;b<n.length;b++){if(n[b].toUpperCase()==h.toUpperCase()){h=n[b];break}}m.push(h)}break}}if(d){break}}}}return m};function IDConnection(){this.IntCon=null;this.Parent=null;this.DBType=-1;this.Transaction=null;this.QuerySubstSrc=new ArrayList();this.QuerySubstVal=new ArrayList();this.MaxRows=0;this.UseLimitClause=true;this.TransCount=0;this.iRecordsAffected=0;this.TransactionIsolation=2;this.iCacheQueries=1;this.UseAS400Date=false;this.sqlite_masterRS=null}IDConnection.prototype.ClearSubstitutions=function(){this.QuerySubstSrc.Clear();this.QuerySubstVal.Clear()};IDConnection.prototype.AddSubstitution=function(c,b){var a=this.QuerySubstSrc.IndexOf(c);if(a>-1){this.QuerySubstVal[a]=b}else{this.QuerySubstSrc.Add(c);this.QuerySubstVal.Add(b)}};IDConnection.prototype.ApplySubstitutions=function(c){if(this.QuerySubstSrc.Count()==0&&(this.MaxRows==0||!this.UseLimitClause)){return c}var b=c;for(var a=0;a<this.QuerySubstSrc.Count();a++){var e=this.QuerySubstSrc[a];var d=this.QuerySubstVal[a];b=b.Replace(e,d)}if(this.UseLimitClause&&this.MaxRows>0&&b.substr(0,6).toLowerCase()=="select"){b+=" limit "+this.MaxRows}return b};IDConnection.prototype.set_CommandTimeout=function(a){};IDConnection.prototype.set_ConnectionTimeout=function(a){};IDConnection.prototype.CommandTimeout=function(){};IDConnection.prototype.ConnectionTimeout=function(){};IDConnection.prototype.RecordsAffected=function(){if(this.IntCon.rowsAffected){this.iRecordsAffected=this.IntCon.rowsAffected()}return this.iRecordsAffected};IDConnection.prototype.CacheQueries=function(){return this.iCacheQueries};IDConnection.prototype.set_CacheQueries=function(a){this.iCacheQueries=a;if(this.IntCon){this.IntCon.cacheQueries=a}};IDConnection.prototype.IsOpen=function(){return(this.IntCon!=null)};IDConnection.prototype.BeginTrans=function(){if(this.Transaction==null){this.Transaction=-1}else{throw new Error("Nested transaction not allowed")}this.TransCount++};IDConnection.prototype.ExecuteTrans=function(a,g,b,d){if(d==undefined){d=true}var c;try{if(this.Transaction==-1){try{var h=this;this.IntCon.transaction(function(e){h.Transaction=e;c=a.apply(g,b)})}catch(f){if(this.Rollbacked){this.Rollbacked=false}else{throw f}}finally{this.Transaction=null}}else{c=a.apply(g,b)}}finally{if(d){delete a}}return c};IDConnection.prototype.ExecuteSQL=function(c,e,b){var a=null;if(this.Transaction){a=this.Transaction.executeSql(c,e)}else{var d;if(!b&&this.IntCon.readTransaction){d="readTransaction"}else{d="transaction"}this.IntCon[d](function(f){a=f.executeSql(c,e)})}return a};IDConnection.prototype.CommitTrans=function(){if(this.Transaction!=null){this.Transaction=null}else{throw new Error("No pending transaction")}this.TransCount--};IDConnection.prototype.RollbackTrans=function(){if(this.Transaction!=null){this.Transaction=null;this.Rollbacked=true;this.TransCount--;throw new Error("RollbackTrans")}};IDConnection.prototype.SetRemote=function(a,b){};IDConnection.prototype.SetLocal=function(){};IDConnection.prototype.Execute=function(c){var b=0;var a=(this.Transaction!=null);if(!a&&this.TransactionIsolation!=2){this.BeginTrans()}this.MaxRows=0;IDConnection.prototype.ExecuteTR=function(){try{var d=this.ExecuteSQL(this.ApplySubstitutions(c),undefined,true);if(d){b=d.rowsAffected}}catch(f){throw f}finally{if(!a&&this.TransactionIsolation!=2){this.CommitTrans()}}};this.ExecuteTrans(IDConnection.prototype.ExecuteTR,this);if(!c.startsWith("set identity_insert")){this.iRecordsAffected=b}};IDConnection.prototype.OpenRSR=function(b){var c=new IDCachedRowSet();var a=(this.Transaction!=null);if(!a&&this.TransactionIsolation!=2){this.BeginTrans()}IDConnection.prototype.OpenRSRTR=function(){try{c=this.OpenRS(b)}finally{if(!a&&this.TransactionIsolation!=2){this.CommitTrans()}}};this.ExecuteTrans(IDConnection.prototype.OpenRSRTR,this);if(!c.EOF()){c.MoveFirst()}return c};IDConnection.prototype.OpenRS=function(b){var a=new IDCachedRowSet();a.setCommand(this.ApplySubstitutions(b));a.setMaxRows(this.MaxRows);a.execute(null,this);this.MaxRows=0;return a};IDConnection.prototype.Open=function(f,d,b,a){this.DBType=a;try{this.IntCon=TryOpenDatabase(f,"",this.Parent.DBName,49*1024*1024);this.IntCon.cacheQueries=this.iCacheQueries;return(this.IntCon!=null)}catch(c){WriteToConsoleError("[IDConnection::Open] Can't open connection: "+c);throw c}};IDConnection.prototype.Close=function(){if(this.IntCon.close){this.IntCon.close()}this.IntCon=null};IDConnection.prototype.getConnection=function(){return this.IntCon};IDConnection.prototype.CallSP=function(b,c,d,a){};IDConnection.prototype.UpdateRS=function(a,b){b.setTableName(a);b.acceptChanges(this);return b};IDConnection.prototype.ExecuteIDPS=function(f,b){var c=(this.Transaction!=null);if(!c&&this.TransactionIsolation!=2){this.BeginTrans()}var a=null;try{IDConnection.prototype.ExecuteIDPSTR=function(){try{var j=new Array();for(var h=0;h<f.Parameters.Count();h++){var g=f.Parameters[h];if(g.Type==IDVariant.DATETIME){j.push(IDL.CSql(g,IDL.FMT_DAT1,this).Replace("#",""))}else{j.push(g.Value)}}var e=this.ExecuteSQL(f.Cmd,j,!b);if(b){a=new IDCachedRowSet();a.setMaxRows(f.MaxRows);a.populate(e);if(!a.EOF()){a.MoveFirst()}}else{this.iRecordsAffected=e.rowsAffected;if(!c&&this.TransactionIsolation!=2){this.CommitTrans()}}if(f.AutoClose){f.Close()}}finally{if(b&&!c&&this.TransactionIsolation!=2){this.CommitTrans()}}};this.ExecuteTrans(IDConnection.prototype.ExecuteIDPSTR,this)}catch(d){if(f.AutoClose){f.Close()}throw d}return(b?a:null)};IDConnection.prototype.GetSchema=function(b,a){};IDConnection.prototype.GetTableSchema=function(a,b){};IDConnection.prototype.GetTablePK=function(a){};IDConnection.prototype.GetTableFK=function(b,a){};IDConnection.prototype.AdjustSchemaObject=function(f,g,b,h,j,a){if(g.indexOf(b)!=-1){return}g.Add(b);this.sqlite_masterRS.MoveFirst();while(!this.sqlite_masterRS.EOF()){if(this.sqlite_masterRS.Get("name").stringValue()==b&&this.sqlite_masterRS.Get("type").stringValue()==j){var k=this.sqlite_masterRS.Get("sql").stringValue();if(k!=a){if(j=="table"){this.ModifyTableSchema(f,b,k,a)}else{var c=b;f.DTTObj.AddQuery("DB.AdjustSchemaObject",j+" "+b+": updating schema","DB.AdjustSchemaObject",DTTEngine.STMT_QRY_UPDATE,a);try{this.Execute("drop "+j+" "+c)}catch(d){}this.Execute(a);f.DTTObj.EndQuery("DB.AdjustSchemaObject")}}return}this.sqlite_masterRS.MoveNext()}f.DTTObj.AddQuery("DB.AdjustSchemaObject",j+" "+b+": Creating new","DB.AdjustSchemaObject",DTTEngine.STMT_QRY_INSVAL,a);this.Execute(a);f.DTTObj.EndQuery("DB.AdjustSchemaObject")};IDConnection.prototype.DropUselessObjects=function(e,g,c){var f="select name, tbl_name from sqlite_master";f+=" where type = '"+c+"'";f+=" and name not like 'sqlite%'";f+=" and name not like 'ZZ_%'";f+=" and name not like '__WebKit%'";f+=" and name not like 'android_%'";if(e.RTCObj.Enabled&&e.RTCObj.DB==this){f+=" and name not like 'RTC_%'";f+=" and name not like 'RTCU_%'"}var a=this.OpenRS(f);if(a.RecordCount()>0){a.MoveFirst()}while(!a.EOF()){var h=a.Get(1).stringValue();var b=a.Get(2).stringValue();var d=h;if(g.IndexOf(d)==-1){f="drop "+c+' "'+d+'"';e.DTTObj.AddQuery("DB.DropUselessObjects",c+" "+d+" is no more used: dropping","DB.AdjustSchemaObject",DTTEngine.STMT_QRY_DELETE,f);this.Execute(f);e.DTTObj.EndQuery("DB.DropUselessObjects")}a.MoveNext()}};IDConnection.prototype.ModifyTableSchema=function(g,l,d,a){var n=false;var f="";var j=new ArrayList();var m=new ArrayList();this.ExtractSqlToken(j,d);this.ExtractSqlToken(m,a);var c=this.PurgeList(j,m);if(c.Count()>0){n=true;f="need to drop or change";for(var e=0;e<c.Count();e++){var h=c[e];var o=h.indexOf(" ");var k=h;if(o>0){k=h.substr(0,o)}f+=" "+k}}else{c=this.PurgeList(m,j);for(var e=0;e<c.Count();e++){var u=c[e];var r=u.substr(0,11).toLowerCase();if(r=="primary key"||r=="foreign key"||r=="constraint "){f=r+" is changed";n=true;break}else{if(u.toLowerCase().indexOf("not null")>-1&&u.toLowerCase().indexOf("default")==-1){f=r+" is not null";n=true;break}else{var h=u;if(u.endsWith(",")){h=u.remove(u.length-1).trim()}var q="alter table "+l+" add column "+h;g.DTTObj.AddQuery("DB.ModifyTableSchema","Adding field "+h,"DB.ModifyTableSchema",DTTEngine.STMT_QRY_INSVAL,q);this.Execute(q);g.DTTObj.EndQuery("DB.ModifyTableSchema")}}}}if(n){this.Execute("alter table "+l+" rename to "+l+"_old");g.DTTObj.AddQuery("DB.ModifyTableSchema","Table "+l+": Recreating schema. Reason: "+f,"DB.ModifyTableSchema",DTTEngine.STMT_QRY_INSVAL,a);this.Execute(a);g.DTTObj.EndQuery("DB.ModifyTableSchema");this.MoveData(g,l,m,j);this.Execute("drop table "+l+"_old")}};IDConnection.prototype.MoveData=function(h,l,c,b){var m="insert into "+l+" select ";var g=true;for(var f=0;f<c.Count();f++){var n=c[f];var a=this.ExtractSqlFieldName(n);var k=a.toLowerCase();if(k=="primary"||k=="foreign"||k=="constraint"){continue}if(!g){m+=", "}g=false;var e=false;for(var d=0;d<b.Count();d++){if(this.ExtractSqlFieldName(b[d])==a){e=b[d];break}}if(e){if(n.indexOf("not null")>0&&e.indexOf("not null")==-1){m+="COALESCE(["+a+"], "+this.ExtractSqlFieldDefault(n)+")"}else{m+="["+a+"]"}}else{m+=this.ExtractSqlFieldDefault(n)}}m+=" from "+l+"_old";h.DTTObj.AddQuery("DB.MoveData","Table "+l+": Moving Data","DB.MoveData",DTTEngine.STMT_QRY_INSSEL,m);this.Execute(m);h.DTTObj.EndQuery("DB.MoveData")};IDConnection.prototype.ExtractSqlFieldDefault=function(c){c=c.toLowerCase();var a="NULL";if(c.indexOf("not null")>=0){var b=c.indexOf("default");if(b>-1){a=c.substr(b+8).trim();a=a.substring(a.indexOf("(")+1,a.indexOf(")"))}else{if(c.indexOf("varchar")>-1){a="'.'"}else{if(c.indexOf("date")>-1){a="CURRENT_DATE"}else{if(c.indexOf("time")>-1){a="CURRENT_TIME"}else{a="0"}}}}}return a};IDConnection.prototype.ExtractSqlFieldName=function(a){if(a.startsWith('"')){return a.substring(1,a.indexOf('"',1))}else{if(a.startsWith("[")){return a.substring(1,a.indexOf("]",1))}else{return a.substring(0,a.indexOf(" "))}}};IDConnection.prototype.ExtractSqlToken=function(f,e){var g=e.indexOf("(");var h=e.lastIndexOf(")");if(g==-1||h==-1||g>h){return}e=e.substr(g+1,h-g-1).trim();var d=false;var a=0;for(var b=0;b<e.length;b++){var j=e.charAt(b);if(j=="'"){d=!d}else{if(!d){if(j=="("){a++}else{if(j==")"){a--}else{if(j==","&&a==0){f.Add(e.substring(0,b).trim());e=e.substring(b+1);b=-1}}}}}}if(e.length>0){f.Add(e.trim())}};IDConnection.prototype.PurgeList=function(b,c){var a=new ArrayList();for(var d=0;d<b.Count();d++){var e=b[d];if(c.IndexOf(e)==-1){a.Add(e)}}return a};IDConnection.prototype.BackupDB=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("BACKUPDB",{CONNSTR:this.Parent.DefaultConnStr(),FILENAME:b});if(a!="OK"){throw new Error(a)}return}throw new Error("Backup not supported outside the Native Shell")};IDConnection.prototype.RestoreDB=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){this.Open(this.Parent.DefaultConnStr());this.Close();var a=RD4_WebEntryPoint.ShellObject.SendCmd("RESTOREDB",{CONNSTR:this.Parent.DefaultConnStr(),FILENAME:b});if(a!="OK"){throw new Error(a)}return}throw new Error("Restore not supported outside the Native Shell")};function IDFTP(){this.Index=0;if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_NEW");this.Index=parseInt(a,10);if(this.Index==0){throw new Error(a)}}}IDFTP.prototype.GetNative=function(){return this};IDFTP.prototype.PassiveMode=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_PASSIVEMODE",{INDEX:this.Index});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return(a.substring(2)=="1")}else{return false}}return false};IDFTP.prototype.set_PassiveMode=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_SETPASSIVEMODE",{INDEX:this.Index,MODE:(b?"1":"0")});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.IsConnected=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_ISCONNECTED",{INDEX:this.Index});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return(a.substring(2)=="1")}else{return false}}return false};IDFTP.prototype.Connect=function(c,b,d,e,f){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_CONNECT",{INDEX:this.Index,HOSTNAME:c.stringValue(),USERNAME:b.stringValue(),PASSWORD:d.stringValue(),TIMEOUT:e.intValue(),PORT:f.intValue(),SSHKEY:(this.sshKey||"")});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.Disconnect=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_DISCONNECT",{INDEX:this.Index});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.GetNumFiles=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETNUMFILES",{INDEX:this.Index});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.INTEGER)}else{return new IDVariant()}}return new IDVariant()};IDFTP.prototype.GetIsDirectory=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETISDIRECTORY",{INDEX:this.Index,FILE:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return(a.substring(2)=="1")}else{return false}}return false};IDFTP.prototype.GetFileName=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETFILENAME",{INDEX:this.Index,FILE:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.STRING)}else{return new IDVariant()}}};IDFTP.prototype.GetFileSize=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETFILESIZE",{INDEX:this.Index,FILE:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.INTEGER)}else{return new IDVariant()}}};IDFTP.prototype.GetFileDateTime=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETFILEDATETIME",{INDEX:this.Index,FILE:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.DATETIME)}else{return new IDVariant()}}};IDFTP.prototype.RenameRemoteFile=function(b,c){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_RENAMEFILE",{INDEX:this.Index,OLDFILE:b.stringValue(),NEWFILE:c.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return(a.substring(2)=="1")}else{return false}}return false};IDFTP.prototype.PutFile=function(f,c,d,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(d.stringValue().length==0){var e=Math.max(c.stringValue().lastIndexOf("/"),c.stringValue().lastIndexOf("\\"));if(e!=-1){d=new IDVariant(c.stringValue().substring(e+1))}else{d=new IDVariant(c)}}var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_PUTFILE",{INDEX:this.Index,LOCALPATH:c.stringValue(),REMOTEPATH:d.stringValue(),ASYNC:(b?"1":"0")});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.GetFile=function(f,d,c,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(c.stringValue().length==0){var e=Math.max(d.stringValue().lastIndexOf("/"),d.stringValue().lastIndexOf("\\"));if(e!=-1){c=new IDVariant(f.getRealPath()+"\\"+d.stringValue().substring(e+1))}else{c=new IDVariant(f.getRealPath()+"\\"+d.stringValue())}}var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETFILE",{INDEX:this.Index,REMOTEPATH:d.stringValue(),LOCALPATH:c.stringValue(),ASYNC:(b?"1":"0")});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.SetTransferType=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_SETTRANSFERTYPE",{INDEX:this.Index,TYPE:b.intValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.DeleteRemoteFile=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_DELETEREMOTEFILE",{INDEX:this.Index,FILENAME:b.stringValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.ChangeRemoteDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_CHANGEREMOTEDIR",{INDEX:this.Index,REMOTEDIR:b.stringValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.SendCommand=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_SENDCOMMAND",{INDEX:this.Index,CMD:b.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.STRING)}else{return new IDVariant()}}};IDFTP.prototype.CreateRemoteDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_CREATEREMOTEDIR",{INDEX:this.Index,DIRNAME:b.stringValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.RemoveRemoteDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_REMOVEREMOTEDIR",{INDEX:this.Index,DIRNAME:b.stringValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.UseSSH=function(){return(this.useSSH||false)};IDFTP.prototype.set_UseSSH=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_SETUSESSH",{INDEX:this.Index,USE:(b?"1":"0")});if(a!="OK"){throw new Error(a)}this.useSSH=b}};IDL.FMT_CHAR=0;IDL.FMT_NUM=1;IDL.FMT_DAT1=2;IDL.FMT_DAT2=3;IDL.FMT_DAT3=4;IDL.FMT_BOOL=5;IDL.FMT_DAT4=6;IDL.FMT_DAT5=7;IDL.FMT_DAT6=8;IDL.DatePatterns=new Array("dd/MM/yy","dd-MM-yy","dd/MM/yyyy","dd-MM-yyyy","yyyy/MM/dd","yyyy-MM-dd");IDL.TimePatterns=new Array("H:m:s","H.m.s","H:m","H.m");IDL.DayNames={"it-IT":["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"],"en-US":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]};IDL.MonthNames={"it-IT":["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],"en-US":["January","February","March","April","May","June","July","August","September","October","November","December"]};function IDL(){}IDL.NumericType=function(b,a){return(b.Type>a.Type)?b.Type:a.Type};IDL.Mod=function(b,a){return new IDVariant(b.intValue()%a.intValue(),1)};IDL.Pow=function(b,a){return new IDVariant(Math.pow(b.dblValue(),a.dblValue()))};IDL.Mul=function(c,b){var a=IDL.NumericType(c,b);switch(a){case IDVariant.DECIMAL:return new IDVariant(c.decValue()*b.decValue(),a);case IDVariant.FLOAT:return new IDVariant(c.dblValue()*b.dblValue(),a);case IDVariant.INTEGER:return new IDVariant(c.intValue()*b.intValue(),a);default:return new IDVariant()}};IDL.Div=function(c,b){var a=IDL.NumericType(c,b);switch(a){case IDVariant.DECIMAL:return new IDVariant(c.decValue()/b.decValue(),a);case IDVariant.FLOAT:return new IDVariant(c.dblValue()/b.dblValue(),a);case IDVariant.INTEGER:return new IDVariant(Math.floor(c.intValue()/b.intValue()),a);default:return new IDVariant()}};IDL.Add=function(c,b){var a=IDL.NumericType(c,b);switch(a){case IDVariant.DECIMAL:return new IDVariant(c.decValue()+b.decValue(),a);case IDVariant.FLOAT:return new IDVariant(c.dblValue()+b.dblValue(),a);case IDVariant.INTEGER:return new IDVariant(c.intValue()+b.intValue(),a);case IDVariant.STRING:return new IDVariant(c.stringValue().concat(b.stringValue()),a);case IDVariant.DATETIME:var f=c.dateValue();var d=b.dblValue()*IDVariant.MILLIS_DAY;var e=new Date(f.getTime()+d);if(e.dstOffset()-f.dstOffset()){e=new Date(e.getTime()-(e.dstOffset()-f.dstOffset()))}return new IDVariant(e,a);default:return new IDVariant()}};IDL.Sub=function(c,b){var a=IDL.NumericType(c,b);switch(a){case IDVariant.DECIMAL:return new IDVariant(c.decValue()-b.decValue(),a);case IDVariant.FLOAT:return new IDVariant(c.dblValue()-b.dblValue(),a);case IDVariant.INTEGER:return new IDVariant(c.intValue()-b.intValue(),a);case IDVariant.DATETIME:if(c.Type==IDVariant.DATETIME&&b.Type==IDVariant.DATETIME){return new IDVariant((c.dateValue().getTime()-b.dateValue().getTime())/IDVariant.MILLIS_DAY)}else{var f=c.dateValue();var d=b.dblValue()*IDVariant.MILLIS_DAY;var e=new Date(f.getTime()-d);if(e.dstOffset()-f.dstOffset()){e=new Date(e.getTime()-(e.dstOffset()-f.dstOffset()))}return new IDVariant(e,a)}default:return new IDVariant()}};IDL.Neg=function(a){switch(a.Type){case IDVariant.DECIMAL:return new IDVariant(-a.decValue(),a.Type);case IDVariant.FLOAT:return new IDVariant(-a.dblValue(),a.Type);case IDVariant.INTEGER:return new IDVariant(-a.intValue(),a.Type);default:return new IDVariant()}};IDL.IsNumber=function(a){switch(a.Type){case IDVariant.STRING:var c=new IDVariant(a);var b=new IDVariant(a);c.changeType(IDVariant.INTEGER);b.changeType(IDVariant.FLOAT);return c.Type!=IDVariant.NULL||b.Type!=IDVariant.NULL;default:return true}};IDL.Rnd=function(){return new IDVariant(Math.random())};IDL.Abs=function(a){switch(a.Type){case IDVariant.DECIMAL:return new IDVariant(Math.abs(a.decValue()),a.Type);case IDVariant.FLOAT:return new IDVariant(Math.abs(a.dblValue()),a.Type);case IDVariant.INTEGER:return new IDVariant(Math.abs(a.intValue()),a.Type);default:return new IDVariant()}};IDL.Int=function(a){switch(a.Type){case IDVariant.DECIMAL:return new IDVariant(Math.floor(a.decValue()),1);case IDVariant.FLOAT:return new IDVariant(Math.floor(a.dblValue()),1);case IDVariant.INTEGER:return a;default:return new IDVariant()}};IDL.Ceil=function(a){switch(a.Type){case IDVariant.DECIMAL:case IDVariant.FLOAT:return new IDVariant(Math.ceil(a.dblValue()),1);case IDVariant.INTEGER:return a;default:return new IDVariant()}};IDL.Floor=function(a){switch(a.Type){case IDVariant.DECIMAL:case IDVariant.FLOAT:return new IDVariant(Math.floor(a.dblValue()),1);case IDVariant.INTEGER:return a;default:return new IDVariant()}};IDL.Round=function(c,b){var g=c.Type;var e=b.intValue();var a=c.dblValue();var f=Math.pow(10,e);a=a*f;a=Math.round(a);a=a/f;return new IDVariant(a)};IDL.Trunc=function(e,b){var a=e.dblValue();var f=b.intValue();var g=Math.pow(10,f);a=a*g;a=Math.floor(a);a=a/g;var c=new IDVariant(a);c.changeType(e.Type);return c};IDL.Sign=function(a){switch(a.Type){case IDVariant.DECIMAL:case IDVariant.FLOAT:if(a.dblValue()==0){return new IDVariant(0,1)}else{if(a.dblValue()>0){return new IDVariant(1,1)}else{return new IDVariant(-1,1)}}case IDVariant.INTEGER:if(a.intValue()==0){return new IDVariant(0,1)}else{if(a.intValue()>0){return new IDVariant(1,1)}else{return new IDVariant(-1,1)}}default:return new IDVariant()}};IDL.Sqrt=function(a){return new IDVariant(Math.sqrt(a.dblValue()))};IDL.Exp=function(a){return new IDVariant(Math.exp(a.dblValue()))};IDL.Log=function(a){return new IDVariant(Math.log(a.dblValue()))};IDL.Log10=function(a){return new IDVariant(Math.log(a.dblValue())/Math.log(10))};IDL.Sin=function(a){return new IDVariant(Math.sin(a.dblValue()))};IDL.Cos=function(a){return new IDVariant(Math.cos(a.dblValue()))};IDL.Tan=function(a){return new IDVariant(Math.tan(a.dblValue()))};IDL.ArcSin=function(a){return new IDVariant(Math.asin(a.dblValue()))};IDL.ArcCos=function(a){return new IDVariant(Math.acos(a.dblValue()))};IDL.ArcTan=function(a){return new IDVariant(Math.atan(a.dblValue()))};IDL.Cot=function(a){return new IDVariant(1/Math.tan(a.dblValue()))};IDL.Sinh=function(b){var a=b.dblValue();return new IDVariant(0.5*(Math.exp(a)-Math.exp(-a)))};IDL.Cosh=function(b){var a=b.dblValue();return new IDVariant(0.5*(Math.exp(a)+Math.exp(-a)))};IDL.Tanh=function(b){var a=b.dblValue();return new IDVariant((Math.exp(2*a)-1)/(Math.exp(2*a)+1))};IDL.PI=function(a){return new IDVariant(Math.PI)};IDL.ToDegrees=function(a){return new IDVariant(a.dblValue()*360/(2*Math.PI))};IDL.ToRadians=function(a){return new IDVariant(a.dblValue()*(2*Math.PI)/360)};IDL.Now=function(){var a=new Date().getTime();a=a-a%1000;return new IDVariant(new Date(a))};IDL.Today=function(){var a=new Date();return new IDVariant(new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0))};IDL.Time=function(){var a=new Date();return new IDVariant(new Date(1899,11,30,a.getHours(),a.getMinutes(),a.getSeconds(),0))};IDL.ToDate=function(h,b,f){var g=h.intValue();var e=b.intValue();var a=f.intValue();var c=new IDVariant(new Date(g,e-1,a,0,0,0));return c};IDL.ToTime=function(c,a,b){return new IDVariant(new Date(1899,11,30,c.intValue(),a.intValue(),b.intValue(),0))};IDL.DateTimeEx=function(g,a,f,e,b,c){return new IDVariant(new Date(g.intValue(),a.intValue()-1,f.intValue(),e.intValue(),b.intValue(),c.intValue()))};IDL.Year=function(b){var a=new IDVariant(b.dateValue().getFullYear(),1);return a};IDL.Month=function(b){var a=new IDVariant(b.dateValue().getMonth()+1,1);return a};IDL.Day=function(b){var a=new IDVariant(b.dateValue().getDate(),1);return a};IDL.Hour=function(b){var a=new IDVariant(b.dateValue().getHours(),1);return a};IDL.Minute=function(b){var a=new IDVariant(b.dateValue().getMinutes(),1);return a};IDL.Second=function(b){var a=new IDVariant(b.dateValue().getSeconds(),1);return a};IDL.WeekDay=function(b){var a=new IDVariant(b.dateValue().getDay()+1,1);return a};IDL.YearDay=function(e){var c=new Date(e.dateValue().getFullYear(),0,1,0,0,0);var b=Math.floor((e.dateValue().getTime()-c.getTime())/IDVariant.MILLIS_DAY)+1;var a=new IDVariant(b,1);return a};IDL.Week=function(e){var c=e.dateValue();var a=new Date(c.getFullYear(),c.getMonth(),c.getDate());a.setDate(a.getDate()-((a.getDay()+6)%7)+3);var b=new Date(a.getFullYear(),0,4);b.setDate(b.getDate()-((b.getDay()+6)%7)+3);var f=(a-b)/(86400000*7);return new IDVariant(Math.round(1+f),1)};IDL.GetDate=function(a){return IDL.ToDate(IDL.Year(a),IDL.Month(a),IDL.Day(a))};IDL.GetTime=function(a){return IDL.ToTime(IDL.Hour(a),IDL.Minute(a),IDL.Second(a))};IDL.IsDate=function(b){switch(b.Type){case IDVariant.STRING:var a=IDL.ToDateTime(b);return(a.Type==IDVariant.DATETIME);default:return true}};IDL.DateAdd=function(j,h,e){var b=j.stringValue();var f=h.intValue();var c=e.dateValue();if(b=="yyyy"){c=new Date((c.getFullYear()+f),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="q"){c=new Date(c.getFullYear(),(c.getMonth()+f*3),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="m"){c=new Date(c.getFullYear(),(c.getMonth()+f),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="y"||b=="d"||b=="w"){c=new Date(c.getFullYear(),c.getMonth(),(c.getDate()+f),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="ww"){c=new Date(c.getFullYear(),c.getMonth(),(c.getDate()+f*7),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="h"){c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),(c.getHours()+f),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="n"){c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),(c.getMinutes()+f),c.getSeconds(),c.getMilliseconds())}else{if(b=="s"){c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),(c.getSeconds()+f),c.getMilliseconds())}}}}}}}}var a=new IDVariant(c);return a};IDL.FillLR=function(j,g,d,a){var m=j.stringValue();var c=g.intValue();if(m.length>=c){return j}var h=" ";if(d.stringValue().length>0){h=d.stringValue().charAt(0)}var b="";for(var e=0;e<c-m.length;e++){b=b+h}var k=null;if(a){k=new IDVariant(b+m)}else{k=new IDVariant(m+b)}return k};IDL.Find=function(d,a,b){var g=0;if(b){g=b.intValue()}if(g>0){g=g-1}try{var c=d.stringValue().indexOf(a.stringValue(),g);return new IDVariant(c+1,1)}catch(f){return new IDVariant(0,1)}};IDL.ReverseFind=function(d,a,b){var g=d.stringValue().length;if(b){g=b.intValue()}if(g>0){g=g-1}try{var c=d.stringValue().lastIndexOf(a.stringValue(),g);return new IDVariant(c+1,1)}catch(f){return new IDVariant(0,1)}};IDL.SubStr=function(e,d,c){var g,f;var a=2147483647;if(c){a=c.intValue()}var b=e.stringValue();if(e.Type==IDVariant.NULL){return new IDVariant()}if(a<=0){return new IDVariant("")}g=d.intValue();if(g>0){g=g-1}f=((g+a)>2147483647?2147483647:g+a);if(g<0){g=0}if(f>b.length){f=b.length}return new IDVariant(e.stringValue().substr(g,f-g))};IDL.Left=function(b,a){return IDL.SubStr(b,new IDVariant(1),a)};IDL.Right=function(d,c){var a=c.intValue();var b=d.stringValue();if(a<=0){return new IDVariant("")}var e=b.length-a+1;return IDL.SubStr(d,new IDVariant(e))};IDL.Length=function(a){return new IDVariant(a.stringValue().length,1)};IDL.Lower=function(a){return new IDVariant(a.stringValue().toLowerCase())};IDL.Upper=function(a){return new IDVariant(a.stringValue().toUpperCase())};IDL.Replace=function(d,b,a){var e=d.stringValue();var c=b.stringValue();var f=a.stringValue();c=c.replace(/[-[\]{}()*+?.,\\^$|#\s]/gm,"\\$&");return new IDVariant(e.replace(new RegExp(c,"gm"),f))};IDL.IsWhiteSpace=function(a){return(" \t\n\v\f\r".indexOf(a)!=-1)};IDL.Trim=function(c,a,b){if(c.Type==IDVariant.NULL){return new IDVariant()}var d=c.stringValue();if(b){while(d.length>0&&IDL.IsWhiteSpace(d.charAt(d.length-1))){d=d.substring(0,d.length-1)}}if(a){while(d.length>0&&IDL.IsWhiteSpace(d.charAt(0))){d=d.substring(1,d.length)}}return new IDVariant(d.toString())};IDL.Replicate=function(b,g){var f=b.stringValue();var h;var a=g.intValue();if(f.length>0){h=f.charAt(0)}else{h=" "}var e="";for(var d=0;d<a;d++){e=e+h}return new IDVariant(e)};IDL.Substitute=function(f,h,d,b){var m=f.stringValue();var j=b.stringValue();var k=h.intValue();var c=d.intValue();var a=m.slice(0,k);var g=m.slice(k+c,m.length);var e=a.concat(j).concat(g);return new IDVariant(e)};IDL.ASCII=function(b){var a=b.stringValue();if(a.length>0){return new IDVariant(PdfFont.WinAnsiDecode(a.charAt(0)),1)}else{return new IDVariant()}};IDL.CHR=function(a){return new IDVariant(String.fromCharCode(a.intValue()))};IDL.ToInteger=function(a){if(a.Type==IDVariant.INTEGER){return a}else{return new IDVariant(a.intValue(),1)}};IDL.ToFloat=function(a){if(a.Type==IDVariant.FLOAT){return a}else{return new IDVariant(a.dblValue(),IDVariant.FLOAT)}};IDL.ToCurrency=function(a){if(a.Type==IDVariant.DECIMAL){return a}else{return new IDVariant(a.decValue(),IDVariant.DECIMAL)}};IDL.ToDateTime=function(d,c){if(d.Type==IDVariant.DATETIME){return d}else{if(d.Type==IDVariant.STRING){var h=d.stringValue();if(h.trim().length==0){return new IDVariant()}var f=h.trim().split(" ");if(f.length>2){return new IDVariant()}var b=null;if(c!=null){var e=c.stringValue();e=e.Replace("m","M");e=e.Replace("n","m");e=e.Replace("h","H");if(e.indexOf(" ")!=-1){var j=e.trim().split(" ");e=j[0]}b=IDL.applyPattern(f[0],e)}if(b==null){for(var g=0;g<IDL.DatePatterns.length;g++){b=IDL.applyPattern(f[0],IDL.DatePatterns[g]);if(b!=null){break}}}if(b==null&&f.length==1){for(var g=0;g<IDL.TimePatterns.length;g++){b=IDL.applyPattern(f[0],IDL.TimePatterns[g]);if(b!=null){return new IDVariant(b)}}}if(b==null){return new IDVariant()}var a=null;if(f.length==2){for(var g=0;g<IDL.TimePatterns.length;g++){a=IDL.applyPattern(f[1],IDL.TimePatterns[g]);if(a!=null){break}}if(a==null){return new IDVariant()}}if(f.length==1){return new IDVariant(b)}else{b.setHours(a.getHours());b.setMinutes(a.getMinutes());b.setSeconds(a.getSeconds());return new IDVariant(b)}}else{return new IDVariant(d.dateValue())}}};IDL.ToString=function(a){if(a.Type==IDVariant.STRING){return a}else{return new IDVariant(a.stringValue())}};IDL.DateToISOString=function(a){return new IDVariant(a.dateValue().toISOString())};IDL.ISOStringToDate=function(a){return new IDVariant(new Date(a.stringValue()))};IDL.NullValue=function(b,a){if(b.Type==IDVariant.NULL){return a}else{return b}};IDL.IsNull=function(a){return(a.Type==IDVariant.NULL)};IDL.Btv=function(a){if(a){return IDVariant.TRUE}else{return IDVariant.FALSE}};IDL.BlobSize=function(a){if(a.Type==IDVariant.STRING&&a.Value.startsWith("QkxPQ")){return atob(a.Value).length}if(a.Type!=IDVariant.BLOB){return 0}var b=a.Value;return(b==null?0:b.length)};IDL.Quote=function(e){if(e instanceof IDVariant){e=e.stringValue()}var a=e;var d=0;while(d<a.length){if(a.charAt(d)=="'"){var b=a.slice(0,d)+"'";b=b+a.slice(d);a=b;d++}d++}a="'"+a+"'";return a};IDL.CSql=function(h,b,l,k){if(typeof h==="boolean"){h=new IDVariant(h)}if(k==undefined){k=0}if(IDL.IsNull(h)){return"NULL"}var g=false;if(l!=null&&(Glb.ClassDB(l.DBType)==Glb.DBC_SQLSRV||Glb.ClassDB(l.DBType)==Glb.DBC_ORACLE)){if(l.Unicode){g=(k!=-1)}else{g=(k==1)}}switch(b){case IDL.FMT_CHAR:var a=IDL.Quote(h);var d=(g?2000:4000);if(l!=null&&Glb.ClassDB(l.DBType)==Glb.DBC_ORACLE&&b==FMT_CHAR&&a.length>d){a=a.substring(1,a.length-1);var c="";while(a.length>0){if(c.length>0){c+=" || "}c+="TO_CLOB(";if(g){c+="N"}c+="'";c+=a.substring(0,Math.min(d,a.length));c+="')";a=a.substring(Math.min(d,a.length))}return c}return((g)?"N":"")+a;case IDL.FMT_NUM:if(h.Type==IDVariant.DECIMAL||h.Type==IDVariant.FLOAT||h.Type==IDVariant.INTEGER){return h.stringValue()}else{return new IDVariant(h.dblValue()).stringValue()}case IDL.FMT_DAT1:case IDL.FMT_DAT2:case IDL.FMT_DAT3:case IDL.FMT_DAT4:case IDL.FMT_DAT5:case IDL.FMT_DAT6:var e="";switch(b){case IDL.FMT_DAT1:e="#yyyy-mm-dd hh:nn:ss#";break;case IDL.FMT_DAT2:e="{'ts' \\'yyyy-mm-dd hh:nn:ss\\'}";break;case IDL.FMT_DAT3:e="'TO_TIMESTAMP'(\\'yyyy-mm-dd hh:nn:ss\\', \\''YYYY-MM-DD HH24:MI:SS\\'')";break;case IDL.FMT_DAT4:e="'DATETIME'(''yyyy-mm-dd hh:nn:ss'')";break;case IDL.FMT_DAT5:e="'DATE'(''yyyy-MM-dd'')";break;case IDL.FMT_DAT6:e="'TIMESTAMP'(''yyyy-MM-dd HH:mm:ss'')";break}var j=IDL.Format(h,new IDVariant(e),null);return j.stringValue();case IDL.FMT_BOOL:if(h.booleanValue()){return"1 = 1"}else{return"0 = 1"}}return""};IDL.Format=function(j,d,l,c,n,b){if(c==undefined){c=new IDVariant()}if(n==undefined){n=new IDVariant()}if(b==undefined){b=new IDVariant()}var f=d.stringValue();if(f.length>0){if(j.Type==IDVariant.STRING){var m=new IDVariant(j);if(IDL.IsNumber(m)){m.changeType(IDVariant.DECIMAL)}else{if(IDL.IsDate(m)){m.changeType(IDVariant.DATETIME)}}j=m}switch(j.Type){case IDVariant.DECIMAL:case IDVariant.FLOAT:case IDVariant.INTEGER:try{var a=".";var g=",";if(c!=null&&c.Type!=IDVariant.NULL){a=c.stringValue()}else{if(l!=null){if(l instanceof WebEntryPointSrv){a=l.UseDecimalDot()?".":","}}}if(n!=null&&n.Type!=IDVariant.NULL){g=n.stringValue()}else{if(l!=null){if(l instanceof WebEntryPointSrv){g=l.UseDecimalDot()?",":"."}}}var k="";switch(j.Type){case IDVariant.DECIMAL:k=IDL.FormatNumber(j.decValue(),f,a,g);break;case IDVariant.FLOAT:k=IDL.FormatNumber(j.dblValue(),f,a,g);break;case IDVariant.INTEGER:k=IDL.FormatNumber(j.longValue(),f,a,g);break}return new IDVariant(k.toString())}catch(h){}break;case IDVariant.DATETIME:try{var o;if(b.Type!=IDVariant.NULL){o=b.stringValue()}else{if(l&&l.GetAppLanguage()=="ITA"){o="it-IT"}else{o="en-US"}}var k=IDL.FormatDate(j.dateValue(),f,o);return new IDVariant(k)}catch(h){}break}}return new IDVariant(j.stringValue())};IDL.FormatNumber=function(d,s,g,n){var r="";for(var t=0;t<s.length;t++){if(s.charAt(t)=="#"||s.charAt(t)=="0"){break}r+=s.charAt(t)}var e="";for(var t=s.length-1;t>=0;t--){if(s.charAt(t)=="#"||s.charAt(t)=="0"){break}e=s.charAt(t)+e}if(r.length>0||e.length>0){s=s.substr(r.length,s.length-r.length-e.length)}if(s.indexOf(";")!=-1){var j=s.split(";");if(d>0){s=j[0]}else{s=j[1]}}var o=s.split(".");var f=o[0];var u=(o.length>1?o[1]:"");d=Math.round(d*(Math.pow(10,u.length)))/Math.pow(10,u.length);o=d.toString().split(".");var q=o[0];var l=(o.length>1?o[1]:"");if(d<0){q=q.replace("-","")}var a="";for(var t=0;t<u.length;t++){if(u.charAt(t)=="0"){a=a+(l.charAt(t)==""?"0":l.charAt(t))}if(u.charAt(t)=="#"){a=a+(l.charAt(t)==""||l.charAt(t)=="0"?" ":l.charAt(t))}}a=IDL.Trim(new IDVariant(a),false,true).stringValue();a=a.replace(new RegExp(" ","g"),"0");var v="";var m=q.length-1;var b=f.length-1;if(f.charAt(0)=="#"&&f.replace(/,/g,"").length<q.length){var c=q.length;var h=f.replace(/,/g,"").length;for(var t=h;t<c;t++){if(f.substring(0,3)=="###"){f=","+f}f="#"+f}b=f.length-1}if(q.length<=f.length){for(var t=0;b>=0;t++){var k="";if(b>=0){k=f.charAt(b)}else{if((t%3)==0){k=","}else{k=f.charAt(0)}}switch(k){case"0":v=(q.charAt(m)==""?"0":q.charAt(m))+v;m--;break;case"#":if(m<0){t=0}else{v=q.charAt(m)+v;m--}break;case",":if(m<0){t=0}else{v=n+v}break}b--}}else{v=q.toString()}if(d<0){v="-"+v}v=IDL.Trim(new IDVariant(v),true,false).stringValue();v=v.replace(new RegExp(" ","g"),"0");var x=v;if(a.length>0){x=x+g+a}x=r+x+e;return x};IDL.FormatDate=function(H,B,A){var F=H.getDate().toString();var I=H.getDate().toString();if(I.length<2){I="0"+I}var y=H.getMonth()+1;var E=(H.getMonth()+1).toString();if(E.length<2){E="0"+E}var v=H.getFullYear().toString().substring(2,4);var u=H.getFullYear().toString();var D=H.getHours().toString();var j=H.getHours().toString();if(j.length<2){j="0"+j}var x=H.getMinutes().toString();var f=H.getMinutes().toString();if(f.length<2){f="0"+f}var t=H.getSeconds().toString();var z=H.getSeconds().toString();if(z.length<2){z="0"+z}var o=false;var C="";for(var J=0;J<B.length;J++){var r=B.charAt(J);if(r=="'"){if(B.substr(J,2)=="''"){J+=1}else{r="";o=!o}}if(!o){switch(r){case"y":var e=B.substr(J,4);var c=B.substr(J,2);if(e=="yyyy"){r=u;J+=3}else{if(c=="yy"){r=v;J+=1}}break;case"m":var e=B.substr(J,4);var c=B.substr(J,3);var a=B.substr(J,2);if(e=="mmmm"){var q=IDL.MonthNames[A];var l=q?q[H.getMonth()]:H.toLocaleDateString(A,{month:"long"});r=l;J+=3}else{if(c=="mmm"){var q=IDL.MonthNames[A];var b=q?q[H.getMonth()].substring(0,3):H.toLocaleDateString(A,{month:"short"});r=b;J+=2}else{if(a=="mm"){r=E;J+=1}else{r=y}}}break;case"d":var e=B.substr(J,4);var c=B.substr(J,3);var a=B.substr(J,2);if(e=="dddd"){var G=IDL.DayNames[A];var g=G?G[H.getDay()]:H.toLocaleDateString(A,{weekday:"long"});r=g;J+=3}else{if(c=="ddd"){var G=IDL.DayNames[A];var k=G?G[H.getDay()].substring(0,3):H.toLocaleDateString(A,{weekday:"short"});r=k;J+=2}else{if(a=="dd"){r=I;J+=1}else{r=F}}}break;case"h":var e=B.substr(J,2);if(e=="hh"){r=j;J+=1}else{r=D}break;case"n":var e=B.substr(J,2);if(e=="nn"){r=f;J+=1}else{r=x}break;case"s":var e=B.substr(J,2);if(e=="ss"){r=z;J+=1}else{r=t}break}}C+=r}return C};IDL.StringToNumber=function(d,l,b,m){if(b==undefined){b=new IDVariant()}if(m==undefined){m=new IDVariant()}var c=false;if(l!=null&&l instanceof WebEntryPointSrv){c=l.UseDecimalDot()}var a=(b!=null&&b.Type!=IDVariant.NULL?b.stringValue():(c?".":","));var f=(m!=null&&m.Type!=IDVariant.NULL?m.stringValue():(c?",":"."));try{var n=d.stringValue();if(f.length&&n.indexOf(f)!=-1){n=n.replace(new RegExp("\\"+f,"g"),"")}var j=parseFloat(n);if(j>=10000000000000000){try{var k=BigInt(d.stringValue());j=k}catch(h){}}return new IDVariant(j,IDVariant.FLOAT)}catch(g){return new IDVariant()}};IDL.NumberToString=function(f,h,b,j){if(b==undefined){b=new IDVariant()}if(j==undefined){j=new IDVariant()}var c=h.UseDecimalDot();var a=(b!=null&&b.Type!=IDVariant.NULL?b.stringValue():(c?".":","));var e=(j!=null&&j.Type!=IDVariant.NULL?j.stringValue():(c?",":"."));var g;switch(f.Type){case IDVariant.INTEGER:g=f.intValue().toString();break;case IDVariant.FLOAT:g=f.dblValue().toString();break;case IDVariant.DECIMAL:g=f.decValue().toString();break;default:g=f.stringValue();break}var d=g.toString().split(".");return new IDVariant(d[0].replace(/\B(?=(\d{3})+(?!\d))/g,e)+(d[1]?a+d[1]:""))};IDL.FormatMessage=function(c,b,a,g,f,e,d){if(b==undefined){b=new IDVariant()}if(a==undefined){a=new IDVariant()}if(g==undefined){g=new IDVariant()}if(f==undefined){f=new IDVariant()}if(e==undefined){e=new IDVariant()}if(d==undefined){d=new IDVariant()}if(b!=null){c=IDL.Replace(c,new IDVariant("|1"),b)}if(a!=null){c=IDL.Replace(c,new IDVariant("|2"),a)}if(g!=null){c=IDL.Replace(c,new IDVariant("|3"),g)}if(f!=null){c=IDL.Replace(c,new IDVariant("|4"),f)}if(e!=null){c=IDL.Replace(c,new IDVariant("|5"),e)}if(d!=null){c=IDL.Replace(c,new IDVariant("|6"),d)}return c};IDL.Type2DT=function(a){return a};IDL.DT2Type=function(a){return a};IDL.QbeMatch=function(o,H,z,r,m){if(r==undefined){r=new IDVariant(";")}if(m==undefined){m=false}var h=H.stringValue();if(h.length==0){return true}var K;var L=-1,J=-1;var Q=true;if(h.charAt(0)=="§"){h=h.substr(1);Q=false}var x=(z!=null&&z.ParamsObj().QBETrueLessThan);var F=(z!=null?z.ParamsObj().PanelsLikeMode:Glb.PAN_LIKESTARTS);var N=false;do{var u=false;nextToken:{if(h.charAt(0)!="="||m){L=h.indexOf(r.stringValue(),L+1)}if(L>=0){K=h.substr(J+1,(L)-(J+1))}else{K=h.substr(J+1)}if(K.length>0){u=true;if(m){K="="+K}if(K.length>1&&K.charAt(0)==">"){if(x){u=(o.Type!=IDVariant.NULL&&o.CompareTo(new IDVariant(K.substr(1),o.Type))>0)}else{u=(o.Type!=IDVariant.NULL&&o.CompareTo(new IDVariant(K.substr(1),o.Type))>=0)}if(o.Type==IDVariant.DATETIME){var M=IDL.ParsePartialDate(z,K.substr(1),(x?1:0));if(M.Type!=IDVariant.NULL){u=(o.CompareTo(M)>=0)}}break nextToken}if(K.length>1&&K.charAt(0)=="<"){if(x){u=(o.Type!=IDVariant.NULL&&o.CompareTo(new IDVariant(K.substr(1),o.Type))<0)}else{u=(o.Type!=IDVariant.NULL&&o.CompareTo(new IDVariant(K.substr(1),o.Type))<=0)}if(o.Type==IDVariant.DATETIME){var M=IDL.ParsePartialDate(z,K.substr(1),(x?0:1));if(M.Type!=IDVariant.NULL){u=(o.CompareTo(M)<0)}}break nextToken}if(K.length==1&&K.charAt(0)=="."){u=(o.stringValue().length!=0);break nextToken}if(K.length==1&&K.charAt(0)=="!"){u=(o.Type==IDVariant.NULL||o.stringValue().length==0);break nextToken}if(K.length>1&&K.charAt(0)=="#"){K=K.substr(1);if(Q&&o.Type==IDVariant.STRING){if(K.indexOf("*")==-1&&K.indexOf("%")==-1){K=(F==Glb.PAN_LIKECONTAINS?"*":"")+K+"*"}K=K.replace(/\*/g,"%");var A=o.stringValue().toLowerCase();var O=K.toLowerCase();O="^"+O;O=O.replace(/\[!/g,"[^");O=O.replace(/#/g,"\\d");O=O.replace(/\?/g,".");O=O.replace(/%/g,".*");var g=O.length;for(var I=0;I<g-2;I++){if(O.charAt(I)=="["&&O.charAt(I+2)=="]"){var C=O.slice(0,I)+"\\"+O.slice(I+1,I+2)+O.slice(I+3);O=C}}O=O.replace("(","\\(");O=O.replace(")","\\)");O=O.replace("[","\\[");O=O.replace("]","\\]");O+="$";u=!(new RegExp(O,"m")).test(A)}else{u=(o.CompareTo(new IDVariant(K,o.Type))!=0);if(o.Type==IDVariant.DATETIME){var s=IDL.ParsePartialDate(z,K,0);var q=IDL.ParsePartialDate(z,K,1);if(s.Type!=IDVariant.NULL){u=(o.CompareTo(s)<0||o.CompareTo(q)>=0)}}}break nextToken}if(K.length>1&&K.charAt(0)=="="){u=(o.Type!=IDVariant.NULL&&o.CompareTo(new IDVariant(K.substr(1),o.Type))==0);break nextToken}if(o.Type==IDVariant.STRING&&K.length>1&&K.charAt(K.length-1)=="&"){var B=o.stringValue();var j=K.substr(0,(K.length-1));u=(IDL.SoundEx(B)==IDL.SoundEx(j));break nextToken}var D;D=K.indexOf(":");if(D>=0){var y=false;if(o.Type==IDVariant.DATETIME){y=true;var s=IDL.ParsePartialDate(z,K.substr(0,D),0);var q=IDL.ParsePartialDate(z,K.substr(D+1),1);var n=(s.Type!=IDVariant.NULL||q.Type!=IDVariant.NULL);if(K.indexOf("/")!=-1||K.indexOf("-")!=-1||n){var P;var l=K.length;for(P=D+1;P<l;P++){if(K.charAt(P)==":"){D=P}else{if(K.charAt(P)=="/"||K.charAt(P)=="-"){break}}}if(P<=K.length){var e=new IDVariant(K.substr(0,D));var a=new IDVariant(K.substr(D+1));if(s.Type==IDVariant.NULL){e.changeType(IDVariant.DATETIME)}if(q.Type==IDVariant.NULL){a.changeType(IDVariant.DATETIME)}if(e.Type!=IDVariant.NULL&&a.Type!=IDVariant.NULL){if(s.Type==IDVariant.NULL&&q.Type==IDVariant.NULL){u=(o.CompareTo(e)>=0&&o.CompareTo(a)<=0)}else{if(s.Type==IDVariant.NULL){u=(o.CompareTo(e)>=0)}else{u=(o.CompareTo(s)>=0)}if(u){if(q.Type==IDVariant.NULL){u=(o.CompareTo(a)<=0)}else{u=(o.CompareTo(q)<0)}}}}else{if(e.Type!=IDVariant.NULL){if(s.Type==IDVariant.NULL){u=(o.CompareTo(e)>=0)}else{u=(o.CompareTo(s)>=0)}}else{if(a.Type!=IDVariant.NULL){if(q.Type==IDVariant.NULL){u=(o.CompareTo(a)<=0)}else{u=(o.CompareTo(q)<0)}}}}break nextToken}}else{var k=new ArrayList();var l=K.length;for(var P=0;P<l;P++){if(K.charAt(P)==":"){k.Add(P)}}if(k.Count()>2&&(k.Count()%2)==1){D=k[(k.Count()-1)/2];var f=new IDVariant(K.substr(0,D),o.Type);var b=new IDVariant(K.substr(D+1),o.Type);if(f.Type!=IDVariant.NULL&&b.Type!=IDVariant.NULL){u=(o.CompareTo(f)>=0&&o.CompareTo(b)<=0)}else{if(f.Type!=IDVariant.NULL){u=(o.CompareTo(f)>=0)}else{if(b.Type!=IDVariant.NULL){u=(o.CompareTo(b)<=0)}}}break nextToken}}}if(!y){if(o.Type==IDVariant.NULL){u=false}else{var f=new IDVariant(K.substr(0,D),o.Type);var b=new IDVariant(K.substr(D+1),o.Type);if(f.Type!=IDVariant.NULL&&b.Type!=IDVariant.NULL){u=(o.CompareTo(f)>=0&&o.CompareTo(b)<=0)}else{if(f.Type!=IDVariant.NULL){u=(o.CompareTo(f)>=0)}else{if(b.Type!=IDVariant.NULL){u=(o.CompareTo(b)<=0)}}}}break nextToken}}var t;t=K.indexOf(" ")>=0&&(K.indexOf(":")>=0||K.indexOf(".")>=0);var G=IDL.ParsePartialDate(z,K,0);var E=IDL.ParsePartialDate(z,K,1);if(o.Type==IDVariant.DATETIME&&G.Type!=IDVariant.NULL){u=(o.CompareTo(G)>=0&&o.CompareTo(E)<0);break nextToken}if(o.Type==IDVariant.DATETIME&&!t){var f=new IDVariant(K,o.Type);var b=new IDVariant(K+" 23:59:59",o.Type);u=(o.CompareTo(f)>=0&&o.CompareTo(b)<=0);break nextToken}else{if(Q&&o.Type==IDVariant.STRING){if(K.indexOf("*")==-1&&K.indexOf("%")==-1){K=(F==Glb.PAN_LIKECONTAINS?"*":"")+K+"*"}K=K.replace(/\*/g,"%");var A=o.stringValue().toLowerCase();var O=K.toLowerCase();O="^"+O;O=O.replace(/\[!/g,"[^");O=O.replace(/#/g,"\\d");O=O.replace(/\?/g,".");O=O.replace(/%/g,".*");var g=O.length;for(var I=0;I<g-2;I++){if(O.charAt(I)=="["&&O.charAt(I+2)=="]"){var C=O.slice(0,I)+"\\"+O.slice(I+1,I+2)+O.slice(I+3);O=C}}O=O.replace("(","\\(");O=O.replace(")","\\)");O=O.replace("[","\\[");O=O.replace("]","\\]");O+="$";u=(new RegExp(O,"m")).test(A)}else{u=(o.Type!=IDVariant.NULL&&o.CompareTo(new IDVariant(K,o.Type))==0)}break nextToken}}}J=L;N|=u}while(L>=0);return N};IDL.SoundEx=function(h){var j="";if(h!=null&&h.length>0){h=h.toLowerCase();j=j+h.substr(0,1);var g="";var d=h.length;for(var e=1;e<d;e++){var a=h.charAt(e);var f="";if("bfpv".indexOf(a)>-1){f="1"}else{if("cgjkqsxz".indexOf(a)>-1){f="2"}else{if("dt".indexOf(a)>-1){f="3"}else{if(a=="l"){f="4"}else{if("mn".indexOf(a)>-1){f="5"}else{if(a=="r"){f="6"}}}}}}if(f!=g){j=j+f}if(j.length==4){break}if(f!=""){g=f}}}if(j.length<4){var b=4-j.length;var c="";for(var e=0;e<b;e++){c=c+"0"}j=j+c}return j.toUpperCase()};IDL.DataType2IDVariantType=function(a){switch(a){case Glb.DT_BOOLEAN:case Glb.DT_NUM_INTEGER:return IDVariant.INTEGER;case Glb.DT_NUM_FLOAT:return IDVariant.FLOAT;case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:return IDVariant.DECIMAL;case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:case Glb.DT_DOC_TEXT:return IDVariant.STRING;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:return IDVariant.DATETIME;case Glb.DT_DOC_OLE:return IDVariant.BLOB}return IDVariant.NULL};IDL.ParsePartialDate=function(l,m,n){if(n==undefined){n=0}try{var j=new IDVariant();var k=new RegExp("^\\d{4}$","").exec(m);if(k!=null){j=IDL.ToDate(new IDVariant(m),new IDVariant(1),new IDVariant(1));if(n!=0){j=IDL.DateAdd(new IDVariant("yyyy"),new IDVariant(n),j)}return j}k=new RegExp("^(\\d{1,2})[\\/-](\\d{4})$","").exec(m);if(k!=null){j=IDL.ToDate(new IDVariant(k[2]),new IDVariant(k[1]),new IDVariant(1));if(n!=0){j=IDL.DateAdd(new IDVariant("m"),new IDVariant(n),j)}return j}if(l!=null){if(m.toLowerCase()==l.RTCObj.GetConst("982BE4E3-A288-4AD4-A4D6-426F4E62BEDB","Oggi",false).toLowerCase()){j=IDL.Today()}else{if(m.toLowerCase()==l.RTCObj.GetConst("A4E7F53D-043D-435F-8089-E1C6495A13B0","Domani",false).toLowerCase()){j=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today())}else{if(m.toLowerCase()==l.RTCObj.GetConst("8052BA86-1C6A-4268-BABA-28CA9E6F94E7","Ieri",false).toLowerCase()){j=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today())}}}if(j.Type!=IDVariant.NULL){if(n!=0){j=IDL.DateAdd(new IDVariant("d"),new IDVariant(n),j)}return j}var b=l.RTCObj.GetConst("FC8AF728-7517-4b68-B213-80CAE61F3D90","gen;feb;mar;apr;mag;giu;lug;ago;set;ott;nov;dic",false).split(";");var c=IDL.Year(IDL.Today());for(var g=0;g<b.length;g++){if(m.toLowerCase()==b[g].toLowerCase()){j=IDL.ToDate(c,new IDVariant(g+1),new IDVariant(1));if(n!=0){j=IDL.DateAdd(new IDVariant("m"),new IDVariant(n),j)}return j}}k=new RegExp("^([a-zA-Z]{3}) (\\d{4})$","").exec(m);if(k!=null){var a=k[1];var f=k[2];for(var g=0;g<b.length;g++){if(a.toLowerCase()==b[g].toLowerCase()){j=IDL.ToDate(new IDVariant(f),new IDVariant(g+1),new IDVariant(1));if(n!=0){j=IDL.DateAdd(new IDVariant("m"),new IDVariant(n),j)}return j}}}}}catch(h){}return new IDVariant()};IDL.HttpRequest=function(n,y,I,o,c){if(I==undefined){I=null}if(o==undefined){o=null;c=null}else{if(c==undefined){c=new IDVariant()}}var a=new XMLHttpRequest();var k=(I==null?"GET":"POST");if(I!=null){var x=I.get_Value(new IDVariant("ID_TYPE")).stringValue();if(x.length>0){k=x}}var j="";if(I!=null){var z=I.GetKeys();for(var G=0;G<z.Size();G++){var N=z.get_Value(new IDVariant(G));var g=N.stringValue();if(g.startsWith("ID_")){continue}if(j.length!=0){j+="&"}var h=I.get_Value(N).stringValue();j+=g+"="+encodeURIComponent(h)}}var E=y.stringValue();if(!E.toLowerCase().startsWith("http://")&&!E.toLowerCase().startsWith("https://")&&!E.toLowerCase().startsWith("blob:")){E="http://"+E}if(j.length>0){if(!k.equals("GET")){if(I!=null&&I.get_Value(new IDVariant("ID_BODY")).stringValue().length>0){E+=(E.indexOf("?")==-1?"?":"&")+j}}else{E+=(E.indexOf("?")==-1?"?":"&")+j}}if(o!=null&&c!=null&&o.stringValue().length>0){a.open(k,E,false,o,c)}else{a.open(k,E,false)}if(I!=null){var b=I.get_Value(new IDVariant("ID_TIMEOUT"));if(b.Type!=IDVariant.NULL){a.timeout=b.intValue()*1000}}if(I!=null){var u=I.get_Object(new IDVariant("ID_HEADERS"));if(u!=null){if(u instanceof IDVariant){var l=u.stringValue();if(l.length>0){var q=l.split("\n");for(var G=0;G<q.length;G++){var D=q[G].split(":");if(D.length==2){a.setRequestHeader(D[0],D.slice(1).join(":"))}}}}else{if(u instanceof IDArray){var f=u;if(f.Size()>0){for(var G=0;G<f.Size();G++){var D=f.get_Value(new IDVariant(G)).stringValue().split(":");a.setRequestHeader(D[0],D.slice(1).join(":"))}}}}}}if(!k.equals("GET")){var B="";if(I!=null){var s=I.get_Value(new IDVariant("ID_BODY")).stringValue();B=I.get_Value(new IDVariant("ID_BODYTYPE")).stringValue();if(s.length>0){j=s}}if(j.length>0){a.setRequestHeader("Content-Type",B||"application/x-www-form-urlencoded")}}var F=0;var M=(I==null||I.get_Value(new IDVariant("ID_NOERROR")).intValue()==0);try{a.send(j);F=a.status;if((F<200||F>=400)&&M){throw new Error("Response code "+F)}}catch(J){if(M){throw J}}finally{try{if(I!=null){I.set_Value(new IDVariant("ID_RESPONSECODE"),new IDVariant(F));var q=new IDArray();var u=a.getAllResponseHeaders().split("\n");for(var G=0;G<u.length;G++){if(u[G].length>0){q.add_Value(new IDVariant(u[G]))}}if(q.Size()>0){I.set_Object(new IDVariant("ID_HEADERS"),q)}}}catch(K){}}var r;if(!a.responseText){r=new IDVariant()}else{var m=a.getResponseHeader("Content-Type");var A=(!m||m.length==0||m.startsWith("text/")||m.startsWith("application/json"));if(I!=null){var d=I.get_Value(new IDVariant("ID_RESPONSETYPE")).stringValue();if(d.equals("TEXT")){A=true}else{if(d.equals("BLOB")){A=false}}}if(A){r=new IDVariant(a.responseText)}else{var H=false;if(n instanceof WebEntryPointSrv){H=n.ParamsObj().NativeBlob}var L="";if(!H){L+="B";L+="L";L+="O";L+="B";var C=y.stringValue();var v="";if(!C.toLowerCase().startsWith("blob:")&&C.lastIndexOf(".")>=0){v=C.substr(C.lastIndexOf(".")+1);if(v.indexOf("/")!=-1){v=""}}if(v.length==0&&n!=null&&n instanceof WebEntryPointSrv){v=n.GetExtensionFromMime(m)}if(v.length>12){v=v.substr(0,12)}if(v.length>0){L+=v}for(var G=L.length;G<16;G++){L+=String.fromCharCode(0)}}else{}for(var G=0;G<a.responseText.length;G++){L+=String.fromCharCode((a.responseText.charCodeAt(G)>>8)==247?(a.responseText.charCodeAt(G)&255):a.responseText.charCodeAt(G))}r=new IDVariant();r.Value=L;r.Type=IDVariant.BLOB}}return r};IDL.ErrorNumber=function(c){try{var b=c.indexOf("-");if(b>0){var a=c.substr(0,b);var d=parseInt(a.trim(),10);if(isNaN(d)){d=-1}return new IDVariant(d)}}catch(f){}return new IDVariant(0)};IDL.applyPattern=function(x,t){try{var s=new Date(0,0,1,0,0,0);var k=-1;var a=-1;var h=-1;var f=-1;var b=-1;var g=-1;var m="";if(t.indexOf("/")!=-1){m="/"}else{if(t.indexOf("-")!=-1){m="-"}else{if(t.indexOf(":")!=-1){m=":"}else{if(t.indexOf(".")!=-1){m="."}}}}if(m==""){return null}var u=x.split(m);var c=t.split(m);if(u.length!=c.length||u.length<=1){return null}for(var n=0;n<c.length;n++){switch(c[n]){case"dd":var r=parseInt(u[n],10);if(isNaN(r)||r>31){return null}h=r;break;case"MM":var y=parseInt(u[n],10);if(isNaN(y)||y>12){return null}a=y-1;break;case"yy":var j=parseInt(u[n],10);if(isNaN(j)||j.toString().length!=2){return null}var q=1900;if(j<20){q=2000}k=j+q;break;case"yyyy":var j=parseInt(u[n],10);if(isNaN(j)||j.toString().length!=4){return null}k=j;break;case"H":case"HH":var d=parseInt(u[n],10);if(isNaN(d)||d>24){return null}f=d;break;case"m":case"mm":var o=parseInt(u[n],10);if(isNaN(o)||o>59){return null}b=o;break;case"s":case"ss":var l=parseInt(u[n],10);if(isNaN(l)||l>59){return null}g=l;break}}if((f!=-1||b!=-1||g!=-1)&&h==-1&&a==-1&&k==-1){h=30;a=11;k=1899}if(k!=-1){s.setFullYear(k)}if(a!=-1){s.setMonth(a)}if(h!=-1){s.setDate(h)}if(f!=-1){s.setHours(f)}if(b!=-1){s.setMinutes(b)}if(g!=-1){s.setSeconds(g)}if(k!=-1&&s.getFullYear()!=k){return null}if(a!=-1&&s.getMonth()!=a){return null}return s}catch(v){WriteToConsoleError("[IDL::applyPattern] Exception while applying pattern: "+v);return null}};IDL.Sleep=function(b){if(b instanceof IDVariant){b=b.intValue()}var a=new Date().getTime();while((new Date()).getTime()-a<b){}};IDL.Like=function(c,a){var d=a.stringValue();if(d.indexOf("%")!=-1){d=d.Replace("%","*")}var b=c.stringValue().replace(/[-[\]{}()*+?.,\\^$|#\s]/gm,"\\$&");return(new RegExp("^"+d.Replace("\\.","\\\\.").Replace("\\*","(.){0,}").Replace("\\?","(.){1}")+"$","m").test(b))};IDL.Base64Encode=function(a){return btoa(unescape(encodeURIComponent(a)))};IDL.Base64Decode=function(a){return decodeURIComponent(escape(atob(a)))};IDL.Base64FromFile=function(e){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(e.startsWith("$SHELL")){e=e.substring(6)}if(e[0]=="/"){e=e.substring(1)}var b=new XMLHttpRequest();b.open("GET",RD4_WebEntryPoint.GetAppUrl(false)+e,false);b.responseType="arraybuffer";b.send();if(b.status==200||b.status==0){var d="";var a=new Uint8Array(b.response);for(var c=0;c<a.length;c++){d+=String.fromCharCode(a[c])}return btoa(d)}else{throw new Error("File "+e+" not found")}}else{throw new Error("Not supported outside the Native Shell")}};IDL.Base64ToFile=function(a,c){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var b=RD4_WebEntryPoint.ShellObject.SendCmd("SAVEFILE",{CONTENT:a,FILENAME:c});if(b!="OK"){throw new Error(b)}}else{throw new Error("Not supported outside the Native Shell")}};IDL.LoadFile=function(e){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var g=RD4_WebEntryPoint.ShellObject.SendCmd("LOADFILE",{URL:e});if(g.substring(0,2)!="OK"){throw new Error(g)}else{var d=atob(g.substring(2));var a=d.length;var b=new Uint8Array(a);for(var f=0;f<a;f++){b[f]=d.charCodeAt(f)}return b.buffer}}else{var c=new XMLHttpRequest();c.open("GET",e,false);c.responseType="arraybuffer";c.send();if(c.status>=400){throw new Error("Invalid response from server (StatusCode = "+c.status+")")}return c.response}};IDL.ExecuteOnMain=function(a){myPostMessage({type:"EXEC",message:a})};IDL.GetCookie=function(a){return self.cookies[a]||""};IDL.SetCookie=function(a,b,c){self.cookies[a]=b+"";IDL.ExecuteOnMain("GlobalObject.SetCookie('"+a.replace(/'/g,"'")+"', '"+b.replace(/'/g,"'")+"', "+c+");")};IDL.JSON_Parse=function(a){return IDMap.Wrap(JSON.parse(a))};IDL.JSON_Stringify=function(b){var c;var a=[];if(b instanceof IDMap){c=b.ToJSON(a)}else{if(b instanceof IDArray){c=b.ToJSON(a)}else{if(b instanceof IDVariant){c=b.ToJSON()}}}return c};IDL.LikeEscape=function(a,g,e){if(g.Type!=IDVariant.STRING){return}if(Glb.ClassDB(a)==Glb.DBC_ACCESS){g.Value=g.Value.replace(/\[/g,"[[]").replace(/%/g,"[%]").replace(/_/g,"[_]");return}var f=new IDArray();f.add_Value(new IDVariant("\\"));f.add_Value(new IDVariant("%"));f.add_Value(new IDVariant("_"));if(Glb.ClassDB(a)==Glb.DBC_DB2||Glb.ClassDB(a)==Glb.DBC_SQLSRV){f.add_Value(new IDVariant("["))}for(var b=0;b<f.Size();b++){var h=f.get_Value(new IDVariant(b)).stringValue();if(g.stringValue().indexOf(h)>=0){var d=h.replace(/[\!\@\#\$\%\^\&\*\)\(\+\=\.\<\>\{\}\[\]\:\;\'\"\|\~\`\_\-\\]/g,"\\$&");g.Value=g.stringValue().replace(new RegExp(d,"g"),"\\"+h);e.Type=IDVariant.STRING;if(Glb.ClassDB(a)==Glb.DBC_MYSQL){e.Value=" escape '\\\\'"}else{e.Value=" escape '\\'"}}}};IDL.GetMimeType=function(a){return""};function IDMailer(){this.Subject=null;this.Body=null;this.HTMLBody=null;this.FromAddress;this.FromName;this.TOs=new ArrayList();this.CCs=new ArrayList();this.BCCs=new ArrayList();this.ReplyTos=new ArrayList();this.Files=new ArrayList();this.FileNames=new ArrayList();this.FileCntTypes=new ArrayList();this.FileInlineDisposition=new ArrayList()}IDMailer.prototype.AddToAddress=function(a){this.TOs.Add(a)};IDMailer.prototype.AddCCAddress=function(a){this.CCs.Add(a)};IDMailer.prototype.AddBCCAddress=function(a){this.BCCs.Add(a)};IDMailer.prototype.AddReplyToAddress=function(a){this.ReplyTos.Add(a)};IDMailer.prototype.AddAttachment=function(b,a,d,c){this.Files.Add(b);this.FileNames.Add(a);this.FileCntTypes.Add(d);this.FileInlineDisposition.Add(c)};IDMailer.prototype.ResetContainers=function(){this.TOs.Clear();this.CCs.Clear();this.BCCs.Clear();this.ReplyTos.Clear();this.Files.Clear();this.FileNames.Clear();this.FileCntTypes.Clear();this.FileInlineDisposition.Clear()};IDMailer.prototype.ResetTOs=function(){this.TOs.Clear()};IDMailer.prototype.ResetCCs=function(){this.CCs.Clear()};IDMailer.prototype.ResetBCCs=function(){this.BCCs.Clear()};IDMailer.prototype.ResetReplyTos=function(){this.ReplyTos.Clear()};IDMailer.prototype.ResetAttachments=function(){this.Files.Clear();this.FileNames.Clear();this.FileCntTypes.Clear();this.FileInlineDisposition.Clear()};IDMailer.prototype.SetRelayServer=function(b,e,d,a,c){};IDMailer.prototype.SendMail=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("SENDMAIL",{TOADDRS:this.TOs.join(";"),CCADDRS:this.CCs.join(";"),BCCADDRS:this.BCCs.join(";"),SUBJECT:this.Subject,BODY:this.Body,HTMLBody:this.HTMLBody,FILES:this.Files.join(";"),FILESNAME:this.FileNames.join(";"),FILESMIME:this.FileCntTypes.join(";"),FILESINLINE:this.FileInlineDisposition.join(";")});if(a!="OK"){throw new Error(a)}}};function IDMap(d){if(d){var c=Object.keys(d);for(var b=0;b<c.length;b++){var a=c[b];this[a]=IDMap.Wrap(d[a])}}}IDMap.prototype.Size=function(){return Object.keys(this).length};IDMap.prototype.ContainsKey=function(a){return(this[a.stringValue()]!=undefined)};IDMap.FromEnum=function(c,b){var a=new IDMap();for(var d=0;d<c.length;d++){a.set_Value(c[d],(d<b.length)?b[d]:new IDVariant())}return a};IDMap.prototype.GetNative=function(){return this};IDMap.prototype.GetKeys=function(){var a=new IDArray();var c=Object.keys(this);for(var b=0;b<c.length;b++){a.add_Value(IDVariant.convertObject(c[b]))}return a};IDMap.prototype.set_Value=function(a,b){this[a.stringValue()]=new IDVariant(b)};IDMap.prototype.get_Value=function(a){var b=this[a.stringValue()];if(b==null||b==undefined){b=new IDVariant()}if(b==IDVariant.TRUE||b==IDVariant.FALSE){b=new IDVariant(b)}if(b instanceof IDVariant){return b}return new IDVariant()};IDMap.prototype.Remove=function(a){delete this[a.stringValue()]};IDMap.prototype.Clear=function(){var b=Object.keys(this);for(var a=0;a<b.length;a++){delete this[b[a]]}};IDMap.prototype.set_Object=function(a,b){this[a.stringValue()]=b};IDMap.prototype.get_Object=function(a){return this[a.stringValue()]};IDMap.prototype.set_Boolean=function(a,b){this.set_Object(a,IDMap.Wrap(b))};IDMap.Wrap=function(b){if(b instanceof IDArray||b instanceof IDMap||b instanceof IDVariant){return b}if(b instanceof Array){b=new IDArray(b)}else{if(b&&typeof b=="object"){b=new IDMap(b)}else{if(typeof b=="boolean"){b=(b==true?IDVariant.TRUE:IDVariant.FALSE)}else{var a=IDVariant.convertObject(b);if(typeof(b)!="string"&&a.Type==IDVariant.STRING&&a.stringValue().startsWith("?")&&a.stringValue().endsWith("?")){a=new IDVariant()}b=a}}}return b};IDMap.GetDataType=function(a){if(!(a instanceof IDVariant)){return Glb.DT_OBJECT}if(a==IDVariant.TRUE||a==IDVariant.FALSE){return Glb.DT_BOOLEAN}switch(a.Type){case IDVariant.INTEGER:return Glb.DT_NUM_INTEGER;case IDVariant.FLOAT:return Glb.DT_NUM_FLOAT;case IDVariant.DATETIME:return Glb.DT_DATETIME;case IDVariant.DECIMAL:return Glb.DT_NUM_FIXED;case IDVariant.STRING:return Glb.DT_CHAR;case IDVariant.BLOB:return Glb.DT_DOC_OLE;default:return Glb.DT_UNSPEC}};IDMap.prototype.GetDataType=function(a){return new IDVariant(IDMap.GetDataType(this[a.stringValue()]))};IDMap.prototype.ToJSON=function(a){var g="{";var f=true;var d=Object.keys(this);for(var c=0;c<d.length;c++){var b=d[c];if(!f){g+=","}f=false;g+=JSON.stringify(b)+":";var e=this[b];if(e instanceof IDMap){if(a.indexOf(e)!=-1){throw new Error("Circular reference for map key "+b)}a.push(e);g+=e.ToJSON(a)}else{if(e instanceof IDArray){if(a.indexOf(e)!=-1){throw new Error("Circular reference for map key "+b)}a.push(e);g+=e.ToJSON(a)}else{if(e instanceof IDVariant){g+=e.ToJSON()}else{g+="null"}}}}g+="}";return g};function IDNotification(){this.Title="";this.Message="";this.ImagePath="";this.SoundPath="";this.FireDate=null;this.Payload="";this.BadgeNo=-1;this.Type=-1}IDNotification.prototype.Send=function(a){a.ShellObject.SendLocalNotification(this.Title,this.Message,this.Payload,this.FireDate,this.ImagePath,this.SoundPath,this.BadgeNo,this.Type)};function IDPreparedStatement(a){this.Parameters=new ArrayList();this.Cmd=null;this.AutoClose=(a!=undefined?a:false);this.MaxRows=0}IDPreparedStatement.prototype.ClearParameters=function(){this.Parameters.Clear()};IDPreparedStatement.prototype.AddParameter=function(a){this.Parameters.Add(a)};IDPreparedStatement.prototype.SetCommand=function(a){this.Cmd=a};IDPreparedStatement.prototype.GetCommand=function(){return this.Cmd};IDPreparedStatement.prototype.ParameterCount=function(){return this.Parameters.Count()};IDPreparedStatement.prototype.GetParameter=function(a){return this.Parameters[a]};IDPreparedStatement.prototype.SetParameter=function(a,b){this.Parameters[a]=b};IDPreparedStatement.prototype.Close=function(){};IDPreparedStatement.prototype.ToString=function(){var c=this.Cmd+"\n";for(var b=0;b<this.Parameters.Count();b++){var a=this.Parameters[b];c+=("Par"+(b+1)+" = "+a+"\n")}return c+"\n"};IDVariant.NULL=0;IDVariant.INTEGER=1;IDVariant.FLOAT=2;IDVariant.DATETIME=3;IDVariant.DECIMAL=4;IDVariant.STRING=5;IDVariant.BLOB=6;IDVariant.MILLIS_DAY=86400000;IDVariant.VB_DAY_OFFS=25569;IDVariant.TMZ_OFFS=(new Date()).getTimezoneOffset()*60000;IDVariant.ConvertNullToValue=false;IDVariant.DefaultDateMask="dd/MM/yyyy";IDVariant.DefaultTimeMask="hh:mm";IDVariant.NumRegExp=new RegExp("[^-.,0-9]|.-.*","");function IDVariant(b,a){if(b==null){this.Value=null;this.Type=0;return}switch(typeof(b)){case"boolean":this.Type=1;this.Value=b?-1:0;break;case"number":if(b!=0){this.Type=(Number.isInteger(b)?1:2);this.Value=b}else{if(!a){this.Type=1;this.Value=0}}break;case"bigint":this.Type=1;this.Value=b;break;case"string":this.Type=5;this.Value=b;break;case"object":if(b instanceof Date){this.Type=3;this.Value=b}else{if(b instanceof IDVariant){this.Type=b.Type;this.Value=b.Value}else{this.Value=null;this.Type=0}}break;default:this.Value=null;this.Type=0;break}if(a){this.changeType(a)}}IDVariant.prototype.removeLeadingZeros=function(a){if(a.indexOf(".")>-1){var b=a.length-1;while(b>=0){if(a.charAt(b)=="."){b--;break}if(a.charAt(b)!="0"){break}b--}if(b<a.length-1&&b>=0){a=a.substr(0,b+1)}}return a};IDVariant.prototype.convertFromString=function(c){var b;if(c){b=parseInt(this.AdjustFloatDots(this.Value),10)}else{b=parseFloat(this.AdjustFloatDots(this.Value).replace(",","."))}var a=this.Value.search(IDVariant.NumRegExp);if(!isNaN(b)&&a==-1){this.Value=b}else{this.Value=null;this.Type=0}};IDVariant.prototype.changeType=function(a){var c=this.Type;if(this.Type==a){return true}this.Type=a;try{switch(a){default:this.Value=null;break;case 1:switch(c){default:this.Value=0;break;case 2:case 4:this.Value=Math.floor(this.Value);break;case 3:this.Value=this.Value.getTime()/IDVariant.MILLIS_DAY+IDVariant.VB_DAY_OFFS;break;case 5:this.convertFromString(1);break}break;case 2:switch(c){default:this.Value=0;break;case 1:case 4:break;case 3:this.Value=this.Value.getTime()/IDVariant.MILLIS_DAY+IDVariant.VB_DAY_OFFS;break;case 5:this.convertFromString();break}break;case 4:switch(c){default:this.Value=0;break;case 1:case 2:break;case 3:this.Value=this.Value.getTime()/IDVariant.MILLIS_DAY+IDVariant.VB_DAY_OFFS;break;case 5:this.convertFromString();break}break;case 3:switch(c){default:this.Value=new Date(-IDVariant.VB_DAY_OFFS*IDVariant.MILLIS_DAY+IDVariant.TMZ_OFFS);break;break;case 1:case 2:case 4:this.Value=new Date(this.Value*IDVariant.MILLIS_DAY-IDVariant.VB_DAY_OFFS*IDVariant.MILLIS_DAY+IDVariant.TMZ_OFFS);break;break;case 5:var b=this.Value;var h=new IDVariant(b);h=IDL.ToDateTime(h);if(h.Type==3){this.Value=h.Value;this.Type=3}else{this.Value=null;this.Type=0}break}if(c!=5){this.Value=new Date(this.Value.getTime()+((new Date()).dstOffset()-this.Value.dstOffset()))}break;case 5:switch(c){default:this.Value="";break;case 1:this.Value=this.Value.toString();break;case 4:case 2:this.Value=this.removeLeadingZeros(this.Value.toString());break;case 3:var g=IDVariant.DefaultDateMask.replace("MM","mm");var f=IDVariant.DefaultTimeMask.replace("HH","hh").replace("mm","nn");if(this.Value.getFullYear()==1899&&(this.Value.getMonth()+1)==12&&this.Value.getDate()==30){this.Value=IDL.FormatDate(this.Value,f)}else{if(this.Value.getHours()==0&&this.Value.getMinutes()==0&&this.Value.getSeconds()==0){this.Value=IDL.FormatDate(this.Value,g)}else{this.Value=IDL.FormatDate(this.Value,g+" "+f)}}break;case 6:this.Value=btoa(this.Value);break}break;case 6:switch(c){case 5:this.Value=atob(this.Value);break}break}}catch(d){WriteToConsoleError("[IDVariant::changeType] Cannot convert type "+c+","+this.Value+" to type "+this.Type+". Error is: "+d);this.Value=null;this.Type=0}return true};IDVariant.prototype.Equals=function(b,a){return this.CompareTo(b,a)==0};IDVariant.prototype.equals=function(b,a){return this.Equals(b,a)};IDVariant.prototype.CompareTo=function(g,b){if(b==undefined){b=false}var h=g;var f=this;if(h.Type==0||f.Type==0){if(h.Type==f.Type){return 0}else{if(IDVariant.ConvertNullToValue&&b){if(h.Type==0){h=new IDVariant(h);h.changeType(f.Type)}else{f=new IDVariant(f);f.changeType(h.Type)}return f.compareTo(h)}else{return(h.Type!=0)?-1:1}}}var e=(h.Type>f.Type)?h.Type:f.Type;if(h.Type!=e){h=new IDVariant(h);h.changeType(e)}if(f.Type!=e){f=new IDVariant(f);f.changeType(e)}switch(e){default:return 0;case 1:case 2:case 4:case 3:case 5:if(f.Value>h.Value){return 1}else{if(f.Value<h.Value){return -1}}return 0;case 6:var c=h.Value;var a=f.Value;if(c==null&&a==null){return 0}if((c==null)!=(a==null)){return 1}if(c.length!=a.length){return 1}for(var d=0;d<c.length;d++){if(c.charAt(d)!=a.charAt(d)){return 1}}return 0}};IDVariant.prototype.compareTo=function(b,a){return this.CompareTo(b,a)};IDVariant.prototype.CompareToIgnoreCase=function(a){if(this.Type==5&&a.Type==5&&this.Value!=null&&a.Value!=null){if(this.Value.toLowerCase()>a.Value.toLowerCase()){return 1}else{if(this.Value.toLowerCase()<a.Value.toLowerCase()){return -1}}return 0}else{return this.CompareTo(a)}};IDVariant.prototype.intValue=function(){if(this.Type==1){return this.Value}else{var a=new IDVariant(this);a.changeType(1);return a.intValue()}};IDVariant.prototype.longValue=function(){if(this.Type==1){return this.Value}else{var a=new IDVariant(this);a.changeType(1);return a.longValue()}};IDVariant.prototype.dblValue=function(){if(this.Type==2){return this.Value}else{var a=new IDVariant(this);a.changeType(2);return a.dblValue()}};IDVariant.prototype.floatValue=function(){if(this.Type==2){return this.Value}else{var a=new IDVariant(this);a.changeType(2);return a.floatValue()}};IDVariant.prototype.decValue=function(){if(this.Type==4){return this.Value}else{var a=new IDVariant(this);a.changeType(4);return a.decValue()}};IDVariant.prototype.dateValue=function(){if(this.Type==3){return this.Value}else{var a=new IDVariant(this);a.changeType(3);return a.dateValue()}};IDVariant.prototype.stringValue=function(){if(this.Type==5){return this.Value}else{var a=new IDVariant(this);a.changeType(5);return a.stringValue()}};IDVariant.prototype.booleanValue=function(){if(this.Type==1){return this.Value!=0}else{var a=new IDVariant(this);a.changeType(1);return a.Value!=0}};IDVariant.prototype.toString=function(){return this.stringValue()};IDVariant.prototype.ToString=function(){return this.stringValue()};IDVariant.prototype.isTrue=function(){return !this.isFalse()};IDVariant.prototype.isFalse=function(){return this.intValue()==0};IDVariant.convertObject=function(a){if(a==null){return new IDVariant()}else{if(a instanceof IDVariant){return a}else{return new IDVariant(a)}}};IDVariant.prototype.set=function(a){if(a instanceof IDVariant){this.Type=a.Type;this.Value=a.Value}else{if(typeof(a)=="boolean"){this.Type=1;this.Value=a?-1:0}}};IDVariant.GetIDVariantType=function(a){if(a=="number"){return 1}if(a=="string"){return 5}if(a=="boolean"){return 1}return IDVariant.NULL};IDVariant.prototype.GetSOAPobj=function(){switch(this.Type){default:return null;case 1:case 2:case 4:case 3:case 5:return this.Value}};IDVariant.InitDefaultMasks=function(a,b){a=a.replace(/m/g,"M");b=b.replace(/n/g,"m");b=b.replace(/h/g,"H");IDVariant.DefaultDateMask=a;IDVariant.DefaultTimeMask=b;IDL.DatePatterns.splice(0,0,IDVariant.DefaultDateMask);IDL.TimePatterns.splice(0,0,IDVariant.DefaultTimeMask)};IDVariant.prototype.AdjustFloatDots=function(a){a=a.toString();var h=new String();var f=-1;var c=-1;var e=0;var d=0;var g=a.length;for(var b=0;b<g;b++){if(a.charAt(b)=="."){e++;f=b}if(a.charAt(b)==","){d++;c=b}}if(h.length==0&&f>c&&d>0){for(var b=0;b<g;b++){if(a.charAt(b)!=","){h=h+a.charAt(b)}}}if(h.length==0&&c>f&&e>0){for(var b=0;b<g;b++){if(a.charAt(b)!="."){h=h+(a.charAt(b)==","?".":a.charAt(b))}}}if(h.length==0){if(e+d==1){h=h+a;if(d==1){h.replace(",",".")}}else{for(var b=0;b<g;b++){if(a.charAt(b)!="."&&a.charAt(b)!=","){h=h+a.charAt(b)}}}}return h};IDVariant.prototype.ToJSON=function(){switch(this.Type){case IDVariant.BLOB:case IDVariant.NULL:return"null";case IDVariant.INTEGER:if(this==IDVariant.TRUE){return"true"}else{if(this==IDVariant.FALSE){return"false"}}default:return JSON.stringify(this.Value)}};IDVariant.TRUE=new IDVariant(-1,1);IDVariant.FALSE=new IDVariant(0,1);function IDZip(){}IDZip.prototype.GetNative=function(){return this};IDZip.Zip=function(d,c,e,b){e=e||"";b=b||"";if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("ZIP_ZIP",{SRCPATH:c,DSTPATH:e,PWD:b});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){if(!e){d.AddTempFile(a.substring(2))}return new IDVariant(a.substring(2),IDVariant.STRING)}else{return new IDVariant()}}};IDZip.ZipFiles=function(f,d,g,c){g=g||"";c=c||"";if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var e="";for(var b=0;b<d.Size();b++){e+=(e.length?",":"")+d.get_Value(new IDVariant(b)).stringValue()}var a=RD4_WebEntryPoint.ShellObject.SendCmd("ZIP_ZIPFILES",{FILELIST:e,DSTPATH:g,PWD:c});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){if(!g){f.AddTempFile(a.substring(2))}return new IDVariant(a.substring(2),IDVariant.STRING)}else{return new IDVariant()}}};IDZip.Unzip=function(c,d,b){d=d||"";b=b||"";if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("ZIP_UNZIP",{SRCPATH:c,DSTPATH:d,PWD:b});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.STRING)}else{return new IDVariant()}}};function IMDBFieldDefSrv(a){this.Index=0;this.Scale=0;this.MaxLength=0;this.Code="";this.SortAsc=true;this.DataType=IDVariant.NULL;if(a!=undefined){this.Index=a}}IMDBFieldDefSrv.prototype.CopyFrom=function(a){this.DataType=a.DataType;this.Scale=a.Scale;this.MaxLength=a.MaxLength;this.Code=a.Code;this.Index=a.Index;this.SortAsc=a.SortAsc};function IMDBFldValueSrv(){this.Value=new IDVariant();this.LinkedValue;this.pRow}IMDBFldValueSrv.prototype.GetValue=function(){if(this.LinkedValue!=null){return this.LinkedValue.GetValue()}else{return new IDVariant(this.Value)}};IMDBFldValueSrv.prototype.PutValue=function(a){if(this.LinkedValue!=null){this.LinkedValue.PutValue(a)}else{this.Value=new IDVariant(a);if(this.pRow!=null){this.pRow.SetModified()}}};IMDBFldValueSrv.prototype.equals=function(a){return this.CompareTo(a)==0};IMDBFldValueSrv.prototype.CompareTo=function(a){return this.GetTrueValue().CompareTo(a.GetTrueValue())};IMDBFldValueSrv.prototype.LinkTo=function(a){this.LinkedValue=a};IMDBFldValueSrv.prototype.GetTrueValue=function(){if(this.LinkedValue!=null){return this.LinkedValue.GetTrueValue()}else{return this.Value}};function IMDBObjSrv(){this.LastV=0;this.Master=null;this.iIsModified=0;this.Tables}IMDBObjSrv.FilledTo=0;IMDBObjSrv.prototype.Table=function(a){if(this.Master!=null&&!this.Tables[a].Initialized()){return this.Master.Table(a)}else{return this.Tables[a]}};IMDBObjSrv.prototype.DBSize=function(){return this.Tables.length};IMDBObjSrv.prototype.set_DBSize=function(a){if(this.Tables==null||this.Tables.length!=a){this.Tables=new Array();for(var b=0;b<a;b++){this.Tables[b]=new IMDBTableSrv(this)}}};IMDBObjSrv.prototype.TblNumField=function(a){return this.Table(a).NumFields};IMDBObjSrv.prototype.set_TblNumField=function(b,a){this.Table(b).SetNumFields(a)};IMDBObjSrv.prototype.Value=function(b,e,d,c){if(c==undefined){c=0}var a=this.Table(b).GetValue(e,d);if(c!=0&&a.Type!=IDVariant.NULL){a.changeType(c)}return a};IMDBObjSrv.prototype.set_Value=function(a,d,b,c){this.Table(a).PutValue(c,d,b)};IMDBObjSrv.prototype.TblAddNew=function(a,b){this.Table(a).AddNew(b)};IMDBObjSrv.prototype.TblDelete=function(a,b){this.Table(a).Delete(b)};IMDBObjSrv.prototype.TblTruncate=function(a){this.Table(a).Truncate()};IMDBObjSrv.prototype.TblFilter=function(c,f,e,d,a,b){this.Table(c).FilterRows(f,e,d,a,b)};IMDBObjSrv.prototype.TblMoveFirst=function(a,b){var c=this.Table(a).MoveFirst(b)};IMDBObjSrv.prototype.TblMoveLast=function(a,b){this.Table(a).MoveLast(b)};IMDBObjSrv.prototype.TblMoveNext=function(a,b){this.Table(a).MoveNext(b)};IMDBObjSrv.prototype.TblMovePrev=function(a,b){this.Table(a).MovePrev(b)};IMDBObjSrv.prototype.TblNumRows=function(a){return this.Table(a).NumRows};IMDBObjSrv.prototype.Eof=function(a,b){return this.Table(a).IsEof(b)};IMDBObjSrv.prototype.TblGoToAbsoluteRow=function(a,c,b){return this.Table(a).Absolute(c,b)};IMDBObjSrv.prototype.GetRowBookMark=function(a,b){return this.Table(a).AttPos[b].RowBookMark};IMDBObjSrv.prototype.TblStartSort=function(a){this.Table(a).StartSort()};IMDBObjSrv.prototype.TblInitSort=function(a){this.Table(a).InitSort()};IMDBObjSrv.prototype.TblSortBy=function(a,c,b){this.Table(a).SortBy(c,b)};IMDBObjSrv.prototype.TblIdentityValue=function(a){return new IDVariant(this.Table(a).IdentityValue)};IMDBObjSrv.prototype.set_TblIdentityValue=function(a,b){this.Table(a).IdentityValue=b};IMDBObjSrv.prototype.TblIdentityField=function(a){return this.Table(a).IdentityField};IMDBObjSrv.prototype.set_TblIdentityField=function(a,b){this.Table(a).IdentityField=b};IMDBObjSrv.prototype.TblLinkRow=function(d,b,a,c){this.Table(d).LinkRow(b,this.Table(a),c)};IMDBObjSrv.prototype.TblLinkField=function(f,b,d,c,a,e){this.Table(f).LinkField(b,d,this.Table(c),a,e)};IMDBObjSrv.prototype.IsModified=function(a){var b=1<<a;return(this.iIsModified&b)!=0};IMDBObjSrv.prototype.TblModified=function(b,a){return this.Table(b).GetModified(a,this.Tables)};IMDBObjSrv.prototype.SetModified=function(){this.iIsModified=-1};IMDBObjSrv.prototype.ResetModified=function(b,d){if(d==undefined){d=true}var c=1<<b;this.iIsModified&=(~c);if(d){var a=this.Tables.length;for(var e=0;e<a;e++){if(this.Table(e)!=null){this.Table(e).ResetModified(b)}}}};IMDBObjSrv.prototype.ResetAllModified=function(a){this.iIsModified=a;var b=this.Tables.length;for(var c=0;c<b;c++){if(this.Table(c)!=null){this.Table(c).ResetAllModified(a)}}};IMDBObjSrv.prototype.TblResetModified=function(b,a){this.Table(b).ResetModified(a)};IMDBObjSrv.prototype.TblSetModified=function(b,a){this.Table(b).SetModified(a)};IMDBObjSrv.prototype.TblCode=function(a){return this.Table(a).Code};IMDBObjSrv.prototype.set_TblCode=function(a,b){this.Table(a).Code=b};IMDBObjSrv.prototype.FldCode=function(b,a){return this.Table(b).FieldDef(a).Code};IMDBObjSrv.prototype.set_FldCode=function(b,a,c){this.Table(b).FieldDef(a).Code=c};IMDBObjSrv.prototype.TblByCode=function(d,c){var f=0;if(d.indexOf("$")!=-1&&c!=null){var a=c.GetApplication();var h=d.substring(0,d.indexOf("$"));var g=a.GetCompFromNameSpace(h);if(g!=null){f=g.IMDBOffset()}d=d.substring(d.indexOf("$")+1)}var b=this.Tables.length;for(var e=f;e<b;e++){if(this.Table(e)!=null&&this.Table(e).Code==d){return e}}return -1};IMDBObjSrv.prototype.FldByCode=function(d,b){var a=this.Table(d).NumFields;for(var c=0;c<a;c++){if(this.Table(d).FieldDef(c).Code==b){return c}}return -1};IMDBObjSrv.prototype.SetFldParams=function(b,f,c,a,e){var d=this.Table(b).FieldDef(f);d.DataType=c;d.MaxLength=a;d.Scale=e};IMDBObjSrv.prototype.GetFldDataType=function(a,b){return this.Table(a).FieldDef(b).DataType};IMDBObjSrv.prototype.GetFldMaxLength=function(a,b){return this.Table(a).FieldDef(b).MaxLength};IMDBObjSrv.prototype.GetFldScale=function(a,b){return this.Table(a).FieldDef(b).Scale};IMDBObjSrv.prototype.SynchronizeRows=function(b,a,c){this.Table(b).SynchronizeRows(a,c)};IMDBObjSrv.prototype.Version=function(){return IMDBTableSrv.a()};IMDBObjSrv.prototype.set_Version=function(a){this.LastV=a;IMDBTableSrv.a(this.Tables,a)};IMDBObjSrv.prototype.Reset=function(){IMDBTableSrv.a(this.Tables,this.LastV)};IMDBObjSrv.prototype.SetMaster=function(a){this.Master=a};IMDBObjSrv.prototype.AppendTables=function(a,d){if(d==0){Array.resize(this.Tables,Math.max(this.Tables.length,IMDBObjSrv.FilledTo)+a.Tables.length);Array.copy(a.Tables,0,this.Tables,this.Tables.length-a.Tables.length,a.Tables.length);var c=this.Tables.length;for(var b=this.Tables.length-a.Tables.length;b<c;b++){this.Tables[b].Parent=this}}else{Array.resize(this.Tables,Math.max(a.Tables.length,this.Tables.length));Array.copy(a.Tables,d,this.Tables,d,a.Tables.length-d);var c=a.Tables.length;for(var b=d;b<a.Tables.length;b++){this.Tables[b].Parent=this}}IMDBObjSrv.FilledTo=Math.max(IMDBObjSrv.FilledTo,this.Tables.length)};IMDBObjSrv.prototype.add_TblField=function(a){return this.Table(a).AddField()};IMDBObjSrv.prototype.IsMasterTable=function(a){if(this.Master!=null&&!this.Tables[a].Initialized()){return true}else{return false}};IMDBTableSrv.MAX_CURSORS=32;IMDBTableSrv.VersionOK=false;IMDBTableSrv.Expired=true;IMDBTableSrv.seed;IMDBTableSrv.LastTime=0;IMDBTableSrv.StartTime=0;IMDBTableSrv.V255=255;IMDBTableSrv.V255L=255;IMDBTableSrv.N255=-256;IMDBTableSrv.VF8=-134217728;IMDBTableSrv.V1F=31;IMDBTableSrv.V7F=134217727;IMDBTableSrv.V27=27;IMDBTableSrv.V5=5;IMDBTableSrv.ra=16807;IMDBTableSrv.rm=2147483647;IMDBTableSrv.rq=127773;IMDBTableSrv.rr=2836;IMDBTableSrv.V16=16;IMDBTableSrv.V15A=225;IMDBTableSrv.V15B=210;IMDBTableSrv.VG=86400000;IMDBTableSrv.GG=10957;function IMDBTableSrv(a){this.NumFields=0;this.NumRows=0;this.IdentityValue=0;this.IdentityField=-1;this.Parent=a;this.Code="";this.FieldDefs;this.AttPos=new Array(IMDBTableSrv.MAX_CURSORS);this.FirstRow;this.LastRow;this.SortFields=new ArrayList();this.WasSorted=false;this.NextBookMark=0;this.IsModified=0;this.IsFiltered=false}IMDBTableSrv.prototype.SetNumFields=function(a){this.NumFields=a;this.FieldDefs=new Array(a);for(var b=0;b<a;b++){this.FieldDefs[b]=new IMDBFieldDefSrv(b)}};IMDBTableSrv.prototype.AddField=function(){this.NumFields++;this.FieldDefs[this.NumFields-1]=new IMDBFieldDefSrv(this.NumFields-1);return this.NumFields-1};IMDBTableSrv.prototype.FieldDef=function(a){return this.FieldDefs[a]};IMDBTableSrv.prototype.GetValue=function(b,a){if(this.AttPos[a]!=null){return this.AttPos[a].Values[b].GetValue()}else{return new IDVariant()}};IMDBTableSrv.prototype.PutValue=function(b,d,a){if(this.AttPos[a]!=null){this.AttPos[a].Values[d].PutValue(b);if(d==this.IdentityField){var c=new IDVariant(b);if(c.intValue()>=this.IdentityValue){this.IdentityValue=c.intValue()}}return true}else{return false}};IMDBTableSrv.prototype.AddNew=function(a){var b=new IMDBTblRowsSrv(this);if(this.IdentityField>-1){var c=new IDVariant(++this.IdentityValue);b.Values[this.IdentityField].PutValue(c)}if(this.NumRows==0){this.FirstRow=b;this.LastRow=b}else{this.LastRow.Next=b;b.Prev=this.LastRow;this.LastRow=b}this.AttPos[a]=b;this.NumRows++;this.SetModified();this.AttPos[a].SetPRows()};IMDBTableSrv.prototype.MoveFirst=function(a){this.AttPos[a]=this.FirstRow;return this.FirstRow!=null};IMDBTableSrv.prototype.MoveLast=function(a){this.AttPos[a]=this.LastRow;return this.LastRow!=null};IMDBTableSrv.prototype.MoveNext=function(a){if(this.AttPos[a]!=null){this.AttPos[a]=this.AttPos[a].Next;return true}else{return false}};IMDBTableSrv.prototype.MovePrev=function(a){if(this.AttPos[a]!=null){this.AttPos[a]=this.AttPos[a].Prev;return true}else{return false}};IMDBTableSrv.prototype.Absolute=function(a,b){var c=this.AttPos[a];if(this.IsEof(a)){this.MoveFirst(a)}while(!this.IsEof(a)){if(this.AttPos[a].RowBookMark==b){return true}this.MoveNext(a)}this.AttPos[a]=c.Prev;while(!this.IsEof(a)){if(this.AttPos[a].RowBookMark==b){return true}this.MovePrev(a)}return false};IMDBTableSrv.prototype.IsEof=function(a){return this.AttPos[a]==null};IMDBTableSrv.prototype.Delete=function(b){var a=this.AttPos[b];if(a!=null){a.DeleteLink();if(a.Next!=null){a.Next.Prev=a.Prev}if(a.Prev!=null){a.Prev.Next=a.Next}if(this.FirstRow==a){this.FirstRow=a.Next}if(this.LastRow==a){this.LastRow=a.Prev}this.NumRows--;this.SetModified();var d=this.AttPos.length;for(var c=0;c<d;c++){if(this.AttPos[c]==a){this.AttPos[c]=a.Next}}return true}else{return false}};IMDBTableSrv.prototype.Truncate=function(){if(this.WasSorted){}var b=this.FirstRow;while(b!=null){b.DeleteLink();b=b.Next}this.LastRow=null;this.FirstRow=null;var c=this.AttPos.length;for(var a=0;a<c;a++){this.AttPos[a]=null}this.NumRows=0;this.SetModified();this.IsFiltered=false};IMDBTableSrv.prototype.InitSort=function(){this.SortFields.Clear()};IMDBTableSrv.prototype.SortBy=function(b,a){this.SortFields.Add(this.FieldDef(b));this.FieldDef(b).SortAsc=a};IMDBTableSrv.prototype.StartSort=function(){if(this.NumRows==0){return}this.WasSorted=this.SortFields.Count()>0;var a=new ArrayList();var d=this.FirstRow;while(d!=null){a.Add(d);d=d.Next}a.Sort();var b=null;for(var e=0;e<this.NumRows;e++){d=a[e];if(e==0){this.FirstRow=d;d.Prev=null}if(e>0){b.Next=d;d.Prev=b}if(e==this.NumRows-1){this.LastRow=d;d.Next=null}b=d}};IMDBTableSrv.prototype.LinkRow=function(b,a,c){if(this.AttPos[b]==null){return false}return this.AttPos[b].LinkRow(a,c)};IMDBTableSrv.prototype.LinkField=function(b,d,c,a,e){if(this.AttPos[d]==null){return false}return this.AttPos[d].LinkField(b,c,a,e)};IMDBTableSrv.prototype.GetModified=function(a,c){if(this.Parent.Master==null){IMDBTableSrv.a(c)}var b=1<<a;return(this.IsModified&b)>0};IMDBTableSrv.prototype.ResetModified=function(a){if(a==-1){this.IsModified=0}else{var b=1<<a;this.IsModified&=(~b)}};IMDBTableSrv.prototype.SetModified=function(a){if(a==undefined){this.IsModified=-1;if(this.Parent!=null){this.Parent.SetModified()}}else{if(a==-1){this.IsModified=-1}else{var b=1<<a;this.IsModified|=b}}};IMDBTableSrv.prototype.ResetAllModified=function(a){this.IsModified=a};IMDBTableSrv.prototype.SynchronizeRows=function(a,b){if(this.AttPos[a]!=null){this.AttPos[a].SynchronizeRows(b);return true}else{return false}};IMDBTableSrv.prototype.FilterRows=function(m,j,l,k,o){this.MoveFirst(l);while(!this.IsEof(l)){var f=false;var e=m.Count();for(var g=0;g<e;g++){var d=this.AttPos[l].Values[m[g]].GetValue();var h=j[g];var c=k;var b=this.FieldDefs[m[g]];var a=false;var r=new IDVariant(";");if(b.DataType==Glb.DT_CHAR_FIXED&&b.MaxLength==20){a=true;r=new IDVariant(" ");if(h.stringValue().indexOf(r.stringValue())==-1){c=false;if(h.stringValue().charAt(0)=="§"){h=new IDVariant(h.stringValue().substr(1))}}}var q=(c?IDL.QbeMatch(d,h,o,r,a):d.equals(h));if(!q){f=true;break}}if(f){this.Delete(l)}else{this.MoveNext(l)}}this.IsFiltered=true};IMDBTableSrv.GetByte=function(e,d){var a=new Array();var c=new Array();var b=e.charCodeAt(d);a=[];do{a.push(b&255);b=b>>8}while(b);return a.reverse()};IMDBTableSrv.a=function(c,d){if(c!=undefined&&d!=undefined){if(typeof(c)=="string"&&typeof(d)=="number"){var x=c;var e=d;var a=x.length;for(var g=0;g<a;g++){var q=IMDBTableSrv.GetByte(x,g);var o=(e&IMDBTableSrv.V255);var n=(q^o);n&=IMDBTableSrv.V255L;e=(e&IMDBTableSrv.N255)|n;var m=((e&IMDBTableSrv.VF8)>>IMDBTableSrv.V27)&IMDBTableSrv.V1F;e=(((e&IMDBTableSrv.V7F)<<IMDBTableSrv.V5)|m)}return e}else{var r=0;var a=c.length;for(var g=0;g<a;g++){if(c[g].FieldDefs==null){continue}r=IMDBTableSrv.a(c[g].Code,r);var b=c[g].FieldDefs.length;for(var f=0;f<b;f++){r=IMDBTableSrv.a(c[g].FieldDefs[f].Code,r)}}IMDBTableSrv.VersionOK=(d==r);if(IMDBTableSrv.VersionOK){IMDBTableSrv.Expired=false}else{var k=((d&-65536)>>IMDBTableSrv.V16)&65535;var l=((d&65535));IMDBTableSrv.seed=l;var m=IMDBTableSrv.b()&65535;if(m!=k){IMDBTableSrv.Expired=true}else{var h=Math.floor(new Date().getTime()/IMDBTableSrv.VG-IMDBTableSrv.GG);if((h-l)>=0&&(h-l)<=IMDBTableSrv.V15A-IMDBTableSrv.V15B){IMDBTableSrv.Expired=false}else{IMDBTableSrv.Expired=true}}}}return}else{if(c!=undefined){if(!IMDBTableSrv.VersionOK){var u=new Date().getTime();if(u<IMDBTableSrv.LastTime){IMDBTableSrv.Expired=true}IMDBTableSrv.LastTime=u;if(IMDBTableSrv.StartTime==0){IMDBTableSrv.StartTime=IMDBTableSrv.LastTime}}return}}if(IMDBTableSrv.Expired){return 65536}if(!IMDBTableSrv.VersionOK){return 131072}return 196608};IMDBTableSrv.b=function(){var b,a,c;a=Math.floor(IMDBTableSrv.seed/IMDBTableSrv.rq);b=Math.floor(IMDBTableSrv.seed%IMDBTableSrv.rq);c=IMDBTableSrv.ra*b-IMDBTableSrv.rr*a;if(c>0){IMDBTableSrv.seed=c}else{IMDBTableSrv.seed=c+IMDBTableSrv.rm}return IMDBTableSrv.seed};IMDBTableSrv.prototype.CopyFrom=function(c,d){if(d==undefined){d=false}this.SetNumFields(c.NumFields);this.Delete(0);for(var b=0;b<c.NumFields;b++){this.FieldDefs[b].CopyFrom(c.FieldDefs[b])}c.MoveFirst(0);while(!c.IsEof(0)){this.AddNew(0);if(d){this.AttPos[0].LinkFromRows=c.AttPos[0].LinkFromRows;this.AttPos[0].LinkToRows=c.AttPos[0].LinkToRows;for(var a=0;a<c.NumFields;a++){if(c.AttPos[0].Values[a].LinkedValue!=null){this.AttPos[0].Values[a].LinkedValue=c.AttPos[0].Values[a].LinkedValue}else{this.AttPos[0].Values[a].Value=c.AttPos[0].Values[a].Value}}}else{for(var a=0;a<c.NumFields;a++){this.PutValue(c.GetValue(a,0),a,0)}}c.MoveNext(0)}c.MoveFirst(0);this.MoveFirst(0);this.ResetModified(-1)};IMDBTableSrv.prototype.GetRecordset=function(){var b=new IDCachedRowSet();var a=new IDCachedRowSetMetaData();a.setColumnCount(this.NumFields);for(var d=0;d<this.NumFields;d++){var f=this.FieldDef(d).DataType;a.setColumnName(d+1,this.FieldDef(d).Code);a.setColumnType(d+1,f)}b.setMetaData(a);this.MoveFirst(1);while(!this.IsEof(1)){var g=new ArrayList();for(var c=0;c<this.NumFields;c++){g.Add(this.GetValue(c,1))}b.AddRow(g);this.MoveNext(1)}if(this.AttPos[0]!=null){var h=0;var e=this.FirstRow;while(e!=null&&e!=this.AttPos[0]){e=e.Next;h++}b.absolute(h+1)}return b};IMDBTableSrv.prototype.Initialized=function(){return this.FieldDefs!=null};function IMDBTblRowsSrv(b){this.pTable;this.Values;this.RowBookMark;this.Prev;this.Next;this.LinkToRows=new ArrayList();this.LinkFromRows=new ArrayList();if(b!=undefined){this.pTable=b;this.Values=new Array();var c=b.NumFields;for(var a=0;a<c;a++){this.Values[a]=new IMDBFldValueSrv()}this.RowBookMark=b.NextBookMark++}}IMDBTblRowsSrv.prototype.CompareTo=function(e){if(this.pTable.SortFields.Count()==0){if(this.RowBookMark==e.RowBookMark){return 0}if(this.RowBookMark>e.RowBookMark){return 1}return -1}var b=this.pTable.SortFields.Count();for(var d=0;d<b;d++){var c=this.pTable.SortFields[d];if(!(this.Values[c.Index].equals(e.Values[c.Index]))){var a=this.Values[c.Index].CompareTo(e.Values[c.Index]);return(c.SortAsc)?a:-a}}return 0};IMDBTblRowsSrv.prototype.equals=function(a){return this.CompareTo(a)==0};IMDBTblRowsSrv.prototype.LinkRow=function(a,c){if(a.AttPos[c]==null){return false}var b=a.AttPos[c];this.LinkToRows.Add(b);b.LinkFromRows.Add(this);return true};IMDBTblRowsSrv.prototype.DeleteLink=function(){var c=this.LinkToRows.Count();for(var b=0;b<c;b++){this.LinkToRows[b].LinkFromRows.Remove(this)}var a=new ArrayList(this.LinkFromRows);c=a.Count();for(b=0;b<c;b++){a[b].AutoDelete()}};IMDBTblRowsSrv.prototype.SynchronizeRows=function(c){var d=this.LinkToRows.Count();for(var a=0;a<d;a++){var b=this.LinkToRows[a];b.pTable.AttPos[c]=b}};IMDBTblRowsSrv.prototype.AutoDelete=function(){this.pTable.AttPos[0]=this;this.pTable.Delete(0)};IMDBTblRowsSrv.prototype.LinkField=function(b,c,a,e){if(c.AttPos[e]==null){return false}var d=c.AttPos[e];this.Values[b].LinkTo(d.Values[a]);return true};IMDBTblRowsSrv.prototype.SetModified=function(){this.pTable.SetModified()};IMDBTblRowsSrv.prototype.SetPRows=function(){var b=this.Values.length;for(var a=0;a<b;a++){this.Values[a].pRow=this}};function ProXMLDocument(){this.childNodes=new Array()}ProXMLDocument.getPrefix=function(a){var b=a.split(":");if(b.length==2){return b[0]}};ProXMLDocument.prototype.createProcessingInstruction=function(a,b){return new ProXMLProcessingInstruction(a,b)};ProXMLDocument.prototype.createElement=function(a,b){return new ProXMLNode(a,undefined,b)};ProXMLDocument.prototype.createTextNode=function(b,a){var c=new ProXMLNode("",3,a);c.data=b;return c};ProXMLDocument.prototype.createCDATASection=function(a){var b=new ProXMLNode("",4);b.data=a;return b};ProXMLDocument.prototype.hasChildNodes=function(){return(this.childNodes.length>0)};ProXMLDocument.prototype.appendChild=function(a){this.childNodes.push(a);a.setOwnerDocument(this)};ProXMLDocument.prototype.removeChild=function(c){var b=this.childNodes.length;for(var a=0;a<b;a++){if(this.childNodes[a]==c){this.childNodes.splice(a,1);break}}};ProXMLDocument.prototype.getElementsByTagName=function(d){var a=new Array();var c=this.childNodes.length;for(var b=0;b<c;b++){if(this.childNodes[b] instanceof ProXMLProcessingInstruction){continue}if(this.childNodes[b].nodeName==d){a.push(this.childNodes[b])}a=a.concat(this.childNodes[b].getElementsByTagName(d))}return a};ProXMLDocument.prototype.saveToString=function(a){if(a==undefined){a=XMLDoc.FT_XML}switch(a){case XMLDoc.FT_XML:return this.saveToXML();break;case XMLDoc.FT_JSON:return this.saveToJSON();break}};ProXMLDocument.prototype.saveToXML=function(){var c="";var b=this.childNodes.length;for(var a=0;a<b;a++){c=c+this.childNodes[a].toString()}return c};ProXMLDocument.prototype.saveToJSON=function(){var a=new IDVariant("");if(this.childNodes.length>0){var b=this.childNodes[0];if(b.nodeName=="xml"&&this.childNodes.length>1){b=this.childNodes[1]}if(!b.nodeName||b.nodeName.toLowerCase()==XMLDoc.ROOT_JSON.toLowerCase()){ProXMLDocument.XmlToJSONnode(a,b,false)}else{a.Value+="{ ";ProXMLDocument.XmlToJSONnode(a,b,true);a.Value+="}"}}return a.stringValue()};ProXMLDocument.XmlToJSONnode=function(h,a,b){if(b){h.Value+='"'+ProXMLDocument.SafeJSON(a.nodeName)+'": '}var d=a.childNodes.length>1;for(var e=0;e<a.childNodes.length;e++){var k=a.childNodes[e];if(k.nodeType!=3){d=false;break}}if(d){h.Value+="[ ";for(var e=0;e<a.childNodes.length;e++){ProXMLDocument.OutputNode("",a.childNodes[e].data,h,false)}h.Value=h.Value.substring(0,h.Value.length-2);h.Value+=" ]";return}h.Value+="{";var m=new ArrayList();var n=new ArrayList();if(a.attributes!=null){for(var e=0;e<a.attributes.length;e++){var g=a.attributes[e];if(g.nodeName.equals(XMLDoc.JSON_ISARRAYCHILD)){continue}ProXMLDocument.StoreChildNode(m,n,g.nodeName,g.nodeValue)}}for(var e=0;e<a.childNodes.length;e++){var k=a.childNodes[e];if(k.nodeType==3){ProXMLDocument.StoreChildNode(m,n,"value",k.data)}else{if(k.nodeType==1){ProXMLDocument.StoreChildNode(m,n,k.nodeName,k)}}}for(var e=0;e<m.length;e++){var f=m[e];var l=n[e];if(l.length==1&&!(l[0]!=null&&l[0].nodeType==1&&l[0].getAttribute(XMLDoc.JSON_ISARRAYCHILD)=="1")){ProXMLDocument.OutputNode(f,l[0],h,true)}else{h.Value+='"'+ProXMLDocument.SafeJSON(f)+'": [ ';for(var c=0;c<l.length;c++){var o=l[c];ProXMLDocument.OutputNode(f,o,h,false)}h.Value=h.Value.substring(0,h.Value.length-2);h.Value+=" ], "}}if(m.length>0){h.Value=h.Value.substring(0,h.Value.length-2)}h.Value+=" }"};ProXMLDocument.StoreChildNode=function(b,g,h,c){if(c instanceof ProXMLNode&&c.nodeType==1){var e=c;if(e.attributes.length==0){var d=e.childNodes;if(d.length==0){c=null}else{if(d.length==1&&d[0].nodeType==3){c=d[0].data}}}}var a=b.indexOf(h);var f;if(a==-1){f=new ArrayList();b.Add(h);g.Add(f)}else{f=g[a]}f.Add(c)};ProXMLDocument.OutputNode=function(c,e,a,d){if(e==null){if(d){a.Value+='"'+ProXMLDocument.SafeJSON(c)+'": '}a.Value+="null"}else{if(typeof(e)=="string"||typeof(e)=="number"){if(d){a.Value+='"'+ProXMLDocument.SafeJSON(c)+'": '}var b=e.toString();if(b.startsWith("$asString$")){a.Value+='"'+ProXMLDocument.SafeJSON(b.substring("$asString$".length))+'"'}else{if(ProXMLDocument.isJSONnumber(b)){a.Value+=b}else{if(b==XMLDoc.NULL_VALUE){a.Value+="null"}else{if(b==XMLDoc.TRUE_VALUE){a.Value+="true"}else{if(b==XMLDoc.FALSE_VALUE){a.Value+="false"}else{if(b==XMLDoc.EMPTY_ARRAY){a.Value+="[]"}else{a.Value+='"'+ProXMLDocument.SafeJSON(b)+'"'}}}}}}}else{ProXMLDocument.XmlToJSONnode(a,e,d)}}a.Value+=", "};ProXMLDocument.SafeJSON=function(a){var b=JSON.stringify(a);return b.substring(1,b.length-1)};ProXMLDocument.isJSONnumber=function(d){if(!isFinite(d)){return false}if(d==null||d.length==0){return false}if(d.length>15){return false}var e=d.charAt(0);if(!String.isDigit(e)&&e!="-"){return false}if(d.length>2&&e=="-"&&d.charAt(1)=="0"&&d.charAt(2)!="."){return false}if(d.length>1&&e=="-"&&d.charAt(1)=="."){return false}if(d.length>1&&e=="0"&&d.charAt(1)!="."){return false}e=d.charAt(d.length-1);if(e=="."||e==" "){return false}var b=false;for(var a=1;a<d.length;a++){e=d.charAt(a);if(String.isDigit(e)){continue}if(e=="."){if(!b){b=true}else{return false}}else{return false}}if(b&&d.length>0&&d.charAt(d.length-1)=="0"){return false}return true};ProXMLDocument.prototype.loadFromString=function(d,c){if(c==undefined||c==-1){c=XMLDoc.FT_XML;for(var a=0;a<d.length;a++){var b=d.charAt(a);if(b=="<"){break}if(b=="{"){c=XMLDoc.FT_JSON;break}}}switch(c){case XMLDoc.FT_XML:return this.loadFromXML(d);break;case XMLDoc.FT_JSON:return this.loadFromJSON(d);break}};ProXMLDocument.prototype.loadFromXML=function(q){this.childNodes=new Array();var r=1;var g=0;var z="";var s="";var a=0;try{var A=q.length;while(g<A){switch(r){case 1:var k=q.charAt(g);if(k=="<"){r=2;s="<"}g++;break;case 2:var k=q.charAt(g);s=s+k;if(k==">"){if(s.charAt(1)=="?"){if(s.charAt(s.length-2)!="?"){throw new Error("MALFORMED PROCESSING INSTRUCTION "+s)}var b=s.substring(2,s.length-2);var f=b.split(" ");if(f.length<2){throw new Error("MALFORMED PROCESSING INSTRUCTION "+s)}var u=f[0];f.splice(0,1);var j=f.join(" ");var y=this.createProcessingInstruction(u,j);this.appendChild(y);r=1;s=""}else{if(s.charAt(s.length-2)=="/"){var m=new ProXMLNode();m.loadFromXML(s);this.appendChild(m);r=1;s=""}else{var t=s.substring(1,s.length-1);var f=t.split(" ");if(f.length<1){throw Error("MALFORMED NODE NAME"+s)}z=f[0];a=0;r=3}}}g++;break;case 3:var k=q.charAt(g);s=s+k;if(k=="<"){var o=q.substring(g,g+z.length+1);var c=q.substring(g+z.length+1,g+z.length+2);if(o=="<"+z&&(c=="/"||c==" "||c==">")){var l=q.indexOf(">",g);if(q.charAt(l-1)!="/"){a=a+1}}o=q.substring(g,g+z.length+3);if(o=="</"+z+">"){if(a==0){var m=new ProXMLNode();m.loadFromXML(s+"/"+z+">");this.appendChild(m);r=1;g=g+z.length+2;z="";s=""}if(a>0){a=a-1}}}g++;break}}if(this.childNodes.length>2){var d=this.childNodes.length;var v=false;for(var h=0;h<d;h++){if(this.childNodes[h] instanceof ProXMLNode){if(!v){v=true}else{throw Error("MALFORMED XML: ALLOWED ONLY ONE ROOT NODE")}}}}}catch(x){this.childNodes.splice(0,this.childNodes.length);throw x}return""};ProXMLDocument.prototype.loadFromJSON=function(g){this.childNodes=new Array();try{var b=this.createElement(XMLDoc.ROOT_JSON);var a=JSON.parse(g);var c=Object.keys(a);for(var f=0;f<c.length;f++){ProXMLNode.loadFromJSON(b,a[c[f]],c[f])}if(b.nodeName==XMLDoc.ROOT_JSON&&b.childNodes.length==1&&b.attributes.length==0&&b.childNodes[0].nodeType==1&&b.childNodes[0].getAttribute(XMLDoc.JSON_ISARRAYCHILD)!="1"){this.appendChild(b.childNodes[0])}else{this.appendChild(b)}}catch(d){this.childNodes=new Array();throw d}};ProXMLDocument.prototype.Save=function(b,c){var a=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForOutput(new IDVariant(b),a);RD4_WebEntryPoint.VBFile.WriteLine(a,new IDVariant(this.saveToString(c)));RD4_WebEntryPoint.VBFile.Close(a)};ProXMLDocument.prototype.Load=function(c,d){var b="";var a=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForInput(new IDVariant(c),a);while(!RD4_WebEntryPoint.VBFile.EOF(a)){b+=RD4_WebEntryPoint.VBFile.ReadLine(a).stringValue()}RD4_WebEntryPoint.VBFile.Close(a);this.loadFromString(b)};function ProXMLProcessingInstruction(b,a){this.childNodes=new Array();this.attributes=new Array();this.nodeName=b;this.piAttr=a}ProXMLProcessingInstruction.prototype.setOwnerDocument=function(a){};ProXMLProcessingInstruction.prototype.toString=function(){return"<?"+this.nodeName+" "+this.piAttr+"?>"};function ProXMLNode(a,c,b){this.childNodes=new Array();this.attributes=new Array();this.nodeName="";this.nodeType=1;this.ownerDocument=null;this.data="";if(a!=undefined){this.nodeName=a}if(c!=undefined){this.nodeType=c}if(b){var d=ProXMLDocument.getPrefix(this.nodeName);if(d){this.setAttribute("xmlns:"+d,b)}}}ProXMLNode.prototype.setOwnerDocument=function(c){this.ownerDocument=c;var b=this.childNodes.length;for(var a=0;a<b;a++){this.childNodes[a].setOwnerDocument(c)}};ProXMLNode.prototype.getOwnerDocument=function(){return this.ownerDocument};ProXMLNode.prototype.getNamespace=function(){var a=ProXMLDocument.getPrefix(this.nodeName);if(a){return this.getNamespaceByPrefix(a)}};ProXMLNode.prototype.getNamespaceByPrefix=function(b){var a=this.getAttribute("xmlns:"+b);if(a){return a}if(b=="xmlns"){return"http://www.w3.org/2000/xmlns/"}if(this.parentNode){return this.parentNode.getNamespaceByPrefix(b)}};ProXMLNode.prototype.getPrefixByNamespace=function(d){var a=this.attributes.length;for(var c=0;c<a;c++){var b=this.attributes[c];if(ProXMLDocument.getPrefix(attr.nodeName)==="xmlns"&&b.nodeValue===d){return attr.nodeName.split(":")[1]}}if(this.parentNode){return this.parentNode.getPrefixByNamespace(d)}};ProXMLNode.prototype.hasChildNodes=function(){return(this.childNodes.length>0)};ProXMLNode.prototype.appendChild=function(a){this.childNodes.push(a);a.setOwnerDocument(this.ownerDocument);a.parentNode=this};ProXMLNode.prototype.removeChild=function(c){var b=this.childNodes.length;for(var a=0;a<b;a++){if(this.childNodes[a]==c){this.childNodes.splice(a,1);break}}};ProXMLNode.prototype.getFirstChild=function(){return this.childNodes[0]};ProXMLNode.prototype.insertBefore=function(a,c){if(a==c){return}var d=this.childNodes.length;for(var b=0;b<d;b++){if(this.childNodes[b]==a){this.childNodes.splice(b--,1)}if(this.childNodes[b]==c){this.childNodes.splice(b,0,a);b++}}a.parentNode=this};ProXMLNode.prototype.insertAfter=function(a,c){if(a==c){return}var d=this.childNodes.length;for(var b=0;b<d;b++){if(this.childNodes[b]==a){this.childNodes.splice(b--,1)}if(this.childNodes[b]==c){this.childNodes.splice(b+1,0,a);b++}}a.parentNode=this};ProXMLNode.prototype.hasAttribute=function(c,e){if(e){var f=ProXMLDocument.getPrefix(c);if(f){return}f=this.getPrefixByNamespace(e);if(!f){return}c=f+":"+c}var a=this.attributes.length;for(var d=0;d<a;d++){var b=this.attributes[d];if(b.nodeName==c){return true}}return false};ProXMLNode.prototype.getAttribute=function(c,e){if(e){var f=ProXMLDocument.getPrefix(c);if(f){return}f=this.getPrefixByNamespace(e);if(!f){return}c=f+":"+c}var a=this.attributes.length;for(var d=0;d<a;d++){var b=this.attributes[d];if(b.nodeName==c){return b.nodeValue}}return""};ProXMLNode.prototype.setAttribute=function(c,g,e){if(e){var f=ProXMLDocument.getPrefix(c);if(!f){return}if(this.getPrefixByNamespace(e)!=f){}this.setAttribute("xmlns:"+f,e)}var a=this.attributes.length;for(var d=0;d<a;d++){var b=this.attributes[d];if(b.nodeName==c){b.nodeValue=g;return}}var b=new ProXMLAttribute();b.nodeName=c;b.nodeValue=g;this.attributes.push(b)};ProXMLNode.prototype.removeAttribute=function(c,e){if(e){var f=ProXMLDocument.getPrefix(c);if(f){return}f=this.getPrefixByNamespace(e);if(!f){return}c=f+":"+c}var a=this.attributes.length;for(var d=0;d<a;d++){var b=this.attributes[d];if(b.nodeName==c){this.attributes.remove(b);break}}};ProXMLNode.prototype.getElementsByTagName=function(d){var a=new Array();var c=this.childNodes.length;for(var b=0;b<c;b++){if(this.childNodes[b].nodeName==d){a.push(this.childNodes[b])}a=a.concat(this.childNodes[b].getElementsByTagName(d))}return a};ProXMLNode.prototype.loadFromXML=function(t){var D="";var y="";if(t.charAt(t.length-2)=="/"){D=t.substring(1,t.length-2)}else{var j=t.indexOf(">");D=t.substring(1,j);var v=t.lastIndexOf("</");y=t.substring(j+1,v)}var l=0;var I=D.length;var s=false;var k="";var e=new Array();var F="";while(l<I){var h=D.charAt(l);if(h=='"'||h=="'"){if(!s){s=true;k=h}else{if(h==k){s=false;k=""}}}if(!s&&h==" "){e.push(F);F="";l++;continue}F=F+h;l++}if(F.length!=0){e.push(F);F=""}if(e.length==0){throw Error("MALFORMED NODE "+D)}this.nodeName=e[0];e.splice(0,1);var u=e.length;for(var C=0;C<u;C++){var o=e[C];var g=o.indexOf("=");if(g==-1){throw Error("MALFORMED ATTRIBUTE, = NOT FOUND "+o)}var E=new Array();E.push(o.substring(0,g));E.push(o.substring(g+1,o.length));var H=E[0];if(E[1].charAt(0)=="'"||E[1].charAt(0)=='"'){E[1]=E[1].substr(1)}if(E[1].charAt(E[1].length-1)=="'"||E[1].charAt(E[1].length-1)=='"'){E[1]=E[1].substring(0,E[1].length-1)}var r=E[1];this.setAttribute(Glb.HTMLDecode(H,true,true),Glb.HTMLDecode(r,true,true))}if(y.length!=0){if(y.indexOf("<")==-1){var h=new ProXMLNode("",3);h.data=Glb.HTMLDecode((y.trim().length>0?y:""),true,true);this.appendChild(h)}else{if(y.substr(0,9)=="<![CDATA["){var d=y.indexOf("]]>");var z=y.substring(9,d);var h=new ProXMLNode("",4);h.data=z;this.appendChild(h)}else{var x=1;var f=0;var G="";var B="";var a=0;var c="";var I=y.length;while(f<I){switch(x){case 1:var h=y.charAt(f);if(h=="<"){x=2;B="<";if(c.replace(/\n/g,"").trim().length>0){var m=new ProXMLNode("",3);m.data=Glb.HTMLDecode(c,true,true);this.appendChild(m)}c=""}else{c+=h}f++;break;case 2:var h=y.charAt(f);B=B+h;if(h==">"){if(B.charAt(B.length-2)=="/"){var m=new ProXMLNode();m.loadFromXML(B);this.appendChild(m);x=1;B=""}else{var A=B.substring(1,B.length-1);var e=A.split(" ");if(e.length<1){throw Error("MALFORMED NODE NAME"+B)}G=e[0];a=0;x=3}}f++;break;case 3:var h=y.charAt(f);B=B+h;if(h=="<"){var q=y.substring(f,f+G.length+1);var b=y.substring(f+G.length+1,f+G.length+2);if(q=="<"+G&&(b=="/"||b==" "||b==">")){var j=y.indexOf(">",f);if(y.charAt(j-1)!="/"){a=a+1}}q=y.substring(f,f+G.length+3);if(q=="</"+G+">"){if(a==0){var m=new ProXMLNode();m.loadFromXML(B+"/"+G+">");this.appendChild(m);x=1;f=f+G.length+2;G="";B=""}if(a>0){a=a-1}}}f++;break}}if(c.replace(/\n/g,"").trim().length>0){var m=new ProXMLNode("",3);m.data=Glb.HTMLDecode(c,true,true);this.appendChild(m)}}}}};ProXMLNode.loadFromJSON=function(k,e,b){if(e instanceof Array){for(var f=0;f<e.length;f++){var c=e[f];if(typeof(c)=="string"||typeof(c)=="number"){var l=new ProXMLNode(b);k.appendChild(l);var j=new ProXMLNode("",3);j.data=c.toString();l.appendChild(j)}else{ProXMLNode.loadFromJSON(k,c,b)}}for(var f=0;f<k.childNodes.length;f++){k.childNodes[f].setAttribute(XMLDoc.JSON_ISARRAYCHILD,"1")}}else{if(e instanceof Object){var d=new ProXMLNode(b);k.appendChild(d);var h=Object.keys(e);for(var f=0;f<h.length;f++){var g=h[f];var a=e[g];ProXMLNode.loadFromJSON(d,a,g)}}else{k.setAttribute(b,IDVariant.convertObject(e).stringValue())}}delete e};ProXMLNode.prototype.toString=function(){if(this.nodeType==3){return Glb.HTMLEncode(this.data,false,false,false,true)}else{if(this.nodeType==4){return"<![CDATA["+this.data+"]]>"}else{var d="<"+this.nodeName;var c=this.attributes.length;for(var a=0;a<c;a++){if(this.attributes[a].nodeName.equals(XMLDoc.JSON_ISARRAYCHILD)){continue}d=d+" "+this.attributes[a].toString()}var b=this.childNodes.length;if(b!=0){d=d+">";for(var a=0;a<b;a++){d=d+this.childNodes[a].toString()}d=d+"</"+this.nodeName+">"}else{d=d+"/>"}return d}}};function ProXMLAttribute(){this.nodeName="";this.nodeValue=""}ProXMLAttribute.prototype.getNamespace=function(b){var a=ProXMLDocument.getPrefix(this.nodeName);if(a){return b.getNamespaceByPrefix(a)}};ProXMLAttribute.prototype.toString=function(){return Glb.HTMLEncode(this.nodeName)+'="'+Glb.HTMLEncode(this.nodeValue,false,false,false,true)+'"'};function RectSrv(){this.Left;this.Top;this.Width;this.Height}RectSrv.prototype.Clone=function(){var a=new RectSrv();a.Left=this.Left;a.Top=this.Top;a.Width=this.Width;a.Height=this.Height;return a};function SimpleCrypter(){this.iCompatibilityMode=true}SimpleCrypter.prototype.CompatibilityMode=function(){return this.iCompatibilityMode};SimpleCrypter.prototype.set_CompatibilityMode=function(a){this.iCompatibilityMode=a};SimpleCrypter.RotateLeft=function(b,a){return(b<<a)|(b>>>(32-a))};SimpleCrypter.AddUnsigned=function(e,b){var g,a,d,f,c;d=(e&2147483648);f=(b&2147483648);g=(e&1073741824);a=(b&1073741824);c=(e&1073741823)+(b&1073741823);if(g&a){return(c^2147483648^d^f)}if(g|a){if(c&1073741824){return(c^3221225472^d^f)}else{return(c^1073741824^d^f)}}else{return(c^d^f)}};SimpleCrypter.F=function(a,c,b){return(a&c)|((~a)&b)};SimpleCrypter.G=function(a,c,b){return(a&b)|(c&(~b))};SimpleCrypter.H=function(a,c,b){return(a^c^b)};SimpleCrypter.I=function(a,c,b){return(c^(a|(~b)))};SimpleCrypter.FF=function(g,f,l,k,e,h,j){g=SimpleCrypter.AddUnsigned(g,SimpleCrypter.AddUnsigned(SimpleCrypter.AddUnsigned(SimpleCrypter.F(f,l,k),e),j));return SimpleCrypter.AddUnsigned(SimpleCrypter.RotateLeft(g,h),f)};SimpleCrypter.GG=function(g,f,l,k,e,h,j){g=SimpleCrypter.AddUnsigned(g,SimpleCrypter.AddUnsigned(SimpleCrypter.AddUnsigned(SimpleCrypter.G(f,l,k),e),j));return SimpleCrypter.AddUnsigned(SimpleCrypter.RotateLeft(g,h),f)};SimpleCrypter.HH=function(g,f,l,k,e,h,j){g=SimpleCrypter.AddUnsigned(g,SimpleCrypter.AddUnsigned(SimpleCrypter.AddUnsigned(SimpleCrypter.H(f,l,k),e),j));return SimpleCrypter.AddUnsigned(SimpleCrypter.RotateLeft(g,h),f)};SimpleCrypter.II=function(g,f,l,k,e,h,j){g=SimpleCrypter.AddUnsigned(g,SimpleCrypter.AddUnsigned(SimpleCrypter.AddUnsigned(SimpleCrypter.I(f,l,k),e),j));return SimpleCrypter.AddUnsigned(SimpleCrypter.RotateLeft(g,h),f)};SimpleCrypter.ConvertToWordArray=function(e){var h;var d=e.length;var c=d+8;var b=(c-(c%64))/64;var g=(b+1)*16;var j=new Array(g-1);var a=0;var f=0;while(f<d){h=(f-(f%4))/4;a=(f%4)*8;j[h]=(j[h]|(e.charCodeAt(f)<<a));f++}h=(f-(f%4))/4;a=(f%4)*8;j[h]=j[h]|(128<<a);j[g-2]=d<<3;j[g-1]=d>>>29;return j};SimpleCrypter.WordToHex=function(c){var b="",d="",e,a;for(a=0;a<=3;a++){e=(c>>>(a*8))&255;d="0"+e.toString(16);b=b+d.substr(d.length-2,2)}return b};SimpleCrypter.Utf8Encode=function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a};SimpleCrypter.MD5=function(e){var n=Array();var A,B,f,m,z,K,J,H,F;var v=7,t=12,r=17,o=22;var I=5,G=9,D=14,C=20;var l=4,j=11,h=16,g=23;var y=6,u=10,s=15,q=21;e=SimpleCrypter.Utf8Encode(e);n=SimpleCrypter.ConvertToWordArray(e);K=1732584193;J=4023233417;H=2562383102;F=271733878;for(A=0;A<n.length;A+=16){B=K;f=J;m=H;z=F;K=SimpleCrypter.FF(K,J,H,F,n[A+0],v,3614090360);F=SimpleCrypter.FF(F,K,J,H,n[A+1],t,3905402710);H=SimpleCrypter.FF(H,F,K,J,n[A+2],r,606105819);J=SimpleCrypter.FF(J,H,F,K,n[A+3],o,3250441966);K=SimpleCrypter.FF(K,J,H,F,n[A+4],v,4118548399);F=SimpleCrypter.FF(F,K,J,H,n[A+5],t,1200080426);H=SimpleCrypter.FF(H,F,K,J,n[A+6],r,2821735955);J=SimpleCrypter.FF(J,H,F,K,n[A+7],o,4249261313);K=SimpleCrypter.FF(K,J,H,F,n[A+8],v,1770035416);F=SimpleCrypter.FF(F,K,J,H,n[A+9],t,2336552879);H=SimpleCrypter.FF(H,F,K,J,n[A+10],r,4294925233);J=SimpleCrypter.FF(J,H,F,K,n[A+11],o,2304563134);K=SimpleCrypter.FF(K,J,H,F,n[A+12],v,1804603682);F=SimpleCrypter.FF(F,K,J,H,n[A+13],t,4254626195);H=SimpleCrypter.FF(H,F,K,J,n[A+14],r,2792965006);J=SimpleCrypter.FF(J,H,F,K,n[A+15],o,1236535329);K=SimpleCrypter.GG(K,J,H,F,n[A+1],I,4129170786);F=SimpleCrypter.GG(F,K,J,H,n[A+6],G,3225465664);H=SimpleCrypter.GG(H,F,K,J,n[A+11],D,643717713);J=SimpleCrypter.GG(J,H,F,K,n[A+0],C,3921069994);K=SimpleCrypter.GG(K,J,H,F,n[A+5],I,3593408605);F=SimpleCrypter.GG(F,K,J,H,n[A+10],G,38016083);H=SimpleCrypter.GG(H,F,K,J,n[A+15],D,3634488961);J=SimpleCrypter.GG(J,H,F,K,n[A+4],C,3889429448);K=SimpleCrypter.GG(K,J,H,F,n[A+9],I,568446438);F=SimpleCrypter.GG(F,K,J,H,n[A+14],G,3275163606);H=SimpleCrypter.GG(H,F,K,J,n[A+3],D,4107603335);J=SimpleCrypter.GG(J,H,F,K,n[A+8],C,1163531501);K=SimpleCrypter.GG(K,J,H,F,n[A+13],I,2850285829);F=SimpleCrypter.GG(F,K,J,H,n[A+2],G,4243563512);H=SimpleCrypter.GG(H,F,K,J,n[A+7],D,1735328473);J=SimpleCrypter.GG(J,H,F,K,n[A+12],C,2368359562);K=SimpleCrypter.HH(K,J,H,F,n[A+5],l,4294588738);F=SimpleCrypter.HH(F,K,J,H,n[A+8],j,2272392833);H=SimpleCrypter.HH(H,F,K,J,n[A+11],h,1839030562);J=SimpleCrypter.HH(J,H,F,K,n[A+14],g,4259657740);K=SimpleCrypter.HH(K,J,H,F,n[A+1],l,2763975236);F=SimpleCrypter.HH(F,K,J,H,n[A+4],j,1272893353);H=SimpleCrypter.HH(H,F,K,J,n[A+7],h,4139469664);J=SimpleCrypter.HH(J,H,F,K,n[A+10],g,3200236656);K=SimpleCrypter.HH(K,J,H,F,n[A+13],l,681279174);F=SimpleCrypter.HH(F,K,J,H,n[A+0],j,3936430074);H=SimpleCrypter.HH(H,F,K,J,n[A+3],h,3572445317);J=SimpleCrypter.HH(J,H,F,K,n[A+6],g,76029189);K=SimpleCrypter.HH(K,J,H,F,n[A+9],l,3654602809);F=SimpleCrypter.HH(F,K,J,H,n[A+12],j,3873151461);H=SimpleCrypter.HH(H,F,K,J,n[A+15],h,530742520);J=SimpleCrypter.HH(J,H,F,K,n[A+2],g,3299628645);K=SimpleCrypter.II(K,J,H,F,n[A+0],y,4096336452);F=SimpleCrypter.II(F,K,J,H,n[A+7],u,1126891415);H=SimpleCrypter.II(H,F,K,J,n[A+14],s,2878612391);J=SimpleCrypter.II(J,H,F,K,n[A+5],q,4237533241);K=SimpleCrypter.II(K,J,H,F,n[A+12],y,1700485571);F=SimpleCrypter.II(F,K,J,H,n[A+3],u,2399980690);H=SimpleCrypter.II(H,F,K,J,n[A+10],s,4293915773);J=SimpleCrypter.II(J,H,F,K,n[A+1],q,2240044497);K=SimpleCrypter.II(K,J,H,F,n[A+8],y,1873313359);F=SimpleCrypter.II(F,K,J,H,n[A+15],u,4264355552);H=SimpleCrypter.II(H,F,K,J,n[A+6],s,2734768916);J=SimpleCrypter.II(J,H,F,K,n[A+13],q,1309151649);K=SimpleCrypter.II(K,J,H,F,n[A+4],y,4149444226);F=SimpleCrypter.II(F,K,J,H,n[A+11],u,3174756917);H=SimpleCrypter.II(H,F,K,J,n[A+2],s,718787259);J=SimpleCrypter.II(J,H,F,K,n[A+9],q,3951481745);K=SimpleCrypter.AddUnsigned(K,B);J=SimpleCrypter.AddUnsigned(J,f);H=SimpleCrypter.AddUnsigned(H,m);F=SimpleCrypter.AddUnsigned(F,z)}var E=SimpleCrypter.WordToHex(K)+SimpleCrypter.WordToHex(J)+SimpleCrypter.WordToHex(H)+SimpleCrypter.WordToHex(F);return E.toLowerCase()};SimpleCrypter.des_createKeys=function(G){var F=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964);var E=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697);var D=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272);var C=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144);var A=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256);var y=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488);var v=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746);var u=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568);var t=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578);var r=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488);var f=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800);var e=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744);var d=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128);var c=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261);var s=G.length>8?3:1;var h=new Array(32*s);var g=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0);var x,b,l=0,k=0,z;for(var o=0;o<s;o++){var a=(G.charCodeAt(l++)<<24)|(G.charCodeAt(l++)<<16)|(G.charCodeAt(l++)<<8)|G.charCodeAt(l++);var B=(G.charCodeAt(l++)<<24)|(G.charCodeAt(l++)<<16)|(G.charCodeAt(l++)<<8)|G.charCodeAt(l++);z=((a>>>4)^B)&252645135;B^=z;a^=(z<<4);z=((B>>>-16)^a)&65535;a^=z;B^=(z<<-16);z=((a>>>2)^B)&858993459;B^=z;a^=(z<<2);z=((B>>>-16)^a)&65535;a^=z;B^=(z<<-16);z=((a>>>1)^B)&1431655765;B^=z;a^=(z<<1);z=((B>>>8)^a)&16711935;a^=z;B^=(z<<8);z=((a>>>1)^B)&1431655765;B^=z;a^=(z<<1);z=(a<<8)|((B>>>20)&240);a=(B<<24)|((B<<8)&16711680)|((B>>>8)&65280)|((B>>>24)&240);B=z;for(var q=0;q<g.length;q++){if(g[q]){a=(a<<2)|(a>>>26);B=(B<<2)|(B>>>26)}else{a=(a<<1)|(a>>>27);B=(B<<1)|(B>>>27)}a&=-15;B&=-15;x=F[a>>>28]|E[(a>>>24)&15]|D[(a>>>20)&15]|C[(a>>>16)&15]|A[(a>>>12)&15]|y[(a>>>8)&15]|v[(a>>>4)&15];b=u[B>>>28]|t[(B>>>24)&15]|r[(B>>>20)&15]|f[(B>>>16)&15]|e[(B>>>12)&15]|d[(B>>>8)&15]|c[(B>>>4)&15];z=((b>>>16)^x)&65535;h[k++]=x^z;h[k++]=b^(z<<16)}}return h};SimpleCrypter.Des=function(l,h,M,g,r,J){var A=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756);var z=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344);var y=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584);var v=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928);var u=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080);var t=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312);var s=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154);var q=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696);var x=SimpleCrypter.des_createKeys(l);var F=0,K,I,f,O,N,e,E,a;var G,D,L,c;var C,d;var n=h.length;var b=0;var H=x.length==32?3:9;if(H==3){a=M?new Array(0,32,2):new Array(30,-2,-2)}else{a=M?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2)}if(J==2){h+="        "}else{if(J==1){f=8-(n%8);h+=String.fromCharCode(f,f,f,f,f,f,f,f);if(f==8){n+=8}}else{if(!J){h+="\0\0\0\0\0\0\0\0"}}}var o="";var k="";if(g==1){G=(r.charCodeAt(F++)<<24)|(r.charCodeAt(F++)<<16)|(r.charCodeAt(F++)<<8)|r.charCodeAt(F++);L=(r.charCodeAt(F++)<<24)|(r.charCodeAt(F++)<<16)|(r.charCodeAt(F++)<<8)|r.charCodeAt(F++);F=0}while(F<n){e=(h.charCodeAt(F++)<<24)|(h.charCodeAt(F++)<<16)|(h.charCodeAt(F++)<<8)|h.charCodeAt(F++);E=(h.charCodeAt(F++)<<24)|(h.charCodeAt(F++)<<16)|(h.charCodeAt(F++)<<8)|h.charCodeAt(F++);if(g==1){if(M){e^=G;E^=L}else{D=G;c=L;G=e;L=E}}f=((e>>>4)^E)&252645135;E^=f;e^=(f<<4);f=((e>>>16)^E)&65535;E^=f;e^=(f<<16);f=((E>>>2)^e)&858993459;e^=f;E^=(f<<2);f=((E>>>8)^e)&16711935;e^=f;E^=(f<<8);f=((e>>>1)^E)&1431655765;E^=f;e^=(f<<1);e=((e<<1)|(e>>>31));E=((E<<1)|(E>>>31));for(I=0;I<H;I+=3){C=a[I+1];d=a[I+2];for(K=a[I];K!=C;K+=d){O=E^x[K];N=((E>>>4)|(E<<28))^x[K+1];f=e;e=E;E=f^(z[(O>>>24)&63]|v[(O>>>16)&63]|t[(O>>>8)&63]|q[O&63]|A[(N>>>24)&63]|y[(N>>>16)&63]|u[(N>>>8)&63]|s[N&63])}f=e;e=E;E=f}e=((e>>>1)|(e<<31));E=((E>>>1)|(E<<31));f=((e>>>1)^E)&1431655765;E^=f;e^=(f<<1);f=((E>>>8)^e)&16711935;e^=f;E^=(f<<8);f=((E>>>2)^e)&858993459;e^=f;E^=(f<<2);f=((e>>>16)^E)&65535;E^=f;e^=(f<<16);f=((e>>>4)^E)&252645135;E^=f;e^=(f<<4);if(g==1){if(M){G=e;L=E}else{e^=D;E^=c}}var B=String.fromCharCode((e>>>24),((e>>>16)&255),((e>>>8)&255),(e&255),(E>>>24),((E>>>16)&255),((E>>>8)&255),(E&255));k+=B;b+=8;if(b==512){o+=k;k="";b=0}}return o+k};SimpleCrypter.prototype.Encrypt=function(c,a){try{var b=SimpleCrypter.MD5(c);return SimpleCrypter.Des(b.substring(0,24),a,true)}catch(d){return""}};SimpleCrypter.prototype.Decrypt=function(g,b){try{var d=SimpleCrypter.MD5(g);var f=SimpleCrypter.Des(d.substring(0,24),b,false);var a=f.length;for(var c=f.length-1;c>=0;c--){if(f.charCodeAt(c)==0){a=c}else{break}}return f.substring(0,a)}catch(h){return""}};SimpleCrypter.HashWithSalt=function(Password,Salt){(function(){var ERROR="input is invalid type";var WINDOW=typeof window==="object";var root=WINDOW?window:{};if(root.JS_SHA256_NO_WINDOW){WINDOW=false}var WEB_WORKER=!WINDOW&&typeof self==="object";var NODE_JS=!root.JS_SHA256_NO_NODE_JS&&typeof process==="object"&&process.versions&&process.versions.node;if(NODE_JS){root=global}else{if(WEB_WORKER){root=self}}var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&typeof module==="object"&&module.exports;var AMD=typeof define==="function"&&define.amd;var ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer!=="undefined";var HEX_CHARS="0123456789abcdef".split("");var EXTRA=[-2147483648,8388608,32768,128];var SHIFT=[24,16,8,0];var K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var OUTPUT_TYPES=["hex","array","digest","arrayBuffer"];var blocks=[];if(root.JS_SHA256_NO_NODE_JS||!Array.isArray){Array.isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]"}}if(ARRAY_BUFFER&&(root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)){ArrayBuffer.isView=function(obj){return typeof obj==="object"&&obj.buffer&&obj.buffer.constructor===ArrayBuffer}}var createOutputMethod=function(outputType,is224){return function(message){return new Sha256(is224,true).update(message)[outputType]()}};var createMethod=function(is224){var method=createOutputMethod("hex",is224);if(NODE_JS){method=nodeWrap(method,is224)}method.create=function(){return new Sha256(is224)};method.update=function(message){return method.create().update(message)};for(var i=0;i<OUTPUT_TYPES.length;++i){var type=OUTPUT_TYPES[i];method[type]=createOutputMethod(type,is224)}return method};var nodeWrap=function(method,is224){var crypto=eval("require('crypto')");var Buffer=eval("require('buffer').Buffer");var algorithm=is224?"sha224":"sha256";var nodeMethod=function(message){if(typeof message==="string"){return crypto.createHash(algorithm).update(message,"utf8").digest("hex")}else{if(message===null||message===undefined){throw new Error(ERROR)}else{if(message.constructor===ArrayBuffer){message=new Uint8Array(message)}}}if(Array.isArray(message)||ArrayBuffer.isView(message)||message.constructor===Buffer){return crypto.createHash(algorithm).update(new Buffer(message)).digest("hex")}else{return method(message)}};return nodeMethod};var createHmacOutputMethod=function(outputType,is224){return function(key,message){return new HmacSha256(key,is224,true).update(message)[outputType]()}};var createHmacMethod=function(is224){var method=createHmacOutputMethod("hex",is224);method.create=function(key){return new HmacSha256(key,is224)};method.update=function(key,message){return method.create(key).update(message)};for(var i=0;i<OUTPUT_TYPES.length;++i){var type=OUTPUT_TYPES[i];method[type]=createHmacOutputMethod(type,is224)}return method};function Sha256(is224,sharedMemory){if(sharedMemory){blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0;this.blocks=blocks}else{this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}if(is224){this.h0=3238371032;this.h1=914150663;this.h2=812702999;this.h3=4144912697;this.h4=4290775857;this.h5=1750603025;this.h6=1694076839;this.h7=3204075428}else{this.h0=1779033703;this.h1=3144134277;this.h2=1013904242;this.h3=2773480762;this.h4=1359893119;this.h5=2600822924;this.h6=528734635;this.h7=1541459225}this.block=this.start=this.bytes=this.hBytes=0;this.finalized=this.hashed=false;this.first=true;this.is224=is224}Sha256.prototype.update=function(message){if(this.finalized){return}var notString,type=typeof message;if(type!=="string"){if(type==="object"){if(message===null){throw new Error(ERROR)}else{if(ARRAY_BUFFER&&message.constructor===ArrayBuffer){message=new Uint8Array(message)}else{if(!Array.isArray(message)){if(!ARRAY_BUFFER||!ArrayBuffer.isView(message)){throw new Error(ERROR)}}}}}else{throw new Error(ERROR)}notString=true}var code,index=0,i,length=message.length,blocks=this.blocks;while(index<length){if(this.hashed){this.hashed=false;blocks[0]=this.block;blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0}if(notString){for(i=this.start;index<length&&i<64;++index){blocks[i>>2]|=message[index]<<SHIFT[i++&3]}}else{for(i=this.start;index<length&&i<64;++index){code=message.charCodeAt(index);if(code<128){blocks[i>>2]|=code<<SHIFT[i++&3]}else{if(code<2048){blocks[i>>2]|=(192|(code>>6))<<SHIFT[i++&3];blocks[i>>2]|=(128|(code&63))<<SHIFT[i++&3]}else{if(code<55296||code>=57344){blocks[i>>2]|=(224|(code>>12))<<SHIFT[i++&3];blocks[i>>2]|=(128|((code>>6)&63))<<SHIFT[i++&3];blocks[i>>2]|=(128|(code&63))<<SHIFT[i++&3]}else{code=65536+(((code&1023)<<10)|(message.charCodeAt(++index)&1023));blocks[i>>2]|=(240|(code>>18))<<SHIFT[i++&3];blocks[i>>2]|=(128|((code>>12)&63))<<SHIFT[i++&3];blocks[i>>2]|=(128|((code>>6)&63))<<SHIFT[i++&3];blocks[i>>2]|=(128|(code&63))<<SHIFT[i++&3]}}}}}this.lastByteIndex=i;this.bytes+=i-this.start;if(i>=64){this.block=blocks[16];this.start=i-64;this.hash();this.hashed=true}else{this.start=i}}if(this.bytes>4294967295){this.hBytes+=this.bytes/4294967296<<0;this.bytes=this.bytes%4294967296}return this};Sha256.prototype.finalize=function(){if(this.finalized){return}this.finalized=true;var blocks=this.blocks,i=this.lastByteIndex;blocks[16]=this.block;blocks[i>>2]|=EXTRA[i&3];this.block=blocks[16];if(i>=56){if(!this.hashed){this.hash()}blocks[0]=this.block;blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0}blocks[14]=this.hBytes<<3|this.bytes>>>29;blocks[15]=this.bytes<<3;this.hash()};Sha256.prototype.hash=function(){var a=this.h0,b=this.h1,c=this.h2,d=this.h3,e=this.h4,f=this.h5,g=this.h6,h=this.h7,blocks=this.blocks,j,s0,s1,maj,t1,t2,ch,ab,da,cd,bc;for(j=16;j<64;++j){t1=blocks[j-15];s0=((t1>>>7)|(t1<<25))^((t1>>>18)|(t1<<14))^(t1>>>3);t1=blocks[j-2];s1=((t1>>>17)|(t1<<15))^((t1>>>19)|(t1<<13))^(t1>>>10);blocks[j]=blocks[j-16]+s0+blocks[j-7]+s1<<0}bc=b&c;for(j=0;j<64;j+=4){if(this.first){if(this.is224){ab=300032;t1=blocks[0]-1413257819;h=t1-150054599<<0;d=t1+24177077<<0}else{ab=704751109;t1=blocks[0]-210244248;h=t1-1521486534<<0;d=t1+143694565<<0}this.first=false}else{s0=((a>>>2)|(a<<30))^((a>>>13)|(a<<19))^((a>>>22)|(a<<10));s1=((e>>>6)|(e<<26))^((e>>>11)|(e<<21))^((e>>>25)|(e<<7));ab=a&b;maj=ab^(a&c)^bc;ch=(e&f)^(~e&g);t1=h+s1+ch+K[j]+blocks[j];t2=s0+maj;h=d+t1<<0;d=t1+t2<<0}s0=((d>>>2)|(d<<30))^((d>>>13)|(d<<19))^((d>>>22)|(d<<10));s1=((h>>>6)|(h<<26))^((h>>>11)|(h<<21))^((h>>>25)|(h<<7));da=d&a;maj=da^(d&b)^ab;ch=(h&e)^(~h&f);t1=g+s1+ch+K[j+1]+blocks[j+1];t2=s0+maj;g=c+t1<<0;c=t1+t2<<0;s0=((c>>>2)|(c<<30))^((c>>>13)|(c<<19))^((c>>>22)|(c<<10));s1=((g>>>6)|(g<<26))^((g>>>11)|(g<<21))^((g>>>25)|(g<<7));cd=c&d;maj=cd^(c&a)^da;ch=(g&h)^(~g&e);t1=f+s1+ch+K[j+2]+blocks[j+2];t2=s0+maj;f=b+t1<<0;b=t1+t2<<0;s0=((b>>>2)|(b<<30))^((b>>>13)|(b<<19))^((b>>>22)|(b<<10));s1=((f>>>6)|(f<<26))^((f>>>11)|(f<<21))^((f>>>25)|(f<<7));bc=b&c;maj=bc^(b&d)^cd;ch=(f&g)^(~f&h);t1=e+s1+ch+K[j+3]+blocks[j+3];t2=s0+maj;e=a+t1<<0;a=t1+t2<<0}this.h0=this.h0+a<<0;this.h1=this.h1+b<<0;this.h2=this.h2+c<<0;this.h3=this.h3+d<<0;this.h4=this.h4+e<<0;this.h5=this.h5+f<<0;this.h6=this.h6+g<<0;this.h7=this.h7+h<<0};Sha256.prototype.hex=function(){this.finalize();var h0=this.h0,h1=this.h1,h2=this.h2,h3=this.h3,h4=this.h4,h5=this.h5,h6=this.h6,h7=this.h7;var hex=HEX_CHARS[(h0>>28)&15]+HEX_CHARS[(h0>>24)&15]+HEX_CHARS[(h0>>20)&15]+HEX_CHARS[(h0>>16)&15]+HEX_CHARS[(h0>>12)&15]+HEX_CHARS[(h0>>8)&15]+HEX_CHARS[(h0>>4)&15]+HEX_CHARS[h0&15]+HEX_CHARS[(h1>>28)&15]+HEX_CHARS[(h1>>24)&15]+HEX_CHARS[(h1>>20)&15]+HEX_CHARS[(h1>>16)&15]+HEX_CHARS[(h1>>12)&15]+HEX_CHARS[(h1>>8)&15]+HEX_CHARS[(h1>>4)&15]+HEX_CHARS[h1&15]+HEX_CHARS[(h2>>28)&15]+HEX_CHARS[(h2>>24)&15]+HEX_CHARS[(h2>>20)&15]+HEX_CHARS[(h2>>16)&15]+HEX_CHARS[(h2>>12)&15]+HEX_CHARS[(h2>>8)&15]+HEX_CHARS[(h2>>4)&15]+HEX_CHARS[h2&15]+HEX_CHARS[(h3>>28)&15]+HEX_CHARS[(h3>>24)&15]+HEX_CHARS[(h3>>20)&15]+HEX_CHARS[(h3>>16)&15]+HEX_CHARS[(h3>>12)&15]+HEX_CHARS[(h3>>8)&15]+HEX_CHARS[(h3>>4)&15]+HEX_CHARS[h3&15]+HEX_CHARS[(h4>>28)&15]+HEX_CHARS[(h4>>24)&15]+HEX_CHARS[(h4>>20)&15]+HEX_CHARS[(h4>>16)&15]+HEX_CHARS[(h4>>12)&15]+HEX_CHARS[(h4>>8)&15]+HEX_CHARS[(h4>>4)&15]+HEX_CHARS[h4&15]+HEX_CHARS[(h5>>28)&15]+HEX_CHARS[(h5>>24)&15]+HEX_CHARS[(h5>>20)&15]+HEX_CHARS[(h5>>16)&15]+HEX_CHARS[(h5>>12)&15]+HEX_CHARS[(h5>>8)&15]+HEX_CHARS[(h5>>4)&15]+HEX_CHARS[h5&15]+HEX_CHARS[(h6>>28)&15]+HEX_CHARS[(h6>>24)&15]+HEX_CHARS[(h6>>20)&15]+HEX_CHARS[(h6>>16)&15]+HEX_CHARS[(h6>>12)&15]+HEX_CHARS[(h6>>8)&15]+HEX_CHARS[(h6>>4)&15]+HEX_CHARS[h6&15];if(!this.is224){hex+=HEX_CHARS[(h7>>28)&15]+HEX_CHARS[(h7>>24)&15]+HEX_CHARS[(h7>>20)&15]+HEX_CHARS[(h7>>16)&15]+HEX_CHARS[(h7>>12)&15]+HEX_CHARS[(h7>>8)&15]+HEX_CHARS[(h7>>4)&15]+HEX_CHARS[h7&15]}return hex};Sha256.prototype.toString=Sha256.prototype.hex;Sha256.prototype.digest=function(){this.finalize();var h0=this.h0,h1=this.h1,h2=this.h2,h3=this.h3,h4=this.h4,h5=this.h5,h6=this.h6,h7=this.h7;var arr=[(h0>>24)&255,(h0>>16)&255,(h0>>8)&255,h0&255,(h1>>24)&255,(h1>>16)&255,(h1>>8)&255,h1&255,(h2>>24)&255,(h2>>16)&255,(h2>>8)&255,h2&255,(h3>>24)&255,(h3>>16)&255,(h3>>8)&255,h3&255,(h4>>24)&255,(h4>>16)&255,(h4>>8)&255,h4&255,(h5>>24)&255,(h5>>16)&255,(h5>>8)&255,h5&255,(h6>>24)&255,(h6>>16)&255,(h6>>8)&255,h6&255];if(!this.is224){arr.push((h7>>24)&255,(h7>>16)&255,(h7>>8)&255,h7&255)}return arr};Sha256.prototype.array=Sha256.prototype.digest;Sha256.prototype.arrayBuffer=function(){this.finalize();var buffer=new ArrayBuffer(this.is224?28:32);var dataView=new DataView(buffer);dataView.setUint32(0,this.h0);dataView.setUint32(4,this.h1);dataView.setUint32(8,this.h2);dataView.setUint32(12,this.h3);dataView.setUint32(16,this.h4);dataView.setUint32(20,this.h5);dataView.setUint32(24,this.h6);if(!this.is224){dataView.setUint32(28,this.h7)}return buffer};function HmacSha256(key,is224,sharedMemory){var i,type=typeof key;if(type==="string"){var bytes=[],length=key.length,index=0,code;for(i=0;i<length;++i){code=key.charCodeAt(i);if(code<128){bytes[index++]=code}else{if(code<2048){bytes[index++]=(192|(code>>6));bytes[index++]=(128|(code&63))}else{if(code<55296||code>=57344){bytes[index++]=(224|(code>>12));bytes[index++]=(128|((code>>6)&63));bytes[index++]=(128|(code&63))}else{code=65536+(((code&1023)<<10)|(key.charCodeAt(++i)&1023));bytes[index++]=(240|(code>>18));bytes[index++]=(128|((code>>12)&63));bytes[index++]=(128|((code>>6)&63));bytes[index++]=(128|(code&63))}}}}key=bytes}else{if(type==="object"){if(key===null){throw new Error(ERROR)}else{if(ARRAY_BUFFER&&key.constructor===ArrayBuffer){key=new Uint8Array(key)}else{if(!Array.isArray(key)){if(!ARRAY_BUFFER||!ArrayBuffer.isView(key)){throw new Error(ERROR)}}}}}else{throw new Error(ERROR)}}if(key.length>64){key=(new Sha256(is224,true)).update(key).array()}var oKeyPad=[],iKeyPad=[];for(i=0;i<64;++i){var b=key[i]||0;oKeyPad[i]=92^b;iKeyPad[i]=54^b}Sha256.call(this,is224,sharedMemory);this.update(iKeyPad);this.oKeyPad=oKeyPad;this.inner=true;this.sharedMemory=sharedMemory}HmacSha256.prototype=new Sha256();HmacSha256.prototype.finalize=function(){Sha256.prototype.finalize.call(this);if(this.inner){this.inner=false;var innerHash=this.array();Sha256.call(this,this.is224,this.sharedMemory);this.update(this.oKeyPad);this.update(innerHash);Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports;exports.sha224=createMethod(true);exports.sha256.hmac=createHmacMethod();exports.sha224.hmac=createHmacMethod(true);if(COMMON_JS){module.exports=exports}else{root.sha256=exports.sha256;root.sha224=exports.sha224;if(AMD){define(function(){return exports})}}})();var hash=sha256.hmac.update(Salt.stringValue(),Password.stringValue());return new IDVariant(hash.hex().toUpperCase())};function Shell(a){this.MainFrm=a;this.iVersion;this.iHasCamera;this.iDeviceID;this.iDeviceName}Shell.prototype.SendCmd=Shell.SendCmd=function(f,h){var b=self._ShellURL+"?_CMD="+f;if(h){var e=Object.keys(h);for(var d=0;d<e.length;d++){var c=e[d];var g=h[c];if(g!=null){b+="&"+c+"="+IDL.Base64Encode(g)}}}var a=new XMLHttpRequest();a.open("GET",b,false);if(typeof document==="undefined"){a.timeout=3600*1000}a.send(null);return a.responseText};Shell.SendSSCmd=function(g,d,f){f=f||{};try{var a;if(Shell.IsInsideShell()){f.ssname=g;f.cmd=d;a=Shell.SendCmd("SSCMD",f)}else{var c=new XMLHttpRequest();var b=self.location.protocol+"//"+self.location.hostname;if(self.location.port.length>0){b+=":"+self.location.port}b+=self.location.pathname;c.open("POST",b+"?WCI=SSCMD",false);c.setRequestHeader("content-type","application/json");c.send(JSON.stringify({ssname:g,cmd:d,data:f}));a=c.responseText}return a?JSON.parse(a):null}catch(e){WriteToConsoleError("Error while sending remote command (SessionName="+g+", CMD="+d+"): "+e);throw e}};Shell.UseShellForSS=function(){if(!Shell.IsInsideShell()){return true}if(Shell.isAndroid()){return !Shell.UseSimulatedWorkers()}else{if(navigator.userAgent.indexOf("CaravelShell")!=-1){return(navigator.userAgent.indexOf("AppleWebKit/533.17.9")==-1)}else{return true}}};Shell.UseSimulatedWorkers=function(){if(Shell.iUseSimulatedWorkers==undefined){if(Shell.IsInsideShell()){try{Shell.iUseSimulatedWorkers=(Shell.SendCmd("USESIMULATEDWORKERS")=="1")}catch(a){Shell.iUseSimulatedWorkers=true}}}return Shell.iUseSimulatedWorkers};Shell.isIos=function(){return(navigator.userAgent.indexOf("AppleWebKit")!=-1)};Shell.isAndroid=function(){return(navigator.userAgent.indexOf("Android")!=-1)};Shell.prototype.IsInsideShell=Shell.IsInsideShell=function(){return(self._ShellURL!=undefined)};Shell.prototype.IsInsideCaravel=function(){if(this.iIsInsideCaravel==undefined){if(this.IsInsideShell()){switch(parseInt(this.SendCmd("ISINSIDECARAVEL"))){case 0:this.iIsInsideCaravel=IDVariant.FALSE;break;case 1:this.iIsInsideCaravel=IDVariant.TRUE;break;default:this.iIsInsideCaravel=new IDVariant();break}}else{this.iIsInsideCaravel=new IDVariant()}}return this.iIsInsideCaravel};Shell.prototype.Version=function(){if(this.iVersion==undefined){this.iVersion=new IDVariant(this.IsInsideShell()?this.SendCmd("GETVER"):"")}return this.iVersion};Shell.prototype.HasCamera=function(){if(this.iHasCamera==undefined){this.iHasCamera=(this.IsInsideShell()&&this.SendCmd("HASCAMERA")=="OK")}return this.iHasCamera};Shell.prototype.DeviceID=function(){if(this.iDeviceID==undefined){this.iDeviceID=new IDVariant(this.IsInsideShell()?this.SendCmd("GETSETTING",{KEY:"DEVICEID"}):"")}return this.iDeviceID};Shell.prototype.DeviceName=function(){if(this.iDeviceName==undefined){this.iDeviceName=new IDVariant(this.IsInsideShell()?this.SendCmd("GETSETTING",{KEY:"DEVICENAME"}):"")}return this.iDeviceName};Shell.prototype.DeviceIP=function(){return new IDVariant(this.IsInsideShell()?this.SendCmd("GETSETTING",{KEY:"DEVICEIP"}):"")};Shell.prototype.SynchServer=function(){return new IDVariant(this.IsInsideShell()?this.SendCmd("GETSETTING",{KEY:"SYNCSRV"}):"")};Shell.prototype.NetworkStatus=function(){return new IDVariant(this.IsInsideShell()?this.SendCmd("NETSTATUS"):"")};Shell.prototype.TakePicture=function(b,d,a,f,e){if(this.IsInsideShell()){var c=this.SendCmd("TAKEPICT",{NAME:b.stringValue(),QUALITY:d.intValue(),WIDTH:a.intValue(),HEIGHT:f.intValue(),CAMERAROLL:(e?-1:0)});return new IDVariant(c=="OK"?"":c)}else{return new IDVariant()}};Shell.prototype.RecStart=function(a){if(this.IsInsideShell()){var b=this.SendCmd("RECSTART",{NAME:a.stringValue()});return new IDVariant(b=="OK"?"":b)}else{return new IDVariant()}};Shell.prototype.RecStop=function(){if(this.IsInsideShell()){var a=this.SendCmd("RECSTOP");return new IDVariant(a=="OK"?"":a)}else{return new IDVariant()}};Shell.prototype.PlayStart=function(b){if(b.Type!=IDVariant.BLOB){return}if(this.IsInsideShell()){var a=this.SendCmd("PLAYSTART",{DATA:btoa(b.Value.substring(16))});return new IDVariant(a=="OK"?"":a)}else{return new IDVariant()}};Shell.prototype.PlayStop=function(){if(this.IsInsideShell()){var a=this.SendCmd("PLAYSTOP");return new IDVariant(a=="OK"?"":a)}else{return new IDVariant()}};Shell.prototype.PhoneCall=function(a){if(this.IsInsideShell()){this.SendCmd("PHONECALL",{NUM:a.stringValue()})}};Shell.prototype.PhoneSMS=function(b,a){if(this.IsInsideShell()){this.SendCmd("PHONESMS",{NUM:b.stringValue(),TXT:a.stringValue()})}};Shell.prototype.DenyOrientation=function(a){if(this.IsInsideShell()){this.SendCmd("DENYOR",{OR:a.intValue()})}};Shell.prototype.BatteryLevel=function(){if(this.IsInsideShell()){return new IDVariant(this.SendCmd("BATTERYLEV"))}return new IDVariant(0)};Shell.prototype.BatteryStatus=function(){if(this.IsInsideShell()){return new IDVariant(this.SendCmd("BATTERYSTAT"))}return new IDVariant(0)};Shell.prototype.IsServerReachable=function(b,a){if(this.IsInsideShell()){return(this.SendCmd("ISSERVERREACHABLE",{URL:b.stringValue(),TIMEOUT:a.intValue()})=="OK")}return false};Shell.prototype.CanStandBy=function(a){if(this.IsInsideShell()){this.SendCmd("CANSTANDBY",{ENABLED:(a?"-1":"0")})}};Shell.prototype.GetFile=function(e,c,b,d){if(this.IsInsideShell()){var a=this.SendCmd("DOWNLOADFILE",{URL:e.stringValue(),FILENAME:c.stringValue(),ASYNC:(b?-1:0),TIMEOUT:d.intValue()});if(a!="OK"){throw new Error(a)}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.PutFile=function(c,d,b){if(this.IsInsideShell()){var a=this.SendCmd("UPLOADFILE",{FILENAME:c.stringValue(),URL:d.stringValue(),ASYNC:(b?-1:0)});if(a!="OK"){throw new Error(a)}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.BackupFile=function(b,a){if(this.IsInsideShell()){this.SendCmd("BACKUP",{FILENAME:b.stringValue(),BACKUP:(a?-1:0)})}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.OpenFileIn=function(a){if(this.IsInsideShell()){this.SendCmd("OPENIN",{FILENAME:a.stringValue()})}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.ScanBarcode=function(b,a){if(this.IsInsideShell()){this.SendCmd("SCANBARCODE",{TYPES:b.intValue(),USESHUTTER:(a?-1:0)})}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.ClearCache=function(c){if(this.IsInsideShell()){var b="";if(c){b=c.GetNative().join("|")}var a=this.SendCmd("CLEARCACHE",{FILELIST:b});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(parseInt(a.substring(2),10))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetAlbumCount=function(){if(this.IsInsideShell()){var a=this.SendCmd("GETALBUMCOUNT");if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(parseInt(a.substring(2),10))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetAlbumID=function(b){if(this.IsInsideShell()){var a=this.SendCmd("GETALBUMID",{INDEX:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhotoCount=function(b){if(this.IsInsideShell()){var a=this.SendCmd("GETPHOTOCOUNT",{IDALBUM:b.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(parseInt(a.substring(2),10))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhotoID=function(b,c){if(this.IsInsideShell()){var a=this.SendCmd("GETPHOTOID",{IDALBUM:b.stringValue(),INDEX:c.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhotoDateTime=function(b,c){if(this.IsInsideShell()){var a=this.SendCmd("GETPHOTODATETIME",{IDALBUM:b.stringValue(),IDPHOTO:c.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.DATETIME)}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhotoThumbnail=function(e,b,d,c){if(this.IsInsideShell()){if(c.stringValue().trim().length==0){c=new IDVariant(e.getRealPath()+"/temp")}var a=this.SendCmd("GETPHOTOTHUMBNAIL",{IDALBUM:b.stringValue(),IDPHOTO:d.stringValue(),PATH:c.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhoto=function(g,c,e,d,f,b,h){if(this.IsInsideShell()){if(d.stringValue().trim().length==0){d=new IDVariant(g.getRealPath()+"/temp")}var a=this.SendCmd("GETPHOTO",{IDALBUM:c.stringValue(),IDPHOTO:e.stringValue(),PATH:d.stringValue(),QUALITY:f.intValue(),WIDTH:b.intValue(),HEIGHT:h.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.PutPhoto=function(b){if(this.IsInsideShell()){var a=this.SendCmd("PUTPHOTO",{FILENAME:b.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.HttpRequest=function(e,m,t,f,b){var h={URL:m};if(f&&f.Type!=IDVariant.NULL){h.__USERNAME__=f.stringValue()}if(b&&b.Type!=IDVariant.NULL){h.__PASSWORD__=b.stringValue()}if(t){var n=t.GetKeys();for(var s=0;s<n.Size();s++){var u=n.get_Value(new IDVariant(s));var v=t.get_Value(u);if(v instanceof IDVariant&&v.Type!=IDVariant.NULL){h[u.stringValue()]=v.stringValue()}else{if(u.stringValue()=="ID_HEADERS"&&t.get_Object(u) instanceof IDArray){var c="";v=t.get_Object(u);for(var r=0;r<v.Size();r++){if(r>0){c+="\n"}c+=v.get_Value(new IDVariant(r)).stringValue()}h[u.stringValue()]=c}}}}var o=RD4_WebEntryPoint.ShellObject.SendCmd("HTTPREQ",h);if(o.indexOf("|")==-1&&o.indexOf("|",o.indexOf("|")+1)==-1){throw new Error(o)}var d=parseInt(o.substring(0,o.indexOf("|")));o=o.substring(o.indexOf("|")+1);var l=o.substring(0,o.indexOf("|"));o=o.substring(o.indexOf("|")+1);var q=o;var a=new IDVariant();a.Type=d;a.Value=IDL.Base64Decode(l);if(t){var g=new IDArray();var k=q.split("\n");for(var s=0;s<k.length;s++){if(k[s].length>0){if(k[s].length>16&&k[s].substring(0,16)=="ID_RESPONSECODE:"){t.set_Value(new IDVariant("ID_RESPONSECODE"),new IDVariant(k[s].substring(17)));continue}else{g.add_Value(new IDVariant(k[s]))}}}if(g.Size()>0){t.set_Object(new IDVariant("ID_HEADERS"),g)}}return a};Shell.prototype.SendMail=function(o,q,u,c,a,y,h,v,l,t,j,d,g,m,e,f,x,n,b,s,r){if(this.IsInsideShell()){var k=this.SendCmd("IMAP_SENDMAIL",{SERVER:o.stringValue(),PORT:q.stringValue(),USESSL:u.stringValue(),USERNAME:c.stringValue(),PASSWORD:a.stringValue(),FROM:y.stringValue(),SUBJECT:h.stringValue(),HTMLBODY:v.stringValue(),TEXTBODY:l.stringValue(),TOS:t.stringValue(),CCS:j.stringValue(),BCCS:d.stringValue(),REPLYTO:g.stringValue(),ATTACHLIST:m.stringValue(),SAVEONLY:e.stringValue(),SAVETOMAILBOX:f.stringValue(),INCOMINGSERVER:x.stringValue(),INCOMINGPORT:n.stringValue(),INCOMINGSSL:b.stringValue(),MAILBOXNAME:s.stringValue(),AUTHMETHOD:r.stringValue()});if(k.substring(0,2)!="OK"){throw new Error(k)}if(k.length>2){return new IDVariant(k.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetMailboxes=function(f,h,e,c,d,g,b){if(this.IsInsideShell()){var a=this.SendCmd("IMAP_GETMAILBOXES",{SERVER:f.stringValue(),PORT:h.stringValue(),USESSL:e.stringValue(),USERNAME:c.stringValue(),PASSWORD:d.stringValue(),MAILBOXNAME:g.stringValue(),AUTHMETHOD:b.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.ReadEmails=function(e,d,g,b,f,h,k,j,c,a){if(this.IsInsideShell()){var l=this.SendCmd("IMAP_READEMAILS",{SERVER:e.stringValue(),PORT:d.stringValue(),USESSL:g.stringValue(),USERNAME:b.stringValue(),PASSWORD:f.stringValue(),MAILBOXNAME:h.stringValue(),HEADERSONLY:(k?1:0),LASTREADID:j.intValue(),MAXROWS:c.intValue(),AUTHMETHOD:a.stringValue()});if(l.substring(0,2)!="OK"){throw new Error(l)}if(l.length>2){return new IDVariant(l.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetSingleEmail=function(d,c,f,b,e,g,j,a){if(this.IsInsideShell()){var h=this.SendCmd("IMAP_GETSINGLEEMAIL",{SERVER:d.stringValue(),PORT:c.stringValue(),USESSL:f.stringValue(),USERNAME:b.stringValue(),PASSWORD:e.stringValue(),MAILBOXNAME:g.stringValue(),MAILID:j.intValue(),AUTHMETHOD:a.stringValue()});if(h.substring(0,2)!="OK"){throw new Error(h)}if(h.length>2){return new IDVariant(h.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.MoveEmail=function(g,f,j,b,h,e,d,c,a){if(this.IsInsideShell()){var k=this.SendCmd("IMAP_MOVEEMAIL",{SERVER:g.stringValue(),PORT:f.stringValue(),USESSL:j.stringValue(),USERNAME:b.stringValue(),PASSWORD:h.stringValue(),SOURCEMAILBOX:e,DESTMAILBOX:d.stringValue(),EMAILID:c.stringValue(),AUTHMETHOD:a.stringValue()});if(k.substring(0,2)!="OK"){throw new Error(k)}if(k.length>2){return new IDVariant(k.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetEmailAttachments=function(d,c,f,b,e,g,j,a){if(this.IsInsideShell()){var h=this.SendCmd("IMAP_GETEMAILATTACHMENTS",{SERVER:d.stringValue(),PORT:c.stringValue(),USESSL:f.stringValue(),USERNAME:b.stringValue(),PASSWORD:e.stringValue(),MAILBOXNAME:g.stringValue(),MAILID:j.intValue(),AUTHMETHOD:a.stringValue()});if(h.substring(0,2)!="OK"){throw new Error(h)}if(h.length>2){return new IDVariant(h.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.DownloadAttachment=function(g,f,j,c,h,k,e,d,b,a){if(this.IsInsideShell()){var l=this.SendCmd("IMAP_DOWNLOADATTACHMENT",{SERVER:g.stringValue(),PORT:f.stringValue(),USESSL:j.stringValue(),USERNAME:c.stringValue(),PASSWORD:h.stringValue(),MAILBOXNAME:k.stringValue(),MAILID:e.intValue(),ATTACHMENTID:d.intValue(),SAVETOPATH:b.stringValue(),AUTHMETHOD:a.stringValue()});if(l!="OK"){throw new Error(l)}return new IDVariant()}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetDNID=function(){return new IDVariant(this.IsInsideShell()?this.SendCmd("GETDNID"):"")};Shell.prototype.SendLocalNotification=function(f,c,e,g,b,h,d,a){if(this.IsInsideShell()){var j=this.SendCmd("SENDLOCALNOTIF",{TITLE:f,TEXT:c,PAYLOAD:e,DATE:(!g?"":IDL.Format(new IDVariant(g),new IDVariant("dd/mm/yyyy hh:nn:ss")).stringValue()),IMAGE:b,SOUND:h,BADGE:d,TYPE:a});if(j!="OK"){throw new Error(j)}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.CheckPermission=function(d,c){var b=(this.MainFrm.BrowserInfo()==7||this.MainFrm.BrowserInfo()==8);if(this.IsInsideShell()&&b){var a=this.SendCmd("CHECKPERMISSION",{PERMISSION:d,EXPLANATION:c});return(a=="OK")}return true};Shell.prototype.GetContacts=function(){var o=new IDArray();if(this.IsInsideShell()){var g=this.SendCmd("GETCONTACTS");if(!g.startsWith("<")){throw new Error(g)}var h=new XMLDoc();h.LoadFromString(g);var q=null;while(h.HasNextNode()&&!q){var b=h.GetNextNode();if(b.Type()==1){q=b}}while(q.HasNextNode()){var d=q.GetNextNode();var c=new Shell.Contact();o.add_Object(c);c.FirstName=new IDVariant(d.GetAttribute("FIRSTNAME"));if(c.FirstName.Type==5&&c.FirstName.stringValue().length==0){c.FirstName=new IDVariant()}c.LastName=new IDVariant(d.GetAttribute("LASTNAME"));if(c.LastName.Type==5&&c.LastName.stringValue().length==0){c.LastName=new IDVariant()}c.Company=new IDVariant(d.GetAttribute("COMPANY"));if(c.Company.Type==5&&c.Company.stringValue().length==0){c.Company=new IDVariant()}c.Birthday=new IDVariant(d.GetAttribute("BIRTHDAY"));if(c.Birthday.Type==5&&c.Birthday.stringValue().length==0){c.Birthday=new IDVariant()}else{c.Birthday.changeType(IDVariant.DATETIME)}c.Note=new IDVariant(d.GetAttribute("NOTE"));if(c.Note.Type==5&&c.Note.stringValue().length==0){c.Note=new IDVariant()}while(d.HasNextNode()){var s=d.GetNextNode();if(s.Name()=="Phones"){c.Phones=new IDMap();while(s.HasNextNode()){var t=s.GetNextNode();var k=new IDVariant(t.GetAttribute("LABEL"));var m=new IDVariant(t.GetAttribute("NUMBER"));if(c.Phones.ContainsKey(k)){for(var e=1;e<10;e++){var f=k.stringValue()+e;if(!c.Phones.ContainsKey(new IDVariant(f))){k=new IDVariant(f);break}}}c.Phones.set_Value(k,m)}}else{if(s.Name()=="Emails"){c.EMails=new IDMap();while(s.HasNextNode()){var a=s.GetNextNode();var k=new IDVariant(a.GetAttribute("LABEL"));var r=new IDVariant(a.GetAttribute("EMAIL"));if(c.EMails.ContainsKey(k)){for(var e=1;e<10;e++){var f=k.stringValue()+e;if(!c.EMails.ContainsKey(new IDVariant(f))){k=new IDVariant(f);break}}}c.EMails.set_Value(k,r)}}else{if(s.Name()=="Addresses"){c.Addresses=new IDMap();while(s.HasNextNode()){var l=s.GetNextNode();var k=new IDVariant(l.GetAttribute("LABEL"));var j=new Shell.ContactAddress();j.Street=new IDVariant(l.GetAttribute("STREET"));if(j.Street.Type==5&&j.Street.stringValue().length==0){j.Street=new IDVariant()}j.City=new IDVariant(l.GetAttribute("CITY"));if(j.City.Type==5&&j.City.stringValue().length==0){j.City=new IDVariant()}j.State=new IDVariant(l.GetAttribute("STATE"));if(j.State.Type==5&&j.State.stringValue().length==0){j.State=new IDVariant()}j.ZIP=new IDVariant(l.GetAttribute("ZIP"));if(j.ZIP.Type==5&&j.ZIP.stringValue().length==0){j.ZIP=new IDVariant()}j.Country=new IDVariant(l.GetAttribute("COUNTRY"));if(j.Country.Type==5&&j.Country.stringValue().length==0){j.Country=new IDVariant()}if(c.Addresses.ContainsKey(k)){for(var e=1;e<10;e++){var f=k.stringValue()+e;if(!c.Addresses.ContainsKey(new IDVariant(f))){k=new IDVariant(f);break}}}c.Addresses.set_Object(k,j)}}}}}}}return o};Shell.Contact=function(){this.FirstName;this.LastName;this.Company;this.Birthday;this.Note};Shell.Contact.prototype.GetPhones=function(){return this.Phones};Shell.Contact.prototype.GetEmail=function(){return this.EMails};Shell.Contact.prototype.GetAddresses=function(){return this.Addresses};Shell.ContactAddress=function(){this.Street;this.City;this.State;this.ZIP;this.Country};function StringTokenizer(){this.str="";this.delim=",";this.quote='"';this.p=-1;this.UseDecimalDot=true;this.stok=false;this.allowSpaces=false;this.itemAt=null}StringTokenizer.prototype.setString=function(b,a,c){if(a==undefined){a=new IDVariant(",")}if(c==undefined){c=new IDVariant('"')}this.str=b.stringValue();this.p=-1;if(a.stringValue().length>0){this.delim=a.stringValue().charAt(0)}if(c.stringValue().length>0){this.quote=c.stringValue().charAt(0)}this.stok=this.str.length>0;this.itemAt=null};StringTokenizer.prototype.hasNext=function(){return this.p+1<this.str.length};StringTokenizer.prototype.next=function(){var f=this.p+1;var e=false;var a=false;var b=this.str.length;while(f<b){if(this.str.charAt(f)==this.quote){e=!e;a=true}if(!e){if(this.str.charAt(f)==this.delim){break}}f++}var d,c;d=this.p+1;c=f-1;this.p=f;if(this.delim!=" "){while(d<this.str.length){if(this.str.charAt(d)==this.quote){d++;break}if(this.str.charAt(d)!=" "||this.allowSpaces){break}d++}while(c>=0&&this.str.length>0){if(this.str.charAt(c)==this.quote){c--;break}if(this.str.charAt(c)!=" "||this.allowSpaces){break}c--}}var g="";if(c+1>d){g=this.str.substr(d,c+1-d)}d=1;while(d<g.length-1){if(g.charAt(d)==this.quote&&g.charAt(d+1)==this.quote){g=g.remove(d,1)}d++}if(g.length==0&&!a){return new IDVariant()}else{return new IDVariant(g)}};StringTokenizer.prototype.addToken=function(c){if(this.str.length>0||this.stok){this.str+=this.delim}this.stok=true;if(c.Type==IDVariant.NULL){return}if(c.Type==IDVariant.STRING){var a=c.stringValue();var b=0;while(b<a.length){if(a.charAt(b)==this.quote){a=a.insert(b++,this.quote)}b++}a=a.insert(0,this.quote);a=a.concat(this.quote);this.str+=a;if(this.itemAt!=null){this.itemAt.Add(a)}}else{if(c.Type==IDVariant.DATETIME){var f=IDL.Format(c,new IDVariant("yyyy-mm-dd hh:nn:ss")).stringValue();if(f.substr(11).equals("00:00:00")){f=f.substr(0,10)}if(f.substr(0,10).equals("1899-12-30")){if(f.length>10){f=f.substr(11)}else{f=""}}this.str+=f;if(this.itemAt!=null){this.itemAt.Add(new IDVariant(f))}}else{if(c.Type==IDVariant.FLOAT||c.Type==IDVariant.DECIMAL){var e=c.stringValue();if(!this.UseDecimalDot){e=e.replace(new RegExp("//.","g"),",")}this.str+=e;if(this.itemAt!=null){this.itemAt.Add(new IDVariant(e))}}else{this.str+=c.stringValue();if(this.itemAt!=null){this.itemAt.Add(c)}}}}};StringTokenizer.prototype.GetTokenAt=function(a){if(this.itemAt==null){this.itemAt=new ArrayList();var b=this.p;p=-1;while(this.hasNext()){this.itemAt.Add(this.next())}this.p=b}return(a>=0&&a<this.itemAt.length?this.itemAt[a]:new IDVariant())};StringTokenizer.prototype.getString=function(){return new IDVariant(this.str)};StringTokenizer.prototype.Count=function(){var b=this.p;this.p=-1;var a=0;while(this.hasNext()){a++;this.next()}this.p=b;return new IDVariant(a)};function VBFiles(){}VBFiles.prototype.CurDir=function(){return new IDVariant()};VBFiles.prototype.Dir=function(a,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(a!=undefined&&b!=undefined){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_DIR",{NAMEFILTER:a.stringValue(),ATTRIBUTES:b.intValue()}))}else{if(a!=undefined){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_DIR",{NAMEFILTER:a.stringValue()}))}else{return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_DIR"))}}}return new IDVariant()};VBFiles.MkDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_MKDIR",{NEWDIR:b.stringValue()});if(a!="OK"){throw new Error(a)}return true}return false};VBFiles.RmDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_RMDIR",{NEWDIR:b.stringValue()});if(a!="OK"){throw new Error(a)}return true}return false};VBFiles.FileDateTime=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_FILEDATETIME",{THEFILE:a.stringValue()}),IDVariant.DATETIME)}return new IDVariant()};VBFiles.FileLen=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_FILELEN",{THEFILE:a.stringValue()}),IDVariant.INTEGER)}return new IDVariant()};VBFiles.FileExt=function(b){var d="";var a=b.stringValue();var c=a.lastIndexOf(".");if(c>-1){d=a.substr(c+1)}return new IDVariant(d)};VBFiles.GetAttr=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_GETATTR",{THEFILE:a.stringValue()}),IDVariant.INTEGER)}return new IDVariant()};VBFiles.FileExists=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_FILEEXISTS",{THEFILE:a.stringValue()})=="OK")}return false};VBFiles.DirectoryExists=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_DIRECTORYEXISTS",{THEFILE:a.stringValue()})=="OK")}return false};VBFiles.Kill=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_KILL",{THEFILE:b.stringValue()});if(a!="OK"){throw new Error(a)}return true}return false};VBFiles.Rename=function(b,c){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_RENAME",{THEFILE:b.stringValue(),NEWNAME:c.stringValue()});if(a!="OK"){throw new Error(a)}return true}return false};VBFiles.prototype.FreeFile=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_FREEFILE"),IDVariant.INTEGER)}return new IDVariant()};VBFiles.prototype.Close=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_CLOSE",{FILENUM:b.intValue()});if(a!="OK"){throw new Error(a)}return true}};VBFiles.prototype.EOF=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_EOF",{FILENUM:a.intValue()})=="OK")}return true};VBFiles.prototype.OpenForInput=function(b,d,c){if(c==undefined){c=new IDVariant()}if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_OPENFORINPUT",{THEFILE:b.stringValue(),FILENUM:d.intValue(),FILEENC:c.stringValue()});if(a!="OK"){throw new Error(a)}return true}};VBFiles.prototype.OpenForOutput=function(b,e,c,d){if(d==undefined){d=new IDVariant()}if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_OPENFOROUTPUT",{THEFILE:b.stringValue(),FILENUM:e.intValue(),FLFORAPPEND:c?"1":"0",FILEENC:d.stringValue()});if(a!="OK"){throw new Error(a)}return true}};VBFiles.prototype.ReadLine=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_READLINE",{FILENUM:a.intValue()}))}return new IDVariant()};VBFiles.prototype.WriteLine=function(c,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_WRITELINE",{FILENUM:c.intValue(),TEXT:b.stringValue()});if(a!="OK"){throw new Error(a)}return true}};VBFiles.Shell=function(Command){eval(Command)};XMLDoc.FT_XML=0;XMLDoc.FT_JSON=1;XMLDoc.ROOT_JSON="Root_JSON";XMLDoc.JSON_IGNORENAME="JSON_IGNORENAME";XMLDoc.JSON_ISARRAYCHILD="JSON_ISARRAYCHILD";XMLDoc.UNIX_EPOCH=new Date(0);XMLDoc.NULL_VALUE="~~IOTNULL~~";XMLDoc.TRUE_VALUE="~~TRUE~~";XMLDoc.FALSE_VALUE="~~FALSE~~";XMLDoc.EMPTY_ARRAY="~~EMPTY~~";function XMLDoc(){this.XMLdoc;this.ChildIndex=0;this.XMLdoc=new ProXMLDocument();var a=this.XMLdoc.createProcessingInstruction("xml",'version="1.0" encoding="UTF-8"');this.XMLdoc.appendChild(a)}XMLDoc.prototype.GetDocument=function(){return this.XMLdoc};XMLDoc.prototype.GetRootNode=function(){for(var a=0;a<this.XMLdoc.childNodes.length;a++){if(this.XMLdoc.childNodes[a].nodeType==1){return new XMLNode(this.XMLdoc.childNodes[a],this)}}return null};XMLDoc.prototype.AddNewElement=function(b){var a=this.XMLdoc.createElement(b);this.XMLdoc.appendChild(a);return new XMLNode(a,this)};XMLDoc.prototype.RemoveNode=function(b){for(var a=0;a<this.ChildIndex;a++){if(this.XMLdoc.childNodes[a]==b.GetNode()){this.ChildIndex--;break}}this.XMLdoc.removeChild(b.GetNode())};XMLDoc.prototype.Save=function(a,b){this.XMLdoc.Save(a,b)};XMLDoc.prototype.Load=function(a,b){this.XMLdoc.Load(a,b)};XMLDoc.prototype.Reset=function(){this.ChildIndex=0};XMLDoc.prototype.HasNextNode=function(){return this.ChildIndex<this.XMLdoc.childNodes.length};XMLDoc.prototype.GetNextNode=function(){if(this.HasNextNode()){return new XMLNode(this.XMLdoc.childNodes[this.ChildIndex++],this)}else{return null}};XMLDoc.prototype.SaveToString=function(a){return this.XMLdoc.saveToString(a)};XMLDoc.prototype.SaveToStream=function(a,b){};XMLDoc.prototype.LoadFromString=function(a,b){try{this.XMLdoc.loadFromString(a,b);this.Reset();return true}catch(c){WriteToConsoleError("[XMLDoc::LoadFromString] Exception while loading XML from string: "+c);return false}};XMLDoc.prototype.Validate=function(a){return true};XMLDoc.prototype.SaveToJSON=function(){return this.XMLdoc.saveToJSON()};XMLDoc.SerializeJsonDate=function(a){return"/Date("+(a.getTime()-XMLDoc.UNIX_EPOCH.getTime())+")/"};XMLDoc.DeserializeJsonDate=function(b){var a=parseInt(b.substr(6,b.indexOf(")")-6));return new Date(a+XMLDoc.UNIX_EPOCH.getTime())};function XMLNode(b,a){this.ChildIndex=0;this.AttrIndex=0;this.XMLnode=b;this.OwnerDocument=a}XMLNode.prototype.GetNode=function(){return this.XMLnode};XMLNode.prototype.Name=function(){if(this.XMLnode==null){return null}return this.XMLnode.nodeName};XMLNode.prototype.Value=function(){if(this.XMLnode.nodeType==1&&this.XMLnode.childNodes.length==1&&(this.XMLnode.childNodes[0].nodeType==3||this.XMLnode.childNodes[0].nodeType==4)){return this.XMLnode.childNodes[0].data}return this.XMLnode.data};XMLNode.prototype.set_Value=function(a){if(this.XMLnode.childNodes.length==0){this.XMLnode.appendChild(this.XMLnode.ownerDocument.createTextNode(a))}else{if(this.XMLnode.childNodes.length==1&&(this.XMLnode.childNodes[0].nodeType==3||this.XMLnode.childNodes[0].nodeType==4)){this.XMLnode.childNodes[0].data=a}else{if(this.XMLnode.nodeType==3||this.XMLnode.nodeType==4){this.XMLnode.data=a}}}};XMLNode.prototype.Namespace=function(){return this.XMLnode.getNamespace()};XMLNode.prototype.Type=function(){return this.XMLnode.nodeType};XMLNode.prototype.IsElement=function(){return this.Type()==1};XMLNode.prototype.IsText=function(){return this.Type()==3||this.Type()==4};XMLNode.prototype.AddNewElement=function(b,c){var f=this.XMLnode.ownerDocument;if(f==null){return null}if(c){var e=ProXMLDocument.getPrefix(b);if(e&&this.XMLnode.getNamespaceByPrefix(e)){c=undefined}}var a=f.createElement(b,c);this.XMLnode.appendChild(a);return new XMLNode(a,this.OwnerDocument)};XMLNode.prototype.AddTextNode=function(c,e,f){var h=this.XMLnode.ownerDocument;if(f){var g=ProXMLDocument.getPrefix(c);if(g&&this.XMLnode.getNamespaceByPrefix(g)){f=undefined}}var b=h.createTextNode(e);var a=h.createElement(c,f);a.appendChild(b);this.XMLnode.appendChild(a);return new XMLNode(a,this.OwnerDocument)};XMLNode.prototype.AddCDataNode=function(b){var c=this.XMLnode.ownerDocument;var a=c.createCDATASection(b);this.XMLnode.appendChild(a);return new XMLNode(a,this.OwnerDocument)};XMLNode.prototype.RemoveNode=function(b){for(var a=0;a<this.ChildIndex;a++){if(this.XMLnode.childNodes[a]==b.GetNode()){this.ChildIndex--;break}}this.XMLnode.removeChild(b.GetNode())};XMLNode.prototype.Reset=function(){this.ChildIndex=0;this.AttrIndex=0};XMLNode.prototype.HasNextNode=function(){return this.ChildIndex<this.XMLnode.childNodes.length};XMLNode.prototype.HasNextAttribute=function(){if(!this.IsElement()){return false}else{return this.AttrIndex<this.XMLnode.attributes.length}};XMLNode.prototype.GetNextNode=function(){if(this.HasNextNode()){return new XMLNode(this.XMLnode.childNodes[this.ChildIndex++],this.OwnerDocument)}else{return null}};XMLNode.prototype.GetNextAttribute=function(a,b,c){if(c==undefined){c=new IDVariant()}if(this.HasNextAttribute()){var d=this.XMLnode.attributes[this.AttrIndex++];if(d.nodeName==XMLDoc.JSON_ISARRAYCHILD){this.GetNextAttribute(a,b,c);return}a.set(new IDVariant(d.nodeName));b.set(new IDVariant(d.nodeValue));c.set(new IDVariant(d.getNamespace(this.XMLnode)))}else{a.changeType(IDVariant.NULL);b.changeType(IDVariant.NULL);c.changeType(IDVariant.NULL)}};XMLNode.prototype.HasAttribute=function(a,b){return this.XMLnode.hasAttribute(a,b)};XMLNode.prototype.GetAttribute=function(a,b){if(this.IsElement()){return this.XMLnode.getAttribute(a,b)}else{return null}};XMLNode.prototype.SetAttribute=function(a,b,c){if(this.IsElement()){this.XMLnode.setAttribute(a,b,c)}};XMLNode.prototype.RemoveAttribute=function(a,b){if(this.IsElement()){this.XMLnode.removeAttribute(a,b)}};XMLNode.prototype.ToString=function(){return this.toString()};XMLNode.prototype.toString=function(){var a=this.Name();var d=this.Value();if(this.IsElement()){var f=a;var g=this.XMLnode.attributes;var c=": ";var b=g.length;for(var e=0;e<b;e++){if(g[e].nodeName.equals(XMLDoc.JSON_ISARRAYCHILD)){continue}f=f+(c+g[e].nodeName+"="+g[e].nodeValue);c=", "}return f}else{return"* "+a+((d!=null)?" = "+d:"")}};XMLNode.prototype.SaveToString=function(a){if(a==undefined){a=XMLDoc.FT_XML}switch(a){case XMLDoc.FT_XML:return this.XMLnode.toString();case XMLDoc.FT_JSON:return this.SaveToJSON()}return""};XMLNode.prototype.SaveToJSON=function(){var a=new IDVariant("");ProXMLDocument.XmlToJSONnode(a,this.GetNode(),false);return a.stringValue()};XMLNode.prototype.IsArrayChild=function(){return(this.GetAttribute(XMLDoc.JSON_ISARRAYCHILD)=="1")};XMLNode.prototype.set_IsArrayChild=function(a){if(a){this.SetAttribute(XMLDoc.JSON_ISARRAYCHILD,"1")}else{this.RemoveAttribute(XMLDoc.JSON_ISARRAYCHILD)}};XMLNode.prototype.SelectSingleNode=function(a){throw new Error("Not supported offline")};XMLNode.prototype.SelectNodes=function(a){throw new Error("Not supported offline")};function ACommandSrv(){this.IdxForm=0;this.RoleEnabled=true;this.RoleVisible=true;this.Caption="";this.ToolTip="";this.iGuid;this.Parent;this.Index;this.Expanded;this.Level;this.ToolCont=-1;this.ToolContCode=null;this.CmdCode=null;this.Code=null;this.iBadge="";this.iClassName="";this.IsCmdSet;this.IsMenu;this.IsToolbar;this.ShowNames;this.RequireConfirmation=false;this.UseHilight=false;this.ToolName;this.Image;this.Accell=null;this.FormList=false;this.Width=0;this.FKNum=0;this.iAllowPWA=false;this.iEnabled=new Array(1);this.iVisible=new Array(1);this.iChecked=new Array(1);this.iCommands=new Array(0);this.CmdIter=0;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.CMD_MAXPROP);this.ClickEventDef=RD3Glb.EVENT_URGENT;this.ExpandEventDef=RD3Glb.EVENT_CLIENTSIDE;this.ExpandAnimationDef=null;this.PopupAnimationDef=null;this.CanDrag=false;this.CanDrop=false}ACommandSrv.prototype.CopyFrom=function(d,b,a){this.IdxForm=a;this.RoleEnabled=d.RoleEnabled;this.RoleVisible=d.RoleVisible;this.Caption=d.Caption;this.ToolTip=d.ToolTip;this.iGuid=d.iGuid;this.Parent=d.Parent;this.Index=d.Index;this.Expanded=d.Expanded;this.Level=d.Level;this.ToolCont=d.ToolCont;this.ToolContCode=d.ToolContCode;this.CmdCode=d.CmdCode;this.Code=d.Code;this.IsCmdSet=d.IsCmdSet;this.IsMenu=d.IsMenu;this.IsToolbar=d.IsToolbar;this.ShowNames=d.ShowNames;this.RequireConfirmation=d.RequireConfirmation;this.UseHilight=d.UseHilight;this.ToolName=d.ToolName;this.Image=d.Image;this.Width=d.Width;this.FKNum=d.FKNum;this.iAllowPWA=d.iAllowPWA;this.iEnabled=d.iEnabled.slice(0);this.iVisible=d.iVisible.slice(0);this.iChecked=d.iChecked.slice(0);this.iCommands=new Array(d.iCommands.length);for(var c=0;c<d.iCommands.length;c++){if(d.iCommands[c]!=null){this.iCommands[c]=new ACommandSrv();b.Add(this.iCommands[c]);this.iCommands[c].CopyFrom(d.iCommands[c],b,a);this.iCommands[c].Parent=this}}this.CmdIter=d.CmdIter;this.ClickEventDef=d.ClickEventDef;this.ExpandEventDef=d.ExpandEventDef;this.ExpandAnimationDef=d.ExpandAnimationDef;this.PopupAnimationDef=d.PopupAnimationDef;this.iClassName=d.iClassName};ACommandSrv.prototype.uCommands=function(){return this.iCommands.length};ACommandSrv.prototype.bCommands=function(a){return this.iCommands[a]};ACommandSrv.prototype.bEnabled=function(b){var a;if(!this.bVisible(b)){a=false}else{if(this.Parent==null){a=true}else{a=this.Parent.bEnabled(b)}}if(a){if(!this.RoleEnabled){a=false}else{a=this.iEnabled[(this.iAllowPWA)?b:0]}}return a};ACommandSrv.prototype.set_bEnabled=function(c,a){if(this.iEnabled[(this.iAllowPWA)?c:0]!=a){this.iEnabled[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.CMD_ENABLED)}};ACommandSrv.prototype.bVisible=function(b){var a;if(!this.RoleVisible){a=false}else{if(this.iAllowPWA){a=this.iVisible[b]}else{if(this.IdxForm!=b&&this.IdxForm>0&&this.IdxForm<65536){a=false}else{a=this.iVisible[0]}}}if(a&&this.Parent!=null){a=this.Parent.bVisible(b)}return a};ACommandSrv.prototype.set_bVisible=function(c,a){if(this.iVisible[(this.iAllowPWA)?c:0]!=a){this.iVisible[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.CMD_VISIBLE)}};ACommandSrv.prototype.bChecked=function(a){return this.iChecked[(this.iAllowPWA)?a:0]};ACommandSrv.prototype.set_bChecked=function(c,a){if(this.iChecked[(this.iAllowPWA)?c:0]!=a){this.iChecked[(this.iAllowPWA)?c:0]=a}};ACommandSrv.prototype.bCaption=function(){return this.Caption};ACommandSrv.prototype.set_bCaption=function(a){if(this.Caption!=a){this.Caption=a;this.RD3Change(RD3Glb.CMD_CAPTION)}};ACommandSrv.prototype.bToolTip=function(){return this.ToolTip};ACommandSrv.prototype.set_bToolTip=function(a){if(this.ToolTip!=a){this.ToolTip=a;this.RD3Change(RD3Glb.CMD_TOOLTIP)}};ACommandSrv.prototype.bImage=function(){return this.Image};ACommandSrv.prototype.set_bImage=function(a){if(this.Image==null||!this.Image.equals(a)){this.Image=a;this.RD3Change(RD3Glb.CMD_IMAGE)}};ACommandSrv.prototype.bToolName=function(){return this.ToolName};ACommandSrv.prototype.set_bToolName=function(a){if(this.ToolName!=a){this.ToolName=a;this.RD3Change(RD3Glb.CMD_TOOLNAME)}};ACommandSrv.prototype.set_AllowPWA=function(c,a){this.iAllowPWA=a;if(a){this.iEnabled=new bool[c.ParamsObj().MAX_FORMS+1];this.iVisible=new bool[c.ParamsObj().MAX_FORMS+1];this.iChecked=new bool[c.ParamsObj().MAX_FORMS+1]}};ACommandSrv.prototype.IsEnabled=function(a){if(this.Parent!=null){return this.bEnabled(a)&&this.Parent.IsEnabled(a)}else{return this.bEnabled(a)}};ACommandSrv.prototype.InitStatus=function(c,a,d){if(this.IdxForm==0){for(var b=0;b<this.iEnabled.length;b++){this.iEnabled[b]=c;this.iVisible[b]=a;this.iChecked[b]=d}}else{if(this.iAllowPWA){this.iVisible[this.IdxForm]=a;this.iEnabled[this.IdxForm]=c;this.iChecked[this.IdxForm]=d}else{this.iVisible[0]=a;this.iEnabled[0]=c;this.iChecked[0]=d}}};ACommandSrv.prototype.Commands=function(a){return this.iCommands[a]};ACommandSrv.prototype.set_Commands=function(c,a){this.iCommands[c]=a};ACommandSrv.prototype.AddCommand=function(a){this.iCommands[this.CmdIter++]=a};ACommandSrv.prototype.MaxCommands=function(){return this.iCommands.length-1};ACommandSrv.prototype.SetNumCommands=function(a){if(a>0){this.iCommands=new Array(a)}else{this.iCommands=null}this.CmdIter=0};ACommandSrv.prototype.RemoveCommand=function(a){var b=this.iCommands[a];b.RD3DelObj=true};ACommandSrv.prototype.Expand=function(){if(this.iCommands.length==0){return false}else{this.Expanded=!this.Expanded;this.RD3Change(RD3Glb.CMD_EXPANDED);return true}};ACommandSrv.prototype.GetIndex=function(){if(this.Parent!=null){for(var a=0;a<this.Parent.iCommands.length;a++){if(this.Parent.iCommands[a]==this){return a}}}return -1};ACommandSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};ACommandSrv.prototype.GetRD3Name=function(){return(this.Level==1)?"cms":"cmd"};ACommandSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ACommandSrv.prototype.RD3RenderDifferences=function(c,f){var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}else{for(var b=0;b<this.iCommands.length;b++){if(this.iCommands[b].RD3NewObj){e=c.AddNewElement("chg");break}}}if(e==null&&(this.RD3Changed||this.RD3DelObj)){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||f){this.SetRD3Property(b,e,f)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(f){if(this.IsCmdSet){e.SetAttribute("cmds","1")}if(this.ClickEventDef!=RD3Glb.EVENT_URGENT){e.SetAttribute("clk",this.ClickEventDef.toString())}if(this.ExpandEventDef!=RD3Glb.EVENT_CLIENTSIDE){e.SetAttribute("exe",this.ExpandEventDef.toString())}if(this.ExpandAnimationDef!=null){e.SetAttribute("exa",this.ExpandAnimationDef)}if(this.PopupAnimationDef!=null){e.SetAttribute("poa",this.PopupAnimationDef)}}if(this.RD3DelObj){e.SetAttribute("del","1")}var a=(f)?e:c;for(var b=0;b<this.iCommands.length;b++){if(this.iCommands[b].RD3NewObj){this.iCommands[b].RD3RenderDifferences(e,true);this.iCommands[b].RD3NewObj=false}else{if(this.iCommands[b].RD3DelObj){this.iCommands[b].RD3RenderDifferences(a,false);this.iCommands.splice(b,1);this.CmdIter--;b--}else{d|=this.iCommands[b].RD3RenderDifferences(a,f)}}}return d};ACommandSrv.prototype.SetRD3Property=function(c,e,d){switch(c){case RD3Glb.CMD_IDXFORM:if(this.IdxForm==0&&d){break}e.SetAttribute("frm",this.IdxForm.toString());break;case RD3Glb.CMD_CAPTION:if(this.Caption.length==0&&d){break}e.SetAttribute("cap",this.Caption);break;case RD3Glb.CMD_TOOLTIP:if(this.ToolTip.length==0&&d){break}e.SetAttribute("tip",this.ToolTip);break;case RD3Glb.CMD_IDX:if(this.Index==0&&d){break}e.SetAttribute("idx",this.Index.toString());break;case RD3Glb.CMD_EXPANDED:if(!this.Expanded&&d){break}e.SetAttribute("exp",this.Expanded?"1":"0");break;case RD3Glb.CMD_LEVEL:if(this.Level==1&&d){break}e.SetAttribute("lev",this.Level.toString());break;case RD3Glb.CMD_ISMENU:if(this.IsMenu&&d){break}e.SetAttribute("ism",this.IsMenu?"1":"0");break;case RD3Glb.CMD_ISTOOLBAR:if(!this.IsToolbar&&d){break}e.SetAttribute("ist",this.IsToolbar?"1":"0");break;case RD3Glb.CMD_SHOWNAMES:if(!this.ShowNames&&d){break}e.SetAttribute("shn",this.ShowNames?"1":"0");break;case RD3Glb.CMD_REQUIRECONFIRMATION:if(!this.RequireConfirmation&&d){break}e.SetAttribute("rqc",this.RequireConfirmation?"1":"0");break;case RD3Glb.CMD_TOOLNAME:if((this.ToolName==null||this.ToolName.equals(""))&&d){break}e.SetAttribute("tnm",this.ToolName);break;case RD3Glb.CMD_IMAGE:if((this.Image==null||this.Image.equals(""))&&d){break}e.SetAttribute("img",this.Image);break;case RD3Glb.CMD_ENABLED:var a=this.iEnabled[0]&&this.RoleEnabled;if(a&&d){break}e.SetAttribute("ena",a?"1":"0");break;case RD3Glb.CMD_VISIBLE:var a=this.iVisible[0]&&this.RoleVisible;if(a&&d){break}e.SetAttribute("vis",a?"1":"0");break;case RD3Glb.CMD_CONFIRMTEXT:break;case RD3Glb.CMD_TOOLCONT:if(this.ToolCont==-1&&d){break}e.SetAttribute("cnt",this.ToolCont.toString());break;case RD3Glb.CMD_FKNUM:if(this.FKNum==0&&d){break}e.SetAttribute("fkn",this.FKNum.toString());break;case RD3Glb.CMD_CMDCODE:if((this.CmdCode==null||this.CmdCode.length==0)&&d){break}e.SetAttribute("cco",(this.CmdCode!=null)?this.CmdCode:"");break;case RD3Glb.CMD_WIDTH:if(this.Width==0&&d){break}e.SetAttribute("wid",this.Width.toString());break;case RD3Glb.CMD_TOOLHL:if(this.UseHilight==false&&d){break}e.SetAttribute("thl",this.UseHilight?"1":"0");break;case RD3Glb.CMD_FORMLIST:if(this.FormList==false&&d){break}e.SetAttribute("fli",this.FormList?"1":"0");break;case RD3Glb.CMD_ACCELL:if((this.Accell==null||this.Accell.length==0)&&d){break}if(this.Accell!=null){e.SetAttribute("acc",this.Accell)}break;case RD3Glb.CMD_CANDRAG:if(this.CanDrag==false&&d){break}e.SetAttribute("cdg",this.CanDrag?"1":"0");break;case RD3Glb.CMD_CANDROP:if(this.CanDrop==false&&d){break}e.SetAttribute("cdp",this.CanDrop?"1":"0");break;case RD3Glb.CMD_BADGE:if(this.iBadge.length==0&&d){break}e.SetAttribute("bdg",this.iBadge);break;case RD3Glb.CMD_CLASS:if(this.iClassName.length==0&&d){break}e.SetAttribute("cln",this.iClassName);break}};ACommandSrv.prototype.PrepareForAutocollapse=function(a){if(this.IsMenu){this.ExpandEventDef=RD3Glb.EVENT_ACTIVE;if(a>this.Level){for(var b=0;b<this.iCommands.length;b++){if(this.iCommands[b]!=null){this.iCommands[b].PrepareForAutocollapse(a)}}}}};ACommandSrv.prototype.Badge=function(){return this.iBadge};ACommandSrv.prototype.set_Badge=function(a){if(this.iBadge!=a){this.iBadge=a;this.RD3Change(RD3Glb.CMD_BADGE)}};ACommandSrv.prototype.ClassName=function(){return this.iClassName};ACommandSrv.prototype.set_ClassName=function(a){if(this.iClassName!=a){this.iClassName=a;this.RD3Change(RD3Glb.CMD_CLASS)}};function ADynQuerySrv(a){this.SQL;this.ConnDB;this.RS=new IDCachedRowSet();this.IMDBTable=-1;this.iGuid;this.ParentRep=null;this.Parent=a;this.RSParam=new ArrayList();this.QueryParameters=new ArrayList()}ADynQuerySrv.prototype.SetQuery=function(c,a,b){this.SQL=c;this.ConnDB=a;this.RS.setReadOnly();if(this.ParentRep==null){this.PrepareParam(this.Parent.Parent.IMDB,b)}};ADynQuerySrv.prototype.PrepareParam=function(c,l){var o=-1;var m=-1;var h=true;while(h||(o>-1&&m>-1)){h=false;o=this.SQL.indexOf("~~",o+1);m=this.SQL.indexOf("~~",o+1);if(o>=0&&m>=0){var q=this.SQL.substr(o+2,m-(o+2));this.SQL=this.SQL.substr(0,o)+"?"+this.SQL.substr(m+2);var b=new PQueryParamSrv();this.QueryParameters.Add(b);var d=q.lastIndexOf(".");if(d>=0){var a=0;try{a=parseInt(q.substr(0,d),10)}catch(g){}if(a>0){b.RepIdx=a;var k=this.ParentRep.Parent.Parent.FindObjByID(b.RepIdx);if(b.RepIdx>-1){b.FldIdx=k.DSE.GetFldIdx(q.substr(d+1))}}else{b.TblIdx=c.TblByCode(q.substr(0,d),l);if(b.TblIdx>-1){b.FldIdx=c.FldByCode(b.TblIdx,q.substr(d+1))}}}if(b.FldIdx>-1){b.AttValue=new IDVariant();if(b.RepIdx>-1){var k=this.ParentRep.Parent.Parent.FindObjByID(b.RepIdx);k.DSE.GetFieldValue(b.AttValue,b.FldIdx);var j=new IDVariant();var n=new IDVariant();var f=new IDVariant();k.DSE.GetFldParam(b.FldIdx,j,n,f);b.DataType=j.intValue();b.MaxLength=n.intValue();b.vScale=f.intValue()}else{b.DataType=c.GetFldDataType(b.TblIdx,b.FldIdx);b.MaxLength=c.GetFldMaxLength(b.TblIdx,b.FldIdx);b.vScale=c.GetFldScale(b.TblIdx,b.FldIdx)}}}}};ADynQuerySrv.prototype.UpdateParam=function(b,e){var h=e;if(this.ParentRep!=null){this.PrepareParam(this.Parent.Parent.IMDB,b)}for(var f=0;f<this.QueryParameters.Count();f++){var a=this.QueryParameters[f];if(a.RepIdx>-1&&a.FldIdx>-1){var c=this.ParentRep.Parent.Parent.FindObjByID(a.RepIdx);var d=new IDVariant();c.DSE.GetFieldValue(d,a.FldIdx);if(d.CompareTo(a.AttValue)!=0&&!(a.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){a.AttValue=d;h=true}}if(a.TblIdx>-1&&a.FldIdx>-1){if(this.Parent.Parent.IMDB.TblModified(a.TblIdx,0)||e){if(!this.Parent.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0).equals(a.AttValue)){a.AttValue=this.Parent.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0);h=true}}}}this.RSParam.Clear();if(h){for(var g=0;g<this.QueryParameters.Count();g++){var a=this.QueryParameters[g];this.RSParam.Add(a.AttValue)}}return h};ADynQuerySrv.prototype.FindData=function(b,a){var d=this.SQL;this.SQL=b.HandleTableSubst(this.SQL,0);try{if(!this.ConnDB.IsOpen()){b.OpenConnection(this.ConnDB)}b.DTTObj.AddQuery(this.iGuid,a+" - Find data",a+" find data",DTTEngine.STMT_QRY_SELECT,this.SQL);try{for(var g=0;g<this.RSParam.Count();g++){var c=this.RSParam[g];b.DTTObj.AddParameter(this.iGuid,this.iGuid,"Param "+g+1,c)}}catch(h){}this.RS.setCommand(this.ConnDB.ApplySubstitutions(this.SQL));this.RS.execute(this.RSParam,this.ConnDB);if(!this.RS.EOF()){this.RS.MoveFirst()}b.DTTObj.AddDBDataSource(this.RS,this.SQL);b.DTTObj.EndQuery(this.iGuid);return true}catch(f){b.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",156,a+" - Find data",a+" - Error: "+f.message);b.DTTObj.AddParameter("","","SQL",new IDVariant(this.SQL));return false}finally{if(!this.SQL.equals(d)){this.SQL=d}}};ADynQuerySrv.prototype.GetHashKey=function(c){var b="";try{for(var a=1;a<=this.RS.GetNumFields();a++){if(c.Count()==0){b+=this.RS.Get(a).stringValue()}else{if(c.Contains(this.RS.GetName(a))){b+=this.RS.Get(a).stringValue()}}}}catch(d){}return b};ADynQuerySrv.prototype.SelectRow=function(d,c,a){if(this.IMDBTable==-1){return}for(var b=0;b<c.TblNumField(this.IMDBTable);b++){c.Value(this.IMDBTable,b,0).changeType(IDVariant.NULL)}try{this.RS.absolute(d);for(var b=0;b<c.TblNumField(this.IMDBTable);b++){c.set_Value(this.IMDBTable,b,0,this.RS.Get(b+1))}}catch(f){}};function AFrameSrv(a){this.Caption="";this.Vertical=false;this.ChildFrame1=null;this.ChildFrame2=null;this.Description=null;this.Width=0;this.Height=0;this.FixedWidth=0;this.FixedHeight=0;this.OriginalHeight=0;this.OriginalWidth=0;this.MinWidth=0;this.MaxWidth=0;this.MinHeight=0;this.MaxHeight=0;this.FormFactor=0;this.Parent=null;this.Content=null;this.Index=a;this.InTabbed=false;this.TabIdx=0;this.Exposed=true;this.FrHidden=false;this.FrBorder=false;this.IsSubFrame=false;this.HasBorder=false;this.iUseSmallIcon=-1;this.HasCaptionToolbar=-1;this.iClassName;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.AFR_MAXPROP);this.RD3NewObj=false;this.RD3DelObj=false}AFrameSrv.prototype.GetTotalSize=function(){var c=new RectSrv();if(this.ChildFrame1!=null&&this.ChildFrame2!=null){var b=this.ChildFrame1.GetTotalSize();var a=this.ChildFrame2.GetTotalSize();if(this.Vertical){c.Width=(b.Width>a.Width?b.Width:a.Width);c.Height=b.Height+a.Height}else{c.Height=(b.Height>a.Height?b.Height:a.Height);c.Width=b.Width+a.Width}}else{c.Width=this.FixedWidth;c.Height=this.FixedHeight;if(this.Content!=null){if(this.Content instanceof IDPanelSrv){var d=this.Content.GetBoundRect();c.Width=d.Width+Glb.PAN_OFFS_X;c.Height=d.Height+Glb.PAN_OFFS_PAGEY+Glb.PAN_OFFS_Y}if(this.Content instanceof ATreeSrv){c.Width=this.Content.Width;c.Height=this.Content.Height}if(this.Content instanceof OTabViewSrv){if(this.Content.SelectedTab>0){var e=this.Content.GetItem(this.Content.SelectedTab);c=e.GetTotalSize();c.Height=c.Height+Glb.PAN_OFFS_PAGEY}}}}return c};AFrameSrv.prototype.set_Caption=function(a){if(!this.Caption.equals(a)){this.Caption=a;this.RD3Change(RD3Glb.AFR_CAPTION)}};AFrameSrv.prototype.set_SubFrame=function(a){this.IsSubFrame=a};AFrameSrv.prototype.ProcessRequest=function(a,b){var a=this.Parent.MainFrm;if(!b){if(this.HasCaptionToolbar==1){a.CmdObj.ProcessCaptionRequest(this.Index,this.Parent,a)}if(a.GetParameter("exp"+this.Index+".x")!=null){this.Content.set_Collapsed(false)}if(a.GetParameter("col"+this.Index+".x")!=null){this.Content.set_Collapsed(true)}}if(this.Content!=null&&((this.Content.Visible&&!this.Content.Collapsed)||!b)){this.Content.ProcessRequest(a,this.Parent,b)}};AFrameSrv.prototype.DTTTrace=function(a){};AFrameSrv.prototype.UpdateFrame=function(){};AFrameSrv.prototype.UseSmallIcon=function(a){if(this.iUseSmallIcon==-1){this.iUseSmallIcon=(a.ParamsObj().UseSmallIcon||this.IsSubFrame)?1:0}return this.iUseSmallIcon!=0};AFrameSrv.prototype.PUseSmallIcon=function(){return this.iUseSmallIcon!=0};AFrameSrv.prototype.set_PUseSmallIcon=function(a){this.iUseSmallIcon=(a)?1:0;this.RD3Change(RD3Glb.AFR_USESMALLICON)};AFrameSrv.prototype.ClassName=function(){return this.iClassName};AFrameSrv.prototype.set_ClassName=function(a){this.iClassName=a;this.RD3Change(RD3Glb.AFR_CLASSNAME)};AFrameSrv.prototype.Resize=function(a,c){if(this.OriginalHeight==0){this.OriginalHeight=this.Height}if(this.OriginalWidth==0){this.OriginalWidth=this.Width}var g=(this.OriginalHeight>120)?128:this.OriginalHeight+8;var m=(this.OriginalWidth>120)?128:this.OriginalWidth+8;if(a>this.MaxWidth&&this.MaxWidth>0){a=this.MaxWidth}if(a<this.MinWidth){a=this.MinWidth}if(c>this.MaxHeight&&this.MaxHeight>0){c=this.MaxHeight}if(c<this.MinHeight){c=this.MinHeight}if(c<g){c=g}if(a<m){a=m}var e=1;var n=1;if(a!=this.Width&&this.Width!=0){e=(a+0)/this.Width}if(c!=this.Height&&this.Height!=0){n=(c+0)/this.Height}if(this.ChildFrame1!=null){if(this.Vertical){var j=Math.floor(c*this.FormFactor);j=j-(j%4);this.ChildFrame1.Resize(a,j);a=this.ChildFrame1.Width;this.ChildFrame2.Resize(a,c-this.ChildFrame1.Height);if(this.ChildFrame2.Height!=c-this.ChildFrame1.Height){this.ChildFrame1.Resize(a,c-this.ChildFrame2.Height);this.ChildFrame2.Resize(this.ChildFrame2.Width,this.ChildFrame2.Height)}if(this.ChildFrame2.Width!=a){a=this.ChildFrame2.Width;this.ChildFrame1.Resize(a,this.ChildFrame1.Height)}c=this.ChildFrame1.Height+this.ChildFrame2.Height;a=(this.ChildFrame1.Width>this.ChildFrame2.Width?this.ChildFrame1.Width:this.ChildFrame2.Width)}else{var j=Math.floor(a*this.FormFactor);j=j-(j%4);this.ChildFrame1.Resize(j,c);c=this.ChildFrame1.Height;this.ChildFrame2.Resize(a-this.ChildFrame1.Width,c);if(this.ChildFrame2.Width!=a-this.ChildFrame1.Width){this.ChildFrame1.Resize(a-this.ChildFrame2.Width,c);this.ChildFrame2.Resize(this.ChildFrame2.Width,this.ChildFrame2.Height)}if(this.ChildFrame2.Height!=c){c=this.ChildFrame2.Height;this.ChildFrame1.Resize(this.ChildFrame1.Width,c)}a=this.ChildFrame1.Width+this.ChildFrame2.Width;c=(this.ChildFrame1.Height>this.ChildFrame2.Height?this.ChildFrame1.Height:this.ChildFrame2.Height)}}this.Width=a;this.Height=c;var b=8;var l=8;if((this.Content instanceof IDPanelSrv||this.Content instanceof OBookSrv)&&!this.FrHidden){if(this.Parent!=null){l=(this.UseSmallIcon(this.Parent.MainFrm)?28:38)}else{l=(this.PUseSmallIcon()?28:38)}}if(this.Content instanceof OTabViewSrv){l=28}var k=this.Width-b;var f=this.Height-l;if(this.Content!=null){this.Content.Resize(k,f)}this.Width=k+b;this.Height=f+l;this.FixedHeight=this.Height;this.FixedWidth=this.Width};AFrameSrv.prototype.GetRD3Ident=function(){if(this.Content==null){return this.GetRD3Name()+":"+this.Index+":"+this.Parent.FormIdx}else{return this.Content.GetRD3Ident()}};AFrameSrv.prototype.GetRD3Name=function(){if(this.Content==null){return"wfr"}else{return this.Content.GetRD3Name()}};AFrameSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};AFrameSrv.prototype.RD3RenderDifferences=function(b,e){if(this.RD3DelObj){return false}this.DTTTrace(this.Parent.MainFrm);var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.OriginalHeight==0){this.OriginalHeight=this.Height;if(this.Parent.MainFrm.ParamsObj().UseFluid&&this.OriginalHeight==0&&this.InTabbed&&this.Parent.Frames[this.TabIdx]!=null){this.OriginalHeight=this.Parent.Frames[this.TabIdx].Height}}if(this.OriginalWidth==0){this.OriginalWidth=this.Width;if(this.Parent.MainFrm.ParamsObj().UseFluid&&this.OriginalWidth==0&&this.InTabbed&&this.Parent.Frames[this.TabIdx]!=null){this.OriginalWidth=this.Parent.Frames[this.TabIdx].Width}}d.SetAttribute("orh",this.OriginalHeight.toString());d.SetAttribute("orw",this.OriginalWidth.toString())}if(this.Content!=null){c|=(this.Content.RD3RenderDifferences(d,b,e)!=null)}return c};AFrameSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.AFR_CAPTION:if(this.Caption.length==0&&b){break}c.SetAttribute("cap",this.Caption);break;case RD3Glb.AFR_VERTICAL:if(!this.Vertical&&b){break}c.SetAttribute("ver",this.Vertical?"1":"0");break;case RD3Glb.AFR_WIDTH:if(this.Width==0&&b){break}c.SetAttribute("wid",this.Width.toString());break;case RD3Glb.AFR_HEIGHT:if(this.Height==0&&b){break}var d=this.Height;if(this.Content instanceof IDPanelSrv){if(this.Content.MainFrm.IsMobile()&&this.Content.IsShowingGrouping()&&this.Content.Queries[0].RecordCount()==this.Content.NumRows){var e=this.Content.GroupRoot.getLabelNumber();d+=(e*this.Content.MaxHRow)}}c.SetAttribute("hei",d.toString());break;case RD3Glb.AFR_MINWIDTH:if(this.MinWidth==0&&b){break}c.SetAttribute("miw",this.MinWidth.toString());break;case RD3Glb.AFR_MINHEIGHT:if(this.MinHeight==0&&b){break}c.SetAttribute("mih",this.MinHeight.toString());break;case RD3Glb.AFR_MAXWIDTH:if(this.MaxWidth==9999&&b){break}c.SetAttribute("maw",this.MaxWidth.toString());break;case RD3Glb.AFR_MAXHEIGHT:if(this.MaxHeight==9999&&b){break}c.SetAttribute("mah",this.MaxHeight.toString());break;case RD3Glb.AFR_FRHIDDEN:if(!this.FrHidden&&b){break}c.SetAttribute("ocn",this.FrHidden?"1":"0");break;case RD3Glb.AFR_USESMALLICON:if(!this.UseSmallIcon(this.Parent.MainFrm)&&b){break}c.SetAttribute("smi",this.UseSmallIcon(this.Parent.MainFrm)?"1":"0");break;case RD3Glb.AFR_CHILD1:if(this.ChildFrame1==null){break}c.SetAttribute("fr1",this.ChildFrame1.GetRD3Ident());break;case RD3Glb.AFR_CHILD2:if(this.ChildFrame2==null){break}c.SetAttribute("fr2",this.ChildFrame2.GetRD3Ident());break;case RD3Glb.AFR_FRBORDER:if(!this.FrBorder){break}c.SetAttribute("frb",this.FrBorder?"1":"0");break;case RD3Glb.AFR_ORGWIDTH:if(this.OriginalWidth==0&&b){break}c.SetAttribute("orw",this.OriginalWidth.toString());break;case RD3Glb.AFR_ORGHEIGHT:if(this.OriginalHeight==0&&b){break}c.SetAttribute("orh",this.OriginalHeight.toString());break;case RD3Glb.AFR_CLASSNAME:if((this.iClassName==null||this.iClassName.length==0)&&b){break}c.SetAttribute("cln",(this.iClassName==null)?"":this.iClassName);break}};AGraphSrv.JFREECHART=1;AGraphSrv.FUSIONCHART=2;AGraphSrv.OPENSOURCECHART=3;AGraphSrv.EXTLIBRARY=4;AGraphSrv.JQPLOT=5;AGraphSrv.CHARTJS=6;AGraphSrv.GOOGLECHART=7;AGraphSrv.BARCHART=1;AGraphSrv.BAR3DCHART=2;AGraphSrv.LINECHART=3;AGraphSrv.AREACHART=4;AGraphSrv.PIECHART=5;AGraphSrv.PIE3DCHART=6;AGraphSrv.RINGCHART=7;AGraphSrv.TIMELINECHART=8;AGraphSrv.TIMEBARCHART=9;AGraphSrv.XYLINECHART=10;AGraphSrv.SCATTERCHART=11;AGraphSrv.SPIDERWEBCHART=12;AGraphSrv.RADARCHART=13;AGraphSrv.POLARAREACHART=14;AGraphSrv.BUBBLECHART=15;AGraphSrv.CALENDARCHART=16;AGraphSrv.CANDLESTICKCHART=17;AGraphSrv.COMBOCHART=18;AGraphSrv.STEPPEDAREACHART=19;AGraphSrv.TABLECHART=20;AGraphSrv.TREEMAPCHART=21;AGraphSrv.GAUGE=22;AGraphSrv.GEOCHART=23;AGraphSrv.HISTOGRAM=24;AGraphSrv.ORGCHART=25;AGraphSrv.FL_GRH_TOOLTIP=1048576;AGraphSrv.FL_GRH_SHOWXAXIS=2097152;AGraphSrv.FL_GRH_SHOWYAXIS=4194304;AGraphSrv.FL_GRH_SHOWGRIDX=8388608;AGraphSrv.FL_GRH_SHOWGRIDY=16777216;AGraphSrv.FL_GRH_ACTIVE=33554432;AGraphSrv.HORIZONTAL=0;AGraphSrv.VERTICAL=1;AGraphSrv.NONE=1;AGraphSrv.LEFT=2;AGraphSrv.TOP=3;AGraphSrv.RIGTH=4;AGraphSrv.BOTTOM=5;AGraphSrv.CENTER=6;AGraphSrv.OK=40;AGraphSrv.DATAERROR=41;AGraphSrv.CHARTTYPEERROR=42;AGraphSrv.GENERICERROR=43;AGraphSrv.LIBRARYERROR=44;AGraphSrv.FORMATNOTSUPPORTEDERROR=45;AGraphSrv.YEAR=0;AGraphSrv.MONTH=1;AGraphSrv.DAY=2;AGraphSrv.HOUR=3;AGraphSrv.MINUTE=4;AGraphSrv.WEEK=5;AGraphSrv.JPG=0;AGraphSrv.PNG=1;function AGraphSrv(a){WebFrameSrv.call(this,a);this.libraryUsed=AGraphSrv.CHARTJS;this.QueryObj=new ADynQuerySrv(this);this.IMDBDataSource=-1;this.GraphCode="";this.libraryObj=new GraphLibraryChartJs();this.libraryObj.setMainFrm(this.MainFrm);this.outputFormat=AGraphSrv.PNG;this.prefix="";this.GraErrTxt=null;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.GRA_MAXPROPS);this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.ShowAnimationDef=null}AGraphSrv.prototype=new WebFrameSrv();AGraphSrv.prototype.Init=function(a){this.Parent=a};AGraphSrv.prototype.GetCaption=function(){if(this.FrIndex!=-1&&this.FrIndex<this.Parent.Frames.length){return this.Parent.Frames[this.FrIndex].Caption}else{return this.Code}};AGraphSrv.prototype.Description=function(){return(this.libraryObj!=null?this.libraryObj.getSubtitle():"")};AGraphSrv.prototype.set_TitleDescription=function(a,c){if(this.libraryObj!=null){var b=this.libraryObj.getTitle();var d=this.libraryObj.getSubtitle();if(!b.equals(a)||!d.equals(c)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setTitleandSubtitle(a,c)}};AGraphSrv.prototype.Title=function(){return(this.libraryObj!=null?this.libraryObj.getTitle():"")};AGraphSrv.prototype.set_Title=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getTitle();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setTitle(a)}};AGraphSrv.prototype.ChartType=function(){return(this.libraryObj!=null?this.libraryObj.getChartType():-1)};AGraphSrv.prototype.set_ChartType=function(a){this.set_ChartType(a,false)};AGraphSrv.prototype.set_ChartType=function(a,c){if(this.libraryObj!=null){var b=this.libraryObj.getChartType();if(b!=a){this.libraryObj.setChartType(a);if(c){return}this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF)}}};AGraphSrv.prototype.AxisXVisible=function(){return(this.libraryObj!=null?this.libraryObj.getXAxisVisible():false)};AGraphSrv.prototype.set_AxisXVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getXAxisVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setXAxisVisible(b)}};AGraphSrv.prototype.LabelAxisX=function(){return(this.libraryObj!=null?this.libraryObj.getLabelXAxis():"")};AGraphSrv.prototype.set_LabelAxisX=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getLabelXAxis();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLabelXAxis(a)}};AGraphSrv.prototype.GridXVisible=function(){return(this.libraryObj!=null?this.libraryObj.getXGridVisible():false)};AGraphSrv.prototype.set_GridXVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getXGridVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setXGridVisible(b)}};AGraphSrv.prototype.VisualStyleAxisX=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStyleXAxis():-1)};AGraphSrv.prototype.set_VisualStyleAxisX=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStyleXAxis();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStyleXAxis(a)}};AGraphSrv.prototype.AxisYVisible=function(){return(this.libraryObj!=null?this.libraryObj.getYAxisVisible():false)};AGraphSrv.prototype.set_AxisYVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getYAxisVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setYAxisVisible(b)}};AGraphSrv.prototype.LabelAxisY=function(){return(this.libraryObj!=null?this.libraryObj.getLabelYAxis():"")};AGraphSrv.prototype.set_LabelAxisY=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getLabelYAxis();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLabelYAxis(a)}};AGraphSrv.prototype.GridYVisible=function(){return(this.libraryObj!=null?this.libraryObj.getYGridVisible():false)};AGraphSrv.prototype.set_GridYVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getYGridVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setYGridVisible(b)}};AGraphSrv.prototype.VisualStyleAxisY=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStyleYAxis():-1)};AGraphSrv.prototype.set_VisualStyleAxisY=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStyleYAxis();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStyleYAxis(a)}};AGraphSrv.prototype.LabelDualAxisY=function(){return(this.libraryObj!=null?this.libraryObj.getDualLabelYAxis():"")};AGraphSrv.prototype.set_LabelDualAxisY=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getDualLabelYAxis();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setDualLabelYAxis(a)}};AGraphSrv.prototype.DualAxisYVisible=function(){return(this.libraryObj!=null?this.libraryObj.getDualYAxisVisible():false)};AGraphSrv.prototype.set_DualAxisYVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getDualYAxisVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setDualYAxisVisible(b)}};AGraphSrv.prototype.VisualStyleDualAxisY=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStyleDualYAxis():-1)};AGraphSrv.prototype.set_VisualStyleDualAxisY=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStyleDualYAxis();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStyleDualYAxis(a)}};AGraphSrv.prototype.VisualStyleChart=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStyleChart():-1)};AGraphSrv.prototype.set_VisualStyleChart=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStyleChart();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStyleChart(a);this.libraryObj.setVisualStyleXAxis(a);this.libraryObj.setVisualStyleYAxis(a);this.libraryObj.setVisualStylePieGraph(a)}};AGraphSrv.prototype.BorderVisible=function(){return(this.libraryObj!=null?this.libraryObj.getBorderVisible():false)};AGraphSrv.prototype.set_BorderVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getBorderVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setBorderVisible(b)}};AGraphSrv.prototype.Alpha=function(){return(this.libraryObj!=null?this.libraryObj.getAlpha():0)};AGraphSrv.prototype.set_Alpha=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getAlpha();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setAlpha(b)}};AGraphSrv.prototype.Orientation=function(){return(this.libraryObj!=null?this.libraryObj.getOrientation():-1)};AGraphSrv.prototype.set_Orientation=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getOrientation();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setOrientation(a)}};AGraphSrv.prototype.VisualStylePieGraph=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStylePieGraph():-1)};AGraphSrv.prototype.set_VisualStylePieGraph=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStylePieGraph();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStylePieGraph(a)}};AGraphSrv.prototype.PiePercentVisible=function(){return(this.libraryObj!=null?this.libraryObj.getPercentVisible():false)};AGraphSrv.prototype.set_PiePercentVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getPercentVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setPercentVisible(b)}};AGraphSrv.prototype.SerieColors=function(a){return this.libraryObj!=null?this.libraryObj.getSerieColors(a):null};AGraphSrv.prototype.set_SerieColors=function(c,b){if(this.libraryObj!=null){var a=this.libraryObj.getSerieColors(c);if(!a||(a.length!=b.length)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setSerieColors(c,b)}};AGraphSrv.prototype.RingHole=function(){return this.libraryObj!=null?this.libraryObj.getRingHole():-1};AGraphSrv.prototype.set_RingHole=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getRingHole();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setRingHole(a)}};AGraphSrv.prototype.AutoRangeX=function(){return(this.libraryObj!=null?this.libraryObj.AutoRangeX():false)};AGraphSrv.prototype.activateAutoRangeX=function(){if(this.libraryObj!=null){if(!this.libraryObj.AutoRangeX()){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.activateAutoRangeX()}};AGraphSrv.prototype.AutoRangeY=function(){return(this.libraryObj!=null?this.libraryObj.AutoRangeY():false)};AGraphSrv.prototype.activateAutoRangeY=function(){if(this.libraryObj!=null){if(!this.libraryObj.AutoRangeY()){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.activateAutoRangeY()}};AGraphSrv.prototype.AutoRangeDualY=function(){return(this.libraryObj!=null?this.libraryObj.AutoRangeDualY():false)};AGraphSrv.prototype.activateAutoRangeDualY=function(){if(this.libraryObj!=null){if(!this.libraryObj.AutoRangeDualY()){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.activateAutoRangeDualY()}};AGraphSrv.prototype.minValueX=function(){return(this.libraryObj!=null?this.libraryObj.minValueX():-1)};AGraphSrv.prototype.maxValueX=function(){return(this.libraryObj!=null?this.libraryObj.maxValueX():-1)};AGraphSrv.prototype.set_RangeX=function(b,d){if(this.libraryObj!=null){var c=this.libraryObj.minValueX();var a=this.libraryObj.maxValueX();if(c!=b||a!=d){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setRangeX(b,d)}};AGraphSrv.prototype.minValueY=function(){return(this.libraryObj!=null?this.libraryObj.minValueY():-1)};AGraphSrv.prototype.maxValueY=function(){return(this.libraryObj!=null?this.libraryObj.maxValueY():-1)};AGraphSrv.prototype.set_RangeY=function(b,d){if(this.libraryObj!=null){var c=this.libraryObj.minValueY();var a=this.libraryObj.maxValueY();if(c!=b||a!=d){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setRangeY(b,d)}};AGraphSrv.prototype.minValueDualY=function(){return(this.libraryObj!=null?this.libraryObj.minValueDualY():-1)};AGraphSrv.prototype.maxValueDualY=function(){return(this.libraryObj!=null?this.libraryObj.maxValueDualY():-1)};AGraphSrv.prototype.set_RangeDualY=function(b,d){if(this.libraryObj!=null){var c=this.libraryObj.minValueDualY();var a=this.libraryObj.maxValueDualY();if(c!=b||a!=d){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setRangeDualY(b,d)}};AGraphSrv.prototype.NumSeries=function(){return(this.libraryObj!=null?this.libraryObj.getNumSeries():-1)};AGraphSrv.prototype.set_NumSeries=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getNumSeries();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setNumSeries(b)}};AGraphSrv.prototype.SerieLabel=function(a){return(this.libraryObj!=null?this.libraryObj.getSerieLabel(a):"")};AGraphSrv.prototype.set_SerieLabel=function(c,a){if(this.libraryObj!=null){var b=this.libraryObj.getSerieLabel(c);if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setSerieLabel(c,a)}};AGraphSrv.prototype.SerieType=function(a){return(this.libraryObj!=null?this.libraryObj.getSerieType(a):-1)};AGraphSrv.prototype.set_SerieType=function(c,a){if(this.libraryObj!=null){var b=this.libraryObj.getSerieType(c);if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF)}this.libraryObj.setSerieType(c,a)}};AGraphSrv.prototype.SerieDualAxis=function(a){return(this.libraryObj!=null?this.libraryObj.getSerieDualYAxis(a):false)};AGraphSrv.prototype.set_SerieDualAxis=function(c,b){if(this.libraryObj!=null){var a=this.libraryObj.getSerieDualYAxis(c);if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF)}this.libraryObj.setSerieDualYAxis(c,b)}};AGraphSrv.prototype.LabelOrientation=function(){return(this.libraryObj!=null?this.libraryObj.getLabelOrientation():-1)};AGraphSrv.prototype.set_LabelOrientation=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getLabelOrientation();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLabelOrientation(a)}};AGraphSrv.prototype.set_Height=function(a){if(this.Height!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_HEIGHT);this.UpdateGraph(this.MainFrm);WebFrameSrv.prototype.set_Height.call(this,a)}};AGraphSrv.prototype.set_Width=function(a){if(this.Width!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_WIDTH);this.UpdateGraph(this.MainFrm);WebFrameSrv.prototype.set_Width.call(this,a)}};AGraphSrv.prototype.VisualStyleSerie=function(a){return(this.libraryObj!=null?this.libraryObj.getSerieVisualStyle(a):-1)};AGraphSrv.prototype.set_VisualStyleSerie=function(c,a){if(this.libraryObj!=null){var b=this.libraryObj.getSerieVisualStyle(c);if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setSerieVisualStyle(c,a)}};AGraphSrv.prototype.LegendVisible=function(){return(this.libraryObj!=null?this.libraryObj.getLegendVisible():false)};AGraphSrv.prototype.set_LegendVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getLegendVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLegendVisible(b)}};AGraphSrv.prototype.LegendPosition=function(){return(this.libraryObj!=null?this.libraryObj.getLegendPosition():-1)};AGraphSrv.prototype.set_LegendPosition=function(d){if(this.libraryObj!=null){var a=this.libraryObj.getLegendVisible();var b=this.libraryObj.getLegendPosition();if(!a||b!=d){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}var c=d!=AGraphSrv.NONE;this.libraryObj.setLegendVisible(c);this.libraryObj.setLegendPosition(d)}};AGraphSrv.prototype.StackedChart=function(){return(this.libraryObj!=null?this.libraryObj.getStackedChart():false)};AGraphSrv.prototype.set_StackedChart=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getStackedChart();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF)}this.libraryObj.setStackedChart(b)}};AGraphSrv.prototype.Explosion=function(a){return(this.libraryObj!=null?this.libraryObj.getExplosion(a):0)};AGraphSrv.prototype.set_Explosion=function(b,c){if(this.libraryObj!=null){var a=this.libraryObj.getExplosion(b);if(a!=c){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setExplosion(b,c)}};AGraphSrv.prototype.ShowShapes=function(){return(this.libraryObj!=null?this.libraryObj.getShowPoints():false)};AGraphSrv.prototype.set_ShowShapes=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getShowPoints();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setShowPoints(b)}};AGraphSrv.prototype.LabelValuesVisible=function(){return(this.libraryObj!=null?this.libraryObj.getShowValueLabel():false)};AGraphSrv.prototype.set_LabelValuesVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getShowValueLabel();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setShowValueLabel(b)}};AGraphSrv.prototype.TimePeriod=function(){return(this.libraryObj!=null?this.libraryObj.getTimePeriod():-1)};AGraphSrv.prototype.set_TimePeriod=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getTimePeriod();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setTimePeriod(a)}};AGraphSrv.prototype.Hyperlink=function(){return(this.libraryObj!=null?this.libraryObj.getHyperlink():false)};AGraphSrv.prototype.set_Hyperlink=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getHyperlink();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_ACTIVE)}this.libraryObj.setHyperlink(a);this.Enabled=a}};AGraphSrv.prototype.OutputFormat=function(a){return this.outputFormat};AGraphSrv.prototype.set_OutputFormat=function(a){if(this.outputFormat!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.outputFormat=a};AGraphSrv.prototype.getLibrary=function(){return this.libraryUsed};AGraphSrv.prototype.setLibrary=function(a){var b=this.libraryObj;if(this.MainFrm.ParamsObj().UseFluid&&a!=AGraphSrv.GOOGLECHART&&a!=AGraphSrv.CHARTJS&&!this.QueryObj.ParentRep){a=AGraphSrv.CHARTJS;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,107,"AGraph.setLibrary","Unsupported library type for Fluid, set CHARTJS")}if(a==AGraphSrv.JQPLOT){this.libraryObj=new GraphLibraryJQPlot()}if(a==AGraphSrv.CHARTJS){this.libraryObj=new GraphLibraryChartJs()}if(a==AGraphSrv.GOOGLECHART){this.libraryObj=new GraphLibraryGoogleChart()}if(this.libraryObj!=null){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF);this.RD3Change(RD3Glb.GRA_LIBRARY);this.libraryUsed=a;this.libraryObj.setMainFrm(this.MainFrm);if(b!=null){this.copyFrom(b,this.libraryObj)}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,107,"AGraph.setLibrary","Unsupported library type")}}};AGraphSrv.prototype.getChartObject=function(){return(this.libraryObj!=null?this.libraryObj.getChartObject():null)};AGraphSrv.prototype.getGraphFile=function(){return(this.libraryObj!=null?this.libraryObj.getGraphFile():"")};AGraphSrv.prototype.setGraphFile=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getGraphFile();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setGraphFile(a)}};AGraphSrv.prototype.SetQuery=function(d,a,b,c){this.QueryObj.SetQuery(d,a,b);this.QueryObj.iGuid=c;return AGraphSrv.OK};AGraphSrv.prototype.SetIMDBTable=function(a){this.QueryObj.IMDBTable=a;return AGraphSrv.OK};AGraphSrv.prototype.UpdateGraph=function(c,b){if(b==undefined){b=false}if(!this.Visible||this.Collapsed){c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"AGraph.UpdateGraph","Graph "+this.GetCaption()+": update not performed (the graph is either invisible, collapsed or not exposed)");return AGraphSrv.OK}try{if(this.IMDBDataSource==-1){this.UpdateGraphDB(c,this.iGuid,b)}else{this.UpdateGraphIMDB(c,b)}}catch(f){var a;var g;var d;a="Internal error while creating image";g="<br><br>Internal error while creating image.<br><br>"+f.message;d="<br><br>Internal error while creating image.<br><br>Contact the provider of the application and report this error";if(a.length>0){c.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,72,"AGraph.UpdateGraph","Graph "+this.GetCaption()+": "+a);c.DTTObj.AddException(this.iGuid,"AGraph.UpdateGraph","",f)}if(d.length>0){this.GraErrTxt=d}if(this.GraErrTxt&&this.GraErrTxt.length>0){this.RD3Change(RD3Glb.GRA_ERRTXT)}}return AGraphSrv.OK};AGraphSrv.prototype.UpdateGraphDB=function(b,e,d){if(!this.QueryObj.RS.IsOpen()){d=true}d|=this.QueryObj.UpdateParam(b,d);if(d&&this.QueryObj.FindData(b,"Graph "+this.Code)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}if(this.RD3Changed||d){if(this.QueryObj.RS.RecordCount()==0){this.libraryObj.setGraphFile("");return true}var a=this.Width;var c=this.Height;if(b.ParamsObj().UseRD3){a-=4;c-=4}if(a>0&&c>0){this.libraryObj.drawGraph(this.QueryObj.RS,a,c,this.outputFormat)}}return true};AGraphSrv.prototype.UpdateGraphIMDB=function(b,e){var c=this.Parent.IMDB;if(c.TblModified(this.IMDBDataSource,Glb.GlbRefModIdx)){e=true}if(e){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}if(this.RD3Changed||e){if(c.TblNumRows(this.IMDBDataSource)==0){this.libraryObj.setGraphFile("");return true}var a=this.Width;var d=this.Height;if(b.ParamsObj().UseRD3){a-=4;d-=4}if(a>0&&d>0){this.libraryObj.drawGraph(c,this.IMDBDataSource,a,d,this.outputFormat)}}return true};AGraphSrv.prototype.SelectPoint=function(e,d,a){if(this.IMDBDataSource==-1){this.QueryObj.SelectRow(e,d,a)}else{var c=1;var b=this.QueryObj.IMDBTable;d.TblMoveFirst(this.IMDBDataSource,0);while(c<e){d.TblMoveNext(this.IMDBDataSource,0);c=c+1}for(c=0;c<d.TblNumField(this.IMDBDataSource);c++){d.set_Value(b,c,0,d.Value(this.IMDBDataSource,c,0))}}};AGraphSrv.prototype.set_Legenda=function(a){if(a==AGraphSrv.NONE){this.set_LegendVisible(false)}else{this.set_LegendVisible(true);this.set_LegendPosition(a)}};AGraphSrv.prototype.set_Flags=function(a){if((a&AGraphSrv.FL_GRH_TOOLTIP)>0){}this.set_AxisXVisible((a&AGraphSrv.FL_GRH_SHOWXAXIS)>0);this.set_AxisYVisible((a&AGraphSrv.FL_GRH_SHOWYAXIS)>0);this.set_GridXVisible((a&AGraphSrv.FL_GRH_SHOWGRIDX)>0);this.set_GridYVisible((a&AGraphSrv.FL_GRH_SHOWGRIDY)>0);this.set_Hyperlink((a&AGraphSrv.FL_GRH_ACTIVE)>0)};AGraphSrv.getFont=function(d){var b=new Object();b.FontFamily="Tahoma";b.Size=10;try{var a=d.split(",");if(a.length==3){b.FontFamily=a[0];b.Size=parseInt(a[2],10)}}catch(c){}return b};AGraphSrv.getColor=function(a){throw"Not implemented : AGraphSrv::getColor"};AGraphSrv.prototype.FireGraphClick=function(c,a){var d=parseInt(c.substr(1,2),10);var b=parseInt(c.substr(4),10);this.SelectPoint(b,this.Parent.IMDB,a);a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,108,"AGraph.FireGraphClick","Graph "+this.Code+": Fire GraphClick event");this.Parent.OnGraphClick(this,new IDVariant(d),new IDVariant(b))};AGraphSrv.prototype.copyFrom=function(d,a){a.setTitle(d.getTitle());a.setChartType(d.getChartType());a.setNumSeries(d.getNumSeries());a.setLegendVisible(d.getLegendVisible());a.setLegendPosition(d.getLegendPosition());a.setBorderVisible(d.getBorderVisible());a.setAlpha(d.getAlpha());a.setTooltipsVisible(d.getTooltipsVisible());a.setOrientation(d.getOrientation());a.setShowPoints(d.getShowPoints());a.setShowValueLabel(d.getShowValueLabel());a.setTimePeriod(d.getTimePeriod());a.setUrlString(this.prefix,this.FrIndex,this.Parent.FormIdx);a.setHyperlink(d.getHyperlink());a.setVisualStyleChart(d.getVisualStyleChart());a.setStackedChart(d.getStackedChart());a.setLabelXAxis(d.getLabelXAxis());a.setVisualStyleXAxis(d.getVisualStyleXAxis());a.setLabelOrientation(d.getLabelOrientation());a.setXAxisVisible(d.getXAxisVisible());if(!d.AutoRangeX()){a.setRangeX(d.minValueX(),d.maxValueX())}a.setXGridVisible(d.getXGridVisible());a.setLabelYAxis(d.getLabelYAxis());a.setVisualStyleYAxis(d.getVisualStyleYAxis());a.setYAxisVisible(d.getYAxisVisible());if(!d.AutoRangeY()){a.setRangeY(d.minValueY(),d.maxValueY())}a.setYGridVisible(d.getYGridVisible());a.setVisualStylePieGraph(d.getVisualStylePieGraph());a.setPercentVisible(d.getPercentVisible());var c=d.getGraphFile();a.setGraphFile(c);for(var b=1;b<=d.getNumSeries();b++){a.setSerieLabel(b,d.getSerieLabel(b))}for(var b=1;b<=d.getNumSeries();b++){a.setExplosion(b,d.getExplosion(b))}for(var b=1;b<=d.getNumSeries();b++){a.setSerieVisualStyle(b,d.getSerieVisualStyle(b))}for(var b=1;b<=d.getNumSeries();b++){a.setSerieType(b,d.getSerieType(b))}a.setDualYAxisVisible(d.getDualYAxisVisible());a.setDualLabelYAxis(d.getDualLabelYAxis());for(var b=1;b<=d.getNumSeries();b++){a.setSerieDualYAxis(b,d.getSerieDualYAxis(b))}};AGraphSrv.prototype.getWebFileName=function(a){if(this.libraryObj!=null){if(this.IMDBDataSource==-1){this.UpdateGraphDB(a,this.iGuid,false)}else{this.UpdateGraphIMDB(a,false)}return this.libraryObj.getGraphFile()}else{return""}};AGraphSrv.prototype.GetRD3Name=function(){return"gra"};AGraphSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};AGraphSrv.prototype.RD3RenderDifferences=function(f,c,e){var d=this.RD3Changed;var a=WebFrameSrv.prototype.RD3RenderDifferences.call(this,f,c,e);if(f==null){f=a}d|=(a!=null);if(f==null&&this.RD3Changed){f=c.AddNewElement("chg");f.SetAttribute("id",this.GetRD3Ident());a=f}if(e||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||e){this.SetRD3Property(b,f,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){f.SetAttribute("clk",this.ClickEventDef)}if(this.ShowAnimationDef!=null){f.SetAttribute("sha",this.ShowAnimationDef)}}return d?a:null};AGraphSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.GRA_LIBRARY:c.SetAttribute("lib",this.getLibrary());break;case RD3Glb.GRA_ACTIVE:c.SetAttribute("ena",this.Enabled?"1":"0");break;case RD3Glb.GRA_FILE:c.SetAttribute("fil",Glb.ToRelativeUrl(this.MainFrm,this.libraryObj.getGraphFile()));break;case RD3Glb.GRA_CODICE:c.SetAttribute("cod",this.GraphCode+"_"+this.Parent.FormIdx);break;case RD3Glb.GRA_MAP:break;case RD3Glb.GRA_HEIGHT:c.SetAttribute("ghe",this.Height);break;case RD3Glb.GRA_WIDTH:c.SetAttribute("gwi",this.Width);break;case RD3Glb.GRA_ERRTXT:if(this.GraErrTxt!=null&&this.GraErrTxt!=""){c.SetAttribute("ger",this.GraErrTxt)}break;case RD3Glb.GRA_EDITOR:c.SetAttribute("ged","1");break}};AGraphSrv.prototype.RD3Resize=function(a,c,b){this.Height=c;this.Width=a;this.RD3Change(RD3Glb.GRA_HEIGHT);this.RD3Change(RD3Glb.GRA_WIDTH);this.RD3Change(RD3Glb.GRA_MAP);this.UpdateGraph(this.MainFrm,true);WebFrameSrv.prototype.RD3Resize.call(this,a,c,b)};AGraphSrv.prototype.RD3RawClick=function(a,j,g,m,f,l,d){var c=d.GetAttribute("par4");var e=-1;var h=-1;if(c!=""){e=parseInt(c.substr(1,2),10);h=parseInt(c.substr(4),10)}var k=new IDVariant();if(this.MainFrm!=null){var b=(l)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(b,"Graph"+this.Code+" "+b,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"Graph."+b,"Graph "+this.Code+": firing event "+b)}if(l){this.Parent.OnMouseDoubleClick(this,new IDVariant(a),new IDVariant(j),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(e),new IDVariant(h),k)}else{this.Parent.OnMouseClick(this,new IDVariant(a),new IDVariant(j),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(e),new IDVariant(h),k)}return k.isTrue()};AGraphSrv.prototype.GraphOptions=function(){return this.libraryObj.GraphOptions()};AGraphSrv.prototype.set_GraphOptions=function(a){this.set_GraphOptions(a,false)};AGraphSrv.prototype.set_GraphOptions=function(a,b){this.libraryObj.set_GraphOptions(a);if(b){return}this.RD3Change(RD3Glb.GRA_FILE)};AGraphSrv.prototype.ShowEditor=function(){this.RD3Change(RD3Glb.GRA_EDITOR)};AGraphSrv.prototype.getChartTypeCode=function(a){return this.libraryObj.getChartTypeCode(a)};function GraphLibraryJQPlot(){this.ChartJS;this.w;this.GraphFile="";this.series=1;this.ColLabels;this.SeriesTypes;this.SeriesDualYAxis;this.prefixString="";this.frame=1;this.formIdx=0;this.graficoMisto=false;this.graficoMisto3D=false;this.titolo="";this.sottotitolo="";this.tipoGrafico=AGraphSrv.CHARTTYPEERROR;this.asseXVisibile=true;this.asseXLabel="";this.asseYVisibile=true;this.asseYLabel="";this.dualAsseYVisibile=false;this.dualAsseYLabel="";this.mostraValori=false;this.LegendaVisibile=true;this.posizioneLegenda=AGraphSrv.BOTTOM;this.explosions;this.explosionPixel=20;this.bordoVisibile=true;this.trasparenza=1;this.hyperlink=false;this.visibilitaPunti=true;this.tooltips=true;this.orientation=AGraphSrv.VERTICAL;this.direzioneLabel=AGraphSrv.HORIZONTAL;this.showPercentValues=false;this.showYGrid=false;this.showXGrid=false;this.MinValueY=0;this.MaxValueY=0;this.autoRangeY=true;this.dualMinValueY=0;this.dualMaxValueY=0;this.dualAutoRangeY=true;this.xValues=new ArrayList();this.yValues=new ArrayList();this.yValues.Add(new ArrayList());this.stackedCharts=false;this.dualYAxis=false;this.timePeriod=AGraphSrv.DAY;this.visualStyleGrafico=-1;this.visualStyleAsseX=-1;this.visualStyleAsseY=-1;this.visualStyleAsseYDuale=-1;this.visualStylePieGraph=-1;this.seriesVisualStyle;this.width=800;this.heigth=600}GraphLibraryJQPlot.prototype.setTitleandSubtitle=function(a,b){this.titolo=a;this.sottotitolo=b};GraphLibraryJQPlot.prototype.getSubtitle=function(){return this.sottotitolo};GraphLibraryJQPlot.prototype.setTitle=function(a){this.titolo=a};GraphLibraryJQPlot.prototype.getTitle=function(){return this.titolo};GraphLibraryJQPlot.prototype.setChartType=function(a){this.tipoGrafico=a};GraphLibraryJQPlot.prototype.getChartType=function(){return this.tipoGrafico};GraphLibraryJQPlot.prototype.setXAxisVisible=function(a){this.asseXVisibile=a};GraphLibraryJQPlot.prototype.getXAxisVisible=function(){return this.asseXVisibile};GraphLibraryJQPlot.prototype.setLabelXAxis=function(a){this.asseXLabel=a};GraphLibraryJQPlot.prototype.getLabelXAxis=function(){return this.asseXLabel};GraphLibraryJQPlot.prototype.setVisualStyleXAxis=function(a){this.visualStyleAsseX=a};GraphLibraryJQPlot.prototype.getVisualStyleXAxis=function(){return this.visualStyleAsseX};GraphLibraryJQPlot.prototype.setYAxisVisible=function(a){this.asseYVisibile=a};GraphLibraryJQPlot.prototype.getYAxisVisible=function(){return this.asseYVisibile};GraphLibraryJQPlot.prototype.setLabelYAxis=function(a){this.asseYLabel=a};GraphLibraryJQPlot.prototype.getLabelYAxis=function(){return this.asseYLabel};GraphLibraryJQPlot.prototype.setVisualStyleYAxis=function(a){this.visualStyleAsseY=a};GraphLibraryJQPlot.prototype.getVisualStyleYAxis=function(){return this.visualStyleAsseY};GraphLibraryJQPlot.prototype.setVisualStyleDualYAxis=function(a){this.visualStyleAsseYDuale=a};GraphLibraryJQPlot.prototype.getVisualStyleDualYAxis=function(){return this.visualStyleAsseYDuale};GraphLibraryJQPlot.prototype.setDualYAxisVisible=function(a){this.dualAsseYVisibile=a};GraphLibraryJQPlot.prototype.getDualYAxisVisible=function(){return this.dualAsseYVisibile};GraphLibraryJQPlot.prototype.setDualLabelYAxis=function(a){this.dualAsseYLabel=a};GraphLibraryJQPlot.prototype.getDualLabelYAxis=function(){return this.dualAsseYLabel};GraphLibraryJQPlot.prototype.setVisualStyleChart=function(a){this.visualStyleGrafico=a};GraphLibraryJQPlot.prototype.getVisualStyleChart=function(){return this.visualStyleGrafico};GraphLibraryJQPlot.prototype.setSerieColors=function(b,a){};GraphLibraryJQPlot.prototype.getSerieColors=function(a){return null};GraphLibraryJQPlot.prototype.setRingHole=function(a){};GraphLibraryJQPlot.prototype.getRingHole=function(){return -1};GraphLibraryJQPlot.prototype.setGraphFile=function(a){this.GraphFile=a};GraphLibraryJQPlot.prototype.getGraphFile=function(){return this.GraphFile};GraphLibraryJQPlot.prototype.setNumSeries=function(f){var b=this.ColLabels;this.ColLabels=new Array(f);for(var d=0;d<f;d++){this.ColLabels[d]=""}var a=this.seriesVisualStyle;this.seriesVisualStyle=new Array(f);for(var d=0;d<f;d++){this.seriesVisualStyle[d]=-1}var c=this.SeriesTypes;this.SeriesTypes=new Array(f);for(var d=0;d<f;d++){this.SeriesTypes[d]=-1}var e=this.SeriesDualYAxis;this.SeriesDualYAxis=new Array(f);for(var d=0;d<f;d++){this.SeriesDualYAxis[d]=false}if(b!=null){for(var d=0;d<Math.min(b.length,this.ColLabels.length);d++){this.ColLabels[d]=b[d]}}if(a!=null){for(var d=0;d<Math.min(a.length,this.seriesVisualStyle.length);d++){this.seriesVisualStyle[d]=a[d]}}if(c!=null){for(var d=0;d<Math.min(c.length,this.SeriesTypes.length);d++){this.SeriesTypes[d]=c[d]}}if(e!=null){for(var d=0;d<Math.min(e.length,this.SeriesDualYAxis.length);d++){this.SeriesDualYAxis[d]=e[d]}}this.yValues=new ArrayList(f);for(var d=0;d<f;d++){this.yValues.Add(new ArrayList())}this.series=f};GraphLibraryJQPlot.prototype.getNumSeries=function(){if(this.ColLabels==null){return 0}return this.ColLabels.length};GraphLibraryJQPlot.prototype.setSerieLabel=function(b,a){if((this.ColLabels==null)||(this.ColLabels.length<b)){return}this.ColLabels[b-1]=a};GraphLibraryJQPlot.prototype.getSerieLabel=function(a){if(a>this.ColLabels.length){return""}return this.ColLabels[a-1]};GraphLibraryJQPlot.prototype.setSerieType=function(b,a){if((this.SeriesTypes==null)||(this.SeriesTypes.length<b)){return}this.SeriesTypes[b-1]=a};GraphLibraryJQPlot.prototype.getSerieType=function(a){if(a>this.SeriesTypes.length){return -1}return this.SeriesTypes[a-1]};GraphLibraryJQPlot.prototype.setSerieDualYAxis=function(b,a){if(this.ColLabels==null||b<1||b>this.ColLabels.length){return}this.SeriesDualYAxis[b-1]=a;if(a){this.setDualYAxisVisible(true)}};GraphLibraryJQPlot.prototype.getSerieDualYAxis=function(a){if(a>this.ColLabels.length){return false}return this.SeriesDualYAxis[a-1]};GraphLibraryJQPlot.prototype.setSerieVisualStyle=function(b,a){this.seriesVisualStyle[b-1]=a};GraphLibraryJQPlot.prototype.getSerieVisualStyle=function(a){return this.seriesVisualStyle[a-1]};GraphLibraryJQPlot.prototype.setLegendVisible=function(a){this.LegendaVisibile=a};GraphLibraryJQPlot.prototype.getLegendVisible=function(){return this.LegendaVisibile};GraphLibraryJQPlot.prototype.setLegendPosition=function(a){this.posizioneLegenda=a};GraphLibraryJQPlot.prototype.getLegendPosition=function(){return this.posizioneLegenda};GraphLibraryJQPlot.prototype.setLabelOrientation=function(a){this.direzioneLabel=a};GraphLibraryJQPlot.prototype.getLabelOrientation=function(){return this.direzioneLabel};GraphLibraryJQPlot.prototype.setStackedChart=function(a){this.stackedCharts=a};GraphLibraryJQPlot.prototype.getStackedChart=function(){return this.stackedCharts};GraphLibraryJQPlot.prototype.setOutputFormat=function(a){};GraphLibraryJQPlot.prototype.getOutputFormat=function(){return -1};GraphLibraryJQPlot.prototype.setExplosion=function(a,b){};GraphLibraryJQPlot.prototype.getExplosion=function(a){return 0};GraphLibraryJQPlot.prototype.setBorderVisible=function(a){this.bordoVisibile=a};GraphLibraryJQPlot.prototype.getBorderVisible=function(){return this.bordoVisibile};GraphLibraryJQPlot.prototype.setAlpha=function(a){this.trasparenza=a};GraphLibraryJQPlot.prototype.getAlpha=function(){return this.trasparenza};GraphLibraryJQPlot.prototype.setUrlString=function(b,c,a){};GraphLibraryJQPlot.prototype.setHyperlink=function(a){this.hyperlink=a};GraphLibraryJQPlot.prototype.getHyperlink=function(){return this.hyperlink};GraphLibraryJQPlot.prototype.setTooltipsVisible=function(a){this.tooltips=a};GraphLibraryJQPlot.prototype.getTooltipsVisible=function(){return this.tooltips};GraphLibraryJQPlot.prototype.setShowPoints=function(a){this.visibilitaPunti=a};GraphLibraryJQPlot.prototype.getShowPoints=function(){return this.visibilitaPunti};GraphLibraryJQPlot.prototype.setOrientation=function(a){this.orientation=a};GraphLibraryJQPlot.prototype.getOrientation=function(){return this.orientation};GraphLibraryJQPlot.prototype.setPercentVisible=function(a){this.showPercentValues=a};GraphLibraryJQPlot.prototype.getPercentVisible=function(){return this.showPercentValues};GraphLibraryJQPlot.prototype.activateAutoRangeX=function(){return};GraphLibraryJQPlot.prototype.AutoRangeX=function(){return true};GraphLibraryJQPlot.prototype.activateAutoRangeY=function(){this.autoRangeY=true};GraphLibraryJQPlot.prototype.AutoRangeY=function(){return this.autoRangeY};GraphLibraryJQPlot.prototype.activateAutoRangeDualY=function(){this.dualAutoRangeY=true};GraphLibraryJQPlot.prototype.AutoRangeDualY=function(){return this.dualAutoRangeY};GraphLibraryJQPlot.prototype.setRangeX=function(a,b){return};GraphLibraryJQPlot.prototype.maxValueX=function(){return 0};GraphLibraryJQPlot.prototype.minValueX=function(){return 0};GraphLibraryJQPlot.prototype.setRangeY=function(a,b){this.autoRangeY=false;this.MinValueY=a;this.MaxValueY=b};GraphLibraryJQPlot.prototype.maxValueY=function(){return this.MaxValueY};GraphLibraryJQPlot.prototype.minValueY=function(){return this.MinValueY};GraphLibraryJQPlot.prototype.setRangeDualY=function(a,b){this.dualAutoRangeY=false;this.dualMinValueY=a;this.dualMaxValueY=b};GraphLibraryJQPlot.prototype.maxValueDualY=function(){return this.dualMaxValueY};GraphLibraryJQPlot.prototype.minValueDualY=function(){return this.dualMinValueY};GraphLibraryJQPlot.prototype.setShowValueLabel=function(a){this.mostraValori=a};GraphLibraryJQPlot.prototype.getShowValueLabel=function(){return this.mostraValori};GraphLibraryJQPlot.prototype.setXGridVisible=function(a){this.showXGrid=a};GraphLibraryJQPlot.prototype.getXGridVisible=function(){return this.showXGrid};GraphLibraryJQPlot.prototype.setYGridVisible=function(a){this.showYGrid=a};GraphLibraryJQPlot.prototype.getYGridVisible=function(){return this.showYGrid};GraphLibraryJQPlot.prototype.setTimePeriod=function(a){this.timePeriod=a};GraphLibraryJQPlot.prototype.getTimePeriod=function(){return this.timePeriod};GraphLibraryJQPlot.prototype.setVisualStylePieGraph=function(a){this.visualStylePieGraph=a};GraphLibraryJQPlot.prototype.getVisualStylePieGraph=function(){return this.visualStylePieGraph};GraphLibraryJQPlot.prototype.getChartObject=function(){return null};GraphLibraryJQPlot.prototype.getImageMap=function(a){return""};GraphLibraryJQPlot.prototype.setMainFrm=function(a){this.w=a};GraphLibraryJQPlot.prototype.getMainFrm=function(){return this.w};GraphLibraryJQPlot.prototype.UpdateGraphRS=function(h,g){this.xValues.Clear();for(var k=0;k<this.yValues.Count();k++){this.yValues[k].Clear()}if(h.GetNumFields()<(this.series+1)){return AGraphSrv.DATAERROR}if(this.tipoGrafico==AGraphSrv.PIE3DCHART||this.tipoGrafico==AGraphSrv.PIECHART||this.tipoGrafico==AGraphSrv.RINGCHART){h.MoveFirst();while(!h.EOF()){this.xValues.Add(h.Get(1));this.yValues[0].Add(h.Get(2));h.MoveNext()}return AGraphSrv.OK}if(this.tipoGrafico==AGraphSrv.SCATTERCHART||this.tipoGrafico==AGraphSrv.XYLINECHART){var j=new Array(series);var d=new ArrayList();for(var e=1;e<=this.series;e++){j[e-1]=new HashTableSrv();h.MoveFirst();while(!h.EOF()){var b=h.Get((e*2)-1).dblValue();if(!d.Contains(b)){d.Add(b)}j[e-1].add(b,h.Get(e*2));h.MoveNext()}}d.Sort();for(var c=0;c<d.Count();c++){var f=d[c];this.xValues.Add(new IDVariant(f));for(var e=0;e<this.series;e++){var a=f;if(j[e].ContainsKey(a)){this.yValues[e].Add(j[e][a])}else{this.yValues[e].Add(new IDVariant())}}}}else{for(var e=1;e<=this.series;e++){h.MoveFirst();while(!h.EOF()){if(e==1){this.xValues.Add(h.Get(1))}this.yValues[e-1].Add(h.Get(e+1));h.MoveNext()}}}return AGraphSrv.OK};GraphLibraryJQPlot.prototype.UpdateGrahpIMDB=function(f,e,h){this.xValues.Clear();for(var k=0;k<this.yValues.Count();k++){this.yValues[k].Clear()}if(f.TblNumField(e)<(this.series+1)){return AGraphSrv.DATAERROR}if((this.tipoGrafico==AGraphSrv.PIE3DCHART)||(this.tipoGrafico==AGraphSrv.PIECHART)||(this.tipoGrafico==AGraphSrv.RINGCHART)){f.TblMoveFirst(e,0);while(!f.Eof(e,0)){this.xValues.Add(f.Value(e,0,0));this.yValues[0].Add(f.Value(e,1,0));f.TblMoveNext(e,0)}return AGraphSrv.OK}if((this.tipoGrafico==AGraphSrv.SCATTERCHART)||(this.tipoGrafico==AGraphSrv.XYLINECHART)){var j=new HashTableSrv();var c=new ArrayList();for(var d=1;d<=this.series;d++){j.add(d-1,new HashTableSrv());f.TblMoveFirst(e,0);while(!f.Eof(e,0)){var a=f.Value(e,(d*2)-2,0).dblValue();if(!c.Contains(a)){c.Add(a)}j[d-1].add(a,f.Value(e,(d*2)-1,0));f.TblMoveNext(e,0)}}c.Sort();for(var b=0;b<c.Count();b++){var g=c[b];this.xValues.Add(new IDVariant(g));for(var d=1;d<=this.series;d++){if(j[d-1].containsKey(g)){this.yValues[d-1].Add(j[d-1][g])}else{this.yValues[d-1].Add(new IDVariant())}}}}else{for(var d=1;d<=this.series;d++){f.TblMoveFirst(e,0);while(!f.Eof(e,0)){if(d==1){this.xValues.Add(f.Value(e,0,0))}this.yValues[d-1].Add(f.Value(e,d,0));f.TblMoveNext(e,0)}}}return AGraphSrv.OK};GraphLibraryJQPlot.prototype.drawGraph=function(d,e,a,f,c){if(d instanceof IDCachedRowSet){var b=d;c=f;f=a;a=e;this.width=a;this.heigth=f;this.UpdateGraphRS(b,this.ColLabels)}else{this.width=a;this.heigth=f;this.UpdateGrahpIMDB(d,e,this.ColLabels)}this.setGraphFile(this.CreateJS());return AGraphSrv.OK};GraphLibraryJQPlot.prototype.CreateJS=function(){var q="";q+="[";for(var v=0;v<this.series;v++){q+=(v!=0?",":"");q+="[";var s=0;for(var n=0;n<this.yValues[v].length;n++){var g=this.yValues[v][n];if(g.Type==IDVariant.NULL&&(this.tipoGrafico==AGraphSrv.XYLINECHART||this.tipoGrafico==AGraphSrv.SCATTERCHART)){continue}var t=g.stringValue();if(!IDL.IsNumber(g)){t="'"+t+"'"}if(g.Type==IDVariant.NULL){t="null"}q+=(s!=0?",":"");switch(this.tipoGrafico){case AGraphSrv.XYLINECHART:case AGraphSrv.SCATTERCHART:q+=("["+this.ReplaceSpecialChars(this.xValues[s]).stringValue()+","+t+"]");break;case AGraphSrv.TIMELINECHART:case AGraphSrv.TIMEBARCHART:var y=new IDVariant(this.xValues[s]);var u=new IDVariant("mm/dd/yyyy");switch(this.timePeriod){case AGraphSrv.YEAR:u=new IDVariant("yyyy");break;case AGraphSrv.MONTH:u=new IDVariant("mm/yyyy");break}y=IDL.Format(y,u,null);q+=("['"+this.ReplaceSpecialChars(y).stringValue()+"',"+t+"]");break;case AGraphSrv.PIECHART:case AGraphSrv.PIE3DCHART:case AGraphSrv.RINGCHART:q+=("['"+this.ReplaceSpecialChars(this.xValues[s]).stringValue()+"',"+t+"]");break;default:q+=t;break}s++}q+="]"}q+="]";q+=", {";q+=("stackSeries: "+(this.stackedCharts?"true":"false")+", ");q+="title: {";q+="text: '"+this.ReplaceSpecialChars(this.titolo).stringValue()+"',";q+="show: "+(this.titolo==""?"false":"true");if(this.visualStyleGrafico!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);var e=AGraphSrv.getFont(x.Font(Glb.VISFNT_HEAD));q+=(",fontFamily: '"+e.FontFamily+"',");q+=("fontSize: '"+e.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(x.Color(Glb.VISCLR_FOREHEAD))+"'");var r="left";var f=x.Alignment(Glb.VISALI_HDRLIST);if(f==Glb.VISALN_CX){r="center"}if(f==Glb.VISALN_DX){r="right"}q+=", textAlign: '"+r+"'"}else{q+=",fontFamily: 'Tahoma'";q+=",fontSize: '8pt'"}q+="},";q+="axes: {";q+=(this.orientation==AGraphSrv.VERTICAL?"xaxis:":"yaxis:")+" {";q+="show: "+(!this.asseXVisibile?"false":"true")+",";q+="label: '"+this.ReplaceSpecialChars(this.asseXLabel).stringValue()+"',";q+="showLabel: true";if(this.tipoGrafico==AGraphSrv.BAR3DCHART||this.tipoGrafico==AGraphSrv.BARCHART||this.tipoGrafico==AGraphSrv.AREACHART||this.tipoGrafico==AGraphSrv.LINECHART){q+=",ticks: [";for(var v=0;v<this.xValues.Count();v++){q+=(v!=0?",":"");q+=("'"+this.ReplaceSpecialChars(this.xValues[v]).stringValue()+"'")}q+="]";q+=", renderer: $.jqplot.CategoryAxisRenderer"}else{if(this.tipoGrafico==AGraphSrv.TIMEBARCHART||this.tipoGrafico==AGraphSrv.TIMELINECHART){q+=", renderer: $.jqplot.DateAxisRenderer"}}if(this.direzioneLabel!=0){q+=",tickRenderer: $.jqplot.CanvasAxisTickRenderer"}else{q+=",tickRenderer: $.jqplot.AxisTickRenderer"}q+=",tickOptions : {";q+="angle: "+this.direzioneLabel;if(this.tipoGrafico==AGraphSrv.TIMEBARCHART||this.tipoGrafico==AGraphSrv.TIMELINECHART){var o="%d/%m/%Y";switch(this.timePeriod){case AGraphSrv.YEAR:o="%Y";break;case AGraphSrv.MONTH:o="%m/%Y";break}q+=",formatString:'"+o+"'"}if(this.visualStyleAsseX!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseX);var j=Glb.VISFNT_VALUE;var d=Glb.VISCLR_FOREVALUE;var c=AGraphSrv.getFont(x.Font(j));q+=(",fontFamily: '"+c.FontFamily+"',");q+=("fontSize: '"+c.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(x.Color(d))+"'");q+="}";j=Glb.VISFNT_NOTNULL;d=Glb.VISCLR_FOREHEADNN;c=AGraphSrv.getFont(x.Font(j));q+=",labelOptions : {";q+=("fontFamily: '"+c.FontFamily+"',");q+=("fontSize: '"+c.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(x.Color(d))+"'");q+="}"}else{q+=",fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}";q+=",labelOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}"}q+="},";q+=(this.orientation==AGraphSrv.VERTICAL?"yaxis:":"xaxis:")+" {";q+=("showTicks: "+(!this.asseYVisibile?"false":"true")+",");q+=("label: '"+this.ReplaceSpecialChars(this.asseYLabel).stringValue()+"',");q+="showLabel: true,";q+="labelRenderer: $.jqplot.CanvasAxisLabelRenderer";if(this.visualStyleAsseY!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseY);q+=", tickOptions : {";var j=Glb.VISFNT_VALUE;var d=Glb.VISCLR_FOREVALUE;var c=AGraphSrv.getFont(x.Font(j));q+=("fontFamily: '"+c.FontFamily+"',");q+=("fontSize: '"+c.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(x.Color(d))+"'");q+="}";j=Glb.VISFNT_NOTNULL;d=Glb.VISCLR_FOREHEADNN;c=AGraphSrv.getFont(x.Font(j));q+=",labelOptions : {";q+=("fontFamily: '"+c.FontFamily+"',");q+=("fontSize: '"+c.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(x.Color(d))+"'");q+="}"}else{q+=", tickOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}";q+=",labelOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}"}if(!this.autoRangeY){q+=", min: '"+this.MinValueY+"',";q+="max: '"+this.MaxValueY+"',";q+="autoscale: false"}q+="}";this.dualYAxis=false;for(var h=0;h<this.SeriesDualYAxis.length;h++){this.dualYAxis|=this.SeriesDualYAxis[h]}if(this.dualYAxis&&this.dualAsseYVisibile){q+=",y2axis: {";q+="show: "+(!this.dualAsseYVisibile?"false":"true")+",";q+="label: '"+this.dualAsseYLabel+"',";q+="showLabel: true,";q+="labelRenderer: $.jqplot.CanvasAxisLabelRenderer";if(this.visualStyleAsseYDuale!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseYDuale);q+=", tickOptions : {";var j=Glb.VISFNT_VALUE;var d=Glb.VISCLR_FOREVALUE;var c=AGraphSrv.getFont(x.Font(j));q+="fontFamily: '"+c.FontFamily+"',";q+="fontSize: '"+c.Size+"pt' ,";q+="textColor: '"+Glb.GetWebColor(x.Color(d))+"'";q+="}";j=Glb.VISFNT_NOTNULL;d=Glb.VISCLR_FOREHEADNN;c=AGraphSrv.getFont(x.Font(j));q+=",labelOptions : {";q+="fontFamily: '"+c.FontFamily+"',";q+="fontSize: '"+c.Size+"pt' ,";q+="textColor: '"+Glb.GetWebColor(x.Color(d))+"'";q+="}"}else{q+=", tickOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}";q+=",labelOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}"}q+="}"}q+="},";q+="grid: {";q+="drawGridlines : "+(!this.showYGrid?"false":"true");if(this.visualStyleGrafico!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);q+=", gridLineColor : '"+Glb.GetWebColor(x.CBorColor(Glb.VISCBOR_TOP))+"',";var b=Math.floor(((x.CBorWidth(Glb.VISCBOR_TOP)/4)/72)*96);if(b>5){b=5}q+="gridLineWidth: "+b+",";q+="background : '"+Glb.GetWebColor(x.Color(Glb.VISCLR_BACKPANEL))+"',";q+="drawBorder : "+(x.BorderType(Glb.VISBDI_VALUE)==Glb.VISBRD_NONE?"false":"true")+",";q+="borderColor : '"+Glb.GetWebColor(x.Color(Glb.VISCLR_BORDERS))+"'"}q+="},";if(this.LegendaVisibile){q+="legend: {";q+="show  : "+(!this.LegendaVisibile?"false":"true")+",";var l="s";switch(this.posizioneLegenda){case AGraphSrv.TOP:l="n";break;case AGraphSrv.LEFT:l="w";break;case AGraphSrv.RIGTH:l="e";break}q+="placement: 'outsideGrid',";q+="location :'"+l+"'";if(this.tipoGrafico!=AGraphSrv.PIECHART&&this.tipoGrafico!=AGraphSrv.PIE3DCHART&&this.tipoGrafico!=AGraphSrv.RINGCHART){q+=",renderer: $.jqplot.EnhancedLegendRenderer";if(this.posizioneLegenda==AGraphSrv.BOTTOM||this.posizioneLegenda==AGraphSrv.TOP){q+=",rendererOptions: {numberRows:1}"}}if(this.visualStyleGrafico!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);var k=AGraphSrv.getFont(x.Font(Glb.VISFNT_GROUP));q+=", fontFamily: '"+k.FontFamily+"',";q+="fontSize: '"+k.Size+"pt' ,";q+="textColor: '"+Glb.GetWebColor(x.Color(Glb.VISCLR_FOREGROUP))+"', ";q+="background: '"+Glb.GetWebColor(x.Color(Glb.VISCLR_BACKGROUP))+"'"}q+="},"}if(this.tooltips&&this.tipoGrafico!=AGraphSrv.PIECHART&&this.tipoGrafico!=AGraphSrv.RINGCHART&&this.tipoGrafico!=AGraphSrv.PIE3DCHART&&this.tipoGrafico!=AGraphSrv.AREACHART){q+="highlighter: {";q+="show  : true";q+="},"}q+="seriesDefaults: {";if(this.visualStyleGrafico!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);q+="pointLabels: { show: "+(((x.Flags()&Glb.FL_VIS_SHOWVALUE)>0)?"true":"false")+", location:'n'}"}q+="},";q+="series:[";for(var v=0;v<this.series;v++){var a=this.tipoGrafico;if(this.SeriesTypes[v]!=-1){this.tipoSerie=this.SeriesTypes[v]}q+=(v!=0?",":"");q+="{";q+="show : true,";q+="xaxis : 'xaxis',";q+=("yaxis : '"+(this.SeriesDualYAxis[v]?"y2axis":"yaxis")+"',");q+="label : '"+this.ReplaceSpecialChars(this.ColLabels[v]).stringValue()+"'";var m=null;if(this.seriesVisualStyle[v]!=-1){m=this.w.VisualStyleList.VisualAttribute(this.seriesVisualStyle[v]);q+=",color :'"+Glb.GetWebColor(m.Color(Glb.VISCLR_BACKVALUE))+"'"}switch(a){case AGraphSrv.AREACHART:q+=",fill: true";if(!this.stackedCharts){q+=",fillAlpha:0.7, shadow:false"}break;case AGraphSrv.BAR3DCHART:case AGraphSrv.TIMEBARCHART:case AGraphSrv.BARCHART:q+=",renderer : $.jqplot.BarRenderer,";q+="rendererOptions : {";q+="barDirection: '"+(this.orientation==AGraphSrv.VERTICAL?"vertical":"horizontal")+"'";q+="}";break;case AGraphSrv.TIMELINECHART:case AGraphSrv.XYLINECHART:case AGraphSrv.LINECHART:break;case AGraphSrv.PIE3DCHART:case AGraphSrv.PIECHART:q+=",renderer : $.jqplot.PieRenderer,";q+="rendererOptions : {";q+="fill: true,";q+="dataLabels: '"+(this.showPercentValues?"percent":"value")+"'";if(this.visualStyleGrafico!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);if((x.Flags()&Glb.FL_VIS_SHOWVALUE)>0){q+=",showDataLabels: true"}}q+="}";break;case AGraphSrv.RINGCHART:q+=",renderer : $.jqplot.DonutRenderer,";q+="rendererOptions : {";q+="fill: true,";q+="dataLabels: '"+(this.showPercentValues?"percent":"value")+"'";if(this.visualStyleGrafico!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);if((x.Flags()&Glb.FL_VIS_SHOWVALUE)>0){q+=",showDataLabels: true"}}q+="}";break}q+="}"}q+="]";q+="}";return q};GraphLibraryJQPlot.prototype.ReplaceSpecialChars=function(b){if(typeof b=="string"){b=new IDVariant(b)}var a=IDL.Replace(b,new IDVariant("'"),new IDVariant("&#39;"));return a};GraphLibraryJQPlot.prototype.GraphOptions=function(){return null};GraphLibraryJQPlot.prototype.set_GraphOptions=function(a){};GraphLibraryJQPlot.prototype.getChartTypeCode=function(a){return -1};function GraphLibraryChartJs(){this.ChartJS;this.w;this.GraphFile="";this.series=1;this.ColLabels;this.SeriesTypes;this.SeriesDualYAxis;this.prefixString="";this.frame=1;this.formIdx=0;this.graficoMisto=false;this.graficoMisto3D=false;this.titolo="";this.sottotitolo="";this.tipoGrafico=AGraphSrv.CHARTTYPEERROR;this.asseXVisibile=true;this.asseXLabel="";this.asseYVisibile=true;this.asseYLabel="";this.dualAsseYVisibile=false;this.dualAsseYLabel="";this.mostraValori=false;this.LegendaVisibile=true;this.posizioneLegenda=AGraphSrv.BOTTOM;this.explosions={};this.bordoVisibile=true;this.trasparenza=1;this.hyperlink=false;this.visibilitaPunti=true;this.tooltips=true;this.orientation=AGraphSrv.VERTICAL;this.direzioneLabel=AGraphSrv.HORIZONTAL;this.showPercentValues=false;this.showYGrid=false;this.showXGrid=false;this.MinValueX=0;this.MaxValueX=0;this.MinValueY=0;this.MaxValueY=0;this.autoRangeY=true;this.autoRangeX=true;this.dualMinValueY=0;this.dualMaxValueY=0;this.dualAutoRangeY=true;this.xValues=new ArrayList();this.xDataType="";this.yValues=new ArrayList();this.yValues.Add(new ArrayList());this.seriesDataType=[];this.stackedCharts=false;this.timePeriod=AGraphSrv.DAY;this.ringHole=-1;this.options="";this.visualStyleGrafico=-1;this.visualStyleAsseX=-1;this.visualStyleAsseY=-1;this.visualStyleAsseYDuale=-1;this.visualStylePieGraph=-1;this.seriesVisualStyle;this.serieColors=new ArrayList();this.serieColors.Add(new ArrayList());this.serieColorsCustom=false;this.width=800;this.heigth=600}GraphLibraryChartJs.prototype.setTitleandSubtitle=function(a,b){this.titolo=a;this.sottotitolo=b};GraphLibraryChartJs.prototype.getSubtitle=function(){return this.sottotitolo};GraphLibraryChartJs.prototype.setTitle=function(a){this.titolo=a};GraphLibraryChartJs.prototype.getTitle=function(){return this.titolo};GraphLibraryChartJs.prototype.setChartType=function(a){this.tipoGrafico=a};GraphLibraryChartJs.prototype.getChartType=function(){return this.tipoGrafico};GraphLibraryChartJs.prototype.setXAxisVisible=function(a){this.asseXVisibile=a};GraphLibraryChartJs.prototype.getXAxisVisible=function(){return this.asseXVisibile};GraphLibraryChartJs.prototype.setLabelXAxis=function(a){this.asseXLabel=a};GraphLibraryChartJs.prototype.getLabelXAxis=function(){return this.asseXLabel};GraphLibraryChartJs.prototype.setVisualStyleXAxis=function(a){this.visualStyleAsseX=a};GraphLibraryChartJs.prototype.getVisualStyleXAxis=function(){return this.visualStyleAsseX};GraphLibraryChartJs.prototype.setYAxisVisible=function(a){this.asseYVisibile=a};GraphLibraryChartJs.prototype.getYAxisVisible=function(){return this.asseYVisibile};GraphLibraryChartJs.prototype.setLabelYAxis=function(a){this.asseYLabel=a};GraphLibraryChartJs.prototype.getLabelYAxis=function(){return this.asseYLabel};GraphLibraryChartJs.prototype.setVisualStyleYAxis=function(a){this.visualStyleAsseY=a};GraphLibraryChartJs.prototype.getVisualStyleYAxis=function(){return this.visualStyleAsseY};GraphLibraryChartJs.prototype.setVisualStyleDualYAxis=function(a){this.visualStyleAsseYDuale=a};GraphLibraryChartJs.prototype.getVisualStyleDualYAxis=function(){return this.visualStyleAsseYDuale};GraphLibraryChartJs.prototype.setDualYAxisVisible=function(a){this.dualAsseYVisibile=a};GraphLibraryChartJs.prototype.getDualYAxisVisible=function(){return this.dualAsseYVisibile};GraphLibraryChartJs.prototype.setDualLabelYAxis=function(a){this.dualAsseYLabel=a};GraphLibraryChartJs.prototype.getDualLabelYAxis=function(){return this.dualAsseYLabel};GraphLibraryChartJs.prototype.setVisualStyleChart=function(a){this.visualStyleGrafico=a};GraphLibraryChartJs.prototype.getVisualStyleChart=function(){return this.visualStyleGrafico};GraphLibraryChartJs.prototype.setSerieColors=function(d,a){this.serieColors[d-1].Clear();var e=a.GetNative();for(var b=0;b<e.length;b++){this.serieColors[d-1].Add(e[b].stringValue())}this.serieColorsCustom=true};GraphLibraryChartJs.prototype.getSerieColors=function(a){return this.serieColors[a-1]};GraphLibraryChartJs.prototype.setRingHole=function(a){this.ringHole=a};GraphLibraryChartJs.prototype.getRingHole=function(){return this.ringHole};GraphLibraryChartJs.prototype.setGraphFile=function(a){this.GraphFile=a};GraphLibraryChartJs.prototype.getGraphFile=function(){return this.GraphFile};GraphLibraryChartJs.prototype.setNumSeries=function(h){var c=this.ColLabels;this.ColLabels=new Array(h);for(var f=0;f<h;f++){this.ColLabels[f]=""}var b=this.seriesVisualStyle;this.seriesVisualStyle=new Array(h);for(var f=0;f<h;f++){this.seriesVisualStyle[f]=-1}var e=this.SeriesTypes;this.SeriesTypes=new Array(h);for(var f=0;f<h;f++){this.SeriesTypes[f]=-1}var g=this.SeriesDualYAxis;this.SeriesDualYAxis=new Array(h);for(var f=0;f<h;f++){this.SeriesDualYAxis[f]=false}if(c!=null){for(var f=0;f<Math.min(c.length,this.ColLabels.length);f++){this.ColLabels[f]=c[f]}}if(b!=null){for(var f=0;f<Math.min(b.length,this.seriesVisualStyle.length);f++){this.seriesVisualStyle[f]=b[f]}}if(e!=null){for(var f=0;f<Math.min(e.length,this.SeriesTypes.length);f++){this.SeriesTypes[f]=e[f]}}if(g!=null){for(var f=0;f<Math.min(g.length,this.SeriesDualYAxis.length);f++){this.SeriesDualYAxis[f]=g[f]}}this.yValues=new ArrayList(h);for(var f=0;f<h;f++){this.yValues.Add(new ArrayList())}this.seriesDataType=new Array(h);this.series=h;this.serieColors=new ArrayList(h);var a=["rgb(80, 163, 225)","rgb(133, 187, 68)","rgb(235, 56, 159)","rgb(86, 252, 248)","rgb(170, 105, 232)","rgb(34, 112, 76)","rgb(244, 79, 77)","rgb(76, 1, 231)","rgb(131, 3, 92)","rgb(152, 160, 67)","rgb(201, 97, 77)","rgb(143, 208, 186)","rgb(186, 75, 22)","rgb(161, 155, 110)","rgb(173, 115, 36)","rgb(216, 192, 141)","rgb(35, 135, 247)","rgb(152, 144, 107)","rgb(246, 41, 232)","rgb(225, 104, 53)","rgb(199, 171, 73)","rgb(67, 189, 91)","rgb(181, 223, 7)","rgb(154, 146, 159)","rgb(144, 12, 96)","rgb(50, 83, 179)","rgb(221, 158, 140)","rgb(195, 169, 65)","rgb(205, 116, 24)","rgb(118, 234, 202)"];for(var f=0;f<h;f++){this.serieColors[f]=new ArrayList();for(var d=0;d<a.length;d++){this.serieColors[f].Add(a[d])}}};GraphLibraryChartJs.prototype.getNumSeries=function(){if(this.ColLabels==null){return 0}return this.ColLabels.length};GraphLibraryChartJs.prototype.setSerieLabel=function(b,a){if((this.ColLabels==null)||(this.ColLabels.length<b)){return}this.ColLabels[b-1]=a};GraphLibraryChartJs.prototype.getSerieLabel=function(a){if(a>this.ColLabels.length){return""}return this.ColLabels[a-1]};GraphLibraryChartJs.prototype.setSerieType=function(b,a){if((this.SeriesTypes==null)||(this.SeriesTypes.length<b)){return}this.SeriesTypes[b-1]=a};GraphLibraryChartJs.prototype.getSerieType=function(a){if(a>this.SeriesTypes.length){return -1}return this.SeriesTypes[a-1]};GraphLibraryChartJs.prototype.setSerieDualYAxis=function(b,a){if(this.ColLabels==null||b<1||b>this.ColLabels.length){return}this.SeriesDualYAxis[b-1]=a;if(a){this.setDualYAxisVisible(true)}};GraphLibraryChartJs.prototype.getSerieDualYAxis=function(a){if(a>this.ColLabels.length){return false}return this.SeriesDualYAxis[a-1]};GraphLibraryChartJs.prototype.setSerieVisualStyle=function(b,a){this.seriesVisualStyle[b-1]=a};GraphLibraryChartJs.prototype.getSerieVisualStyle=function(a){return this.seriesVisualStyle[a-1]};GraphLibraryChartJs.prototype.setLegendVisible=function(a){this.LegendaVisibile=a};GraphLibraryChartJs.prototype.getLegendVisible=function(){return this.LegendaVisibile};GraphLibraryChartJs.prototype.setLegendPosition=function(a){this.posizioneLegenda=a};GraphLibraryChartJs.prototype.getLegendPosition=function(){return this.posizioneLegenda};GraphLibraryChartJs.prototype.setLabelOrientation=function(a){this.direzioneLabel=a};GraphLibraryChartJs.prototype.getLabelOrientation=function(){return this.direzioneLabel};GraphLibraryChartJs.prototype.setStackedChart=function(a){this.stackedCharts=a};GraphLibraryChartJs.prototype.getStackedChart=function(){return this.stackedCharts};GraphLibraryChartJs.prototype.setOutputFormat=function(a){};GraphLibraryChartJs.prototype.getOutputFormat=function(){return -1};GraphLibraryChartJs.prototype.setExplosion=function(a,b){if(a==0){this.explosions={};return}if(b==0){delete this.explosions[a];return}this.explosions[a]=b};GraphLibraryChartJs.prototype.getExplosion=function(a){if(a<0){return 0}return this.explosions[a]||0};GraphLibraryChartJs.prototype.setBorderVisible=function(a){this.bordoVisibile=a};GraphLibraryChartJs.prototype.getBorderVisible=function(){return this.bordoVisibile};GraphLibraryChartJs.prototype.setAlpha=function(a){this.trasparenza=a};GraphLibraryChartJs.prototype.getAlpha=function(){return this.trasparenza};GraphLibraryChartJs.prototype.setUrlString=function(b,c,a){};GraphLibraryChartJs.prototype.setHyperlink=function(a){this.hyperlink=a};GraphLibraryChartJs.prototype.getHyperlink=function(){return this.hyperlink};GraphLibraryChartJs.prototype.setTooltipsVisible=function(a){this.tooltips=a};GraphLibraryChartJs.prototype.getTooltipsVisible=function(){return this.tooltips};GraphLibraryChartJs.prototype.setShowPoints=function(a){this.visibilitaPunti=a};GraphLibraryChartJs.prototype.getShowPoints=function(){return this.visibilitaPunti};GraphLibraryChartJs.prototype.setOrientation=function(a){this.orientation=a};GraphLibraryChartJs.prototype.getOrientation=function(){return this.orientation};GraphLibraryChartJs.prototype.setPercentVisible=function(a){this.showPercentValues=a};GraphLibraryChartJs.prototype.getPercentVisible=function(){return this.showPercentValues};GraphLibraryChartJs.prototype.activateAutoRangeX=function(){this.autoRangeX=true};GraphLibraryChartJs.prototype.AutoRangeX=function(){return this.autoRangeX};GraphLibraryChartJs.prototype.activateAutoRangeY=function(){this.autoRangeY=true};GraphLibraryChartJs.prototype.AutoRangeY=function(){return this.autoRangeY};GraphLibraryChartJs.prototype.activateAutoRangeDualY=function(){this.dualAutoRangeY=true};GraphLibraryChartJs.prototype.AutoRangeDualY=function(){return this.dualAutoRangeY};GraphLibraryChartJs.prototype.setRangeX=function(a,b){this.autoRangeX=false;this.MinValueX=a;this.MaxValueX=b};GraphLibraryChartJs.prototype.maxValueX=function(){return this.MaxValueX};GraphLibraryChartJs.prototype.minValueX=function(){return this.MinValueX};GraphLibraryChartJs.prototype.setRangeY=function(a,b){this.autoRangeY=false;this.MinValueY=a;this.MaxValueY=b};GraphLibraryChartJs.prototype.maxValueY=function(){return this.MaxValueY};GraphLibraryChartJs.prototype.minValueY=function(){return this.MinValueY};GraphLibraryChartJs.prototype.setRangeDualY=function(a,b){this.dualAutoRangeY=false;this.dualMinValueY=a;this.dualMaxValueY=b};GraphLibraryChartJs.prototype.maxValueDualY=function(){return this.dualMaxValueY};GraphLibraryChartJs.prototype.minValueDualY=function(){return this.dualMinValueY};GraphLibraryChartJs.prototype.setShowValueLabel=function(a){this.mostraValori=a};GraphLibraryChartJs.prototype.getShowValueLabel=function(){return this.mostraValori};GraphLibraryChartJs.prototype.setXGridVisible=function(a){this.showXGrid=a};GraphLibraryChartJs.prototype.getXGridVisible=function(){return this.showXGrid};GraphLibraryChartJs.prototype.setYGridVisible=function(a){this.showYGrid=a};GraphLibraryChartJs.prototype.getYGridVisible=function(){return this.showYGrid};GraphLibraryChartJs.prototype.setTimePeriod=function(a){this.timePeriod=a};GraphLibraryChartJs.prototype.getTimePeriod=function(){return this.timePeriod};GraphLibraryChartJs.prototype.setVisualStylePieGraph=function(a){this.visualStylePieGraph=a};GraphLibraryChartJs.prototype.getVisualStylePieGraph=function(){return this.visualStylePieGraph};GraphLibraryChartJs.prototype.getChartObject=function(){return null};GraphLibraryChartJs.prototype.getImageMap=function(a){return""};GraphLibraryChartJs.prototype.setMainFrm=function(a){this.w=a};GraphLibraryChartJs.prototype.getMainFrm=function(){return this.w};GraphLibraryChartJs.prototype.UpdateGraphRS=function(d,a){this.xValues.Clear();this.xDataType="";for(var b=0;b<this.yValues.Count();b++){this.yValues[b].Clear()}for(var b=0;b<this.seriesDataType.length;b++){this.seriesDataType[b]=""}if(d.GetNumFields()<(this.series+1)){return AGraphSrv.DATAERROR}var e=d.getMetaData();this.xDataType=this.getChartDataType(e.getColumnType(1));for(var c=1;c<d.GetNumFields();c++){if(c>this.series){break}this.seriesDataType[c-1]=this.getChartDataType(e.getColumnType(c+1))}d.MoveFirst();while(!d.EOF()){this.xValues.Add(d.Get(1));for(var f=0;f<this.series;f++){this.yValues[f].Add(d.Get(f+2))}d.MoveNext()}return AGraphSrv.OK};GraphLibraryChartJs.prototype.UpdateGrahpIMDB=function(c,e,a){this.xValues.Clear();this.xDataType="";for(var b=0;b<this.yValues.Count();b++){this.yValues[b].Clear()}for(var b=0;b<this.seriesDataType.length;b++){this.seriesDataType[b]=""}if(c.TblNumField(e)<(this.series+1)){return AGraphSrv.DATAERROR}this.xDataType=this.getIMDBDataType(c.GetFldDataType(e,0));for(var d=0;d<this.series;d++){this.seriesDataType[d]=this.getIMDBDataType(c.GetFldDataType(e,d+1))}c.TblMoveFirst(e,0);while(!c.Eof(e,0)){this.xValues.Add(c.Value(e,0,0));for(var d=0;d<this.series;d++){this.yValues[d].Add(c.Value(e,d+1,0))}c.TblMoveNext(e,0)}return AGraphSrv.OK};GraphLibraryChartJs.prototype.drawGraph=function(d,e,a,f,c){if(d instanceof IDCachedRowSet){var b=d;c=f;f=a;a=e;this.width=a;this.heigth=f;this.UpdateGraphRS(b,this.ColLabels)}else{this.width=a;this.heigth=f;this.UpdateGrahpIMDB(d,e,this.ColLabels)}this.setGraphFile(this.CreateJS());return AGraphSrv.OK};GraphLibraryChartJs.prototype.CreateJS=function(){var s=this.getChartTypeName(this.tipoGrafico);var d="";d+='{"type": "'+s+'",';d+='"data":{ "labels": [';for(var n=0;n<this.xValues.length;n++){d+='"'+this.ReplaceSpecialChars(this.xValues[n]).stringValue()+'"';if(n<this.xValues.length-1){d+=","}}d+='], "datasets": [';if(this.tipoGrafico==AGraphSrv.BUBBLECHART){if(!this.checkDataType("number")){this.w.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",226,"GraphLibraryChartJs.CreateJs","Data type error");return""}var f=this.yValues[0];for(var n=0;n<this.xValues.length;n++){d+='{"label":"'+this.ReplaceSpecialChars(this.ColLabels[0]).stringValue()+'"';d+=', "data":[';var r=new ArrayList();if(this.yValues.Count()>1){r=this.yValues[1]}d+='{ "x": '+this.xValues[n];d+=', "y": '+(f[n].toString().length==0?"null":f[n]);d+=', "r": '+(r[n]?r[n]:10)+"}";d+="]";var t=null;if(this.seriesVisualStyle[0]!=-1){t=this.w.VisualStyleList.VisualAttribute(this.seriesVisualStyle[0]);if(!this.serieColorsCustom){d+=', "backgroundColor" : "'+Glb.GetWebColor(t.Color(Glb.VISCLR_BACKVALUE))+'"'}d+=', "borderColor":"'+Glb.GetWebColor(t.CBorColor(Glb.VISCBOR_TOP))+'"';var h=Math.floor((((t.CBorWidth(Glb.VISCBOR_TOP))/4)/72)*96);if(h>5){h=5}d+=', "borderWidth":'+h}if(this.serieColorsCustom){var a=this.serieColors[0];d+=', "backgroundColor" : "'+a[n%a.length]+'"'}d+="}";if(n<this.xValues.length-1){d+=","}}}else{if(this.tipoGrafico==AGraphSrv.SCATTERCHART){if(!this.checkDataType("number")){this.w.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",227,"GraphLibraryChartJs.CreateJs","Data type error");return""}for(var n=0;n<this.series;n++){d+='{"data":[';var f=this.yValues[n];for(var g=0;g<f.length;g++){d+='{ "x": '+this.xValues[g];d+=', "y": '+(f[g].toString().length==0?"null":f[g])+"}";if(g<f.length-1){d+=","}}d+="]";var t=null;if(this.seriesVisualStyle[n]!=-1){t=this.w.VisualStyleList.VisualAttribute(this.seriesVisualStyle[n]);d+=', "backgroundColor" : "'+Glb.GetWebColor(t.Color(Glb.VISCLR_BACKVALUE))+'"';d+=', "borderColor":"'+Glb.GetWebColor(t.CBorColor(Glb.VISCBOR_TOP))+'"';var h=Math.floor((((t.CBorWidth(Glb.VISCBOR_TOP))/4)/72)*96);if(h>5){h=5}d+=', "borderWidth":'+h}d+="}";if(n!=this.series-1){d+=","}}}else{for(var n=0;n<this.series;n++){d+='{"label":"'+this.ReplaceSpecialChars(this.ColLabels[n]).stringValue()+'"';if(this.SeriesTypes[n]!=-1){d+=', "type": "'+this.getChartTypeName(this.SeriesTypes[n])+'"'}d+=', "data":[';var q=this.yValues[n];for(var g=0;g<q.length;g++){if(q[g].toString().length==0){d+="null"}else{if(this.seriesDataType[n]=="string"||this.seriesDataType[n]=="date"||this.seriesDataType[n]=="datetime"||this.seriesDataType[n]=="timeofday"){d+='"'+this.ReplaceSpecialChars(q[g]).stringValue()+'"'}else{d+=q[g]}}if(g<q.length-1){d+=","}}d+="]";if(this.tipoGrafico==AGraphSrv.PIECHART||this.tipoGrafico==AGraphSrv.RINGCHART){d+=', "backgroundColor": [';var a=this.serieColors[n];for(var l=0;l<this.xValues.length;l++){d+='"'+a[l%a.Count()]+'"';if(l<this.xValues.length-1){d+=","}}d+="]"}var t=null;if(this.seriesVisualStyle[n]!=-1){t=this.w.VisualStyleList.VisualAttribute(this.seriesVisualStyle[n]);if(this.tipoGrafico!=AGraphSrv.PIECHART&&this.tipoGrafico!=AGraphSrv.RINGCHART){var u=Glb.GetWebColor(t.Color(Glb.VISCLR_BACKVALUE));d+=', "backgroundColor" : "'+u+'"'}d+=', "borderColor":"'+Glb.GetWebColor(t.CBorColor(Glb.VISCBOR_TOP))+'"';var h=Math.floor((((t.CBorWidth(Glb.VISCBOR_TOP))/4)/72)*96);if(h>5){h=5}d+=', "borderWidth":'+h}else{if(this.stackedCharts){var a=this.serieColors[n];d+=', "backgroundColor" : "'+a[n%a.Count()]+'"'}}d+="}";if(n!=this.series-1){d+=","}}}}d+="]";d+="},";if(this.options){d+=('"options": '+this.options)}else{d+='"options":{"responsive":false';if(this.titolo!=""){d+=', "title":{';d+='"display": true,';d+='"text":"'+this.ReplaceSpecialChars(this.titolo).stringValue()+'"';if(this.visualStyleGrafico!=-1){var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);var e=AGraphSrv.getFont(b.Font(Glb.VISFNT_HEAD));d+=',"fontFamily":"'+e.FontFamily+'"';d+=',"fontSize":'+e.Size;d+=',"fontColor":"'+Glb.GetWebColor(b.Color(Glb.VISCLR_FOREHEAD))+'"'}else{d+=',"fontFamily": "Tahoma"';d+=',"fontSize": 8'}d+="}"}if(this.tipoGrafico==AGraphSrv.SCATTERCHART){d+=', "showLines" : false'}if(this.tipoGrafico==AGraphSrv.RINGCHART&&this.ringHole>-1){d+=', "cutoutPercentage": '+this.ringHole}d+=',"scales":{ "xAxes":[{';d+='"display":'+(this.asseXVisibile?"true":"false");if(this.stackedCharts){d+=',"stacked": true'}if(this.asseXLabel.length>0){d+=', "scaleLabel": { "display": true, "labelString": "'+this.asseXLabel+'"';if(this.visualStyleGrafico!=-1){var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);var o=AGraphSrv.getFont(b.Font(Glb.VISFNT_NOTNULL));d+=',"fontFamily": "'+o.FontFamily+'"';d+=', "fontSize": '+o.Size;d+=', "fontColor": "'+Glb.GetWebColor(b.Color(Glb.VISCLR_FOREHEADNN))+'"'}d+="}"}d+=', "ticks": {';if(!this.autoRangeX){d+='"min": '+this.MinValueX;d+=', "max": '+this.MaxValueX}if(this.visualStyleAsseX!=-1){if(!this.autoRangeX){d+=", "}var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseX);var o=AGraphSrv.getFont(b.Font(Glb.VISFNT_NOTNULL));d+='"fontFamily": "'+o.FontFamily+'"';d+=', "fontSize": '+o.Size;d+=', "fontColor": "'+Glb.GetWebColor(b.Color(Glb.VISCLR_FOREVALUE))+'"'}d+="}";d+=', "gridLines": { "display":'+(this.showXGrid?"true":"false");if(this.visualStyleGrafico!=-1&&this.showXGrid){var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);d+=',"color" : "'+Glb.GetWebColor(b.CBorColor(Glb.VISCBOR_TOP))+'"';var c=Math.floor((((b.CBorWidth(Glb.VISCBOR_TOP))/4)/72)*96);if(c>5){c=5}d+=',"lineWidth" : '+c;d+=',"drawBorder" : '+(b.BorderType(Glb.VISBDI_VALUE)==Glb.VISBRD_NONE?"false":"true")}d+="}}],";d+='"yAxes": [{';d+='"display":'+(this.asseYVisibile?"true":"false");if(this.stackedCharts){d+=',"stacked": true'}if(this.asseYLabel.length>0){d+=', "scaleLabel": { "display": true, "labelString": "'+this.asseYLabel+'"';if(this.visualStyleGrafico!=-1){var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);var o=AGraphSrv.getFont(b.Font(Glb.VISFNT_NOTNULL));d+=',"fontFamily": "'+o.FontFamily+'"';d+=', "fontSize": '+o.Size;d+=', "fontColor": "'+Glb.GetWebColor(b.Color(Glb.VISCLR_FOREHEADNN))+'"'}d+="}"}d+=', "ticks": {';if(!this.autoRangeY){d+='"min": '+this.MinValueY;d+=', "max": '+this.MaxValueY}if(this.visualStyleAsseY!=-1){if(!this.autoRangeY){d+=", "}var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseY);var o=AGraphSrv.getFont(b.Font(Glb.VISFNT_NOTNULL));d+='"fontFamily": "'+o.FontFamily+'"';d+=', "fontSize": '+o.Size;d+=', "fontColor": "'+Glb.GetWebColor(b.Color(Glb.VISCLR_FOREVALUE))+'"'}d+="}";d+=', "gridLines": { "display":'+(this.showYGrid?"true":"false");if(this.visualStyleGrafico!=-1){var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);d+=',"color" : "'+Glb.GetWebColor(b.CBorColor(Glb.VISCBOR_RIGHT))+'"';var c=Math.floor((((b.CBorWidth(Glb.VISCBOR_RIGHT))/4)/72)*96);if(c>5){c=5}d+=',"lineWidth" : '+c;d+=',"drawBorder" : '+(b.BorderType(Glb.VISBDI_VALUE)==Glb.VISBRD_NONE?"false":"true")}d+="}}]";d+="}";d+=',"legend" : {';d+='"display" : '+(this.LegendaVisibile?"true":"false");d+=',"position" : "'+this.getLegendPositionName()+'"';if(this.visualStyleGrafico!=-1){d+=', "labels" : {';var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);var m=AGraphSrv.getFont(b.Font(Glb.VISFNT_GROUP));d+='"fontFamily" : "'+m.FontFamily+'"';d+=', "fontSize" : '+m.Size;d+=', "fontColor" : "'+Glb.GetWebColor(b.Color(Glb.VISCLR_FOREGROUP))+'"';d+="}"}d+="}";if(this.tooltips){d+=', "Tooltip" : {';d+='"enabled" : true';d+="}"}d+="}"}d+=', "custom": {';if(this.visualStyleGrafico!=-1){var b=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);if((b.Flags()&Glb.FL_VIS_SHOWVALUE)>0){d+='"showDataLabels": true,'}d+='"chartBackgroundColor" : "'+Glb.GetWebColor(b.Color(Glb.VISCLR_BACKPANEL))+'"';d+=',"overallBackgroundColor" : "'+Glb.GetWebColor(b.Color(Glb.VISCLR_BACKHEAD))+'"'}d+="}";d+="}";return d};GraphLibraryChartJs.prototype.Render=function(a,b){};GraphLibraryChartJs.prototype.ReplaceSpecialChars=function(b){if(typeof b=="string"){b=new IDVariant(b)}var a=IDL.Replace(b,new IDVariant("'"),new IDVariant("&#39;"));a=IDL.Replace(a,new IDVariant("\\"),new IDVariant("\\\\"));a=IDL.Replace(a,new IDVariant('"'),new IDVariant('\\"'));return a};GraphLibraryChartJs.prototype.getChartTypeName=function(b){var a="";switch(b){case AGraphSrv.BARCHART:a=this.orientation==AGraphSrv.HORIZONTAL?"horizontalBar":"bar";break;case AGraphSrv.LINECHART:a="line";break;case AGraphSrv.RADARCHART:a="radar";break;case AGraphSrv.POLARAREACHART:a="polarArea";break;case AGraphSrv.PIECHART:a="pie";break;case AGraphSrv.RINGCHART:a="doughnut";break;case AGraphSrv.BUBBLECHART:a="bubble";break;case AGraphSrv.SCATTERCHART:a="line";break}return a};GraphLibraryChartJs.prototype.getChartDataType=function(b){var a="string";switch(b){case Glb.DT_NUM_INTEGER:case Glb.DT_NUM_FLOAT:case Glb.DT_NUM_FIXED:a="number";break;case Glb.DT_BOOLEAN:a="boolean";break;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:a="datetime";break}return a};GraphLibraryChartJs.prototype.getLegendPositionName=function(){var a="none";switch(this.posizioneLegenda){case AGraphSrv.BOTTOM:a="bottom";break;case AGraphSrv.TOP:a="top";break;case AGraphSrv.RIGTH:a="right";break;case AGraphSrv.LEFT:a="left";break}return a};GraphLibraryChartJs.prototype.getIMDBDataType=function(b){var a="string";switch(b){case Glb.DT_NUM_INTEGER:case Glb.DT_NUM_FLOAT:case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:a="number";break;case Glb.DT_DATE:a="date";break;case Glb.DT_TIME:a="timeofday";break;case Glb.DT_DATETIME:a="datetime";break;case Glb.DT_BOOLEAN:a="boolean";break}return a};GraphLibraryChartJs.prototype.GraphOptions=function(){return this.options};GraphLibraryChartJs.prototype.set_GraphOptions=function(a){this.options=a};GraphLibraryChartJs.prototype.checkDataType=function(c){var a=true;a=this.xDataType!=c?false:true;for(var b=0;b<this.seriesDataType.length&&a;b++){a=this.seriesDataType[b]!=c?false:true}return a};GraphLibraryChartJs.prototype.getChartTypeCode=function(a){return -1};function GraphLibraryGoogleChart(){this.ChartJS;this.w;this.GraphFile="";this.series=1;this.ColLabels;this.SeriesTypes;this.SeriesDualYAxis;this.prefixString="";this.frame=1;this.formIdx=0;this.graficoMisto=false;this.graficoMisto3D=false;this.titolo="";this.sottotitolo="";this.tipoGrafico=AGraphSrv.CHARTTYPEERROR;this.asseXVisibile=true;this.asseXLabel="";this.asseYVisibile=true;this.asseYLabel="";this.dualAsseYVisibile=false;this.dualAsseYLabel="";this.mostraValori=false;this.LegendaVisibile=true;this.posizioneLegenda=AGraphSrv.BOTTOM;this.explosions;this.bordoVisibile=true;this.trasparenza=1;this.hyperlink=false;this.visibilitaPunti=true;this.tooltips=true;this.orientation=AGraphSrv.VERTICAL;this.direzioneLabel=AGraphSrv.HORIZONTAL;this.showPercentValues=false;this.showYGrid=false;this.showXGrid=false;this.MinValueX=0;this.MaxValueX=0;this.MinValueY=0;this.MaxValueY=0;this.autoRangeY=true;this.autoRangeX=true;this.dualMinValueY=0;this.dualMaxValueY=0;this.dualAutoRangeY=true;this.xValues=new ArrayList();this.xDataType="";this.yValues=new ArrayList();this.yValues.Add(new ArrayList());this.seriesDataType=[];this.stackedCharts=false;this.timePeriod=AGraphSrv.DAY;this.ringHole=-1;this.options="";this.visualStyleGrafico=-1;this.visualStyleAsseX=-1;this.visualStyleAsseY=-1;this.visualStyleAsseYDuale=-1;this.visualStylePieGraph=-1;this.seriesVisualStyle;this.serieColors=new ArrayList();this.serieColors.Add(new ArrayList());this.width=800;this.heigth=600}GraphLibraryGoogleChart.prototype.setTitleandSubtitle=function(a,b){this.titolo=a;this.sottotitolo=b};GraphLibraryGoogleChart.prototype.getSubtitle=function(){return this.sottotitolo};GraphLibraryGoogleChart.prototype.setTitle=function(a){this.titolo=a};GraphLibraryGoogleChart.prototype.getTitle=function(){return this.titolo};GraphLibraryGoogleChart.prototype.setChartType=function(a){this.tipoGrafico=a};GraphLibraryGoogleChart.prototype.getChartType=function(){return this.tipoGrafico};GraphLibraryGoogleChart.prototype.setXAxisVisible=function(a){this.asseXVisibile=a};GraphLibraryGoogleChart.prototype.getXAxisVisible=function(){return this.asseXVisibile};GraphLibraryGoogleChart.prototype.setLabelXAxis=function(a){this.asseXLabel=a};GraphLibraryGoogleChart.prototype.getLabelXAxis=function(){return this.asseXLabel};GraphLibraryGoogleChart.prototype.setVisualStyleXAxis=function(a){this.visualStyleAsseX=a};GraphLibraryGoogleChart.prototype.getVisualStyleXAxis=function(){return this.visualStyleAsseX};GraphLibraryGoogleChart.prototype.setYAxisVisible=function(a){this.asseYVisibile=a};GraphLibraryGoogleChart.prototype.getYAxisVisible=function(){return this.asseYVisibile};GraphLibraryGoogleChart.prototype.setLabelYAxis=function(a){this.asseYLabel=a};GraphLibraryGoogleChart.prototype.getLabelYAxis=function(){return this.asseYLabel};GraphLibraryGoogleChart.prototype.setVisualStyleYAxis=function(a){this.visualStyleAsseY=a};GraphLibraryGoogleChart.prototype.getVisualStyleYAxis=function(){return this.visualStyleAsseY};GraphLibraryGoogleChart.prototype.setVisualStyleDualYAxis=function(a){this.visualStyleAsseYDuale=a};GraphLibraryGoogleChart.prototype.getVisualStyleDualYAxis=function(){return this.visualStyleAsseYDuale};GraphLibraryGoogleChart.prototype.setDualYAxisVisible=function(a){this.dualAsseYVisibile=a};GraphLibraryGoogleChart.prototype.getDualYAxisVisible=function(){return this.dualAsseYVisibile};GraphLibraryGoogleChart.prototype.setDualLabelYAxis=function(a){this.dualAsseYLabel=a};GraphLibraryGoogleChart.prototype.getDualLabelYAxis=function(){return this.dualAsseYLabel};GraphLibraryGoogleChart.prototype.setVisualStyleChart=function(a){this.visualStyleGrafico=a};GraphLibraryGoogleChart.prototype.getVisualStyleChart=function(){return this.visualStyleGrafico};GraphLibraryGoogleChart.prototype.setSerieColors=function(d,a){this.serieColors[d-1].Clear();var e=a.GetNative();for(var b=0;b<e.length;b++){this.serieColors[d-1].Add(e[b].stringValue())}};GraphLibraryGoogleChart.prototype.getSerieColors=function(a){return this.serieColors[a-1]};GraphLibraryGoogleChart.prototype.setRingHole=function(a){this.ringHole=a};GraphLibraryGoogleChart.prototype.getRingHole=function(){return this.ringHole};GraphLibraryGoogleChart.prototype.setGraphFile=function(a){this.GraphFile=a};GraphLibraryGoogleChart.prototype.getGraphFile=function(){return this.GraphFile};GraphLibraryGoogleChart.prototype.setNumSeries=function(f){var b=this.ColLabels;this.ColLabels=new Array(f);for(var d=0;d<f;d++){this.ColLabels[d]=""}var a=this.seriesVisualStyle;this.seriesVisualStyle=new Array(f);for(var d=0;d<f;d++){this.seriesVisualStyle[d]=-1}var c=this.SeriesTypes;this.SeriesTypes=new Array(f);for(var d=0;d<f;d++){this.SeriesTypes[d]=-1}var e=this.SeriesDualYAxis;this.SeriesDualYAxis=new Array(f);for(var d=0;d<f;d++){this.SeriesDualYAxis[d]=false}if(b!=null){for(var d=0;d<Math.min(b.length,this.ColLabels.length);d++){this.ColLabels[d]=b[d]}}if(a!=null){for(var d=0;d<Math.min(a.length,this.seriesVisualStyle.length);d++){this.seriesVisualStyle[d]=a[d]}}if(c!=null){for(var d=0;d<Math.min(c.length,this.SeriesTypes.length);d++){this.SeriesTypes[d]=c[d]}}if(e!=null){for(var d=0;d<Math.min(e.length,this.SeriesDualYAxis.length);d++){this.SeriesDualYAxis[d]=e[d]}}this.yValues=new ArrayList(f);for(var d=0;d<f;d++){this.yValues.Add(new ArrayList())}this.seriesDataType=new Array(f);this.series=f;this.serieColors=new ArrayList(f);for(var d=0;d<f;d++){this.serieColors.Add(new ArrayList())}};GraphLibraryGoogleChart.prototype.getNumSeries=function(){if(this.ColLabels==null){return 0}return this.ColLabels.length};GraphLibraryGoogleChart.prototype.setSerieLabel=function(b,a){if((this.ColLabels==null)||(this.ColLabels.length<b)){return}this.ColLabels[b-1]=a};GraphLibraryGoogleChart.prototype.getSerieLabel=function(a){if(a>this.ColLabels.length){return""}return this.ColLabels[a-1]};GraphLibraryGoogleChart.prototype.setSerieType=function(b,a){if((this.SeriesTypes==null)||(this.SeriesTypes.length<b)){return}this.SeriesTypes[b-1]=a};GraphLibraryGoogleChart.prototype.getSerieType=function(a){if(a>this.SeriesTypes.length){return -1}return this.SeriesTypes[a-1]};GraphLibraryGoogleChart.prototype.setSerieDualYAxis=function(b,a){if(this.ColLabels==null||b<1||b>this.ColLabels.length){return}this.SeriesDualYAxis[b-1]=a;if(a){this.setDualYAxisVisible(true)}};GraphLibraryGoogleChart.prototype.getSerieDualYAxis=function(a){if(a>this.ColLabels.length){return false}return this.SeriesDualYAxis[a-1]};GraphLibraryGoogleChart.prototype.setSerieVisualStyle=function(b,a){this.seriesVisualStyle[b-1]=a};GraphLibraryGoogleChart.prototype.getSerieVisualStyle=function(a){return this.seriesVisualStyle[a-1]};GraphLibraryGoogleChart.prototype.setLegendVisible=function(a){this.LegendaVisibile=a};GraphLibraryGoogleChart.prototype.getLegendVisible=function(){return this.LegendaVisibile};GraphLibraryGoogleChart.prototype.setLegendPosition=function(a){this.posizioneLegenda=a};GraphLibraryGoogleChart.prototype.getLegendPosition=function(){return this.posizioneLegenda};GraphLibraryGoogleChart.prototype.setLabelOrientation=function(a){this.direzioneLabel=a};GraphLibraryGoogleChart.prototype.getLabelOrientation=function(){return this.direzioneLabel};GraphLibraryGoogleChart.prototype.setStackedChart=function(a){this.stackedCharts=a};GraphLibraryGoogleChart.prototype.getStackedChart=function(){return this.stackedCharts};GraphLibraryGoogleChart.prototype.setOutputFormat=function(a){};GraphLibraryGoogleChart.prototype.getOutputFormat=function(){return -1};GraphLibraryGoogleChart.prototype.setExplosion=function(a,b){};GraphLibraryGoogleChart.prototype.getExplosion=function(a){return 0};GraphLibraryGoogleChart.prototype.setBorderVisible=function(a){this.bordoVisibile=a};GraphLibraryGoogleChart.prototype.getBorderVisible=function(){return this.bordoVisibile};GraphLibraryGoogleChart.prototype.setAlpha=function(a){this.trasparenza=a};GraphLibraryGoogleChart.prototype.getAlpha=function(){return this.trasparenza};GraphLibraryGoogleChart.prototype.setUrlString=function(b,c,a){};GraphLibraryGoogleChart.prototype.setHyperlink=function(a){this.hyperlink=a};GraphLibraryGoogleChart.prototype.getHyperlink=function(){return this.hyperlink};GraphLibraryGoogleChart.prototype.setTooltipsVisible=function(a){this.tooltips=a};GraphLibraryGoogleChart.prototype.getTooltipsVisible=function(){return this.tooltips};GraphLibraryGoogleChart.prototype.setShowPoints=function(a){this.visibilitaPunti=a};GraphLibraryGoogleChart.prototype.getShowPoints=function(){return this.visibilitaPunti};GraphLibraryGoogleChart.prototype.setOrientation=function(a){this.orientation=a};GraphLibraryGoogleChart.prototype.getOrientation=function(){return this.orientation};GraphLibraryGoogleChart.prototype.setPercentVisible=function(a){this.showPercentValues=a};GraphLibraryGoogleChart.prototype.getPercentVisible=function(){return this.showPercentValues};GraphLibraryGoogleChart.prototype.activateAutoRangeX=function(){this.autoRangeX=true};GraphLibraryGoogleChart.prototype.AutoRangeX=function(){return this.autoRangeX};GraphLibraryGoogleChart.prototype.activateAutoRangeY=function(){this.autoRangeY=true};GraphLibraryGoogleChart.prototype.AutoRangeY=function(){return this.autoRangeY};GraphLibraryGoogleChart.prototype.activateAutoRangeDualY=function(){this.dualAutoRangeY=true};GraphLibraryGoogleChart.prototype.AutoRangeDualY=function(){return this.dualAutoRangeY};GraphLibraryGoogleChart.prototype.setRangeX=function(a,b){this.autoRangeX=false;this.MinValueX=a;this.MaxValueX=b};GraphLibraryGoogleChart.prototype.maxValueX=function(){return this.MaxValueX};GraphLibraryGoogleChart.prototype.minValueX=function(){return this.MinValueX};GraphLibraryGoogleChart.prototype.setRangeY=function(a,b){this.autoRangeY=false;this.MinValueY=a;this.MaxValueY=b};GraphLibraryGoogleChart.prototype.maxValueY=function(){return this.MaxValueY};GraphLibraryGoogleChart.prototype.minValueY=function(){return this.MinValueY};GraphLibraryGoogleChart.prototype.setRangeDualY=function(a,b){this.dualAutoRangeY=false;this.dualMinValueY=a;this.dualMaxValueY=b};GraphLibraryGoogleChart.prototype.maxValueDualY=function(){return this.dualMaxValueY};GraphLibraryGoogleChart.prototype.minValueDualY=function(){return this.dualMinValueY};GraphLibraryGoogleChart.prototype.setShowValueLabel=function(a){this.mostraValori=a};GraphLibraryGoogleChart.prototype.getShowValueLabel=function(){return this.mostraValori};GraphLibraryGoogleChart.prototype.setXGridVisible=function(a){this.showXGrid=a};GraphLibraryGoogleChart.prototype.getXGridVisible=function(){return this.showXGrid};GraphLibraryGoogleChart.prototype.setYGridVisible=function(a){this.showYGrid=a};GraphLibraryGoogleChart.prototype.getYGridVisible=function(){return this.showYGrid};GraphLibraryGoogleChart.prototype.setTimePeriod=function(a){this.timePeriod=a};GraphLibraryGoogleChart.prototype.getTimePeriod=function(){return this.timePeriod};GraphLibraryGoogleChart.prototype.setVisualStylePieGraph=function(a){this.visualStylePieGraph=a};GraphLibraryGoogleChart.prototype.getVisualStylePieGraph=function(){return this.visualStylePieGraph};GraphLibraryGoogleChart.prototype.getChartObject=function(){return null};GraphLibraryGoogleChart.prototype.getImageMap=function(a){return""};GraphLibraryGoogleChart.prototype.setMainFrm=function(a){this.w=a};GraphLibraryGoogleChart.prototype.getMainFrm=function(){return this.w};GraphLibraryGoogleChart.prototype.UpdateGraphRS=function(d,a){this.xValues.Clear();this.xDataType="";for(var b=0;b<this.yValues.Count();b++){this.yValues[b].Clear()}for(var b=0;b<this.seriesDataType.length;b++){this.seriesDataType[b]=""}if(d.GetNumFields()<(this.series+1)){return AGraphSrv.DATAERROR}var e=d.getMetaData();this.xDataType=this.getChartDataType(IDCachedRowSetMetaData.GetSQLType(e.getColumnType(0)));for(var c=1;c<d.GetNumFields();c++){if(c>this.series){break}this.seriesDataType[c-1]=this.getChartDataType(IDCachedRowSetMetaData.GetSQLType(e.getColumnType(c+1)))}d.MoveFirst();while(!d.EOF()){this.xValues.Add(d.Get(1));for(var f=0;f<this.series;f++){this.yValues[f].Add(d.Get(f+2))}d.MoveNext()}return AGraphSrv.OK};GraphLibraryGoogleChart.prototype.UpdateGrahpIMDB=function(c,e,a){this.xValues.Clear();this.xDataType="";for(var b=0;b<this.yValues.Count();b++){this.yValues[b].Clear()}for(var b=0;b<this.seriesDataType.length;b++){this.seriesDataType[b]=""}if(c.TblNumField(e)<(this.series+1)){return AGraphSrv.DATAERROR}this.xDataType=this.getIMDBDataType(c.GetFldDataType(e,0));for(var d=0;d<this.series;d++){this.seriesDataType[d]=this.getIMDBDataType(c.GetFldDataType(e,d+1))}c.TblMoveFirst(e,0);while(!c.Eof(e,0)){this.xValues.Add(c.Value(e,0,0));for(var d=0;d<this.series;d++){this.yValues[d].Add(c.Value(e,d+1,0))}c.TblMoveNext(e,0)}return AGraphSrv.OK};GraphLibraryGoogleChart.prototype.drawGraph=function(d,e,a,f,c){if(d instanceof IDCachedRowSet){var b=d;c=f;f=a;a=e;this.width=a;this.heigth=f;this.UpdateGraphRS(b,this.ColLabels)}else{this.width=a;this.heigth=f;this.UpdateGrahpIMDB(d,e,this.ColLabels)}this.setGraphFile(this.CreateJS());return AGraphSrv.OK};GraphLibraryGoogleChart.prototype.CreateJS=function(){var A=(this.visualStyleGrafico!=-1)?this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico):null;var r="";r+='{"type": "'+this.getChartTypeName(this.tipoGrafico)+'"';r+=', "data": {';r+='"cols": [';r+='{"label": "'+this.asseXLabel+'", "type": "'+this.xDataType+'"}, ';for(var v=0;v<this.series;v++){r+='{"label":"'+this.ReplaceSpecialChars(this.ColLabels[v]).stringValue()+'"';r+=', "type": "'+this.seriesDataType[v]+'"}';if(this.seriesVisualStyle[v]!=-1){r+=', {"type": "string", "p":{"role":"style"}}'}if(this.mostraValori){r+=', {"type": "string", "p":{"role":"annotation"}}'}if(v!=this.series-1){r+=","}}r+="]";r+=', "rows": [';for(var u=0;u<this.xValues.length;u++){r+='{"c": [';if(this.xDataType=="string"){r+='{"v": "'+this.ReplaceSpecialChars(this.xValues[u]).stringValue()+'"},'}else{if(this.xDataType=="date"||this.xDataType=="datetime"||this.xDataType=="timeofday"){var y=this.xValues[u].dateValue();var z=y.getFullYear()+","+(y.getMonth()-1)+","+y.getDay()+","+y.getHours()+","+y.getMinutes()+","+y.getSeconds()+","+y.getMilliseconds();r+='{"v": "Date('+z+')"}'}else{r+='{"v": '+this.xValues[u]+"},"}}for(var q=0;q<this.series;q++){var t=this.yValues[q];if(this.seriesDataType[q]=="string"){r+='{"v": "'+this.ReplaceSpecialChars(t[u]).stringValue()+'"}'}else{if(this.seriesDataType[q]=="date"||this.seriesDataType[q]=="datetime"||this.seriesDataType[q]=="timeofday"){var y=this.xValues[u].dateValue();var z=y.getFullYear()+","+(y.getMonth()-1)+","+y.getDay()+","+y.getHours()+","+y.getMinutes()+","+y.getSeconds()+","+y.getMilliseconds();r+='{"v": "Date('+z+')"}'}else{r+='{"v": '+(t[u].toString().length==0?"null":t[u])+"}"}}if(this.seriesVisualStyle[q]!=-1){var o=this.w.VisualStyleList.VisualAttribute(this.seriesVisualStyle[q]);r+=',{"v": "stroke-color: '+Glb.GetWebColor(o.CBorColor(Glb.VISCBOR_TOP))+";";var e=Math.floor((((o.CBorWidth(Glb.VISCBOR_TOP))/4)/72)*96);if(e>5){e=5}r+="stroke-width:"+e+'"}'}if(this.mostraValori){r+=', {"v": "'+t[u]+'"}'}if(q<this.series-1){r+=","}}r+="]}";if(u<this.xValues.length-1){r+=","}}r+="]}, ";if(this.options){r+='"options": '+this.options}else{r+='"options": {';if(this.tipoGrafico==AGraphSrv.PIECHART||this.tipoGrafico==AGraphSrv.PIE3DCHART||this.tipoGrafico==AGraphSrv.RINGCHART||this.tipoGrafico==AGraphSrv.BUBBLECHART){var n=this.serieColors[0];if(n.Count()>0){r+='"colors":[';for(var u=0;u<this.xValues.length;u++){r+='"'+n[u%n.Count()]+'"';if(u<this.xValues.length-1){r+=","}}r+="],"}}r+='"series": [';for(var v=0;v<this.series;v++){r+="{";var B=false;if((this.graficoMisto||this.tipoGrafico==AGraphSrv.COMBOCHART)&&this.SeriesTypes[v]>-1){r+='"type": "'+this.getChartSeriesType(this.SeriesTypes[v])+'"';B=true}if(this.seriesVisualStyle[v]!=-1&&this.tipoGrafico!=AGraphSrv.PIECHART&&this.tipoGrafico!=AGraphSrv.PIE3DCHART&&this.tipoGrafico!=AGraphSrv.RINGCHART){var o=this.w.VisualStyleList.VisualAttribute(this.seriesVisualStyle[v]);var g=Glb.GetWebColor(o.Color(Glb.VISCLR_BACKVALUE));if(B){r+=","}r+='"color": "'+g+'"'}r+="}";if(v<this.series-1){r+=","}}r+="]";r+=',"title": "'+this.ReplaceSpecialChars(this.titolo)+'"';if(A!=null){var f=AGraphSrv.getFont(A.Font(Glb.VISFNT_HEAD));r+=',"titleTextStyle": {';r+='"fontName":"'+f.FontFamily+'"';r+=',"fontSize":'+f.Size;r+=',"color":"'+Glb.GetWebColor(A.Color(Glb.VISCLR_FOREHEAD))+'"';r+="}"}r+=',"hAxis": {';if(!this.asseXVisibile){r+='"textPosition": "none"'}else{r+='"title": "'+this.asseXLabel+'"';if(A!=null){r+=',"titleTextStyle": {';var k=AGraphSrv.getFont(A.Font(Glb.VISFNT_NOTNULL));r+='"fontName": "'+k.FontFamily+'"';r+=', "fontSize": '+k.Size;r+=', "color": "'+Glb.GetWebColor(A.Color(Glb.VISCLR_FOREHEADNN))+'"}'}if(!this.autoRangeX){r+=', "minValue":'+this.MinValueX;r+=', "maxValue":'+this.MaxValueX}r+=',"gridlines": {';if(!this.showXGrid){r+='"color": "transparent"'}else{if(A!=null){r+='"color" : "'+Glb.GetWebColor(A.CBorColor(Glb.VISCBOR_TOP))+'"';var b=Math.floor((((A.CBorWidth(Glb.VISCBOR_TOP))/4)/72)*96);if(b>5){b=5}r+=',"lineWidth" : '+b;r+=',"drawBorder" : '+(A.BorderType(Glb.VISBDI_VALUE)==Glb.VISBRD_NONE?"false":"true")}}r+="}";if(this.visualStyleAsseX!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseX);var l=Glb.VISFNT_VALUE;var c=Glb.VISCLR_FOREVALUE;var a=AGraphSrv.getFont(x.Font(l));r+=', "textStyle": {';r+='"fontName": "'+a.FontFamily+'",';r+='"fontSize": '+a.Size+",";r+='"color": "'+Glb.GetWebColor(x.Color(c))+'"';r+="}"}}r+="}";r+=',"vAxis": {';if(!this.asseYVisibile){r+='"textPosition": "none"'}else{r+='"title": "'+this.asseYLabel+'"';if(A!=null){r+=',"titleTextStyle": {';var k=AGraphSrv.getFont(A.Font(Glb.VISFNT_NOTNULL));r+='"fontName": "'+k.FontFamily+'"';r+=', "fontSize": '+k.Size;r+=', "color": "'+Glb.GetWebColor(A.Color(Glb.VISCLR_FOREHEADNN))+'"}'}if(!this.autoRangeY){r+=', "minValue":'+this.MinValueY;r+=', "maxValue":'+this.MaxValueY}r+=',"gridlines": {';if(!this.showYGrid){r+='"color": "transparent"'}else{if(A!=null){r+='"color" : "'+Glb.GetWebColor(A.CBorColor(Glb.VISCBOR_RIGHT))+'"';var b=Math.floor((((A.CBorWidth(Glb.VISCBOR_RIGHT))/4)/72)*96);if(b>5){b=5}r+=',"lineWidth" : '+b;r+=',"drawBorder" : '+(A.BorderType(Glb.VISBDI_VALUE)==Glb.VISBRD_NONE?"false":"true")}}r+="}";if(this.visualStyleAsseY!=-1){var x=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseY);var l=Glb.VISFNT_VALUE;var c=Glb.VISCLR_FOREVALUE;var a=AGraphSrv.getFont(x.Font(l));r+=', "textStyle": {';r+='"fontName": "'+a.FontFamily+'",';r+='"fontSize": '+a.Size+",";r+='"color": "'+Glb.GetWebColor(x.Color(c))+'"';r+="}"}}r+="}";r+=', "legend": {';r+='"position": "'+this.getLegendPositionName()+'"';if(this.posizioneLegenda==AGraphSrv.LEFT){r+=', "targetAxisIndex": 1'}if(A!=null){r+=', "textStyle" : {';var m=AGraphSrv.getFont(A.Font(Glb.VISFNT_GROUP));r+='"fontName" : "'+m.FontFamily+'"';r+=', "fontSize" : '+m.Size;r+=', "color" : "'+Glb.GetWebColor(A.Color(Glb.VISCLR_FOREGROUP))+'"';r+="}"}r+="}";if(this.tooltips){r+=', "tooltip" : {"trigger": "focus"}'}else{r+=', "tooltip" : {"trigger": "none"}'}if(A!=null){r+=', "chartArea": {';r+='"backgroundColor": {"fill": "'+Glb.GetWebColor(A.Color(Glb.VISCLR_BACKPANEL))+'"';r+="}}";r+=', "backgroundColor": {';r+='"fill" : "'+Glb.GetWebColor(A.Color(Glb.VISCLR_BACKHEAD))+'"';r+=', "stroke": "'+Glb.GetWebColor(A.Color(Glb.VISCLR_BORDERS))+'"';r+=', "strokeWidth": '+2;r+="}"}r+=',"isStacked":'+(this.stackedCharts?"true":"false");if(this.tipoGrafico==AGraphSrv.RINGCHART){var h=this.ringHole>-1?this.ringHole:0.4;r+=', "pieHole": '+h}if(this.tipoGrafico==AGraphSrv.PIE3DCHART){r+=', "is3D": true'}r+="}"}r+="}";return r};GraphLibraryGoogleChart.prototype.Render=function(a,b){};GraphLibraryGoogleChart.prototype.ReplaceSpecialChars=function(b){if(typeof b=="string"){b=new IDVariant(b)}var a=IDL.Replace(b,new IDVariant("'"),new IDVariant("&#39;"));a=IDL.Replace(a,new IDVariant("\\"),new IDVariant("\\\\"));a=IDL.Replace(a,new IDVariant('"'),new IDVariant('\\"'));return a};GraphLibraryGoogleChart.prototype.getChartTypeName=function(b){var a="";if(this.graficoMisto){a="ComboChart"}else{switch(b){case AGraphSrv.BARCHART:if(this.orientation==AGraphSrv.VERTICAL){a="ColumnChart"}else{a="BarChart"}break;case AGraphSrv.LINECHART:a="LineChart";break;case AGraphSrv.AREACHART:a="AreaChart";break;case AGraphSrv.BUBBLECHART:a="BubbleChart";break;case AGraphSrv.CALENDARCHART:a="Calendar";break;case AGraphSrv.CANDLESTICKCHART:a="CandlestickChart";break;case AGraphSrv.COMBOCHART:a="ComboChart";break;case AGraphSrv.RINGCHART:case AGraphSrv.PIECHART:case AGraphSrv.PIE3DCHART:a="PieChart";break;case AGraphSrv.SCATTERCHART:a="ScatterChart";break;case AGraphSrv.STEPPEDAREACHART:a="SteppedAreaChart";break;case AGraphSrv.TABLECHART:a="Table";break;case AGraphSrv.TIMELINECHART:a="Timeline";break;case AGraphSrv.TREEMAPCHART:a="TreeMap";break;case AGraphSrv.GAUGE:a="Gauge";break;case AGraphSrv.GEOCHART:a="GeoChart";break;case AGraphSrv.HISTOGRAM:a="Histogram";break;case AGraphSrv.ORGCHART:a="OrgChart";break}}return a};GraphLibraryGoogleChart.prototype.getChartTypeCode=function(a){if(a=="ColumnChart"){return AGraphSrv.BARCHART}if(a=="LineChart"){return AGraphSrv.LINECHART}if(a=="AreaChart"){return AGraphSrv.AREACHART}if(a=="BubbleChart"){return AGraphSrv.BUBBLECHART}if(a=="Calendar"){return AGraphSrv.CALENDARCHART}if(a=="CandlestickChart"){return AGraphSrv.CANDLESTICKCHART}if(a=="ComboChart"){return AGraphSrv.COMBOCHART}if(a=="PieChart"){return AGraphSrv.PIECHART}if(a=="ScatterChart"){return AGraphSrv.SCATTERCHART}if(a=="SteppedAreaChart"){return AGraphSrv.STEPPEDAREACHART}if(a=="Table"){return AGraphSrv.TABLECHART}if(a=="Timeline"){return AGraphSrv.TIMELINECHART}if(a=="TreeMap"){return AGraphSrv.TREEMAPCHART}if(a=="Gauge"){return AGraphSrv.GAUGE}if(a=="GeoChart"){return AGraphSrv.GEOCHART}if(a=="Histogram"){return AGraphSrv.HISTOGRAM}if(a=="OrgChart"){return AGraphSrv.ORGCHART}return -1};GraphLibraryGoogleChart.prototype.getChartSeriesType=function(a){var b="";switch(a){case AGraphSrv.LINECHART:b="line";break;case AGraphSrv.BARCHART:b="bars";break}return b};GraphLibraryGoogleChart.prototype.getChartDataType=function(b){var a="string";switch(b){case 2:case 4:case 8:a="number";break;case 93:a="datetime";break}return a};GraphLibraryGoogleChart.prototype.getLegendPositionName=function(){var a="none";switch(this.posizioneLegenda){case AGraphSrv.BOTTOM:a="bottom";break;case AGraphSrv.TOP:a="top";break;case AGraphSrv.RIGTH:a="right";break;case AGraphSrv.LEFT:a="left";break}return a};GraphLibraryGoogleChart.prototype.getIMDBDataType=function(b){var a="string";switch(b){case Glb.DT_NUM_INTEGER:case Glb.DT_NUM_FLOAT:case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:a="number";break;case Glb.DT_DATE:a="date";break;case Glb.DT_TIME:a="timeofday";break;case Glb.DT_DATETIME:a="datetime";break;case Glb.DT_BOOLEAN:a="boolean";break}return a};GraphLibraryGoogleChart.prototype.GraphOptions=function(){return this.options};GraphLibraryGoogleChart.prototype.set_GraphOptions=function(a){this.options=a};AIndicatorSrv.STYLE_TIME=6;AIndicatorSrv.STYLE_DATE=7;function AIndicatorSrv(){this.iGuid;this.IdxForm=0;this.Index;this.Width=0;this.Alignment;this.ToolTip;this.Style;this.Code;this.iAllowPWA;this.iEnabled=new Array(1);this.iVisible=new Array(1);this.iText=new Array(1);this.iImage=new Array(1);this.RD3Changed=false;this.RD3NewObj=false;this.RD3PropChg=new BitArray(RD3Glb.IND_MAXPROP);this.ClickEventDef=RD3Glb.EVENT_ACTIVE}AIndicatorSrv.prototype.bEnabled=function(a){return this.iEnabled[(this.iAllowPWA)?a:0]};AIndicatorSrv.prototype.set_bEnabled=function(c,a){this.iEnabled[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.IND_ENABLED)};AIndicatorSrv.prototype.bVisible=function(a){if(this.iAllowPWA){return this.iVisible[a]}else{if(this.IdxForm!=a&&this.IdxForm>0){return false}else{return this.iVisible[0]}}};AIndicatorSrv.prototype.set_bVisible=function(c,a){this.iVisible[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.IND_VISIBLE)};AIndicatorSrv.prototype.bText=function(a){return this.iText[(this.iAllowPWA)?a:0]};AIndicatorSrv.prototype.set_bText=function(c,a){this.iText[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.IND_TEXT)};AIndicatorSrv.prototype.bImage=function(a){return this.iImage[(this.iAllowPWA)?a:0]};AIndicatorSrv.prototype.set_bImage=function(c,a){this.iImage[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.IND_IMAGE)};AIndicatorSrv.prototype.set_AllowPWA=function(c,a){this.iAllowPWA=a;if(a){this.iEnabled=new Array(c.ParamsObj().MAX_FORMS+1);this.iVisible=new Array(c.ParamsObj().MAX_FORMS+1);this.iText=new Array(c.ParamsObj().MAX_FORMS+1);this.iImage=new Array(c.ParamsObj().MAX_FORMS+1)}};AIndicatorSrv.prototype.InitStatus=function(d,a,c){if(this.IdxForm==0){for(var b=0;b<this.iEnabled.length;b++){this.iEnabled[b]=d;this.iVisible[b]=a;this.iImage[b]=c;this.iText[b]=""}}else{if(this.iAllowPWA){this.iVisible[this.IdxForm]=a;this.iEnabled[this.IdxForm]=d;this.iImage[this.IdxForm]=c;this.iText[this.IdxForm]=""}else{this.iVisible[0]=a;this.iEnabled[0]=d;this.iImage[0]=c;this.iText[0]=""}}};AIndicatorSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};AIndicatorSrv.prototype.GetRD3Name=function(){return"ind"};AIndicatorSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};AIndicatorSrv.prototype.RD3RenderDifferences=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){d.SetAttribute("clk",this.ClickEventDef.toString())}}return c};AIndicatorSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.IND_IDXFORM:if(this.IdxForm==0&&b){break}c.SetAttribute("frm",this.IdxForm.toString());break;case RD3Glb.IND_WIDTH:if(this.Width==0&&b){break}c.SetAttribute("wid",this.Width.toString());break;case RD3Glb.IND_ALIGN:if(this.Alignment==Glb.VISALN_SX&&b){break}c.SetAttribute("ali",this.Alignment.toString());break;case RD3Glb.IND_TOOLTIP:if((this.ToolTip==null||this.ToolTip.equals(""))&&b){break}c.SetAttribute("tip",this.ToolTip);break;case RD3Glb.IND_STYLE:if(this.Style==-1&&b){break}c.SetAttribute("sty",this.Style.toString());break;case RD3Glb.IND_ENABLED:if(this.bEnabled(0)&&b){break}c.SetAttribute("ena",this.bEnabled(0)?"1":"0");break;case RD3Glb.IND_VISIBLE:if(this.bVisible(0)&&b){break}c.SetAttribute("vis",this.bVisible(0)?"1":"0");break;case RD3Glb.IND_TEXT:if((this.bText(0)==null||this.bText(0)=="")&&b){break}c.SetAttribute("cap",this.bText(0));break;case RD3Glb.IND_IMAGE:if((this.bImage(0)==null||this.bImage(0)=="")&&b){break}c.SetAttribute("img",this.bImage(0));break}};AMessageSrv.MSG_INFO=1;AMessageSrv.MSG_WARN=2;AMessageSrv.MSG_STOP=3;function AMessageSrv(){this.Source=null;this.SrcErr=null;this.Code="";this.Text="";this.Icon="";this.NumRow=0;this.Type=0;this.RIndex=Math.random();this.Parent=null;this.Activable=false;this.AutoDelete=true;this.RD3Rendered=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.MSG_MAXPROPS)}AMessageSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.RIndex};AMessageSrv.prototype.GetRD3Name=function(){return"msg"};AMessageSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};AMessageSrv.prototype.RD3RenderDifferences=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||c){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){}this.RD3Rendered=true;return c};AMessageSrv.prototype.SetRD3Property=function(c,f,e){switch(c){case RD3Glb.MSG_CODE:if(this.Code.length==0&&e){break}f.SetAttribute("cod",this.Code);break;case RD3Glb.MSG_TEXT:if(this.Text.length==0){f.SetAttribute("txt","")}else{var b="<b>";if(this.Source instanceof PFieldSrv){var a=this.Source;var d=a.Parent.Parent.Frames[a.Parent.FrIndex];if(d.InTabbed||d.IsSubFrame){b+=d.Caption+" - "}if(a.Page!=-1){b+=a.Parent.Pages[a.Page].Header+" - "}}if(this.Source instanceof DOMDProp){b+=this.Source.UIName}else{b+=(this.Source.ToString?this.Source.ToString():Source)}if(this.NumRow>0){b+=" [";b+=IDL.FormatMessage(new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB","Riga |1")),new IDVariant(this.NumRow)).stringValue();b+="]"}b+=":</b> ";b+=this.Text;f.SetAttribute("txt",b)}break;case RD3Glb.MSG_ICON:if(this.Icon.length==0&&e){break}f.SetAttribute("img",this.Icon);break;case RD3Glb.MSG_TYPE:if(this.Type==3&&e){break}f.SetAttribute("typ",this.Type.toString());break;case RD3Glb.MSG_TEMPORARY:if(this.AutoDelete&&e){break}f.SetAttribute("tem",this.AutoDelete?"1":"0");break}};function RoleItemsSrv(){this.iForm;this.PObj;this.RObj;this.Type;this.Flags;this.oGuid="";this.fGuid=""}function ARoleSrv(){this.Items=new Array();this.Parent;this.Code;this.iGuid}ARoleSrv.prototype.SetItemCount=function(b){if(b>0){this.Items=new Array(b+1);for(var a=1;a<this.Items.length;a++){this.Items[a]=new RoleItemsSrv()}}};ARoleSrv.prototype.SetItem=function(g,d,e,b,a,c){this.Items[g].PObj=e;this.Items[g].iForm=d;this.Items[g].RObj=b;this.Items[g].Type=a;this.Items[g].Flags=c};ARoleSrv.prototype.Apply=function(d,c,h){var l=new ArrayList();var k=(d==0?"MainFrm":c.Caption().ToString());h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",117,"ARole.Apply","Applying role "+this.Code.ToString()+" to form "+k);for(var f=0;f<this.Items.length;f++){if(this.Items[f]==null){continue}if(d>0&&this.Items[f].fGuid.length>0){if(c.RTCGuid.equals(this.Items[f].fGuid)){this.Items[f].iForm=c.FormIdx;this.Items[f].fGuid=""}}if(d>65535){d=d%65536}if(this.Items[f].iForm==d){switch(this.Items[f].Type){case Glb.ROI_COMMAND:if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=1;e<h.CmdObj.CmdLin.length;e++){if(this.Items[f].oGuid.equals(h.CmdObj.CmdLin[e].iGuid)){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Command "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Command "+h.CmdObj.CmdLin[this.Items[f].RObj].Caption,this.DecodeFlags(this.Items[f].Flags,false));h.CmdObj.CommandApplyRole(this.Items[f].RObj,(this.Items[f].Flags&Glb.OBJ_ENABLED)!=0,(this.Items[f].Flags&Glb.OBJ_VISIBLE)!=0)}break;case Glb.ROI_CMDSET:if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=1;e<h.CmdObj.CmdSets.length;e++){if(!h.CmdObj.CmdSets[e]){continue}if(this.Items[f].oGuid.equals(h.CmdObj.CmdSets[e].iGuid)){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Command Set "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Command set "+h.CmdObj.CmdSets[this.Items[f].RObj].Caption,this.DecodeFlags(this.Items[f].Flags,false));h.CmdObj.CmdSetApplyRole(this.Items[f].RObj,(this.Items[f].Flags&Glb.OBJ_ENABLED)!=0,(this.Items[f].Flags&Glb.OBJ_VISIBLE)!=0)}break;case Glb.ROI_PFIELD:var a=this.SearchObject(this.Items[f].PObj,c);if(a!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=0;e<a.UFields();e++){if(this.Items[f].oGuid.equals(a.GetRTCGuid(Glb.OBJ_FIELD,e))){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Panel Field "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Panel field "+a.bFields(this.Items[f].RObj).GetDTTCaption(),this.DecodeFlags(this.Items[f].Flags,false));a.SetRoleFlags(Glb.OBJ_FIELD,this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Panel "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_PPAGE:var a=this.SearchObject(this.Items[f].PObj,c);if(a!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=0;e<a.UPages();e++){if(this.Items[f].oGuid.equals(a.GetRTCGuid(Glb.OBJ_PAGE,e))){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Panel Page "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Panel page "+a.bPages(this.Items[f].RObj).Header,this.DecodeFlags(this.Items[f].Flags,false));a.SetRoleFlags(Glb.OBJ_PAGE,this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Panel "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_PGROUP:var a=this.SearchObject(this.Items[f].PObj,c);if(a!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=0;e<a.UGroups();e++){if(this.Items[f].oGuid.equals(a.GetRTCGuid(Glb.OBJ_GROUP,e))){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Panel Group "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Panel group "+a.bGroups(this.Items[f].RObj).Header,this.DecodeFlags(this.Items[f].Flags,false));a.SetRoleFlags(Glb.OBJ_GROUP,this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Panel "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_PANEL:var a=this.SearchObject(this.Items[f].PObj,c);if(a!=null){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Panel "+a.GetDTTCaption(),this.DecodeFlags(this.Items[f].Flags,true));a.SetRoleFlags(Glb.OBJ_PANEL,0,this.Items[f].Flags,Glb.PAN_CANSELECT|Glb.PAN_CANUPDATE|Glb.PAN_CANDELETE|Glb.PAN_CANINSERT|Glb.OBJ_VISIBLE)}else{l.Add("Panel "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_TREEITEM:var n=this.SearchObject(this.Items[f].PObj,c);if(n!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=1;e<n.ItemList.length;e++){if(this.Items[f].oGuid.equals(n.GetItem(e).iGuid)){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Tree Item "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Tree item "+n.GetItem(this.Items[f].RObj).Name,this.DecodeFlags(this.Items[f].Flags,false));n.SetRoleFlags(this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Tree "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_QRYWL:h.QwlRoles[this.Items[f].PObj]=this.Items[f].iForm;break;case Glb.ROI_REPORT:case Glb.ROI_SECTION:case Glb.ROI_RPTBOX:case Glb.ROI_RPTSPAN:var m=c.SearchBook(this.Items[f].PObj);if(m!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=1;e<=m.GetNumObjects();e++){if(m.GetRTCGuid(e).equals(this.Items[f].oGuid)){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Object "+this.Items[f].oGuid+" not found in book "+m.GetName())}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){switch(this.Items[f].Type){case Glb.ROI_REPORT:h.DTTObj.AddParameter("",this.Items[f].fGuid,"Book report "+m.GetName()+"."+this.Items[f].RObj,this.DecodeFlags(this.Items[f].Flags,false));break;case Glb.ROI_SECTION:h.DTTObj.AddParameter("",this.Items[f].fGuid,"Book section "+m.GetName()+"."+this.Items[f].RObj,this.DecodeFlags(this.Items[f].Flags,false));break;case Glb.ROI_RPTBOX:h.DTTObj.AddParameter("",this.Items[f].fGuid,"Book box "+m.GetName()+"."+this.Items[f].RObj,this.DecodeFlags(this.Items[f].Flags,false));break;case Glb.ROI_RPTSPAN:h.DTTObj.AddParameter("",this.Items[f].fGuid,"Book span "+m.GetName()+"."+this.Items[f].RObj,this.DecodeFlags(this.Items[f].Flags,false));break}m.SetRoleFlags(this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Book "+this.Items[f].PObj+" not found in the form "+k)}break}}}if(l.Count>0){for(f=0;f<l.Count();f++){var g=l[f];h.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",118,"ARole.Apply","Role "+this.Code.ToString()+": "+g)}}};ARoleSrv.prototype.SearchObject=function(e,d){for(var a=1;a<d.Frames.length;a++){var b=d.Frames[a];if(b.Content!=null){var c=b.Content.SearchObject(e);if(c!=null){return c}}}return null};ARoleSrv.prototype.AddRTCItem=function(f,h,e,c,g){var b=new Array(this.Items.length+1);for(var a=0;a<this.Items.length;a++){b[a]=this.Items[a]}this.Items=b;var d=new RoleItemsSrv();this.Items[this.Items.length-1]=d;d.fGuid=h;d.oGuid=f;d.Type=c;d.Flags=g;d.PObj=e;if(d.fGuid.length>0){d.iForm=-1}if(d.Type==Glb.ROI_QRYWL){d.iForm=0;d.PObj=d.oGuid}};ARoleSrv.prototype.DecodeFlags=function(c,a){var b="";if(!a){if((c&Glb.OBJ_ENABLED)>0){b="Enabled "}else{b="Disabled "}if((c&Glb.OBJ_VISIBLE)>0){b+="Visible"}else{b+="Hidden"}}else{if((c&Glb.PAN_CANSELECT)>0){b+="CanSelect "}if((c&Glb.PAN_CANUPDATE)>0){b+="CanUpdate "}if((c&Glb.PAN_CANDELETE)>0){b+="CanDelete "}if((c&Glb.PAN_CANINSERT)>0){b+="CanInsert "}b+=((c&Glb.OBJ_VISIBLE)>0?"Visible":"Hidden")}return new IDVariant(b)};function ASubFormSrv(a){WebFrameSrv.call(this,a);this.pSubForm=null;this.pCustomElem=null;this.SubFormChanged=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.SUF_MAXPROPS)}ASubFormSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];ASubFormSrv[obj]=WebFrameSrv[obj]}ASubFormSrv.prototype.Init=function(a,b){if(a instanceof WebFormSrv){this.pSubForm=a;this.pSubForm.ParentSuf=this;if(this.pSubForm.Frames==null){this.pSubForm.SetSubMainFrm(b,b.IMDB)}}else{if(a instanceof CustomElement){this.pCustomElem=a}}};ASubFormSrv.prototype.set_Flags=function(a){};ASubFormSrv.prototype.set_Height=function(a){if(this.Height!=a){this.RD3Change(RD3Glb.SUF_HEIGHT);WebFrameSrv.prototype.set_Height.call(this,a);if(this.pSubForm!=null){this.pSubForm.Resize(this.Width,this.Height)}}};ASubFormSrv.prototype.set_Width=function(a){if(this.Width!=a){this.RD3Change(RD3Glb.SUF_WIDTH);WebFrameSrv.prototype.set_Width.call(this,a);if(this.pSubForm!=null){this.pSubForm.Resize(this.Width,this.Height)}}};ASubFormSrv.prototype.SendMessage=function(f,e,d,c,b,h,g){if(d==undefined){d=null}if(c==undefined){c=new IDVariant()}if(b==undefined){b=new IDVariant()}if(h==undefined){h=new IDVariant()}if(g==undefined){g=new IDVariant()}var a=null;if(e!=null&&e instanceof WebFormSrv){a=e}if(this.pSubForm!=null){this.pSubForm.OnSendMessage(f,a,d,c,b,h,g)}};ASubFormSrv.prototype.GetIntForm=function(){return this.pSubForm};ASubFormSrv.prototype.SetIntForm=function(a){if(a!=this.pSubForm){if(a!=null){this.Init(a,a.MainFrm)}else{this.pSubForm=null}this.SubFormChanged=true}};ASubFormSrv.prototype.GetCustomElem=function(){return this.pCustomElem};ASubFormSrv.prototype.GetRD3Name=function(){return"suf"};ASubFormSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ASubFormSrv.prototype.RD3RenderDifferences=function(g,d,f){var e=false;var a=WebFrameSrv.prototype.RD3RenderDifferences.call(this,g,d,f);if(g==null){g=a}e|=(a!=null);if(g==null&&(this.RD3Changed||this.SubFormChanged)){g=d.AddNewElement("chg");g.SetAttribute("id",this.GetRD3Ident());a=g}if(f||this.RD3Changed){for(var c=0;c<this.RD3PropChg.length;c++){if(this.RD3PropChg[c]||f){this.SetRD3Property(c,g,f)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(this.SubFormChanged){f=true;this.SubFormChanged=false;g.SetAttribute("csf",(this.pSubForm!=null?"1":"0"));e=true}var b=(f?g:d);if(this.pSubForm!=null){e|=this.pSubForm.RD3RenderDifferences(b,f)}else{if(this.pCustomElem!=null){this.pCustomElem.RD3RenderDifferences(b,f)}}return e?a:null};ASubFormSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.SUF_HEIGHT:c.SetAttribute("suh",this.Height.toString());break;case RD3Glb.SUF_WIDTH:c.SetAttribute("suw",this.Width.toString());break}};ASubFormSrv.prototype.RD3Resize=function(a,c,b){this.Height=c;this.Width=a;this.RD3Change(RD3Glb.SUF_HEIGHT);this.RD3Change(RD3Glb.SUF_WIDTH);WebFrameSrv.prototype.RD3Resize.call(this,a,c,b);if(this.pSubForm!=null){this.pSubForm.Resize(this.Width,this.Height)}};ASubFormSrv.prototype.RD3EndRequest=function(){if(this.pSubForm!=null){var b=this.Parent;while(b!=null&&b.ParentSuf!=null&&b.ParentSuf.Parent!=null){b=b.ParentSuf.Parent}for(var a=0;a<this.pSubForm.Frames.length;a++){if(this.pSubForm.Frames[a]!=null&&this.pSubForm.Frames[a].Content!=null){if(b==this.MainFrm.ActiveForm()&&this.pSubForm.Frames[a].Content instanceof IDPanelSrv){this.pSubForm.Frames[a].Content.RD3Validate=true}this.pSubForm.Frames[a].Content.RD3EndRequest()}}}};function ATimerSrv(){this.IdxForm=0;this.Index;this.Code;this.iGuid;this.NumTicks;this.AttTicks;this.Interval;this.MilliSec=0;this.LastMilliSec;this.LastTick;this.NextTick;this.InitialEnabled=false;this.ServerSession=false;this.iEnabled=false;this.iPermanent=false;this.iActive=false;this.RD3Changed=false;this.RD3NewObj=false;this.RD3PropChg=new BitArray(RD3Glb.TIM_MAXPROP);this.TickEventDef=RD3Glb.EVENT_ACTIVE}ATimerSrv.prototype.Active=function(){return this.iActive};ATimerSrv.prototype.set_Active=function(a){if(this.iActive!=a){this.RD3Change(RD3Glb.TIM_ENABLED)}this.iActive=a;if(a&&this.InitialEnabled){this.set_bEnabled(true)}};ATimerSrv.prototype.bEnabled=function(){return this.iEnabled&&this.Active()};ATimerSrv.prototype.set_bEnabled=function(a){if(this.iEnabled!=a){this.RD3Change(RD3Glb.TIM_ENABLED)}this.iEnabled=a;if(this.iEnabled&&this.AttTicks==0&&this.NumTicks>0){this.AttTicks=this.NumTicks}if(this.iEnabled&&!this.iPermanent){this.LastMilliSec=(new Date()).getTime();this.LastTick=this.LastMilliSec;this.NextTick=this.LastMilliSec+1000*this.Interval}};ATimerSrv.prototype.bPermanent=function(){return this.iPermanent};ATimerSrv.prototype.set_bPermanent=function(a){this.iPermanent=a};ATimerSrv.prototype.Tick=function(b){var a;var c=false;var e=null;if(!this.iActive||!this.iEnabled){return}if(this.Interval==0){a=(new Date()).getTime();if(a-this.LastMilliSec>this.MilliSec){this.LastMilliSec=a;c=true;if(this.IdxForm>0){e=b.GetForm(this.IdxForm,0,false)}b.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,34,"ATimer.Tick","Timer "+this.Code+" expired");if(e==null){b.TimerTickCB(this.Index)}else{e.TimerTickCB(this.Index)}}}else{var d=(new Date()).getTime();if(d>this.NextTick){this.LastTick=d;if(this.NextTick==0){this.NextTick=d}while(this.NextTick<=d){this.NextTick+=1000*this.Interval}c=true;if(this.IdxForm>0){e=b.GetForm(this.IdxForm,0,false)}if(e==null){b.TimerTickCB(this.Index)}else{e.TimerTickCB(this.Index)}}}if(c){this.AttTicks--;if(this.AttTicks==0){this.set_bEnabled(false)}}};ATimerSrv.prototype.CopyFrom=function(a){this.IdxForm=a.IdxForm;this.Index=a.Index;this.Code=a.Code;this.iGuid=a.iGuid;this.NumTicks=a.NumTicks;this.AttTicks=a.AttTicks;this.Interval=a.Interval;this.MilliSec=a.MilliSec;this.LastMilliSec=a.LastMilliSec;this.LastTick=a.LastTick;this.NextTick=a.NextTick;this.InitialEnabled=a.InitialEnabled;this.ServerSession=a.ServerSession;this.iEnabled=a.iEnabled;this.iPermanent=a.iPermanent;this.iActive=a.iActive};ATimerSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};ATimerSrv.prototype.GetRD3Name=function(){return"tim"};ATimerSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ATimerSrv.prototype.RD3Tick=function(a){var b=null;if(!this.iActive||!this.iEnabled){return}if(this.IdxForm>0){b=a.GetFormByIndex(this.IdxForm,a.GetLiveForms())}if(b==null){a.TimerTickCB(this.Index)}else{b.TimerTickCB(this.Index)}};ATimerSrv.prototype.RD3RenderDifferences=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.TickEventDef!=RD3Glb.EVENT_ACTIVE){d.SetAttribute("tke",this.TickEventDef.toString())}}return c};ATimerSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.TIM_IDXFORM:if(this.IdxForm==0&&b){break}c.SetAttribute("frm",this.IdxForm.toString());break;case RD3Glb.TIM_NUMTICKS:if(this.NumTicks==0&&b){break}c.SetAttribute("num",this.NumTicks.toString());break;case RD3Glb.TIM_INTERVAL:if(this.MilliSec==0){c.SetAttribute("int",(this.Interval*1000).toString())}else{c.SetAttribute("int",this.MilliSec.toString())}break;case RD3Glb.TIM_ENABLED:if(!this.bEnabled()&&b){break}c.SetAttribute("ena",this.bEnabled()?"1":"0");break}};function ATreeItemSrv(){this.ItemList=new Array(0);this.QueryObj;this.QueryList=new HashTableSrv();this.iCN;this.iSQL;this.iIMDBTable=-1;this.iSeq=0;this.Parent;this.Derived;this.Tooltip="";this.Name="";this.HasTooltip;this.Image="";this.ItemIndex;this.RoleFlags=-1;this.iGuid;this.iQueryGuid;this.TreeObj;this.PKColumns=new ArrayList();this.HashKey="";this.ClassName}ATreeItemSrv.prototype.SetItemCount=function(b){this.ItemList=new Array(b+1);for(var a=1;a<this.ItemList.length;a++){this.ItemList[a]=new ATreeItemSrv()}};ATreeItemSrv.prototype.SetItem=function(b,a){this.ItemList[b]=a};ATreeItemSrv.prototype.SetQuery=function(d,a,b,c){this.iSQL=d;this.iCN=a;this.iQueryGuid=c;if(this.QueryObj!=null){this.QueryObj.SetQuery(d,a,b)}};ATreeItemSrv.prototype.AddPK=function(a){this.PKColumns.Add(a)};ATreeItemSrv.prototype.SetIMDBTable=function(a){this.iIMDBTable=a};ATreeItemSrv.prototype.HasQuery=function(){return this.iIMDBTable!=-1};ATreeItemSrv.prototype.UpdateItem=function(g,h,e){if((this.RoleFlags&Glb.OBJ_VISIBLE)==0){g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,110,"ATreeItem.UpdateItem","Can't update (item invisible for current role)");return}if(!this.HasQuery()){var j=this.ItemIndex+this.iSeq;var a=this.TreeObj.GetNode(j);if(a!=null){if(a.Parent!=h){a=null}}if(a==null){this.iSeq=this.iSeq+1;j=this.ItemIndex+this.iSeq;a=new ATreeNodeSrv();a.Key=j;a.Image=this.Image;if(h==null){a.HashKey=this.HashKey}else{a.HashKey=h.HashKey+this.HashKey}a.Name=this.Name;a.Tooltip=this.Tooltip;a.CanBeChecked=true;a.TreeObj=this.TreeObj;a.Parent=h;a.AlreadyExpanded=!(this.ItemList.length>0||this.Derived!=null);this.TreeObj.AddNode(a)}else{if(e){if(a.AlreadyExpanded){a.RemoveChildren();for(var c=1;c<this.ItemList.length;c++){this.ItemList[c].UpdateItem(g,a,true)}}}}}else{var b=false;this.GetQuery(h,g);if(!this.QueryObj.RS.IsOpen()){b=true}var f=this.QueryObj.UpdateParam(g,e||b);b=b||f;if(b){if(h==null){var d=new ArrayList();for(var c=0;c<this.TreeObj.Nodes.Count();c++){var a=this.TreeObj.Nodes[c];if(a.Key.substr(0,6).equals(this.ItemIndex)){d.Add(a)}}for(var c=0;c<d.Count();c++){var a=d[c];this.TreeObj.RemoveNode(a)}}this.FillTree(g,h)}}};ATreeItemSrv.prototype.FillTree=function(f,g){if(this.QueryObj.FindData(f,"Tree item "+this.Name)){try{while(!this.QueryObj.RS.EOF()){this.iSeq=this.iSeq+1;var k=this.ItemIndex+this.iSeq;var b=new ATreeNodeSrv();b.Key=k;b.Tag=this.QueryObj.RS.BookMark();b.AlreadyExpanded=!(this.ItemList.length>0||this.Derived!=null);b.Name=this.QueryObj.RS.Get(1).stringValue();b.Image=this.Image;b.CanBeChecked=true;b.Parent=g;b.TreeObj=this.TreeObj;b.ClassName=this.ClassName;if(this.HasTooltip){b.Tooltip=this.QueryObj.RS.Get(this.QueryObj.RS.GetNumFields()).stringValue()}if(this.QueryObj.RS.findColumn("ICON")!=-1){var j=this.QueryObj.RS.Get("ICON").stringValue();if(j.length>0){b.Image=j}}b.HashKey="";if(this.QueryObj.RS.findColumn("HASH")!=-1){var l=this.QueryObj.RS.Get("HASH").stringValue();if(l.length>0){b.HashKey=l}}if(this.QueryObj.RS.findColumn("CANCHECK")!=-1){var a=this.QueryObj.RS.Get("CANCHECK");b.CanBeChecked=(a.intValue()!=0)}if(b.HashKey.equals("")){b.HashKey=this.QueryObj.GetHashKey(this.PKColumns)}if(this.QueryObj.RS.findColumn("BADGE")!=-1){var c=this.QueryObj.RS.Get("BADGE").stringValue();if(c.length>0){b.Badge=c}}if(this.QueryObj.RS.findColumn("CLASSNAME")!=-1){var h=this.QueryObj.RS.Get("CLASSNAME").stringValue();if(h.length>0){b.ClassName=h}}this.TreeObj.AddNode(b);this.QueryObj.RS.MoveNext()}}catch(d){}}};ATreeItemSrv.prototype.Expand=function(a,c){if(c.AlreadyExpanded){return}this.SetIMDB(c,a);for(var b=1;b<this.ItemList.length;b++){this.ItemList[b].UpdateItem(a,c,false)}if(this.Derived!=null){this.UpdateItem(a,c,false)}};ATreeItemSrv.prototype.SetIMDB=function(d,a){if(this.HasQuery()){this.GetQuery(d.Parent,a);try{this.QueryObj.RS.absolute(d.Tag);this.QueryObj.SelectRow(this.QueryObj.RS.BookMark(),this.TreeObj.Parent.IMDB,a)}catch(c){}if(this.Derived!=null){if(this.Derived.Parent!=null){var b=d.Parent;while(!b.Key.substr(0,6).equals(this.Derived.Parent.ItemIndex)){b=b.Parent;if(b==null){break}}if(b!=null){this.Derived.Parent.SetIMDB(b,a)}}}else{if(this.Parent!=null){this.Parent.SetIMDB(d.Parent,a)}}}};ATreeItemSrv.prototype.GetQuery=function(c,b){var a=".";if(c!=null){a=c.Key}this.QueryObj=null;this.QueryObj=this.QueryList[a];if(this.QueryObj==null){this.QueryObj=new ADynQuerySrv(this.TreeObj);this.QueryObj.SetQuery(this.iSQL,this.iCN,b);this.QueryObj.iGuid=this.iQueryGuid;this.QueryObj.IMDBTable=this.iIMDBTable;this.QueryList[a]=this.QueryObj}};function ATreeNodeSrv(){this.Key;this.AlreadyExpanded=false;this.Expanded=false;this.Name;this.Tooltip="";this.Image;this.Parent=null;this.Nodes=null;this.Tag=0;this.TreeObj=null;this.HashKey;this.Doc=null;this.ColIdx=0;this.CanBeChecked=true;this.UpdateCount=0;this.ChildrenUpdCount=0;this.iSelected=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TRN_MAXPROPS);this.RD3ResendNodes=false;this.Badge="";this.ClassName}ATreeNodeSrv.prototype.Selected=function(){if(this.Doc!=null){return this.Doc.Selected()}else{return this.iSelected}};ATreeNodeSrv.prototype.set_Selected=function(a){if(this.iSelected!=a){this.iSelected=a;if(this.Doc!=null){this.Doc.set_Selected(a)}this.RD3Change(RD3Glb.TRN_SELECTED)}};ATreeNodeSrv.prototype.AddNode=function(a){if(this.Nodes==null){this.Nodes=new ArrayList()}this.Nodes.Add(a);this.TreeObj.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true};ATreeNodeSrv.prototype.RemoveChildren=function(){if(this.Nodes==null){return}for(var a=0;a<this.Nodes.Count();a++){var b=this.Nodes[a];this.TreeObj.RemoveNode(b)}this.Nodes.Clear();this.Nodes=null;this.TreeObj.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true};ATreeNodeSrv.prototype.ToggleExpansion=function(a,b){if(b==undefined){b=false}if(!this.AlreadyExpanded){this.TreeObj.Expand(a,this);this.RD3Change(RD3Glb.TRN_ALREADYEXPANDED)}else{this.Expanded=!this.Expanded;if(b&&this.TreeObj.ActivateOnExpand){this.TreeObj.FireNodeClick(this,a)}}this.DOUpdateIcon();this.RD3Change(RD3Glb.TRN_EXPANDED)};ATreeNodeSrv.prototype.DTTTrace=function(a,c,d){if(d){var b="L="+c+(this.TreeObj.SelectedNode==this?" S=1":"");a.DTTObj.AddTraceToken("",DTTEngine.TRC_TREENODE,"Tree.Node",this.Name+(this.Selected()?" (Selected)":""),b)}};ATreeNodeSrv.prototype.SetDocument=function(a){this.Doc=a;a.set_UIBound(true);this.UpdateCount=-1;this.DOUpdateNode(null)};ATreeNodeSrv.prototype.DOUpdateNode=function(h){var m=null;if(this.Parent!=null){m=this.Parent.Doc}if(this.Doc!=null){if(this.UpdateCount!=this.Doc.UpdateCount()){var o=null;if(this.ColIdx>0){o=this.Parent.Doc.GetCollByIndex(this.ColIdx)}this.Name=this.Doc.GetName(0,o,this.TreeObj.Parent.FormIdx&65535,this.TreeObj.FrIndex);this.Image=this.Doc.GetIcon(0,o,this.TreeObj.Parent.FormIdx&65535,this.TreeObj.FrIndex);this.Tooltip=this.Doc.GetTooltip(0,o,this.TreeObj.Parent.FormIdx&65535,this.TreeObj.FrIndex);this.Badge=this.Doc.GetNamedPropertyValue("BADGE").stringValue();this.RD3Change(RD3Glb.TRN_CAPTION);this.RD3Change(RD3Glb.TRN_IMAGE);this.RD3Change(RD3Glb.TRN_TOOLTIP);this.RD3Change(RD3Glb.TRN_SELECTED);this.RD3Change(RD3Glb.TRN_BADGE);this.RD3Change(RD3Glb.TRN_CLASSNAME);this.UpdateCount=this.Doc.UpdateCount()}if(this.AlreadyExpanded){var d=this.Doc.GetMD();var e=0;for(var g=1;g<=d.GetNumColl();g++){var b=this.Doc.GetCollByIndex(g);if(b.Visible()){b.set_UIBound(true);e+=b.UpdateCount()}}if(this.Nodes!=null){for(var g=0;g<this.Nodes.Count();g++){var a=this.Nodes[g];if(a.Doc!=null&&a.Doc.Deleted()){e=-1;break}}}else{for(var g=1;g<=d.GetNumColl();g++){var b=this.Doc.GetCollByIndex(g);if(b.Visible()){b.set_UIMode(true);var k=b.Count();b.set_UIMode(false);if(k>0){this.AlreadyExpanded=false;this.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);break}}}}if(e!=this.ChildrenUpdCount&&h!=null){var j=false;for(var g=0;g<h.Count();g++){var a=this.NodesToRefresh[g];if(this.IsParent(a)){j=true;break}}if(!j){h.Add(this)}}return true}}return false};ATreeNodeSrv.prototype.DOClick=function(){if(this.Doc!=null){this.Doc.OnClick()}};ATreeNodeSrv.prototype.DOExpand=function(){if(this.Doc!=null&&!this.AlreadyExpanded){this.AlreadyExpanded=true;this.Expanded=true;this.Doc.OnExpand();var f=this.Doc.GetMD();this.ChildrenUpdCount=0;for(var a=1;a<=f.GetNumColl();a++){var j=this.Doc.GetCollByIndex(a);if(j.Visible()){if(j.Parent()!=null&&!j.Parent().Inserted()){try{j.Parent().LoadCollectionDirect(j,0,true)}catch(b){this.TreeObj.MainFrm.DTTObj.AddException(this.TreeObj.iGuid,"ATreeNode.DOExpand","Tree "+this.TreeObj.Code+": Can't DO expand node",b)}}j.set_UIBound(true);j.set_UIMode(true);j.MoveFirst();this.ChildrenUpdCount+=j.UpdateCount();while(!j.IsEof()){var g=j.GetAt();var h=this.TreeObj.DOCreateRootNode(g,this,a);if(h!=null){h.AlreadyExpanded=!g.MayHaveChildren()}j.MoveNext()}j.set_UIMode(false)}}this.DOUpdateIcon();this.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);this.RD3Change(RD3Glb.TRN_EXPANDED)}};ATreeNodeSrv.prototype.IsParent=function(b){var a=this;while(a!=null){a=a.Parent;if(a==b){return true}}return false};ATreeNodeSrv.prototype.DOUpdateIcon=function(){if(this.Doc!=null){var a=null;if(this.ColIdx>0){a=this.Parent.Doc.GetCollByIndex(this.ColIdx)}var b=this.Image;this.Image=this.Doc.GetIcon((this.Expanded?1:0),a,this.TreeObj.Parent.FormIdx&65535,this.TreeObj.FrIndex);if(!(new IDVariant(b)).equals(new IDVariant(this.Image),true)){this.RD3Change(RD3Glb.TRN_IMAGE)}}};ATreeNodeSrv.prototype.GetRD3Name=function(){return"trn"};ATreeNodeSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Key+":"+this.TreeObj.FrIndex+":"+this.TreeObj.Parent.FormIdx};ATreeNodeSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ATreeNodeSrv.prototype.isRD3Changed=function(a){return this.RD3PropChg[a]};ATreeNodeSrv.prototype.RD3RenderDifference=function(d,g,h,e){this.DTTTrace(this.TreeObj.MainFrm,h,e);var j=(this.RD3PropChg[RD3Glb.TRN_ALREADYEXPANDED]&&this.AlreadyExpanded)||this.RD3ResendNodes;var a=null;if(g){a=d.AddNewElement(this.GetRD3Name())}if(a==null&&(this.RD3Changed||j)){a=d.AddNewElement("chg")}if(a!=null){a.SetAttribute("id",this.GetRD3Ident())}var f=this.RD3Changed;if(g||this.RD3Changed){for(var c=0;c<this.RD3PropChg.length;c++){if(this.RD3PropChg[c]||g){this.SetRD3Property(c,a,g)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(this.Nodes!=null){var b=(g||j)?a:d;for(var c=0;c<this.Nodes.Count();c++){f|=this.Nodes[c].RD3RenderDifference(b,g||j,h+1,e)}}this.RD3ResendNodes=false;return f};ATreeNodeSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.TRN_ALREADYEXPANDED:if(this.AlreadyExpanded==false&&b){break}c.SetAttribute("aex",this.AlreadyExpanded?"1":"0");break;case RD3Glb.TRN_EXPANDED:if(this.Expanded==false&&b){break}c.SetAttribute("exp",this.Expanded?"1":"0");break;case RD3Glb.TRN_CAPTION:if(this.Name==""&&b){break}c.SetAttribute("cap",this.Name);break;case RD3Glb.TRN_TOOLTIP:if(this.Tooltip==""&&b){break}c.SetAttribute("tip",this.Tooltip);break;case RD3Glb.TRN_IMAGE:if(this.Image==""&&b){break}c.SetAttribute("img",this.Image);break;case RD3Glb.TRN_CANCHECK:if(this.CanBeChecked==true&&b){break}c.SetAttribute("cch",this.CanBeChecked?"1":"0");break;case RD3Glb.TRN_SELECTED:if(!this.Selected()&&b){break}c.SetAttribute("sel",this.Selected()?"1":"0");break;case RD3Glb.TRN_BADGE:if(this.Badge==""&&b){break}c.SetAttribute("bdg",this.Badge);break;case RD3Glb.TRN_CLASSNAME:if((this.ClassName==null||this.ClassName.length==0)&&b){break}c.SetAttribute("cln",(this.ClassName==null)?"":this.ClassName);break}};function ATreeSrv(a){WebFrameSrv.call(this,a);this.ItemList;this.Nodes=new ArrayList();this.SelectedNode;this.iCollapsed=false;this.iEnabled=false;this.IsDO=false;this.NCounter=0;this.iSelectMulti=false;this.SelectedNodes=new ArrayList();this.iDragAndDrop=false;this.ActivateOnExpand=true;this.iIsActive=false;this.CtxMenuIdx=-1;this.UpdCount=0;this.IDColl=null;this.IDDoc=null;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TRE_MAXPROPS);this.RD3ResendNodes=false;this.NotifyFinalSelection=false;this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.ExpandEventDef=RD3Glb.EVENT_ACTIVE;this.FirstExpandDef=RD3Glb.EVENT_ACTIVE;this.CheckEventDef=RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE;this.ExpandAnimationDef=null;this.Visible=true;this.set_Enabled(true)}ATreeSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];ATreeSrv[obj]=WebFrameSrv[obj]}ATreeSrv.prototype.SetItemCount=function(b){this.ItemList=new Array(b+1);for(var a=1;a<this.ItemList.length;a++){this.ItemList[a]=new ATreeItemSrv()}};ATreeSrv.prototype.SetItem=function(b,a){this.ItemList[b]=a;a.TreeObj=this};ATreeSrv.prototype.GetItem=function(a){return this.ItemList[a]};ATreeSrv.prototype.Enabled=function(){return this.iEnabled};ATreeSrv.prototype.set_Enabled=function(a){if(this.iEnabled!=a){this.iEnabled=a;this.RD3Change(RD3Glb.TRE_ENABLED)}};ATreeSrv.prototype.SelectMulti=function(){return this.iSelectMulti};ATreeSrv.prototype.set_SelectMulti=function(a){if(this.iSelectMulti!=a){this.iSelectMulti=a;this.RD3Change(RD3Glb.TRE_SELECTMULTI)}};ATreeSrv.prototype.Collapsed=function(){return this.iCollapsed};ATreeSrv.prototype.set_Collapsed=function(a){if(this.iCollapsed!=a){WebFrameSrv.prototype.set_Collapsed.call(this,a);if(this.Collapsed==a){this.iCollapsed=a;this.RD3Change(RD3Glb.WFR_COLLAPSED)}}};ATreeSrv.prototype.DragAndDrop=function(){return this.iDragAndDrop};ATreeSrv.prototype.set_DragAndDrop=function(a){if(this.iDragAndDrop!=a){this.iDragAndDrop=a;this.RD3Change(RD3Glb.TRE_DRAGANDDROP)}};ATreeSrv.prototype.Refresh=function(m,a,g){if(a==undefined){a=new IDVariant()}if(g==undefined){g=true}var d=null;var c=null;var f="";if(this.SelectedNode!=null){f=this.SelectedNode.HashKey}if(!a.stringValue().equals("")){d=this.GetNodeByHash(m,a.stringValue(),false,false);if(d==null){m.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,184,"ATree.Refresh","Tree "+this.Code+": can't find root node with Hash = "+a+". Refresh all tree")}}else{d=null}if(g){c=new ArrayList();if(d==null){this.GetExpandedState(m,null,c,0)}else{this.GetExpandedState(m,d.Parent,c,0)}if(m.IsMobile()){m.RD3AddEvent("resetTree",this.GetRD3Ident())}}if(d==null){for(var e=1;e<this.ItemList.length;e++){if(this.ItemList[e].Parent==null){this.ItemList[e].UpdateItem(m,null,true)}}var l=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true}else{var k=new ArrayList();if(d.Nodes!=null){for(var j=0;j<d.Nodes.Count();j++){var n=d.Nodes[j];var o=parseInt(n.Key.substr(1,5),10);var b=this.ItemList[o];if(!k.Contains(b)){k.Add(b)}}}d.RemoveChildren();for(var h=0;h<k.Count();h++){var b=k[h];b.UpdateItem(m,d,true)}}if(g){if(d==null){this.ExpandNodes(m,null,c,0)}else{this.ExpandNodes(m,d.Parent,c,0)}}this.SelectedNode=null;if(!f.equals("")){d=this.GetNodeByHash(m,f,false,false);if(d!=null){this.FireNodeClick(d,m)}else{m.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,185,"ATree.Refresh","Tree "+this.Code+": can't find old selected node with Hash = "+f)}}};ATreeSrv.prototype.GetExpandedState=function(b,d,g,f){for(var h=0;h<this.Nodes.Count();h++){var a=this.Nodes[h];if(a.Parent==d&&a.Expanded){var c=null;if(g.Count()<=f){c=new ArrayList();for(var e=g.Count();e<=f;e++){g.Add(null)}g[f]=c}else{c=g[f]}if(!c.Contains(a.HashKey)){c.Add(a.HashKey);this.GetExpandedState(b,a,g,f+1)}else{b.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,186,"ATree.GetExpandedState","Tree "+this.Code+": the Hash function has the same value for different nodes (HashKey = "+a.HashKey+")")}}}};ATreeSrv.prototype.ExpandNodes=function(f,j,b,g){for(var d=0;d<this.Nodes.Count();d++){var h=this.Nodes[d];if(h.Parent==j){var e=(g<b.Count()?b[g]:null);if(e!=null&&e.indexOf(h.HashKey)!=-1){var a=this.Nodes.Count();if(!h.Expanded){var c=parseInt(h.Key.substr(1,5),10);this.ItemList[c].Expand(f,h);h.AlreadyExpanded=true;h.Expanded=true;h.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);h.RD3Change(RD3Glb.TRN_EXPANDED)}this.ExpandNodes(f,h,b,g+1);if(a!=this.Nodes.Count()){d--}}}}};ATreeSrv.prototype.UpdateTree=function(b){if(!this.IsDO){for(var d=1;d<this.ItemList.length;d++){if(this.ItemList[d].Parent==null){this.ItemList[d].UpdateItem(b,null,false)}}}else{var e=this.ActiveDocument();var g=false;if(this.IDColl!=null){this.IDColl.set_UIMode(true);if(this.IDColl.UpdateCount()!=this.UpdCount){g=true;this.UpdCount=this.IDColl.UpdateCount()}if(!g){this.IDColl.MoveFirst();while(!this.IDColl.IsEof()){if(this.IDColl.GetAt().Deleted()||this.IDColl.GetAt().Hidden()){g=true;break}this.IDColl.MoveNext()}}this.IDColl.set_UIMode(false)}if(g){this.DOCreateRootNodes(this.IDColl)}var j=new ArrayList();for(var h=0;h<this.Nodes.Count();h++){var a=this.Nodes[h];a.DOUpdateNode(j)}for(var h=0;h<j.Count();h++){var a=j[h];this.DORefresh(a.Doc,true)}var f=e!=null;while(e!=this.ActiveDocument()&&e!=null){this.DOActivate(e);if(e!=this.ActiveDocument()){e=e.Parent()}}if(this.ActiveDocument()==null&&f&&this.Nodes.Count()>0){this.DOActivate(this.Nodes[0].Doc)}}};ATreeSrv.prototype.Expand=function(a,d){var b=new IDVariant();if(this.IsDO){this.Parent.OnTreeExpandDoc(this,d.Doc,b)}else{this.Parent.OnTreeExpandNode(this,new IDVariant(d.HashKey),b)}if(b.isFalse()){if(this.IsDO){d.DOExpand()}else{var c=parseInt(d.Key.substr(1,5),10);this.ItemList[c].Expand(a,d);d.AlreadyExpanded=true;d.Expanded=true;d.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);d.RD3Change(RD3Glb.TRN_EXPANDED)}if(this.ActivateOnExpand){this.FireNodeClick(d,a)}}};ATreeSrv.prototype.NodeClick=function(a,c){if(this.IsDO){return true}else{var b=parseInt(c.Key.substr(1,5),10);this.ItemList[b].SetIMDB(c,a);return((this.ItemList[b].RoleFlags&Glb.OBJ_ENABLED)!=0)}};ATreeSrv.prototype.FireNodeClick=function(c,a){var b=new IDVariant();if(this.IsDO){this.Parent.OnTreeActivateDoc(this,c.Doc,b)}else{this.Parent.OnTreeActivateNode(this,new IDVariant(c.HashKey),b)}if(b.isFalse()){if(this.SelectedNode!=c){this.SelectedNode=c}if(this.IsDO){c.DOClick()}else{this.Parent.NodeClick(this,c)}}this.RD3Change(RD3Glb.TRE_SELECTEDNODE)};ATreeSrv.prototype.FireOnDrop=function(b,d,f,e,c,a){this.Parent.OnTreeDropNode(this,new IDVariant(b),new IDVariant(d),new IDVariant(f),new IDVariant(e),new IDVariant(c),new IDVariant(a))};ATreeSrv.prototype.FireOnDropDoc=function(b,f,h,g,a,c){this.Parent.OnTreeDropDoc(this,b,f,new IDVariant(h),new IDVariant(g),new IDVariant(a),c);if(c.isFalse()){try{f.OnDrop(b,new IDVariant(h),new IDVariant(g),new IDVariant(a),c);if(c.isFalse()){var k=MDOInit.StandardDrop(b,f,h,g,a);if(k!=null){this.UpdateTree(null);this.DOActivate(k)}}}catch(j){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,j.message,"","TREE",0,false)}}};ATreeSrv.prototype.FireOnChangeExpandNode=function(c,b,a){this.Parent.OnTreeChangeExpandNode(this,new IDVariant(c),new IDVariant(b),a)};ATreeSrv.prototype.FireOnChangeExpandDoc=function(c,b,a){this.Parent.OnTreeChangeExpandDoc(this,c,new IDVariant(b),a)};ATreeSrv.prototype.AddNode=function(b){this.Nodes.Add(b);if(b.Parent!=null){b.Parent.AddNode(b)}else{var a=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true}};ATreeSrv.prototype.RemoveNode=function(b){this.Nodes.Remove(b);b.RemoveChildren();if(!this.IsDO&&b.Selected()){this.SelectedNodes.Remove(b.HashKey)}if(this.SelectedNode==b){this.SelectedNode=null;this.RD3Change(RD3Glb.TRE_SELECTEDNODE)}if(b.Parent==null){var a=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true}};ATreeSrv.prototype.GetNode=function(a){for(var b=0;b<this.Nodes.Count();b++){var c=this.Nodes[b];if(c.Key.equals(a)){return c}}return null};ATreeSrv.prototype.ProcessRequest=function(e,c){var a=this.MainFrm;var d=new IDVariant();if(c){var f=false;for(var h=0;h<this.Nodes.Count();h++){var g=this.Nodes[h];var b=a.GetParameter("F"+e.FormIdx+"N"+this.FrIndex+"N"+g.Key+"S");if(b!=null){if(b.length>0&&!g.Selected()){f=true;a.DTTObj.SetRequestName("Tree Selection","Tree "+this.Code+" node selection",DTTRequest.PRI_DATA);a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,174,"ATree.ProcessRequest","Tree "+this.Code+": node "+g.Name+" ("+(this.IsDO?"DO":"Hash = "+g.HashKey)+") selected");a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TREENCHK,"Tree node "+g.Name+" ("+(this.IsDO?"DO":"Hash = "+g.HashKey)+") selected","",g.Key+"chk");a.DTTObj.AddHelpItem(0,0,0,0,"Seleziona il nodo "+g.Name+" dell'albero");d=new IDVariant();if(this.IsDO){if(g.Doc!=null){this.Parent.OnTreeChangeSelDoc(this,g.Doc,new IDVariant(true),d,new IDVariant(false))}}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(g.HashKey),new IDVariant(true),d,new IDVariant(false))}if(d.isFalse()){g.set_Selected(true);if(this.IsDO){if(g.Doc!=null){g.Doc.set_Selected(true)}}else{this.SelectedNodes.Add(g.HashKey)}}}if(b.length==0&&g.Selected()){f=true;a.DTTObj.SetRequestName("Tree Selection","Tree "+this.Code+" node selection",DTTRequest.PRI_DATA);a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,174,"ATree.ProcessRequest","Tree "+this.Code+": node "+g.Name+" ("+(this.IsDO?"DO":"Hash = "+g.HashKey)+") unselected");a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TREENCHK,"Tree node "+g.Name+" ("+(this.IsDO?"DO":"Hash = "+g.HashKey)+") unselected","",g.Key+"chk");a.DTTObj.AddHelpItem(0,0,0,0,"Deseleziona il nodo "+g.Name+" dell'albero");d=new IDVariant();if(this.IsDO){if(g.Doc!=null){this.Parent.OnTreeChangeSelDoc(this,g.Doc,new IDVariant(false),d,new IDVariant(false))}}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(g.HashKey),new IDVariant(false),d,new IDVariant(false))}if(d.isFalse()){g.set_Selected(false);if(this.IsDO){if(g.Doc!=null){g.Doc.set_Selected(false)}}else{this.SelectedNodes.Remove(g.HashKey)}}}}}if(f){if(this.IsDO){this.Parent.OnTreeChangeSelDoc(this,null,new IDVariant(false),d,new IDVariant(true))}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(),new IDVariant(false),d,new IDVariant(true))}}}};ATreeSrv.prototype.SearchObject=function(a){if(a.equals(this.Code)||(this.iGuid!=null&&this.iGuid.equals(a))){return this}else{return null}};ATreeSrv.prototype.HasCaptionCommands=function(){return true};ATreeSrv.prototype.SetRoleFlags=function(a,b,c){this.ItemList[a].RoleFlags=this.ItemList[a].RoleFlags&(~c);this.ItemList[a].RoleFlags=this.ItemList[a].RoleFlags|b};ATreeSrv.prototype.DTTTrace=function(a){if(a.DTTObj.AddTraceItem(this.iGuid,DTTEngine.TRC_ITTREE,"ATree.Render","")){var c=this.Parent;var b="E="+(this.Enabled()?-1:0)+" V="+(this.Visible?-1:0);a.DTTObj.AddTraceToken(this.iGuid,DTTEngine.TRC_TREECAPTION,"Tree.Caption",c.Frames[this.FrIndex].Caption,b);return true}else{return false}};ATreeSrv.prototype.IsActive=function(){return this.iIsActive};ATreeSrv.prototype.set_IsActive=function(a){if(this.iIsActive!=a){this.iIsActive=a;this.RD3Change(RD3Glb.TRE_CHECKACTIVE)}};ATreeSrv.prototype.Document=function(){return this.IDDoc};ATreeSrv.prototype.set_Document=function(b){this.Nodes.Clear();this.IDColl=null;this.IDDoc=b;this.IsDO=true;if(b!=null){this.DOCreateRootNode(b)}var a=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true};ATreeSrv.prototype.Collection=function(){return this.IDColl};ATreeSrv.prototype.set_Collection=function(b){this.Nodes.Clear();this.IDColl=null;this.IDDoc=null;this.IsDO=true;if(b!=null){this.DOCreateRootNodes(b)}var a=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true};ATreeSrv.prototype.DOCreateRootNode=function(f,e,c){if(e==undefined){e=null}if(c==undefined){c=0}if(f.Deleted()){return null}var g=new ATreeNodeSrv();this.NCounter=this.NCounter+1;g.Key=this.NCounter+"";g.ColIdx=c;g.TreeObj=this;g.Parent=e;g.AlreadyExpanded=!f.MayHaveChildren();g.SetDocument(f);var a=f.GetPropertyIndex("DO_CANCHECK",false,true);g.CanBeChecked=true;if(a>0){var b=f.GetPropByIndex(a);if(b.Type!=IDVariant.NULL){g.CanBeChecked=(b.intValue()!=0)}}a=f.GetPropertyIndex("DO_CLASSNAME",false,true);if(a>0){var b=f.GetPropByIndex(a);if(b.Type!=IDVariant.NULL){g.ClassName=b.stringValue()}}this.AddNode(g);return g};ATreeSrv.prototype.DOCreateRootNodes=function(g){g.set_UIBound(true);g.set_UIMode(true);g.MoveFirst();while(!g.IsEof()){if(g==this.IDColl){var b=g.GetAt();var f=this.DOGetNode(b);if(b.Deleted()){if(f!=null){this.RemoveNode(f)}}else{if(f!=null){if(f.Parent!=null){f=null}}if(f==null){this.DOCreateRootNode(b)}}}else{this.DOCreateRootNode(g.GetAt())}g.MoveNext()}if(g==this.IDColl){var a=new ArrayList(this.Nodes);for(var e=0;e<a.Count();e++){var f=a[e];if(f.Doc!=null){if(f.Doc.Deleted()||f.Doc.Hidden()){this.RemoveNode(f)}}if(f.Doc!=null&&f.Parent==null){if(f.Doc.ParentCollection()!=this.IDColl||!this.IDColl.Find(f.Doc)){this.RemoveNode(f)}}}}this.IDColl=g;this.UpdCount=g.UpdateCount();g.set_UIMode(false)};ATreeSrv.prototype.DOGetNode=function(a){for(var c=0;c<this.Nodes.Count();c++){var b=this.Nodes[c];if(b.Doc==a){return b}}return null};ATreeSrv.prototype.DOActivate=function(g){var e=null;var c=new ArrayList();if(this.MainFrm.IsMobile()){e=this.MainFrm.RD3AddEvent("resetTree",this.GetRD3Ident());for(var j=0;j<this.Nodes.Count();j++){var f=this.Nodes[j];if(f.Expanded){f.Expanded=false;c.Add(f)}}}var h=this.DOFindAndExpandNode(g);if(h!=null){this.FireNodeClick(h,null)}else{if(e!=null){e.DontSend=true}}if(this.MainFrm.IsMobile()){for(var j=0;j<c.Count();j++){var b=this.Nodes[j];if(!b.Expanded){b.RD3Change(RD3Glb.TRN_EXPANDED)}else{b.RD3Change(RD3Glb.TRN_EXPANDED,false)}}var a=false;for(var j=0;j<this.Nodes.Count();j++){var f=this.Nodes[j];if(f.isRD3Changed(RD3Glb.TRN_EXPANDED)){a=true;break}}if(a){for(var j=0;j<this.Nodes.Count();j++){var f=this.Nodes[j];if(f.Expanded){f.RD3Change(RD3Glb.TRN_EXPANDED)}}}else{if(e!=null){e.DontSend=true}}}};ATreeSrv.prototype.DOExpand=function(g,e){if(e==undefined){e=true}var j=null;var m=new ArrayList();if(this.MainFrm.IsMobile()){if(g==null&&e){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,177,"ATree.ExpandNode","Tree "+this.Code+": can't Expand all tree in a Mobile Application");return}j=this.MainFrm.RD3AddEvent("resetTree",this.GetRD3Ident());for(var h=0;h<this.Nodes.Count();h++){var c=this.Nodes[h];if(c.Expanded){c.Expanded=false;m.Add(c)}}}if(g==null){var l=0;var b=new ArrayList();while(l!=this.Nodes.Count()){l=this.Nodes.Count();for(var h=0;h<this.Nodes.Count();h++){var a=this.Nodes[h];if(e!=a.Expanded){b.Add(a)}}for(var h=0;h<b.Count();h++){var a=b[h];if((e&&!a.AlreadyExpanded)||(!e&&a.Expanded)){this.Expand(this.MainFrm,a)}if(a.Expanded!=e){a.Expanded=e;a.RD3Change(RD3Glb.TRN_EXPANDED)}}}}else{if(this.MainFrm.IsMobile()){this.DOFindAndExpandNode(g)}var a=this.DOGetNode(g);if(a!=null){if(e&&!a.AlreadyExpanded){this.Expand(this.MainFrm,a)}if(a.Expanded!=e){a.Expanded=e;a.RD3Change(RD3Glb.TRN_EXPANDED)}}if(this.MainFrm.IsMobile()){for(var h=0;h<m.Count();h++){var k=this.Nodes[h];if(!k.Expanded){k.RD3Change(RD3Glb.TRN_EXPANDED)}else{k.RD3Change(RD3Glb.TRN_EXPANDED,false)}}var f=false;for(var h=0;h<this.Nodes.Count();h++){var c=this.Nodes[h];if(c.isRD3Changed(RD3Glb.TRN_EXPANDED)){f=true;break}}if(f){for(var h=0;h<this.Nodes.Count();h++){var c=this.Nodes[h];if(c.Expanded){c.RD3Change(RD3Glb.TRN_EXPANDED)}}}else{if(j!=null){j.DontSend=true}}}}};ATreeSrv.prototype.ActiveDocument=function(){if(this.SelectedNode!=null){return this.SelectedNode.Doc}return null};ATreeSrv.prototype.set_ActiveDocument=function(a){this.DOActivate(a)};ATreeSrv.prototype.DORefresh=function(h,g){if(g==undefined){g=false}var l=this.MainFrm.IsMobile();var b=new ArrayList();var e=new ArrayList();var f=this.ActiveDocument();for(var k=0;k<this.Nodes.Count();k++){var m=this.Nodes[k];if(m.Expanded){b.Add(m.Doc);if(l){m.Expanded=false}}}if(l){this.MainFrm.RD3AddEvent("resetTree",this.GetRD3Ident())}if(h==null){for(var k=0;k<this.Nodes.Count();k++){var m=this.Nodes[k];if(m.Doc!=null&&m.Doc.Parent()==null){e.Add(m.Doc)}}var j=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true}else{e.Add(h)}for(var k=0;k<e.Count();k++){var a=e[k];var c=this.DOGetNode(a);if(c!=null){c.DOUpdateNode(null);if(g&&c.AlreadyExpanded){c.RemoveChildren();c.AlreadyExpanded=!c.Doc.MayHaveChildren();if(c.Expanded){c.Expanded=false;c.DOExpand()}c.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);c.RD3Change(RD3Glb.TRN_EXPANDED)}}}for(var k=0;k<b.Count();k++){var a=b[k];var c=this.DOGetNode(a);if(c!=null&&!c.Expanded){if(c.AlreadyExpanded){c.Expanded=true;c.DOUpdateIcon();c.RD3Change(RD3Glb.TRN_EXPANDED)}else{c.DOExpand()}}}if(f!=null&&f!=this.ActiveDocument()){var c=this.DOGetNode(f);if(c!=null){this.SelectedNode=c;this.RD3Change(RD3Glb.TRE_SELECTEDNODE)}}};ATreeSrv.prototype.DOFindAndExpandNode=function(c){var f=null;var e=null;var b=new ArrayList();var a=c;while(a!=null){f=this.DOGetNode(a);if(f==null){b.Add(a);a=a.Parent()}else{break}}while(a!=c&&f!=null&&b.Count()>0){f.DOUpdateNode(null);if(!f.AlreadyExpanded){f.DOExpand()}a=b[b.Count()-1];b.RemoveAt(b.Count()-1);f=this.DOGetNode(a)}f=this.DOGetNode(c);if(f!=null){e=f.Parent}while(e!=null){if(!e.Expanded){e.Expanded=true;e.DOUpdateIcon();e.RD3Change(RD3Glb.TRN_EXPANDED)}e=e.Parent}if(f!=null){if(f.Doc==c){return f}else{return null}}else{return null}};ATreeSrv.prototype.GetNodeByHash=function(q,k,h,s){if(h==undefined){h=false}if(s==undefined){s=true}var t=new ArrayList();try{if(!s){var g=false;for(var m=0;m<this.Nodes.Count();m++){var a=this.Nodes[m];if(a.Expanded){if(!g&&t.Contains(a.HashKey)){g=true;break}t.Add(a.HashKey)}}if(g){q.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,186,"ATree.GetNodeByHash","Tree "+this.Code+": the Hash function has the same value for different nodes (HashKey = "+a.HashKey+")")}}var l=false;var o=null;var r=0;var d=0;while(!l){l=true;for(var b=d;b<this.Nodes.Count();b++){if(this.Nodes[b].HashKey.equals(k)){o=this.Nodes[b];break}}if(o==null&&h){r=this.Nodes.Count();for(var b=d;b<this.Nodes.Count();b++){if(!this.Nodes[b].AlreadyExpanded){var c=this.Nodes.Count();this.Nodes[b].ToggleExpansion(q);d=b;if(this.Nodes.Count()!=c){l=false;break}}}}}if(o!=null){var a=o.Parent;while(a!=null){if(!t.Contains(a.HashKey)){t.Add(a.HashKey)}a=a.Parent}for(var m=0;m<this.Nodes.Count();m++){a=this.Nodes[m];if(!t.Contains(a.HashKey)&&a.Expanded){a.Expanded=false;a.RD3Change(RD3Glb.TRN_EXPANDED)}if(t.Contains(a.HashKey)&&!a.Expanded){a.ToggleExpansion(q)}}return o}}catch(f){}return null};ATreeSrv.prototype.ActivateNode=function(h,e,d,j){if(d==undefined){d=false}if(j==undefined){j=true}this.RD3Change(RD3Glb.TRE_SELECTEDNODE);var g=null;if(h.IsMobile()){j=true;g=h.RD3AddEvent("resetTree",this.GetRD3Ident())}var b=this.GetNodeByHash(h,e.stringValue(),d,j);if(b!=null){if(this.SelectedNode!=b){this.FireNodeClick(b,h)}else{if(g!=null){g.DontSend=true}h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,175,"ATree.ActivateNode","Tree "+this.Code+": node with Hash = "+e+" is already activated")}}else{if(g!=null){g.DontSend=true}h.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,176,"ATree.ActivateNode","Tree "+this.Code+": can't find tree node with Hash = "+e)}if(h.IsMobile()){var c=false;for(var f=0;f<this.Nodes.Count();f++){var a=this.Nodes[f];if(a.isRD3Changed(RD3Glb.TRN_EXPANDED)){c=true;break}}if(c){for(var f=0;f<this.Nodes.Count();f++){var a=this.Nodes[f];if(a.Expanded){a.RD3Change(RD3Glb.TRN_EXPANDED)}}}else{if(g!=null){g.DontSend=true}}}};ATreeSrv.prototype.GetActiveNode=function(){if(this.SelectedNode!=null){return new IDVariant(this.SelectedNode.HashKey)}return new IDVariant("")};ATreeSrv.prototype.GetParentNode=function(b){for(var c=0;c<this.Nodes.Count();c++){var a=this.Nodes[c];if(a.HashKey.equals(b.stringValue())){break}}if(a!=null){if(a.Parent!=null){return new IDVariant(a.Parent.HashKey)}}return new IDVariant("")};ATreeSrv.prototype.GetChildrenCount=function(b){if(b.stringValue().equals("")){return new IDVariant(this.Nodes.Count())}else{var a=null;for(var c=0;c<this.Nodes.Count();c++){a=this.Nodes[c];if(a.HashKey.equals(b.stringValue())){break}}if(a!=null){if(a.Nodes!=null){return new IDVariant(a.Nodes.Count())}}}return new IDVariant(0)};ATreeSrv.prototype.GetChildrenNode=function(c,b){if(c.stringValue().equals("")){return new IDVariant(this.Nodes[b.intValue()].HashKey)}else{var a=null;for(var d=0;d<this.Nodes.Count();d++){a=this.Nodes[d];if(a.HashKey.equals(c.stringValue())){break}}if(a!=null){if(a.Nodes!=null){return new IDVariant(a.Nodes[b.intValue()].HashKey)}}}return new IDVariant("")};ATreeSrv.prototype.GetSelectedCount=function(){if(this.SelectMulti()&&!this.IsDO){return new IDVariant(this.SelectedNodes.Count())}return new IDVariant(0)};ATreeSrv.prototype.GetSelectedNode=function(a){if(this.SelectMulti()&&!this.IsDO){return new IDVariant(this.SelectedNodes[a.intValue()])}return new IDVariant("")};ATreeSrv.prototype.ExpandNode=function(h,e,b,j){if(b==undefined){b=true}if(j==undefined){j=true}if(e.stringValue().equals("")){j=false}var c=null;var k=false;var g=null;if(h.IsMobile()){j=true;if(e.stringValue().equals("")&&b){h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,177,"ATree.ExpandNode","Tree "+this.Code+": can't Expand all tree in a Mobile Application");return}g=h.RD3AddEvent("resetTree",this.GetRD3Ident());var c=this.GetNodeByHash(h,e.stringValue(),e.stringValue().equals(""),false);if(c!=null&&c.Expanded&&b){k=true;c=null}}c=this.GetNodeByHash(h,e.stringValue(),e.stringValue().equals(""),j);if(!e.stringValue().equals("")){if(c!=null){if(b!=c.Expanded||(b&&!c.AlreadyExpanded)){c.ToggleExpansion(h)}}else{h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,177,"ATree.ExpandNode","Tree "+this.Code+": can't find tree node with Hash = "+e);if(g!=null){g.DontSend=true}}if(h.IsMobile()){if(k){g.DontSend=true;return}var d=false;for(var f=0;f<this.Nodes.Count();f++){var a=this.Nodes[f];if(a.isRD3Changed(RD3Glb.TRN_EXPANDED)){d=true;break}}if(d){for(var f=0;f<this.Nodes.Count();f++){var a=this.Nodes[f];if(a.Expanded){a.RD3Change(RD3Glb.TRN_EXPANDED)}}}else{g.DontSend=true}}}else{for(var f=0;f<this.Nodes.Count();f++){var a=this.Nodes[f];if(b!=a.Expanded||(b&&!a.AlreadyExpanded)){a.ToggleExpansion(h)}}}};ATreeSrv.prototype.SelectNode=function(a,b,d){if(d==undefined){d=true}var c=this.GetNodeByHash(a,b.stringValue(),false,false);if(c!=null){if(!c.Selected()&&d){c.set_Selected(true);if(this.IsDO){if(c.Doc!=null){c.Doc.set_Selected(true)}}else{this.SelectedNodes.Add(c.HashKey)}}if(c.Selected()&&!d){c.set_Selected(false);if(this.IsDO){if(c.Doc!=null){c.Doc.set_Selected(false)}}else{this.SelectedNodes.Remove(c.HashKey)}}}else{a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,178,"ATree.SelectNode","Tree "+this.Code+": can't find tree node with Hash = "+b)}};ATreeSrv.prototype.SelectAll=function(b){for(var c=0;c<this.Nodes.Count();c++){var a=this.Nodes[c];if(b==0){if(a.Selected()){this.SelectedNodes.Remove(a.HashKey)}a.set_Selected(false)}else{if(b==1){if(a.Selected()){this.SelectedNodes.Remove(a.HashKey)}else{this.SelectedNodes.Add(a.HashKey)}a.set_Selected(!a.Selected())}else{if(b==2){if(!a.Selected()){this.SelectedNodes.Add(a.HashKey)}a.set_Selected(true)}}}}};ATreeSrv.prototype.ExpandNodesLevel=function(a,f,e){if(e==undefined){e=true}for(var h=0;h<this.Nodes.Count();h++){var g=this.Nodes[h];var c=0;var d=g;while(d.Parent!=null){d=d.Parent;c++;if(c>f){break}}if((e&&c<f)||(!e&&c>=f)){if(e!=g.Expanded||(e&&!g.AlreadyExpanded)){var b=g.Expanded;g.ToggleExpansion(a);if(b!=g.Expanded){h=-1}}}}};ATreeSrv.prototype.GetRD3Name=function(){return"tre"};ATreeSrv.prototype.GetRD3NodeIdent=function(a){for(var c=0;c<this.Nodes.Count();c++){var b=this.Nodes[c];if(b.HashKey.equals(a)){return b.GetRD3Ident()+":txt"}}return""};ATreeSrv.prototype.GetRD3DocIdent=function(a){var b=this.DOGetNode(a);if(b!=null){return b.GetRD3Ident()+":txt"}return""};ATreeSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ATreeSrv.prototype.RD3RenderDifferences=function(c,h,k){var l=0;var a=this.DTTTrace(this.MainFrm);var j=this.RD3Changed;var b=WebFrameSrv.prototype.RD3RenderDifferences.call(this,c,h,k);if(c==null){c=b}j|=(b!=null);if(c==null&&(this.RD3Changed||this.RD3ResendNodes)){c=h.AddNewElement("chg");c.SetAttribute("id",this.GetRD3Ident());b=c}if(k||this.RD3Changed){for(var f=0;f<this.RD3PropChg.length;f++){if(this.RD3PropChg[f]||k){this.SetRD3Property(f,c,k)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(k){if(this.IsActive()){this.CheckEventDef|=RD3Glb.EVENT_IMMEDIATE}if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){c.SetAttribute("clk",this.ClickEventDef.toString())}if(this.ExpandEventDef!=RD3Glb.EVENT_ACTIVE){c.SetAttribute("xpc",this.ExpandEventDef.toString())}if(this.FirstExpandDef!=RD3Glb.EVENT_ACTIVE){c.SetAttribute("fex",this.FirstExpandDef.toString())}if(this.CheckEventDef!=(RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE)){c.SetAttribute("chc",this.CheckEventDef.toString())}if(this.ExpandAnimationDef!=null){c.SetAttribute("exa",this.ExpandAnimationDef)}}var e=(k||this.RD3ResendNodes)?c:h;var g=this.RD3ResendNodes||k;for(var f=0;f<this.Nodes.Count();f++){var d=this.Nodes[f];if(d.Parent==null){j|=d.RD3RenderDifference(e,g,l,a)}}this.RD3ResendNodes=false;return j?b:null};ATreeSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.TRE_SELECTEDNODE:if(this.SelectedNode==null&&b){break}c.SetAttribute("sel",(this.SelectedNode==null)?"":this.SelectedNode.GetRD3Ident());break;case RD3Glb.TRE_CTXMENUIDX:if(this.CtxMenuIdx==0&&b){break}c.SetAttribute("cms","cms:"+this.CtxMenuIdx);break;case RD3Glb.TRE_SELECTMULTI:if(!this.SelectMulti()&&b){break}c.SetAttribute("mul",this.SelectMulti()?"1":"0");break;case RD3Glb.TRE_DRAGANDDROP:if(!this.DragAndDrop()&&b){break}c.SetAttribute("ded",this.DragAndDrop()?"1":"0");break;case RD3Glb.TRE_ACTIVATEONEXPAND:if(this.ActivateOnExpand&&b){break}c.SetAttribute("aoe",this.ActivateOnExpand?"1":"0");break;case RD3Glb.TRE_CHECKACTIVE:if(!this.IsActive()&&b){break}c.SetAttribute("act",this.IsActive()?"1":"0");break;case RD3Glb.TRE_ENABLED:if(this.iEnabled&&b){break}c.SetAttribute("ena",this.Enabled()?"1":"0");break}};ATreeSrv.prototype.RD3SelectNode=function(b,c){var d=this.GetNode(b);if(d!=null&&d.Selected()!=c){this.NotifyFinalSelection=true;if(c){this.MainFrm.DTTObj.SetRequestName("Tree Selection","Tree "+this.Code+" node selection",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,174,"ATree.ProcessRequest","Tree "+this.Code+": node "+d.Name+" ("+(this.IsDO?"DO":"Hash = "+d.HashKey)+") selected");this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TREENCHK,"Tree node "+d.Name+" ("+(this.IsDO?"DO":"Hash = "+d.HashKey)+") selected","",d.Key+"chk");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona il nodo "+d.Name+" dell'albero")}else{this.MainFrm.DTTObj.SetRequestName("Tree Selection","Tree "+this.Code+" node selection",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,174,"ATree.ProcessRequest","Tree "+this.Code+": node "+d.Name+" ("+(this.IsDO?"DO":"Hash = "+d.HashKey)+") unselected");this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TREENCHK,"Tree node "+d.Name+" ("+(this.IsDO?"DO":"Hash = "+d.HashKey)+") unselected","",d.Key+"chk");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Deseleziona il nodo "+d.Name+" dell'albero")}var a=new IDVariant();if(this.IsDO){if(d.Doc!=null){this.Parent.OnTreeChangeSelDoc(this,d.Doc,new IDVariant(c),a,new IDVariant(false))}}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(d.HashKey),new IDVariant(c),a,new IDVariant(false))}if(a.isFalse()){d.set_Selected(c);if(this.IsDO){if(d.Doc!=null){d.Doc.set_Selected(c)}}else{if(c){this.SelectedNodes.Add(d.HashKey)}else{this.SelectedNodes.Remove(d.HashKey)}}}else{d.RD3Change(RD3Glb.TRN_SELECTED)}}};ATreeSrv.prototype.RD3EndRequest=function(){if(this.NotifyFinalSelection){this.NotifyFinalSelection=false;if(this.IsDO){this.Parent.OnTreeChangeSelDoc(this,null,new IDVariant(false),new IDVariant(),new IDVariant(true))}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(),new IDVariant(false),new IDVariant(),new IDVariant(true))}}};ATreeSrv.prototype.RD3RawClick=function(b,h,g,r,f,q,d){var a=d.GetAttribute("par4");var m=a.indexOf(":");var l=a.indexOf(":",m+1);var e="";var j=null;if(a.startsWith("trn")&&m>-1&&l>-1){var k=a.substr(m+1,l-m-1);var c=this.GetNode(k);if(c!=null){j=c.Doc;e=c.HashKey}}var o=new IDVariant();if(this.MainFrm!=null){var c=(q)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(c,"Tree"+this.Code+" "+c,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"Tree."+c,"Tree "+this.Code+": firing event "+c)}if(q){this.Parent.OnMouseDoubleClick(this,new IDVariant(b),new IDVariant(h),new IDVariant(g),new IDVariant(r),new IDVariant(f),new IDVariant(e),j,o)}else{this.Parent.OnMouseClick(this,new IDVariant(b),new IDVariant(h),new IDVariant(g),new IDVariant(r),new IDVariant(f),new IDVariant(e),j,o)}return o.isTrue()};ATreeSrv.prototype.GenericDrag=function(c,m){var j=parseInt(c.GetAttribute("par1"),10);var r=c.GetAttribute("obn");var d=c.GetAttribute("oid");var o=this.MainFrm.RD3FindNode(r);var e=new ArrayList();e.Add(o);if(this.SelectMulti()){for(var g=0;g<this.SelectedNodes.Count();g++){var f=this.SelectedNodes[g];var b=this.GetNodeByHash(this.MainFrm,f,false,false);if(b!=null){e.Add(b)}}}for(var g=0;g<e.Count();g++){var b=e[g];this.MainFrm.ActivedDocument=b.Doc;this.MainFrm.ActivedProperty=null;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"ATree.OnGenericDrag","Tree "+this.Code+": firing event OnGenericDrag");var q=new IDVariant();this.Parent.OnGenericDrag(this,q,new IDVariant(j),new IDVariant(b.HashKey));if(m instanceof WebFrameSrv){var a=m;if(d.startsWith("tab")&&a.Parent!=null&&a.FrIndex>-1&&a.Parent.Frames[a.FrIndex].InTabbed&&a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx]!=null){var h=a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx].Content;h.GenericDrop(c,q)}else{a.GenericDrop(c,q)}}if(m instanceof ACommandSrv){this.MainFrm.CmdObj.GenericDrop(m,q)}}};ATreeSrv.prototype.GenericDrop=function(a,m){var l=parseInt(a.GetAttribute("par4"),10);var j=parseInt(a.GetAttribute("par5"),10);var c=parseInt(a.GetAttribute("par1"),10);var o=parseInt(a.GetAttribute("par2"),10);var h=parseInt(a.GetAttribute("par3"),10);var b=a.GetAttribute("oid");var k=this.MainFrm.RD3FindNode(b);this.MainFrm.DTTObj.SetRequestName("Generic Drop","Tree "+this.Code+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"ATree.OnGenericDrop","Tree "+this.Code+": firing event OnGenericDrop");var n=new IDVariant();this.Parent.OnGenericDrop(this,m,n,new IDVariant(c),new IDVariant(l),new IDVariant(j),new IDVariant(o),new IDVariant(h),new IDVariant(k.HashKey),k.Doc);if(n.isFalse()&&this.MainFrm.ActivedDocument!=null&&k.Doc!=null){try{k.Doc.OnDrop(this.MainFrm.ActivedDocument,new IDVariant(this.MainFrm.ShiftKey()),new IDVariant(this.MainFrm.AltKey()),new IDVariant(this.MainFrm.CtrlKey()),n);if(n.isFalse()){var g=MDOInit.StandardDrop(this.MainFrm.ActivedDocument,k.Doc,this.MainFrm.ShiftKey(),this.MainFrm.AltKey(),this.MainFrm.CtrlKey());if(g!=null){this.UpdateTree(null);this.DOActivate(g)}}}catch(f){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,f.message,"","TREE",0,false)}}};function CmdHandlerSrv(a){this.CmdSets=new Array();this.CmdLin=new Array();this.MainFrm=a;this.iSuppressMenu=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.CMH_MAXPROP);this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.SuppressMenuAnimationDef=null;if(a!=undefined){if(a.ParamsObj().MAX_COMMAND_SETS>0){this.CmdSets=new Array(a.ParamsObj().MAX_COMMAND_SETS+1)}if(a.ParamsObj().MAX_COMMANDS>0){this.CmdLin=new Array(a.ParamsObj().MAX_COMMANDS+1)}}}CmdHandlerSrv.FilledTo=[0,0];CmdHandlerSrv.prototype.AppendTo=function(a){};CmdHandlerSrv.prototype.SuppressMenu=function(){return this.iSuppressMenu};CmdHandlerSrv.prototype.set_SuppressMenu=function(a){if(this.iSuppressMenu!=a){this.iSuppressMenu=a;if(a){this.MainFrm.ResizeClient(this.MainFrm.ScreenW()+this.MainFrm.MenuW,this.MainFrm.ScreenH(),true)}else{this.MainFrm.ResizeClient(this.MainFrm.ScreenW()-this.MainFrm.MenuW,this.MainFrm.ScreenH(),true)}this.RD3Change(RD3Glb.CMH_SUPPRMENU)}};CmdHandlerSrv.prototype.set_CmdEnabled=function(b,a){this.CmdLin[b].set_bEnabled(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.set_CmdChecked=function(a,b){this.CmdLin[a].set_bChecked(this.MainFrm.ActiveFormIdx(),b)};CmdHandlerSrv.prototype.set_CmdVisible=function(b,a){this.CmdLin[b].set_bVisible(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.set_CmdExpanded=function(c,a){if(this.CmdLin[c].uCommands()>0&&this.CmdLin[c].Expanded!=a){var b=new IDVariant();this.MainFrm.OnCmdSetChangeExpand(this.CmdLin[c],new IDVariant(a),b);if(b.isFalse()){this.AutoCollapse(this.CmdLin[c]);this.CmdLin[c].Expanded=a;this.CmdLin[c].RD3Change(RD3Glb.CMD_EXPANDED)}}};CmdHandlerSrv.prototype.set_CmdCaption=function(b,a){this.CmdLin[b].set_bCaption(a)};CmdHandlerSrv.prototype.set_CmdToolTip=function(b,a){this.CmdLin[b].set_bToolTip(a)};CmdHandlerSrv.prototype.set_CmdBadge=function(b,a){this.CmdLin[b].set_Badge(a)};CmdHandlerSrv.prototype.set_CmdClassName=function(b,a){this.CmdLin[b].set_ClassName(a)};CmdHandlerSrv.prototype.set_CmdSetEnabled=function(a,b){this.CmdSets[a].set_bEnabled(this.MainFrm.ActiveFormIdx(),b)};CmdHandlerSrv.prototype.set_CmdSetVisible=function(b,a){this.CmdSets[b].set_bVisible(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.set_CmdWidth=function(b,a){this.CmdLin[b].Width=a};CmdHandlerSrv.prototype.set_CmdIcon=function(b,a){this.CmdLin[b].Image=a;this.CmdLin[b].set_RD(true);this.CmdLin[b].RD3Change(RD3Glb.CMD_IMAGE)};CmdHandlerSrv.prototype.set_CmdSetExpanded=function(c,b){if(this.CmdSets[c].Expanded!=b){var a=new IDVariant();if(this.CmdSets[c].IdxForm>0){var d=this.MainFrm.GetForm(this.CmdSets[c].IdxForm);if(d!=null){d.OnCmdSetChangeExpand(this.CmdSets[c],new IDVariant(b),a)}}else{this.MainFrm.OnCmdSetChangeExpand(this.CmdSets[c],new IDVariant(b),a)}if(a.isFalse()){this.AutoCollapse(this.CmdSets[c]);this.CmdSets[c].Expand()}}};CmdHandlerSrv.prototype.set_CmdSetCaption=function(a,b){this.CmdSets[a].set_bCaption(b)};CmdHandlerSrv.prototype.set_CmdSetToolTip=function(a,b){this.CmdSets[a].set_bToolTip(b)};CmdHandlerSrv.prototype.set_CmdSetBadge=function(b,a){this.CmdSets[b].set_Badge(a)};CmdHandlerSrv.prototype.set_CmdSetClassName=function(b,a){this.CmdSets[b].set_ClassName(a)};CmdHandlerSrv.prototype.CmdEnabled=function(a){return this.CmdLin[a].bEnabled(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdChecked=function(a){return this.CmdLin[a].bChecked(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdVisible=function(a){return this.CmdLin[a].bVisible(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdExpanded=function(a){return this.CmdLin[a].Expanded};CmdHandlerSrv.prototype.CmdCaption=function(a){return this.CmdLin[a].Caption};CmdHandlerSrv.prototype.CmdToolTip=function(a){return this.CmdLin[a].ToolTip};CmdHandlerSrv.prototype.CmdBadge=function(a){return this.CmdLin[a].iBadge};CmdHandlerSrv.prototype.CmdClassName=function(a){return this.CmdLin[a].iClassName};CmdHandlerSrv.prototype.CmdIcon=function(a){return this.CmdLin[a].Image};CmdHandlerSrv.prototype.CmdSetEnabled=function(a){return this.CmdSets[a].bEnabled(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdSetVisible=function(a){return this.CmdSets[a].bVisible(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdSetExpanded=function(a){return this.CmdSets[a].Expanded};CmdHandlerSrv.prototype.CmdSetCaption=function(a){return this.CmdSets[a].Caption};CmdHandlerSrv.prototype.CmdSetToolTip=function(a){return this.CmdSets[a].ToolTip};CmdHandlerSrv.prototype.CmdSetBadge=function(a){return this.CmdSets[a].iBadge};CmdHandlerSrv.prototype.CmdSetClassName=function(a){return this.CmdSets[a].iClassName};CmdHandlerSrv.prototype.CmdClick=function(f){var b=new IDVariant(0);var a=-1;var e=null;var d=this.CmdLin[f].Parent;for(var c=0;c<d.uCommands();c++){if(d.bCommands(c).Index==f){a=c;break}}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,d.iGuid,188,"CmdHandler.CmdClick","MainFrm: Fire GlobalCmdSetCommand Event");this.MainFrm.GlobalCmdSetCommand(this.CmdLin[f].Parent,this.CmdLin[f],b);if(b.isFalse()){if(this.CmdLin[f].Parent.IdxForm==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,d.iGuid,188,"CmdHandler.CmdClick","MainFrm: Fire CmdSet "+d.Code+".OnCommand Event");this.MainFrm.OnCmdSetCommand(this.CmdLin[f].Parent,new IDVariant(f),new IDVariant(a),b)}else{e=this.MainFrm.GetFormByIndex(this.CmdLin[f].Parent.IdxForm,this.MainFrm.GetLiveForms());if(e!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,d.iGuid,188,"CmdHandler.CmdClick","Form "+e.Caption()+": Fire CmdSet "+d.Code+".OnCommand Event");e.OnCmdSetCommand(this.CmdLin[f].Parent,new IDVariant(f),new IDVariant(a),b)}}if(b.isFalse()){if(this.CmdLin[f].Parent.IdxForm==0){this.MainFrm.CmdClickCB(f)}else{if(e!=null){e.CmdClickCB(f)}}}}};CmdHandlerSrv.prototype.CmdSetApplyRole=function(c,a,b){this.CmdSets[c].RoleEnabled=a;this.CmdSets[c].RoleVisible=b;this.CmdSets[c].RD3Change(RD3Glb.CMD_ENABLED);this.CmdSets[c].RD3Change(RD3Glb.CMD_VISIBLE)};CmdHandlerSrv.prototype.CommandApplyRole=function(b,a,c){this.CmdLin[b].RoleEnabled=a;this.CmdLin[b].RoleVisible=c;this.CmdLin[b].RD3Change(RD3Glb.CMD_ENABLED);this.CmdLin[b].RD3Change(RD3Glb.CMD_VISIBLE)};CmdHandlerSrv.prototype.UserEvent=function(c){if(c.equals(".")){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddTestItem("ERROR",DTTEngine.TST_ERROR,"Error back button detected","")}return}var j=parseInt(c.substr(1),10);if(j>0){switch(c.charAt(0)){case"S":if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdSets[j].iGuid,9,"CmdHandler.UserEvent",(this.CmdSets[j].Expanded?"Collapse":"Expand")+" menu command "+this.CmdSets[j].Caption);this.MainFrm.DTTObj.SetRequestName((this.CmdSets[j].Expanded?"Collapse":"Expand")+" Menu ",(this.CmdSets[j].Expanded?"Collapse":"Expand")+" Menu "+this.CmdSets[j].Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.CmdSets[j].iGuid,DTTEngine.TST_CMDSET,"Command set "+this.CmdSets[j].Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,(this.CmdSets[j].Expanded?"Chiudi":"Apri")+" il menu "+this.CmdSets[j].Caption)}var b=this.CmdSets[j].Expanded;this.set_CmdSetExpanded(j,!this.CmdSets[j].Expanded);if(this.CmdSets[j].Expanded==b&&this.CmdSets[j].ExpandEventDef==RD3Glb.EVENT_ACTIVE){this.CmdSets[j].RD3Change(RD3Glb.CMD_EXPANDED)}break;case"M":if(this.CmdLin[j].uCommands()==0){var a=this.MainFrm.ActiveFormIdx();if(this.CmdLin[j].Parent!=null){if(this.CmdLin[j].Parent.IdxForm!=a){if(!this.MainFrm.ParamsObj().UseRD3){var h=this.MainFrm.DockedForm();if(h!=null){a=h.FormIdx}}else{for(var d=0;d<this.MainFrm.StackForm.Count();d++){var h=this.MainFrm.StackForm[d];if(h.Docked&&this.CmdLin[j].Parent.IdxForm==h.FormIdx){a=h.FormIdx;break}}}}if(this.CmdLin[j].Parent.IdxForm!=a){var g=new ArrayList();for(var d=0;d<this.MainFrm.StackForm.Count();d++){var h=this.MainFrm.StackForm[d];if(h.Docked||h==this.MainFrm.ActiveForm()){h.GetSubForm(g)}}for(var d=0;d<g.Count();d++){var h=g[d];if(this.CmdLin[j].Parent.IdxForm==h.FormIdx){a=h.FormIdx;break}}}}if(this.CmdLin[j].bVisible(a)&&this.CmdLin[j].bEnabled(a)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdLin[j].iGuid,10,"CmdHandler.UserEvent","Command "+this.CmdLin[j].Caption+" received");this.MainFrm.DTTObj.SetRequestName("Menu "+this.CmdLin[j].Caption,"Menu "+this.CmdLin[j].Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.CmdLin[j].iGuid,DTTEngine.TST_CMD,"Command "+this.CmdLin[j].Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Clicca sulla voce di menu "+this.CmdLin[j].Caption)}this.CmdClick(j)}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.CmdLin[j].iGuid,11,"CmdHandler.UserEvent","Command "+this.CmdLin[j].Caption+" either invisible or disabled")}}}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdLin[j].iGuid,9,"CmdHandler.UserEvent",(this.CmdLin[j].Expanded?"Collapse":"Expand")+" menu command "+this.CmdLin[j].Caption);this.MainFrm.DTTObj.SetRequestName((this.CmdLin[j].Expanded?"Collapse":"Expand")+" Menu ",(this.CmdLin[j].Expanded?"Collapse":"Expand")+" Menu "+this.CmdLin[j].Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.CmdLin[j].iGuid,DTTEngine.TST_CMDSET,"Command set "+this.CmdLin[j].Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,(this.CmdLin[j].Expanded?"Chiudi":"Apri")+" il menu "+this.CmdLin[j].Caption)}var e=this.CmdLin[j].Expanded;this.set_CmdExpanded(j,!this.CmdLin[j].Expanded);if(this.CmdLin[j].Expanded==e&&this.CmdLin[j].ExpandEventDef==RD3Glb.EVENT_ACTIVE){this.CmdLin[j].RD3Change(RD3Glb.CMD_EXPANDED)}}break}}};CmdHandlerSrv.prototype.ProcessRequest=function(e,b){for(var a=0;a<=this.CmdSets[e].MaxCommands();a++){var f=this.CmdSets[e].Commands(a);var d=this.MainFrm.GetParameter("M"+f.Index);if(d!=null&&d.length>0){if(f.bVisible(b.FormIdx)&&f.bEnabled(b.FormIdx)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.iGuid,17,"CmdHandler.ProcessRequest","Command "+f.Caption+" received");this.MainFrm.DTTObj.SetRequestName("Menu "+f.Caption,"Menu "+f.Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(f.iGuid,DTTEngine.TST_CMD,"Command "+f.Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Clicca sulla voce di menu "+f.Caption);b.CmdClickCB(f.Index)}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,f.iGuid,18,"CmdHandler.ProcessRequest","Command "+f.Caption+" either invisible or disabled")}}}};CmdHandlerSrv.prototype.IsToolbarPresent=function(){for(var a=1;a<this.CmdSets.length;a++){if(this.CmdSets[a]==null){continue}if(this.CmdSets[a].IsToolbar&&this.CmdSets[a].bVisible(this.MainFrm.ActiveFormIdx())&&this.CmdSets[a].ToolCont==-1){return true}}return false};CmdHandlerSrv.prototype.IsMenuPresent=function(){if(this.iSuppressMenu){return false}for(var a=1;a<this.CmdSets.length;a++){if(this.CmdSets[a]==null){continue}if(this.CmdSets[a].IsMenu&&this.CmdSets[a].bVisible(this.MainFrm.ActiveFormIdx())){return true}}return false};CmdHandlerSrv.prototype.HasCaptionToolbar=function(b,d,a){for(var c=1;c<this.CmdSets.length;c++){if(this.CmdSets[c]==null){continue}if(this.CmdSets[c].IsToolbar&&this.CmdSets[c].IdxForm==b&&(this.CmdSets[c].ToolCont==d||(a!=null&&this.CmdSets[c].ToolContCode!=null&&this.CmdSets[c].ToolContCode.equals(a)))){this.CmdSets[c].ToolCont=d;this.CmdSets[c].RD3Change(RD3Glb.CMD_TOOLCONT);return 1}}return 0};CmdHandlerSrv.prototype.ProcessCaptionRequest=function(h,f,a){for(var d=1;d<this.CmdSets.length;d++){if(this.CmdSets[d]==null){continue}if(this.CmdSets[d].IsToolbar&&this.CmdSets[d].IdxForm==f.FormIdx&&this.CmdSets[d].ToolCont==h){for(var e=0;e<=this.CmdSets[d].MaxCommands();e++){var k=this.CmdSets[d].Commands(e);var g=a.GetParameter("M"+k.Index+".x");if(g!=null&&g.length>0){if(k.bVisible(f.FormIdx)&&k.bEnabled(f.FormIdx)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,k.iGuid,15,"CmdHandler.ProcessCaptionRequest","Command "+k.Caption+" received");this.MainFrm.DTTObj.SetRequestName("Menu "+k.Caption,"Menu "+k.Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(k.iGuid,DTTEngine.TST_CMD,"Command "+k.Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Clicca sulla voce di menu "+k.Caption)}var b=new IDVariant(0);if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdSets[d].iGuid,188,"CmdHandler.ProcessCaptionRequest","Form "+f.Caption()+": Fire CmdSet "+this.CmdSets[d].Code+".OnCommand Event")}f.OnCmdSetCommand(this.CmdSets[d],new IDVariant(k.Index),new IDVariant(e),b);if(b.isFalse()){f.CmdClickCB(k.Index)}}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,k.iGuid,16,"CmdHandler.ProcessCaptionRequest","Command "+k.Caption+" either invisible or disabled")}}}}}}};CmdHandlerSrv.prototype.ResetRoles=function(a){for(var b=1;b<this.CmdLin.length;b++){if(this.CmdLin[b]==null){continue}if(this.CmdLin[b].IdxForm==0&&this.CmdLin[b].uCommands()>0){this.CmdLin[b].RoleEnabled=a.GlbRoleCmdLinEnabled;this.CmdLin[b].RoleVisible=a.GlbRoleCmdLinEnabled;this.CmdLin[b].RD3Change(RD3Glb.CMD_VISIBLE);this.CmdLin[b].RD3Change(RD3Glb.CMD_ENABLED)}}for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]==null){continue}if(this.CmdSets[b].IdxForm==0&&this.CmdSets[b].uCommands()>0){this.CmdSets[b].RoleEnabled=a.GlbRoleCmdSetEnabled;this.CmdSets[b].RoleVisible=a.GlbRoleCmdSetEnabled;this.CmdSets[b].RD3Change(RD3Glb.CMD_VISIBLE);this.CmdSets[b].RD3Change(RD3Glb.CMD_ENABLED)}}for(var b=1;b<this.CmdLin.length;b++){if(this.CmdLin[b]==null){continue}if(this.CmdLin[b].IdxForm==0&&this.CmdLin[b].uCommands()==0){this.CmdLin[b].RoleEnabled=a.GlbRoleCommandEnabled;this.CmdLin[b].RoleVisible=a.GlbRoleCommandEnabled;this.CmdLin[b].RD3Change(RD3Glb.CMD_VISIBLE);this.CmdLin[b].RD3Change(RD3Glb.CMD_ENABLED)}}};CmdHandlerSrv.prototype.DTTTrace=function(a,d,f){if(this.CmdSets[d].IdxForm!=this.MainFrm.ActiveFormIdx()&&this.CmdSets[d].IdxForm!=0){return}var e=(!this.CmdSets[d].bEnabled(this.MainFrm.ActiveFormIdx())||!this.CmdSets[d].bVisible(this.MainFrm.ActiveFormIdx()));if(!e){for(var b=0;b<this.CmdSets[d].uCommands();b++){if(!this.CmdSets[d].bCommands(b).IsEnabled(this.MainFrm.ActiveFormIdx())||!this.CmdSets[d].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())){e=true;break}}}if(!e){return}if(a.DTTObj.AddTraceItem(this.CmdSets[d].iGuid,f,(f==DTTEngine.TRC_ITBUTBAR?"ButtonBar.Render":"CommandSet.Render"),"")){var c="E="+(this.CmdSets[d].bEnabled(this.MainFrm.ActiveFormIdx())?-1:0)+" V="+(this.CmdSets[d].bVisible(this.MainFrm.ActiveFormIdx())?-1:0);a.DTTObj.AddTraceToken(this.CmdSets[d].iGuid,DTTEngine.TRC_CMDCAPTION,(f==DTTEngine.TRC_ITBUTBAR?"ButtonBar.Caption":"CommandSet.Caption"),this.CmdSets[d].Caption,c);for(b=0;b<this.CmdSets[d].uCommands();b++){if(!this.CmdSets[d].bCommands(b).bEnabled(this.MainFrm.ActiveFormIdx())||!this.CmdSets[d].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())){c="E="+(this.CmdSets[d].bCommands(b).bEnabled(this.MainFrm.ActiveFormIdx())?-1:0)+" V="+(this.CmdSets[d].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())?-1:0);a.DTTObj.AddTraceToken(this.CmdSets[d].bCommands(b).iGuid,DTTEngine.TRC_CMDCOMMAND,(f==DTTEngine.TRC_ITBUTBAR?"ButtonBar.Button":"CommandSet.Cmd"),this.CmdSets[d].bCommands(b).Caption,c)}}}};CmdHandlerSrv.prototype.ExecCmdCode=function(b){for(var a=1;a<this.CmdLin.length;a++){if(this.CmdLin[a]==null){continue}if(this.CmdLin[a].CmdCode!=null&&this.CmdLin[a].CmdCode.equals(b)){if(this.CmdEnabled(a)){this.CmdClick(a);this.ShowMenu(a)}return true}}return false};CmdHandlerSrv.prototype.ShowMenu=function(f){var b=new Array(16);var g=this.CmdLin[f];var a=0;do{g=g.Parent;b[a++]=g;if(g!=null){if(!g.Expanded){g.Expand()}}}while(g!=null);for(var h=1;h<this.CmdSets.length;h++){if(this.CmdSets[h]==null){continue}var e=false;for(var d=0;d<a;d++){if(b[d]==this.CmdSets[h]){e=true;break}}if(!e&&this.CmdSets[h].Expanded){this.CmdSets[h].Expand()}}for(var h=1;h<this.CmdLin.length;h++){if(this.CmdLin[h]==null){continue}var e=false;for(var d=0;d<a;d++){if(b[d]==this.CmdLin[h]){e=true;break}}if(!e&&this.CmdLin[h].Expanded){this.CmdLin[h].Expand()}}};CmdHandlerSrv.prototype.GetIdx=function(a){return this.CmdLin[a].Index};CmdHandlerSrv.prototype.SetCmdCaption=function(b,c,a){if(!this.CmdSets[b].bCommands(c).Caption.equals(a)){this.CmdSets[b].bCommands(c).Caption=a;this.CmdSets[b].bCommands(c).RD3Change(RD3Glb.CMD_CAPTION)}};CmdHandlerSrv.prototype.GetCmdCaption=function(a,b){return this.CmdSets[a].bCommands(b).Caption};CmdHandlerSrv.prototype.SetCmdTooltip=function(b,c,a){if(!this.CmdSets[b].bCommands(c).ToolTip.equals(a)){this.CmdSets[b].bCommands(c).ToolTip=a;this.CmdSets[b].bCommands(c).RD3Change(RD3Glb.CMD_TOOLTIP)}};CmdHandlerSrv.prototype.GetCmdTooltip=function(a,b){return this.CmdSets[a].bCommands(b).ToolTip};CmdHandlerSrv.prototype.SetCmdIcon=function(b,c,a){if(this.CmdSets[b].bCommands(c).Image==null||!this.CmdSets[b].bCommands(c).Image.equals(a)){this.CmdSets[b].bCommands(c).Image=a;this.CmdSets[b].bCommands(c).RD3Change(RD3Glb.CMD_IMAGE)}};CmdHandlerSrv.prototype.GetCmdIcon=function(a,b){return this.CmdSets[a].bCommands(b).Image};CmdHandlerSrv.prototype.SetCmdVisible=function(b,c,a){this.CmdSets[b].bCommands(c).set_bVisible(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.GetCmdVisible=function(a,b){return this.CmdSets[a].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.SetCmdEnabled=function(b,c,a){this.CmdSets[b].bCommands(c).set_bEnabled(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.GetCmdEnabled=function(a,b){return this.CmdSets[a].bCommands(b).bEnabled(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.SetCmdCode=function(b,c,a){if(this.CmdSets[b].bCommands(c).CmdCode==null||!this.CmdSets[b].bCommands(c).CmdCode.equals(a)){this.CmdSets[b].bCommands(c).CmdCode=a}};CmdHandlerSrv.prototype.GetCmdCode=function(a,b){return this.CmdSets[a].bCommands(b).CmdCode};CmdHandlerSrv.prototype.SetCmdDBCode=function(b,c,a){this.CmdSets[b].bCommands(c).Code=a};CmdHandlerSrv.prototype.GetCmdDBCode=function(a,b){return this.CmdSets[a].bCommands(b).Code};CmdHandlerSrv.prototype.GetCommandsCount=function(a){return this.CmdSets[a].uCommands()};CmdHandlerSrv.prototype.SetCmdCaption2=function(b,c,a){if(!this.CmdLin[b].bCommands(c).Caption.equals(a)){this.CmdLin[b].bCommands(c).Caption=a;this.CmdLin[b].bCommands(c).RD3Change(RD3Glb.CMD_CAPTION)}};CmdHandlerSrv.prototype.GetCmdCaption2=function(a,b){return this.CmdLin[a].bCommands(b).Caption};CmdHandlerSrv.prototype.SetCmdTooltip2=function(b,c,a){if(!this.CmdLin[b].bCommands(c).ToolTip.equals(a)){this.CmdLin[b].bCommands(c).ToolTip=a;this.CmdLin[b].bCommands(c).RD3Change(RD3Glb.CMD_TOOLTIP)}};CmdHandlerSrv.prototype.GetCmdTooltip2=function(a,b){return this.CmdLin[a].bCommands(b).ToolTip};CmdHandlerSrv.prototype.SetCmdIcon2=function(b,c,a){if(this.CmdLin[b].bCommands(c).Image==null||!this.CmdLin[b].bCommands(c).Image.equals(a)){this.CmdLin[b].bCommands(c).Image=a;this.CmdLin[b].bCommands(c).RD3Change(RD3Glb.CMD_IMAGE)}};CmdHandlerSrv.prototype.GetCmdIcon2=function(a,b){return this.CmdLin[a].bCommands(b).Image};CmdHandlerSrv.prototype.SetCmdVisible2=function(b,c,a){this.CmdLin[b].bCommands(c).set_bVisible(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.GetCmdVisible2=function(a,b){return this.CmdLin[a].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.SetCmdEnabled2=function(b,c,a){this.CmdLin[b].bCommands(c).set_bEnabled(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.GetCmdEnabled2=function(a,b){return this.CmdLin[a].bCommands(b).bEnabled(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.SetCmdClassName2=function(b,c,a){this.CmdLin[b].bCommands(c).set_ClassName(a)};CmdHandlerSrv.prototype.GetCmdClassName2=function(a,b){return this.CmdLin[a].bCommands(b).ClassName()};CmdHandlerSrv.prototype.SetCmdCode2=function(b,c,a){if(this.CmdLin[b].bCommands(c).CmdCode==null||!this.CmdLin[b].bCommands(c).CmdCode.equals(a)){this.CmdLin[b].bCommands(c).CmdCode=a}};CmdHandlerSrv.prototype.GetCmdCode2=function(a,b){return this.CmdLin[a].bCommands(b).CmdCode};CmdHandlerSrv.prototype.SetCmdDBCode2=function(b,c,a){this.CmdLin[b].bCommands(c).Code=a};CmdHandlerSrv.prototype.GetCmdDBCode2=function(a,b){return this.CmdLin[a].bCommands(b).Code};CmdHandlerSrv.prototype.GetCommandsCount2=function(a){return this.CmdLin[a].uCommands()};CmdHandlerSrv.prototype.OpenPopup=function(d,g,c,h,e,a){if(a==undefined){a=null}var b=this.MainFrm.ActiveForm();if(a!=null&&a instanceof WebFormSrv){b=a}if(b!=null){if(c>=0&&h>=0){this.ShowPopup(d,"F"+c+"C"+h+"R"+e,b.FormIdx,g)}else{this.ShowPopup(d,null,b.FormIdx,g)}}};CmdHandlerSrv.prototype.ShowPopup=function(g,c,f,o){if(o==undefined){o=1}if(f==undefined){f=-1}if(typeof(f)=="number"){if(c==null){var k;if(f>0){k=this.MainFrm.GetFormByIndex(f,this.MainFrm.GetLiveForms())}else{k=this.MainFrm.ActiveForm()}if(k!=null){c=this.MainFrm.ActiveForm().ActiveElement}else{c=""}}var q=new IDVariant(0);var d=new IDVariant(o);this.FireOnOpenPopup(g,f,d,q);if(q.isFalse()){this.MainFrm.MenuIdx=g+":"+c+":"+f+"|"+d.intValue();var h=this.MainFrm.RD3AddEvent("popup",this.CmdSets[g].GetRD3Ident());h.SetAttribute("dir",d.toString());h.SetAttribute("form","frm:"+f);var l="";if(c.startsWith("M")){var e=parseInt(c.substr(1),10);c=this.CmdLin[e].GetRD3Ident();l="menu"}if(c.startsWith("F")){var a=c.indexOf("B");if(a>-1){l="box";c=l+":"+c.substr(a)+":"+c.substr(1,a-1)+":"+f.toString()}a=c.indexOf("C");if(a>-1){var n=c.indexOf("R");var j=parseInt(c.substr(n+1),10);if(!isNaN(j)){l="fld";c=l+":"+c.substr(a+1,n-a-1)+":"+c.substr(1,a-1)+":"+f.toString();var b=this.MainFrm.RD3FindField(c);if(b!=null){if(b.IdxPanel>=0){l="val";c=l+":"+(j+1)+":"+b.Index+":"+b.Parent.FrIndex+":"+b.Parent.Parent.FormIdx}}}}}if(c.startsWith("A")){var a=c.indexOf("C");if(a>-1){var n=c.indexOf("R");l="fld";c=l+":"+c.substr(a+1,n-a-1)+":"+c.substr(1,a-1)+":"+f.toString()}}h.SetAttribute("objid",c);h.SetAttribute("objtype",l)}}else{if(typeof(f)=="object"){var m=f;var q=new IDVariant(0);var d=new IDVariant(o);var f=((m instanceof WebFormSrv)?m.FormIdx:0);this.FireOnOpenPopup(g,f,d,q);if(q.isFalse()){var h=this.MainFrm.RD3AddEvent("popup",this.CmdSets[g].GetRD3Ident());h.SetAttribute("dir",d.toString());h.SetAttribute("objid",c)}}}};CmdHandlerSrv.prototype.ShowPopupXY=function(g,f,b,h){var c=new IDVariant(0);var d=new IDVariant(0);var a=((f instanceof WebFormSrv)?f.FormIdx:0);this.FireOnOpenPopup(g,a,d,c);if(c.isFalse()){var e=this.MainFrm.RD3AddEvent("popup",this.CmdSets[g].GetRD3Ident());e.SetAttribute("dir",d.toString());e.SetAttribute("xpos",b.toString());e.SetAttribute("ypos",h.toString())}};CmdHandlerSrv.prototype.FireOnOpenPopup=function(d,a,e,b){if(this.CmdSets[d].IdxForm==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdSets[d].iGuid,187,"CmdHandler.FireOnOpenPopup","MainFrm: Fire CmdSet "+this.CmdSets[d].Code+".OnOpenPopup Event");this.MainFrm.OnOpenPopup(this.CmdSets[d],e,b)}else{var c;if(a>0){c=this.MainFrm.GetFormByIndex(a,this.MainFrm.GetLiveForms())}else{c=this.MainFrm.ActiveForm()}if(c!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdSets[d].iGuid,187,"CmdHandler.FireOnOpenPopup","Form "+c.Caption()+": Fire CmdSet "+this.CmdSets[d].Code+".OnOpenPopup Event");c.OnOpenPopup(this.CmdSets[d],e,b)}}};CmdHandlerSrv.prototype.AutoCollapse=function(d){if(!d.Expanded&&d.Level<=this.MainFrm.MenuAutoCollapse){var a=new ArrayList();var c=d.Parent;while(c!=null){a.Add(c);c=c.Parent}for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]==null){continue}this.CollapseButThose(this.CmdSets[b],a)}}};CmdHandlerSrv.prototype.CollapseButThose=function(b,c){if(b.Expanded){if(!c.Contains(b)){b.Expand()}else{for(var a=0;a<b.iCommands.length;a++){this.CollapseButThose(b.iCommands[a],c)}}}};CmdHandlerSrv.prototype.GetCommandByCode=function(a){for(var b=1;b<this.CmdLin.length;b++){if(this.CmdLin[b]==null){continue}if(this.CmdLin[b].CmdCode!=null&&this.CmdLin[b].CmdCode.equals(a)){return this.CmdLin[b]}}return null};CmdHandlerSrv.prototype.OpenMultipleFormCS=function(e,g){var d=e&65535;var f=0;var a=0;for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]!=null&&this.CmdSets[b].IdxForm==d){if(f==0){f=b}a++}}if(a==0){return 0}for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]!=null&&this.CmdSets[b].IdxForm==e){return b-f}}var c=Glb.GetObjects(this.CmdSets,a,CmdHandlerSrv.FilledTo[0]);if(c==0){c=this.CmdSets.length;Array.resize(this.CmdSets,c+a)}for(var b=a-1;b>=0;b--){this.CmdSets[c+b]=new ACommandSrv();this.CmdSets[c+b].CopyFrom(this.CmdSets[f+b],g,e);this.CmdSets[c+b].Index=c+b}return c-f};CmdHandlerSrv.prototype.OpenMultipleFormCL=function(l,a){var j=l&65535;var e=0;for(var d=1;d<this.CmdLin.length;d++){var g=false;var b=this.CmdLin[d];while(b!=null){if(b.IdxForm==j){g=true;break}b=b.Parent}if(g){e=d;break}}for(var f=1;f<this.CmdLin.length;f++){var g=false;var b=this.CmdLin[f];while(b!=null){if(b.IdxForm==l){g=true;break}b=b.Parent}if(g){return f-e}}if(a.Count()==0){return 0}var k=Glb.GetObjects(this.CmdLin,a.Count(),CmdHandlerSrv.FilledTo[1]);if(k==0){k=this.CmdLin.length;Array.resize(this.CmdLin,k+a.Count())}for(var d=0;d<a.Count();d++){var h=a[d];this.CmdLin[k+d]=h;h.Index=k+d}return k-e};CmdHandlerSrv.prototype.CloseMultipleForm=function(c){for(var a=1;a<this.CmdLin.length;a++){if(this.CmdLin[a]!=null){var d=false;var b=this.CmdLin[a];while(b!=null){if(b.IdxForm==c){d=true;break}b=b.Parent}if(d){this.CmdLin[a]=null}}}for(var a=1;a<this.CmdSets.length;a++){if(this.CmdSets[a]!=null&&this.CmdSets[a].IdxForm==c){this.CmdSets[a]=null}}};CmdHandlerSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()};CmdHandlerSrv.prototype.GetRD3Name=function(){return"cmh"};CmdHandlerSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};CmdHandlerSrv.prototype.RD3RenderDifferences=function(e,l,j){var b=null;if(l){b=e.AddNewElement(this.GetRD3Ident())}else{for(var d=0;d<this.CmdSets.length;d++){if(this.CmdSets[d]!=null&&this.CmdSets[d].RD3NewObj){b=e.AddNewElement("ins");b.SetAttribute("parid",this.GetRD3Name());break}}}if(b==null&&this.RD3Changed){b=e.AddNewElement("chg")}if(b!=null){b.SetAttribute("id",this.GetRD3Ident())}var k=this.RD3Changed;if(l||this.RD3Changed){for(var d=0;d<this.RD3PropChg.length;d++){if(this.RD3PropChg[d]||l){this.SetRD3Property(d,b,l)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(l){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("clk",this.ClickEventDef.toString())}if(this.SuppressMenuAnimationDef!=null){b.SetAttribute("sma",this.SuppressMenuAnimationDef)}}var c=(l)?b:e;for(var d=this.CmdSets.length-1;d>=1;d--){var h=this.CmdSets[d];if(h==null){continue}if(j>0&&h.IdxForm!=j){continue}if(h.IsMenu){this.DTTTrace(this.MainFrm,d,DTTEngine.TRC_ITMENU)}else{if(h.IsToolbar&&h.ToolCont==-1){this.DTTTrace(this.MainFrm,d,DTTEngine.TRC_ITTOOLBAR)}else{if(h.IsToolbar){var a=false;if(this.MainFrm.ActiveForm()!=null&&h.IdxForm==this.MainFrm.ActiveForm().FormIdx){a=true}for(var m=0;m<this.MainFrm.StackForm.Count();m++){var g=this.MainFrm.StackForm[m];if(g.Docked&&g.FormIdx==h.IdxForm){a=true;break}}if(a){this.DTTTrace(this.MainFrm,d,DTTEngine.TRC_ITCAPTBAR)}}}}if(h.RD3NewObj){h.RD3RenderDifferences(b,true);h.RD3NewObj=false}else{if(h.RD3DelObj){h.RD3RenderDifferences(c,false);this.CmdSets[d]=null}else{k|=h.RD3RenderDifferences(c,l)}}}if(!l&&b!=null){e.RemoveNode(b);e.GetNode().appendChild(b.GetNode())}return k};CmdHandlerSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.CMH_SUPPRMENU:if(!this.iSuppressMenu&&b){break}c.SetAttribute("sup",this.iSuppressMenu?"1":"0");break}};CmdHandlerSrv.prototype.GenericDrag=function(c,a,h){var l=-1;var g=a.Parent;for(var e=0;e<g.uCommands();e++){if(g.bCommands(e).Index==a.Index){l=e;break}}var k=new IDVariant();if(a.Parent.IdxForm==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.Parent.iGuid,188,"CmdHandler.GenericDrag","MainFrm: Fire CmdSet "+a.Parent.Code+".OnGenericDrag Event");this.MainFrm.OnCmdSetGeneralDrag(a.Parent,k,new IDVariant(a.Index),new IDVariant(l))}else{var j=this.MainFrm.GetFormByIndex(a.Parent.IdxForm,this.MainFrm.GetLiveForms());if(j!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.Parent.iGuid,188,"CmdHandler.GenericDrag","Form "+j.Caption()+": Fire CmdSet "+a.Parent.Code+".GenericDrag Event");j.OnCmdSetGeneralDrag(a.Parent,k,new IDVariant(a.Index),new IDVariant(l))}}if(h instanceof WebFrameSrv){var b=h;var d=c.GetAttribute("oid");if(d.startsWith("tab")&&b.Parent!=null&&b.FrIndex>-1&&b.Parent.Frames[b.FrIndex].InTabbed&&b.Parent.Frames[b.Parent.Frames[b.FrIndex].TabIdx]!=null){var f=b.Parent.Frames[b.Parent.Frames[b.FrIndex].TabIdx].Content;f.GenericDrop(c,k)}else{b.GenericDrop(c,k)}}if(h instanceof ACommandSrv){this.GenericDrop(h,k)}};CmdHandlerSrv.prototype.GenericDrop=function(b,a){var c=-1;var f=b.Parent;for(var d=0;d<f.uCommands();d++){if(f.bCommands(d).Index==b.Index){c=d;break}}if(b.Parent.IdxForm==0){this.MainFrm.DTTObj.SetRequestName("Generic Drop","CmdSet"+b.Parent.Code+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.Parent.iGuid,188,"Acommand.GenericDrop","MainFrm: Fire CmdSet "+b.Parent.Code+".OnGenericDrop Event");this.MainFrm.OnCmdSetGeneralDrop(b.Parent,a,new IDVariant(b.Index),new IDVariant(c))}else{var e=this.MainFrm.GetFormByIndex(b.Parent.IdxForm,this.MainFrm.GetLiveForms());if(e!=null){this.MainFrm.DTTObj.SetRequestName("Generic Drop","CmdSet"+b.Parent.Code+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.Parent.iGuid,188,"CmdHandler.GenericDrop","Form "+e.Caption()+": Fire CmdSet "+b.Parent.Code+".OnGenericDrop Event");e.OnCmdSetGeneralDrop(b.Parent,a,new IDVariant(b.Index),new IDVariant(c))}}};CmdHandlerSrv.prototype.GetCommandSets=function(b){var a=new IDArray();for(var c=1;c<this.CmdSets.length;c++){if(this.CmdSets[c]!=null&&this.CmdSets[c].IdxForm==b){a.add_Object(this.CmdSets[c])}}return a};CmdHandlerSrv.prototype.GetCommandByDBCode=function(a){for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]==null||this.CmdSets[b].Code==null){continue}if(this.CmdSets[b].Code.equals(a)){return this.CmdSets[b]}}for(var b=1;b<this.CmdLin.length;b++){if(this.CmdLin[b]==null){continue}if(this.CmdLin[b].Code.equals(a)){return this.CmdLin[b]}}return null};CmdHandlerSrv.prototype.GenericCmdExpanded=function(a){if(a.uCommands()==0){return false}if(a.Level==1){return this.CmdSetExpanded(a.Index)}else{return this.CmdExpanded(a.Index)}};CmdHandlerSrv.prototype.set_GenericCmdExpanded=function(b,a){if(b.uCommands()==0){return}if(b.Level==1){this.set_CmdSetExpanded(b.Index,a)}else{this.set_CmdExpanded(b.Index,a)}};CmdHandlerSrv.prototype.CommandClick=function(a){if(a.uCommands()>0){return}this.CmdClick(a.Index)};CmdHandlerSrv.prototype.AppendCommand=function(f,c,b){var e;if(typeof(f)=="number"){e=(b?this.CmdSets[f]:this.CmdLin[f])}else{e=f}var a=Math.max(this.CmdLin.length,CmdHandlerSrv.FilledTo[1]);if(a==0){a=1}Array.resize(this.CmdLin,a+1);this.CmdLin[this.CmdLin.length-1]=c;Array.resize(e.iCommands,e.iCommands.length+1);e.AddCommand(c);c.RD3NewObj=true;c.Parent=e;c.Index=this.CmdLin.length-1;c.Level=e.Level+1;c.IdxForm=e.IdxForm;c.IsMenu=e.IsMenu;c.IsToolbar=e.IsToolbar;var d=(e.iAllowPWA||c.IdxForm!=0?this.MainFrm.ActiveFormIdx():0);c.InitStatus(c.bEnabled(d),c.bVisible(d),c.bChecked(d));return c.Index};CmdHandlerSrv.prototype.AppendCmdSet=function(c){var a=Math.max(this.CmdSets.length,CmdHandlerSrv.FilledTo[0]);if(a==0){a=1}Array.resize(this.CmdSets,a+1);this.CmdSets[this.CmdSets.length-1]=c;c.RD3NewObj=true;c.IsCmdSet=true;c.Index=this.CmdSets.length-1;c.Level=1;if(c.IdxForm>0){c.ToolCont=0}var b=(c.iAllowPWA||c.IdxForm!=0?this.MainFrm.ActiveFormIdx():0);c.InitStatus(c.bEnabled(b),c.bVisible(b),false);return c.Index};CmdHandlerSrv.prototype.RemoveCommand=function(d,c,a){var b;if(typeof(d)=="number"){b=(a?this.CmdSets[d]:this.CmdLin[d])}else{b=d}if(b.iCommands.length==0||b.iCommands.length<c||c<0){return}var e=b.iCommands[c];this.CmdLin[e.Index]=null;b.RemoveCommand(c)};CmdHandlerSrv.prototype.RemoveCmdSet=function(a){if(a>=this.CmdSets.length||a<0){return}var b=this.CmdSets[a];b.RD3DelObj=true};function CustomElement(b,a){this.Parent=b;this.MainFrm;if(this.Parent instanceof WebFrameSrv){this.MainFrm=this.Parent.MainFrm}else{if(this.Parent instanceof PValueSrv){this.MainFrm=this.Parent.Parent.Parent.MainFrm}}this.Classname=a;this.Invocations=new ArrayList();this.Properties=new HashTableSrv();this.RD3PropChg=new HashTableSrv();this.RD3NewObj=false}CustomElement.prototype.GetRD3Ident=function(){if(this.Parent instanceof WebFrameSrv){var b=this.Parent;return this.GetRD3Name()+":"+b.FrIndex+":"+b.Parent.FormIdx}else{if(this.Parent instanceof PValueSrv){var a=this.Parent;return a.GetRD3Ident().replace(a.GetRD3Name(),this.GetRD3Name())}else{return""}}};CustomElement.prototype.GetRD3Name=function(){return"cse"};CustomElement.prototype.RD3RenderDifferences=function(f,g){var h=this.RD3PropChg.count()>0||this.Invocations.Count()>0;var c;if(g){c=f.AddNewElement(this.GetRD3Name());c.SetAttribute("cls",this.Classname);var d=this.GetEventsList();if(d.length>0){c.SetAttribute("evl",d)}}else{if(h){c=f.AddNewElement("chg")}else{return null}}c.SetAttribute("id",this.GetRD3Ident());if(g||this.RD3PropChg.count()>0){var k=this.Properties.keys();for(var e=0;e<k.length;e++){var a=k[e];if(this.RD3PropChg.containsKey(a)||g){c.SetAttribute(a,IDL.JSON_Stringify(this.Properties[a]))}}this.RD3PropChg.clear()}for(var e=0;e<this.Invocations.Count();e++){var b=this.Invocations[e];var j=c.AddNewElement("invoke");j.SetAttribute("met",b.method);j.SetAttribute("args",IDL.JSON_Stringify(b["arguments"]))}this.Invocations.Clear();return c};CustomElement.prototype.GetEventsList=function(){var d;if(this.Parent instanceof WebFrameSrv){d=this.Parent.Code}else{if(this.Parent instanceof PValueSrv){d=this.Parent.Parent.FieldCode}}var c="";for(var a in this.ParentForm()){if(a.substring(0,d.length+1)!=d+"_"){continue}var b=a.substring(d.length+1);if(b=="CellActivated"||b=="ValidateCell"){continue}c+=(c.length>0?"|":"")+b}return c};CustomElement.prototype.ParentForm=function(){if(this.Parent instanceof WebFrameSrv){return this.Parent.Parent}if(this.Parent instanceof PValueSrv){return this.Parent.Parent.Parent.Parent}return null};CustomElement.prototype.GetClassname=function(){return this.Classname};CustomElement.prototype.Clear=function(){this.Properties.clear()};CustomElement.prototype.set_Property=function(a,b){this.Properties[a]=IDMap.Wrap(b);this.RD3PropChg[a]=true};CustomElement.prototype.Property=function(a){var b=this.Properties[a];if(b==IDVariant.TRUE||b==IDVariant.FALSE){return b.booleanValue()}return b};CustomElement.prototype.InvokeMethod=function(c,b){var a=new HashTableSrv();a.method=c;a["arguments"]=b;this.Invocations.Add(a)};CustomElement.prototype.HandleRD3Event=function(e){var j=e.GetAttribute("par1");var l=IDL.JSON_Parse(e.GetAttribute("par2"));var o="";var c="";if(this.Parent instanceof WebFrameSrv){var h=this.Parent;c=h.Code;if(h.FrIndex>0){o=h.Parent.Frames[h.FrIndex].Caption}}else{if(this.Parent instanceof PValueSrv){var k=this.Parent.Parent;c=k.FieldCode;o=k.Header;if(k.Parent.Layout()==Glb.PANEL_LIST){o+=" (row "+(this.Parent.Index+1)+")"}}}var b=[];for(var f=0;f<l.Size();f++){if(l.GetDataType(new IDVariant(f)).intValue()==Glb.DT_OBJECT){b[f]=l.get_Object(new IDVariant(f))}else{b[f]=l.get_Value(new IDVariant(f))}}if(j=="$ChangeProp$"){var g=b[0];var a=b[1];this.MainFrm.DTTObj.SetRequestName(this.Classname+" property changed",this.Classname+" "+o+": property "+g+" instanceof changed",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddAssign("",o+"."+g+" := "+IDL.JSON_Stringify(a),"",IDL.JSON_Stringify(this.Properties[g]));this.Properties[g]=a}else{this.MainFrm.DTTObj.SetRequestName(this.Classname+" "+j,this.Classname+" "+o+": notify "+j+" event",DTTRequest.PRI_CMD);var n=this.ParentForm();var d=n[c+"_"+j];if(d==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",600,"CustomElement.HandleRD3Event","Event "+j+" not found")}else{d.apply(n,b)}}};function KnownErrors(){this.Header="";this.ErrCode=new Array(Glb.DBT_MAXDBTYPES);this.Description="";this.Effect="";this.Actions="";this.DBOper=0;this.Context=""}function ErrorHandlerSrv(c){this.UnexpectedApplicationTSA;this.UnexpectedDatabaseTSA;this.KnownErrorTSA;this.KErrors=new Array(6);this.TechSuppType=0;this.MainFrm=c;this.ErrorNumber;this.ErrorDescription;this.ErrorSource;this.ErrorConnection;this.ErrorDBOper;this.ErrorDBType;this.ErrorException;this.ErrorHeader;this.ErrorEffects;this.ErrorActions;this.flIsError;this.Semaphore=false;for(var b=0;b<this.KErrors.length;b++){this.KErrors[b]=new KnownErrors();for(var a=0;a<Glb.DBT_MAXDBTYPES;a++){this.KErrors[b].ErrCode[a]=-1}}}ErrorHandlerSrv.prototype.Init=function(){var b=-1;this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("334D5951-7BAD-4444-B5AB-D271A1942991","Errore imprevisto");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("AA37ED80-4FFF-4e69-BD4F-65ECA1ADE181","L'operazione non può essere completata.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("FE1CECD1-2FB4-4291-B10C-FCB3093D893F","1) Controlla i dati inseriti e riprova.<BR>2) Riprova più tardi.<BR>3) Richiedi supporto tecnico.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("EB82C1FF-6FBC-41b2-8630-3A55100F9AB3","Dati duplicati");this.KErrors[b].ErrCode[Glb.DBI_SQLSRV6]=2627;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV7]=2627;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV2K]=2627;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV05]=2627;this.KErrors[b].ErrCode[Glb.DBI_ORACLE7]=1;this.KErrors[b].ErrCode[Glb.DBI_ORACLE8]=1;this.KErrors[b].ErrCode[Glb.DBI_ORACLE9]=1;this.KErrors[b].ErrCode[Glb.DBI_ORACLE10]=1;this.KErrors[b].ErrCode[Glb.DBI_ORACLE11]=1;this.KErrors[b].ErrCode[Glb.DBI_ACCESS97]=0;this.KErrors[b].ErrCode[Glb.DBI_ACCESS2K]=-105121349;this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("1A413AF1-8D5E-4906-A3CC-D3BFF0D6A2C8","Esiste già un'altra riga con gli stessi dati identificativi. ");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("043D1E3B-32D8-4485-A38E-C5147F4AB4DA","Non posso inserire o aggiornare i dati come richiesto.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("A7B5392D-F82C-409f-AE7D-AD89A7E82E26","Cambia i valori dei dati identificativi della riga e riprova.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("7AD9B3CC-771A-4005-A242-4794C53BA7F1","Rilevati dati collegati");this.KErrors[b].DBOper=Glb.PANOP_DELETE;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV6]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV7]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV2K]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV05]=547;this.KErrors[b].ErrCode[Glb.DBI_ORACLE7]=2292;this.KErrors[b].ErrCode[Glb.DBI_ORACLE8]=2292;this.KErrors[b].ErrCode[Glb.DBI_ORACLE9]=2292;this.KErrors[b].ErrCode[Glb.DBI_ORACLE10]=2292;this.KErrors[b].ErrCode[Glb.DBI_ORACLE11]=2292;this.KErrors[b].ErrCode[Glb.DBI_ACCESS97]=-1612;this.KErrors[b].ErrCode[Glb.DBI_ACCESS2K]=-534971980;this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("256A93D4-7C6C-452d-BF48-0D6E774B84D1","Il database contiene altri dati collegati a quello in fase di cancellazione.");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("607A5133-84B2-44fb-9514-A72D1BF8DFBC","Non posso cancellare la riga richiesta.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("275B7DA0-2153-42fb-B52F-5883456BB99A","Cancella prima gli altri dati collegati e riprova.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("6EEB0870-47CD-4e2f-99B7-69F8464B42FB","Dati correlati inesistenti");this.KErrors[b].ErrCode[Glb.DBI_SQLSRV6]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV7]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV2K]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV05]=547;this.KErrors[b].ErrCode[Glb.DBI_ORACLE7]=2291;this.KErrors[b].ErrCode[Glb.DBI_ORACLE8]=2291;this.KErrors[b].ErrCode[Glb.DBI_ORACLE9]=2291;this.KErrors[b].ErrCode[Glb.DBI_ORACLE10]=2291;this.KErrors[b].ErrCode[Glb.DBI_ORACLE11]=2291;this.KErrors[b].ErrCode[Glb.DBI_ACCESS97]=-1613;this.KErrors[b].ErrCode[Glb.DBI_ACCESS2K]=-535037517;this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("6FF4CBF8-AD34-4acc-BC3C-6740453DEEAC","Il database non contiene i dati correlati indicati.");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("B40AE904-E285-48a9-AA11-A3E993732B91","Non posso inserire o aggiornare i dati come richiesto.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("8307D495-E052-402d-98C7-7AE3CB83671B","Modifica i valori dei dati correlati, oppure inserisci i nuovi dati correlati richiesti nelle relative videate.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("6E900A2B-70E6-4b12-B066-4E5AD1A1C5BB","Errore nei parametri di ricerca!");for(var a=0;a<Glb.DBT_MAXDBTYPES;a++){this.KErrors[b].ErrCode[a]=-542379020}this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("A981150D-E216-4bf3-B769-B0F025AE18A8","I parametri di ricerca contengono dati errati.");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("A158B32B-223C-425a-8B79-2C3EF75DF67C","Non posso cercare i dati come richiesto.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("8599406C-D202-4afe-8551-E0BB65DA2440","Controlla i parametri di ricerca e riprova.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("1F9BDBA6-A602-4342-A5C6-240594AA7C7A","Dati già modificati!");for(var a=0;a<Glb.DBT_MAXDBTYPES;a++){this.KErrors[b].ErrCode[a]=-100001}this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("9F5D6236-FBC3-47d2-A012-F74A66DFCE25","La riga in fase di modifica era già stata cambiata da un altro utente");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("BF6E4F9F-21AC-40d6-A132-E80DA8B28DCC","Non posso modificare i dati come richiesto.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("095FFFB6-27B2-406f-9CC3-F0CBB361221E","Riesegui la ricerca in modo da vedere i nuovi dati, poi sarà possibile modificarli.")};ErrorHandlerSrv.prototype.Render3=function(b){this.DTTTrace(this.MainFrm);b.SetAttribute("hdr",this.ErrorHeader);b.SetAttribute("num",this.ErrorNumber.toString());b.SetAttribute("des",this.ErrorDescription);b.SetAttribute("eff",this.ErrorEffects);b.SetAttribute("act",this.ErrorActions);b.SetAttribute("src",this.ErrorSource);if(this.ErrorException!=null&&this.MainFrm.ParamsObj().ICDebug==1){if(this.ErrorException!=null&&this.ErrorException.message!=this.ErrorDescription){b.SetAttribute("erm",this.ErrorException.message)}var a=this.ErrorException.stack;b.SetAttribute("exc",a)}};ErrorHandlerSrv.prototype.ClearError=function(){this.flIsError=false};ErrorHandlerSrv.prototype.IsError=function(){return this.flIsError};ErrorHandlerSrv.prototype.PanelError=function(d,f,a,b,c,g){WriteToConsoleError("[ErrorHandler::PanelError] Panel "+d.Code+" error: "+g);this.GetErrorParam(f,a,b,c,g,d.GetRTCGuid(Glb.OBJ_PANEL,0));this.MainFrm.TraceError(g)};ErrorHandlerSrv.prototype.ProcError=function(a,c,b){WriteToConsoleError("[ErrorHandler::ProcError] Proc error: "+b);this.GetErrorParam(null,0,0,a+" - "+c,b,"");this.MainFrm.TraceError(b)};ErrorHandlerSrv.prototype.GetErrorParam=function(r,s,b,l,t,n){if(this.Semaphore){return}this.ErrorNumber=0;this.ErrorDescription=null;this.ErrorException=t;if(t!=null){this.ErrorDescription=t.message;this.ErrorNumber=ErrorHandlerSrv.GetErrorNumber(t)}this.ErrorSource=l;this.ErrorConnection=r;this.ErrorDBOper=b;this.ErrorDBType=s;var a=0;var m=this.ErrorDBType;while(m>0){a=a+1;m=m>>1}var v=-1;for(var q=0;q<this.KErrors.length;q++){if(this.KErrors[q].ErrCode[a]==this.ErrorNumber&&(this.KErrors[q].DBOper==0||this.KErrors[q].DBOper==this.ErrorDBOper)&&(this.KErrors[q].Context==null||this.KErrors[q].Context.length==0||this.Context.equals(this.KErrors[q].Context))){v=q;this.ErrorHeader=this.KErrors[v].Header;this.ErrorEffects=this.KErrors[v].Effect;this.ErrorActions=this.KErrors[v].Actions;this.ErrorDescription=this.KErrors[v].Description;break}}if(v==-1){for(var q=0;q<this.KErrors.length;q++){for(var o=0;o<Glb.DBT_MAXDBTYPES;o++){if(this.KErrors[q].ErrCode[o]!=-1){break}}if(o==Glb.DBT_MAXDBTYPES&&(this.KErrors[q].Context==null||this.KErrors[q].Context.length==0||n.equals(this.KErrors[q].Context))){v=q}switch(this.ErrorDBOper){case Glb.PANOP_FIND:this.ErrorEffects=this.MainFrm.RTCObj.GetConst("FCFC62DA-1CEA-4300-817C-7A1701CC8A22","Non posso cercare i dati.",true);break;case Glb.PANOP_DELETE:this.ErrorEffects=this.MainFrm.RTCObj.GetConst("0B6EDF83-52B0-4706-B249-F15FBC0B6347","Non posso cancellare la riga selezionata.",true);break;case Glb.PANOP_UPDATE:this.ErrorEffects=this.MainFrm.RTCObj.GetConst("DB2DD729-2623-43BB-95E5-93606D10A4DB","Non posso inserire o aggiornare i dati.",true);break;default:if(v!=-1){this.ErrorEffects=this.KErrors[v].Effect}break}if(v!=-1){this.ErrorHeader=this.KErrors[v].Header;this.ErrorActions=this.KErrors[v].Actions}}}if(this.ErrorHeader==null){this.ErrorHeader=""}if(this.ErrorActions==null){this.ErrorActions=""}if(this.ErrorEffects==null){this.ErrorEffects=""}var d=new IDVariant(this.ErrorHeader);var k=new IDVariant(this.ErrorNumber);var f=new IDVariant(this.ErrorDescription);var g=new IDVariant(this.ErrorEffects);var h=new IDVariant(this.ErrorActions);var c=new IDVariant(this.ErrorSource);var x=new IDVariant(false);this.Semaphore=true;this.MainFrm.OnException(d,k,f,g,h,c,x);this.Semaphore=false;if(!x.booleanValue()){this.ErrorHeader=d.stringValue();this.ErrorNumber=k.intValue();this.ErrorDescription=f.stringValue();this.ErrorEffects=g.stringValue();this.ErrorActions=h.stringValue();this.ErrorSource=c.stringValue();this.flIsError=true;var u=this.MainFrm.RD3AddEvent("error","");u.CanSendInFulltree=true}};ErrorHandlerSrv.prototype.ShowMessage=function(f,j,a,g,b,c,e,d){this.ErrorHeader=f;this.ErrorNumber=j;this.ErrorDescription=a;this.ErrorEffects=g;this.ErrorActions=b;this.ErrorSource=c;this.flIsError=true;var h=this.MainFrm.RD3AddEvent("error","");h.CanSendInFulltree=true};ErrorHandlerSrv.prototype.ConfigureErrorMessages=function(c){this.KErrors=new Array(c.RecordCount());for(var b=0;b<this.KErrors.length;b++){this.KErrors[b]=new KnownErrors()}try{var d=0;while(!c.EOF()){this.KErrors[d].Actions=c.Get("RTC_Actions").stringValue();this.KErrors[d].Context=c.Get("RTC_Context").stringValue();this.KErrors[d].DBOper=c.Get("RTC_DBOper").intValue();this.KErrors[d].Description=c.Get("RTC_Description").stringValue();this.KErrors[d].Effect=c.Get("RTC_Effect").stringValue();this.KErrors[d].Header=c.Get("RTC_Header").stringValue();for(var b=1;b<Glb.DBT_MAXDBTYPES;b++){this.KErrors[d].ErrCode[b]=-1;var a=c.Get("RTC_ErrCode"+(b));if(a.Type!=IDVariant.NULL){this.KErrors[d].ErrCode[b]=a.intValue()}}d++;c.MoveNext()}}catch(f){WriteToConsoleError("[ErrorHandler.ConfigureErrorMessages] Exception: "+f)}};ErrorHandlerSrv.prototype.DTTTrace=function(a){if(a.DTTObj.AddTraceItem("",DTTEngine.TRC_ITERROR,"Error.Render","")){a.DTTObj.AddTraceToken("",DTTEngine.TRC_ERRNUMBER,"Number",this.ErrorNumber,"");a.DTTObj.AddTraceToken("",DTTEngine.TRC_ERRDESCR,"Description",this.ErrorDescription,"")}};ErrorHandlerSrv.GetErrorNumber=function(a){return a.code};function Glb(){}Glb.FKMaxNum=12;Glb.GlbRefModIdx=1;Glb.FilledTo=0;Glb.ITEM_MENU="IWMenu";Glb.ITEM_SBIND="IWSbInd";Glb.ITEM_FORM="IWForm";Glb.ITEM_BLOB="IWBlob";Glb.ITEM_FORMLIST="IWFormList";Glb.ITEM_UPLOAD="IWUpload";Glb.ITEM_FILES="IWFiles";Glb.ITEM_TREE_EXP="IWTreeExp";Glb.ITEM_TREE_CLICK="IWTreeClick";Glb.ITEM_TREE_DROP="IWTreeDrop";Glb.ITEM_GRAPH_CLICK="IWGraphClick";Glb.ITEM_APP="IWApp";Glb.ITEM_LOGIN="IWLogin";Glb.ITEM_LOGOFF="IWLogoff";Glb.ITEM_DTT="IWDTT";Glb.ITEM_TEST="IWTest";Glb.ITEM_HELP="IWHelp";Glb.ITEM_FRAMES="IWFrames";Glb.ITEM_RD="IWRD";Glb.ITEM_RD3="RD3";Glb.ITEM_W3C="IW3C";Glb.ITEM_STREAM="IWStream";Glb.ITEM_SYNC="SYNC";Glb.ITEM_OWA="OWA";Glb.ITEM_OAUTH="OAUTH";Glb.ROI_COMMAND=1;Glb.ROI_CMDSET=2;Glb.ROI_PFIELD=3;Glb.ROI_PPAGE=4;Glb.ROI_PGROUP=5;Glb.ROI_PANEL=6;Glb.ROI_TREEITEM=7;Glb.ROI_QRYWL=8;Glb.ROI_REPORT=9;Glb.ROI_SECTION=10;Glb.ROI_RPTBOX=11;Glb.ROI_RPTSPAN=12;Glb.ROI_OBJECT=13;Glb.DBT_ACCESS97=1;Glb.DBT_ORACLE7=2;Glb.DBT_ORACLE8=4;Glb.DBT_SQLSRV6=8;Glb.DBT_SQLSRV7=16;Glb.DBT_ODBC=32;Glb.DBT_ACCESS2K=64;Glb.DBT_SQLSRV2K=128;Glb.DBT_SQLSRV05=256;Glb.DBT_ORACLE9=512;Glb.DBT_ORACLE10=1024;Glb.DBT_ORACLE11=2048;Glb.DBT_DB2400=4096;Glb.DBT_DB2UDB=8192;Glb.DBT_POSTG8=16384;Glb.DBT_MYSQL5=32768;Glb.DBT_SQLITE=65536;Glb.DBI_ACCESS97=1;Glb.DBI_ORACLE7=2;Glb.DBI_ORACLE8=3;Glb.DBI_SQLSRV6=4;Glb.DBI_SQLSRV7=5;Glb.DBI_ODBC=6;Glb.DBI_ACCESS2K=7;Glb.DBI_SQLSRV2K=8;Glb.DBI_SQLSRV05=9;Glb.DBI_ORACLE9=10;Glb.DBI_ORACLE10=11;Glb.DBI_ORACLE11=12;Glb.DBI_DB2400=13;Glb.DBI_DB2UDB=14;Glb.DBI_POSTG8=15;Glb.DBI_MYSQL5=16;Glb.DBI_SQLITE=17;Glb.DBT_MAXDBTYPES=18;Glb.DBC_ACCESS=(Glb.DBT_ACCESS97|Glb.DBT_ACCESS2K);Glb.DBC_ORACLE=(Glb.DBT_ORACLE7|Glb.DBT_ORACLE8|Glb.DBT_ORACLE9|Glb.DBT_ORACLE10|Glb.DBT_ORACLE11);Glb.DBC_ODBC=(Glb.DBT_ODBC);Glb.DBC_SQLSRV=(Glb.DBT_SQLSRV6|Glb.DBT_SQLSRV7|Glb.DBT_SQLSRV2K|Glb.DBT_SQLSRV05);Glb.DBC_DB2=(Glb.DBT_DB2400|Glb.DBT_DB2UDB);Glb.DBC_POSTGRES=(Glb.DBT_POSTG8);Glb.DBC_MYSQL=(Glb.DBT_MYSQL5);Glb.DBC_SQLITE=(Glb.DBT_SQLITE);Glb.OBJ_RECT=-2;Glb.OBJ_PANEL=-1;Glb.OBJ_PAGE=0;Glb.OBJ_GROUP=1;Glb.OBJ_FIELD=2;Glb.OBJ_QUERY=3;Glb.RESMODE_NONE=1;Glb.RESMODE_MOVE=2;Glb.RESMODE_STRETCH=3;Glb.FRESMODE_NONE=1;Glb.FRESMODE_EXTEND=2;Glb.FRESMODE_STRETCH=3;Glb.PAN_QBEFORM=65536;Glb.PAN_SCROLLREC=131072;Glb.PAN_HASFORM=262144;Glb.PAN_HASLIST=524288;Glb.PAN_STARTFORM=1048576;Glb.PAN_CANUPDATE=2097152;Glb.PAN_CANDELETE=4194304;Glb.PAN_CANINSERT=8388608;Glb.PAN_CANSELECT=16777216;Glb.PAN_AUTOSAVE=33554432;Glb.PAN_USERETURN=32768;Glb.PAN_USETAB=16384;Glb.PAN_CANSORT=8192;Glb.PAN_SORTALWAYS=4096;Glb.PAN_LIKESEARCH=1024;Glb.PAN_NEWINSMODE=512;Glb.PAN_FREEWHENHID=256;Glb.PAN_LIKESTARTS=1;Glb.PAN_LIKECONTAINS=2;Glb.PS_NONE=0;Glb.PS_QBE=1;Glb.PS_DATA=2;Glb.PS_UPDATE=3;Glb.INITST_SEARCH=1;Glb.INITST_DATA=2;Glb.INITST_INSERT=3;Glb.INITST_NEWROW=4;Glb.INITST_SETFIND=5;Glb.INITST_SETFINDAL=6;Glb.OBJ_ENABLED=1;Glb.OBJ_VISIBLE=2;Glb.OBJ_VERTICAL=4;Glb.FLD_ISKEY=2048;Glb.FLD_LISTLIST=65536;Glb.FLD_INLIST=131072;Glb.FLD_INFORM=262144;Glb.FLD_NOHDRLIST=524288;Glb.FLD_NOHDRFORM=1048576;Glb.FLD_VERTHDRLIST=2097152;Glb.FLD_VERTHDRFORM=4194304;Glb.FLD_AUTOLOOKUP=8388608;Glb.FLD_NOACTD=16777216;Glb.FLD_ACTIVE=33554432;Glb.FLD_SUPERACTIVE=67108864;Glb.FLD_ISAGGR=32768;Glb.FLD_ISOPT=16384;Glb.FLD_ISDESCR=8192;Glb.FLD_CANACTIVATE=4096;Glb.PANEL_LIST=0;Glb.PANEL_FORM=1;Glb.PCM_FORMLIST=1;Glb.PCM_SEARCH=2;Glb.PCM_FIND=4;Glb.PCM_INSERT=8;Glb.PCM_DELETE=16;Glb.PCM_CANCEL=32;Glb.PCM_REQUERY=64;Glb.PCM_UPDATE=128;Glb.PCM_DUPLICATE=256;Glb.PCM_LOOKUP=512;Glb.PCM_BLOBEDIT=1024;Glb.PCM_BLOBDELETE=2048;Glb.PCM_BLOBNEW=4096;Glb.PCM_BLOBSAVEAS=8192;Glb.PCM_PRINT=16384;Glb.PCM_GROUP=32768;Glb.PCM_ATTACH=65536;Glb.PCM_CSV=131072;Glb.PCM_CUSTOM1=262144;Glb.PCM_CUSTOM2=524288;Glb.PCM_CUSTOM3=1048576;Glb.PCM_CUSTOM4=2097152;Glb.PCM_CUSTOM5=4194304;Glb.PCM_CUSTOM6=8388608;Glb.PCM_CUSTOM7=16777216;Glb.PCM_CUSTOM8=33554432;Glb.PCM_CUSTOM9=-1;Glb.PCM_CUSTOM10=-2;Glb.PCM_CUSTOM11=-4;Glb.PCM_CUSTOM12=-8;Glb.PCM_CUSTOM13=-16;Glb.PCM_CUSTOM14=-32;Glb.PCM_CUSTOM15=-64;Glb.PCM_CUSTOM16=-128;Glb.PCM_NAVIGATION=1073741824;Glb.QRY_VISDEF=0;Glb.QRY_VISNAT=1;Glb.TABOR_TOP=1;Glb.TABOR_LEFT=2;Glb.TABOR_BOTTOM=3;Glb.TABOR_RIGHT=4;Glb.SCRZONE_VISTAB=0;Glb.SCRZONE_HIDTAB=1;Glb.SCRZONE_AUTTAB=2;Glb.SCRZONE_PINNEDZONE=0;Glb.SCRZONE_UNPINNEDZONE=1;Glb.SCRZONE_HIDDENZONE=2;Glb.SCRZONE_SELECTEDMENU=-1;Glb.SCRZONE_SELECTEDNONE=-2;Glb.SCRZONE_SWIPENONE=1;Glb.SCRZONE_SWIPECOLLAPSABLE=2;Glb.SCRZONE_SWIPEHIDE=3;Glb.SCRZONE_VERTICALPOPOVER=0;Glb.SCRZONE_VERTICALCOLLAPSE=1;Glb.SCRZONE_VERTICALHIDE=2;Glb.SCRZONE_VERTICALNOCHANGE=3;Glb.PCI_FORMLIST=1;Glb.PCI_SEARCH=2;Glb.PCI_FIND=3;Glb.PCI_INSERT=4;Glb.PCI_DELETE=5;Glb.PCI_CANCEL=6;Glb.PCI_REQUERY=7;Glb.PCI_UPDATE=8;Glb.PCI_DUPLICATE=9;Glb.PCI_LOOKUP=10;Glb.PCI_BLOBEDIT=11;Glb.PCI_BLOBDELETE=12;Glb.PCI_BLOBNEW=13;Glb.PCI_BLOBSAVEAS=14;Glb.PCI_DUMMY=15;Glb.PCI_ATTACH=16;Glb.PCI_CSV=17;Glb.PANOP_FIND=1;Glb.PANOP_UPDATE=2;Glb.PANOP_DELETE=3;Glb.OPEN_MODALALT=-1;Glb.OPEN_MDI=0;Glb.OPEN_MODAL=1;Glb.OPEN_POPUP=2;Glb.BORDER_NONE=1;Glb.BORDER_THIN=2;Glb.BORDER_THICK=3;Glb.ERRTOOLTIP_OVER=1;Glb.ERRTOOLTIP_FOCUS=2;Glb.ERRTOOLTIP_IMMEDIATE=3;Glb.CLIVISPROP_HASCAPTION=1;Glb.CLIVISPROP_MENUBTN=2;Glb.CLIVISPROP_HASICON=4;Glb.CLIVISPROP_HASTITLE=8;Glb.CLIVISPROP_COMMAND=16;Glb.CLIVISPROP_CLOSEBTN=32;Glb.CLIVISPROP_HELPBTN=64;Glb.CLIVISPROP_DEBUGBTN=128;Glb.CLIVISPROP_ICONCLK=256;Glb.CLIVISPROP_AJAXIND=512;Glb.CLIVISPROP_TOOLBAR=1024;Glb.CLIVISPROP_STATUSBAR=2048;Glb.FORMVISPROP_HASCAPTION=1;Glb.FORMVISPROP_RESIZABLE=2;Glb.FORMVISPROP_MOVEABLE=4;Glb.FORMVISPROP_MINBTN=8;Glb.FORMVISPROP_MAXBTN=16;Glb.FORMVISPROP_CLOSEBTN=32;Glb.FORMVISPROP_CONFIRMBTN=64;Glb.FORMVISPROP_HELPBTN=128;Glb.FORMVISPROP_DEBUGBTN=256;Glb.FORMVISPROP_HASICON=512;Glb.FORMVISPROP_SHOWMESS=1024;Glb.FORMVISPROP_HASBACKBUT=2048;Glb.FLDVISPROP_CANSORT=1;Glb.FLDVISPROP_AUTOCLUSTER=2;Glb.FLDVISPROP_ONEACHKEY=4;Glb.FLDVISPROP_ONLYICON=8;Glb.FLDVISPROP_SHOWACT=16;Glb.FLDVISPROP_MANDATORY=32;Glb.FLDVISPROP_POPUPCONTROL=64;Glb.FLDVISPROP_HYPERLINK=128;Glb.PFLVISPROP_EXPORTNAMES=256;Glb.PFLVISPROP_AUTOTAB=512;Glb.PFLVISPROP_CANHDEINLST=4096;Glb.PFLVISPROP_HIDEINLIST=8192;Glb.PANVISPROP_HILITEROW=8192;Glb.PANVISPROP_HIDEPAGES=16384;Glb.FLDAGGRFUN_SUM=1;Glb.FLDAGGRFUN_AVG=2;Glb.FLDAGGRFUN_VAR=3;Glb.FLDAGGRFUN_STDDEV=4;Glb.FLDAGGRFUN_MIN=5;Glb.FLDAGGRFUN_MAX=6;Glb.FLDAGGRFUN_RANGE=7;Glb.SQL_SELECT=0;Glb.SQL_FROM=1;Glb.SQL_WHERE=2;Glb.SQL_GROUPBY=3;Glb.SQL_HAVING=4;Glb.SQL_ORDERBY=5;Glb.SQL_MAXQUERIES=6;Glb.VISCLR_FOREVALUE=1;Glb.VISCLR_FOREHEAD=2;Glb.VISCLR_FOREGROUP=3;Glb.VISCLR_BACKVALUE=4;Glb.VISCLR_ALTVALUE=5;Glb.VISCLR_BACKPANEL=6;Glb.VISCLR_BACKHEAD=7;Glb.VISCLR_BACKGROUP=8;Glb.VISCLR_HILIGHT=9;Glb.VISCLR_EDITING=10;Glb.VISCLR_BORDERS=11;Glb.VISCLR_BACKGRPFORM=12;Glb.VISCLR_FOREGRPFORM=13;Glb.VISCLR_BACKQBE=14;Glb.VISCLR_BACKREADONLY=15;Glb.VISCLR_HILIGHTREADONLY=16;Glb.VISCLR_BACKHEADFORM=17;Glb.VISCLR_ALTREADONLY=18;Glb.VISCLR_FOREHEADNN=19;Glb.VISCLR_ERRVALUE=20;Glb.VISCLR_WARNVALUE=21;Glb.VISCLR_ERRBACK=22;Glb.VISCLR_WARNBACK=23;Glb.VISFNT_VALUE=1;Glb.VISFNT_HEAD=2;Glb.VISFNT_GROUP=3;Glb.VISFNT_ERR=4;Glb.VISFNT_WARN=5;Glb.VISFNT_NOTNULL=6;Glb.VISCTRL_AUTO=1;Glb.VISCTRL_EDIT=2;Glb.VISCTRL_COMBO=3;Glb.VISCTRL_CHECK=4;Glb.VISCTRL_OPTION=5;Glb.VISCTRL_BUTTON=6;Glb.VISCTRL_HTMLEDIT=7;Glb.VISALN_AUTO=1;Glb.VISALN_SX=2;Glb.VISALN_CX=3;Glb.VISALN_DX=4;Glb.VISALN_JX=5;Glb.VISBRD_NONE=1;Glb.VISBRD_HORIZ=2;Glb.VISBRD_VERT=3;Glb.VISBRD_FRAME=4;Glb.VISBRD_SUNKEN=5;Glb.VISBRD_RAISED=6;Glb.VISBRD_ETCHED=7;Glb.VISBRD_BUMP=8;Glb.VISBRD_CUSTOM=9;Glb.VISBDI_VALUE=1;Glb.VISBDI_HEAD=2;Glb.VISBDI_GROUP=3;Glb.VISBDI_HDRFORM=4;Glb.VISBDI_GRPFORM=5;Glb.VISBDI_VALFORM=6;Glb.VISALI_VALUE=1;Glb.VISALI_HDRLIST=2;Glb.VISALI_HDRFORM=3;Glb.HDRGRP_NOHDR=1;Glb.HDRGRP_ONBORDER=2;Glb.HDRGRP_OUTER=3;Glb.HDRGRP_INNER=4;Glb.FL_VIS_PASSWORD=65536;Glb.FL_VIS_SHOWVALUE=131072;Glb.FL_VIS_SHOWDESCR=262144;Glb.FL_VIS_SHOWIMAGE=524288;Glb.FL_VIS_HYPERLINK=2097152;Glb.FL_VIS_EMBEDFONT=4194304;Glb.VISCBOR_TOP=1;Glb.VISCBOR_RIGHT=2;Glb.VISCBOR_BOTTOM=3;Glb.VISCBOR_LEFT=4;Glb.VISCTYP_SOLID=1;Glb.VISCTYP_DOTTED=2;Glb.VISCTYP_DASHED=3;Glb.VISCTYP_DOUBLE=4;Glb.VISGRADDIR_NONE=1;Glb.VISGRADDIR_HORIZ=2;Glb.VISGRADDIR_VERT=3;Glb.DT_UNSPEC=0;Glb.DT_NUM_INTEGER=1;Glb.DT_NUM_FLOAT=2;Glb.DT_NUM_FIXED=3;Glb.DT_NUM_CURRENCY=4;Glb.DT_CHAR=5;Glb.DT_CHAR_FIXED=12;Glb.DT_DATE=6;Glb.DT_TIME=7;Glb.DT_DATETIME=8;Glb.DT_DOC_TEXT=9;Glb.DT_DOC_OLE=10;Glb.DT_BOOLEAN=11;Glb.DT_OBJECT=13;Glb.DTC_NUMBER=1;Glb.DTC_DATE=2;Glb.DTC_CHAR=3;Glb.DTC_DOC=4;Glb.DTC_BOOL=5;Glb.DTC_NONE=6;Glb.TRANSF_NULL=0;Glb.TRANSF_NONE=1;Glb.TRANSF_TRIM=2;Glb.TRANSF_SUBSTR=3;Glb.TRANSF_ITOD=4;Glb.TRANSF_CTOD=5;Glb.TRANSF_C2TOI=6;Glb.MAX_PANEL_STRING=8;Glb.MASTER_ROWNAME=-1;Glb.FRAMETYPE_BUTTON=39;Glb.FRAMETYPE_PANEL=40;Glb.FRAMETYPE_GRAPH=43;Glb.FRAMETYPE_TREE=44;Glb.FRAMETYPE_TABBED=46;Glb.FORMDOCK_NONE=1;Glb.FORMDOCK_LEFT=2;Glb.FORMDOCK_RIGHT=3;Glb.FORMDOCK_TOP=4;Glb.FORMDOCK_BOTTOM=5;Glb.HEADER_GAP=4;Glb.SELECT_OFFSET=20;Glb.SCROLL_OFFSET=18;Glb.PAN_OFFS_X=8;Glb.PAN_OFFS_Y=24;Glb.PAN_OFFS_PAGEY=20;Glb.IMDB_CURSOR=10;Glb.RD_DISABLED=0;Glb.RD_FRAMES=1;Glb.RD_ACTIVE=2;Glb.WEBVALID_NONE=0;Glb.WEBVALID_STRICT=1;Glb.WEBSTY_DIV=0;Glb.WEBSTY_INP=1;Glb.WEBSTY_SPAN=2;Glb.WEBSTY_SEL=3;Glb.WEBSTY_TEXT=4;Glb.BRWCLS_IENORMAL=0;Glb.BRWCLS_IESTRICT=1;Glb.BRWCLS_FIREFOX=2;Glb.BRWSCL_NONE=0;Glb.BRWSCL_SYMBIAN=1;Glb.BRWSCL_SAFARI=2;Glb.BRWSCL_OPERA=3;Glb.ENG_IE=1;Glb.ENG_MOZ=2;Glb.FORMTOOL_NONE=0;Glb.FORMTOOL_LEFT=1;Glb.FORMTOOL_RIGHT=2;Glb.FORMTOOL_DISTRUB=3;Glb.WS_NORMAL=0;Glb.WS_MAXIMIZE=1;Glb.WS_MINIMIZE=2;Glb.FORMSCROLL_NONE=0;Glb.FORMSCROLL_HORIZ=1;Glb.FORMSCROLL_VERT=2;Glb.FORMSCROLL_BOTH=3;Glb.MENUTYPE_LEFTSB=1;Glb.MENUTYPE_RIGHTSB=2;Glb.MENUTYPE_MENUBAR=3;Glb.MENUTYPE_TASKBAR=4;Glb.MENUTYPE_GROUPED=5;Glb.MENUTYPE_GROUPEDR=6;Glb.LISTQBE_NO=0;Glb.LISTQBE_HEADER=-1;Glb.LISTQBE_ROW=-2;Glb.DARKMODE_YES="YES";Glb.DARKMODE_NO="NO";Glb.DARKMODE_AUTO="AUTO";Glb.GLOBALTOOLBARPOSITION_INSIDE=1;Glb.GLOBALTOOLBARPOSITION_UNDER=2;Glb.GetWebColor=function(b){if(b==-1){return"transparent"}else{var c=((b&255)<<16)|(b&65280)|((b&16711680)>>16);var d=c.toString(16);var a="";while(a.length<6-d.length){a+="0"}return"#"+a+d}};Glb.ClassDT=function(a){switch(a){case Glb.DT_NUM_CURRENCY:case Glb.DT_NUM_FIXED:case Glb.DT_NUM_FLOAT:case Glb.DT_NUM_INTEGER:return Glb.DTC_NUMBER;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:return Glb.DTC_DATE;case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:case Glb.DT_DOC_TEXT:return Glb.DTC_CHAR;case Glb.DT_DOC_OLE:return Glb.DTC_DOC;case Glb.DT_UNSPEC:return Glb.DTC_NONE;case Glb.DT_BOOLEAN:return Glb.DTC_BOOL;default:return Glb.DTC_NONE}};Glb.ToSql=function(c,b,a,d){if(d==undefined){d=0}switch(c.Type){case IDVariant.STRING:return IDL.CSql(c,IDL.FMT_CHAR,a,d);case IDVariant.DATETIME:switch(Glb.ClassDB(b)){case Glb.DBC_ACCESS:return IDL.CSql(c,IDL.FMT_DAT1,a,d);case Glb.DBC_ORACLE:case Glb.DBC_POSTGRES:return IDL.CSql(c,IDL.FMT_DAT3,a,d);case Glb.DBC_SQLITE:return IDL.CSql(c,IDL.FMT_DAT4,a,d);case DBC_DB2:return IDL.CSql(c,(b==DBT_DB2400&&a.UseAS400Date?IDL.FMT_DAT5:IDL.FMT_DAT2),a,d);default:return IDL.CSql(c,IDL.FMT_DAT2,a,d)}default:return IDL.CSql(c,IDL.FMT_NUM,a,d)}};Glb.AddCRFormula=function(b,a,c){return b+a+"= "+c+"||"};Glb.SQLWhereClause=function(b){var a=b.stringValue();if(a.length<3){return new IDVariant("1=1")}else{return new IDVariant(a.substr(6))}};Glb.IsFormUpdated=function(b){for(var a=1;a<b.length;a++){if(b[a].Content!=null&&b[a].Content instanceof IDPanelSrv){if(b[a].Content.IsContentModified()){return true}}}return false};Glb.IsFormInError=function(b){for(var a=1;a<b.length;a++){if(b[a].Content!=null&&b[a].Content instanceof IDPanelSrv){if(b[a].Content.IsContentInError()){return true}}}return false};Glb.UpdateForm=function(b){for(var a=1;a<b.length;a++){if(b[a].Content!=null&&b[a].Content instanceof IDPanelSrv){if(b[a].Content.IsContentModified()){b[a].Content.PanelCommand(Glb.PCM_UPDATE)}}}};Glb.ReleaseForm=function(b){for(var a=1;a<b.length;a++){if(b[a].Content!=null&&b[a].Content instanceof IDPanelSrv){b[a].Content.ReleaseLock()}}};Glb.CheckFrmRole=function(a,c){var b=c[a];if(b==null){return false}else{return b>=0}};Glb.SaveBlob=function(n,f,o,d,l){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()&&!l){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("SAVEBLOB",{BLOB:btoa(f.Value),PATH:(o?o.stringValue():""),FILENAME:(d?d.stringValue():"")}))}if(o==undefined){o=new IDVariant()}if(d==undefined){d=null}if(l==undefined){l=false}if(f.Type!=IDVariant.BLOB){return new IDVariant("")}var t=n.NativeBlob();try{var r=f.Value;if(!t&&r.length<16){return new IDVariant("")}if(t||r.substr(0,4)=="BLOB"){var b;if(t){b="bin"}else{var m=Math.min(r.indexOf(String.fromCharCode(0)),15);b=r.substring(4,m);r=r.substr(16)}if(l){var h="data:";var c=n.GetMimeType(b);if(c==null){c="application/octet-stream"}h+=c;h+=";base64,";h+=btoa(r);return new IDVariant(h)}else{var q=new Uint8Array(r.length);for(var g=0;g<r.length;g++){q[g]=r.charCodeAt(g)}var j=new BlobBuilder();j.append(q.buffer);var c=n.GetMimeType(b);var a=j.getBlob(c);return new IDVariant(URL.createObjectURL(a))}}else{return new IDVariant("")}}catch(k){n.getDTTObj().AddException("","Glb.SaveBlob","Can't save BLOB",k);return new IDVariant("")}};Glb.LoadBlob=function(n,o,g,k,c){if(!(o instanceof IDCachedRowSet)){k=o}var d="";if(k instanceof IDVariant){d=k.stringValue()}else{if(typeof(k)=="string"){d=k}}if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var q=new IDVariant();q.Type=IDVariant.BLOB;q.Value=atob(RD4_WebEntryPoint.ShellObject.SendCmd("LOADBLOB",{FILENAME:d}));return q}try{var q="";if(d.startsWith("http:")||d.startsWith("https:")||d.startsWith("blob:")){var m=new IDMap();m.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));m.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("BLOB"));var l=IDL.HttpRequest(n,new IDVariant(d),m);q=l.Value}else{if(d.startsWith("data:")){k={};k.FileName="";k.ContentType=d.substr("data:".length,d.indexOf(";")-"data:".length);k.Content=atob(d.substr(d.indexOf(";")+"base64,".length+1));k.ContentLength=k.Content.length}else{if(k&&k.Content&&k.Content.startsWith("data:")){k.Content=atob(k.Content.substr(k.Content.indexOf(";")+"base64,".length+1))}else{if(k instanceof IDVariant){throw new Error("LoadBlob from file path not supported outside the Native Shell")}}}if(!n.NativeBlob()){q="BLOB";var a="";if(k.FileName.length>0){var b=k.FileName.lastIndexOf(".");if(b>-1){a=k.FileName.substr(b+1)}}if(a.length==0&&n!=null&&n instanceof WebEntryPointSrv){a=n.GetExtensionFromMime(k.ContentType)}if(a.length>12){a=a.substr(0,12)}q+=a;for(var h=q.length;h<16;h++){q+=String.fromCharCode(0)}}q+=k.Content}var f=new IDVariant(q);f.Type=IDVariant.BLOB;if(o instanceof IDCachedRowSet){o.updateBinaryStream(g,f);o.updateRow();o.acceptChanges(c)}return f}catch(j){n.getDTTObj().AddException("","Glb.LoadBlob","Can't load BLOB",j);throw j}};Glb.CopyFile=function(c,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_COPYFILE",{DESTNAME:c,SRCNAME:b});if(a!="OK"){throw new Error(a)}return}};Glb.HTMLEncode=function(k,j,b,c,h){if(k==null){return""}if(k instanceof IDVariant){k=k.stringValue()}if(k.toString){k=k.toString()}if(j==undefined){j=false}if(b==undefined){b=false}if(c==undefined){c=false}if(h==undefined){h=false}var f="";var g=k.length;for(var e=0;e<g;e++){var a=k.charAt(e);var d=k.charCodeAt(e);if(!(d==9||d==10||d==13||(d>=32&d<=55295)||(d>=57344&&d<=65533))){if(c){continue}if(h){f=f+"&#"+d+";";continue}}if(b){if(d>126||d<=13){f=f+"&#"+d+";"}else{f=f+a}}else{switch(a){case'"':f=f+"&quot;";break;case"&":f=f+"&amp;";break;case"<":f=f+"&lt;";break;case">":f=f+"&gt;";break;case"\n":if(j){f=f+"<br/>"}else{f=f+"&#xA;"}break;case"\r":if(!j){f=f+"&#xD;"}break;default:if(d>126||d<=13){f=f+"&#"+d+";"}else{f=f+a}break}}}return f};Glb.HTMLDecode=function(k,h,b){if(k==null){return""}if(h==undefined){h=false}if(b==undefined){b=false}var e="";for(var d=0;d<k.length;d++){var a=k.charAt(d);if(a=="&"&&d<k.length-1&&k.charAt(d+1)=="#"){var g="";var j=false;for(d+=2;d<k.length;d++){if(k.charAt(d)!=";"){g+=k.charAt(d)}else{j=(g.length>0);break}}if(j){var f="";if(g.toLowerCase().startsWith("x")){f=new Number("0"+g)}else{f=new Number(g)}if(!isNaN(f)){e+=String.fromCharCode(f)}else{j=false}}if(!j){e+=a;d-=g.length+2}}else{if(h&&a=="&"&&k.substr(d,4)=="&lt;"){e+="<";d+=3}else{if(h&&a=="&"&&k.substr(d,4)=="&gt;"){e+=">";d+=3}else{if(h&&a=="&"&&k.substr(d,6)=="&quot;"){e+='"';d+=5}else{if(h&&a=="&"&&k.substr(d,5)=="&amp;"){e+="&";d+=4}else{if(b&&a=="&"&&d<k.length-1){var g="&";for(d+=1;d<k.length;d++){if(k.charAt(d)!=";"){g=g+k.charAt(d)}else{g=g+k.charAt(d);switch(g){case"&quot;":e=e+'"';break;case"&amp;":e=e+"&";break;case"&lt;":e=e+"<";break;case"&gt;":e=e+">";break}break}}}else{e=e+a}}}}}}}return e};Glb.URLDecode=function(a){return decodeURIComponent(a.replace(/\+/gi,"%20"))};Glb.URLEncode=function(a){return encodeURIComponent(a).replace(/%20/gi,"+")};Glb.GetLIV=function(e,b,d,f){var h="";switch(b){case Glb.DBT_ACCESS97:case Glb.DBT_ODBC:h="select max("+f+") from "+d;break;case Glb.DBT_ACCESS2K:case Glb.DBT_SQLSRV6:case Glb.DBT_SQLSRV7:case Glb.DBT_SQLSRV2K:case Glb.DBT_SQLSRV05:h="select @@identity as ident";break;case Glb.DBT_ORACLE7:case Glb.DBT_ORACLE8:case Glb.DBT_ORACLE9:case Glb.DBT_ORACLE10:case Glb.DBT_ORACLE11:h="select "+d+(f.length>0?"_"+f:"")+".currval from dual";break;case Glb.DBT_DB2400:h="select ZZ_VAL from ZZ_SEQUENCE where ZZ_SEQ='"+d.toUpperCase()+"'";break;case Glb.DBT_DB2UDB:h="select IDENTITY_VAL_LOCAL() from "+d.toUpperCase()+" fetch first 1 row only";break;case Glb.DBT_POSTG8:h="select currval('"+d+"_"+f+"_seq');";break;case Glb.DBT_MYSQL5:h="select LAST_INSERT_ID()";break;case Glb.DBT_SQLITE:h="select last_insert_rowid()";break}if(h.length>0){try{var a=new IDVariant();var c=e.OpenRSR(h);if(!c.EOF()){a=c.Get(1)}c.Close();return a}catch(g){WriteToConsoleError("[Glb::GetLIV] Can't get Last Inserted Value: "+g)}}return new IDVariant()};Glb.ClassDB=function(a){switch(a){case Glb.DBT_ACCESS97:case Glb.DBT_ACCESS2K:return Glb.DBC_ACCESS;case Glb.DBT_SQLSRV6:case Glb.DBT_SQLSRV7:case Glb.DBT_SQLSRV2K:case Glb.DBT_SQLSRV05:return Glb.DBC_SQLSRV;case Glb.DBT_ORACLE7:case Glb.DBT_ORACLE8:case Glb.DBT_ORACLE9:case Glb.DBT_ORACLE10:case Glb.DBT_ORACLE11:return Glb.DBC_ORACLE;case Glb.DBT_DB2400:case Glb.DBT_DB2UDB:return Glb.DBC_DB2;case Glb.DBT_POSTG8:return Glb.DBC_POSTGRES;case Glb.DBT_MYSQL5:return Glb.DBC_MYSQL;case Glb.DBT_SQLITE:return Glb.DBC_SQLITE;case Glb.DBT_ODBC:return Glb.DBC_ODBC;default:return 0}};Glb.ParamsPrefixDB=function(a){switch(Glb.ClassDB(a)){case Glb.DBC_ACCESS:case Glb.DBC_SQLSRV:return"@";case Glb.DBC_DB2:if(a==Glb.DBT_DB2UDB){return"@"}else{return":"}case Glb.DBC_ORACLE:case Glb.DBC_POSTGRES:case Glb.DBC_ODBC:return":";case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:return"?";default:return":"}};Glb.GetTD=function(f,g,a,c,e){var b=null;if(f.Type==IDVariant.NULL){return new IDVariant()}switch(g){case Glb.TRANSF_NULL:case Glb.TRANSF_NONE:b=new IDVariant(f);break;case Glb.TRANSF_TRIM:b=IDL.Trim(f,true,true);break;case Glb.TRANSF_SUBSTR:b=IDL.SubStr(f,new IDVariant(c),new IDVariant(e));break;case Glb.TRANSF_ITOD:var d=f.intValue();if(d==0){return new IDVariant()}if(String.compare(a,"YYYYMMDD",true)==0){b=IDL.ToDate(new IDVariant(d/10000),new IDVariant((d%10000)/100),new IDVariant(d%100))}else{if(String.compare(a,"YYMMDD",true)==0){b=IDL.ToDate(new IDVariant(d/10000+1900),new IDVariant((d%10000)/100),new IDVariant(d%100))}else{b=new IDVariant(f);b.changeType(IDVariant.DATETIME)}}break;case Glb.TRANSF_CTOD:break;case Glb.TRANSF_C2TOI:break}if(b==null){b=new IDVariant()}return b};Glb.GetTI=function(n,j,c,m,g,f){switch(c){case Glb.TRANSF_NULL:case Glb.TRANSF_NONE:case Glb.TRANSF_TRIM:return j;case Glb.TRANSF_SUBSTR:var o=n.stringValue();var l=j.stringValue();while(o.length<g-1){o+=" "}while(l.length<f){l+=" "}var b=o.substr(0,g-1);b+=l.substr(0,f);if(o.length>g+f-1){b+=o.substr(g+f-1)}return new IDVariant(b);case Glb.TRANSF_ITOD:if(j.Type==IDVariant.NULL){return new IDVariant(0)}var d=j.dateValue();if(String.compare(m,"YYYYMMDD",true)==0){return new IDVariant(d.Year*10000+d.Month*100+d.Day)}if(String.compare(m,"YYMMDD",true)==0){return new IDVariant((d.Year-1900)*10000+d.Month*100+d.Day)}var e=new IDVariant(j);e.changeType(IDVariant.INTEGER);return e;case Glb.TRANSF_CTOD:return IDL.Format(j,new IDVariant(m),null);case Glb.TRANSF_C2TOI:var k=n.stringValue();var h=j.intValue();while(k.length<g+1){k+=" "}k=k.substr(0,g-1)+String.fromCharCode(h%256)+k.substr(g);k=k.substr(0,g)+String.fromCharCode(h/256)+k.substr(g+1);return new IDVariant(k)}return new IDVariant(j)};Glb.IsJSharpAvailable=function(){return false};Glb.GetObjects=function(d,h,g){var f=0;var c=0;for(var e=Math.max(1,g);e<d.length;e++){if(d[e]==null){if(c==0){c=e}f++;if(f==h){return c}}else{c=0;f=0}}return 0};Glb.IsHTML=function(a){};Glb.RGB=function(f,e,c,d){if(d==undefined){d=100}return(d<<24)+(c<<16)+(e<<8)+f};Glb.BGRToARGB=function(a){var b={};b.R=a&255;b.G=(a&65280)>>8;b.B=(a&16711680)>>16;b.A=(a&4278190080)>>24;b.A=Math.floor(b.A*2.55);if(b.A>255){b.A=255}return b};Glb.HSB=function(e,l,f){if(e<0||e>360){throw new Error("The parameter Hue is out of range 0-360 (h="+e+")")}if(l<0||l>1){throw new Error("The parameter Saturation is out of range 0-1 (s="+l+")")}if(f<0||f>1){throw new Error("The parameter Brightness is out of range 0-1 (b="+f+")")}var a=f;var c=f;var k=f;if(l!=0){var g=f;var j=f*l;var d=f-j;if(e<60){a=g;c=e*j/60+d;k=d}else{if(e<120){a=-(e-120)*j/60+d;c=g;k=d}else{if(e<180){a=d;c=g;k=(e-120)*j/60+d}else{if(e<240){a=d;c=-(e-240)*j/60+d;k=g}else{if(e<300){a=(e-240)*j/60+d;c=d;k=g}else{if(e<=360){a=g;c=d;k=-(e-360)*j/60+d}else{a=0;c=0;k=0}}}}}}}return Glb.RGB(Math.round(a*255),Math.round(c*255),Math.round(k*255))};Glb.RGBtoHSB=function(a,f,m){var h,e,l;var n=new Array(3);var o=(a>f)?a:f;if(m>o){o=m}var j=(a<f)?a:f;if(m<j){j=m}l=o*1/255;if(o!=0){e=(o-j)*1/o}else{e=0}if(e==0){h=0}else{var c=((o-a)*1/(o-j));var k=((o-f)*1/(o-j));var d=((o-m)*1/(o-j));if(a==o){h=d-k}else{if(f==o){h=2+c-d}else{h=4+k-c}}h=h/6;if(h<0){h=h+1}}n[0]=h;n[1]=e;n[2]=l;return n};Glb.GetColorRed=function(a){return(Glb.BGRToARGB(a).R)};Glb.GetColorGreen=function(a){return(Glb.BGRToARGB(a).G)};Glb.GetColorBlue=function(a){return(Glb.BGRToARGB(a).B)};Glb.GetColorHue=function(a){var b=Glb.BGRToARGB(a);return Math.floor(Glb.RGBtoHSB(b.R,b.G,b.B)[0]*360)};Glb.GetColorSaturation=function(a){var b=Glb.BGRToARGB(a);return(Glb.RGBtoHSB(b.R,b.G,b.B))[1]};Glb.GetColorBrightness=function(a){var b=Glb.BGRToARGB(a);return(Glb.RGBtoHSB(b.R,b.G,b.B))[2]};Glb.WebColorToInt=function(a){if(a.equals("transparent")){return -1}else{var b=parseInt(a.replace("#",""),16);b=Glb.BGRToARGB(b);return Glb.RGB(b.B,b.G,b.R)}};Glb.ToRelativeUrl=function(a,b){var c;if(a.TempPath()&&b.startsWith(a.TempPath())){c="temp/"+b.substr(a.TempPath().length+1)}else{if(a.getRealPath()&&b.startsWith(a.getRealPath())){c=b.substring(a.getRealPath().length+1)}else{return b}}return c.replace(/\\/g,"/")};Glb.ToAbsolutePath=function(b,a){var c="";if(a.startsWith("temp/")||a.startsWith("temp\\")){c=b.TempPath()+"/"+a.substr(5)}else{c=b.getRealPath()+"/"+a}return c};function IDLocation(){this.Status=new IDVariant();this.Latitude=new IDVariant();this.Longitude=new IDVariant();this.Accuracy=new IDVariant();this.Altitude=new IDVariant();this.AltitudeAccuracy=new IDVariant();this.Heading=new IDVariant();this.Speed=new IDVariant();this.TStamp=new IDVariant()}IDLocation.prototype.init=function(c,b){if(c=="err"){this.Status=new IDVariant(b);this.Status.changeType(IDVariant.INTEGER)}else{this.Status=new IDVariant(0);var a=new StringTokenizer();a.setString(new IDVariant(b),new IDVariant("|"));this.Latitude=a.next();this.Latitude.changeType(IDVariant.FLOAT);this.Longitude=a.next();this.Longitude.changeType(IDVariant.FLOAT);this.Accuracy=a.next();this.Accuracy.changeType(IDVariant.FLOAT);this.Altitude=a.next();this.Altitude.changeType(IDVariant.FLOAT);this.AltitudeAccuracy=a.next();this.AltitudeAccuracy.changeType(IDVariant.FLOAT);this.Heading=a.next();this.Heading.changeType(IDVariant.FLOAT);this.Speed=a.next();this.Speed.changeType(IDVariant.FLOAT);this.TStamp=a.next();this.TStamp.changeType(IDVariant.DATETIME)}};function IDDeviceMotion(){this.AlphaOrientation=new IDVariant();this.BetaOrientation=new IDVariant();this.GammaOrientation=new IDVariant();this.XAcceleration=new IDVariant();this.YAcceleration=new IDVariant();this.ZAcceleration=new IDVariant();this.XGAcceleration=new IDVariant();this.YGAcceleration=new IDVariant();this.ZGAcceleration=new IDVariant();this.AlphaRotationRate=new IDVariant();this.BetaRotationRate=new IDVariant();this.GammaRotationRate=new IDVariant();this.CompassHeading=new IDVariant();this.CompassAccuracy=new IDVariant();this.MilliSecondsTime=new IDVariant()}IDDeviceMotion.prototype.init=function(b){var a=new StringTokenizer();a.setString(new IDVariant(b),new IDVariant("|"));this.XAcceleration=a.next();this.XAcceleration.changeType(IDVariant.FLOAT);this.YAcceleration=a.next();this.YAcceleration.changeType(IDVariant.FLOAT);this.ZAcceleration=a.next();this.ZAcceleration.changeType(IDVariant.FLOAT);this.XGAcceleration=a.next();this.XGAcceleration.changeType(IDVariant.FLOAT);this.YGAcceleration=a.next();this.YGAcceleration.changeType(IDVariant.FLOAT);this.ZGAcceleration=a.next();this.ZGAcceleration.changeType(IDVariant.FLOAT);this.AlphaRotationRate=a.next();this.AlphaRotationRate.changeType(IDVariant.FLOAT);this.BetaRotationRate=a.next();this.BetaRotationRate.changeType(IDVariant.FLOAT);this.GammaRotationRate=a.next();this.GammaRotationRate.changeType(IDVariant.FLOAT);this.AlphaOrientation=a.next();this.AlphaOrientation.changeType(IDVariant.FLOAT);this.BetaOrientation=a.next();this.BetaOrientation.changeType(IDVariant.FLOAT);this.GammaOrientation=a.next();this.GammaOrientation.changeType(IDVariant.FLOAT);this.CompassHeading=a.next();this.CompassHeading.changeType(IDVariant.FLOAT);this.CompassAccuracy=a.next();this.CompassAccuracy.changeType(IDVariant.FLOAT);this.MilliSecondsTime=a.next();this.MilliSecondsTime.changeType(IDVariant.INTEGER)};IDPanelSrv.EM_MSGBOX=0;IDPanelSrv.EM_MESSAGE=1;IDPanelSrv.EM_FIELD=2;IDPanelSrv.EM_NONE=3;IDPanelSrv.RT_LEFT=0;IDPanelSrv.RT_TOP=1;IDPanelSrv.RT_WIDTH=2;IDPanelSrv.RT_HEIGHT=3;function IDPanelSrv(b,d,a,e){WebFrameSrv.call(this,d);this.iStatus=Glb.PS_NONE;this.Flags=0;this.DesignFlags=-1;this.RoleFlags=-1;this.PanelMode=-1;this.NumRows=0;this.MaxHRow=0;this.PanelPage=0;this.HeaderSize=0;this.ShowToolbar=true;this.ShowStatusbar=true;this.ShowRowSelector=true;this.DynamicRows=0;this.DynamicHeight=false;this.Freezed=false;this.InitStatus=Glb.INITST_SEARCH;this.NumPagPerLine=0;this.QBEEmpty=b.ParamsObj().PanelQBEEmpty;this.DisableNotification=false;this.DisableChangeRow=false;this.EnableSortAfterPanelConf=false;this.ListLeft=0;this.ListTop=0;this.ListWidth=0;this.ListHeight=0;this.OriginalListHeight=0;this.OriginalBoundHeight=0;this.LastDynRows=0;this.OrgDynRows=0;this.AttR=0;this.ListP=1;this.ListR=0;this.ListDyn=-1;this.VListResizeMode=0;this.HListResizeMode=0;this.LastColumnStretched=0;this.LastResizeWidth=0;this.LastResizeHeight=0;this.LastDeltaY=0;this.iVisualStyle=0;this.Fields;this.Pages;this.Groups;this.Queries;this.MasterFields;this.PresentFields;this.SortingList=new ArrayList();this.RowErrors;this.RDRowSel=new Array(0);this.ValidatingRow=-1;this.IndText="";this.MasterRowName="";this.InfoPriority=0;this.BoundRect;this.AutoSaveSamFl=false;this.NeedAutoSave=false;this.EnabledCommands=b.ParamsObj().PanelCommandMask;this.ExtendedEnabledCommands=b.ParamsObj().PanelExtendedCommandMask;this.FinalUpdate=false;this.EditUpdErrorMode=b.ParamsObj().EditUpdErrorMode;this.EditInsErrorMode=b.ParamsObj().EditInsErrorMode;this.FinalUpdErrorMode=b.ParamsObj().FinalUpdErrorMode;this.FinalInsErrorMode=b.ParamsObj().FinalInsErrorMode;this.ConfirmDelete=b.ParamsObj().PanelConfirmDelete;this.HighlightDelete=b.ParamsObj().PanelHighlightDelete;this.iFixedCols=0;this.IMDB;this.MstTblIndex=0;this.mMstTblIndex=0;this.MasterDocMod;this.LastExtDoc=null;this.LastExtSchema=null;this.UseIMDB;this.VS;this.MyBook=null;this.LastMasterDocument=null;this.MasterPanelIdx=0;this.MasterPanelCode=null;this.iDetailCollection=-1;this.WasHidden=false;this.ScrollPos=-1;this.QBETip="";this.QBETipText="";this.iRowUpdateCount;this.ExportLabel=new IDVariant();this.iEnableInsertWhenLocked=b.ParamsObj().PanelEnableInsertWhenLocked;this.RefreshOnSort=b.ParamsObj().PanelRefreshOnSort;this.MaxRowsOrg=0;this.iEnableMultipleSel=b.ParamsObj().EnablePanelMultiSelection;this.iShowMultipleSel=b.ParamsObj().ShowPanelMultiSelection;this.iActiveMultipleSel=b.ParamsObj().ActivePanelMultiSelection;this.SelectedRows;this.iSelectAllOnlyVisible=b.ParamsObj().SelectAllOnlyVisible;this.FormTabOrder;this.ListTabOrder;this.FirstListFld=null;this.LastListFld=null;this.ActivateRightClick=false;this.GroupingList=new ArrayList();this.iEnabledGrouping=false;this.iShowGroups=false;this.GroupRoot;this.SendPositions=false;this.ForceSendPosition=false;this.DisableLookups=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.PAN_MAXPROPS);this.RD3ListCache=null;this.RD3FormCache=null;this.RD3UpdateCount=null;this.RowSelectEventDef=RD3Glb.EVENT_ACTIVE;this.ScrollEventDef=RD3Glb.EVENT_ACTIVE;this.ToolbarEventDef=RD3Glb.EVENT_ACTIVE;this.PageClickEventDef=RD3Glb.EVENT_ACTIVE;this.MultiSelEventDef=RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_CLIENTSIDE;this.FocusEventDef=RD3Glb.EVENT_CLIENTSIDE;this.TextSelectionEventDef=RD3Glb.EVENT_DEFERRED;this.MouseOverEventDef=RD3Glb.EVENT_CLIENTSIDE;this.ChangeLayoutAnimationDef=null;this.QBETipAnimationDef=null;this.RD3Validate=false;this.RD3ChangeSel=false;this.RD3SendChange=false;this.RD3Sendmulti=false;this.RD3ChangeListVis=false;this.BlockingCommands=Glb.PCM_FIND|Glb.PCM_REQUERY|Glb.PCM_DELETE|Glb.PCM_UPDATE|Glb.PCM_PRINT|Glb.PCM_CSV|Glb.PCM_ATTACH;this.ReorderColumn=false;this.ResizeColumn=false;this.TooltipOnEachRow=b.ParamsObj().TooltipOnEachRow;this.ResOnlyVisFlds=false;this.iVisualFlags=0;this.iLoadingPolicy=b.ParamsObj().LoadingPolicy;this.iPullToRefresh=b.ParamsObj().PullToRefresh;this.iSearchInContent=true;this.iUseListQBE=b.ParamsObj().PanelListQBE;if(this.iUseListQBE!=Glb.LISTQBE_NO){this.QBEEmpty=false}this.iSearchBoxMobileFld=-1;this.FluidPanel=false;this.iRowHeightResize=false;this.set_RowHeightResize(b.ParamsObj().PanelsRowHeightResize);this.DesignListHeight=-100;this.AllowMasterPanelNav=b.ParamsObj().AllowMasterPanelNav;if(this.MainFrm.IsMobile()&&this.MainFrm.ParamsObj().UseFluid&&this.iUseListQBE==Glb.LISTQBE_NO&&this.iSearchInContent==true){this.iUseListQBE=Glb.LISTQBE_ROW}this.FrIndex=a;this.Code=e;if(d.OpenAs!=Glb.OPEN_MDI){if(this.Lockable&&!b.IsMobile()){this.iLocked=false}}}IDPanelSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];IDPanelSrv[obj]=WebFrameSrv[obj]}IDPanelSrv.prototype.SearchObject=function(a){if(a.equals(this.Code)||(this.iGuid!=null&&this.iGuid.equals(a))){return this}else{return null}};IDPanelSrv.prototype.set_ShowInfoMessages=function(a){if(this.ShowInfoMessages&&!a){this.SetInfoMessage("")}this.ShowInfoMessages=a;this.RD3Change(RD3Glb.PAN_INFOMSG)};IDPanelSrv.prototype.Page=function(){return this.PanelPage};IDPanelSrv.prototype.set_Page=function(b){var a=new IDVariant();if(this.PanelPage!=b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,61,"IDPanel.OnChangePage","Panel "+this.GetDTTCaption()+": active page changing to "+this.Pages[b].Header+"; fire OnChangePage event")}this.Parent.OnChangePage(this,new IDVariant(b),a)}if(a.isFalse()){this.PanelPage=b;this.RD3Change(RD3Glb.PAN_PANELPAGE);this.CalcLayout();this.SetInput()}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,75,"IDPanel.OnChangePage","Panel "+this.GetDTTCaption()+": page changing canceled")}}};IDPanelSrv.prototype.set_LoadingPolicy=function(a){if(this.iLoadingPolicy!=a){this.iLoadingPolicy=a;this.RD3Change(RD3Glb.PAN_LOADPOL)}};IDPanelSrv.prototype.LoadingPolicy=function(){return this.iLoadingPolicy};IDPanelSrv.prototype.set_PullToRefresh=function(a){if(this.iPullToRefresh!=a){this.iPullToRefresh=a;this.RD3Change(RD3Glb.PAN_PULLREF)}};IDPanelSrv.prototype.PullToRefresh=function(){return this.iPullToRefresh};IDPanelSrv.prototype.set_SearchInContent=function(a){if(this.iSearchInContent!=a){this.iSearchInContent=a;if(this.MainFrm.IsMobile()&&this.MainFrm.ParamsObj().UseFluid&&this.iUseListQBE==Glb.LISTQBE_ROW&&a==false){this.iUseListQBE=Glb.LISTQBE_NO}}};IDPanelSrv.prototype.SearchInContent=function(){return this.iSearchInContent};IDPanelSrv.prototype.set_UseListQBE=function(b){var a=this.iUseListQBE;if(this.iUseListQBE!=b){this.iUseListQBE=b;this.RD3Change(RD3Glb.PAN_ENLISTQBE);if(this.iUseListQBE!=Glb.LISTQBE_NO){this.QBEEmpty=false}if(a==Glb.LISTQBE_ROW||b==Glb.LISTQBE_ROW){this.CalcLayout()}}};IDPanelSrv.prototype.UseListQBE=function(){return this.iUseListQBE};IDPanelSrv.prototype.UseListQBEEnabled=function(){return this.MainFrm.IsMobile()&&!this.MainFrm.IsIonic()?false:(this.iUseListQBE!=0&&((this.Flags&Glb.PAN_CANSELECT)>0))};IDPanelSrv.prototype.UseListQBEHeader=function(){return(this.iUseListQBE==Glb.LISTQBE_HEADER&&((this.Flags&Glb.PAN_CANSELECT)>0))};IDPanelSrv.prototype.UseListQBERow=function(){return(this.iUseListQBE==Glb.LISTQBE_ROW&&((this.Flags&Glb.PAN_CANSELECT)>0))};IDPanelSrv.prototype.Layout=function(){return this.PanelMode};IDPanelSrv.prototype.set_Layout=function(f){var b=new IDVariant();if((f==Glb.PANEL_LIST&&(this.Flags&Glb.PAN_HASLIST)==0)||(f==Glb.PANEL_FORM&&(this.Flags&Glb.PAN_HASFORM)==0)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,70,"IDPanel.Layout","Panel "+this.GetDTTCaption()+": can't change layout to "+(f==Glb.PANEL_FORM?"Form":"List")+" because it has not been defined at design time")}return}if((this.iStatus==Glb.PS_DATA||this.iStatus==Glb.PS_QBE)&&(this.PanelMode!=f)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,62,"IDPanel.OnChangeLayout","Panel "+this.GetDTTCaption()+": changing layout; fire OnChangeLayout event")}this.Parent.OnChangeLayout(this,new IDVariant(f),b);if(b.isFalse()){if(this.PanelMode==Glb.PANEL_LIST&&this.iStatus==Glb.PS_DATA){this.ListP=this.Queries[0].ActualPosition;this.ListR=this.AttR;this.ListDyn=this.DynamicRows;if(this.AttR>0||(this.IsPanelFixActiveRowWhenScrolled()&&this.AttR!=0)){var e=this.AttR;this.AttR=0;this.ScrollRecBy(e,this.MainFrm)}this.AttR=0;this.RD3Change(RD3Glb.PAN_ACTUALROW)}this.PanelMode=f;this.UpdateDynRows(-1);this.CalcLayout();this.RD3Change(RD3Glb.PAN_PANELMODE);var d=this.Queries[0].GetAttRecNumber();if((this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel())&&f==Glb.PANEL_LIST){d=this.ListP;this.AttR=this.ListR;if(this.ListDyn!=-1){this.SetDynRows(this.ListDyn,this.DynamicHeight)}}if(this.PanelMode==Glb.PANEL_LIST&&this.iStatus==Glb.PS_DATA){if(d-this.ListP>=this.NumRows){this.AttR=this.NumRows-1;d-=this.AttR}else{if(d-this.ListP<0){this.AttR=0}else{if(!this.MainFrm.IsMobile()&&!this.MainFrm.IsBootstrap()&&!this.IsFluidPanel()){this.AttR=d-this.ListP;d=this.ListP}}}if(d>this.Queries[0].RecordCount()){d=this.Queries[0].RecordCount();this.AttR=0}this.RD3Change(RD3Glb.PAN_ACTUALROW)}this.Queries[0].ScrollTo(d);this.UpdateDynRows(this.Queries[0].RecordCount());if(this.iStatus==Glb.PS_DATA){this.Parent.ClearMessages(this,null,-1);for(var c=0;c<this.Fields.length;c++){this.Parent.ClearMessages(this.Fields[c],null,-1)}var a=this.Queries[0].RecordCount();this.Queries[0].FillPanel(this.MainFrm);if(this.Queries[0].RecordCount()!=a){this.RD3Change(RD3Glb.PAN_TOTALROWS)}}this.ReValidate();if(this.HasFocus()){this.Parent.FocusPriority=0}this.SetInput(-1,this.FocusedColumn(),1,true)}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,76,"IDPanel.OnChangeLayout","Panel "+this.GetDTTCaption()+": layout change canceled")}}}else{if(this.iStatus==Glb.PS_UPDATE&&this.PanelMode!=f){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION);this.RD3Change(RD3Glb.PAN_ACTUALROW)}}};IDPanelSrv.prototype.RefreshLookup=function(c,a){if(c==undefined){c=null}if(a==undefined){a=null}if(this.DisableLookups){return}if(a==null&&c==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,189,"IDPanel.RefreshLookup","Panel "+this.GetDTTCaption()+": refreshing all lookups")}else{if(c!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,189,"IDPanel.RefreshLookup","Panel "+this.GetDTTCaption()+": refreshing "+c+" class lookups")}if(a!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,189,"IDPanel.RefreshLookup","Panel "+this.GetDTTCaption()+": refreshing "+a+" table lookups")}}for(var b=1;b<this.Queries.length;b++){var d=false;if(c==null&&a==null){d=true}else{if(c!=null&&this.Queries[b].MstTableName!=null&&String.compare(c,this.Queries[b].MstTableName,true)==0){d=true}else{if(a!=null&&this.Queries[b].MstTableName!=null&&String.compare(a,this.Queries[b].MstTableName,true)==0){d=true}}}if(d){this.Queries[b].ClearLookupBuffer()}}this.Queries[0].DoUpdateLookups(-1,this.MainFrm)};IDPanelSrv.prototype.RefreshDynProp=function(){this.ReValidate();if(this.MainFrm.ParamsObj().UseRD3){var a=1;if(this.Status()!=Glb.PS_QBE){a=this.Queries[0].RecordCount()+this.NumRows}this.RD3ListCache=new BitArray(a);this.RD3FormCache=new BitArray(a)}};IDPanelSrv.prototype.PanelCommand=function(m,e,k){if(e==undefined){e=0}if(k==undefined){k=false}var s=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": received command "+this.DecodeCommand(m)+"; fire OnPanelCommand event"+(k?" (USER operation)":""))}this.Parent.OnPanelCommand(this,new IDVariant(m),s,new IDVariant(k));if(s.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": command canceled")}return false}if(m==Glb.PCM_NAVIGATION&&!this.AllowMasterPanelNav&&this.Queries[0]!=null&&this.Queries[0].IsDO){var f=false;if(this.Queries[0].IDColl!=null){f=this.Queries[0].IDColl.IsModified()}else{var o=this.GetDocument();if(o!=null){f=o.IsModified()}}if(f){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,77,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": can't navigate (master document has changed and AllowMasterPanelNav parameter is false)")}return false}}switch(m){case Glb.PCM_NAVIGATION:switch(e){case 0:this.ScrollRecTo(0,this.MainFrm);this.SetInput(0,this.FocusedColumn(),1,false);this.SendPositions=true;break;case 1:if(this.PanelMode==Glb.PANEL_FORM){this.ScrollRecTo(this.Queries[0].RecordCount(),this.MainFrm)}else{this.ScrollRecTo(this.Queries[0].RecordCount()-this.NumRows+1,this.MainFrm);this.SetInput(this.NumRows-1,this.FocusedColumn(),1,false)}this.SendPositions=true;this.LoadMoreRows();break;case 2:var g=this.NumRows-((this.NumRows>1)?1:0);var h=this.Queries[0].ActualPosition;var n=this.Queries[0].RecordCount();if(h+g+this.NumRows>n){this.ScrollRecTo(n-this.NumRows+1,this.MainFrm);if(this.PanelMode==Glb.PANEL_LIST&&this.AttR!=this.NumRows-1&&h>n-this.NumRows){this.SetInput(this.NumRows-1,this.FocusedColumn(),1,false)}}else{if(g>0){this.ScrollRecBy(g,this.MainFrm)}}if(this.IsPanelFixActiveRowWhenScrolled()&&this.PanelMode==Glb.PANEL_LIST&&this.AttR<0){this.set_SelectedRow(0)}else{if(this.IsPanelFixActiveRowWhenScrolled()&&this.PanelMode==Glb.PANEL_LIST&&this.AttR>=this.NumRows){this.set_SelectedRow(this.NumRows-1)}}this.SendPositions=true;if(this.Queries[0].ActualPosition+this.NumRows>=this.Queries[0].RecordCount()){this.LoadMoreRows()}break;case 3:var g=this.NumRows-((this.NumRows>1)?1:0);var h=this.Queries[0].ActualPosition;this.ScrollRecBy(-g,this.MainFrm);if(this.PanelMode==Glb.PANEL_LIST&&this.AttR>0&&h==1){this.SetInput(0,this.FocusedColumn(),1,false)}if(this.IsPanelFixActiveRowWhenScrolled()&&this.PanelMode==Glb.PANEL_LIST&&this.AttR<0){this.set_SelectedRow(0)}else{if(this.IsPanelFixActiveRowWhenScrolled()&&this.PanelMode==Glb.PANEL_LIST&&this.AttR>=this.NumRows){this.set_SelectedRow(this.NumRows-1)}}this.SendPositions=true;break}break;case Glb.PCM_FIND:this.FindData(this.MainFrm,false,false);this.SetInput();this.SendPositions=true;break;case Glb.PCM_SEARCH:if(this.UseListQBEEnabled()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,78,"IDPanel.PanelCommand","Panel "+this.GetDTTCaption()+": can't go into QBE status beacause listQBE <> NO")}return false}if(this.Queries[0].IsDO&&this.Queries[0].IsMasterDO&&this.Queries[0].DocTempl==null){this.SetDocumentClass(0,this.Queries[0].MstTableName)}if(this.MaxRowsOrg>0){this.SetMaxRows(this.MaxRowsOrg)}this.EnterQBE();this.SetInput();this.SendPositions=true;break;case Glb.PCM_DELETE:if(this.EnableMultipleSel()&&this.ShowMultipleSel()){this.MultipleDelete(this.MainFrm)}else{this.DeleteRecord(this.MainFrm)}this.SendPositions=false;if(this.GroupingEnabled()&&this.ShowGroups()&&this.GroupRoot!=null&&this.Status()!=Glb.PS_QBE){this.RefreshGrouping(false)}break;case Glb.PCM_REQUERY:this.RefreshQuery(this.MainFrm);if(this.GroupingEnabled()&&this.ShowGroups()&&this.GroupRoot!=null&&this.Status()!=Glb.PS_QBE){this.RefreshGrouping(false)}this.SendPositions=false;break;case Glb.PCM_CANCEL:var b=this.IsNewRow(this.AttR);if(!b&&this.Queries[0].IsDO){var j=this.GetDocument(this.AttR);if(j!=null){b=j.Inserted()}}this.CancelUpdate(this.MainFrm);if(this.iLockable()&&this.MainFrm.IsMobile()&&this.Status()==Glb.PS_DATA){this.set_Locked(true);if(b&&(this.Flags&Glb.PAN_QBEFORM)!=0){this.set_Layout(Glb.PANEL_LIST)}}this.SendPositions=false;break;case Glb.PCM_UPDATE:this.UpdateRecords(this.MainFrm);if(this.iLockable()&&this.MainFrm.IsMobile()&&this.Status()==Glb.PS_DATA){this.set_Locked(true)}this.SendPositions=false;break;case Glb.PCM_INSERT:this.GoInsertRecord(this.MainFrm);this.SendPositions=true;break;case Glb.PCM_DUPLICATE:if(this.EnableMultipleSel()&&this.ShowMultipleSel()){var q=0;if(!this.IsDO()){for(var a=0;a<this.SelectedRows.length;a++){q+=this.SelectedRows[a]==true?1:0}}else{var l=this.Queries[0].IDColl;if(l!=null){l.set_UIMode(true);l.MoveFirst();while(l.GetAt()!=null){var j=l.GetAt();q+=j.Selected()==true?1:0;l.MoveNext()}l.set_UIMode(false)}}if(q==0&&this.MainFrm.ParamsObj().UseRD3){this.SendPositions=true;break}this.MultipleDuplicate(this.MainFrm)}else{this.DuplicateRecord(this.MainFrm)}this.SendPositions=true;break;case Glb.PCM_PRINT:this.PrintBook(this.MainFrm);this.SendPositions=false;break;case Glb.PCM_FORMLIST:this.set_Layout((this.PanelMode==Glb.PANEL_LIST)?Glb.PANEL_FORM:Glb.PANEL_LIST);this.SendPositions=true;break;case Glb.PCM_ATTACH:this.OpenAttachmentForm();this.SendPositions=false;break;case Glb.PCM_CSV:if(this.EnableMultipleSel()&&this.ShowMultipleSel()){var q=0;if(!this.IsDO()){for(var a=0;a<this.SelectedRows.length;a++){q+=this.SelectedRows[a]==true?1:0}}else{var l=this.Queries[0].IDColl;if(l!=null){l.set_UIMode(true);l.MoveFirst();while(l.GetAt()!=null){var j=l.GetAt();q+=j.Selected()==true?1:0;l.MoveNext()}l.set_UIMode(false)}}if(q==0&&this.MainFrm.ParamsObj().UseRD3){this.SendPositions=false;break}}this.ExportData();this.SendPositions=false;break;case Glb.PCM_GROUP:this.HandleGrouping();break}return true};IDPanelSrv.prototype.SetInput=function(c,x,g,f,y){if(c==undefined){c=-1}if(x==undefined){x=-1}if(g==undefined){g=1}if(f==undefined){f=true}if(y==undefined){y=false}if(g<2&&(!this.Visible||this.Collapsed||!this.Exposed())){return}if(this.Parent!=null&&(y||g>this.Parent.FocusPriority||(g==this.Parent.FocusPriority&&c==this.AttR))){if(c==-1){c=this.AttR}if(c<0||c>=this.NumRows){return}if(x==-1){x=this.GetTabOrderFieldIdx(0,this.PanelMode);if(!f){f=true}}if(f){var r=x;var q=-1;var k=false;while(r<this.Fields.length){var n=r;if(this.IsAdvTabOrderEnabled()&&r!=x){n=this.GetTabOrderFieldIdx(r,this.PanelMode)}if(this.Fields[n].IsPresent()&&(this.Fields[n].IsEnabled(c)||(this.Fields[n].IsEnabledButton()&&!this.Locked()&&this.PanelMode!=Glb.PANEL_LIST&&!this.MainFrm.IsMobile()))){x=n;k=true;break}else{if(this.Fields[n].IsPresent()&&this.Fields[n].ValueList.Count()==0&&q==-1){q=n}}r++}if(!k){for(r=0;r<this.Fields.length;r++){var n=this.GetTabOrderFieldIdx(r,this.PanelMode);if(this.Fields[n].IsPresent()&&this.Fields[n].IsVisible(c)&&this.Fields[n].IsReadOnly(this.Fields[n].VisualStyle,c)){x=n;k=true;break}}}if(!k&&q>-1){x=q}}this.Parent.FocusPriority=g;var s=true;if(g==1&&g==this.Parent.FocusPriority&&c==this.AttR){var u=this.Parent.ActiveElement;if(u.length>5&&u.startsWith("F")){var d=u.indexOf("C");var b=u.indexOf("R");try{var h=parseInt(u.substr(1,d-1),10);var l=parseInt(u.substr(d+1,b-d-1),10);var o=parseInt(u.substr(b+1),10);var m=this.Parent.Frames[h].Content;var a=m.bFields(l);var v=a.bValues(o);if(v.GetErrorType()!=IDDocument.ERR_NONE&&h==this.FrIndex){s=false}}catch(t){}}}if(s){this.Parent.ActiveElement="F"+this.FrIndex+"C"+x+"R"+c}this.set_SelectedRow(c)}};IDPanelSrv.prototype.UpdatePanel=function(h){var t=false;var o;if(this.IMDB==null){return}if(this.Freezed){h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,71,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": update not performed (the panel is freezed)");return}if((this.Flags&Glb.PAN_FREEWHENHID)!=0){if(!this.Visible||this.Collapsed||!this.Exposed()){this.WasHidden=true;h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": update not performed (the panel is either invisible, collapsed or not exposed)");return}}var s=this.Queries[0].RecordCount();var u=this.Queries[0].GetAttRecNumber()+this.AttR;var q=(this.iStatus==Glb.PS_QBE);q=q||(u>s&&(this.Flags&Glb.PAN_CANINSERT)!=0);q=q||(u<=s&&(this.Flags&Glb.PAN_CANUPDATE)!=0);if(!q&&this.IsDO()&&(this.GetDocument(this.AttR)!=null)){q=q||(this.GetDocument(this.AttR).Inserted()&&(this.Flags&Glb.PAN_CANINSERT)!=0)}if(q){if(this.MstTblIndex>-1&&this.IMDB.TblModified(this.MstTblIndex,Glb.GlbRefModIdx)&&this.UseIMDB){for(var y=0;y<this.MasterFields.length;y++){var l=(this.MasterFields[y].UpdateField());t=t||l}if(t){this.SetRDRowSel(this.AttR,true);this.SetModified(h);this.FireOnChangeRow();if(this.Status()==Glb.PS_UPDATE&&(this.Flags&Glb.PAN_AUTOSAVE)!=0&&!this.AutoSaveSamFl){this.AutoSaveSamFl=true;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,165,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": Auto Saving")}this.UpdateRecords(this.MainFrm,true);this.AutoSaveSamFl=false}else{this.ReValidate()}}}}else{h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,73,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": the selected row is not updateable; skipping IMDB check")}o=true;if((this.iStatus==Glb.PS_QBE||this.iStatus==Glb.PS_DATA)){if(this.UseIMDB){if(this.Queries[0].UpdateParam(this.WasHidden)){var x=this.Queries[0].GetAttRecNumber();this.Queries[0].CloseData();this.SaveQBE(2);var f=false;if((this.Flags&Glb.PAN_QBEFORM)!=0){f=true;this.Flags&=~(Glb.PAN_QBEFORM)}var e=this.FindData(h,false,true);o=false;if(f){this.Flags|=Glb.PAN_QBEFORM}if(this.SortingList.Count()>0){this.EnableSorting()}if(!e){this.ScrollRecTo(x,h)}}}}if(this.Queries[0].CollIsModified()){this.set_Status(Glb.PS_DATA);this.RD3Change(RD3Glb.PAN_STATUS);this.ResetRD3Cache();var a=this.Queries[0].RecordCount();var r=this.Queries[0].ActualPosition;this.Queries[0].BlobCache.Clear();this.ScrollRecBy(0,this.MainFrm);if(this.Queries[0].RecordCount()!=a){this.ResetRD3Cache();this.ScrollRecTo(r,this.MainFrm);this.UpdateDynRows(this.Queries[0].RecordCount())}}else{var c=false;for(var y=0;y<this.NumRows;y++){var d=this.GetDocument(y);if(d!=null){if(d.UpdateCount()!=this.RowUpdateCount(y)){c=true;this.RD3ListCache[this.Queries[0].GetAttRecNumber()+y-1]=false;this.RD3FormCache[this.Queries[0].GetAttRecNumber()+y-1]=false;for(var v=0;v<this.Fields.length;v++){if(this.Fields[v].IsNamed){this.Fields[v].Values[y].RD3Change(RD3Glb.VAL_TEXT)}}}}}if(!c&&this.IsDO()&&!this.Queries[0].IsMasterDO){for(var y=0;y<this.NumRows;y++){var d=this.GetDocument(y);if(d!=null&&!d.HasErrors()&&this.IsRowInError(y)){c=true;break}}}if(c){this.set_Status(Glb.PS_DATA);this.RD3Change(RD3Glb.PAN_STATUS);this.Queries[0].BlobCache.Clear();this.ScrollRecBy(0,this.MainFrm)}}this.SearchForMasterPanel();if(o&&this.UseIMDB){for(var y=1;y<this.Queries.length;y++){if(this.Queries[y].FieldIndex==-1){if(this.Queries[y].CheckIMDBLookupParam()){this.Queries[0].DoUpdateLookups(-1,h);break}}else{if((this.Fields[this.Queries[y].FieldIndex].Flags&Glb.FLD_AUTOLOOKUP)>0){if(this.Queries[y].CheckIMDBLookupParam()){this.Queries[0].DoUpdateLookups(-1,h);break}}}}}if(this.InitStatus==Glb.INITST_SEARCH&&this.iStatus==Glb.PS_QBE&&(this.Flags&Glb.PAN_QBEFORM)!=0&&this.PanelMode==Glb.PANEL_LIST&&!this.MainFrm.IsMobile()){this.set_Layout(Glb.PANEL_FORM)}if(this.InitStatus!=Glb.INITST_SEARCH&&this.iStatus==Glb.PS_QBE){var k="";switch(this.InitStatus){case Glb.INITST_DATA:k="Find Data";break;case Glb.INITST_INSERT:k="Insert";break;case Glb.INITST_NEWROW:k="New Row";break;case Glb.INITST_SETFIND:k="Set Values & Find";break;case Glb.INITST_SETFINDAL:k="Set Values & Find Always";break}h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,74,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": handling Initial Status ("+k+")");switch(this.InitStatus){case Glb.INITST_SETFIND:if(this.HasQBE()){this.FindData(this.MainFrm,false,false)}break;case Glb.INITST_DATA:this.FindData(this.MainFrm,false,false);if(this.iStatus==Glb.PS_DATA&&(this.Flags&Glb.PAN_QBEFORM)!=0&&this.PanelMode==Glb.PANEL_LIST&&this.Queries[0].RecordCount()==1&&!this.MainFrm.IsMobile()&&!this.MainFrm.IsBootstrap()){this.set_Layout(Glb.PANEL_FORM)}break;case Glb.INITST_SETFINDAL:this.FindData(this.MainFrm,false,false);this.SaveQBE(3);break;case Glb.INITST_INSERT:case Glb.INITST_NEWROW:var g=(this.Flags&Glb.PAN_NEWINSMODE)!=0;if(this.InitStatus==Glb.INITST_NEWROW){this.SetFlags(Glb.OBJ_PANEL,0,Glb.PAN_NEWINSMODE,Glb.PAN_NEWINSMODE)}this.GoInsertRecord(this.MainFrm);if(this.InitStatus==Glb.INITST_NEWROW){this.SetFlags(Glb.OBJ_PANEL,0,g?Glb.PAN_NEWINSMODE:0,Glb.PAN_NEWINSMODE)}this.set_Locked(false);break}this.InitStatus=Glb.INITST_SEARCH;if((this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel())&&this.PanelMode==Glb.PANEL_LIST){if(((this.Flags&Glb.PAN_HASFORM)>0&&(this.Flags&Glb.PAN_STARTFORM)>0)){this.set_Layout(Glb.PANEL_FORM)}}}this.UpdateIndicator(false);this.UpdateAggregateFields();if(!this.IsDO()){var b=this.SelectedRows;this.SelectedRows=new Array(this.Queries[0].RecordCount()+this.NumRows);for(var y=0;y<Math.min((b==null?0:b.length),this.SelectedRows.length);y++){this.SelectedRows[y]=b[y]}if(this.MainFrm.ParamsObj().UseRD3&&!this.RD3Sendmulti){if(b==null||b.length!=this.SelectedRows.length){this.RD3Sendmulti=true}else{for(var y=0;y<this.SelectedRows.length&&!this.RD3Sendmulti;y++){this.RD3Sendmulti|=(this.SelectedRows[y]!=b[y])}}}}if(this.UseListQBEEnabled()&&this.InitStatus==Glb.INITST_SEARCH&&this.iStatus==Glb.PS_QBE){this.InitStatus=Glb.INITST_DATA;if(!this.IsDO()&&this.Queries[0].MaxRows==0){this.SetMaxRows(10000)}}};IDPanelSrv.prototype.MasterRS=function(){return this.Queries[0].RS};IDPanelSrv.prototype.set_MasterRS=function(a){this.Queries[0].RS=a;this.UpdateDynRows(this.Queries[0].RecordCount());this.set_Status(Glb.PS_DATA);this.ScrollRecTo(0,this.MainFrm);this.SelectedRows=new Array(this.Queries[0].RecordCount()+this.NumRows);this.Queries[0].LookupRows=null;if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}if(this.GroupingEnabled()&&this.ShowGroups()&&this.GroupingList.Count()>0){this.RefreshGrouping(true)}else{if(this.SortingList.Count()>0){this.EnableSorting()}}this.ResetRD3Cache()};IDPanelSrv.prototype.GetWhereClause=function(){return new IDVariant(this.Queries[0].LastWhereClause)};IDPanelSrv.prototype.Header=function(a,b){switch(a){case Glb.OBJ_PAGE:return this.Pages[b].Header;case Glb.OBJ_GROUP:return this.Groups[b].Header;case Glb.OBJ_FIELD:return this.Fields[b].Header}return""};IDPanelSrv.prototype.set_Header=function(a,c,b){switch(a){case Glb.OBJ_PAGE:this.Pages[c].Header=b;this.Pages[c].RD3Change(RD3Glb.PPG_HEADER);break;case Glb.OBJ_GROUP:this.Groups[c].Header=b;this.Groups[c].RD3Change(RD3Glb.PGR_HEADER);break;case Glb.OBJ_FIELD:this.Fields[c].Header=b;this.Fields[c].AbbrHeaderForm=b;this.Fields[c].AbbrHeaderList=b;this.Fields[c].RD3Change(RD3Glb.FLD_HEADER);this.Fields[c].RD3Change(RD3Glb.FLD_FORMHEADER);this.Fields[c].RD3Change(RD3Glb.FLD_LISTHEADER);break}};IDPanelSrv.prototype.FieldVisible=function(b,a){return this.Fields[b].IsVisible(a)&&this.Fields[b].IsPresent()};IDPanelSrv.prototype.SetAbbrHeader=function(a,d,c,b){if(c==Glb.PANEL_LIST){this.Fields[d].AbbrHeaderList=b;this.Fields[d].RD3Change(RD3Glb.FLD_LISTHEADER)}else{this.Fields[d].AbbrHeaderForm=b;this.Fields[d].RD3Change(RD3Glb.FLD_FORMHEADER)}};IDPanelSrv.prototype.ToolTip=function(b,c){switch(b){case Glb.OBJ_PAGE:return this.Pages[c].Tooltip;case Glb.OBJ_GROUP:return this.Groups[c].Tooltip;case Glb.OBJ_FIELD:if(this.ValidatingRow==-1||this.Fields[c].IdxPanel==-1){return this.Fields[c].Tooltip}else{var a=this.Fields[c].bValues(this.ValidatingRow).LastTooltip;if(a==null||a.length==0){a=this.Fields[c].Tooltip}return a}}return""};IDPanelSrv.prototype.set_ToolTip=function(a,c,b){switch(a){case Glb.OBJ_PAGE:this.Pages[c].Tooltip=b;this.Pages[c].RD3Change(RD3Glb.PPG_TOOLTIP);break;case Glb.OBJ_GROUP:this.Groups[c].Tooltip=b;this.Groups[c].RD3Change(RD3Glb.PGR_TOOLTIP);break;case Glb.OBJ_FIELD:if(this.ValidatingRow==-1||this.Fields[c].IdxPanel==-1){this.Fields[c].Tooltip=b;this.Fields[c].RD3Change(RD3Glb.FLD_TOOLTIP)}else{this.Fields[c].Values[this.ValidatingRow].Tooltip=b}break}};IDPanelSrv.prototype.VisualStyle=function(b,c){switch(b){case Glb.OBJ_PANEL:return this.iVisualStyle;case Glb.OBJ_PAGE:return this.Pages[c].VisualStyle;case Glb.OBJ_GROUP:return this.Groups[c].VisualStyle;case Glb.OBJ_FIELD:if(this.ValidatingRow==-1||this.Fields[c].IdxPanel==-1){return this.Fields[c].VisualStyle}else{var a=this.Fields[c].bValues(this.ValidatingRow).LastVisualStyle;if(a==-1||a==0){return this.Fields[c].VisualStyle}else{return a}}}return 0};IDPanelSrv.prototype.set_VisualStyle=function(a,c,b){switch(a){case Glb.OBJ_PANEL:this.iVisualStyle=b;this.RD3Change(RD3Glb.PAN_VISUALSTYLE);break;case Glb.OBJ_PAGE:this.Pages[c].VisualStyle=b;this.Pages[c].RD3Change(RD3Glb.PPG_VISUALSTYLE);break;case Glb.OBJ_GROUP:this.Groups[c].VisualStyle=b;this.Groups[c].RD3Change(RD3Glb.PGR_VISUALSTYLE);break;case Glb.OBJ_FIELD:this.Fields[c].SetVisualStyle(b);break}};IDPanelSrv.prototype.SetFieldPage=function(a,c,b){this.Fields[a].Page=c;this.Fields[a].Group=b;this.Fields[a].RD3Change(RD3Glb.FLD_PAGE);this.Fields[a].RD3Change(RD3Glb.FLD_GROUP)};IDPanelSrv.prototype.SetFieldQBEEnabled=function(b,a){this.Fields[b].QBEEnabled=a;this.Fields[b].RD3Change(RD3Glb.FLD_QBEENAB)};IDPanelSrv.prototype.SetFieldActive=function(a,b){this.SetFlags(Glb.OBJ_FIELD,a,(b?Glb.FLD_ACTIVE:0),Glb.FLD_ACTIVE)};IDPanelSrv.prototype.SetFieldSuperActive=function(b,a){this.SetFlags(Glb.OBJ_FIELD,b,(a?Glb.FLD_SUPERACTIVE:0),Glb.FLD_SUPERACTIVE)};IDPanelSrv.prototype.SetFieldSort=function(a,b){this.Fields[a].SortFld=b;this.Fields[b].SortFld=a};IDPanelSrv.prototype.SetFieldPrimaryIndex=function(a,b){this.Fields[a].PriIdx=b};IDPanelSrv.prototype.SetFieldPanel=function(d,e,f,c,b,h,g,a){if(c!=null&&c.length>0){this.Fields[d].Code=c}this.Fields[d].DataType=b;if(f!=null&&f.length>0){this.Fields[d].Expr=f}this.Fields[d].MaxLength=h;this.Fields[d].vScale=g;this.Fields[d].IdxPanel=e;this.Fields[d].iVisualFlags=a;this.Fields[d].RD3Change(RD3Glb.FLD_MAXLENGTH);this.Fields[d].RD3Change(RD3Glb.FLD_DATATYPE);this.Fields[d].RD3Change(RD3Glb.FLD_VISPROP);if((a&Glb.FLDVISPROP_ONEACHKEY)>0){this.SetFieldSuperActive(d,true)}if((a&Glb.FLDVISPROP_SHOWACT)==0){this.SetFieldActivator(d,-1)}this.Fields[d].maxLKERows=this.MainFrm.ParamsObj().MaxLookupRows};IDPanelSrv.prototype.SetFieldUnbound=function(b,a){this.Fields[b].Unbound=a;this.Fields[b].CauseValidation=false};IDPanelSrv.prototype.SetFieldValidation=function(b,a){this.Fields[b].CauseValidation=a};IDPanelSrv.prototype.SetFieldTransformation=function(d,c,a,b){this.Fields[d].Transformation=c;this.Fields[d].TrFormat=a;this.Fields[d].TrOffset=b};IDPanelSrv.prototype.SetSubFrame=function(a,b){this.Fields[a].SubFrame=b;this.Fields[a].RD3Change(RD3Glb.FLD_SUBFRAME)};IDPanelSrv.prototype.SetSubForm=function(c,d,b,e,a){this.Fields[c].SetSubForm(d,b,e,a)};IDPanelSrv.prototype.GetSubForm=function(c,b,a){return this.Fields[c].GetSubForm(b,a)};IDPanelSrv.prototype.SetFieldCustomContentCls=function(c,a,b){this.Fields[c].SetCustomContentCls(a,b)};IDPanelSrv.prototype.GetFlags=function(b,c){var a=0;switch(b){case Glb.OBJ_PANEL:a=this.Flags;break;case Glb.OBJ_PAGE:a=this.Pages[c].Flags;break;case Glb.OBJ_GROUP:a=this.Groups[c].Flags;break;case Glb.OBJ_FIELD:if(!(this.ValidatingRow==-1||this.Fields[c].IdxPanel==-1)){a=this.Fields[c].GetDynFlags()}else{a=this.Fields[c].Flags}break}return a};IDPanelSrv.prototype.SetFlags=function(h,m,b,c){var e=0;var l=false;var k=false;var g=true;var f=true;var a=this.PanelMode!=-1;if(h==Glb.OBJ_FIELD){k=!(this.ValidatingRow==-1||this.Fields[m].IdxPanel==-1);if(a&&this.Fields[m].IdxPanel!=-1){g=this.Fields[m].IsPresent()}}switch(h){case Glb.OBJ_PANEL:e=this.Flags;break;case Glb.OBJ_PAGE:e=this.Pages[m].Flags;break;case Glb.OBJ_GROUP:e=this.Groups[m].Flags;break;case Glb.OBJ_FIELD:if(k){e=this.Fields[m].GetDynFlags()}else{e=this.Fields[m].Flags}break}if((e&c)!=b){l=true}e=e&(~c);e=e|b;switch(h){case Glb.OBJ_PANEL:this.Flags=e;if(l&&(c&Glb.PAN_CANUPDATE)!=0){this.RD3Change(RD3Glb.PAN_CANUPDATE)}if(l&&(c&Glb.PAN_CANDELETE)!=0){this.RD3Change(RD3Glb.PAN_CANDELETE)}if(l&&(c&Glb.PAN_CANINSERT)!=0){this.RD3Change(RD3Glb.PAN_CANINSERT)}if(l&&(c&Glb.PAN_CANSORT)!=0){this.RD3Change(RD3Glb.PAN_CANSORT)}if(l&&(c&Glb.PAN_CANSELECT)!=0){this.RD3Change(RD3Glb.PAN_CANSEARCH)}if(l&&(c&Glb.PAN_SCROLLREC)!=0){this.RD3Change(RD3Glb.PAN_HASSCROLLBAR)}break;case Glb.OBJ_PAGE:this.Pages[m].Flags=e;this.Pages[m].RD3Change(RD3Glb.PPG_FLAGS);break;case Glb.OBJ_GROUP:this.Groups[m].Flags=e;this.Groups[m].RD3Change(RD3Glb.PGR_FLAGS);break;case Glb.OBJ_FIELD:if(k){this.Fields[m].SetDynFlags(b,c)}else{if(l&&(c&Glb.OBJ_VISIBLE)!=0){this.Fields[m].RD3Change(RD3Glb.FLD_VISIBLE);if(this.Fields[m].AggregateOfField==-1){for(var d=0;d<this.Fields.length;d++){if(this.Fields[d].AggregateOfField==this.Fields[m].Index){this.SetFlags(Glb.OBJ_FIELD,this.Fields[d].Index,b,c)}}}}if(l&&(c&Glb.OBJ_ENABLED)!=0){this.Fields[m].RD3Change(RD3Glb.FLD_ENABLED)}if(l&&(c&Glb.FLD_SUPERACTIVE)!=0){this.Fields[m].RD3Change(RD3Glb.FLD_SUPERACTIVE)}this.Fields[m].Flags=e}break}this.EnableRoleFlags(h,m);if(h==Glb.OBJ_FIELD){if(a&&this.Fields[m].IdxPanel!=-1){f=this.Fields[m].IsPresent()}}if(this.PanelMode!=-1){a=g||f}if(l&&this.PanelMode!=-1&&!k&&a){this.CalcLayout()}};IDPanelSrv.prototype.SetRoleFlags=function(c,e,a,d){var b=0;switch(c){case Glb.OBJ_PANEL:b=this.RoleFlags;break;case Glb.OBJ_PAGE:b=this.Pages[e].RoleFlags;break;case Glb.OBJ_GROUP:b=this.Groups[e].RoleFlags;break;case Glb.OBJ_FIELD:b=this.Fields[e].RoleFlags;break}b=b&(~d);b=b|a;switch(c){case Glb.OBJ_PANEL:this.RoleFlags=b;break;case Glb.OBJ_PAGE:this.Pages[e].RoleFlags=b;break;case Glb.OBJ_GROUP:this.Groups[e].RoleFlags=b;break;case Glb.OBJ_FIELD:this.Fields[e].RoleFlags=b;break}switch(c){case Glb.OBJ_PANEL:if(this.DesignFlags==-1){this.DesignFlags=this.Flags}else{this.Flags=this.DesignFlags}break;case Glb.OBJ_PAGE:if(this.Pages[e].DesignFlags==-1){this.Pages[e].DesignFlags=this.Pages[e].Flags}else{this.Pages[e].Flags=this.Pages[e].DesignFlags}break;case Glb.OBJ_GROUP:if(this.Groups[e].DesignFlags==-1){this.Groups[e].DesignFlags=this.Groups[e].Flags}else{this.Groups[e].Flags=this.Groups[e].DesignFlags}break;case Glb.OBJ_FIELD:if(this.Fields[e].DesignFlags==-1){this.Fields[e].DesignFlags=this.Fields[e].Flags}else{this.Fields[e].Flags=this.Fields[e].DesignFlags}break}this.EnableRoleFlags(c,e);if(this.PanelMode!=-1){this.set_Visible((this.Flags&Glb.OBJ_VISIBLE)!=0);this.CalcLayout()}};IDPanelSrv.prototype.EnableRoleFlags=function(c,e){var b=0;var a=0;var d=0;switch(c){case Glb.OBJ_PANEL:d=Glb.PAN_CANDELETE|Glb.PAN_CANSELECT|Glb.PAN_CANUPDATE|Glb.PAN_CANINSERT|Glb.OBJ_VISIBLE;break;default:d=Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE;break}switch(c){case Glb.OBJ_PANEL:b=this.Flags;break;case Glb.OBJ_PAGE:b=this.Pages[e].Flags;break;case Glb.OBJ_GROUP:b=this.Groups[e].Flags;break;case Glb.OBJ_FIELD:b=this.Fields[e].Flags;break}switch(c){case Glb.OBJ_PANEL:a=b&this.RoleFlags;break;case Glb.OBJ_PAGE:a=b&this.Pages[e].RoleFlags;break;case Glb.OBJ_GROUP:a=b&this.Groups[e].RoleFlags;break;case Glb.OBJ_FIELD:a=b&this.Fields[e].RoleFlags;break}b=b&(~d);b=b|(a&d);switch(c){case Glb.OBJ_PANEL:this.Flags=b;break;case Glb.OBJ_PAGE:this.Pages[e].Flags=b;this.Pages[e].RD3Change(RD3Glb.PPG_FLAGS);break;case Glb.OBJ_GROUP:this.Groups[e].Flags=b;this.Groups[e].RD3Change(RD3Glb.PGR_FLAGS);break;case Glb.OBJ_FIELD:this.Fields[e].Flags=b;break}};IDPanelSrv.prototype.SetHeaderSize=function(b,d,c,a){switch(b){case Glb.OBJ_PANEL:this.HeaderSize=a;this.RD3Change(RD3Glb.PAN_HEADERSIZE);break;case Glb.OBJ_GROUP:if(c==0){this.Groups[d].HeaderWidth=a}else{this.Groups[d].HeaderHeight=a}break;case Glb.OBJ_FIELD:this.Fields[d].SetHeaderSize(c,a);break}};IDPanelSrv.prototype.SetHeaderPos=function(b,d,c,a){switch(b){case Glb.OBJ_GROUP:if(c==Glb.PANEL_LIST){this.Groups[d].ListHdrPos=a;this.Groups[d].RD3Change(RD3Glb.PGR_LISTHDERPOS)}else{this.Groups[d].FormHdrPos=a;this.Groups[d].RD3Change(RD3Glb.PGR_FORMHDRPOS)}break}};IDPanelSrv.prototype.GetImage=function(a,c,b){switch(a){case Glb.OBJ_PAGE:return this.Pages[c].Image;case Glb.OBJ_GROUP:return this.Groups[c].Image;case Glb.OBJ_FIELD:return this.Fields[c].Image;case Glb.OBJ_PANEL:return this.iImage}return""};IDPanelSrv.prototype.SetImage=function(b,e,d,a,c){if(c==undefined){c=false}switch(b){case Glb.OBJ_PAGE:this.Pages[e].Image=a;this.Pages[e].RD3Change(RD3Glb.PPG_IMAGE);break;case Glb.OBJ_GROUP:this.Groups[e].Image=a;this.Groups[e].RD3Change(RD3Glb.PGR_IMAGE);break;case Glb.OBJ_FIELD:this.Fields[e].Image=a;this.Fields[e].UseHilight=c;this.Fields[e].RD3Change(RD3Glb.FLD_IMAGE);this.Fields[e].RD3Change(RD3Glb.FLD_USEHL);break;case Glb.OBJ_PANEL:this.iImage=a;this.RD3FrameChange(RD3Glb.WFR_IMAGE);break}};IDPanelSrv.prototype.ImageResizeMode=function(a){return this.Fields[a].ImageResMode};IDPanelSrv.prototype.set_ImageResizeMode=function(b,a){if(this.Fields[b].ImageResMode!=a){this.Fields[b].ImageResMode=a;this.Fields[b].RD3Change(RD3Glb.FLD_IMGRESMODE)}};IDPanelSrv.prototype.SetIMDB=function(d,b,c){if(c==undefined){c=true}this.IMDB=d;this.UseIMDB=c;this.MstTblIndex=this.IMDB.TblByCode(b,this.MainFrm);this.mMstTblIndex=this.MstTblIndex;if(this.MstTblIndex>-1&&this.InitStatus!=Glb.INITST_SETFIND&&this.InitStatus!=Glb.INITST_SETFINDAL){for(var a=0;a<this.IMDB.TblNumField(this.MstTblIndex)-1;a++){this.IMDB.set_Value(this.MstTblIndex,a,0,new IDVariant())}}};IDPanelSrv.prototype.SetDOIMDB=function(b){for(var a=1;a<this.Queries.length;a++){if(this.Queries[a].IDColl!=null){this.Queries[a].IDColl.set_imdb(b)}if(this.Queries[a].Document!=null){this.Queries[a].Document.SetMainFrm(this.MainFrm,b)}}};IDPanelSrv.prototype.SetQuery=function(e,a,d,b,c){if(a==-1){this.Queries[e].AIQuery=d;this.Queries[e].AIFieldIndex=b}else{this.Queries[e].SetText(a,d);this.Queries[e].FieldIndex=b;if(a==0){this.Queries[e].iGuid=c}}};IDPanelSrv.prototype.SetQueryText=function(c,a,b){this.Queries[c].SetText(a,b)};IDPanelSrv.prototype.GetQueryText=function(b,a){return this.Queries[b].Text[a]};IDPanelSrv.prototype.SetQueryDB=function(c,b,a){this.Queries[c].DB=b;this.Queries[c].DBType=a};IDPanelSrv.prototype.SetQueryLKE=function(c,e,a){this.Queries[c].AddLKEParam(e,a);for(var b=0;b<this.Fields.length;b++){var d=this.Fields[b];if(d.IdxPanel==c&&Glb.ClassDT(d.DataType)==Glb.DTC_NUMBER){d.DataType=Glb.DT_CHAR}}};IDPanelSrv.prototype.SetQueryIMDB=function(b,c,a){this.Queries[b].IMDBDataSource=c;this.Queries[b].IMDBPrimaryTable=a;if(this.ShowInfoMessages){this.set_ShowInfoMessages(false)}};IDPanelSrv.prototype.SetQueryVisibleColumn=function(b,a){this.Queries[b].AddVisibleColumn(a)};IDPanelSrv.prototype.SetQueryHeaderColumn=function(b,a,c){this.Queries[b].AddHeaderColumn(a,c)};IDPanelSrv.prototype.SetQueryDecodeColumn=function(a,b){this.Queries[a].SetDecodeColumn(b)};IDPanelSrv.prototype.SetQueryVisibilityColumnsMode=function(b,a){this.Queries[b].VisibilityColumnsMode=a};IDPanelSrv.prototype.SetQueryExpressionColumn=function(c,a,b){this.Queries[c].AddExpressionColumn(a,b)};IDPanelSrv.prototype.SetMasterTable=function(b,a){this.Queries[b].MstTableName=a};IDPanelSrv.prototype.SetMaxRows=function(a){this.Queries[0].MaxRows=a;this.MaxRowsOrg=0};IDPanelSrv.prototype.GetMasterTable=function(a){return this.Queries[a].MstTableName};IDPanelSrv.prototype.SetRect=function(h,k,f,d,e,j,b,c,g){var a=new RectSrv();a.Left=d;a.Width=j;a.Height=b;a.Top=e;if(d instanceof IDVariant){switch(h){case Glb.OBJ_FIELD:a.Left=(d.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Fields[k].ListLeft:this.Fields[k].FormLeft):d.intValue());a.Width=(j.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Fields[k].ListWidth:this.Fields[k].FormWidth):j.intValue());a.Top=(e.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Fields[k].ListTop:this.Fields[k].FormTop):e.intValue());a.Height=(b.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Fields[k].ListHeight:this.Fields[k].FormHeight):b.intValue());c=(c.Type==IDVariant.NULL?this.Fields[k].HResMode[f]:c.intValue());g=(g.Type==IDVariant.NULL?this.Fields[k].VResMode[f]:g.intValue());break;case Glb.OBJ_GROUP:a.Left=(d.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Groups[k].ListLeft:this.Groups[k].FormLeft):d.intValue());a.Width=(j.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Groups[k].ListWidth:this.Groups[k].FormWidth):j.intValue());a.Top=(e.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Groups[k].ListTop:this.Groups[k].FormTop):e.intValue());a.Height=(b.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Groups[k].ListHeight:this.Groups[k].FormHeight):b.intValue());break;case Glb.OBJ_PANEL:a.Left=(d.Type==IDVariant.NULL?this.ListLeft:d.intValue());a.Width=(j.Type==IDVariant.NULL?this.ListWidth:j.intValue());a.Top=(e.Type==IDVariant.NULL?this.ListTop:e.intValue());a.Height=(b.Type==IDVariant.NULL?this.ListHeight:b.intValue());c=(c.Type==IDVariant.NULL?this.HListResizeMode:c.intValue());g=(g.Type==IDVariant.NULL?this.VListResizeMode:g.intValue());break;case Glb.OBJ_RECT:a.Left=(d.Type==IDVariant.NULL?this.BoundRect.Left:d.intValue());a.Width=(j.Type==IDVariant.NULL?this.BoundRect.Width:j.intValue());a.Top=(e.Type==IDVariant.NULL?this.BoundRect.Top:e.intValue());a.Height=(b.Type==IDVariant.NULL?this.BoundRect.Height:b.intValue());break}}switch(h){case Glb.OBJ_FIELD:this.Fields[k].SetRect(f,a,c,g);break;case Glb.OBJ_GROUP:this.Groups[k].set_GrpRect(f,a);break;case Glb.OBJ_PANEL:this.ListLeft=a.Left;this.ListTop=a.Top;this.ListWidth=a.Width;this.ListHeight=a.Height;this.HListResizeMode=c;this.VListResizeMode=g;this.RD3Change(RD3Glb.PAN_LISTLEFT);this.RD3Change(RD3Glb.PAN_LISTTOP);this.RD3Change(RD3Glb.PAN_LISTWIDTH);this.RD3Change(RD3Glb.PAN_LISTHEIGHT);this.RD3Change(RD3Glb.PAN_HRESMODE);this.RD3Change(RD3Glb.PAN_VRESMODE);break;case Glb.OBJ_RECT:this.BoundRect=a;this.LastResizeHeight=a.Height;this.LastResizeWidth=a.Width;break}};IDPanelSrv.prototype.SetSize=function(c,a){switch(c){case Glb.OBJ_FIELD:this.Fields=new Array(a);break;case Glb.OBJ_PAGE:this.Pages=new Array(a);break;case Glb.OBJ_GROUP:this.Groups=new Array(a);break;case Glb.OBJ_QUERY:this.Queries=new Array(a);break}for(var b=0;b<a;b++){switch(c){case Glb.OBJ_FIELD:this.Fields[b]=new PFieldSrv();this.Fields[b].Index=b;this.Fields[b].Parent=this;this.Fields[b].set_MultiSelectionComboBox(this.MainFrm.ParamsObj().MultiSelectionComboBox);break;case Glb.OBJ_PAGE:this.Pages[b]=new PPageSrv();this.Pages[b].Index=b;this.Pages[b].Parent=this;break;case Glb.OBJ_GROUP:this.Groups[b]=new PGroupSrv();this.Groups[b].Index=b;this.Groups[b].Parent=this;this.Groups[b].set_Collapsible(this.MainFrm.ParamsObj().UseCollapsableGroups);break;case Glb.OBJ_QUERY:this.Queries[b]=new PQuerySrv();this.Queries[b].Index=b;this.Queries[b].Parent=this;break}}if(this.MainFrm.IsMobile()&&this.ObjType==Glb.OBJ_QUERY){this.Queries[0].MaxRows=1000}};IDPanelSrv.prototype.set_SetString=function(b,a){if(b==-1){this.MasterRowName=a}};IDPanelSrv.prototype.get_FieldDesignRect=function(g,b,e){var c=this.Fields[g];var d;if(b==Glb.PANEL_LIST){d=c.DesignListRect}else{d=c.DesignFormRect}var a=new IDVariant();switch(e){case IDPanelSrv.RT_WIDTH:a=new IDVariant(d.Width);break;case IDPanelSrv.RT_HEIGHT:a=new IDVariant(d.Height);break;case IDPanelSrv.RT_LEFT:a=new IDVariant(d.Left);break;case IDPanelSrv.RT_TOP:a=new IDVariant(d.Top);break}return a};IDPanelSrv.prototype.SetValueListItem=function(c,b,a,g,d,h,f){this.Fields[c].AddVLItem(b,a,g,d,h);this.Fields[c].RD3Change(RD3Glb.FLD_VALUELIST);if(!f){for(var e=0;e<this.NumRows;e++){this.Fields[c].bValues(e).SearchValueList()}}};IDPanelSrv.prototype.GetValueListItemCount=function(a){return new IDVariant(this.Fields[a].ValueList.Count())};IDPanelSrv.prototype.GetValueListItemValue=function(b,d,a){var c=this.Fields[b].ValueList[d];switch(a){case 0:return c.Value;case 1:return new IDVariant(c.Name);case 2:return new IDVariant(c.Description);case 3:return new IDVariant(c.Image);case 4:return new IDVariant(c.VisIdx)}return new IDVariant()};IDPanelSrv.prototype.ClearValueList=function(a){this.Fields[a].ValueList=new ArrayList();this.Fields[a].RD3Change(RD3Glb.FLD_VALUELIST);for(var b=0;b<this.NumRows;b++){this.Fields[a].bValues(b).ValueListIndexes=new Array(0)}};IDPanelSrv.prototype.SetNumRow=function(b,d,c,a){if(c==Glb.PANEL_LIST){this.Fields[d].ListNumRow=a;this.Fields[d].RD3Change(RD3Glb.FLD_LISTNUMROWS)}else{this.Fields[d].FormNumRow=a;this.Fields[d].RD3Change(RD3Glb.FLD_FORMNUMROWS)}};IDPanelSrv.prototype.SetRowSelector=function(a){this.ShowRowSelector=a;this.RD3Change(RD3Glb.PAN_SHOWROWSELECTOR);this.CalcLayout()};IDPanelSrv.prototype.UFields=function(){return this.Fields.length};IDPanelSrv.prototype.UQueries=function(){return this.Queries.length};IDPanelSrv.prototype.UPages=function(){return this.Pages.length};IDPanelSrv.prototype.UGroups=function(){return this.Groups.length};IDPanelSrv.prototype.UMaster=function(){return this.MasterFields.length};IDPanelSrv.prototype.bFields=function(a){return this.Fields[a]};IDPanelSrv.prototype.bQueries=function(a){return this.Queries[a]};IDPanelSrv.prototype.bMaster=function(a){return this.MasterFields[a]};IDPanelSrv.prototype.bGroups=function(a){return this.Groups[a]};IDPanelSrv.prototype.bPages=function(a){return this.Pages[a]};IDPanelSrv.prototype.CalcLayout=function(){if(this.PanelMode==-1){if(((this.Flags&Glb.PAN_HASFORM)>0&&(this.Flags&Glb.PAN_STARTFORM)>0)||(this.Flags&Glb.PAN_HASLIST)==0){this.PanelMode=Glb.PANEL_FORM}else{this.PanelMode=Glb.PANEL_LIST}this.set_Visible((this.Flags&Glb.OBJ_VISIBLE)!=0);for(var y=0;y<this.Fields.length;y++){var B=this.Fields[y];B.QBELike=this.MainFrm.ParamsObj().PanelsLikeSearch&&(Glb.ClassDT(B.DataType)==Glb.DTC_CHAR);if(this.Queries[0]!=null&&this.Queries[0].IsDO&&B.IdxPanel==0){var A=B.GetDOIdx(this.Queries[0].DocTempl);if(A>0){var D=this.Queries[0].DocTempl.GetMD().GetProp(A);if(D.DBCode==null||D.DBCode.length==0){continue}}}if(B.IdxPanel==0){if((B.Flags&Glb.FLD_AUTOLOOKUP)!=0||B.ValueList.Count()>0){B.QBELike=false}else{for(var x=1;x<this.UQueries();x++){if(this.bQueries(x).FieldIndex==B.Index){B.QBELike=false}}}}else{if(B.IdxPanel>0&&(B.Flags&Glb.OBJ_ENABLED)!=0&&this.Queries[B.IdxPanel].LKEParams!=null){var r=this.Queries[B.IdxPanel].LKEParams;for(var x=0;x<r.Count();x++){this.Fields[r[x].FldIdx].QBELike=false}}}}if(this.GroupingEnabled()&&this.ShowGroups()&&this.SortingList.Count()>0){this.set_ShowGroups(true)}}this.FirstListFld=null;this.LastListFld=null;var k=this.MaxHRow;this.MaxHRow=0;var d=this.ShowRowSelector?Glb.SELECT_OFFSET:0;var c=this.PanelMode;this.PanelMode=Glb.PANEL_LIST;var z=-1;for(var y=0;y<this.Fields.length;y++){var u=this.GetTabOrderFieldIdx(y,this.PanelMode);if(this.Fields[u].IsPresent()&&(this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)>0){var v=this.Fields[u].ListWidth;this.Fields[u].ListLeft=d+this.ListLeft;d=d+v;this.ScrollPos=d+this.ListLeft;if(this.Fields[u].ListHeight>this.MaxHRow){this.MaxHRow=this.Fields[u].ListHeight}if(this.Fields[u].Group!=-1&&this.Fields[u].Group!=z){this.Groups[this.Fields[u].Group].ListLeft=this.Fields[u].ListLeft-(this.ShowRowSelector?Glb.SELECT_OFFSET:0);z=this.Fields[u].Group}if(this.Fields[u].IdxPanel!=-1){if(this.FirstListFld==null){this.FirstListFld=this.Fields[u]}this.LastListFld=this.Fields[u]}}}if(k!=this.MaxHRow){this.RD3Change(RD3Glb.PAN_MAXHROW)}this.PanelMode=c;var e=this.NumRows;if(this.NumRows==0||this.PanelMode==Glb.PANEL_FORM||this.MaxHRow>0){this.NumRows=1}if(this.MaxHRow>0){var o=0;for(var y=0;y<this.Fields.length;y++){var b=0;if(!this.MainFrm.IsBootstrap()&&!this.MainFrm.IsMobile()&&!this.IsFluidPanel()&&this.UseListQBERow()){b=this.MaxHRow}o=1;if(this.PanelMode==Glb.PANEL_LIST&&(this.Fields[y].Flags&Glb.FLD_INLIST)!=0&&this.Fields[y].IdxPanel>=0&&(this.Fields[y].Flags&Glb.FLD_LISTLIST)!=0){var C=(this.ListHeight-(this.Fields[y].ListTop-this.ListTop+b)-this.MaxHRow)/(this.MaxHRow+this.OffsetRow())+1;o=Math.floor(C);o=(o>1)?o:1}this.NumRows=(this.NumRows>o)?this.NumRows:o}}if(e!=this.NumRows){this.RD3Change(RD3Glb.PAN_NUMROWS)}for(var y=0;y<this.Fields.length;y++){this.Fields[y].set_BuffSize(this.NumRows)}var a=new Array(this.NumRows);for(var y=0;y<this.NumRows;y++){if(this.RowErrors!=null&&y<this.RowErrors.length&&this.RowErrors[y]!=null){a[y]=this.RowErrors[y]}else{a[y]=""}}this.RowErrors=a;var t=new Array(this.NumRows);for(var y=0;y<this.NumRows;y++){if(this.RDRowSel!=null&&y<this.RDRowSel.length){t[y]=this.RDRowSel[y]}}this.RDRowSel=t;if(this.iRowUpdateCount==null||this.iRowUpdateCount.length!=this.NumRows){this.iRowUpdateCount=new Array(this.NumRows);for(var y=0;y<this.NumRows;y++){this.iRowUpdateCount[y]=-1}}if(this.AttR>=this.NumRows&&!this.IsPanelFixActiveRowWhenScrolled()){this.AttR=0;if(this.DynamicRows>0){this.Queries[0].UpdateIMDB(this.AttR,true,true,true)}}var q=0,s=0;for(var y=0;y<this.Fields.length;y++){if(this.Fields[y].IsPresent()&&this.Fields[y].IdxPanel==0){q=q+1}if(this.Fields[y].IdxPanel==0){s=s+1}}this.MasterFields=new Array(s);this.PresentFields=new Array(q);q=0;s=0;for(var y=0;y<this.Fields.length;y++){this.Fields[y].UpdateSubFrame();if(this.Fields[y].IsPresent()&&this.Fields[y].IdxPanel==0){this.PresentFields[q]=this.Fields[y];this.Fields[y].MstCol=q;q=q+1}if(this.Fields[y].IdxPanel==0){this.MasterFields[s]=this.Fields[y];s=s+1}if(this.Fields[y].Group>-1){this.Groups[this.Fields[y].Group].Page=this.Fields[y].Page}}if(this.iStatus==Glb.PS_NONE){if(this.Parent!=null&&this.Parent.OpenAs!=Glb.OPEN_MDI){this.Parent.CloseOnSelection=this.isSimpleList()}if(this.DynamicRows==0&&this.MainFrm.ParamsObj().AutoDynRows>0&&(this.isSimpleList()||this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel())){this.SetDynRows(this.MainFrm.ParamsObj().AutoDynRows,!(this.MainFrm.IsBootstrap()||this.IsFluidPanel()))}if(this.DynamicRows==0&&this.IsFluidPanel()){this.SetDynRows(30,false)}var h=this.InitStatus;if(this.InitStatus==Glb.INITST_SETFIND||this.InitStatus==Glb.INITST_SETFINDAL){this.InitStatus=Glb.INITST_SEARCH;this.iStatus=Glb.PS_QBE;this.UpdatePanel(this.MainFrm);this.iStatus=Glb.PS_NONE;this.SaveQBE(1)}this.InitStatus=h;this.EnterQBE()}this.UpdateIndicator(false)};IDPanelSrv.prototype.SetModified=function(a){if(this.iStatus==Glb.PS_DATA){this.set_Status(Glb.PS_UPDATE)}if((this.Flags&Glb.PAN_AUTOSAVE)!=0&&this.iStatus==Glb.PS_UPDATE&&!this.AutoSaveSamFl){this.NeedAutoSave=true}for(var b=1;b<this.UQueries();b++){if(this.Queries[b].FieldIndex==-1){this.Queries[b].UpdateLookup(-1,a)}}};IDPanelSrv.prototype.ProcessRequest=function(f,d){var v=false;var D=false;var z=false;var k=this.MainFrm;this.NeedAutoSave=false;if(d){this.InfoPriority=0;for(var A=0;A<this.Fields.length;A++){var l=this.Fields[A].ProcessRequest(f);if(l&&!D&&this.VS.ControlType(this.Fields[A].VisualStyle)==Glb.VISCTRL_CHECK){D=true}v=v||l}for(var A=1;A<this.Queries.length;A++){if(this.Queries[A].UpdateLKE(k)){v=true}}if(v){if(D&&this.iStatus!=Glb.PS_UPDATE&&(this.Flags&Glb.PAN_CANINSERT)!=0){var c=true;var x=this.Queries[0].GetAttRecNumber();var t=this.Queries[0].RecordCount();for(var A=0;A<this.NumRows;A++){var b=this.IsRowModified(A);c=c||b;if(!b&&A+x>t){for(var y=0;y<this.Fields.length;y++){this.Fields[y].bValues(A).Clear()}}}if(!c){v=false}}}if(v){this.SetModified(k)}this.ReValidate();var a=this.AttR;if(this.ShowRowSelector){if(!k.ParamsObj().UseFastRowSelector){var r=k.GetParameter("S"+this.FrIndex);if(r!=null&&r.length>0){this.AttR=parseInt(r.substr(1),10);this.SetInput();k.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow",DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected","",this.AttR);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption());z=true}}else{for(var y=0;y<this.NumRows;y++){if(k.GetParameter("S"+this.FrIndex+"R"+y+".x")!=null){this.AttR=y;this.SetInput();var g=false;if(f!=null){if(f.OpenAs!=Glb.OPEN_MDI&&f.CloseOnSelection){k.DTTObj.SetRequestName("Lookup Selection","Lookup "+this.GetDTTCaption()+" closed",DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOOKUP,"Lookup "+this.GetDTTCaption()+" selection","",y);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(y+1)+" nel pannello "+this.GetDTTCaption());g=true}}if(!g){k.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow",DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected","",this.AttR);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption())}z=true;this.AcknowledgeWarnings();break}}}if(this.AttR>=this.NumRows||this.AttR<0){this.AttR=0}}if(this.EnableMultipleSel()){if(this.ShowMultipleSel()){var E=false;for(var y=0;y<this.NumRows;y++){var o=k.GetParameter("CHK"+this.FrIndex+"R"+y);if(o!=null){if(this.RD3MultiSel(y,o.length>0)){E=true}}}if(E){var F=new IDVariant(0);this.FireOnChangeSelection(-1,false,true,true,F)}}if(k.GetParameter("chks"+this.FrIndex+".x")!=null){this.RD3PanelCommand("seltog")}if(k.GetParameter("chkn"+this.FrIndex+".x")!=null){this.RD3PanelCommand("selnone")}if(k.GetParameter("chka"+this.FrIndex+".x")!=null){this.RD3PanelCommand("selall")}}if(!z){if(f.ActiveElement.length>5&&f.ActiveElement.substr(0,("F"+this.FrIndex+"C").length).equals("F"+this.FrIndex+"C")){var x=f.ActiveElement.indexOf("R");if(x>0){try{var y=parseInt(f.ActiveElement.substr(x+1),10);if(y>=0&&y<this.NumRows&&y!=this.AttR){var t=f.ActiveElement.indexOf("C");t=parseInt(f.ActiveElement.substr(t+1,x-(t+1)),10);if(t>=0&&t<this.Fields.length){if(this.Fields[t].IsReadOnly(this.Fields[t].VisualStyle,this.AttR)){this.AttR=y;k.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow due to Cursor change",DTTRequest.PRI_DATA);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected by pressing ENTER onto the field "+this.Fields[t].GetDTTCaption(),"",this.AttR);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption()+" premendo ENTER sul campo "+this.Fields[t].GetDTTCaption())}}}}catch(C){}}}}var q=false;for(var A=0;A<this.Fields.length&&!q;A++){for(var y=0;y<this.NumRows;y++){if(this.Fields[A].CanActivate(y)&&this.Fields[A].IdxPanel!=-1){if(k.GetParameter("A"+this.FrIndex+"C"+A+"R"+y+".x")!=null){this.AttR=y;k.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow due to field activation",DTTRequest.PRI_DATA);q=true;break}}}}if(a!=this.AttR||v){k.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,37,"IDPanel.ProcessRequest","Panel "+this.GetDTTCaption()+": selected Row = "+(this.AttR+1));this.Queries[0].UpdateIMDB(this.AttR,true,true,true)}if(z){this.FireOnSelectingRow()}}if(this.WasHidden&&!d){k.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": update performed for the first time (the panel was either invisible, collapsed or not exposed)");this.UpdatePanel(k);this.WasHidden=false}if(!d){this.ReValidate();if(k.GetParameter("lck"+this.FrIndex+".x")!=null){this.RD3PanelCommand("lock")}if(k.GetParameter("unl"+this.FrIndex+".x")!=null){this.RD3PanelCommand("unlock")}if(k.GetParameter("top"+this.FrIndex+".x")!=null){this.RD3PanelCommand("top")}if(k.GetParameter("bottom"+this.FrIndex+".x")!=null){this.RD3PanelCommand("bottom")}if(k.GetParameter("next"+this.FrIndex+".x")!=null){this.RD3PanelCommand("next")}if(k.iwrd_wce.startsWith("PAN"+this.FrIndex+":MOV")){if(PanelCommand(Glb.PCM_NAVIGATION,4,true)){this.ScrollRecTo(parseInt(k.iwrd_wce.substr(("PAN"+this.FrIndex+":MOV").length),10),k)}}if(k.GetParameter("prev"+this.FrIndex+".x")!=null){this.RD3PanelCommand("prev")}if(k.GetParameter("find"+this.FrIndex+".x")!=null){this.RD3PanelCommand("find")}if(k.GetParameter("search"+this.FrIndex+".x")!=null){this.RD3PanelCommand("search")}if(k.GetParameter("delete"+this.FrIndex+".x")!=null){this.RD3PanelCommand("delete")}if(k.GetParameter("refresh"+this.FrIndex+".x")!=null){this.RD3PanelCommand("refresh")}if(k.GetParameter("cancel"+this.FrIndex+".x")!=null){this.RD3PanelCommand("cancel")}if(k.GetParameter("save"+this.FrIndex+".x")!=null){this.RD3PanelCommand("save")}if(k.GetParameter("insert"+this.FrIndex+".x")!=null){this.RD3PanelCommand("insert")}if(k.GetParameter("dupl"+this.FrIndex+".x")!=null){this.RD3PanelCommand("dupl")}if(k.GetParameter("print"+this.FrIndex+".x")!=null){this.RD3PanelCommand("print")}if(k.GetParameter("csv"+this.FrIndex+".x")!=null){this.RD3PanelCommand("csv")}if(k.GetParameter("att"+this.FrIndex+".x")!=null){this.RD3PanelCommand("attach")}if(k.GetParameter("list"+this.FrIndex+".x")!=null){this.RD3PanelCommand("list")}for(var u=0;u<WebFrameSrv.MAX_CUSTOMCOMMANDS;u++){var h=0;if(u>=8){switch(u){case 8:h=Glb.PCM_CUSTOM9;break;case 9:h=Glb.PCM_CUSTOM10;break;case 10:h=Glb.PCM_CUSTOM11;break;case 11:h=Glb.PCM_CUSTOM12;break;case 12:h=Glb.PCM_CUSTOM13;break;case 13:h=Glb.PCM_CUSTOM14;break;case 14:h=Glb.PCM_CUSTOM15;break;case 15:h=Glb.PCM_CUSTOM16;break}}else{h=Glb.PCM_CUSTOM1<<u}if(this.IsCommandEnabled(h)&&this.MainFrm.CustomCommands[u]!=null){if(k.GetParameter("cc"+(u+1)+this.FrIndex+".x")!=null){k.DTTObj.SetRequestName("Command "+this.MainFrm.CustomCommands[u].Caption,"Panel "+this.GetDTTCaption()+": custom command "+this.MainFrm.CustomCommands[u].Caption,DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","cc"+(u+1));k.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone "+this.MainFrm.CustomCommands[u].Caption+" nella toolbar del pannello "+this.GetDTTCaption()+" ("+this.MainFrm.CustomCommands[u].ToolTip+")");this.PanelCommand(h,0,true)}}}for(var A=0;A<this.Pages.length;A++){if(k.GetParameter("page"+this.FrIndex+"_"+A+".x")!=null){k.DTTObj.SetRequestName("Change Page","Panel "+this.GetDTTCaption()+": go to page "+this.Pages[A].Header,DTTRequest.PRI_CMD);this.set_Page(A);k.DTTObj.AddTestItem(this.Pages[A].iGuid,DTTEngine.TST_PANCHGPG,"Panel "+this.GetDTTCaption()+" change page","");k.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone CHANGE-PAGE nella toolbar del pannello "+this.GetDTTCaption());break}}for(var A=0;A<this.Fields.length;A++){if(this.Fields[A].DataType==Glb.DT_DOC_OLE&&this.Status()==Glb.PS_DATA){if(k.GetParameter("delblob"+this.FrIndex+"_"+A+".x")!=null){this.RD3PanelCommand("delblob"+A);break}if(k.GetParameter("uplblob"+this.FrIndex+"_"+A+".x")!=null){this.RD3PanelCommand("upload"+A);break}}else{var r=k.GetParameter("sort"+this.FrIndex+"_"+A+".x");if(r!=null&&r.length>0){var B=parseInt(k.GetParameter("sort"+this.FrIndex+"_"+A+".y"),10);this.RD3Sort(A,B)}}}var q=false;for(var A=0;A<this.Fields.length&&!q;A++){for(var y=0;y<this.NumRows;y++){if(this.Fields[A].CanActivate(y)){if(k.GetParameter("A"+this.FrIndex+"C"+A+"R"+y+".x")!=null){k.DTTObj.SetRequestName("Activate Field","Panel "+this.GetDTTCaption()+": field "+this.Fields[A].GetDTTCaption()+" activated for row"+(y+1),DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.Fields[A].iGuid,DTTEngine.TST_FLDACT,"Panel field "+this.Fields[A].GetDTTCaption()+" activation","",y+"act");k.DTTObj.AddHelpItem(0,0,0,0,"Attiva il campo "+this.Fields[A].GetDTTCaption()+(this.Layout()==Glb.PANEL_FORM?"":" della riga "+(y+1))+" nel panello "+this.GetDTTCaption());this.Fields[A].Activate(y);q=true;break}}}}if(f.OpenAs!=Glb.OPEN_MDI&&f.CloseOnSelection){for(var y=0;y<this.NumRows;y++){if(k.GetParameter("S"+this.FrIndex+"R"+y+".x")!=null){k.DTTObj.SetRequestName("Lookup Selection","Lookup "+this.GetDTTCaption()+" closed",DTTRequest.PRI_CMD);if(!k.ParamsObj().UseFastRowSelector){k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOOKUP,"Lookup "+this.GetDTTCaption()+" selection","",y);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(y+1)+" nel pannello "+this.GetDTTCaption())}this.MainFrm.UnloadForm(f.FormIdx,true);break}}}}if(this.NeedAutoSave){this.AutoSaveSamFl=true;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,165,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": Auto Saving")}this.UpdateRecords(this.MainFrm,true);this.AutoSaveSamFl=false;this.NeedAutoSave=false}this.UpdateIndicator(false);for(var A=0;A<this.Fields.length;A++){if(this.Fields[A].SubFrame>0){f.Frames[this.Fields[A].SubFrame].ProcessRequest(d)}}};IDPanelSrv.prototype.GetBoundRect=function(b){if(b==undefined){b=false}if(this.BoundRect!=null&&this.BoundRect.Width>0&&this.BoundRect.Height>0&&!b){return this.BoundRect}else{var e=new RectSrv();var d=new RectSrv();for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].IsPresent()){d=this.Fields[c].GetValueRect(this.PanelMode,this.NumRows-1);if(d.Left+d.Width>e.Width){e.Width=d.Left+d.Width}if(d.Top+d.Height>e.Height){e.Height=d.Top+d.Height}d=this.Fields[c].GetHeaderRect(this.PanelMode);if(d.Left+d.Width>e.Width){e.Width=d.Left+d.Width}if(d.Top+d.Height>e.Height){e.Height=d.Top+d.Height}}}if(this.PanelMode==Glb.PANEL_LIST&&(this.Flags&Glb.PAN_SCROLLREC)!=0){var a=this.ScrollPos+Glb.SCROLL_OFFSET;if(e.Width<a){e.Width=a}}e.Width=e.Width+2*Glb.HEADER_GAP;e.Height=e.Height+2*Glb.HEADER_GAP;return e}};IDPanelSrv.prototype.FindData=function(c,g,b){var f=false;if(this.iStatus!=Glb.PS_QBE&&!b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,78,"IDPanel.FindData","Panel "+this.GetDTTCaption()+": can't find data (status <> QBE)")}return f}if(this.iStatus==Glb.PS_QBE){this.SaveQBE(1)}if(this.Queries[0].FindData(c,g)){if(this.QBEEmpty&&this.Queries[0].RecordCount()==0&&!b&&!g&&this.Queries[0].NumQBEParameters>0){this.MainFrm.set_AlertMessage(new IDVariant(c.RTCObj.GetConst("D6CE2977-47A4-4BB4-BB6A-D28B1F5D63EB","Nessun dato trovato. Modificate i criteri di ricerca oppure premete F7 per inserire un nuovo dato")));this.iStatus=Glb.PS_DATA;this.RD3Change(RD3Glb.PAN_STATUS);this.EnterQBE();this.RefreshDynProp();return f}if(this.Queries[0].IMDBDataSource==-1||this.iStatus==Glb.PS_QBE){var a=this.iStatus;this.iStatus=Glb.PS_QBE;this.QBETip=this.GetQBETips();this.QBETipText=this.GetQBETips(false);this.RD3Change(RD3Glb.PAN_QBETIP);this.iStatus=a}this.set_Status(Glb.PS_DATA);this.Queries[0].FillPanel(c);if((this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel())&&this.OrgDynRows>0){var e=this.ActualPosition();if(e>this.Queries[0].RecordCount()){e=this.Queries[0].RecordCount()}if(e<=this.OrgDynRows){this.SetDynRows(this.OrgDynRows,this.DynamicHeight)}}if(this.IsDO()){this.UpdateDynRows(this.Queries[0].RecordCount())}if(!this.IsDO()){this.SelectedRows=new Array(this.Queries[0].RecordCount()+this.NumRows);if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}var h=this.AttR;var d=this.ActualPosition();this.FireAfterFind((g)?Glb.PCM_INSERT:Glb.PCM_FIND);if(this.GroupingEnabled()&&this.ShowGroups()&&this.GroupingList.Count()>0){this.RefreshGrouping(true)}f=(h!=this.AttR)||(d!=this.ActualPosition());if((this.Flags&Glb.PAN_QBEFORM)!=0&&!g&&(this.Queries[0].RecordCount()>1||this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel())){this.set_Layout(Glb.PANEL_LIST)}this.ReValidate();this.ResetRD3Cache();if(this.EnableSortAfterPanelConf){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,200,"Panel.FindData","Panel "+this.GetDTTCaption()+": Enable Panel sorting after a SetPanelConfiguration call");this.EnableSortAfterPanelConf=false;this.EnableSorting()}}return f};IDPanelSrv.prototype.ScrollRecBy=function(d,a,b,c){if(b==undefined){b=true}if(c==undefined){c=true}if(!b||this.iStatus==Glb.PS_DATA){this.Queries[0].ScrollBy(d);this.Queries[0].FillPanel(a,c);this.ReValidate()}else{if(this.iStatus==Glb.PS_UPDATE){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION)}}};IDPanelSrv.prototype.ScrollRecTo=function(e,a,d){if(d==undefined){d=true}if(!d||this.iStatus==Glb.PS_DATA){this.Queries[0].ScrollTo(e);if(e!=0){for(var c=0;c<this.Fields.length;c++){for(var b=0;b<this.NumRows;b++){this.Fields[c].Values[b].JustBorn=true}}}this.Queries[0].FillPanel(a);this.ReValidate()}else{if(this.iStatus==Glb.PS_UPDATE){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION)}}};IDPanelSrv.prototype.UpdateIndicator=function(f){this.IndText="";if(!f){var d=(this.MainFrm.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT?"class=abm":"align=absmiddle");var e="";switch(this.iStatus){case Glb.PS_QBE:this.IndText=this.MainFrm.RTCObj.GetConst("B04012F8-21CC-45C3-9879-B32D52AF4061","Inserisci criteri di ricerca");e=this.MainFrm.RTCObj.GetConst("ED702DCB-EEFD-42B0-BF49-02CF6B902BD4","Inserisci nella riga evidenziata i criteri di ricerca, poi premi il tasto <img "+d+' src="images/find_sm.gif" alt=""> per cercare i dati nel database.');break;case Glb.PS_UPDATE:this.IndText=this.MainFrm.RTCObj.GetConst("C3123089-8533-472D-91BC-F394F71B4FEF","DATI MODIFICATI");e=this.MainFrm.RTCObj.GetConst("4F66F26E-D6C9-471C-8C2C-B63B0BB83E31","Hai modificato i dati visualizzati; se vuoi registrarli nel database premi <img "+d+' src="images/update_sm.gif" alt="">, se vuoi annullare le modifiche premi <img '+d+' src="images/cancel_sm.gif" alt="">.');break;case Glb.PS_DATA:var g=this.Queries[0].RecordCount();var b=this.Queries[0].GetAttRecNumber()+this.AttR;if(g==-1){this.IndText=IDL.FormatMessage(this.MainFrm.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB",new IDVariant("Riga |1")),new IDVariant(b),null,null,null,null,null).stringValue()}else{if(b<=g){this.IndText=IDL.FormatMessage(this.MainFrm.RTCObj.GetConst("A681B53C-BE95-4FEC-8BBE-99A4C3C27576",new IDVariant("Riga |1 di |2")),new IDVariant(b),new IDVariant(g),null,null,null,null).stringValue();if(this.Queries[0].IDColl!=null&&this.Queries[0].IDColl.HasMoreElements){this.IndText+="+"}}else{if((this.Flags&Glb.PAN_CANINSERT)!=0){this.IndText=this.MainFrm.RTCObj.GetConst("6ABFFB5D-2E2C-40EF-AD39-9FADA6B96563","Nuova Riga")}else{this.IndText=IDL.FormatMessage(this.MainFrm.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB",new IDVariant("Riga |1")),new IDVariant(b),null,null,null,null,null).stringValue()}}}if(this.Locked()&&this.Lockable){e=this.MainFrm.RTCObj.GetConst("12218460-A979-4AE4-A515-C2691BC5365E","Per modificare i dati visualizzati devi prima sbloccare il pannello premendo <img "+d+' src="images/lock_sm.gif" alt="">.')}else{if(!this.Locked()){if(b>g){e=this.MainFrm.RTCObj.GetConst("5F525AD6-9B6B-422A-BE62-1AAF758DD5B5","Puoi inserire una nuova riga scrivendo i dati direttamente qui. Per salvarli premi il tasto <img "+d+' src="images/update_sm.gif" alt="">.')}else{if(this.Parent.OpenAs!=Glb.OPEN_MDI){if(this.ShowRowSelector){if(this.isSimpleList()&&this.Parent.CloseOnSelection){e=this.MainFrm.RTCObj.GetConst("76DF611E-651B-47E1-BD35-AF20C5C0A701","Cliccando un tasto <img "+d+' src="images/rs.gif" alt=""> riporterai i dati selezionati nella videata sottostante.')}else{if(this.Parent.VisualFlag(Glb.FORMVISPROP_CONFIRMBTN)!=0){e=this.MainFrm.RTCObj.GetConst("CAFC58E3-A710-4182-95C1-02790F6E2CB0","Seleziona una riga premendo <img "+d+' src="images/rs.gif" alt="">, poi premi <img '+d+' src="images/myes_sm.gif" alt=""> per riportare i dati nella videata sottostante.')}}}else{if(this.isSimpleList()&&this.Parent.CloseOnSelection){e=this.MainFrm.RTCObj.GetConst("55EFD258-557A-476B-847A-75FD6513B9AB","Facendo doppio click su una cella riporterai i dati selezionati nella videata sottostante.")}else{if(this.Parent.VisualFlag(Glb.FORMVISPROP_CONFIRMBTN)!=0){e=this.MainFrm.RTCObj.GetConst("CDB6D1ED-65FE-4E9C-AFC4-8420A0DA42AB","Seleziona una riga posizionando il cursore su una cella, poi premi <img "+d+' src="images/myes_sm.gif" alt=""> per riportare i dati nella videata sottostante.')}}}}else{e=IDL.FormatMessage(this.MainFrm.RTCObj.GetConst("C52DA618-C8C9-4FF0-A3A6-81445E3B054E",new IDVariant("Sono state trovate |1 righe; puoi scorrerle con i tasti freccia, oppure modificare i dati")),new IDVariant(g),null,null,null,null,null).stringValue()}}}}if(this.Parent.HasOtherMessages(this)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,41,"IDPanel.UpdateIndicator","Panel "+this.GetDTTCaption()+": hide info message "+e)}e=""}break}if(this.Queries[0].IsMasterDO){if(this.Queries[0].IDColl==null){this.IndText=""}var a=false;if(this.Queries[0].DocTempl!=null){a=this.Queries[0].IDColl.IsModified()}else{var c=this.GetDocument();if(c!=null){a=c.IsModified()}}if(a!=this.MasterDocMod){this.MasterDocMod=a;this.RD3Change(RD3Glb.PAN_STATUS);this.SetRDRowSel(-1,true)}if(a&&this.Queries[0].DocTempl!=null){this.SetRDRowSel(-1,true)}if(a){this.IndText=this.MainFrm.RTCObj.GetConst("C3123089-8533-472D-91BC-F394F71B4FEF","MODIFICATO");e=this.MainFrm.RTCObj.GetConst("4F66F26E-D6C9-471C-8C2C-B63B0BB83E31","Hai modificato i dati visualizzati; se vuoi registrarli nel database premi <img "+d+' src="images/update_sm.gif" alt="">, se vuoi annullare le modifiche premi <img '+d+' src="images/cancel_sm.gif" alt="">.')}}this.SetInfoMessage(e,0)}};IDPanelSrv.prototype.EnterQBE=function(){if(this.iStatus!=Glb.PS_DATA&&this.iStatus!=Glb.PS_NONE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,42,"IDPanel.EnterQBE","Panel "+this.GetDTTCaption()+" status is not DATA (Current status = "+this.DecodeStatus(this.iStatus)+")")}return}if(this.Queries.length>0){this.Queries[0].CloseData();if((this.Flags&Glb.PAN_QBEFORM)!=0){this.set_Layout(Glb.PANEL_FORM)}this.SaveQBE(2);this.AttR=0;this.Queries[0].UpdateIMDB(0,true,true,true);this.set_Status(Glb.PS_QBE);this.ResetRD3Cache();this.Queries[0].DoUpdateLookups(0,this.MainFrm);if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}}};IDPanelSrv.prototype.DeleteRecord=function(j,e){if(e==undefined){e=false}var k=new IDVariant();var g=true;if(this.iStatus!=Glb.PS_DATA||(this.Flags&Glb.PAN_CANDELETE)==0){g=false}if(this.Queries[0].GetAttRecNumber()+this.AttR>this.Queries[0].RecordCount()){g=false}if(g){if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}this.FireBeforeDelete(k);if(k.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,79,"IDPanel.DeleteRecord","Panel "+this.GetDTTCaption()+": record delete canceled")}g=false}}if(g){if(!(this.Queries[0].DeleteRecord(j))){g=false;if(!this.IsDO()){this.Queries[0].RefreshQuery(j)}else{var f=this.GetDocument();if(f!=null){this.DumpDocErrors(f,this.AttR,true,null)}}}}if(g){if(!this.IsDO()){for(var c=this.Queries[0].GetAttRecNumber()+this.AttR-1;c<this.SelectedRows.length-1;c++){this.SelectedRows[c]=this.SelectedRows[c+1]}this.SelectedRows[this.SelectedRows.length-1]=false;if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}this.FireAfterDelete();this.ClearRD3Cache(this.Queries[0].GetAttRecNumber()+this.AttR);this.RD3Change(RD3Glb.PAN_TOTALROWS);if(this.IsDO()){this.RD3Change(RD3Glb.PAN_STATUS)}if(!e&&this.SortingList!=null&&this.SortingList.Count()>0){this.EnableSorting()}var a=0;if(!e){var b=this.Queries[0].GetAttRecNumber();var h=this.Queries[0].RecordCount();if(b+this.NumRows>h){a=h-(b+this.NumRows)+1}}this.ScrollRecBy(a,j);if(!e){var b=this.Queries[0].GetAttRecNumber();var h=this.Queries[0].RecordCount();if(b==1&&this.AttR>=h){this.SetInput(h-1,this.FocusedColumn(),1,false)}this.SetInfoMessage(j.RTCObj.GetConst("3B24C9F0-A217-41B3-BC27-D02224BCE92E","La riga è stata cancellata come richiesto."));if(!this.IsIMDB()&&(!this.IsDO()||this.Queries[0].IsMasterDO)){this.MainFrm.SoundAction("play","delete")}this.UpdateDynRows(this.Queries[0].RecordCount())}}return g};IDPanelSrv.prototype.RefreshQuery=function(a){var b=true;if(this.iStatus==Glb.PS_QBE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,80,"IDPanel.RefreshQuery","Panel "+this.GetDTTCaption()+": refresh not done (status = QBE)")}b=false}if(b){this.ReleaseLock()}if(b&&this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}if(b&&this.Queries[0].RefreshQuery(a)){this.set_Status(Glb.PS_DATA);this.ResetRD3Cache();this.ScrollRecTo(this.Queries[0].GetAttRecNumber(),a);if(!this.IsDO()){this.SelectedRows=new Array(this.Queries[0].RecordCount()+this.NumRows)}this.FireAfterFind(Glb.PCM_REQUERY);this.ReValidate();this.SetInfoMessage(a.RTCObj.GetConst("D6EBD0AE-8610-419F-B17C-6B89516A780F","I dati sono stati riletti dal database."));if(!this.IsDO()&&this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}else{b=false}};IDPanelSrv.prototype.CancelUpdate=function(b){if(this.iStatus==Glb.PS_QBE){this.SaveQBE(3);this.Queries[0].DoUpdateLookups(0,this.MainFrm);this.Queries[0].UpdateIMDB(0,true,true,true);this.SetInfoMessage(b.RTCObj.GetConst("B9659CF1-1CF2-43f1-A8B8-BC093C796877","I criteri di ricerca sono stati azzerati"));return}if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}if(this.Queries[0].IsDO){if(this.Queries[0].IDColl!=null){this.Queries[0].IDColl.RestoreOriginal();this.Queries[0].IDColl.ClearErrors();this.ResetRD3Cache();this.Queries[0].BlobCache.Clear()}else{var f=this.GetDocument();if(f!=null){if(f.IsModified()){this.ResetRD3Cache();this.Queries[0].BlobCache.Clear()}f.RestoreOriginal();f.ClearErrors()}}this.ReleaseLock()}var a=this.iStatus;this.RD3ClearLookups();this.iStatus=Glb.PS_DATA;this.ScrollRecBy(0,b,false);this.iStatus=a;this.set_Status(Glb.PS_DATA);this.SetRDRowSel(-1,true);this.RD3Change(RD3Glb.PAN_STATUS);if(this.IsDO()){this.RD3Change(RD3Glb.PAN_TOTALROWS)}var c=this.Queries[0].ActualPosition;var e=this.Queries[0].RecordCount();if(c>e){this.ScrollRecBy(c-e,b,false)}this.SetInfoMessage(b.RTCObj.GetConst("DDF707E9-8BED-48E6-B60E-2FE128DAD5C9","Le modifiche ai dati sono state annullate"));this.UpdateDynRows(this.Queries[0].RecordCount())};IDPanelSrv.prototype.UpdateRecords=function(g,r,l){if(r==undefined){r=false}if(l==undefined){l=null}var k=true;var s=false;if(this.iStatus!=Glb.PS_UPDATE){k=this.Queries[0].IsDO;if(!k&&this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,81,"IDPanel.UpdateRecords","Panel "+this.GetDTTCaption()+": update not done (status <> UPDATED)")}}this.FinalUpdate=!r||!this.Queries[0].IsDO;this.ReValidate();if(this.iStatus==Glb.PS_UPDATE&&(this.IsPanelInError()&&!this.Queries[0].IsDO)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,82,"IDPanel.UpdateRecords","Panel "+this.GetDTTCaption()+": update not done (panel is in error state)")}k=false}if(this.MainFrm.ParamsObj().UseRD3&&this.Queries[0].IsMasterDO&&!r){this.Parent.RemovePanelTempMsg(this)}if(k){if(!this.Queries[0].UpdateRecords(g)){k=false}}if(!this.Queries[0].IsMasterDO&&!r&&this.MasterPanelIdx>0){if(k){if(this.Queries[0].IDColl!=null){if(l==null){l=new ArrayList()}}this.Parent.Frames[this.MasterPanelIdx].Content.UpdateRecords(this.MainFrm,false,l);this.RD3Change(RD3Glb.PAN_STATUS)}else{if(this.Queries[0].IDColl!=null){this.DumpCollErrors(this.Queries[0].IDColl,true,null,l)}else{this.DumpDocErrors(this.GetDocument(),this.AttR,true,l)}}}else{if(l!=null){var q=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": Updating Master Document -> Firing OnPanelCommand(PCM_UPDATE) event")}this.Parent.OnPanelCommand(this,new IDVariant(Glb.PCM_UPDATE),q,new IDVariant(false));if(q.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": Updating Master Document canceled")}return false}}}if(this.Queries[0].IsMasterDO&&!r){if(this.Queries[0].DocTempl!=null||this.CanSaveMasterDoc()){var z=this.GetDocument();if(this.Queries[0].DocTempl!=null){k=this.Queries[0].IDColl.Validate(0)}else{if(z!=null){z.ReconnectChildren(9999);k=z.Validate(0,9999,true)}else{k=false}}var B=null;if(k){try{if(this.Queries[0].DocTempl!=null){k=this.Queries[0].IDColl.SaveToDB(9999,false);if(k){this.Queries[0].IDColl.PurgeDeleted()}}else{k=z.SaveToDB(9999,false)}if(k){this.Queries[0].RefreshAllLookups();this.ReleaseLock()}g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,59,"IDPanel.FireAfterCommit","Panel "+this.GetDTTCaption()+": Fire AfterCommit After Document Saving");this.Parent.AfterCommit(this,new IDVariant(1),new IDVariant(0))}catch(y){B=y;k=false}}if(!k){s=true;var c;if(this.Queries[0].DocTempl==null){this.DumpDocErrors(z,this.AttR,true,l);c=z.GetFailedDoc()}else{var f=this.Parent.Messages.Count();this.DumpCollErrors(this.Queries[0].IDColl,true,null,l);c=this.Queries[0].IDColl.GetFailedDoc();if(f==this.Parent.Messages.Count()&&this.AllowMasterPanelNav){var b=this.Queries[0].IDColl.UIMode();var u=this.Queries[0].IDColl.AbsolutePosition();this.Queries[0].IDColl.set_UIMode(true);this.Queries[0].IDColl.MoveFirst();var n=0;var h=false;while(!this.Queries[0].IDColl.IsEof()){var A=this.Queries[0].IDColl.GetAt();if(A.HasErrors()){h=true;break}this.Queries[0].IDColl.MoveNext();n++}this.Queries[0].IDColl.set_UIMode(b);this.Queries[0].IDColl.set_AbsolutePosition(u);if(h){if(n+1<this.Queries[0].GetAttRecNumber()||n+1>=this.Queries[0].GetAttRecNumber()+this.NumRows){if(this.Layout()==Glb.PANEL_LIST&&(this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel())){this.SetDynRows(n+1,this.DynamicHeight);this.set_SelectedRow(n)}else{this.ScrollRecTo(n+1,this.MainFrm,false);this.set_SelectedRow(0)}}else{if(n+1-this.Queries[0].GetAttRecNumber()!=this.AttR){this.set_SelectedRow(n+1-this.Queries[0].GetAttRecNumber())}}this.DumpCollErrors(this.Queries[0].IDColl,true,null,l);c=this.Queries[0].IDColl.GetFailedDoc()}}}this.FireDBError(new IDVariant(true),new IDVariant(true),B,Glb.PANOP_UPDATE,c)}}}if(k){this.set_Status(Glb.PS_DATA);this.ScrollRecBy(0,g,true,!r);if(!r&&(!this.IsDO()||this.Queries[0].IsMasterDO)){this.SetInfoMessage(g.RTCObj.GetConst("F2967EE7-7E44-494E-851E-C92610167032","Le modifiche ai dati sono state registrate nel database"));this.MainFrm.SoundAction("play","update")}}else{if(s||this.IsPanelInError()){var a=null;var t=false;var o=-1;var m=-1;for(var x=0;x<this.NumRows&&!t;x++){for(var v=0;v<this.Fields.length&&!t;v++){if(this.Fields[v].bValues(x).IsError()){if(a==null){a=this.Fields[v];m=v;o=x}if(this.Fields[v].Page==this.Page()){t=true}}}}if(!t&&a!=null&&a.Page!=-1&&a.Page!=this.Page()){this.set_Page(a.Page);if(this.Page()==a.Page){this.SetInput(o,m,1)}}if(this.CanAddErrMsg(-1,IDPanelSrv.EM_MSGBOX)&&this.MainFrm!=null){g.set_AlertMessage(new IDVariant(g.RTCObj.GetConst("2B8EC54C-226D-46B7-AF0B-47A1489AAAEC","Impossibile salvare i dati. E' necessario prima correggere gli errori indicati nella barra dei messaggi.")))}else{this.SetInfoMessage(g.RTCObj.GetConst("E785334F-B7B1-4BF9-9E32-8C3101DDB78C","Non è stato possibile registrare i dati nel database per gli indicati motivi."))}}}this.SetRDRowSel(-1,true);this.RD3Change(RD3Glb.PAN_TOTALROWS);return k};IDPanelSrv.prototype.GoInsertRecord=function(a){var c=true;if(this.iStatus==Glb.PS_UPDATE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.GoInsertRecord","Panel "+this.GetDTTCaption()+": insert not done (status = UPDATED)")}c=false}if(c&&(this.Flags&Glb.PAN_CANINSERT)==0){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.GoInsertRecord","Panel "+this.GetDTTCaption()+": insert not done (canInsert = false)")}c=false}if(c&&(this.Locked()&&this.EnableInsertWhenLocked())){this.set_Locked(false);if(this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED);if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.GoInsertRecord","Panel "+this.GetDTTCaption()+": insert not done (locked = true)")}c=false}}if(c&&this.iStatus==Glb.PS_QBE){var b=this.InitStatus;this.FindData(a,true,false);if(this.iStatus!=Glb.PS_DATA){c=false}if(b!=this.InitStatus&&b==Glb.INITST_NEWROW){this.InitStatus=Glb.INITST_NEWROW}}if(c){if((this.Flags&Glb.PAN_QBEFORM)!=0||this.MainFrm.IsBootstrap()){this.set_Layout(Glb.PANEL_FORM)}if((this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel())&&this.DynamicRows<=this.Queries[0].RecordCount()){this.SetDynRows(this.Queries[0].RecordCount()+1,this.DynamicHeight)}if((!this.MainFrm.IsMobile()&&!this.MainFrm.IsBootstrap()&&!this.IsFluidPanel())||this.Layout()==Glb.PANEL_FORM){if(this.MainFrm.ParamsObj().PanelInsertMaxScroll){this.ScrollRecTo(2147483647,this.MainFrm)}else{if(this.Queries[0].GetAttRecNumber()+this.NumRows-1<=this.Queries[0].RecordCount()){this.ScrollRecTo(this.Queries[0].RecordCount()-this.NumRows+2,this.MainFrm)}}}var d=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(d<0){d=0}if(d>this.NumRows-1){d=this.NumRows-1}this.AttR=d;this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetInput();if((this.Flags&Glb.PAN_NEWINSMODE)!=0||this.InitStatus==Glb.INITST_NEWROW){this.MasterFields[0].bValues(this.AttR).Modified=true;this.MasterFields[0].bValues(this.AttR).Text="§";this.SetModified(a);this.ReValidate();if(this.MasterFields[0].bValues(this.AttR).Text.equals("§")){this.MasterFields[0].bValues(this.AttR).Text="";if(!this.Queries[0].IsDO){this.MasterFields[0].bValues(this.AttR).Modified=false}else{if((this.Flags&Glb.PAN_AUTOSAVE)!=0){this.AutoSaveSamFl=true;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,165,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": Auto Saving")}this.UpdateRecords(this.MainFrm,true);this.AutoSaveSamFl=false;this.NeedAutoSave=false}}}}}};IDPanelSrv.prototype.DuplicateRecord=function(a){if(this.iStatus==Glb.PS_UPDATE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.DuplicateRecord","Panel "+this.GetDTTCaption()+": duplicate not done (status = UPDATED)")}return}if((this.Flags&Glb.PAN_CANINSERT)==0){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.DuplicateRecord","Panel "+this.GetDTTCaption()+": duplicate not done (canInsert = false)")}return}if(this.IsNewRow()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.DuplicateRecord","Panel "+this.GetDTTCaption()+": duplicate not done (empty row selected)")}return}if(!this.Queries[0].IsDO){var h=new Array(this.UMaster());var f=false;for(var b=0;b<this.UMaster();b++){if(!this.MasterFields[b].Unbound&&this.MasterFields[b].Index!=this.Queries[0].AIFieldIndex){if(!f&&(this.MasterFields[b].Flags&Glb.FLD_ISDESCR)!=0&&Glb.ClassDT(this.MasterFields[b].DataType)==Glb.DTC_CHAR&&(this.MasterFields[b].MaxLength>=this.MasterFields[b].bValues(this.AttR).Value.stringValue().length+7)){f=true;h[b]=IDL.Add(this.MasterFields[b].bValues(this.AttR).Value,new IDVariant(" (Copy)"))}else{h[b]=this.MasterFields[b].bValues(this.AttR).Value}}else{h[b]=new IDVariant()}}if(this.MainFrm.ParamsObj().PanelInsertMaxScroll){this.ScrollRecTo(2147483647,this.MainFrm)}else{if(this.Queries[0].RecordCount()+1>this.NumRows){this.ScrollRecTo(this.Queries[0].RecordCount()-this.NumRows+2,a)}}var g=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(g<0){g=0}if(g>this.NumRows-1){g=this.NumRows-1}this.AttR=g;this.SetInput();for(var b=0;b<this.UMaster();b++){this.MasterFields[b].bValues(this.AttR).SetNewValue(h[b])}this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetModified(a);this.ReValidate();this.SetRDRowSel(this.AttR,true)}else{var k=this.GetDocument();if(this.Queries[0].IDColl!=null&&k!=null){if(this.MainFrm.ParamsObj().PanelInsertMaxScroll){this.ScrollRecTo(2147483647,this.MainFrm);var g=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(g<0){g=0}if(g>this.NumRows-1){g=this.NumRows-1}AttR=g;this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetInput();var c=k.Duplicate(9999);try{this.Queries[0].IDColl.Add(c)}catch(j){}}else{this.ClearRD3Cache(this.Queries[0].GetAttRecNumber()+this.AttR);k.Duplicate(9999,this.Queries[0].IDColl);this.SetRDRowSel(this.AttR+1,true);this.Queries[0].LastRC++;this.RD3Change(RD3Glb.PAN_TOTALROWS);this.ScrollRecBy(1,this.MainFrm)}}}};IDPanelSrv.prototype.FireDBError=function(d,c,g,e,h){if(h!=null){g=h.LastFailedCheck.OrgEx}var f="";var b=0;var a=0;if(g!=null){f=g.message;a=ErrorHandlerSrv.GetErrorNumber(g)}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,60,"IDPanel.FireOnDBError","Panel "+this.GetDTTCaption()+": Fire OnDBError Event");this.Parent.OnDBError(this,d,c,new IDVariant(b),new IDVariant(f),new IDVariant(a),new IDVariant(e),h);if(c.isFalse()&&g!=null){this.Parent.DBError(this,this.Queries[0].DB,new IDVariant(this.Queries[0].DBType),new IDVariant(e),g)}};IDPanelSrv.prototype.DownloadBlob=function(a,b){var f=false;var e=-1;var g=-1;for(var d=0;d<this.UMaster()&&e==-1;d++){if(this.MasterFields[d].DataType==Glb.DT_DOC_OLE){for(var c=0;c<this.NumRows;c++){if(this.MasterFields[d].bValues(c).Value.intValue()==a){e=c;g=d;break}}}}if(e!=this.AttR&&e>-1){this.Queries[0].UpdateIMDB(e,true,false,false)}f=this.Queries[0].DownloadBlob(a,b,false);if(f){this.MasterFields[g].bValues(e).RD3Change(RD3Glb.VAL_TEXT)}if(e!=this.AttR&&e>-1){this.Queries[0].UpdateIMDB(this.AttR,true,false,false);this.IMDB.TblResetModified(this.MstTblIndex,-1)}return f};IDPanelSrv.prototype.CanAddErrMsg=function(e,c){if(e==undefined){e=-1}if(c==undefined){c=IDPanelSrv.EM_MESSAGE}var a;var b=this.IsNewRow(e);if(!b&&this.Queries[0].IsDO){var g=this.GetDocument(e);if(g!=null){b=g.Inserted()}}var f=this;while(f.MasterPanelIdx>0){f=this.Parent.Frames[f.MasterPanelIdx].Content}if(f.FinalUpdate){if(this.AutoSaveSamFl&&c==IDPanelSrv.EM_MSGBOX){a=false}else{if(b){a=this.FinalInsErrorMode<=c}else{a=this.FinalUpdErrorMode<=c}}}else{if(b){a=this.EditInsErrorMode<=c}else{a=this.EditUpdErrorMode<=c}}return a};IDPanelSrv.prototype.SetFieldErrorText=function(e,g,b,h,a){if(b==undefined){b=IDDocument.ERR_ERROR}if(h==undefined){h=false}if(a==undefined){a=null}var f=this.ValidatingRow>-1?this.ValidatingRow:this.AttR;var d=false;if(this.CanAddErrMsg(f,IDPanelSrv.EM_FIELD)){if(!this.Fields[e].bValues(f).SetError(g,b)){if(this.CanAddErrMsg()){if(!h){this.Parent.SetMessage(this.Fields[e],b==IDDocument.ERR_ERROR?AMessageSrv.MSG_STOP:AMessageSrv.MSG_WARN,g,"","VAL",(this.NumRows>1)?f+1:0,false,a);d=true}if(this.Fields[e].IsPresent()&&this.Fields[e].IsVisible(f)&&(b==IDDocument.ERR_ERROR||b==IDDocument.ERR_WARNACK)){var c=this.ValidatingRow;this.ValidatingRow=-1;this.SetInput(f,e,1,false);this.ValidatingRow=c}}}}this.RDRowSel[f]=true;return d};IDPanelSrv.prototype.SetErrorText=function(b){var a=this.ValidatingRow>-1?this.ValidatingRow:this.AttR;this.RowErrors[a]=b;this.RDRowSel[a]=true;if(this.CanAddErrMsg()){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,b,"","VAL",(this.NumRows>1)?this.ValidatingRow+1:0,false)}};IDPanelSrv.prototype.FireValidateCell=function(d,c,a,b,f,e){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,65,"IDPanel.FireValidateCell","Panel "+this.GetDTTCaption()+": Fire ValidateCell Event")}this.Parent.ValidateCell(this,d,c,a,b,f,e)};IDPanelSrv.prototype.FireValidateRow=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,66,"IDPanel.FireValidateRow","Panel "+this.GetDTTCaption()+": Fire ValidateRow Event")}this.Parent.ValidateRow(this,a)};IDPanelSrv.prototype.IsRowInError=function(b){if(this.RowErrors[b].length>0){return true}for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].bValues(b).IsError()){return true}}return false};IDPanelSrv.prototype.IsPanelInError=function(){for(var a=0;a<this.NumRows;a++){if(this.IsRowInError(a)){return true}}return false};IDPanelSrv.prototype.GetRowError=function(a){return this.RowErrors[a]};IDPanelSrv.prototype.SetRowError=function(b,c){var a=true;if(c.length!=0){a=this.CanAddErrMsg()}this.RowErrors[b]=c;if(a){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,c,"","VAL",(this.NumRows>1)?b+1:0,false)}};IDPanelSrv.prototype.ReValidate=function(){var o=new IDVariant();var k=false;var g=false;var a=false;var d=false;var b=this.Queries[0].RecordCount();var c=this.Queries[0].GetAttRecNumber();for(var e=0;e<this.Fields.length;e++){this.Fields[e].ResetDynProp()}if(this.iStatus==Glb.PS_UPDATE&&this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}if(this.MainFrm!=null&&!this.DisableNotification){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,69,"IDPanel.ReValidate","Panel "+this.GetDTTCaption()+": Fire OnDynamicProperties Event for rows = 1 to "+this.NumRows)}for(var f=0;f<this.NumRows;f++){this.Queries[0].UpdateIMDB(f,true,false,true);this.ValidatingRow=f;k=false;if(this.iStatus==Glb.PS_UPDATE){k=this.RowErrors[f].length>0;if(!k){g=true;for(var e=0;e<this.MasterFields.length;e++){g&=this.MasterFields[e].bValues(f).Text.length==0;if(this.MasterFields[e].bValues(f).NotValidated||this.MasterFields[e].bValues(f).IsError()||(this.MasterFields[e].bValues(f).Modified&&!this.MasterFields[e].bValues(f).Value.equals(this.MasterFields[e].bValues(f).LastValue))){k=true}}if((c+this.ValidatingRow)>b){k=!g;if(g){this.RowErrors[f]="";for(var l=0;l<this.Fields.length;l++){if(this.bFields(l).IdxPanel!=0){this.bFields(l).bValues(f).ClearError()}}}}}}if(k){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,39,"IDPanel.ReValidate","Panel "+this.GetDTTCaption()+": revalidating row "+(this.ValidatingRow+1))}a=this.RowErrors[f].length>0;this.RowErrors[f]="";for(var l=0;l<this.Fields.length;l++){if(this.bFields(l).IdxPanel!=0){this.bFields(l).bValues(f).ClearError()}}for(var e=0;e<this.Fields.length;e++){if((c+this.ValidatingRow)>b||this.Fields[e].bValues(f).NotValidated||this.Fields[e].bValues(f).IsError()||(this.Fields[e].bValues(f).Modified&&!this.Fields[e].bValues(f).Value.equals(this.Fields[e].bValues(f).LastValue))||(this.Fields[e].bValues(f).Modified&&a)){this.Fields[e].ValidateCell(this.ValidatingRow)}}for(var e=1;e<this.Queries.length;e++){this.Queries[e].ValidateLookup(f)}this.FireValidateRow(o);if(this.LastMasterDocument!=null){var q=new IDVariant();if(!this.LastMasterDocument.GetLock(9999,"",q)){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,q.ToString(),"","VAL",(this.NumRows>1)?f+1:0,false)}}for(var e=0;e<this.UMaster();e++){if(this.bMaster(e).IdxPanel==0){var h=this.bMaster(e).UpdateField(f);d=d||h}}}if(!this.DisableNotification){this.Parent.DynamicProperties(this)}for(var e=0;e<this.Fields.length;e++){this.Fields[e].bValues(f).SaveDynProp()}}this.Queries[0].UpdateIMDB(this.AttR,true,false,true);this.ValidatingRow=-1;if(d){this.SetModified(this.MainFrm)}return d};IDPanelSrv.prototype.IsRowModified=function(c){var d=false;var a=true;for(var b=0;b<this.UMaster();b++){d=d||this.bMaster(b).bValues(c).Modified;a=a&&this.bMaster(b).bValues(c).IsEmptyValue();if(d&&!a){break}}return d&&!a};IDPanelSrv.prototype.FireCellActivated=function(b,a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,44,"IDPanel.FireCellActivated","Panel "+this.GetDTTCaption()+": Fire CellActivated Event (Current Row = "+(this.ValidatingRow+1)+", Column Index = "+(b.intValue()+1)+")")}this.Parent.CellActivated(this,b,a)};IDPanelSrv.prototype.FireBeforeFind=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,45,"IDPanel.FireBeforeFind","Panel "+this.GetDTTCaption()+": Fire BeforeFind Event")}this.Parent.BeforeFind(this,a)};IDPanelSrv.prototype.FireOnChangeRow=function(){if(!this.DisableNotification&&!this.DisableChangeRow){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,46,"IDPanel.FireOnChangeRow","Panel "+this.GetDTTCaption()+": Fire OnChangeRow Event")}this.AdjustExtProp();this.Parent.OnChangeRow(this);if(this.IsDO()){this.RD3Change(RD3Glb.PAN_ENABLEDCOMMANDS)}}};IDPanelSrv.prototype.FireBeforeUpdate=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,47,"IDPanel.FireBeforeUpdate","Panel "+this.GetDTTCaption()+": Fire BeforeUpdate Event")}this.Parent.BeforeUpdate(this,a)};IDPanelSrv.prototype.FireBeforeInsert=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,50,"IDPanel.FireBeforeInsert","Panel "+this.GetDTTCaption()+": Fire BeforeInsert Event")}this.Parent.BeforeInsert(this,a)};IDPanelSrv.prototype.FireBeforeDelete=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,51,"IDPanel.FireBeforeDelete","Panel "+this.GetDTTCaption()+": Fire BeforeDelete Event")}this.Parent.BeforeDelete(this,a)};IDPanelSrv.prototype.FireAfterFind=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,56,"IDPanel.FireAfterFind","Panel "+this.GetDTTCaption()+": Fire AfterFind Event")}this.Parent.AfterFind(this,new IDVariant(a))};IDPanelSrv.prototype.FireOnSelectingRow=function(){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,57,"IDPanel.FireOnSelectingRow","Panel "+this.GetDTTCaption()+": Fire OnSelectingRow Event")}this.Parent.OnSelectingRow(this)};IDPanelSrv.prototype.FireOnSorting=function(b,a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,172,"IDPanel.FireOnSorting","Panel "+this.GetDTTCaption()+": Fire OnSorting Event")}this.Parent.OnSorting(this,new IDVariant(b),a)};IDPanelSrv.prototype.FireOnChangeSelection=function(f,b,d,e,c){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,190,"IDPanel.FireOnChangeSelection","Panel "+this.GetDTTCaption()+": Fire OnChangeSelection "+(d?"final":"")+" Event")}var a=this.ValidatingRow;if(!d){this.Queries[0].UpdateIMDB(f-this.Queries[0].GetAttRecNumber(),true,false,e);this.ValidatingRow=f-this.Queries[0].GetAttRecNumber()}this.Parent.OnChangeSelection(this,new IDVariant(b),new IDVariant(d),c);if(!d){this.Queries[0].UpdateIMDB(this.AttR,true,false,e);this.ValidatingRow=a}};IDPanelSrv.prototype.FireAfterUpdate=function(){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,52,"IDPanel.FireAfterUpdate","Panel "+this.GetDTTCaption()+": Fire AfterUpdate Event")}this.Parent.AfterUpdate(this)};IDPanelSrv.prototype.FireAfterInsert=function(){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,54,"IDPanel.FireAfterInsert","Panel "+this.GetDTTCaption()+": Fire AfterInsert Event")}this.Parent.AfterInsert(this)};IDPanelSrv.prototype.FireAfterDelete=function(){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,55,"IDPanel.FireAfterDelete","Panel "+this.GetDTTCaption()+": Fire AfterDelete Event")}this.Parent.AfterDelete(this)};IDPanelSrv.prototype.FireCreateDocument=function(b,a){this.MainFrm.CreateDocument(b,a)};IDPanelSrv.prototype.set_Status=function(b){var a=this.iStatus;this.iStatus=b;if(b!=a){this.RD3Change(RD3Glb.PAN_STATUS);if(b!=Glb.PS_QBE){this.InitStatus=Glb.INITST_SEARCH}if(this.GroupingEnabled()&&this.ShowGroups()&&this.iStatus==Glb.PS_QBE){this.MainFrm.RD3AddEvent("rstgrp",this.GetRD3Ident())}if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,36,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": status changed from "+this.DecodeStatus(a)+" to "+this.DecodeStatus(b))}this.Parent.OnChangeStatus(this,new IDVariant(a))}};IDPanelSrv.prototype.Status=function(){return this.iStatus};IDPanelSrv.prototype.OffsetRow=function(){return this.VS.RowOffset(this.iVisualStyle)};IDPanelSrv.prototype.OffsetHeader=function(){return this.VS.HeaderOffset(this.iVisualStyle)};IDPanelSrv.prototype.BackColor=function(){return this.VS.Color(this.iVisualStyle,Glb.VISCLR_BACKPANEL)};IDPanelSrv.prototype.BackGradColor=function(){if(this.BackColor()!=-1){return this.VS.GradCol(this.iVisualStyle,Glb.VISCLR_BACKPANEL)}else{return -1}};IDPanelSrv.prototype.BackGradDir=function(){return this.VS.GradDir(this.iVisualStyle,Glb.VISCLR_BACKPANEL)};IDPanelSrv.prototype.Opacity=function(){return this.VS.Opacity(this.iVisualStyle,Glb.VISCLR_BACKPANEL)};IDPanelSrv.prototype.ResetSortList=function(){for(var a=0;a<this.SortingList.Count();a++){var b=this.SortingList[a];if(b.SortMode!=0){b.RD3Change(RD3Glb.FLD_SORTMODE)}b.SortMode=0;if(b.SortFld!=-1){if(this.Fields[b.SortFld].SortMode!=0){this.Fields[b.SortFld].RD3Change(RD3Glb.FLD_SORTMODE)}this.Fields[b.SortFld].SortMode=0}}this.SortingList.Clear()};IDPanelSrv.prototype.AddToSortList=function(c,b){var a=this.Fields[c];if(a.SortFld!=-1){a=this.Fields[a.SortFld]}if(a.IdxPanel!=0){return}if(this.SortingList.IndexOf(a)==-1){this.SortingList.Add(a)}a.RD3Change(RD3Glb.FLD_SORTMODE);a.SortMode=(b)?1:-1;this.Fields[c].RD3Change(RD3Glb.FLD_SORTMODE);this.Fields[c].SortMode=(b)?1:-1};IDPanelSrv.prototype.RemoveFromSortList=function(b){var a=this.Fields[b];if(a.SortFld!=-1){a=this.Fields[a.SortFld]}if(a.IdxPanel!=0){return}if(this.SortingList.IndexOf(a)>=0){this.SortingList.Remove(a)}a.RD3Change(RD3Glb.FLD_SORTMODE);a.SortMode=0;this.Fields[b].RD3Change(RD3Glb.FLD_SORTMODE);this.Fields[b].SortMode=0};IDPanelSrv.prototype.EnableSorting=function(){if(this.iStatus!=Glb.PS_DATA){return}var d=(this.SelectedRows!=null?this.SelectedRows.clone():null);var e=(this.Queries[0].LookupRows!=null?this.Queries[0].LookupRows.clone():null);var c=null;if(this.Queries[0].IMDBDataSource!=-1&&this.EnableMultipleSel()&&this.ShowMultipleSel()){c=new ArrayList();this.IMDB.TblMoveFirst(this.Queries[0].IMDBDataSource,Glb.IMDB_CURSOR);for(var a=0;a<this.IMDB.TblNumRows(this.Queries[0].IMDBDataSource);a++){if(this.SelectedRows[a]){c.Add(this.IMDB.GetRowBookMark(this.Queries[0].IMDBDataSource,Glb.IMDB_CURSOR))}this.IMDB.TblMoveNext(this.Queries[0].IMDBDataSource,Glb.IMDB_CURSOR)}}var l=new ArrayList();if(this.GroupingEnabled()&&this.ShowGroups()&&this.Status()!=Glb.PS_QBE&&this.GroupingList.Count()>0){for(var g=0;g<this.GroupingList.Count();g++){var m=this.GroupingList[g];if(m.SortFld!=-1){m=this.Fields[m.SortFld]}l.Add(m)}}l.AddRange(this.SortingList);var b=this.SortingList;this.SortingList=l;if(this.Queries[0].EnableSorting(l)){this.ScrollRecTo(this.Queries[0].GetAttRecNumber(),this.MainFrm);this.ResetRD3Cache()}this.SortingList=b;if(this.Queries[0].IMDBDataSource!=-1){this.SelectedRows=new Array(this.SelectedRows.length);if(c!=null&&c.Count()>0){this.IMDB.TblMoveFirst(this.Queries[0].IMDBDataSource,Glb.IMDB_CURSOR);for(var a=0;a<this.IMDB.TblNumRows(this.Queries[0].IMDBDataSource);a++){var h=this.IMDB.GetRowBookMark(this.Queries[0].IMDBDataSource,Glb.IMDB_CURSOR);if(c.IndexOf(h)!=-1){this.SelectedRows[a]=true}this.IMDB.TblMoveNext(this.Queries[0].IMDBDataSource,Glb.IMDB_CURSOR)}}if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}else{if(!this.IsDO()){if(e!=null){this.SelectedRows=new Array(this.SelectedRows.length);for(var k=0;k<this.SelectedRows.length;k++){if(k<e.length){this.SelectedRows[e[k]-1]=d[k]}else{this.SelectedRows[k]=false}}}if(this.Queries[0].LookupRows!=null){d=this.SelectedRows.clone();for(var k=0;k<this.SelectedRows.length;k++){if(k<this.Queries[0].LookupRows.length){this.SelectedRows[k]=d[this.Queries[0].LookupRows[k]-1]}else{this.SelectedRows[k]=false}}}if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}}};IDPanelSrv.prototype.SaveQBE=function(b){var c="";switch(b){case 1:c="Saving";break;case 2:c="Loading";break;case 3:c="Clearing";break}if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,38,"IDPanel.SaveQBE","Panel "+this.GetDTTCaption()+": "+c+" QBE criteria")}for(var a=0;a<this.UMaster();a++){switch(b){case 1:if((this.MasterFields[a].Flags&Glb.FLD_AUTOLOOKUP)!=0&&!this.MasterFields[a].iMultiCriteria){this.MasterFields[a].LastQBE=this.MasterFields[a].bValues(0).Value.stringValue()}else{this.MasterFields[a].LastQBE=this.MasterFields[a].bValues(0).Text}this.MasterFields[a].LastQBEPos=this.MasterFields[a].bValues(0).ValueListIndexes;break;case 2:this.MasterFields[a].bValues(0).SetNewText(this.MasterFields[a].LastQBE,(this.MasterFields[a].Flags&Glb.FLD_AUTOLOOKUP)!=0&&!this.MasterFields[a].iMultiCriteria);this.MasterFields[a].bValues(0).ValueListIndexes=this.MasterFields[a].LastQBEPos;break;case 3:this.MasterFields[a].LastQBE="";this.MasterFields[a].LastQBEPos=new Array(0);this.MasterFields[a].iMultiCriteria=false;if(this.iStatus==Glb.PS_QBE){this.MasterFields[a].bValues(0).Clear()}this.QBETip="";this.QBETipText="";this.RD3Change(RD3Glb.PAN_QBETIP);break}}};IDPanelSrv.prototype.QBEFilter=function(a){return this.Fields[a].LastQBE};IDPanelSrv.prototype.set_QBEFilter=function(g,e,b){if(b==undefined){b=true}this.Fields[g].LastQBE=e;this.Fields[g].RD3Change(RD3Glb.FLD_QBEFILTER);if(this.iStatus==Glb.PS_QBE){this.Fields[g].bValues(0).SetNewText(e,false);this.Queries[0].UpdateIMDB(0,true,false,false)}if(e.length==0||(e.charAt(0)=="="&&!this.Fields[g].HasConcept("DO_ID"))){this.Fields[g].iMultiCriteria=false}else{this.Fields[g].iMultiCriteria=(e.indexOf(this.Fields[g].GetQBESep())>0)}if(this.MainFrm.IsMobile()&&b){for(var a=0;a<this.Fields.length;a++){var d=this.Fields[a];if((d.Flags&Glb.FLD_INLIST)!=0&&(d.Flags&Glb.FLD_LISTLIST)!=0&&Glb.ClassDT(d.DataType)==Glb.DTC_CHAR){if(g==a){var c=this.MainFrm.RD3AddEvent("searchval",this.GetRD3Ident());c.SetAttribute("val",e)}break}}}};IDPanelSrv.prototype.UploadBlob=function(c){var a=this.MainFrm.Request.QueryString.WCE;for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].bValues(this.AttR).Uploading||this.Fields[b].GetRD3Ident().equals(a)){this.Queries[0].UploadBlob(this.Fields[b].bValues(this.AttR).Value.intValue(),this.Fields[b].MaxUploadSize);this.Fields[b].bValues(this.AttR).Uploading=false;this.Fields[b].bValues(this.AttR).RD3Change(RD3Glb.VAL_TEXT);break}}};IDPanelSrv.prototype.SetFieldBlobSize=function(d,a,c,b){if(a instanceof IDVariant){a=(a.Type==IDVariant.NULL?this.Fields[d].MaxAutoShowSize:a.intValue());c=(c.Type==IDVariant.NULL?this.Fields[d].MaxUploadSize:c.intValue())}this.Fields[d].MaxAutoShowSize=a;if(c==0||c>1024*this.MainFrm.ParamsObj().MaxRequestSize){c=1024*this.MainFrm.ParamsObj().MaxRequestSize;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,197,"PField.SetBlobSize","Field "+this.Fields[d].GetDTTCaption()+": MaxUploadSize set to MaxRequestSize = "+this.MainFrm.ParamsObj().MaxRequestSize+"KB")}}this.Fields[d].MaxUploadSize=c;this.Fields[d].BlobNewWindow=b};IDPanelSrv.prototype.SetFieldBlobExtensions=function(c,a,b){this.Fields[c].UploadExtensions=a;this.Fields[c].UploadDescription=b};IDPanelSrv.prototype.SetFieldMultiUpload=function(c,b,a){if(this.Fields[c].IdxPanel==-1){this.Fields[c].MultiUpload=true;this.Fields[c].MaxUploadFiles=b;if(a==0||a>1024*this.MainFrm.ParamsObj().MaxRequestSize){if(this.MainFrm!=null&&a>0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,197,"PField.SetMultiUpload","Field "+this.Fields[c].GetDTTCaption()+": MaxSize set to MaxRequestSize = "+this.MainFrm.ParamsObj().MaxRequestSize+"KB")}a=1024*this.MainFrm.ParamsObj().MaxRequestSize}this.Fields[c].MaxUploadSize=a}};IDPanelSrv.prototype.MaxLength=function(a){return this.Fields[a].MaxLength};IDPanelSrv.prototype.set_MaxLength=function(b,a){this.Fields[b].MaxLength=a;this.Fields[b].RD3Change(RD3Glb.FLD_MAXLENGTH)};IDPanelSrv.prototype.FieldText=function(a){if(this.Fields[a].IdxPanel==-1){return this.Fields[a].Header}else{if(this.ValidatingRow==-1){return this.Fields[a].bValues(this.AttR).Text}else{if(this.Fields[a].bValues(this.ValidatingRow).NotValidated){return this.Fields[a].bValues(this.ValidatingRow).LastText}else{return this.Fields[a].bValues(this.ValidatingRow).Text}}}};IDPanelSrv.prototype.set_FieldText=function(b,a){if(this.Fields[b].IdxPanel==-1){if(!this.Fields[b].Header.equals(a)){this.Fields[b].Header=a;this.Fields[b].RD3Change(RD3Glb.FLD_HEADER)}}else{if(this.ValidatingRow==-1){this.Fields[b].bValues(this.AttR).Text=a;this.Fields[b].bValues(this.AttR).RD3Change(RD3Glb.VAL_TEXT)}else{this.Fields[b].bValues(this.ValidatingRow).DynText=true;this.Fields[b].bValues(this.ValidatingRow).Text=a;this.Fields[b].bValues(this.ValidatingRow).RD3Change(RD3Glb.VAL_TEXT)}}};IDPanelSrv.prototype.set_FieldCode=function(b,a){this.Fields[b].Code=a};IDPanelSrv.prototype.HasCaptionCommands=function(){return this.ShowToolbar};IDPanelSrv.prototype.Value=function(a){if(this.MstTblIndex>-1){var b=this.IMDB.FldByCode(this.MstTblIndex,a);if(b>-1){return this.IMDB.Value(this.MstTblIndex,b,0)}}return new IDVariant()};IDPanelSrv.prototype.set_Value=function(a,b){if(this.MstTblIndex>-1){var c=this.IMDB.FldByCode(this.MstTblIndex,a);if(c>-1){this.IMDB.set_Value(this.MstTblIndex,c,0,b)}}};IDPanelSrv.prototype.OrgValue=function(a){if(this.ValidatingRow==-1){return this.Fields[a].bValues(this.AttR).OrgValue}else{return this.Fields[a].bValues(this.ValidatingRow).OrgValue}};IDPanelSrv.prototype.UpdateDynRows=function(b){if(this.DynamicRows==0||this.PanelMode==Glb.PANEL_FORM){if(this.OriginalListHeight>0&&this.BoundRect!=null){this.ListHeight=this.OriginalListHeight;this.BoundRect.Height=this.OriginalBoundHeight;this.RD3Change(RD3Glb.PAN_LISTHEIGHT);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT)}if(this.DynamicHeight&&this.Parent!=null){if(this.Parent.Frames[this.FrIndex].OriginalHeight>0){this.Parent.Frames[this.FrIndex].FixedHeight=this.Parent.Frames[this.FrIndex].OriginalHeight}}return}if(this.DesignListHeight==-100&&this.IsFluidPanel()){this.DesignListHeight=this.ListHeight}if(b>-1){var a=(this.Flags&Glb.PAN_CANINSERT)!=0;if(this.MainFrm.IsMobile()){if((this.Flags&Glb.PAN_HASFORM)==0){a&=!this.Locked()}else{if(this.iLockable()&&this.PanelMode==Glb.PANEL_LIST&&(this.Flags&Glb.PAN_HASFORM)!=0){a=false}}}if(this.MainFrm.IsBootstrap()){if(this.PanelMode==Glb.PANEL_LIST){a=false}}if(a){if(this.DynamicRows==b&&(this.MainFrm.IsMobile()||this.IsFluidPanel())){this.SetDynRows(b+1,this.DynamicHeight,false)}b++}if(b>this.DynamicRows){b=this.DynamicRows}if(b<1){b=1}this.LastDynRows=b}else{if(this.LastDynRows>0){b=this.LastDynRows}else{b=this.NumRows}}if(b!=this.NumRows||this.OriginalListHeight==0){this.RD3Change(RD3Glb.PAN_LISTHEIGHT);this.RD3Change(RD3Glb.PAN_NUMROWS);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT)}if(this.OriginalListHeight==0&&this.BoundRect!=null){this.OriginalListHeight=this.ListHeight;this.OriginalBoundHeight=this.BoundRect.Height}this.ListHeight=this.HeaderSize+this.OffsetRow()+b*(this.MaxHRow+this.OffsetRow())+this.OffsetHeader();if(!this.MainFrm.IsBootstrap()&&!this.MainFrm.IsMobile()&&!this.IsFluidPanel()&&this.UseListQBERow()){this.ListHeight+=this.MaxHRow}this.CalcLayout();if(this.DynamicHeight&&this.Parent!=null){if(this.Parent.Frames[this.FrIndex].OriginalHeight==0){this.Parent.Frames[this.FrIndex].OriginalHeight=this.Parent.Frames[this.FrIndex].FixedHeight}this.Parent.Frames[this.FrIndex].FixedHeight=this.ListTop+this.ListHeight+24;if(this.MainFrm.ParamsObj().UseRD3){this.Parent.Frames[this.FrIndex].FixedHeight+=12;if(!this.MainFrm.ParamsObj().Theme.equals("seattle")){this.Parent.Frames[this.FrIndex].FixedHeight+=4}}this.Parent.Frames[this.FrIndex].Height=this.Parent.Frames[this.FrIndex].FixedHeight;if(this.BoundRect!=null){this.BoundRect.Height=this.ListTop+this.ListHeight+24}}};IDPanelSrv.prototype.SetDynRows=function(c,a,b){if(b==undefined){b=true}if(this.MainFrm.ParamsObj().UseFluid){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,70,"IDPanel.SetDynRows","Panel "+this.GetDTTCaption()+": FLUID engine does not require Dynamic Rows");return}if(this.DynamicRows!=c){this.DynamicRows=c;this.DynamicHeight=a;if(this.OrgDynRows==0){this.OrgDynRows=this.DynamicRows}this.RD3Change(RD3Glb.PAN_DYNAMICROWS);this.RD3Change(RD3Glb.PAN_DYNAMICHEIGHT);if(b&&this.Status()==Glb.PS_DATA){this.UpdateDynRows(this.Queries[0].RecordCount());this.ScrollRecTo(this.Queries[0].GetAttRecNumber(),this.MainFrm);if(this.Queries[0].ActualPosition+this.NumRows>=this.Queries[0].RecordCount()){this.LoadMoreRows()}}if(this.DynamicRows>0&&this.VListResizeMode!=Glb.RESMODE_NONE){this.VListResizeMode=Glb.RESMODE_NONE;this.RD3Change(RD3Glb.PAN_VRESMODE)}}};IDPanelSrv.prototype.FindField=function(c,a){if(a==undefined){a=-999}if(c==null){return -1}for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].Code.equals(c)&&(a==-999||this.Fields[b].IdxPanel==a)){return b}}return -1};IDPanelSrv.prototype.FieldCode=function(a){return this.bMaster(a).Code};IDPanelSrv.prototype.IsNewRow=function(c){if(c==undefined){c=-1}var b=c;if(b==-1){b=this.ValidatingRow}if(b==-1){b=this.AttR}var d=this.Queries[0].RecordCount();var a=this.Queries[0].GetAttRecNumber()+b;return a>d};IDPanelSrv.prototype.set_Visible=function(a){a=a&&((this.RoleFlags&Glb.OBJ_VISIBLE)!=0);if(this.Visible!=a){WebFrameSrv.prototype.set_Visible.call(this,a);for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].SubFrame>0){this.Parent.Frames[this.Fields[b].SubFrame].Content.set_Visible(a)}}if(this.Parent!=null&&this.Parent.Frames[this.FrIndex].InTabbed&&this.Parent.Frames[this.Parent.Frames[this.FrIndex].TabIdx]!=null){this.Parent.Frames[this.Parent.Frames[this.FrIndex].TabIdx].Content.ChangeItemVisibility(this.FrIndex,this.MainFrm)}}};IDPanelSrv.prototype.set_Collapsed=function(b){if(this.Collapsed!=b){WebFrameSrv.prototype.set_Collapsed.call(this,b);if(this.Collapsed==b){for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].SubFrame>0){this.Parent.Frames[this.Fields[a].SubFrame].Content.set_Collapsed(b)}}}}};IDPanelSrv.prototype.GetContentSize=function(){var c=new RectSrv();var b=new RectSrv();for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].IsPresent()){b=this.Fields[a].GetValueRect(this.PanelMode,0);if(b.Left+b.Width>c.Width){c.Width=b.Left+b.Width}if(b.Top+b.Height>c.Height){c.Height=b.Top+b.Height}b=this.Fields[a].GetHeaderRect(this.PanelMode);if(b.Left+b.Width>c.Width){c.Width=b.Left+b.Width}if(b.Top+b.Height>c.Height){c.Height=b.Top+b.Height}}}c.Width=c.Width+Glb.HEADER_GAP;c.Height=c.Height+Glb.HEADER_GAP;if(this.BoundRect!=null){if(c.Height<this.BoundRect.Height){c.Height=this.BoundRect.Height}if(c.Width<this.BoundRect.Width){c.Width=this.BoundRect.Width}}this.BoundRect=c;return c};IDPanelSrv.prototype.Locked=function(){if(this.Queries[0].IsDO&&this.Queries[0].Document==null&&this.Queries[0].IDColl==null){return true}return this.iLocked};IDPanelSrv.prototype.set_Locked=function(a){if(a==this.iLocked){return}var b=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,67,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": "+(a?"locking":"unlocking")+"; fire OnChangeLocking event")}this.Parent.OnChangeLocking(this,new IDVariant(a),b);if(b.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,40,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": "+(a?"locking":"unlocking")+" canceled")}return}var e=this.Queries[0].IsDO;if(e){if(this.Queries[0].Document==null&&this.Queries[0].IDColl==null&&!a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,40,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": cannot unlock a NULL document panel")}return}if(a){var d=this.GetDocument();if(d!=null){if(d.IsModified()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,85,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": can't be locked (document is modified!)")}return}}}if(!this.MainFrm.IsMobile()){for(var c=0;c<this.Parent.Frames.length;c++){if(this.Parent.Frames[c]!=null&&this.Parent.Frames[c].Content!=null&&this.Parent.Frames[c].Content!=this){if(this.Parent.Frames[c].Content instanceof IDPanelSrv){var g=this.Parent.Frames[c].Content;if(g.Queries[0].IsDO&&g.MasterPanelIdx==this.FrIndex){g.set_Locked(a)}}}}}}else{if(!a){if(!this.CanBeUnlocked()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,85,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": can't be unlocked (there is an UPDATED panel that can't be locked)")}return}for(var c=0;c<this.Parent.Frames.length;c++){if(this.Parent.Frames[c]!=null&&this.Parent.Frames[c].Content!=null&&this.Parent.Frames[c].Content!=this){if(this.Parent.Frames[c].Content instanceof IDPanelSrv){var g=this.Parent.Frames[c].Content;if(g.Lockable){g.set_Locked(true)}}}}}}this.iLocked=a;this.RD3FrameChange(RD3Glb.WFR_LOCKED);if((this.Flags&Glb.PAN_QBEFORM)!=0&&this.MainFrm.IsBootstrap()&&(this.Flags&Glb.PAN_HASFORM)!=0&&this.PanelMode==Glb.PANEL_LIST){this.set_Layout(Glb.PANEL_FORM)}this.UpdateDynRows(this.Queries[0].RecordCount());if(this.Lockable){var f=(this.MainFrm.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT?"class=abm":"align=absmiddle");if(this.Locked()){this.SetInfoMessage(this.MainFrm.RTCObj.GetConst("5D4E319E-B352-4196-AC50-1EA42CE3BC70","Ora NON è possibile modificare i dati, premi il tasto <img "+f+' src="images/lock_sm.gif" alt=""> per modificarli.'))}else{this.SetInfoMessage(this.MainFrm.RTCObj.GetConst("12862811-7F29-4CDE-A9A3-EF9C3A2A669F","Ora è possibile modificare i dati, premi il tasto <img "+f+' src="images/unlk_sm.gif" alt=""> per bloccare il pannello.'))}}};IDPanelSrv.prototype.ToString=function(){if(this.FrIndex>0){return this.Parent.Frames[this.FrIndex].Caption}else{return this.MasterRowName}};IDPanelSrv.prototype.isSimpleList=function(){if(this.PanelMode==Glb.PANEL_FORM){return false}for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].IsPresent()&&(this.Fields[a].Flags&Glb.FLD_LISTLIST)==0&&this.Fields[a].IdxPanel>-1){return false}}return true};IDPanelSrv.prototype.SetInfoMessage=function(a,c,b){if(typeof(a)=="number"){if((c==null||c.equals(""))&&this.InfoPriority<=b){this.InfoPriority=b;this.Parent.SetMessage(this,a,c,"","INFO",0,false)}else{if(this.Visible&&!this.Collapsed&&this.Exposed()){if(this.InfoPriority<=b){this.InfoPriority=b;this.Parent.SetMessage(this,a,c,"","INFO",0,false)}}}}else{b=c;c=a;if(b==undefined){b=1}if(this.ShowInfoMessages){this.SetInfoMessage(AMessageSrv.MSG_INFO,c,b)}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,86,"IDPanel.SetInfoMessage","Panel "+this.GetDTTCaption()+": can't add info message (Panel.ShowInfoMessage = FALSE)");this.MainFrm.DTTObj.AddParameter(this.iGuid,this.iGuid,"Message",new IDVariant(c))}}};IDPanelSrv.prototype.ActualPosition=function(a){if(a==undefined){a=false}return this.Queries[0].GetAttRecNumber()+this.AttR};IDPanelSrv.prototype.set_ActualPosition=function(c,d){if(typeof(c)=="number"&&d==undefined){d=c;c=false}var b=-1;if(this.Status()!=Glb.PS_DATA){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",160,"IDPanel.ActualPosition","Panel "+this.GetDTTCaption()+" - Cannot set Actual Position while Status != DATA")}return}if(c){this.ForceSendPosition=true}if(this.IsShowingGrouping()&&!this.DisableLookups){this.ScrollRecTo(d,this.MainFrm);return}var a=this.Queries[0].GetAttRecNumber();if((d>=a&&d<a+this.NumRows)){if(d-a!=this.AttR){b=d-a;this.Queries[0].UpdateIMDB(this.AttR,true,true,false)}}else{this.ScrollRecTo(d,this.MainFrm);b=d-this.Queries[0].GetAttRecNumber();if(this.AttR>=this.NumRows){b=this.NumRows-1}}if(b>-1){this.set_SelectedRow(b)}};IDPanelSrv.prototype.SelectedRow=function(a){if(a==undefined){a=false}return this.AttR};IDPanelSrv.prototype.set_SelectedRow=function(c,b){if(typeof(c)=="number"&&b==undefined){b=c;c=false}var a=this.AttR;this.AttR=b;if(!this.IsPanelFixActiveRowWhenScrolled()&&(this.AttR>=this.NumRows||this.AttR<0)){this.AttR=0}if(this.AttR>=0&&this.AttR<this.NumRows){if(this.AttR!=a&&this.ValidatingRow==-1){this.Queries[0].UpdateIMDB(this.AttR,true,true,true)}if(this.AttR!=a){if(this.Parent.FocusPriority<=1){this.Parent.FocusPriority=0}this.SetInput()}}this.RD3Change(RD3Glb.PAN_ACTUALROW);if(c){this.ForceSendPosition=true}};IDPanelSrv.prototype.GetValidatingRow=function(){return this.ValidatingRow};IDPanelSrv.prototype.GetNumRows=function(){return this.Queries[0].RecordCount()};IDPanelSrv.prototype.GetValueAt=function(b,a){return this.Fields[b].bValues(a-1).Value};IDPanelSrv.prototype.GetLastValue=function(a){return this.Fields[a].bValues((this.ValidatingRow==-1?this.AttR:this.ValidatingRow)).LastValue};IDPanelSrv.prototype.GetOrgValue=function(a){return this.Fields[a].bValues((this.ValidatingRow==-1?this.AttR:this.ValidatingRow)).OrgValue};IDPanelSrv.prototype.CanSaveMasterDoc=function(){for(var a=0;a<this.Parent.Frames.length;a++){if(this.Parent.Frames[a]!=null&&this.Parent.Frames[a].Content!=null){if(this.Parent.Frames[a].Content instanceof IDPanelSrv){var b=this.Parent.Frames[a].Content;if(b!=this&&b.Queries[0].IsDO){if(b.Status()==Glb.PS_UPDATE){return false}}}}}return true};IDPanelSrv.prototype.Exposed=function(){if(this.iExposed&&!this.Parent.Frames[this.FrIndex].Exposed){this.iExposed=false}return WebFrameSrv.prototype.Exposed.call(this)};IDPanelSrv.prototype.set_Exposed=function(a){if(a&&!this.Exposed()){for(var b=1;b<this.Parent.Frames.length;b++){if(this.Parent.Frames[b]!=null&&this.Parent.Frames[b].Content!=null&&this.Parent.Frames[b].Content instanceof IDPanelSrv&&this.Parent.Frames[b].Content!=this&&this.Parent.Frames[b].Content.HasFocus()){if(!this.Parent.Frames[b].Content.Exposed()){this.SetInput()}break}}}WebFrameSrv.prototype.set_Exposed.call(this,a);for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].SubFrame>0&&this.Fields[b].IsPresent()){this.Parent.Frames[this.Fields[b].SubFrame].Exposed=a;this.Parent.Frames[this.Fields[b].SubFrame].Content.set_Exposed(a)}}};IDPanelSrv.prototype.GetRTCGuid=function(a,b){switch(a){case Glb.OBJ_PAGE:return this.Pages[b].iGuid;case Glb.OBJ_GROUP:return this.Groups[b].iGuid;case Glb.OBJ_FIELD:return this.Fields[b].iGuid;default:return this.iGuid}};IDPanelSrv.prototype.SetRTCGuid=function(a,c,b){switch(a){case Glb.OBJ_PAGE:this.Pages[c].iGuid=b;break;case Glb.OBJ_GROUP:this.Groups[c].iGuid=b;break;case Glb.OBJ_FIELD:this.Fields[c].iGuid=b;break;default:this.iGuid=b;break}};IDPanelSrv.prototype.SetBook=function(a){this.MyBook=a};IDPanelSrv.prototype.PrintBook=function(h){if(this.MyBook==null){return}var j=new IDVariant();var a=new IDVariant(IDREGlb.PRN_PDF);var b=new IDVariant(true);if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,68,"IDPanel.PrintBook","Panel "+this.GetDTTCaption()+": Fire OnPrint Event")}this.Parent.OnPrint(this,j,a,b);if(j.isFalse()){this.MyBook.set_PrintDestination(a.intValue());var d=false;if(this.Queries[0].IsDO){var f=this.MyBook.Book.ReportsList[0];if(f.DSE instanceof CDSEDO&&f.DSE.MstTableName.equals(this.Queries[0].MstTableName)){if(this.Queries[0].IDColl!=null){this.MyBook.set_ReportCollection(f.GetID(),this.Queries[0].IDColl)}else{this.MyBook.set_ReportCollection(f.GetID(),this.Queries[0].Document)}d=true}}if(!d){var g=(b.isTrue()&&this.Queries[0].LastWhereClause.length>6?this.Queries[0].LastWhereClause.substr(6):"");var e=(b.isTrue()?this.SortingListStr():"");this.MyBook.SetReportWhereClause(-1,g,e,false)}if(a.intValue()==3){this.MyBook.PrintBook(1,-1);h.set_RedirectTo(new IDVariant(this.MyBook.GetWebFileName()));h.set_RedirectNewWindow(true)}else{if(a.intValue()==IDREGlb.PRN_SCREEN&&this.Parent.FormWidth>0&&this.Parent.FormHeight>0){var c;if(this.MainFrm.iParamsObj.UseRD3){c=(this.MyBook.HideBorder()?0:6)+10}else{c=(this.MyBook.HideBorder()?8:0)}this.MyBook.SetSize(this.Parent.FormWidth-c,this.Parent.FormHeight-c)}this.MyBook.PrintBook(1,1)}}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,88,"IDPanel.PrintBook","Panel "+this.GetDTTCaption()+": print canceled")}}};IDPanelSrv.prototype.GetDTTCaption=function(){return this.ToString()};IDPanelSrv.prototype.DecodeStatus=function(a){switch(a){case Glb.PS_DATA:return"Data";case Glb.PS_QBE:return"QBE";case Glb.PS_UPDATE:return"Updated"}return""+a};IDPanelSrv.prototype.DecodeCommand=function(a){switch(a){case Glb.PCM_FIND:return"Find";case Glb.PCM_SEARCH:return"Search";case Glb.PCM_DELETE:return"Delete";case Glb.PCM_REQUERY:return"Re-query";case Glb.PCM_CANCEL:return"Cancel";case Glb.PCM_UPDATE:return"Update";case Glb.PCM_INSERT:return"Insert";case Glb.PCM_DUPLICATE:return"Duplicate";case Glb.PCM_PRINT:return"Print";case Glb.PCM_GROUP:return"Group";case Glb.PCM_FORMLIST:return(this.PanelMode==Glb.PANEL_LIST?"Form":"List");case Glb.PCM_NAVIGATION:return"Navigate";case Glb.PCM_CSV:return"Export"}return""+a};IDPanelSrv.prototype.DTTTrace=function(h){if(h.DTTObj.AddTraceItem(this.iGuid,DTTEngine.TRC_ITPANEL,"Panel.Render","")){var l=this.Parent.Frames[this.FrIndex].Caption;if(!this.IndText.equals("")&&this.ShowStatusbar&&!this.Collapsed){l+=(": "+this.IndText)}var b="NF="+this.Fields.length+" LAY="+this.PanelMode+" U="+((this.Flags&Glb.PAN_CANUPDATE)!=0?-1:0)+" D="+((this.Flags&Glb.PAN_CANDELETE)!=0?-1:0)+" I="+((this.Flags&Glb.PAN_CANINSERT)!=0?-1:0)+" S="+((this.Flags&Glb.PAN_CANSELECT)!=0?-1:0)+" L="+(this.Locked()?-1:0)+" ST="+this.iStatus+" NR="+this.Queries[0].RecordCount()+" AP="+this.Queries[0].GetAttRecNumber()+" AR="+this.AttR+" PG="+this.PanelPage+" V="+(this.Visible?-1:0)+" C="+(this.Collapsed?-1:0)+" E="+(this.Exposed()?-1:0);if(this.PanelMode==Glb.PANEL_FORM){var k=this.GetBoundRect();b+=(" TW="+k.Width+" TH="+k.Height)}var f=" ERR=";for(var a=0;a<this.NumRows;a++){f+=(this.RowErrors[a]+"§")}h.DTTObj.AddTraceToken(this.iGuid,DTTEngine.TRC_PANCAPTION,"Panel.Caption",l,b+f);var d=0;var c=this.NumRows;var j=true;if(h.DTTObj.TraceRecToDump==1||(h.DTTObj.TraceRecToDump>1&&this.PanelMode==Glb.PANEL_FORM)){d=this.AttR;c=this.AttR;if(this.IsPanelFixActiveRowWhenScrolled()&&(this.AttR<0||this.AttR>=this.NumRows)){j=false}}else{if(h.DTTObj.TraceRecToDump>1){c=(c<h.DTTObj.TraceRecToDump?c:h.DTTObj.TraceRecToDump)-1}}if(j&&h.DTTObj.TraceRecToDump>0){for(var a=d;a<=c;a++){for(var g=0;g<this.Fields.length;g++){b="E="+(this.Fields[g].IsEnabled(a)?-1:0)+" V="+(this.Fields[g].IsVisible(a)?-1:0)+" P="+(this.Fields[g].IsPresent()?-1:0)+" VS="+this.Fields[g].GetVisualStyle(a)+" PI="+this.Fields[g].IdxPanel;if(this.Fields[g].IsVisible(a)&&this.PanelMode==Glb.PANEL_FORM){var e=this.Fields[g].GetValueRect(this.PanelMode,this.AttR);b+=(" X="+e.Left+" Y="+e.Top+" H="+e.Height+" W="+e.Width);if(this.Fields[g].IdxPanel!=-1&&(this.Fields[g].Flags&Glb.FLD_NOHDRFORM)==0){e=this.Fields[g].GetHeaderRect(this.PanelMode);b+=(" HX="+e.Left+" HY="+e.Top+" HH="+e.Height+" HW="+e.Width)}}if(this.Fields[g].bValues(a).IsError()){b+=(" ERR="+this.Fields[g].bValues(a).GetErrorText())}h.DTTObj.AddTraceToken(this.iGuid,DTTEngine.TRC_PANFLDVALUE,(this.Fields[g].IdxPanel==-1?this.Fields[g].Header:(this.PanelMode==Glb.PANEL_LIST?this.Fields[g].AbbrHeaderList:this.Fields[g].AbbrHeaderForm)),(this.Fields[g].DataType==Glb.DT_DOC_OLE?new IDVariant("BLOB"):this.Fields[g].bValues(a).Value),b)}}}}};IDPanelSrv.prototype.SetQueryDocument=function(b,a,d){var c=this.AttR;if(b==0){if(this.Status()==Glb.PS_UPDATE&&this.Queries[b].Document!=a){this.CancelUpdate(this.MainFrm)}if(this.Status()==Glb.PS_DATA){this.set_Status(Glb.PS_QBE)}this.SaveQBE(3);if(this.Queries[b].IDColl){delete this.Queries[b].IDColl.UIPanel}if(this.Queries[b].Document){delete this.Queries[b].Document.UIPanel}}this.Queries[b].Document=a;this.Queries[b].IDColl=null;this.Queries[b].DocTempl=null;if(b==0){if(this.Queries[b].Document){this.Queries[b].Document.UIPanel=this}this.RD3Change(RD3Glb.PAN_HASDOCTEMPLATE);if(d!=this.Queries[0].IsMasterDO){this.RD3Change(RD3Glb.PAN_MASTER)}this.Queries[0].IsMasterDO=d;if(!d){if(this.Lockable&&!this.MainFrm.IsMobile()){this.Lockable=false;this.RD3FrameChange(RD3Glb.WFR_LOCKABLE)}if(this.ShowInfoMessages){this.set_ShowInfoMessages(false)}}else{if(a!=null){this.iImage=a.GetIcon()}}}if(a!=null){a.set_UIBound(true)}if(b==0){this.FindData(this.MainFrm,false,false);if(c>=0&&c<this.NumRows){this.AttR=c}}};IDPanelSrv.prototype.SetQueryCollection=function(j,n,c){if(c==undefined){c=false}var g=this.AttR;var l=this.Queries[j].GetAttRecNumber();if(j==0){if(this.Status()==Glb.PS_UPDATE&&this.Queries[j].IDColl!=n){this.CancelUpdate(this.MainFrm)}if(this.Status()==Glb.PS_DATA){this.set_Status(Glb.PS_QBE)}this.SaveQBE(3);if(this.Queries[j].IDColl){delete this.Queries[j].IDColl.UIPanel}if(this.Queries[j].Document){delete this.Queries[j].Document.UIPanel}}this.Queries[j].IDColl=n;n.set_ShowDeleted(false);n.set_UIBound(true);var d=this.Queries[j].DocTempl;this.Queries[j].DocTempl=null;this.Queries[j].Document=null;if(c!=this.Queries[0].IsMasterDO){this.RD3Change(RD3Glb.PAN_MASTER)}this.Queries[j].IsMasterDO=c;if(j==0){if(this.Queries[j].IDColl){this.Queries[j].IDColl.UIPanel=this}this.RD3Change(RD3Glb.PAN_HASDOCTEMPLATE);if(!c){if(this.Lockable&&!this.MainFrm.IsMobile()){this.Lockable=false;this.RD3FrameChange(RD3Glb.WFR_LOCKABLE)}if(this.ShowInfoMessages){this.set_ShowInfoMessages(false)}if((this.Flags&Glb.PAN_CANSELECT)!=0&&this.Queries[0].DocFilter==null){var e=this.MainFrm.CreateDocument(this.Queries[0].MstTableName);if(e==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,192,"IDPanel.SetQueryCollection","Panel "+this.GetDTTCaption()+": cannot create DocFilter class "+this.Queries[0].MstTableName)}else{e.Clear();e.SetMainFrm(this.MainFrm,this.IMDB)}this.Queries[0].DocFilter=e}}var m=this.FindData(this.MainFrm,false,true);if(g>=0&&g<this.NumRows&&!m){this.AttR=g;if(n.Count()>0&&l+this.AttR>n.Count()){l=n.Count()-this.NumRows+1;if(l<1){l=1;this.AttR=n.Count()-1}else{this.AttR=this.NumRows-1}}}this.UpdateDynRows(this.Queries[0].RecordCount());if(!m){if(this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel()){this.ScrollRecTo(1,this.MainFrm);if(this.DynamicRows<l){this.SetDynRows(l,this.DynamicHeight)}this.set_SelectedRow(l-1)}else{this.ScrollRecTo(l,this.MainFrm)}}if(this.SortingList.Count()!=0){this.EnableSorting()}if(this.SortingList.Count()==0&&n.Count()>0){n.MoveFirst();var k=n.GetAt();var h="";var b=k.GetMD();for(var f=0;f<n.SortCriteria.length;f++){if(n.SortCriteria[f]==0){break}var a=b.GetProp(Math.abs(n.SortCriteria[f]));h+=(h.length==0?"":", ")+a.ObjTag+(n.SortCriteria[f]>0?" asc":" desc")}if(h.length>0){this.set_SortingListStr(h)}}this.SetRDRowSel(-1,true)}if(j==0&&c){this.Queries[j].DocTempl=d;this.RD3Change(RD3Glb.PAN_HASDOCTEMPLATE)}};IDPanelSrv.prototype.SetDocumentClass=function(b,a){this.Queries[b].MstTableName=a;this.Queries[b].IsDO=true;this.Queries[b].MaxRows=0;try{var d=this.MainFrm.CreateDocument(a);if(d==null){if(this.MainFrm!=this.MainFrm.GetApplication()){d=this.MainFrm.GetApplication().CreateDocument(a);if(d==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,192,"IDPanel.SetDocumentClass","Panel "+this.GetDTTCaption()+": cannot create DocTemplate class "+a)}else{d.Clear()}}}else{d.Clear();d.SetMainFrm(this.MainFrm,this.IMDB)}if(b==0){this.Queries[b].Document=null;this.Queries[b].IDColl=new IDCollection();this.Queries[b].IDColl.set_UIBound(true);this.Queries[b].IDColl.set_MainFrm(this.MainFrm);this.Queries[b].IDColl.set_imdb(this.IMDB);this.Queries[b].DocTempl=d;this.Queries[b].IsMasterDO=true;this.Queries[b].IDColl.UIPanel=this;this.RD3Change(RD3Glb.PAN_HASDOCTEMPLATE)}else{this.Queries[b].Document=d;d.set_Inserted(false)}}catch(c){this.MainFrm.DTTObj.AddException(this.iGuid,"Panel.SetDocumentClass","Can't set document class",c)}};IDPanelSrv.prototype.SetDOWhereClause=function(a){this.Queries[0].Text[Glb.SQL_WHERE]=a};IDPanelSrv.prototype.GetDocument=function(a){if(a==undefined){a=-1}var c=null;if(a==-1){if(this.ValidatingRow!=-1){a=this.ValidatingRow}else{a=this.AttR}}if(this.Queries[0].IDColl!=null){var b=this.Queries[0].GetAttRecNumber()+a;if(b<=this.Queries[0].RecordCount()){var e=this.Queries[0].IDColl.UIMode();if(!e){this.Queries[0].IDColl.set_UIMode(true)}this.Queries[0].IDColl.set_AbsolutePosition(b);c=this.Queries[0].IDColl.GetAt();if(!e){this.Queries[0].IDColl.set_UIMode(false)}}}else{if(a==0){c=this.Queries[0].Document}}return c};IDPanelSrv.prototype.SetDocument=function(a){this.SetQueryDocument(0,a,false)};IDPanelSrv.prototype.AddLookupParam=function(b,a,e,d,c){if(c==undefined){c=false}this.Queries[b].AddLookupParam(a,e,d,c)};IDPanelSrv.prototype.AddLookupValue=function(b,c,a){this.Queries[b].AddLookupValue(c,a)};IDPanelSrv.prototype.SetLookupDocument=function(a){if(a!=null){var c=a.TypeName();for(var b=1;b<this.Queries.length;b++){if(this.Queries[b].IsDO&&this.Queries[b].MstTableName.equals(c)){this.Queries[b].IsDO=true;this.Queries[b].Document=a}}}};IDPanelSrv.prototype.pDocument=function(){return this.GetDocument()};IDPanelSrv.prototype.set_pDocument=function(a){this.SetDocument(a)};IDPanelSrv.prototype.pCollection=function(){return this.Queries[0].IDColl};IDPanelSrv.prototype.set_pCollection=function(a){this.SetQueryCollection(0,a)};IDPanelSrv.prototype.FieldValue=function(a){return new IDVariant(this.Fields[a].bValues(this.AttR).Value)};IDPanelSrv.prototype.set_FieldValue=function(a,b){if(this.Fields[a].UpdateField(b)){this.SetModified(this.MainFrm);this.ReValidate()}};IDPanelSrv.prototype.RowUpdateCount=function(a){return this.iRowUpdateCount[a]};IDPanelSrv.prototype.set_RowUpdateCount=function(a,b){this.iRowUpdateCount[a]=b};IDPanelSrv.prototype.SetCommandEnabled=function(c,a){var b=c>0?this.EnabledCommands:this.ExtendedEnabledCommands;if(c>0){this.EnabledCommands=(this.EnabledCommands&(~c))|((a)?c:0)}else{this.ExtendedEnabledCommands=(this.ExtendedEnabledCommands&(~Math.abs(c)))|((a)?Math.abs(c):0)}if((c>0&&b!=this.EnabledCommands)||(c<0&&b!=this.ExtendedEnabledCommands)){if(c>0){this.RD3Change(RD3Glb.PAN_ENABLEDCOMMANDS)}else{this.RD3Change(RD3Glb.PAN_EXTENABLEDCOMMANDS)}}};IDPanelSrv.prototype.IsCommandEnabled=function(a){if(a>0){return(this.EnabledCommands&a)!=0}else{return(this.ExtendedEnabledCommands&Math.abs(a))!=0}};IDPanelSrv.prototype.FixedCols=function(){return this.iFixedCols};IDPanelSrv.prototype.set_FixedCols=function(a){if(this.iFixedCols!=a){this.iFixedCols=a;this.RD3Change(RD3Glb.PAN_FIXEDCOLS)}};IDPanelSrv.prototype.AdjustExtProp=function(){var x=null;var h=null;var o=false;var t=false;var z=this.GetDocument(0);if(z==null){z=this.Queries[0].DocTempl}if(z!=null){x=z.GetMD();if((x.Services&MDOInit.SERV_EXTSCHEMA)==0){t=true}}else{t=true}if(!t){try{h=z.GetExtSchema()}catch(y){this.MainFrm.DTTObj.AddException(this.iGuid,"Panel.AdjustExtProp","Can't get Extended Schema",y)}}var r=this.LastExtDoc==z;var C=this.LastExtSchema==h;if(r&&C){return}this.LastExtDoc=z;if(h!=null){this.LastExtSchema=h}if(t){for(var v=0;v<this.Fields.length;v++){if(this.Fields[v].IdxPanel==0){if(this.Fields[v].IsExtended){this.SetFlags(Glb.OBJ_FIELD,v,0,Glb.OBJ_VISIBLE)}}else{if(this.Fields[v].IdxPanel>0){var D=this.Queries[this.Fields[v].IdxPanel].GetMstField();if(D!=null){if(D.IsExtended){this.SetFlags(Glb.OBJ_FIELD,v,0,Glb.OBJ_VISIBLE);this.Fields[v].ExtendLookup(null,false)}}}}}return}for(var v=0;v<this.Fields.length;v++){if(this.Fields[v].IdxPanel==0){var u=this.Fields[v].GetDOIdx(z);if(u>0){var a=x.GetProp(u);if(a.ExtPropIdx>0){o=true;this.Fields[v].IsExtended=true;if(h!=null){if(a.ExtPropIdx<=h.GetNumProp()){f=h.GetProp(a.ExtPropIdx);o=(f.DTString=="DO");this.Fields[v].AbbrHeaderForm=f.UIName;this.Fields[v].AbbrHeaderList=f.UIName;this.Fields[v].Header=f.UIName;this.Fields[v].RD3Change(RD3Glb.FLD_HEADER);this.Fields[v].RD3Change(RD3Glb.FLD_FORMHEADER);this.Fields[v].RD3Change(RD3Glb.FLD_LISTHEADER);this.Fields[v].IDLista=f.IDList;if(this.MainFrm.IsMobile()&&f.IDList!=""&&!C){this.Fields[v].IDLista="";this.ClearValueList(v);var m=x.DBObj;if(m==null){m=z.GetDBObj()}if(m!=null){var A="";try{A="select DO_CODE, DO_DESCRIPTION from DO_VALUES where DO_LISTID = "+IDL.Quote(new IDVariant(f.IDList));var k=new IDVariant();z.OnSQLQuery(new IDVariant(A),new IDVariant(MDOInit.QRY_LOADVALUELIST),k);if(k.stringValue()!=""){A+=" and ";A+=k}A+=" order by DO_SEQ";var b=m.OpenRS(A);z.AfterSQLQuery(new IDVariant(A),new IDVariant(MDOInit.QRY_LOADVALUELIST),b,new IDVariant());var s=b.RecordCount();var B=0;if(!b.EOF()){b.MoveFirst()}while(!b.EOF()){B++;this.SetValueListItem(v,b.Get("DO_CODE"),b.Get("DO_DESCRIPTION").stringValue(),"","",-1,B<s);b.MoveNext()}}catch(y){z.AfterSQLQuery(new IDVariant(A),new IDVariant(MDOInit.QRY_LOADVALUELIST),null,new IDVariant(y.toString()));this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,61,"IDPanel.AdjustExtProp","Panel "+this.GetDTTCaption()+": cannot load value list for extended properties. Error is "+y.message)}}}else{if(this.MainFrm.IsMobile()&&f.IDList==""){this.ClearValueList(v)}}this.SetFlags(Glb.OBJ_FIELD,v,(f.Nullable?Glb.FLD_ISOPT:0)|((f.ReadOnly&&!z.Inserted())?0:Glb.OBJ_ENABLED),Glb.FLD_ISOPT|Glb.OBJ_ENABLED);if(f.MaxLength>0){this.Fields[v].MaxLength=f.MaxLength;this.Fields[v].RD3Change(RD3Glb.FLD_MAXLENGTH)}this.Fields[v].DataType=f.DataType;this.Fields[v].RD3Change(RD3Glb.FLD_DATATYPE);if(f.Mask!=null&&f.Mask.length>0){this.Fields[v].Mask=f.Mask;this.Fields[v].RD3Change(RD3Glb.FLD_MASK)}}}if(o){this.Fields[v].IDLista=""}this.SetFlags(Glb.OBJ_FIELD,v,(o)?0:Glb.OBJ_VISIBLE,Glb.OBJ_VISIBLE);if(f!=null&&f.Lookup!=null&&f.Lookup.length>0){this.SetFlags(Glb.OBJ_FIELD,v,0,Glb.FLD_NOACTD)}else{this.SetFlags(Glb.OBJ_FIELD,v,Glb.FLD_NOACTD,Glb.FLD_NOACTD)}}}}else{if(this.Fields[v].IdxPanel>0){var D=this.Queries[this.Fields[v].IdxPanel].GetMstField();if(D!=null){if(D.IsExtended){o=true;var f=null;var u=D.GetDOIdx(z);if(u>0&&h!=null){var a=x.GetProp(u);if(a.ExtPropIdx>0&&a.ExtPropIdx<=h.GetNumProp()){f=h.GetProp(a.ExtPropIdx)}}if(D.IDLista.length>0){o=false}if(f!=null&&f.LinkedDoc!=null){o=false;var g=this.Fields[v].GetValueRect(Glb.PANEL_FORM,0);var q=D.GetValueRect(Glb.PANEL_FORM,0);var l=false;if(g.Top==q.Top&&g.Height==q.Height&&(this.Fields[v].Flags&Glb.FLD_NOHDRFORM)!=0){l=true}this.Fields[v].ExtendLookup(f.LinkedDoc,l|this.Fields[v].flLookupExtended)}else{this.Fields[v].ExtendLookup(null,false)}if(f!=null&&f.Lookup!=null&&f.Lookup.length>0){this.SetFlags(Glb.OBJ_FIELD,v,0,Glb.FLD_NOACTD)}else{this.SetFlags(Glb.OBJ_FIELD,v,Glb.FLD_NOACTD,Glb.FLD_NOACTD)}this.SetFlags(Glb.OBJ_FIELD,v,((o)?0:Glb.OBJ_VISIBLE)|(D.Flags&Glb.OBJ_ENABLED),Glb.OBJ_VISIBLE|Glb.OBJ_ENABLED)}}}}}};IDPanelSrv.prototype.HasFocus=function(){if(this.Parent==null){return false}var a=this.Parent.ActiveElement.indexOf("C");if(a>=0&&this.Parent.ActiveElement.substr(0,a).equals("F"+this.FrIndex)){return true}return false};IDPanelSrv.prototype.SearchForMasterPanel=function(){var a=false;if(this.MasterPanelCode!=null){a=true;var b=this.Parent.SearchPanel(this.MasterPanelCode);if(b!=null){this.MasterPanelIdx=b.FrIndex;this.MasterPanelCode=null}}if(this.MasterPanelIdx>0){this.CheckMasterDocument(a)}};IDPanelSrv.prototype.CheckMasterDocument=function(b){var a=this.Parent.Frames[this.MasterPanelIdx].Content;var j=a.GetDocument();if(j!=this.LastMasterDocument||b){this.LastMasterDocument=j;if(j==null){this.SetQueryDocument(0,null,false)}else{var k=null;if(this.iDetailCollection!=-1){k=j.GetCollByIndex(this.iDetailCollection)}else{var f=j.GetMD();for(var g=1;g<=f.GetNumColl();g++){var c=f.GetColl(g);if(c.ChildrenName.equals(this.Queries[0].MstTableName)){k=j.GetCollByIndex(g);break}}}if(k!=null){k.ClearSort();if(this.Queries[0].DOSortCriteria!=null){for(var l=0;l<this.Queries[0].DOSortCriteria.Count();l++){var n=this.Queries[0].DOSortCriteria[l];k.SortBy(n)}}try{if(!j.Inserted()){var m=j.UpdateCount();j.LoadCollectionDirect(k,0,true);if(j.UpdateCount()!=m){a.UpdatePanel(this.MainFrm)}}}catch(h){}this.SetQueryCollection(0,k)}}this.set_Locked(a.Locked())}};IDPanelSrv.prototype.SetDetailCollection=function(a){if(this.iDetailCollection!=a.intValue()){this.iDetailCollection=a.intValue();if(this.MasterPanelIdx==0&&this.MasterPanelCode!=null){this.SearchForMasterPanel()}this.CheckMasterDocument(true)}};IDPanelSrv.prototype.DumpDocErrors=function(h,I,f,r){var G=new ArrayList();var b=new ArrayList();var x=new ArrayList();if(h.HasErrors(true)){var g=this.ValidatingRow;this.ValidatingRow=I;for(var A=0;A<this.Fields.length;A++){if(this.Fields[A].IdxPanel==0){var B=this.Fields[A].GetDOIdx(h);if(B>-1&&(this.Fields[A].Flags&(Glb.FLD_INLIST|Glb.FLD_INFORM))!=0){x.Add(B);var s=h.GetPropDOError(B);if(s!=null&&(s.ErrType==IDDocument.ERR_ERROR||!s.Ack)){var m=this.SetFieldErrorText(this.Fields[A].Index,s.Text,s.ErrType,s.Shown,s);if(m){s.Shown=true}}}}if(this.Fields[A].IdxPanel>0){var q=b.IndexOf(this.Fields[A].IdxPanel)==-1;if(q){this.Queries[this.Fields[A].IdxPanel].GetRelevantDocProp(G,h);var d="";var H=9999;var a=true;for(var u=0;u<G.Count();u++){var o=G[u];var s=h.GetPropDOError(o);x.Add(o);if(s!=null){a&=s.Shown;if(d.indexOf(s.Text)==-1){if(d.length>0){d+=" - "}d+=s.Text;if(s.ErrType<H){H=s.ErrType}}}}if(d.length>0){var F=A;var l=(this.Fields[A].IsVisible(I)?4:0);l+=(this.Fields[A].IsEnabled(I)?2:0);l+=((this.Fields[A].Flags&Glb.FLD_ISOPT)==0?1:0);for(var t=A+1;t<this.Fields.length;t++){if(this.Fields[t].IdxPanel==this.Fields[F].IdxPanel){var D=(this.Fields[t].IsVisible(I)?4:0);D+=(this.Fields[t].IsEnabled(I)?2:0);D+=((this.Fields[t].Flags&Glb.FLD_ISOPT)==0?1:0);if(D>l){F=t;l=D}}}var m=this.SetFieldErrorText(this.Fields[F].Index,d,H,a);if(m){for(var C=0;C<G.Count();C++){var o=G[C];var s=h.GetPropDOError(o);if(s!=null){s.Shown=true}}}}b.Add(this.Fields[A].IdxPanel)}}}var z=h.GetMD();var E="";for(var A=1;A<=z.GetNumProp();A++){var q=x.IndexOf(A)==-1;if(q){var s=h.GetPropDOError(A);if(s!=null&&(s.ErrType==IDDocument.ERR_ERROR||s.ErrType==IDDocument.ERR_WARNACK)&&!s.Shown){if(E.length>0){E=E+", "}E=E+"<b>"+z.GetProp(A).UIName+"</b>: "+s.Text;s.Shown=true}}}G.Clear();h.GetDocErrors(G);for(var y=0;y<G.Count();y++){var n=G[y];if(E.length>0){E+=", "}E+=n}if(E.length>0){this.SetRowError(this.ValidatingRow,E)}this.ValidatingRow=g}if(f){this.DumpChildrenError(h,true,r)}};IDPanelSrv.prototype.DumpCollErrors=function(f,o,h,a){var g=0;var k=null;var j=null;var m=null;var l=null;var b=this.ActualPosition()-this.AttR-1;f.set_ShowDeleted(true);f.MoveFirst();g=0;while(!f.IsEof()){k=f.GetAt();if(h==null||h==k){if(k.HasErrors()){if(g>=b&&g<b+this.NumRows){this.DumpDocErrors(k,g-b,false,a)}else{l=new ArrayList();k.GetDocErrors(l);j="";for(var n=0;n<l.Count();n++){m=l[n];if(j.length>0){j+="\n"}j+=(k.GetName(1)+m)}if(j.length>0){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,j,"","DOC",g+1,false)}}}if(o){this.DumpChildrenError(k,true,a)}}f.MoveNext();g++}f.set_ShowDeleted(false)};IDPanelSrv.prototype.DumpChildrenError=function(m,P,u){var E=0;var F=m.GetMD();var y=null;var r=null;var K=null;var x=null;if(!P&&m.HasErrors()){for(E=1;E<=F.GetNumProp();E++){x=m.GetPropDOError(E);if(x!=null&&!x.Shown){K=x.Text;var n=false;if(m.ParentCollection()!=null){var D=null;for(var G=1;G<this.Parent.Frames.length;G++){if(this.Parent.Frames[G].Content!=null&&this.Parent.Frames[G].Content instanceof IDPanelSrv){var z=this.Parent.Frames[G].Content;if(z.MasterPanelIdx>0&&z.pCollection()==m.ParentCollection()){D=z;break}}}if(D!=null){var k=m.ParentCollection().FindDoc(m);var l=D.ValidatingRow;var q=D.ActualPosition()-D.AttR;if(k>=q&&k<=q+D.NumRows-1){var A=new ArrayList();var b=new ArrayList();D.ValidatingRow=k-q;for(var M=0;M<D.UFields();M++){if(D.bFields(M).IdxPanel==0){var I=D.bFields(M).GetDOIdx(m);if(I>-1&&(D.bFields(M).Flags&(Glb.FLD_INLIST|Glb.FLD_INFORM))!=0&&I==E){if(x.ErrType==IDDocument.ERR_ERROR||!x.Ack){D.SetFieldErrorText(D.bFields(M).Index,x.Text,x.ErrType,x.Shown,x);D.SetRDRowSel(D.ValidatingRow,true);n=true;break}}}else{if(D.bFields(M).IdxPanel>0){var t=b.IndexOf(D.bFields(M).IdxPanel)==-1;if(t){D.Queries[D.bFields(M).IdxPanel].GetRelevantDocProp(A,m);var h="";var O=9999;var a=true;for(var C=0;C<A.Count();C++){var H=A[C];var f=m.GetPropDOError(H);if(f!=null){a&=f.Shown;if(h.indexOf(f.Text)==-1){if(h.length>0){h+=" - "}h+=x.Text;if(x.ErrType<O){O=x.ErrType}}}}if(h.length>0){var o=D.SetFieldErrorText(D.bFields(M).Index,h,O,a);if(o){for(var J=0;J<A.Count();J++){var H=A[J];var f=m.GetPropDOError(H);if(f!=null){f.Shown=true;n=true}}}}b.Add(D.bFields(M).IdxPanel)}}}}D.ValidatingRow=l}}}if(!n){this.Parent.SetMessage(F.GetProp(E),x.ErrType==IDDocument.ERR_ERROR?AMessageSrv.MSG_STOP:AMessageSrv.MSG_WARN,K,"","VAL",0,false)}x.Shown=true}}y=new ArrayList();m.GetDocErrors(y);K="";for(var s=0;s<y.Count();s++){r=y[s];if(K.length>0){K+="\n"}K+=r}if(K.length>0){var B=0;if(m.ParentCollection()!=null){B=m.ParentCollection().FindIndex(m)}this.Parent.SetMessage(m,AMessageSrv.MSG_STOP,K,"","DOC",B,false)}}var N;var L;for(E=1;E<=F.GetNumColl();E++){N=m.GetCollByIndex(E);var g=(u!=null&&u.Contains(N));N.set_ShowDeleted(true);N.MoveFirst();while(!N.IsEof()){L=N.GetAt();if(!g||L.Deleted()||L.Hidden()){this.DumpChildrenError(L,false,u)}N.MoveNext()}N.set_ShowDeleted(false)}};IDPanelSrv.prototype.DumpDOErrors=function(b,a){if(b==undefined){b=null}if(a==undefined){a=false}if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}if(this.Queries[0].IDColl!=null){this.DumpCollErrors(this.Queries[0].IDColl,true,b,null)}else{if((this.Queries[0].Document!=null)&&(b==null||b==this.Queries[0].Document)){this.DumpDocErrors(this.Queries[0].Document,this.AttR,a,null)}}};IDPanelSrv.prototype.HasQBE=function(d){if(d==undefined){d=true}for(var c=0;c<this.MasterFields.length;c++){var b=this.MasterFields[c].bValues(0).Text;if(b.length>0&&(this.MasterFields[c].ValueList.Count()==0||!d)){return true}}return false};IDPanelSrv.prototype.OpenAttachmentForm=function(){try{var b=this.GetDocument();if(b!=null&&this.MainFrm.DocHelper!=null){this.MainFrm.DocHelper.OpenAttachmentForm(b)}}catch(a){}};IDPanelSrv.prototype.AddDOSortCriteria=function(a){this.Queries[0].AddDOSortCriteria(a)};IDPanelSrv.prototype.SetCmdIdx=function(b,c,a){this.Fields[c].CmdIdx=a;if(this.Fields[c].IdxPanel==-1){this.Fields[c].Tooltip=b.CmdObj.CmdLin[a].ToolTip;this.Fields[c].RD3Change(RD3Glb.FLD_TOOLTIP)}};IDPanelSrv.prototype.IsIMDB=function(){return(this.Queries[0].IMDBDataSource>-1)};IDPanelSrv.prototype.IsDO=function(){return this.Queries[0].IsDO};IDPanelSrv.prototype.SetFieldEditor=function(b,a){if(a!=this.Fields[b].EditorType){this.Fields[b].EditorType=a;this.Fields[b].RD3Change(RD3Glb.FLD_EDITORTYPE);if(this.MainFrm.ParamsObj().UseIDEditor){this.Fields[b].setFieldEditor()}}};IDPanelSrv.prototype.ObjRect=function(b,d,c,a){switch(b){case Glb.OBJ_RECT:switch(c){case IDPanelSrv.RT_WIDTH:return(this.BoundRect!=null?this.BoundRect.Width:(this.MainFrm.ParamsObj().UseRD3?this.Parent.Frames[this.FrIndex].Width:0));case IDPanelSrv.RT_HEIGHT:return(this.BoundRect!=null?this.BoundRect.Height:(this.MainFrm.ParamsObj().UseRD3?this.Parent.Frames[this.FrIndex].Height:0))}break;case Glb.OBJ_PANEL:switch(c){case IDPanelSrv.RT_LEFT:return this.ListLeft;case IDPanelSrv.RT_TOP:return this.ListTop;case IDPanelSrv.RT_WIDTH:return this.ListWidth;case IDPanelSrv.RT_HEIGHT:return this.ListHeight}break;case Glb.OBJ_GROUP:switch(c){case IDPanelSrv.RT_LEFT:return this.Groups[d].GrpRect(a).Left;case IDPanelSrv.RT_TOP:return this.Groups[d].GrpRect(a).Top;case IDPanelSrv.RT_WIDTH:return this.Groups[d].GrpRect(a).Width;case IDPanelSrv.RT_HEIGHT:return this.Groups[d].GrpRect(a).Height}break;case Glb.OBJ_FIELD:switch(c){case IDPanelSrv.RT_LEFT:return this.Fields[d].FldRect(a).Left;case IDPanelSrv.RT_TOP:return this.Fields[d].FldRect(a).Top;case IDPanelSrv.RT_WIDTH:return this.Fields[d].FldRect(a).Width;case IDPanelSrv.RT_HEIGHT:return this.Fields[d].FldRect(a).Height}break}return 0};IDPanelSrv.prototype.set_ObjRect=function(h,l,k,e,g){var f=0;var a=new RectSrv();if(this.ObjRect(h,l,k,e)==g){return}switch(h){case Glb.OBJ_RECT:switch(k){case IDPanelSrv.RT_WIDTH:if(this.BoundRect!=null){this.BoundRect.Width=g}if(this.MainFrm.ParamsObj().UseRD3){this.Parent.Frames[this.FrIndex].Width=g;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_WIDTH);if(this.Parent.Frames[this.FrIndex].MinWidth==this.Parent.Frames[this.FrIndex].MaxWidth&&this.Parent.Frames[this.FrIndex].MinWidth!=0){this.Parent.Frames[this.FrIndex].MinWidth=g;this.Parent.Frames[this.FrIndex].MaxWidth=g;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_MINWIDTH);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_MAXWIDTH)}}break;case IDPanelSrv.RT_HEIGHT:if(this.BoundRect!=null){this.BoundRect.Height=g}if(this.MainFrm.ParamsObj().UseRD3){this.Parent.Frames[this.FrIndex].Height=g;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT);if(this.Parent.Frames[this.FrIndex].MinWidth==this.Parent.Frames[this.FrIndex].MaxWidth){this.Parent.Frames[this.FrIndex].MinHeight=g;this.Parent.Frames[this.FrIndex].MaxHeight=g;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_MINHEIGHT);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_MAXHEIGHT)}}break}break;case Glb.OBJ_PANEL:if(e==Glb.PANEL_LIST){switch(k){case IDPanelSrv.RT_LEFT:this.ListLeft=g;this.RD3Change(RD3Glb.PAN_LISTLEFT);break;case IDPanelSrv.RT_TOP:f=g-this.ListTop;this.ListTop=g;this.RD3Change(RD3Glb.PAN_LISTTOP);for(var d=0;d<this.Fields.length;d++){if((this.Fields[d].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[d].Flags&Glb.FLD_LISTLIST)!=0){a=this.Fields[d].FldRect(e);a.Top=a.Top+f;this.Fields[d].set_FldRect(e,a)}}for(var d=0;d<this.Groups.length;d++){for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].Group==d&&(this.Fields[b].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[b].Flags&Glb.FLD_LISTLIST)!=0){a=this.Groups[d].GrpRect(e);a.Top=a.Top+f;if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Groups[d].set_GrpRect(e,a);break}}}break;case IDPanelSrv.RT_HEIGHT:this.ListHeight=g;this.RD3Change(RD3Glb.PAN_LISTHEIGHT);break}this.CalcLayout();this.ScrollRecBy(0,this.MainFrm)}break;case Glb.OBJ_GROUP:var c=false;if(e==Glb.PANEL_LIST){for(var d=0;d<this.Fields.length;d++){if(this.Fields[d].Group==l&&(this.Fields[d].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[d].Flags&Glb.FLD_LISTLIST)==0){c=true;break}}}if(e==Glb.PANEL_FORM||(e==Glb.PANEL_LIST&&(c||k==IDPanelSrv.RT_HEIGHT))){a=this.Groups[l].GrpRect(e);switch(k){case IDPanelSrv.RT_LEFT:f=g-a.Left;a.Left=g;break;case IDPanelSrv.RT_TOP:f=g-a.Top;a.Top=g;break;case IDPanelSrv.RT_WIDTH:f=g-a.Width;a.Width=g;break;case IDPanelSrv.RT_HEIGHT:f=g-a.Height;a.Height=g;break}if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Groups[l].set_GrpRect(e,a);if(k==IDPanelSrv.RT_LEFT||k==IDPanelSrv.RT_TOP){for(var d=0;d<this.Fields.length;d++){if(this.Fields[d].Group==l){a=this.Fields[d].FldRect(e);if(k==IDPanelSrv.RT_LEFT){a.Left=a.Left+f}else{a.Top=a.Top+f}if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Fields[d].set_FldRect(e,a)}}}}break;case Glb.OBJ_FIELD:a=this.Fields[l].FldRect(e);switch(k){case IDPanelSrv.RT_LEFT:if(e==Glb.PANEL_FORM||(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)==0)){f=g-a.Left;a.Left=g}break;case IDPanelSrv.RT_TOP:if(e==Glb.PANEL_FORM||(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)==0)){f=g-a.Top;a.Top=g}break;case IDPanelSrv.RT_WIDTH:f=g-a.Width;a.Width=g;break;case IDPanelSrv.RT_HEIGHT:if(e==Glb.PANEL_FORM||(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)==0)){f=g-a.Height;a.Height=g}break}if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)==0){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Fields[l].set_FldRect(e,a);if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){for(var d=l+1;d<this.Fields.length;d++){if((this.Fields[d].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[d].Flags&Glb.FLD_LISTLIST)!=0){a=this.Fields[d].FldRect(e);a.Left=a.Left+f;this.Fields[d].set_FldRect(e,a)}}for(var d=0;d<this.Groups.length;d++){for(var b=l+1;b<this.Fields.length;b++){if(this.Fields[b].Group==d&&this.Fields[l].Group!=d&&(this.Fields[b].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[b].Flags&Glb.FLD_LISTLIST)!=0){a=this.Groups[d].GrpRect(e);a.Left=a.Left+f;if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Groups[d].set_GrpRect(e,a);break}}}}if(this.Fields[l].Group!=-1){a=this.Groups[this.Fields[l].Group].GrpRect(e);switch(k){case IDPanelSrv.RT_LEFT:if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){a.Left=a.Left+f}else{if(this.Fields[l].FldRect(e).Left<a.Left){a.Left=this.Fields[l].FldRect(e).Left}}break;case IDPanelSrv.RT_TOP:if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){a.Top=a.Top+f}else{if(this.Fields[l].FldRect(e).Top<a.Top){a.Top=this.Fields[l].FldRect(e).Top}}break;case IDPanelSrv.RT_WIDTH:if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){a.Width=a.Width+f}else{if(this.Fields[l].FldRect(e).Left+this.Fields[l].FldRect(e).Width>a.Left+a.Width){a.Width=this.Fields[l].FldRect(e).Left+this.Fields[l].FldRect(e).Width-a.Left}}break;case IDPanelSrv.RT_HEIGHT:if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){a.Height=a.Height+f}else{if(this.Fields[l].FldRect(e).Top+this.Fields[l].FldRect(e).Height>a.Top+a.Height){a.Height=this.Fields[l].FldRect(e).Top+this.Fields[l].FldRect(e).Height-a.Top}}break}if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Groups[this.Fields[l].Group].set_GrpRect(e,a)}break}};IDPanelSrv.prototype.EnableInsertWhenLocked=function(){return this.iEnableInsertWhenLocked};IDPanelSrv.prototype.set_EnableInsertWhenLocked=function(a){if(this.iEnableInsertWhenLocked!=a){this.iEnableInsertWhenLocked=a;this.RD3Change(RD3Glb.PAN_ENABLEINSERTLOCKED)}};IDPanelSrv.prototype.EnableMultipleSel=function(){return this.iEnableMultipleSel};IDPanelSrv.prototype.set_EnableMultipleSel=function(a){if(this.EnableMultipleSel()!=a){if(!a){this.set_ShowMultipleSel(false)}this.iEnableMultipleSel=a;this.RD3Change(RD3Glb.PAN_ENABLEMULTIPLESEL)}};IDPanelSrv.prototype.ShowMultipleSel=function(a){if(a==undefined){a=true}if(this.EnableMultipleSel()&&(!a||this.PanelMode==Glb.PANEL_LIST)){return this.iShowMultipleSel}return false};IDPanelSrv.prototype.set_ShowMultipleSel=function(c,b){if(b==undefined){b=false}if(this.EnableMultipleSel()&&c!=this.ShowMultipleSel()){var a=new IDVariant(false);if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"IDPanel.OnShowMultipleSelection","Panel "+this.GetDTTCaption()+": fire OnShowMultipleSelection event")}this.Parent.OnShowMultipleSelection(this,new IDVariant(c),a,new IDVariant(b));if(a.isFalse()){this.iShowMultipleSel=c}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"IDPanel.OnShowMultipleSelection","Panel "+this.GetDTTCaption()+": ShowMultipleSelection canceled")}}this.RD3Change(RD3Glb.PAN_SHOWMULTIPLESEL)}};IDPanelSrv.prototype.ActiveMultipleSel=function(){if(this.EnableMultipleSel()&&this.PanelMode==Glb.PANEL_LIST){return this.iActiveMultipleSel}return false};IDPanelSrv.prototype.set_ActiveMultipleSel=function(a){if(this.EnableMultipleSel()&&a!=this.ActiveMultipleSel()){this.iActiveMultipleSel=a}};IDPanelSrv.prototype.SelectAllOnlyVisible=function(){return this.iSelectAllOnlyVisible};IDPanelSrv.prototype.set_SelectAllOnlyVisible=function(a){if(this.SelectAllOnlyVisible()!=a){this.iSelectAllOnlyVisible=a;this.RD3Change(RD3Glb.PAN_SELALLONLYVIS)}};IDPanelSrv.prototype.IsRowSelected=function(a){if(a==undefined){a=-1}try{if(a==-1){if(this.ValidatingRow!=-1){if(this.Queries[0].GetAttRecNumber()>=1){a=this.Queries[0].GetAttRecNumber()+this.ValidatingRow}}else{a=this.Queries[0].GetAttRecNumber()+this.AttR}}if(a>0){if(this.IsDO()){if(a<=this.Queries[0].RecordCount()&&this.Queries[0].IDColl!=null){var f=this.Queries[0].IDColl.UIMode();if(!f){this.Queries[0].IDColl.set_UIMode(true)}this.Queries[0].IDColl.set_AbsolutePosition(a);var c=this.Queries[0].IDColl.GetAt();if(!f){this.Queries[0].IDColl.set_UIMode(false)}if(c!=null){return c.Selected()}}}else{return this.SelectedRows[a-1]}}}catch(b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,191,"IDPanel.IsRowSelected","Panel "+this.GetDTTCaption()+": can't read the "+(a!=-1?"row "+a:"current row")+" selected property - "+b.message)}}return false};IDPanelSrv.prototype.SetRowSelected=function(g,f,a){if(f==undefined){f=-1}if(a==undefined){a=true}try{if(f==-1){if(this.ValidatingRow!=-1){if(this.Queries[0].GetAttRecNumber()>=1){f=this.Queries[0].GetAttRecNumber()+this.ValidatingRow}}else{f=this.Queries[0].GetAttRecNumber()+this.AttR}}if(f>0&&this.IsRowSelected(f)!=g){var b=new IDVariant(0);this.FireOnChangeSelection(f,g,false,false,b);if(b.isFalse()){if(this.IsDO()){if(f<=this.Queries[0].RecordCount()&&this.Queries[0].IDColl!=null){var k=this.Queries[0].IDColl.UIMode();if(!k){this.Queries[0].IDColl.set_UIMode(true)}this.Queries[0].IDColl.set_AbsolutePosition(f);var j=this.Queries[0].IDColl.GetAt();if(!k){this.Queries[0].IDColl.set_UIMode(false)}if(j!=null){j.set_Selected(g)}}}else{this.SelectedRows[f-1]=g}}if(a){var c=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());c.SetAttribute("row",f.toString());if(b.isFalse()){c.SetAttribute("value",g?"1":"0")}else{c.SetAttribute("value",!g?"1":"0")}}if(f-this.Queries[0].GetAttRecNumber()>=0&&f-this.Queries[0].GetAttRecNumber()<this.NumRows){this.RDRowSel[f-this.Queries[0].GetAttRecNumber()]=true}}}catch(h){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,192,"IDPanel.SetRowSelected","Panel "+this.GetDTTCaption()+": can't "+(g?"select":"deselect")+" the "+(f!=-1?"row "+f:"current row")+" - "+h.message)}}};IDPanelSrv.prototype.ChangeSelection=function(e){var c=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());c.SetAttribute("row","-1");c.SetAttribute("value",e.toString());for(var b=1;b<=this.Queries[0].RecordCount();b++){var d=(e==0?false:(e==1?!this.IsRowSelected(b):true));if(!this.SelectAllOnlyVisible()||(b>=this.ActualPosition()-this.AttR&&b<this.ActualPosition()-this.AttR+this.NumRows)){this.SetRowSelected(d,b,false)}if(d!=this.IsRowSelected(b)){var c=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());c.SetAttribute("row",b.toString());c.SetAttribute("value",this.IsRowSelected(b)?"1":"0")}}var a=new IDVariant(0);this.FireOnChangeSelection(-1,false,true,false,a);this.SetRDRowSel(-1,true)};IDPanelSrv.prototype.MultipleDelete=function(o){var q=this.Queries[0].GetAttRecNumber();var m=this.AttR;if(this.IsDO()){var k=this.Queries[0].IDColl;if(k!=null){if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}var g=0;var a=k.GetCollection();for(var f=0;f<a.Count();f++){var j=a[f];if(j.Selected()){this.Queries[0].UpdateIMDB(g,true,false,true);this.ValidatingRow=g;var r=new IDVariant();this.FireBeforeDelete(r);if(r.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,79,"IDPanel.DeleteRecord","Panel "+this.GetDTTCaption()+": record delete canceled")}}else{j.set_Deleted(true)}}g++}this.ValidatingRow=-1;if(this.Queries[0].IsMasterDO){var l;try{l=k.SaveToDB()}catch(h){l=false}k.set_ShowDeleted(true);k.MoveFirst();while(k.GetAt()!=null){var j=k.GetAt();if(j.Selected()){if(l){j.ReleaseLock()}else{j.set_Deleted(false)}}k.MoveNext()}k.set_ShowDeleted(false);if(l&&this.Queries[0].DocTempl!=null){k.PurgeDeleted()}}}this.ScrollRecTo(q,o)}else{for(var g=0;g<this.SelectedRows.length;g++){if(this.SelectedRows[g]){this.ScrollRecTo(g+1,o);this.AttR=0;this.Queries[0].UpdateIMDB(this.AttR,true,false,true);if(this.DeleteRecord(o,true)){g--}}}}if(this.SortingList!=null&&this.SortingList.Count()>0){this.EnableSorting()}this.ClearRD3Cache();this.AttR=m;var b=q;var n=this.Queries[0].RecordCount();if(b+this.NumRows>=n){q=n-this.NumRows+1}this.ScrollRecTo(q,o);b=this.Queries[0].GetAttRecNumber();n=this.Queries[0].RecordCount();if(b==1&&this.AttR>=n){this.SetInput(n-1,this.FocusedColumn(),1,false)}this.Queries[0].UpdateIMDB(this.AttR,true,false,true);this.SetInfoMessage(o.RTCObj.GetConst("108F1F2C-659E-4780-91F3-776EFC76C7F9","Le righe selezionate sono state cancellate come richiesto."));if(!this.IsIMDB()&&(!this.IsDO()||this.Queries[0].IsMasterDO)){this.MainFrm.SoundAction("play","delete")}this.UpdateDynRows(this.Queries[0].RecordCount())};IDPanelSrv.prototype.MultipleDuplicate=function(q){if(this.Status()==Glb.PS_UPDATE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,193,"IDPanel.MultipleDuplicate","Panel "+this.GetDTTCaption()+": duplicate not done (status = UPDATED)")}return}if((this.Flags&Glb.PAN_CANINSERT)==0){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.MultipleDuplicate","Panel "+this.GetDTTCaption()+": duplicate not done (canInsert = false)")}return}if(!this.IsDO()){var s=new ArrayList();for(var b=0;b<this.SelectedRows.length;b++){if(this.SelectedRows[b]){var f=new ArrayList();s.Add(f);var g=false;for(var j=0;j<this.UMaster();j++){if(!this.MasterFields[j].Unbound&&this.MasterFields[j].Index!=this.Queries[0].AIFieldIndex){var t;this.Queries[0].ScrollTo(b+1);if(this.Queries[0].IMDBDataSource>-1){t=this.IMDB.Value(this.Queries[0].IMDBDataSource,this.MasterFields[j].GetIMDBIdx(),Glb.IMDB_CURSOR)}else{try{t=this.Queries[0].RS.Get(this.MasterFields[j].GetRSIdx(this.Queries[0].RS))}catch(k){t=new IDVariant()}}if(!g&&(this.MasterFields[j].Flags&Glb.FLD_ISDESCR)!=0&&Glb.ClassDT(this.MasterFields[j].DataType)==Glb.DTC_CHAR&&(this.MasterFields[j].MaxLength>=t.stringValue().length+7)){g=true;f.Add(new IDVariant(t+" (Copy)"))}else{f.Add(t)}}else{f.Add(new IDVariant())}}}}if(this.MainFrm.ParamsObj().PanelInsertMaxScroll){this.ScrollRecTo(2147483647,this.MainFrm)}else{if(this.Queries[0].RecordCount()+s.Count()>this.NumRows){this.ScrollRecTo(this.Queries[0].RecordCount()+s.Count()+1-this.NumRows,q)}else{this.ScrollRecTo(0,q)}}var b=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(b<0){b=0}if(b>this.NumRows-1){b=this.NumRows-1}this.AttR=b;this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetInput();b=1;for(var n=0;n<s.Count();n++){var f=s[n];var j=0;for(var o=0;o<f.Count();o++){var t=f[o];this.MasterFields[j].bValues(this.AttR+b-1).SetNewValue(t);j=j+1}if(this.AttR+b-1==this.NumRows-1&&s.Count()!=b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,194,"IDPanel.MultipleDuplicate","Panel "+this.GetDTTCaption()+": can't duplicate all rows because there are not enough empty rows in the panel ("+s.Count()+" rows to be duplicated and only "+b+" duplicated)")}break}b++}this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetModified(q);this.ReValidate()}else{if(this.MainFrm.ParamsObj().PanelInsertMaxScroll){this.ScrollRecTo(2147483647,this.MainFrm)}else{var a=0;if(this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(true);this.Queries[0].IDColl.MoveFirst();while(this.Queries[0].IDColl.GetAt()!=null){var u=this.Queries[0].IDColl.GetAt();if(u.Selected()){a++}this.Queries[0].IDColl.MoveNext()}this.Queries[0].IDColl.set_UIMode(false)}if(this.Queries[0].RecordCount()+a>this.NumRows){this.ScrollRecTo(this.Queries[0].RecordCount()+a+1-this.NumRows,this.MainFrm)}}var b=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(b<0){b=0}if(b>this.NumRows-1){b=this.NumRows-1}this.AttR=b;this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetInput();var m=this.Queries[0].IDColl;if(m!=null){m.set_UIMode(true);m.MoveFirst();while(m.GetAt()!=null){var l=m.GetAt();if(l.Selected()){var h=l.Duplicate(9999);try{m.Add(h)}catch(k){}}m.MoveNext()}m.set_UIMode(false)}}};IDPanelSrv.prototype.IsAdvTabOrderEnabled=function(){if(this.FormTabOrder==null||this.ListTabOrder==null){return false}else{return true}};IDPanelSrv.prototype.SetTabOrder=function(a,d,c){if(c==Glb.PANEL_FORM){if(this.FormTabOrder==null){this.FormTabOrder=new Array(this.UFields()+1);for(var b=0;b<this.UFields()+1;b++){this.FormTabOrder[b]=0}}this.FormTabOrder[d]=a}else{if(this.ListTabOrder==null){this.ListTabOrder=new Array(this.UFields()+1);for(var b=0;b<this.UFields()+1;b++){this.ListTabOrder[b]=0}}this.ListTabOrder[d]=a}};IDPanelSrv.prototype.GetTabOrderFieldIdx=function(a,b){if(this.IsAdvTabOrderEnabled()){if(b==Glb.PANEL_FORM){return this.FormTabOrder[a]}else{return this.ListTabOrder[a]}}else{return a}};IDPanelSrv.prototype.GetFieldIdxTabOrder=function(a,c){if(this.IsAdvTabOrderEnabled()){var b=0;for(b=0;b<(c==Glb.PANEL_LIST?this.ListTabOrder.length:this.FormTabOrder.length);b++){if((c==Glb.PANEL_LIST?this.ListTabOrder[b]:this.FormTabOrder[b])==a){break}}return b}else{return a}};IDPanelSrv.prototype.InitTabOrder=function(){for(var c=0;c<=1;c++){var b=0;for(var a=0;a<this.Fields.length;a++){if(a==0||(this.Fields[a].Flags&Glb.FLD_INLIST)!=0||(this.Fields[a].Flags&Glb.FLD_INFORM)!=0){this.SetTabOrder(this.Fields[a].Index,b++,c)}}for(var a=1;a<this.Fields.length;a++){if((this.Fields[a].Flags&Glb.FLD_INLIST)==0&&(this.Fields[a].Flags&Glb.FLD_INFORM)==0){this.SetTabOrder(this.Fields[a].Index,b++,c)}}}};IDPanelSrv.prototype.VerifyTabOrder=function(){for(var e=0;e<=1;e++){var f=new Array();var d=new Array();for(var b=0;b<this.Fields.length;b++){if(b==0||(this.Fields[b].Flags&Glb.FLD_INLIST)!=0||(this.Fields[b].Flags&Glb.FLD_INFORM)!=0){var a=0;for(;a<f.length;a++){if(this.GetFieldIdxTabOrder(f[a].Index,e)>this.GetFieldIdxTabOrder(Fields[b].Index,e)){break}}f.splice(a,0,this.Fields[b])}else{d.push(this.Fields[b])}}f.push.apply(f,d);for(var g=0;g<f.length;g++){this.SetTabOrder(f[g].Index,g,e)}}};IDPanelSrv.prototype.MoveField=function(a,f,d){if(f==undefined){f=-1}if(d==undefined){d=Glb.PANEL_LIST}if(this.IsAdvTabOrderEnabled()){var e=this.GetFieldIdxTabOrder(a,d);var c;if(f==-1){c=(d==Glb.PANEL_LIST?this.ListTabOrder.length:this.FormTabOrder.length)-1}else{c=this.GetFieldIdxTabOrder(f,d)}if(e==c||e==c-1){return}this.Fields[this.ListTabOrder[e]].UserChangedField=true;this.Fields[this.ListTabOrder[c]].UserChangedField=true;if(e>c){for(var b=e-1;b>=c;b--){if(d==Glb.PANEL_LIST){this.ListTabOrder[b+1]=this.ListTabOrder[b];this.Fields[this.ListTabOrder[b+1]].UserChangedField=true}else{this.FormTabOrder[b+1]=this.FormTabOrder[b]}}}else{for(var b=e+1;b<c;b++){if(d==Glb.PANEL_LIST){this.ListTabOrder[b-1]=this.ListTabOrder[b];this.Fields[this.ListTabOrder[b-1]].UserChangedField=true}else{this.FormTabOrder[b-1]=this.FormTabOrder[b]}}c--}if(d==Glb.PANEL_LIST){this.ListTabOrder[c]=a}else{this.FormTabOrder[c]=a}this.CalcLayout()}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,196,"IDPanel.MoveField","Panel "+this.GetDTTCaption()+": before moving fields you must enable advanced tab order!")}}};IDPanelSrv.prototype.SetFieldActivator=function(a,c,b){if(b==undefined){b=null}if(this.Fields[a].ActImg!=b){this.Fields[a].ActImg=b;this.Fields[a].RD3Change(RD3Glb.FLD_ACTIMAGE)}if(this.Fields[a].ActWidth!=c){this.Fields[a].ActWidth=c;this.Fields[a].RD3Change(RD3Glb.FLD_ACTWIDTH)}};IDPanelSrv.prototype.SetFieldPercPosDim=function(l,f,d,j,h,g,a,c,k,b,e){this.Fields[l].PosDimPerc=[f,d,j,h,g,a,c,k,b,e]};IDPanelSrv.prototype.AcknowledgeWarnings=function(){var c=this.GetDocument();if(this.Status()==Glb.PS_UPDATE||c!=null){var a=this.ValidatingRow;this.ValidatingRow=this.AttR;for(var b=0;b<this.Fields.length;b++){this.Fields[b].bValues(this.AttR).SetAck(true)}this.ValidatingRow=a}if(c!=null){c.AcknowledgeWarnings()}};IDPanelSrv.prototype.FocusedColumn=function(){var b=-1;if(this.HasFocus()){var a=this.Parent.ActiveElement.indexOf("R");var d=this.Parent.ActiveElement.indexOf("C");if(a>0&&d>0){try{b=parseInt(this.Parent.ActiveElement.substr(d+1,a-(d+1)),10)}catch(c){}}}return b};IDPanelSrv.prototype.SortingListStr=function(){var b="";for(var a=0;a<this.SortingList.Count();a++){var c=this.SortingList[a];if(c.SortMode!=0&&c.IdxPanel==0){if(b.length>0){b+=", "}b+=c.Code+(c.SortMode>0?"":" desc")}}return b};IDPanelSrv.prototype.set_SortingListStr=function(f){var b=new StringTokenizer();b.setString(new IDVariant(f));this.ResetSortList();while(b.hasNext()){var d=b.next().stringValue();var e=true;if(d.length>=4&&String.compare(d.substr(d.length-4,4)," asc",true)==0){e=true;d=d.substr(0,d.length-4)}if(d.length>=5&&String.compare(d.substr(d.length-5,5)," desc",true)==0){e=false;d=d.substr(0,d.length-5)}d=IDL.Trim(new IDVariant(d),true,true).stringValue();for(var c=0;c<this.MasterFields.length;c++){if(this.MasterFields[c].Code.equals(d)){var a=this.MasterFields[c].Index;if(this.MasterFields[c].SortFld!=-1){a=this.MasterFields[c].SortFld}this.AddToSortList(a,e);break}}}this.EnableSorting()};IDPanelSrv.prototype.SetRDRowSel=function(f,a){var d;var c;if((this.PanelMode==Glb.PANEL_FORM&&!this.MainFrm.ParamsObj().UseRD3)||this.Fields.length==0){return}if(f==-1){d=0;c=this.RDRowSel.length-1}else{d=f;c=f}for(var e=d;e<=c&&e<this.RDRowSel.length;e++){this.RDRowSel[e]=a;if(a){this.Fields[0].Values[e].RD3Change(RD3Glb.VAL_ROWSEL)}}};IDPanelSrv.prototype.Resize=function(b,c){var h=this.MainFrm.ParamsObj().UseRD3;var e=this.PanelMode;var d=this.NumRows;var a=this.GetBoundRect();if(this.LastResizeWidth==0){this.LastResizeWidth=a.Width;this.LastResizeHeight=c}var g=0;var j=0;if(!h){if(this.Pages.length>0){j=4;g=Glb.PAN_OFFS_PAGEY;if(this.NumPagPerLine>0&&this.Pages.length>this.NumPagPerLine){g=Glb.PAN_OFFS_PAGEY*Math.floor((this.Pages.length+0)/this.NumPagPerLine)}}}if((this.Flags&Glb.PAN_HASFORM)!=0){this.ResizeForm(b-this.LastResizeWidth,c-this.LastResizeHeight,b-j,c-g)}if((this.Flags&Glb.PAN_HASLIST)!=0){this.ResizeList(b-this.LastResizeWidth,c-this.LastResizeHeight,b-j,c-g)}this.PanelMode=e;this.CalcLayout();for(var f=0;f<this.Groups.length;f++){this.Groups[f].Resize()}if(this.NumRows!=d){this.ScrollRecBy(0,this.MainFrm)}this.BoundRect=a;this.BoundRect.Width+=(b-this.LastResizeWidth);this.BoundRect.Height+=(c-this.LastResizeHeight);this.LastResizeHeight=c;this.LastResizeWidth=b};IDPanelSrv.prototype.ResizeForm=function(e,d,h,a){this.PanelMode=Glb.PANEL_FORM;var b=this.GetBoundRect(true);var k=b.Width-this.LastResizeWidth;var j=b.Height-this.LastResizeHeight;if(k<0){k=0}if(j<0){j=0}if(e>0&&k>0){e-=k;if(e<0){e=0}}if(d>0&&j>0){d-=j;if(d<0){d=0}}if(e!=0||d!=0){for(var g=0;g<this.Fields.length;g++){this.Fields[g].Resize(e,d,Glb.PANEL_FORM)}}var f=k;var c=j;b=this.GetBoundRect(true);k=b.Width-h;j=b.Height-a;var m=0;if(e<0&&k>f){m=k-f}var l=0;if(d<0&&j>c){l=j-c}if(m>0||l>0){for(var g=0;g<this.Fields.length;g++){this.Fields[g].Resize(m,l,Glb.PANEL_FORM)}}};IDPanelSrv.prototype.ResizeList=function(e,d,z,v){this.PanelMode=Glb.PANEL_LIST;var x=this.PanelPage;var n=this.GetBoundRect(true);d+=this.LastDeltaY;this.LastDeltaY=0;var o=n.Width-this.LastResizeWidth;var m=n.Height-this.LastResizeHeight;if(o<0){o=0}if(m<0){m=0}if(e>0&&o>0){e-=o;if(e<0){e=0}}if(d>0&&m>0){d-=m;if(d<0){d=0}}if(this.MaxHRow>0){if(d>0){this.LastDeltaY=d%(this.MaxHRow+this.OffsetRow());d-=this.LastDeltaY}if(d<0){this.LastDeltaY=(-d)%(this.MaxHRow+this.OffsetRow());this.LastDeltaY=(this.MaxHRow+this.OffsetRow())-this.LastDeltaY;d-=this.LastDeltaY}}if((this.Flags&Glb.PAN_SCROLLREC)!=0&&this.FixedCols()==0){z+=Glb.SCROLL_OFFSET}var s=e;if(e!=0){if(this.HListResizeMode==Glb.RESMODE_MOVE){this.ListLeft=this.ListLeft+e;this.RD3Change(RD3Glb.PAN_LISTLEFT)}if(this.HListResizeMode==Glb.RESMODE_STRETCH){var A=e;this.ListWidth+=A;this.RD3Change(RD3Glb.PAN_LISTWIDTH);var C=-1;var h=-1;var q=0;var B;for(var t=0;t<this.Pages.length;t++){B=0;for(var u=0;u<this.Fields.length;u++){if(this.Fields[u].Page==t&&(this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)!=0){B=B+this.Fields[u].ListWidth}}if(B>q){h=t;this.PanelPage=t;q=B}}s=A;var b=true;while(A!=0&&b){b=false;for(var u=0;u<this.Fields.length;u++){var t=(u+this.LastColumnStretched)%(this.Fields.length);var y=this.Fields[t];if(y.CanResizeList(A,h)){b=true;C=t;if(A>0){y.ListWidth++;y.RD3Change(RD3Glb.FLD_LISTWIDTH);A--}else{y.ListWidth--;y.RD3Change(RD3Glb.FLD_LISTWIDTH);A++}}if(A==0){break}}}if(C>-1){this.LastColumnStretched=C+1}if(!b){s-=A;this.ListWidth-=A;this.RD3Change(RD3Glb.PAN_LISTWIDTH)}var a=0;for(var u=0;u<this.Fields.length;u++){if(this.Fields[u].Page==-1&&(this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)!=0){a=a+this.Fields[u].ListWidth}}for(var t=0;t<this.Pages.length;t++){if(t!=h){B=0;for(var u=0;u<this.Fields.length;u++){if(this.Fields[u].Page==t&&(this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)!=0){B=B+this.Fields[u].ListWidth}}A=this.ListWidth-(B+a);while(A!=0&&b){b=false;for(var u=0;u<this.Fields.length;u++){var y=this.Fields[u];if(y.Page==t){if(y.CanResizeList(A,t)){b=true;if(A>0){y.ListWidth++;y.RD3Change(RD3Glb.FLD_LISTWIDTH);A--}else{y.ListWidth--;y.RD3Change(RD3Glb.FLD_LISTWIDTH);A++}}if(A==0){break}}}}}}}}if(d!=0){if(this.VListResizeMode==Glb.RESMODE_MOVE){this.ListTop+=d;for(var u=0;u<this.Fields.length;u++){if((this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)!=0){this.Fields[u].ListTop+=d}}this.RD3Change(RD3Glb.PAN_LISTTOP)}if(this.VListResizeMode==Glb.RESMODE_STRETCH){this.ListHeight+=d;this.RD3Change(RD3Glb.PAN_LISTHEIGHT)}}if(s!=0||d!=0){for(var u=0;u<this.Fields.length;u++){this.Fields[u].Resize(s,d,Glb.PANEL_LIST)}}this.CalcLayout();var c=o;var g=m;n=this.GetBoundRect(true);o=n.Width-z;m=n.Height-v;var l=0;if(e<0&&o>c){l=o-c}var k=0;if(d<0&&m>g){k=m-g}if(l>0||k>0){for(var u=0;u<this.Fields.length;u++){this.Fields[u].Resize(l,k,Glb.PANEL_LIST)}}this.PanelPage=x};IDPanelSrv.prototype.GetFieldSum=function(a){return this.GetFieldAggregate(a,Glb.FLDAGGRFUN_SUM)};IDPanelSrv.prototype.GetFieldAggregate=function(f,d){var a=this.GetFieldValues(f);if(a.Count()==0){return new IDVariant()}var c=new IDVariant();switch(d){case Glb.FLDAGGRFUN_SUM:for(var b=0;b<a.Count();b++){c=IDL.Add(c,a[b])}break;case Glb.FLDAGGRFUN_AVG:c=IDL.Div(this.GetFieldAggregate(f,Glb.FLDAGGRFUN_SUM),new IDVariant(a.Count()));break;case Glb.FLDAGGRFUN_VAR:var e=this.GetFieldAggregate(f,Glb.FLDAGGRFUN_AVG);for(var b=0;b<a.Count();b++){c=IDL.Add(c,IDL.Pow(IDL.Sub(a[b],e),new IDVariant(2)))}break;case Glb.FLDAGGRFUN_STDDEV:c=IDL.Sqrt(this.GetFieldAggregate(f,Glb.FLDAGGRFUN_VAR));break;case Glb.FLDAGGRFUN_MIN:c=new IDVariant(Number.MAX_VALUE);for(var b=0;b<a.Count();b++){c=new IDVariant(Math.min(c.dblValue(),a[b].dblValue()))}break;case Glb.FLDAGGRFUN_MAX:c=new IDVariant(Number.MIN_VALUE);for(var b=0;b<a.Count();b++){c=new IDVariant(Math.max(c.dblValue(),a[b].dblValue()))}break;case Glb.FLDAGGRFUN_RANGE:c=IDL.Sub(this.GetFieldAggregate(f,Glb.FLDAGGRFUN_MAX),this.GetFieldAggregate(f,Glb.FLDAGGRFUN_MIN));break}return c};IDPanelSrv.prototype.GetFieldValues=function(j){var m=new ArrayList();try{if(this.Fields[j].IdxPanel==0&&Glb.ClassDT(this.Fields[j].DataType)==Glb.DTC_NUMBER&&(this.Status()==Glb.PS_DATA||this.Status()==Glb.PS_UPDATE)){var a=0;var g;var c=this.Queries[0].IMDBDataSource;var k=0;var b=this.Queries[0].GetAttRecNumber()-1;if(this.Queries[0].IsDO){g=this.Fields[j].GetDOIdx(null);if(this.Queries[0].IDColl==null){var h=this.GetDocument();if(h!=null&&this.Status()==Glb.PS_DATA){var l=h.GetPropByIndex(g);if(l.Type!=IDVariant.NULL){m.Add(l)}}}else{this.Queries[0].IDColl.set_UIMode(true);this.Queries[0].IDColl.MoveFirst();while(!this.Queries[0].IDColl.IsEof()){if(this.Status()!=Glb.PS_UPDATE||a<b||a>=b+this.NumRows){var h=this.Queries[0].IDColl.GetAt();var l=h.GetPropByIndex(g);if(l.Type!=IDVariant.NULL){m.Add(l)}}this.Queries[0].IDColl.MoveNext();a++}this.Queries[0].IDColl.set_UIMode(false)}}else{if(c>-1){g=this.Fields[j].GetIMDBIdx();this.IMDB.TblMoveFirst(c,Glb.IMDB_CURSOR);while(!this.IMDB.Eof(c,Glb.IMDB_CURSOR)){if(this.Status()!=Glb.PS_UPDATE||a<b||a>=b+this.NumRows){var l=this.IMDB.Value(c,g,Glb.IMDB_CURSOR);if(l.Type!=IDVariant.NULL){m.Add(l)}}this.IMDB.TblMoveNext(c,Glb.IMDB_CURSOR);a++}}else{g=this.Fields[j].GetRSIdx(this.Queries[0].RS);k=this.Queries[0].RS.getRow();if(k>=0){this.Queries[0].RS.MoveFirst()}while(!this.Queries[0].RS.EOF()){if(this.Status()!=Glb.PS_UPDATE||a<b||a>=b+this.NumRows){var l=this.Queries[0].RS.Get(g);if(l.Type!=IDVariant.NULL){m.Add(l)}}this.Queries[0].RS.MoveNext();a++}if(k>0){this.Queries[0].RS.absolute(k)}}}if(this.Status()==Glb.PS_UPDATE){for(a=0;a<this.NumRows;a++){var l=this.Fields[j].bValues(a).Value;if(l.Type!=IDVariant.NULL){m.Add(l)}}}}}catch(f){this.MainFrm.DTTObj.AddException(this.iGuid,"Panel.GetFieldValues","Can't get Field Value ("+j+")",f);return new ArrayList()}return m};IDPanelSrv.prototype.GetFieldCode=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).Code}else{return""}};IDPanelSrv.prototype.GetFieldDBCode=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).Expr}else{return""}};IDPanelSrv.prototype.GetFieldEnabled=function(c,b){if(c>=0&&c<this.UFields()){var a=this.bFields(c);if(a.IdxPanel==-1){return(a.Flags&Glb.OBJ_ENABLED)!=0}else{return a.IsEnabled(b)}}else{return false}};IDPanelSrv.prototype.GetFieldPK=function(b){if(b>=0&&b<this.UFields()){var a=this.bFields(b);return((a.Flags&Glb.FLD_ISKEY)!=0)}else{return false}};IDPanelSrv.prototype.GotoAbsolute=function(a){this.Queries[0].GotoAbsolute(a)};IDPanelSrv.prototype.GotoNext=function(){this.Queries[0].GotoNext()};IDPanelSrv.prototype.GotoFirst=function(){this.Queries[0].GotoFirst()};IDPanelSrv.prototype.GotoLast=function(){this.Queries[0].GotoLast()};IDPanelSrv.prototype.RSEOF=function(){return this.Queries[0].RSEOF()};IDPanelSrv.prototype.RefreshFields=function(){for(var a=0;a<this.Fields.length;a++){this.Fields[a].RSIdx=-1}this.ScrollRecTo(0,this.MainFrm)};IDPanelSrv.prototype.IsContentModified=function(){var a=false;if(this.Queries[0].IDColl!=null){a=this.Queries[0].IDColl.IsModified()}else{if(this.Queries[0].Document!=null){a=this.Queries[0].Document.IsModified()}else{a=this.Status()==Glb.PS_UPDATE}}if(!a){for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].SubFrame!=0){if(this.Parent.Frames[this.Fields[c].SubFrame].Content instanceof IDPanelSrv){var d=this.Parent.Frames[this.Fields[c].SubFrame].Content;a=d.IsContentModified();if(a){break}}}}}return a};IDPanelSrv.prototype.IsContentInError=function(){var a=this.IsPanelInError();if(!a){for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].SubFrame!=0){if(this.Parent.Frames[this.Fields[c].SubFrame].Content instanceof IDPanelSrv){var d=this.Parent.Frames[this.Fields[c].SubFrame].Content;a=d.IsContentInError();if(a){break}}}}}return a};IDPanelSrv.prototype.ReleaseLock=function(){if(this.Queries[0].IDColl!=null){var e=this.Queries[0].IDColl.GetCollection();for(var a=0;a<e.Count();a++){var b=e[a];b.ReleaseLock()}}else{if(this.Queries[0].Document!=null){this.Queries[0].Document.ReleaseLock()}}};IDPanelSrv.prototype.ExportData=function(I,k,c){if(I==undefined){I=true}if(k==undefined){k=true}if(c==undefined){c=this.MainFrm.ParamsObj().ExportUTF8?"UTF-8":"windows-1252"}if(!k){var A=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": received command "+this.DecodeCommand(Glb.PCM_CSV)+"; fire OnPanelCommand event"+(k?" (USER operation)":""))}this.Parent.OnPanelCommand(this,new IDVariant(Glb.PCM_CSV),A,new IDVariant(k));if(A.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": command canceled")}return""}}if(this.Parent.MainFrm.IsServerSession()){this.UpdatePanel(this.Parent.MainFrm)}var D=new StringTokenizer();D.UseDecimalDot=this.MainFrm.ParamsObj().UseDecimalDot;var z=new IDVariant(D.UseDecimalDot?",":";");try{if(this.MainFrm==null){return""}var t=this.ActualPosition();var x=this.AttR;if(x<0||x>=this.NumRows){this.AttR=0}var v="";if(IDL.IsNull(this.ExportLabel)){v+=this.GetDTTCaption()+z.stringValue()+z.stringValue()+this.QBETipText+"\n"}else{if(!this.ExportLabel.stringValue().equals("")){v+=this.ExportLabel.stringValue()+"\n"}}D.setString(new IDVariant(),z);for(var E=0;E<this.Fields.length;E++){var b=this.GetTabOrderFieldIdx(E,this.PanelMode);if(this.Fields[b].IdxPanel>=0&&this.Fields[b].DataType!=Glb.DT_DOC_OLE&&this.Fields[b].IsVisible(this.AttR,false)&&(!this.HasListVisibilityControl()||!this.Fields[b].VisualFlag(Glb.PFLVISPROP_HIDEINLIST))){if((this.VS.Flags(this.Fields[b].VisualStyle)&Glb.FL_VIS_PASSWORD)==0){D.addToken(new IDVariant(this.Fields[b].Header))}}}v+=D.getString()+"\n";this.DisableNotification=true;for(var F=1;F<=this.Queries[0].RecordCount();F++){if(this.EnableMultipleSel()&&this.ShowMultipleSel()&&!this.IsRowSelected(F)){continue}D.setString(new IDVariant(),z);this.set_ActualPosition(F);for(var E=0;E<this.Fields.length;E++){var b=this.GetTabOrderFieldIdx(E,this.PanelMode);if(this.Fields[b].IdxPanel>=0&&this.Fields[b].DataType!=Glb.DT_DOC_OLE&&this.Fields[b].IsVisible(this.AttR,false)&&(!this.HasListVisibilityControl()||!this.Fields[b].VisualFlag(Glb.PFLVISPROP_HIDEINLIST))){if((this.VS.Flags(this.Fields[b].VisualStyle)&Glb.FL_VIS_PASSWORD)==0){var q;if((this.Fields[b].Flags&Glb.FLD_AUTOLOOKUP)==0){var J=this.Fields[b].bValues(this.AttR);q=J.Value;var B=true;var d=this.VS.Mask(this.Fields[b].VisualStyle);if(!this.Fields[b].Mask.equals("")){d=this.Fields[b].Mask;B=false}if(!d.equals("=")&&this.Fields[b].EditorType!=1){var s=new IDVariant();var G=new IDVariant();var o=new IDVariant();this.Fields[b].GetClientMask(s,G,J.Value,d,J.Text,o,J.DynText,B);q=s}if(this.Fields[b].VisualFlag(Glb.PFLVISPROP_EXPORTNAMES)&&J.ValueListIndexes.length>0){q=new IDVariant(J.ValueListIndexes[0].Name)}if(IDL.IsNumber(q)&&Glb.ClassDT(this.Fields[b].DataType)==Glb.DTC_CHAR&&q.Type==IDVariant.STRING){var l=q.stringValue();var n=false;if(l.length>8&&q.longValue()>100000000){n=true}else{if(l.length>1&&l[0]=="0"&&l[1]!="."&&l[1]!=","&&IDL.IsNumber(new IDVariant(l.substring(1)))){n=true}}if(n){q=new IDVariant(l+"\t")}}}else{q=new IDVariant(this.Fields[b].bValues(this.AttR).Text)}if(q.stringValue().startsWith("=")){q=new IDVariant('="'+q+'"')}D.addToken(q)}}}v+=D.getString()+"\n"}this.DisableNotification=false;this.set_ActualPosition(t-x);this.Parent.FocusPriority=0;if(x<0||x>=this.NumRows){this.AttR=x}else{this.set_ActualPosition(t)}var f;if(this.MainFrm.ShellObject.IsInsideShell()){var m=GUID.DocID2GUID(MDOInit.GetNewDocID().stringValue())+".csv";var h=this.MainFrm.TempPath()+"/"+m;var y=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForOutput(new IDVariant(h),y,c);RD4_WebEntryPoint.VBFile.WriteLine(y,new IDVariant(v));RD4_WebEntryPoint.VBFile.Close(y);f="temp/"+m}else{var u=new Uint8Array(v.length);for(var F=0;F<v.length;F++){u[F]=v.charCodeAt(F)}var C=new BlobBuilder();C.append(u.buffer);var g=this.MainFrm.GetMimeType("csv");var a=C.getBlob(g);f=URL.createObjectURL(a)}if(I){this.MainFrm.AddTempFile(h);this.MainFrm.set_RedirectTo(new IDVariant(f));this.MainFrm.set_RedirectNewWindow(true)}return f}catch(H){this.MainFrm.DTTObj.AddException(this.iGuid,"Panel.ExportData","Can't Export data",H)}this.DisableNotification=false;return""};IDPanelSrv.prototype.GetQBETips=function(F){if(F==undefined){F=true}var L="";if(F){L+="<table>"}if(this.Status()==Glb.PS_QBE){for(var K=0;K<this.UMaster();K++){var M=this.MasterFields[K];var I=M.LastQBE;var P=M.HasConcept("DO_ID");var g="";var e="";if(M.IsVisible(0)){if(M.Header.length>20){e=M.AbbrHeaderList}else{e=M.Header}}var H=0;while(I.length>0){var j=I;var x=false;var h=false;if(I.charAt(0)!="="||I.length==1||H!=0||P){var O=I.indexOf(M.GetQBESep());if(O>=0){j=I.substr(0,O);I=I.substr(O+1)}else{j=I;I=""}if(H>0&&j.length>1&&j[0]=="="){x=true;h=true;j=j.remove(0,1)}}else{x=true;h=true;j=I.remove(0,1);I=""}if(g.length>0){g+=" "+this.MainFrm.RTCObj.GetConst("A3A75694-D0CE-479D-B528-F07FDEC0C0F5","oppure")+" "}if(j.length>0&&!x&&!P){x=true;if(j.length>1&&j.charAt(0)==">"){x=false;if(this.MainFrm.ParamsObj().QBETrueLessThan){g+=this.MainFrm.RTCObj.GetConst("03626A3B-2AF0-4173-ACB8-C14B88D40941","è maggiore di")}else{g+=this.MainFrm.RTCObj.GetConst("755EF020-4A09-4C36-8143-DB00D11D12E9","è maggiore o uguale a")}g+=(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(1)))+"</span>":" "+this.DecodeValueList(M,j.substr(1)))}if(j.length>1&&j.charAt(0)=="<"){x=false;if(this.MainFrm.ParamsObj().QBETrueLessThan){g+=this.MainFrm.RTCObj.GetConst("7E18E4CD-EEA8-45db-91B1-F15590AACCE8","è minore di")}else{g+=this.MainFrm.RTCObj.GetConst("255523FA-4C5A-4BA5-ABA1-6F2566681044","è minore o uguale a")}g+=(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(1)))+"</span>":" "+this.DecodeValueList(M,j.substr(1)))}if(j.length==1&&j.charAt(0)=="."){x=false;g+=this.MainFrm.RTCObj.GetConst("E2A280F0-71A5-4FC8-8825-35C6CA4890F1","ha un valore")}if(j.length==1&&j.charAt(0)=="!"){x=false;g+=this.MainFrm.RTCObj.GetConst("17A9DC7A-9763-49D8-98E5-0450C364ED11","non ha un valore")}if(j.length>1&&j.charAt(0)=="#"){var D="";x=false;D=this.MainFrm.RTCObj.GetConst("524DF288-90C3-45AE-9934-831D88F92FB1","è diverso da")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(1)))+"</span>":" "+this.DecodeValueList(M,j.substr(1)));if(Glb.ClassDT(M.DataType)==Glb.DTC_CHAR&&M.QBELike){j=j.substr(1);if(this.MainFrm.ParamsObj().PanelsLikeMode==Glb.PAN_LIKESTARTS){D=this.MainFrm.RTCObj.GetConst("28784B70-22BB-46CE-AA32-F9557EF5F31C","non comincia per")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j))+"</span>":" "+this.DecodeValueList(M,j))}else{D=this.MainFrm.RTCObj.GetConst("5C7BF51B-0B50-40E5-83BA-BCBE1D0B0F6A","non contiene")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j))+"</span>":" "+this.DecodeValueList(M,j))}if(j.length>0){var Q=false;if(j.charAt(0)=="*"||j.charAt(0)=="%"){D=this.MainFrm.RTCObj.GetConst("20E397D4-07A3-4718-B95A-A518C6FF8C4E","non finisce per")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(1)))+"</span>":" "+this.DecodeValueList(M,j.substr(1)));Q=true}if(j.length>1&&(j.charAt(j.length-1)=="*"||j.charAt(j.length-1)=="%")){if(Q){D=this.MainFrm.RTCObj.GetConst("5C7BF51B-0B50-40E5-83BA-BCBE1D0B0F6A","non contiene")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(1,j.length-2)))+"</span>":" "+this.DecodeValueList(M,j.substr(1,j.length-2)))}else{D=this.MainFrm.RTCObj.GetConst("28784B70-22BB-46CE-AA32-F9557EF5F31C","non comincia per")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(0,j.length-1)))+"</span>":" "+this.DecodeValueList(M,j.substr(0,j.length-1)))}}}}g+=D}}if(x&&!h){var D="";D=this.MainFrm.RTCObj.GetConst("62D62032-E653-4712-A3E0-78DC03F01E95","è uguale a")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j))+"</span>":this.DecodeValueList(M,j));var O=j.indexOf(":");var N=j.indexOf(":",O+1);if(O>=0&&N<0){var c=j.substr(0,O);var a=j.substr(O+1);if(c.length>0&&a.length>0){g+=this.MainFrm.RTCObj.GetConst("601AE10A-5A84-47C7-866F-63D00A647A4C","è compreso fra");g+=(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,c))+"</span>":" "+this.DecodeValueList(M,c));g+=this.MainFrm.RTCObj.GetConst("9FC92BC2-DF56-44DB-B89E-727D25C6812D"," e");g+=(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,a))+"</span>":" "+this.DecodeValueList(M,a))}else{if(c.length>0){g+=this.MainFrm.RTCObj.GetConst("755EF020-4A09-4C36-8143-DB00D11D12E9","è maggiore o uguale a");g+=(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,c))+"</span>":" "+this.DecodeValueList(M,c))}else{if(a.length>0){g+=this.MainFrm.RTCObj.GetConst("255523FA-4C5A-4BA5-ABA1-6F2566681044","è minore o uguale a");g+=(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,a))+"</span>":" "+this.DecodeValueList(M,a))}}}x=false}}if(x||P){if(M.ValueList.Count()>0){g+=this.MainFrm.RTCObj.GetConst("62D62032-E653-4712-A3E0-78DC03F01E95","è uguale a")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j))+"</span>":" "+this.DecodeValueList(M,j))}else{if((M.Flags&Glb.FLD_AUTOLOOKUP)!=0){var l=null;for(var y=0;y<this.Queries.length;y++){if(this.Queries[y].FieldIndex==M.Index){l=this.Queries[y];break}}if(l!=null){g+=this.MainFrm.RTCObj.GetConst("62D62032-E653-4712-A3E0-78DC03F01E95","è uguale a")+(F?" <span>"+Glb.HTMLEncode(l.GetValueSourceValue(new IDVariant(j)).ToString())+"</span>":" "+l.GetValueSourceValue(new IDVariant(j)).ToString())}}else{var D="";D=this.MainFrm.RTCObj.GetConst("62D62032-E653-4712-A3E0-78DC03F01E95","è uguale a");if(M.IsVisible(0)&&!P){D+=(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j))+"</span>":" "+this.DecodeValueList(M,j))}var J=false;for(var s=1;s<this.Queries.length;s++){var R=true;var n=false;for(var G=0;G<this.Queries[s].LookupParams.Count();G++){var u=this.Queries[s].LookupParams[G];var A=false;if(u.MstField!=null){for(var E=0;E<this.MasterFields.length;E++){var z=this.MasterFields[E];if(u.MstField==z){A=true;if(z==M){n=true}}if(z==M){break}}R&=A}}if(R&&n){var q=(M.IsVisible(0)&&!P);for(var o=0;o<this.Fields.length;o++){var d=this.Fields[o];if(d.IdxPanel==s&&d.IsVisible(this.AttR,false)){D+=(q?" - ":" ");if(e.length==0){if(d.Header.length>20){e=d.AbbrHeaderList}else{e=d.Header}}if(d.bValues(this.AttR).ValueListIndexes.length>0){var r="";for(var m=0;m<d.bValues(this.AttR).ValueListIndexes.Count();m++){var B=d.bValues(this.AttR).ValueListIndexes[m];if(B.Value.equals(d.bValues(this.AttR).Value)){r=B.Name}}D+=(F?"<span>"+Glb.HTMLEncode(r)+"</span>":r)}else{var C=d.bValues(this.AttR).Text;if(M.iMultiCriteria){var k=C.split(this.MainFrm.ComboNameSep);C=(H<k.length?k[H]:"")}D+=(F?"<span>"+Glb.HTMLEncode(C)+"</span>":C)}q=true;J=true}}break}}if(!J&&!h){if(Glb.ClassDT(M.DataType)==Glb.DTC_CHAR&&M.QBELike){if(j.length>0){if(this.MainFrm.ParamsObj().PanelsLikeMode==Glb.PAN_LIKESTARTS){D=this.MainFrm.RTCObj.GetConst("7AF4A3F7-0A4B-4FE1-A585-60370C8C2B6A","comincia per")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j))+"</span>":" "+this.DecodeValueList(M,j))}else{D=this.MainFrm.RTCObj.GetConst("550320A9-DFB1-4B60-B3C5-329E49D1DF3F","contiene")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j))+"</span>":" "+this.DecodeValueList(M,j))}var Q=false;if(j.charAt(0)=="*"||j.charAt(0)=="%"){D=this.MainFrm.RTCObj.GetConst("379B2DB2-4FCA-4AD6-978C-410DAF5CD89D","finisce per")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(1)))+"</span>":" "+this.DecodeValueList(M,j.substr(1)));Q=true}if(j.length>1&&(j.charAt(j.length-1)=="*"||j.charAt(j.length-1)=="%")){if(Q){D=this.MainFrm.RTCObj.GetConst("550320A9-DFB1-4B60-B3C5-329E49D1DF3F","contiene")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(1,j.length-2)))+"</span>":" "+this.DecodeValueList(M,j.substr(1,j.length-2)))}else{D=this.MainFrm.RTCObj.GetConst("7AF4A3F7-0A4B-4FE1-A585-60370C8C2B6A","comincia per")+(F?" <span>"+Glb.HTMLEncode(this.DecodeValueList(M,j.substr(0,j.length-1)))+"</span>":" "+this.DecodeValueList(M,j.substr(0,j.length-1)))}}}}}g+=D}}}H++}if(g.length>0&&e.length>0){if(F){L+="<tr><td class=QBEF1>";L+=e;L+="</td><td class=QBEF2>";L+=g;L+="</td></tr>"}else{L+=e+" : ";L+=g+". "}}}}if(F){if(L.length>7){L+="</table>"}else{L=L.remove(0,L.length)}}return L};IDPanelSrv.prototype.DecodeValueList=function(c,a){for(var d=0;d<c.ValueList.Count();d++){var b=c.ValueList[d];if(b.Value.ToString().equals(a)){return b.Name}}return a};IDPanelSrv.prototype.getDebugInfo=function(b,a){var c=null;var d=this.FindField(a);if(d>0){c=FieldValue(d)}if(c!=null){return c.getDebugInfo(0,"")}else{return""}};IDPanelSrv.prototype.GetFieldPage=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).Page}else{return -1}};IDPanelSrv.prototype.GetFieldGroup=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).Group}else{return -1}};IDPanelSrv.prototype.GetFieldIdxPanel=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).IdxPanel}else{return -2}};IDPanelSrv.prototype.GetFieldDataType=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).DataType}else{return -1}};IDPanelSrv.prototype.FindDocument=function(c){if(this.Queries[0].IDColl!=null){var a=this.Queries[0].IDColl.ShowHid;this.Queries[0].IDColl.ShowHid=false;var b=this.Queries[0].IDColl.FindDoc(c);this.Queries[0].IDColl.ShowHid=a;if(b>0){this.Parent.FocusPriority=0;this.set_ActualPosition(b);this.SetInput()}}};IDPanelSrv.prototype.FindRecord=function(h,n,f,m,d,l,c,k,a,j){if(f==undefined){f=null}if(m==undefined){m=null}if(d==undefined){d=null}if(l==undefined){l=null}if(c==undefined){c=null}if(k==undefined){k=null}if(a==undefined){a=null}if(j==undefined){j=null}var e=this.ActualPosition();var b=this.AttR;var o=false;var g;if(this.IsShowingGrouping()){this.set_SelectedRow(0)}this.DisableNotification=true;this.DisableLookups=true;if(this.Fields[h.intValue()].IdxPanel>0){this.DisableLookups=false}else{if(f!=null&&this.Fields[f.intValue()].IdxPanel>0){this.DisableLookups=false}else{if(d!=null&&this.Fields[d.intValue()].IdxPanel>0){this.DisableLookups=false}else{if(c!=null&&this.Fields[c.intValue()].IdxPanel>0){this.DisableLookups=false}else{if(a!=null&&this.Fields[a.intValue()].IdxPanel>0){this.DisableLookups=false}}}}}for(g=1;g<=this.Queries[0].RecordCount();g++){this.set_ActualPosition(g);if(!this.Fields[h.intValue()].bValues(this.AttR).Value.equals(n)){continue}else{if(f!=null){if(!this.Fields[f.intValue()].bValues(this.AttR).Value.equals(m)){continue}else{if(d!=null){if(!this.Fields[d.intValue()].bValues(this.AttR).Value.equals(l)){continue}else{if(c!=null){if(!this.Fields[c.intValue()].bValues(this.AttR).Value.equals(k)){continue}else{if(a!=null){if(!this.Fields[a.intValue()].bValues(this.AttR).Value.equals(j)){continue}}}}}}}}}o=true;break}this.set_ActualPosition(e-b);this.Parent.FocusPriority=0;this.set_ActualPosition(e);if(this.IsShowingGrouping()){this.set_SelectedRow(b)}this.DisableNotification=false;this.DisableLookups=false;if(o){this.Parent.FocusPriority=0;this.set_ActualPosition(g);if(this.IsShowingGrouping()){this.set_SelectedRow(0);this.ForceSendPosition=true}this.SetInput();return new IDVariant(g)}else{return new IDVariant(0)}};IDPanelSrv.prototype.IsPanelFixActiveRowWhenScrolled=function(){if(!this.MainFrm.ParamsObj().PanelFixActiveRowWhenScrolled){return false}if(this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.MainFrm.IsIonic()||this.IsFluidPanel()){return false}return true};IDPanelSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true;if((a==RD3Glb.PAN_NUMROWS||a==RD3Glb.PAN_TOTALROWS)&&this.RD3ListCache!=null){if(this.Status()==Glb.PS_QBE){this.RD3ListCache.length=1;this.RD3FormCache.length=1}else{this.RD3ListCache.length=this.Queries[0].RecordCount()+this.NumRows;this.RD3FormCache.length=this.Queries[0].RecordCount()+this.NumRows}}if(a==RD3Glb.PAN_TOTALROWS&&this.Queries[0].IDColl!=null&&this.MainFrm.ParamsObj().UseRD3){if(this.RD3UpdateCount==null){this.RD3UpdateCount=new Array(this.Queries[0].RecordCount())}else{Array.resize(this.RD3UpdateCount,this.Queries[0].RecordCount())}}};IDPanelSrv.prototype.GetRD3Name=function(){return"pan"};IDPanelSrv.prototype.GetRD3Ident=function(c,a){if(arguments.length==0){return WebFrameSrv.prototype.GetRD3Ident.call(this)}else{if(c.equals("frame")){return this.GetRD3Ident()}else{var b="";if(!c.equals("toolbar")){b=c}else{switch(a){case Glb.PCM_FORMLIST:b="formlist";break;case Glb.PCM_SEARCH:b="search";break;case Glb.PCM_FIND:b="find";break;case Glb.PCM_INSERT:b="new";break;case Glb.PCM_DELETE:b="del";break;case Glb.PCM_CANCEL:b="cancel";break;case Glb.PCM_REQUERY:b="refresh";break;case Glb.PCM_UPDATE:b="save";break;case Glb.PCM_DUPLICATE:b="dupl";break;case Glb.PCM_PRINT:b="print";break;case Glb.PCM_GROUP:b="group";break;case Glb.PCM_CSV:b="csv";break;case Glb.PCM_ATTACH:b="attach";break;case Glb.PCM_NAVIGATION:b="top";break;case Glb.PCM_CUSTOM1:b="custom0";break;case Glb.PCM_CUSTOM2:b="custom1";break;case Glb.PCM_CUSTOM3:b="custom2";break;case Glb.PCM_CUSTOM4:b="custom3";break;case Glb.PCM_CUSTOM5:b="custom4";break;case Glb.PCM_CUSTOM6:b="custom5";break;case Glb.PCM_CUSTOM7:b="custom6";break;case Glb.PCM_CUSTOM8:b="custom7";break;case Glb.PCM_CUSTOM9:b="custom8";break;case Glb.PCM_CUSTOM10:b="custom9";break;case Glb.PCM_CUSTOM11:b="custom10";break;case Glb.PCM_CUSTOM12:b="custom11";break;case Glb.PCM_CUSTOM13:b="custom12";break;case Glb.PCM_CUSTOM14:b="custom13";break;case Glb.PCM_CUSTOM15:b="custom14";break;case Glb.PCM_CUSTOM16:b="custom15";break}}return this.GetRD3Ident()+(b.length>0?":"+b:"")}}};IDPanelSrv.prototype.RD3RenderDifferences=function(q,u,k){this.DTTTrace(this.MainFrm);var n=this.RD3Changed;if(k&&this.DynamicRows>0&&(this.MainFrm.IsMobile()||this.MainFrm.IsBootstrap()||this.IsFluidPanel())&&this.PanelMode==Glb.PANEL_FORM&&this.NumRows==1){this.OriginalListHeight=0}var B=!k;var o=WebFrameSrv.prototype.RD3RenderDifferences.call(this,q,u,k);if(q==null){q=o}n|=(o!=null);if(q==null&&this.RD3Changed){q=u.AddNewElement("chg");q.SetAttribute("id",this.GetRD3Ident());o=q}if(k||this.RD3Changed){for(var s=0;s<this.RD3PropChg.length;s++){if(this.RD3PropChg[s]||k){this.SetRD3Property(s,q,k)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(k){if(this.RowSelectEventDef!=RD3Glb.EVENT_ACTIVE){q.SetAttribute("rck",this.RowSelectEventDef.toString())}if(this.ScrollEventDef!=RD3Glb.EVENT_ACTIVE){q.SetAttribute("sck",this.ScrollEventDef.toString())}if(this.ToolbarEventDef!=RD3Glb.EVENT_ACTIVE){q.SetAttribute("tck",this.ToolbarEventDef.toString())}if(this.PageClickEventDef!=RD3Glb.EVENT_ACTIVE){q.SetAttribute("pck",this.PageClickEventDef.toString())}if(this.FocusEventDef!=RD3Glb.EVENT_CLIENTSIDE){q.SetAttribute("fed",this.FocusEventDef.toString())}if(this.MouseOverEventDef!=RD3Glb.EVENT_CLIENTSIDE){q.SetAttribute("moe",this.MouseOverEventDef.toString())}if(this.TextSelectionEventDef!=(RD3Glb.EVENT_DEFERRED)){q.SetAttribute("tsk",this.TextSelectionEventDef.toString())}var z=this.MultiSelEventDef|(this.iActiveMultipleSel?RD3Glb.EVENT_IMMEDIATE:0);if(z!=(RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_CLIENTSIDE)){q.SetAttribute("mse",z.toString())}if(this.ChangeLayoutAnimationDef!=null){q.SetAttribute("cla",this.ChangeLayoutAnimationDef)}if(this.QBETipAnimationDef!=null){q.SetAttribute("qta",this.QBETipAnimationDef)}if(this.ResOnlyVisFlds){q.SetAttribute("rvf",this.ResOnlyVisFlds?"1":"0")}if(this.MainFrm.RD3CanOWA&&!this.IsIMDB()&&this.Queries[0].MstTableName!=null){q.SetAttribute("dsn",(this.IsDO()?"DO":"DB")+":"+this.Queries[0].MstTableName)}if((this.Flags&Glb.PAN_QBEFORM)>0){q.SetAttribute("qbf","1")}if(this.Queries[0].IsDO){q.SetAttribute("ido","1")}if(this.iSearchInContent!=true){q.SetAttribute("ssc",this.iSearchInContent?"1":"0")}if(this.AllowMasterPanelNav!=true){q.SetAttribute("amp",this.AllowMasterPanelNav?"1":"0")}}var g=this.Queries[0].GetAttRecNumber()-1;var b=this.NumRows;if(this.Status()==Glb.PS_QBE){g=0;b=1;if(this.RD3ListCache.length==0){b=0}}if(B){var c=false;for(var s=0;s<b&&g>=0&&!c;s++){if(this.PanelMode==Glb.PANEL_LIST){c|=!this.RD3ListCache[g+s]}else{c|=!this.RD3FormCache[g+s]}}if(c){if(q==null){q=u.AddNewElement("chg");q.SetAttribute("id",this.GetRD3Ident());o=q}for(var s=0;s<this.Fields.length;s++){var v=this.Fields[s];if(this.PanelMode==Glb.PANEL_LIST){var A=(s==0&&((v.Flags&Glb.FLD_INLIST)==0));if(A||((v.Flags&Glb.FLD_INLIST)!=0&&v.IdxPanel>=0)){var l=q.AddNewElement("fvl");l.SetAttribute("id",v.GetRD3Ident());for(var r=0;r<b;r++){if(!this.RD3ListCache[g+r]){var e=false;if(A){e=v.Values[r].GetRD3Changed(RD3Glb.VAL_ROWSEL)}var m=v.Values[r].GetRD3Changed(RD3Glb.VAL_VALUELIST);v.Values[r].RD3RenderDifferences(l,true);if(A){v.Values[r].RD3Change(RD3Glb.VAL_ROWSEL,e)}if(m){v.Values[r].RD3Change(RD3Glb.VAL_VALUELIST)}}}}}else{if((v.Flags&Glb.FLD_INFORM)!=0&&v.IdxPanel>=0&&!this.RD3FormCache[g]){var l=q.AddNewElement("fvl");l.SetAttribute("id",v.GetRD3Ident());var m=v.Values[0].GetRD3Changed(RD3Glb.VAL_VALUELIST);v.Values[0].RD3RenderDifferences(l,true);if(m){v.Values[0].RD3Change(RD3Glb.VAL_VALUELIST)}}}}if(this.Queries[0].IsDO&&this.EnableMultipleSel()){if(this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(true)}for(var r=0;r<b;r++){if(!this.RD3ListCache[g+r]){var y=this.GetDocument(r);if(y!=null&&((this.Flags&Glb.PAN_HASLIST)!=0)){var x=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());x.SetAttribute("row",(g+r+1).toString());x.SetAttribute("value",y.Selected()?"1":"0")}}}if(this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(false)}}}}var t=(k)?q:u;if(k&&this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(true)}if(this.MainFrm.RD3EnableOWA){if(this.Queries[0].RecordCount()>this.NumRows){this.SetDynRows(1000,false);this.UpdateDynRows(this.Queries[0].RecordCount());this.ScrollRecTo(0,this.MainFrm)}}var h=false;for(var s=0;s<this.RDRowSel.length&&!h;s++){h|=this.RDRowSel[s]}for(var s=0;s<this.Fields.length;s++){if((this.PanelMode==Glb.PANEL_LIST&&((this.Fields[s].Flags&Glb.FLD_INLIST)!=0)||s==0)||(this.PanelMode==Glb.PANEL_FORM&&(this.Fields[s].Flags&Glb.FLD_INFORM)!=0)||k){n|=this.Fields[s].RD3RenderDifference(t,k,(h&&s==0))}}if(k&&this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(false)}for(var s=0;s<this.Pages.length;s++){n|=this.Pages[s].RD3RenderDifference(t,k)}for(var s=0;s<this.Groups.length;s++){n|=this.Groups[s].RD3RenderDifference(t,k)}if(n&&this.RD3ListCache!=null){for(var s=0;s<b&&g>=0;s++){if(this.PanelMode==Glb.PANEL_FORM){this.RD3FormCache[g+s]=true}else{this.RD3ListCache[g+s]=true}}}if((this.RD3Sendmulti||(k&&!this.Queries[0].IsDO&&this.iStatus!=Glb.PS_QBE))&&this.EnableMultipleSel()&&((this.Flags&Glb.PAN_HASLIST)!=0)){this.RD3SendMultiselection()}this.FinalUpdate=false;return n?o:null};IDPanelSrv.prototype.SetRD3Property=function(n,r,l){switch(n){case RD3Glb.PAN_PANELMODE:if(this.PanelMode==0&&l){break}r.SetAttribute("mod",this.PanelMode.toString());break;case RD3Glb.PAN_MASTER:var k=this.Queries[0]!=null&&this.Queries[0].IsDO&this.Queries[0].IsMasterDO;if(!k&&l){break}r.SetAttribute("mst",k?"1":"0");break;case RD3Glb.PAN_STATUS:r.SetAttribute("sta",this.iStatus.toString());if(this.Queries[0]!=null&&this.Queries[0].IsDO){var c=false;var j=true;if(this.Queries[0].IDColl!=null){c=this.Queries[0].IDColl.IsModified()}else{var o=this.GetDocument();if(o!=null){c=o.IsModified()}}if(c){j=this.CanSaveMasterDoc()}if(!l||c){r.SetAttribute("dom",c?"1":"0")}if(!l||!j){r.SetAttribute("csa",j?"1":"0")}}break;case RD3Glb.PAN_NUMROWS:var f=this.NumRows;if(this.MainFrm.IsMobile()&&this.IsShowingGrouping()&&this.Queries[0].RecordCount()==this.NumRows){var g=this.GroupRoot.getLabelNumber();f+=g}r.SetAttribute("num",f.toString());break;case RD3Glb.PAN_MAXHROW:r.SetAttribute("mhr",(this.MaxHRow!=0?this.MaxHRow:20).toString());break;case RD3Glb.PAN_PANELPAGE:if(this.PanelPage==0&&l){break}r.SetAttribute("pag",this.PanelPage.toString());break;case RD3Glb.PAN_HEADERSIZE:r.SetAttribute("hds",this.HeaderSize.toString());break;case RD3Glb.PAN_SHOWTOOLBAR:if(this.ShowToolbar&&l){break}r.SetAttribute("stb",this.ShowToolbar?"1":"0");break;case RD3Glb.PAN_SHOWSTATUSBAR:if(this.ShowStatusbar&&l){break}r.SetAttribute("ssb",this.ShowStatusbar?"1":"0");break;case RD3Glb.PAN_SHOWROWSELECTOR:if(this.ShowRowSelector&&l){break}r.SetAttribute("srs",this.ShowRowSelector?"1":"0");break;case RD3Glb.PAN_SHOWMULTIPLESEL:if(!this.ShowMultipleSel(false)&&l){break}r.SetAttribute("sms",this.ShowMultipleSel(false)?"1":"0");break;case RD3Glb.PAN_ENABLEMULTIPLESEL:if(this.EnableMultipleSel()&&l){break}r.SetAttribute("ems",this.EnableMultipleSel()?"1":"0");break;case RD3Glb.PAN_SELALLONLYVIS:if(!this.SelectAllOnlyVisible()&&l){break}r.SetAttribute("sov",this.SelectAllOnlyVisible()?"1":"0");break;case RD3Glb.PAN_DYNAMICROWS:if(this.DynamicRows==0&&l){break}r.SetAttribute("dyr",this.DynamicRows.toString());break;case RD3Glb.PAN_DYNAMICHEIGHT:if(!this.DynamicHeight&&l){break}r.SetAttribute("dyh",this.DynamicHeight?"1":"0");break;case RD3Glb.PAN_HASSCROLLBAR:if((this.Flags&Glb.PAN_SCROLLREC)!=0&&l){break}r.SetAttribute("hsc",((this.Flags&Glb.PAN_SCROLLREC)!=0)?"1":"0");break;case RD3Glb.PAN_HASLIST:if((this.Flags&Glb.PAN_HASLIST)!=0&&l){break}r.SetAttribute("hli",((this.Flags&Glb.PAN_HASLIST)!=0)?"1":"0");break;case RD3Glb.PAN_HASFORM:if((this.Flags&Glb.PAN_HASFORM)!=0&&l){break}r.SetAttribute("hfo",((this.Flags&Glb.PAN_HASFORM)!=0)?"1":"0");break;case RD3Glb.PAN_CANUPDATE:if((this.Flags&Glb.PAN_CANUPDATE)!=0&&l){break}r.SetAttribute("upd",((this.Flags&Glb.PAN_CANUPDATE)!=0)?"1":"0");break;case RD3Glb.PAN_CANDELETE:if((this.Flags&Glb.PAN_CANDELETE)!=0&&l){break}r.SetAttribute("del",((this.Flags&Glb.PAN_CANDELETE)!=0)?"1":"0");break;case RD3Glb.PAN_CANINSERT:if((this.Flags&Glb.PAN_CANINSERT)!=0&&l){break}r.SetAttribute("ins",((this.Flags&Glb.PAN_CANINSERT)!=0)?"1":"0");break;case RD3Glb.PAN_CANSEARCH:if((this.Flags&Glb.PAN_CANSELECT)!=0&&l){break}r.SetAttribute("sea",((this.Flags&Glb.PAN_CANSELECT)!=0)?"1":"0");break;case RD3Glb.PAN_CANSORT:if((this.Flags&Glb.PAN_CANSORT)!=0&&l){break}r.SetAttribute("sor",((this.Flags&Glb.PAN_CANSORT)!=0)?"1":"0");break;case RD3Glb.PAN_LISTLEFT:if(this.ListLeft==0&&l){break}r.SetAttribute("lle",this.ListLeft.toString());break;case RD3Glb.PAN_LISTTOP:if(this.ListTop==0&&l){break}r.SetAttribute("lto",this.ListTop.toString());break;case RD3Glb.PAN_LISTWIDTH:r.SetAttribute("lwi",this.ListWidth.toString());break;case RD3Glb.PAN_LISTHEIGHT:var q=this.ListHeight;if(this.IsFluidPanel()&&this.DesignListHeight!=-100){q=this.DesignListHeight}if(this.MainFrm.IsMobile()&&this.IsShowingGrouping()&&this.Queries[0].RecordCount()==this.NumRows){var g=this.GroupRoot.getLabelNumber();q+=(g*this.MaxHRow)}r.SetAttribute("lhe",q.toString());break;case RD3Glb.PAN_ACTUALROW:if(this.IsShowingGrouping()&&!this.SendPositions&&!this.ForceSendPosition){break}if(this.AttR==0&&l){break}r.SetAttribute("atr",this.AttR.toString());if(this.ForceSendPosition){r.SetAttribute("ftr","1")}break;case RD3Glb.PAN_VRESMODE:if(this.VListResizeMode==Glb.RESMODE_STRETCH&&l){break}r.SetAttribute("vre",this.VListResizeMode.toString());break;case RD3Glb.PAN_HRESMODE:if(this.HListResizeMode==Glb.RESMODE_STRETCH&&l){break}r.SetAttribute("hre",this.HListResizeMode.toString());break;case RD3Glb.PAN_VISUALSTYLE:r.SetAttribute("sty",this.MainFrm.VisualStyleList.GetTrueIdx(this.iVisualStyle).toString());break;case RD3Glb.PAN_FIXEDCOLS:if(this.FixedCols()==0&&l){break}r.SetAttribute("fix",this.FixedCols().toString());break;case RD3Glb.PAN_QBETIP:if(this.QBETip.length==0&&l){break}r.SetAttribute("qtp",this.QBETip);break;case RD3Glb.PAN_ACTUALPOSITION:if(this.IsShowingGrouping()&&!this.SendPositions&&!this.ForceSendPosition){break}var a=this.Queries[0].GetAttRecNumber();if(a==0||this.Status()==Glb.PS_QBE){a=1}if(a==1&&l){break}r.SetAttribute("acp",a.toString());break;case RD3Glb.PAN_TOTALROWS:if(this.Queries[0].RecordCount()==-1&&l){break}r.SetAttribute("tot",this.Queries[0].RecordCount().toString());if(this.Queries[0].IDColl!=null){r.SetAttribute("mor",this.Queries[0].IDColl.HasMoreElements?"1":"0")}break;case RD3Glb.PAN_ENABLEDCOMMANDS:var h=this.EnabledCommands;if(this.IsDO()){var o=this.GetDocument();var e=(o!=null)?o.GetMD():null;if(!this.Queries[0].IsMasterDO){h&=(~Glb.PCM_REQUERY)}if(o==null||(e.Services&(MDOInit.SERV_ATTACH|MDOInit.SERV_COMMENT|MDOInit.SERV_DOMAIN|MDOInit.SERV_USERINFO|MDOInit.SERV_LDELETE|MDOInit.SERV_LOCKING))==0||o.Inserted()){h&=(~Glb.PCM_ATTACH)}}else{h&=(~Glb.PCM_ATTACH)}if(h==-1&&l){break}r.SetAttribute("enc",h.toString());break;case RD3Glb.PAN_EXTENABLEDCOMMANDS:var h=this.ExtendedEnabledCommands;if(h==-1&&l){break}r.SetAttribute("eec",h.toString());break;case RD3Glb.PAN_HASBOOK:if(this.MyBook==null&&l){break}r.SetAttribute("bok",this.MyBook!=null?"1":"0");break;case RD3Glb.PAN_ADVTAB:var m=this.IsAdvTabOrderEnabled();if(!m&&l){break}r.SetAttribute("ata",m?"1":"0");break;case RD3Glb.PAN_ACTIVATERIGHTCLICK:var m=this.ActivateRightClick;if(!m&&l){break}r.SetAttribute("arc",m?"1":"0");break;case RD3Glb.PAN_INFOMSG:if(!this.ShowInfoMessages&&l){break}r.SetAttribute("inf",this.ShowInfoMessages?"1":"0");break;case RD3Glb.PAN_SINGLEDOC:var d=(this.IsDO()&&this.Queries[0].IsMasterDO&&this.Queries[0].IDColl==null);if(!d&&l){break}r.SetAttribute("sdo",d?"1":"0");break;case RD3Glb.PAN_CONFIRMDEL:if(this.ConfirmDelete&&l){break}r.SetAttribute("cde",this.ConfirmDelete?"1":"0");break;case RD3Glb.PAN_HLDELETE:if(this.HighlightDelete&&l){break}r.SetAttribute("hde",this.HighlightDelete?"1":"0");break;case RD3Glb.PAN_CMDBLOCK:r.SetAttribute("cbk",this.BlockingCommands.toString());break;case RD3Glb.PAN_REORDERCOLUMN:if(!this.ReorderColumn&&l){break}r.SetAttribute("rcl",this.ReorderColumn?"1":"0");break;case RD3Glb.PAN_RESIZECOLUMN:if(!this.ResizeColumn&&l){break}r.SetAttribute("rsc",this.ResizeColumn?"1":"0");break;case RD3Glb.PAN_SENDGROUPS:if(!(this.GroupingEnabled()&&this.ShowGroups())||this.GroupRoot==null){break}this.GroupRoot.RD3RenderDifference(r);break;case RD3Glb.PAN_GROUPING:if(!this.GroupingEnabled()&&l){break}r.SetAttribute("grn",this.GroupingEnabled()?"1":"0");break;case RD3Glb.PAN_SHOWGROUPUI:if(!this.ShowGroups()&&l){break}r.SetAttribute("sgr",this.ShowGroups()?"1":"0");break;case RD3Glb.PAN_TIPONEACHROW:if(!this.TooltipOnEachRow&&l){break}r.SetAttribute("tor",this.TooltipOnEachRow?"1":"0");break;case RD3Glb.PAN_ENABLEINSERTLOCKED:if(!this.EnableInsertWhenLocked()&&l){break}r.SetAttribute("eil",this.EnableInsertWhenLocked()?"1":"0");break;case RD3Glb.PAN_HASDOCTEMPLATE:if(this.Queries[0].DocTempl==null&&l){break}r.SetAttribute("hdt",this.Queries[0].DocTempl!=null?"1":"0");break;case RD3Glb.PAN_VISPROP:if(this.iVisualFlags==0&&l){break}r.SetAttribute("vfl",this.iVisualFlags.toString());break;case RD3Glb.PAN_LOADPOL:if(this.iLoadingPolicy==1&&l){break}r.SetAttribute("lpl",this.iLoadingPolicy.toString());break;case RD3Glb.PAN_PULLREF:if(this.iPullToRefresh&&l){break}r.SetAttribute("pre",this.iPullToRefresh?"1":"0");break;case RD3Glb.PAN_ENLISTQBE:if(!this.UseListQBEEnabled()&&l){break}r.SetAttribute("lqb",this.iUseListQBE.toString());break;case RD3Glb.PAN_FLUIDPANEL:if(this.FluidPanel==false&&l){break}r.SetAttribute("pfp",this.FluidPanel?"1":"0");break;case RD3Glb.PAN_ROWHEIGTHRES:if(this.iRowHeightResize==false&&l){break}r.SetAttribute("rhr",this.iRowHeightResize?"1":"0");break}};IDPanelSrv.prototype.ResetRD3Cache=function(){this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());if(this.Status()==Glb.PS_QBE){this.RD3ListCache=new BitArray(1);this.RD3FormCache=new BitArray(1)}else{this.RD3ListCache=new BitArray(this.Queries[0].RecordCount()+this.NumRows);this.RD3FormCache=new BitArray(this.Queries[0].RecordCount()+this.NumRows)}if(this.Queries[0].IDColl!=null&&this.MainFrm.ParamsObj().UseRD3){this.RD3UpdateCount=new Array(this.Queries[0].RecordCount())}this.RD3Change(RD3Glb.PAN_TOTALROWS)};IDPanelSrv.prototype.ClearRD3Cache=function(d,c){if(d==undefined){this.ResetRD3Cache();return}if(c==undefined){c=this.RD3ListCache.length}for(var a=d-1;a<c;a++){this.RD3ListCache[a]=false;this.RD3FormCache[a]=false}var b=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());b.SetAttribute("from",d.toString());b.SetAttribute("to",c.toString());if(this.RD3UpdateCount!=null){if(c>this.RD3UpdateCount.length){c=this.RD3UpdateCount.length}for(var a=d-1;a<c;a++){this.RD3UpdateCount[a]=0}}};IDPanelSrv.prototype.RD3Scroll=function(c){var b=this.AttR;if(this.PanelCommand(Glb.PCM_NAVIGATION,4,true)){if(this.PanelMode==Glb.PANEL_LIST&&this.IsPanelFixActiveRowWhenScrolled()){this.DisableChangeRow=true}var a=this.Queries[0].ActualPosition;this.ScrollRecTo(c,this.MainFrm);var d=this.Queries[0].ActualPosition;if(this.PanelMode==Glb.PANEL_LIST&&this.IsPanelFixActiveRowWhenScrolled()){this.AttR-=(d-a);this.RD3Change(RD3Glb.PAN_ACTUALROW,false);if(this.AttR>=0&&this.AttR<this.NumRows&&d!=a){this.Queries[0].UpdateIMDB(this.AttR,true,true,true)}this.DisableChangeRow=false}}if(this.AttR==b){this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}if(this.Queries[0].ActualPosition!=c){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION)}else{this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false)}if(!this.HasFocus()&&this.AttR>=0&&this.AttR<this.NumRows){this.SetInput()}if(this.Queries[0].ActualPosition+this.NumRows>=this.Queries[0].RecordCount()){this.LoadMoreRows()}};IDPanelSrv.prototype.RD3RowSel=function(c,a){if(this.Layout()==Glb.PANEL_FORM&&c>0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,70,"IDPanel.RD3RowSel","Panel "+this.GetDTTCaption()+": Can't change row while in a FORM layout (row-selector click)");return}this.RD3EndRequest();this.set_SelectedRow(c);if(this.IsShowingGrouping()&&this.GroupRoot!=null){var d=a-c;if(d<=0){this.AttR=(c+d)-1;d=1}this.set_ActualPosition(d);this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}var b=false;if(this.Parent!=null){if(this.Parent.OpenAs!=Glb.OPEN_MDI&&this.Parent.CloseOnSelection){this.MainFrm.DTTObj.SetRequestName("Lookup Selection","Lookup "+this.GetDTTCaption()+" closed",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOOKUP,"Lookup "+this.GetDTTCaption()+" selection","",c);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(c+1)+" nel pannello "+this.GetDTTCaption());b=true}}if(!b){this.MainFrm.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected","",this.AttR);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption())}this.AcknowledgeWarnings();this.FireOnSelectingRow();if(this.Parent.OpenAs!=Glb.OPEN_MDI&&this.Parent.CloseOnSelection){this.MainFrm.UnloadForm(this.Parent.FormIdx,true)}};IDPanelSrv.prototype.RD3MultiSel=function(c,b){var a=false;if(this.IsShowingGrouping()){if(this.IsRowSelected(c)!=b){this.RD3ChangeSel=true;a=true;this.SetRowSelected(b,c);this.MainFrm.DTTObj.SetRequestName("Row Multi-Selection","Panel "+this.GetDTTCaption()+" row multi-selection",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" "+(c)+" record selected","",c);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,(b?"Seleziona":"Deseleziona")+" la riga "+(c)+" del pannello "+this.GetDTTCaption()+" usando il check accanto alla riga stessa")}return a}if(this.IsRowSelected(this.Queries[0].GetAttRecNumber()+c)!=b){this.RD3ChangeSel=true;a=true;this.SetRowSelected(b,this.Queries[0].GetAttRecNumber()+c);this.MainFrm.DTTObj.SetRequestName("Row Multi-Selection","Panel "+this.GetDTTCaption()+" row multi-selection",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" "+(c+1)+" row selected","",c);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,(b?"Seleziona":"Deseleziona")+" la riga "+(c+1)+" del pannello "+this.GetDTTCaption()+" usando il check accanto alla riga stessa")}return a};IDPanelSrv.prototype.RD3PanelCommand=function(g){this.RD3EndRequest();if(g.equals("lock")){if((this.iStatus==Glb.PS_DATA||this.iStatus==Glb.PS_QBE)){this.MainFrm.DTTObj.SetRequestName("Lock Panel","Panel "+this.GetDTTCaption()+": locked",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOCK,"Panel "+this.GetDTTCaption()+" locked","","lock");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Blocca il pannello "+this.GetDTTCaption());this.set_Locked(true);this.RD3FrameChange(RD3Glb.WFR_LOCKED,false)}if((this.ToolbarEventDef&RD3Glb.EVENT_CLIENTSIDE)>0){if(!this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}else{if(this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}}else{if(g.equals("unlock")){if((this.iStatus==Glb.PS_DATA||this.iStatus==Glb.PS_QBE)){this.MainFrm.DTTObj.SetRequestName("Unlock Panel","Panel "+this.GetDTTCaption()+": unlocked",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOCK,"Panel "+this.GetDTTCaption()+" unlocked","","lock");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Sblocca il pannello "+this.GetDTTCaption());this.set_Locked(false);this.RD3FrameChange(RD3Glb.WFR_LOCKED,false)}if((this.ToolbarEventDef&RD3Glb.EVENT_CLIENTSIDE)>0){if(this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}else{if(!this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}}else{if(g.equals("top")){this.MainFrm.DTTObj.SetRequestName("Go Top","Panel "+this.GetDTTCaption()+": go to top",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","top");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone TOP nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_NAVIGATION,0,true)}else{if(g.equals("prev")){var f=this.ActualPosition()-this.NumRows+1;this.MainFrm.DTTObj.SetRequestName("Previous Page","Panel "+this.GetDTTCaption()+": previous page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","prev");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PREVIOUS nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_NAVIGATION,3,true);if(this.ToolbarEventDef==RD3Glb.EVENT_ACTIVE){if(this.ActualPosition()==f&&this.Status()==Glb.PS_DATA){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}}}else{if(g.equals("next")){var f=this.ActualPosition()+this.NumRows-1;this.MainFrm.DTTObj.SetRequestName("Next Page","Panel "+this.GetDTTCaption()+": next page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","next");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone NEXT nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_NAVIGATION,2,true);if(this.ToolbarEventDef==RD3Glb.EVENT_ACTIVE){if(this.ActualPosition()==f&&this.Status()==Glb.PS_DATA){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}}}else{if(g.equals("bottom")){this.MainFrm.DTTObj.SetRequestName("Go Bottom","Panel "+this.GetDTTCaption()+": go to bottom",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","bottom");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone BOTTOM nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_NAVIGATION,1,true)}else{if(g.equals("search")){this.MainFrm.DTTObj.SetRequestName("Search Data","Panel "+this.GetDTTCaption()+": search data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","search");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SEARCH nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_SEARCH,0,true)}else{if(g.equals("find")){this.MainFrm.DTTObj.SetRequestName("Find Data","Panel "+this.GetDTTCaption()+": find data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","find");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone FIND nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_FIND,0,true)}else{if(g.equals("list")){var b=this.PanelMode;this.MainFrm.DTTObj.SetRequestName("Change panel mode","Panel "+this.GetDTTCaption()+": mode change from "+(this.PanelMode==Glb.PANEL_LIST?"LIST":"FORM")+" to "+(this.PanelMode==Glb.PANEL_LIST?"FORM":"LIST"),DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","list");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone FORM-LIST nella toolbar del pannello "+this.GetDTTCaption()+" (il pannello cambia stato in "+(this.PanelMode==Glb.PANEL_LIST?"FORM":"LIST")+")");this.PanelCommand(Glb.PCM_FORMLIST,0,true);if(this.ToolbarEventDef==RD3Glb.EVENT_ACTIVE){if(this.PanelMode==b){this.RD3Change(RD3Glb.PAN_PANELMODE)}else{if(this.DynamicRows==0){this.RD3Change(RD3Glb.PAN_NUMROWS,false)}}}}else{if(g.equals("cancel")){this.MainFrm.DTTObj.SetRequestName("Cancel Update","Panel "+this.GetDTTCaption()+": undo changes",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","cancel");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone UNDO nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_CANCEL,0,true)}else{if(g.equals("refresh")){this.MainFrm.DTTObj.SetRequestName("Refresh Query","Panel "+this.GetDTTCaption()+": refresh query",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","refresh");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone REFRESH nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_REQUERY,0,true)}else{if(g.equals("csv")){this.MainFrm.DTTObj.SetRequestName("Export Data","Panel "+this.GetDTTCaption()+": export",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","csv");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone EXCEL nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_CSV,0,true)}else{if(g.equals("save")){this.MainFrm.DTTObj.SetRequestName("Update Data","Panel "+this.GetDTTCaption()+": update data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","save");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone UPDATE nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_UPDATE,0,true)}else{if(g.equals("delete")){this.MainFrm.DTTObj.SetRequestName("Delete Record","Panel "+this.GetDTTCaption()+": delete record",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","delete");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone DELETE nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_DELETE,0,true)}else{if(g.equals("insert")){this.MainFrm.DTTObj.SetRequestName("Insert Row","Panel "+this.GetDTTCaption()+": go to new row",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","insert");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone NEW nella toolbar del pannello "+this.GetDTTCaption());var d=this.PanelCommand(Glb.PCM_INSERT,0,true);if(this.Locked()&&this.EnableInsertWhenLocked()&&!d){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}else{if(g.equals("dupl")){this.MainFrm.DTTObj.SetRequestName("Duplicate Row","Panel "+this.GetDTTCaption()+": duplicate record",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","dupl");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone DUPLICATE nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_DUPLICATE,0,true)}else{if(g.equals("print")){this.MainFrm.DTTObj.SetRequestName("Print Data","Panel "+this.GetDTTCaption()+": print",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","print");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PRINT nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_PRINT,0,true)}else{if(g.equals("group")){this.MainFrm.DTTObj.SetRequestName("Grouping","Panel "+this.GetDTTCaption()+": Handle Grouping",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","grouping");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone RAGGRUPPA nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_GROUP,0,true)}else{if(g.equals("attach")){this.MainFrm.DTTObj.SetRequestName("Open Attachment Form","Panel "+this.GetDTTCaption()+": Open Attachment",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","att");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone GRAFFETTA nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_ATTACH,0,true)}else{if(g.startsWith("delblob")){var e=(this.MainFrm.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT?"class=abm":"align=absmiddle");var c=parseInt(g.substr(7),10);this.MainFrm.DTTObj.SetRequestName("Delete Blob","Panel "+this.GetDTTCaption()+": delete Blob",DTTRequest.PRI_CMD);this.Fields[c].DeleteBlob(this.MainFrm);this.SetInfoMessage(this.MainFrm.RTCObj.GetConst("C2AC5078-2E12-4B35-AFCA-611D9EA24BB7","Il documento è stato cancellato."))}else{if(g.startsWith("upload")){var e=(this.MainFrm.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT?"class=abm":"align=absmiddle");var c=parseInt(g.substr(6),10);this.MainFrm.DTTObj.SetRequestName("Upload Blob","Panel "+this.GetDTTCaption()+": upload Blob",DTTRequest.PRI_CMD);this.Fields[c].EnterUploadMode(true);this.SetInfoMessage(this.MainFrm.RTCObj.GetConst("D47E7A4C-A11A-4170-B5FC-F9A8AACD4B9A","Indica nel campo il file da caricare sul server, poi premi ancora <img "+e+' src="images/upload.gif" alt=""> per confermare. Se lasci il campo vuoto, nessun file verrà caricato.'))}else{if(g=="seltog"){if(this.ShowMultipleSel()){this.set_ShowMultipleSel(false,true);this.SetRDRowSel(-1,true);this.MainFrm.DTTObj.SetRequestName("Show row selectors","Panel "+this.GetDTTCaption()+" show row selector",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANMSELTLB,"Panel "+this.GetDTTCaption()+" show row selectors","","chks");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Mostra i row selector del pannello "+this.GetDTTCaption()+" usando l'apposito comando")}else{this.set_ShowMultipleSel(true,true);this.MainFrm.DTTObj.SetRequestName("Hide row selectors","Panel "+this.GetDTTCaption()+" hide row selector",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANMSELTLB,"Panel "+this.GetDTTCaption()+" hide row selectors","","chks");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Mostra i checkbox delle righe del pannello "+this.GetDTTCaption()+" usando l'apposito comando")}this.SendPositions=true}else{if(g=="selnone"){this.ChangeSelection(0);this.MainFrm.DTTObj.SetRequestName("No rows selected","Panel "+this.GetDTTCaption()+" MultiSelRow",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANMSELTLB,"Panel "+this.GetDTTCaption()+" deselect all rows","","chkn");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"De-seleziona tutte le righe del pannello "+this.GetDTTCaption()+" usando l'apposito comando");this.SendPositions=true}else{if(g=="selall"){this.ChangeSelection(2);this.MainFrm.DTTObj.SetRequestName("All rows selected","Panel "+this.GetDTTCaption()+" MultiSelRow",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANMSELTLB,"Panel "+this.GetDTTCaption()+" select all rows","","chka");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona tutte le righe del pannello "+this.GetDTTCaption()+" usando l'apposito comando");this.SendPositions=true}else{if(g.startsWith("cb")){var a=0;var h=parseInt(g.substr(2),10);if(h>=8){switch(h){case 8:a=Glb.PCM_CUSTOM9;break;case 9:a=Glb.PCM_CUSTOM10;break;case 10:a=Glb.PCM_CUSTOM11;break;case 11:a=Glb.PCM_CUSTOM12;break;case 12:a=Glb.PCM_CUSTOM13;break;case 13:a=Glb.PCM_CUSTOM14;break;case 14:a=Glb.PCM_CUSTOM15;break;case 15:a=Glb.PCM_CUSTOM16;break}}else{a=Glb.PCM_CUSTOM1<<h}if(this.IsCommandEnabled(a)&&this.MainFrm.CustomCommands[h]!=null){this.MainFrm.DTTObj.SetRequestName("Command "+this.MainFrm.CustomCommands[h].Caption,"Panel "+this.GetDTTCaption()+": custom command "+this.MainFrm.CustomCommands[h].Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","cc"+(h+1));this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone "+this.MainFrm.CustomCommands[h].Caption+" nella toolbar del pannello "+this.GetDTTCaption()+" ("+this.MainFrm.CustomCommands[h].ToolTip+")");this.PanelCommand(a,0,true);this.SendPositions=false}}}}}}}}}}}}}}}}}}}}}}}}}}};IDPanelSrv.prototype.RD3Sort=function(d,g){this.RD3EndRequest();if(this.Fields[d].IdxPanel<0){this.MainFrm.DTTObj.SetRequestName("Activate Field","Panel "+this.GetDTTCaption()+": field "+this.Fields[d].GetDTTCaption()+" activated",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[d].iGuid,DTTEngine.TST_FLDACT,"Panel field "+this.Fields[d].GetDTTCaption()+" activation","","0act");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Attiva il campo "+this.Fields[d].GetDTTCaption()+(this.Layout()==Glb.PANEL_FORM?"":" della riga 1 nel panello "+this.GetDTTCaption()));this.Fields[d].Activate(0);return}var c=false;if(this.MainFrm.ParamsObj().PanelsSortAlways||this.UseListQBEHeader()||this.HasListVisibilityControl()){if(this.MainFrm.ParamsObj().Theme.equals("classic")){c=g>7}else{c=g<15}}else{c=this.Fields[d].SortMode<=0}var a=new IDVariant(false);this.FireOnSorting(d,a);if(a.isFalse()){if(!(this.GroupingEnabled()&&this.ShowGroups())){if(!this.MainFrm.ShiftKey()||(this.MainFrm.CtrlKey()&&!(this.UseListQBEHeader()||this.HasListVisibilityControl()))){this.ResetSortList()}if(this.MainFrm.CtrlKey()){if(this.UseListQBEHeader()||this.HasListVisibilityControl()){this.RemoveFromSortList(d)}this.MainFrm.DTTObj.SetRequestName("Reset Sort","Panel "+this.GetDTTCaption()+": reset sort",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[d].iGuid,DTTEngine.TST_PANSORT,"Panel "+this.GetDTTCaption()+" reset sort detected","","sort");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SORT sul campo  "+this.Fields[d].GetDTTCaption()+" nel pannello "+this.GetDTTCaption()+" tenendo premuto il tasto CTRL")}else{this.AddToSortList(d,c);this.MainFrm.DTTObj.SetRequestName("Sort Data","Panel "+this.GetDTTCaption()+": sort data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[d].iGuid,DTTEngine.TST_PANSORT,"Panel "+this.GetDTTCaption()+" sort detected","","sort");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SORT sul campo  "+this.Fields[d].GetDTTCaption()+" nel pannello "+this.GetDTTCaption()+(this.MainFrm.ShiftKey()?" tenendo premuto il tasto SHIFT":""))}this.EnableSorting();if(this.RefreshOnSort&&this.Queries[0].IMDBDataSource==-1){if(this.IsDO()){if(this.Queries[0].IDColl!=null&&(this.Queries[0].MaxRows>0||this.Queries[0].IDColl.MaxRows>0)&&this.Queries[0].IDColl.HasMoreElements&&!this.Queries[0].IDColl.IsModified()){this.Queries[0].DOSortCriteria=null;for(var b=0;b<this.SortingList.Count();b++){var e=this.SortingList[b];this.Queries[0].AddDOSortCriteria(e.SortMode*e.GetDOIdx(this.Queries[0].DocTempl))}this.RefreshQuery(this.MainFrm)}}else{if(this.Queries[0].MaxRows>0&&this.Queries[0].RecordCount()==this.Queries[0].MaxRows&&this.Status()==Glb.PS_DATA){var h=this.SortingListStr();if(h.length>0){h=" order by "+h}this.Queries[0].SetText(Glb.SQL_ORDERBY,h);this.EnterQBE();this.FindData(this.MainFrm,false,false)}}}}else{if((this.UseListQBEHeader()||this.HasListVisibilityControl())&&(g==10||g==20)){this.RemoveFromGroupingList(d);this.AddToSortList(d,c)}else{if(!this.MainFrm.ShiftKey()||(this.MainFrm.CtrlKey()&&!(this.UseListQBEHeader()||this.HasListVisibilityControl()))){this.ResetGroupList()}if(this.MainFrm.CtrlKey()){if(this.UseListQBEHeader()||this.HasListVisibilityControl()){this.RemoveFromSortList(d)}this.MainFrm.DTTObj.SetRequestName("Reset Grouping","Panel "+this.GetDTTCaption()+": reset grouping",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[d].iGuid,DTTEngine.TST_PANSORT,"Panel "+this.GetDTTCaption()+" reset grouping detected","","grouping");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SORT sul campo  "+this.Fields[d].GetDTTCaption()+" nel pannello "+this.GetDTTCaption()+" tenendo premuto il tasto CTRL");this.SendPositions=true}else{if((this.UseListQBEHeader()||this.HasListVisibilityControl())&&g==2){this.RemoveFromGroupingList(d)}else{if(this.UseListQBEHeader()||this.HasListVisibilityControl()){this.RemoveFromSortList(d)}this.AddToGroupingList(d,c);this.MainFrm.DTTObj.SetRequestName("Group Data","Panel "+this.GetDTTCaption()+": group data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[d].iGuid,DTTEngine.TST_PANSORT,"Panel "+this.GetDTTCaption()+" grouping detected","","grouping");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SORT sul campo  "+this.Fields[d].GetDTTCaption()+" nel pannello "+this.GetDTTCaption()+(this.MainFrm.ShiftKey()?" tenendo premuto il tasto SHIFT":""))}}this.RefreshGrouping(true)}}}};IDPanelSrv.prototype.RD3SelectPage=function(a){this.RD3EndRequest();var b=this.Page();for(var c=0;c<this.Pages.length;c++){if(this.Pages[c].GetRD3Ident().equals(a)){this.MainFrm.DTTObj.SetRequestName("Change Page","Panel "+this.GetDTTCaption()+": go to page "+this.Pages[c].Header,DTTRequest.PRI_CMD);this.set_Page(c);this.MainFrm.DTTObj.AddTestItem(this.Pages[c].iGuid,DTTEngine.TST_PANCHGPG,"Panel "+this.GetDTTCaption()+" change page","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone CHANGE-PAGE nella toolbar del pannello "+this.GetDTTCaption());if(this.PageClickEventDef==RD3Glb.EVENT_ACTIVE){if(this.Page()==b){this.RD3Change(RD3Glb.PAN_PANELPAGE)}}break}}};IDPanelSrv.prototype.RD3ValChange=function(a,f){var j=a.indexOf(":");var h=a.indexOf(":",j+1);var g=a.indexOf(":",h+1);var e=parseInt(a.substr(j+1,h-j-1),10);var b=parseInt(a.substr(h+1,g-h-1),10);if(this.Status()==Glb.PS_QBE){e=0}else{e-=this.Queries[0].GetAttRecNumber()}var c=this.Fields[b].ProcessRowChange(this.MainFrm,f,e);if(c){this.RD3Validate=true;this.SetModified(this.MainFrm);this.RD3SendChange=true}if(this.Fields[b].Values[e].Text.equals(f)&&((this.Fields[b].Flags&Glb.FLD_SUPERACTIVE)!=0)){this.Fields[b].Values[e].RD3Change(RD3Glb.VAL_TEXT,false);this.Fields[b].Values[e].RD3ResetChange()}if(this.Fields[b].IdxPanel>0){this.Parent.IdxFieldActived=b;for(var d=1;d<this.Queries.length;d++){if(this.Queries[d].UpdateLKE(this.MainFrm)){this.RD3Validate=true;this.SetModified(this.MainFrm)}}this.Parent.IdxFieldActived=0}return c};IDPanelSrv.prototype.RD3ValClick=function(f){this.RD3EndRequest();var e=f.indexOf(":");var d=f.indexOf(":",e+1);var c=f.indexOf(":",d+1);var a=parseInt(f.substr(e+1,d-e-1),10);var b=parseInt(f.substr(d+1,c-d-1),10);if(this.Status()==Glb.PS_QBE){a=0}else{a-=this.Queries[0].GetAttRecNumber()}this.MainFrm.DTTObj.SetRequestName("Activate Field","Panel "+this.GetDTTCaption()+": field "+this.Fields[b].GetDTTCaption()+" activated for row"+(a+1),DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[b].iGuid,DTTEngine.TST_FLDACT,"Panel field "+this.Fields[b].GetDTTCaption()+" activation","",a+"act");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Attiva il campo "+this.Fields[b].GetDTTCaption()+(this.Layout()==Glb.PANEL_FORM?"":" della riga "+(a+1))+" nel panello "+this.GetDTTCaption());this.Fields[b].Activate(a)};IDPanelSrv.prototype.RD3StartRequest=function(){this.RD3Validate=false;this.RD3ChangeSel=false;this.RD3ChangeListVis=false;this.NeedAutoSave=false;this.InfoPriority=0;this.SendPositions=false;this.ForceSendPosition=false};IDPanelSrv.prototype.RD3EndRequest=function(){if(this.RD3Validate&&this.IMDB!=null){var d=this.ReValidate();if(d){this.ReValidate()}if(d){this.IMDB.TblSetModified(this.MstTblIndex,Glb.GlbRefModIdx)}else{this.IMDB.TblResetModified(this.MstTblIndex,Glb.GlbRefModIdx)}if(this.RD3PropChg[RD3Glb.PAN_ACTUALROW]||this.RD3SendChange){this.Queries[0].UpdateIMDB(this.AttR,true,true,true)}this.RD3SendChange=false}if(this.RD3ChangeSel){var b=new IDVariant(0);this.FireOnChangeSelection(-1,false,true,true,b)}if(this.RD3ChangeListVis){this.FireOnFieldListVisibilityChanged(-1,false,true)}if(this.WasHidden){var c=false;if((this.Flags&Glb.PAN_FREEWHENHID)!=0){if(!this.Visible||this.Collapsed||!this.Exposed()){c=true}}if(!c){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": update performed for the first time (the panel was either invisible, collapsed or not exposed)");this.UpdatePanel(this.MainFrm);this.WasHidden=false}}if(this.NeedAutoSave){this.AutoSaveSamFl=true;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,165,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": Auto Saving")}this.UpdateRecords(this.MainFrm,true);this.AutoSaveSamFl=false;this.NeedAutoSave=false}for(var a=0;a<this.Fields.length;a++){this.Fields[a].ClearLastValue()}this.RD3Validate=false;this.RD3ChangeSel=false;this.RD3ChangeListVis=false};IDPanelSrv.prototype.RD3ChangeRow=function(b,a){this.RD3EndRequest();if(this.AttR!=b){this.Parent.ResetUpload()}this.AttR=b;if(this.IsShowingGrouping()&&this.GroupRoot!=null){var c=a-b;if(c<=0){this.AttR=(b+c)-1;c=1}this.set_ActualPosition(c);this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}this.MainFrm.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow due to Cursor change",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected","",this.AttR);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption());this.Queries[0].UpdateIMDB(this.AttR,true,true,true)};IDPanelSrv.prototype.ShowTool=function(){return this.ShowToolbar};IDPanelSrv.prototype.set_ShowTool=function(a){this.ShowToolbar=a;this.RD3Change(RD3Glb.PAN_SHOWTOOLBAR)};IDPanelSrv.prototype.ShowStatus=function(){return this.ShowStatusbar};IDPanelSrv.prototype.set_ShowStatus=function(a){this.ShowStatusbar=a;this.RD3Change(RD3Glb.PAN_SHOWSTATUSBAR)};IDPanelSrv.prototype.QbeTip=function(){return this.QBETip};IDPanelSrv.prototype.set_QbeTip=function(a){this.QBETip=a;this.QBETipText=a;this.RD3Change(RD3Glb.PAN_QBETIP)};IDPanelSrv.prototype.ActivateRightClk=function(){return this.ActivateRightClick};IDPanelSrv.prototype.set_ActivateRightClk=function(a){this.ActivateRightClick=a;this.RD3Change(RD3Glb.PAN_ACTIVATERIGHTCLICK)};IDPanelSrv.prototype.SetCommandBlocking=function(b,a){if(a){this.BlockingCommands|=b}else{this.BlockingCommands&=~b}this.RD3Change(RD3Glb.PAN_CMDBLOCK)};IDPanelSrv.prototype.CanReorderColumn=function(){return this.ReorderColumn};IDPanelSrv.prototype.set_CanReorderColumn=function(a){this.ReorderColumn=a;this.RD3Change(RD3Glb.PAN_REORDERCOLUMN)};IDPanelSrv.prototype.CanResizeColumn=function(){return this.ResizeColumn};IDPanelSrv.prototype.set_CanResizeColumn=function(a){this.ResizeColumn=a;this.RD3Change(RD3Glb.PAN_RESIZECOLUMN)};IDPanelSrv.prototype.RD3Resize=function(a,e,d){if(d=="top"){this.ListTop=a;this.CalcLayout()}else{if(d=="height"){var b=this.AttR;if(this.IsFluidPanel()){this.DesignListHeight=a}else{this.ListHeight=a}var j=this.NumRows;this.CalcLayout();if(j!=this.NumRows){var g=null;if(this.AttR>=0&&this.AttR<this.NumRows&&this.AttR==b){for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].bValues(this.AttR).Uploading){g=this.Fields[c]}}}this.ScrollRecBy(0,this.MainFrm);if(g!=null){g.bValues(this.AttR).Uploading=true}}}else{if(d=="listwidth"&&this.IsFluidPanel()){this.ListWidth=a}else{if(d=="dynrows"){this.UpdateDynRows(a)}else{WebFrameSrv.prototype.RD3Resize.call(this,a,e,d)}}}}};IDPanelSrv.prototype.RD3ClearLookups=function(){for(var b=0;b<this.NumRows;b++){for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].IdxPanel>0&&this.Fields[a].Values[b].Text.length>0){this.Fields[a].Values[b].RD3Change(RD3Glb.VAL_TEXT)}}}};IDPanelSrv.prototype.OnValueChange=function(e,c,d){if(this.RD3ListCache!=null&&e>=0&&e<this.RD3ListCache.length){var a=this.Queries[0].GetAttRecNumber()-1;if(e>=a&&e<a+this.NumRows){for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].RSIdx-1==c){if(!this.Fields[b].Values[e-a].Value.equals(d)){this.Fields[b].Values[e-a].SetValue(d)}this.Fields[b].Values[e-a].RD3Change(RD3Glb.VAL_TEXT);break}}}else{this.RD3ListCache[e]=false;this.RD3FormCache[e]=false}}};IDPanelSrv.prototype.GetAbsoluteRowPosition=function(){if(this.Queries[0].LookupRows!=null){return this.Queries[0].LookupRows[this.ActualPosition()-1]-1}else{return this.ActualPosition()-1}};IDPanelSrv.prototype.RD3SendMultiselection=function(){var e=0;var b=0;for(var a=0;a<this.SelectedRows.length;a++){if(this.SelectedRows[a]){e++}else{b++}}var g=(e>=b)?false:true;var c=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());c.CanSendInFulltree=true;c.SetAttribute("row","-1");c.SetAttribute("value",g?"0":"2");for(var a=0;a<this.SelectedRows.length;a++){if(this.SelectedRows[a]==g){var d=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());d.CanSendInFulltree=true;var f=a+1;d.SetAttribute("row",f.toString());d.SetAttribute("value",this.SelectedRows[a]?"1":"0")}}this.RD3Sendmulti=false};IDPanelSrv.prototype.RD3RawClick=function(b,j,h,m,f,l,e){var g=parseInt(e.GetAttribute("par4"),10);var a=parseInt(e.GetAttribute("par5"),10);var k=new IDVariant();if(this.MainFrm!=null){var d=(l)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(d,"Panel"+this.GetDTTCaption()+" "+d,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"IDPanel."+d,"Panel "+this.GetDTTCaption()+": firing event "+d)}if(l){this.Parent.OnMouseDoubleClick(this,new IDVariant(b),new IDVariant(j),new IDVariant(h),new IDVariant(m),new IDVariant(f),new IDVariant(g),new IDVariant(a),k)}else{this.Parent.OnMouseClick(this,new IDVariant(b),new IDVariant(j),new IDVariant(h),new IDVariant(m),new IDVariant(f),new IDVariant(g),new IDVariant(a),k)}return k.isTrue()};IDPanelSrv.prototype.RD3ReorderColumn=function(e,a){if(!this.IsAdvTabOrderEnabled()){this.InitTabOrder()}var f=null;var g=null;for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].GetRD3Ident().equals(e)){f=this.Fields[c]}if(this.Fields[c].GetRD3Ident().equals(a)){g=this.Fields[c]}}if(f!=null&&g!=null){var d=this.GetFieldIdxTabOrder(f.Index,Glb.PANEL_LIST)+1;this.MoveField(f.Index,g.Index,Glb.PANEL_LIST);var b=this.GetFieldIdxTabOrder(f.Index,Glb.PANEL_LIST)+1;if(this.FixedCols()!=0){if(d<=this.iFixedCols){if(b>this.iFixedCols){this.iFixedCols=this.iFixedCols>1?this.iFixedCols-1:this.iFixedCols}}else{if(b<=this.iFixedCols){this.iFixedCols=this.iFixedCols>=this.Fields.length-1?this.iFixedCols:this.iFixedCols+1}}}if(this.MainFrm!=null){this.MainFrm.DTTObj.SetRequestName("Column Reorder","Column Reorder",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,120,"IDPanel.OnReorderColum","Panel "+this.GetDTTCaption()+": Fire OnReorderColum Event")}this.Parent.OnReorderColum(this,new IDVariant(f.Index),new IDVariant(g.Index))}};IDPanelSrv.prototype.RD3ResizeColumn=function(b,a){var c=this.Fields[b].ListWidth;this.set_ObjRect(Glb.OBJ_FIELD,b,IDPanelSrv.RT_WIDTH,Glb.PANEL_LIST,a);this.Fields[b].UserChangedField=true;if(c!=this.Fields[b].ListWidth){if(this.MainFrm!=null){this.MainFrm.DTTObj.SetRequestName("Column Resize","Column Resize",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,121,"IDPanel.OnResizeColumn","Panel "+this.GetDTTCaption()+": Fire OnResizeColumn Event")}this.Parent.OnResizeColum(this,new IDVariant(b),new IDVariant(c))}};IDPanelSrv.prototype.PanelConfiguration=function(){var k=new XMLDoc();var h=k.AddNewElement("panel");h.SetAttribute("code",this.Code);h.SetAttribute("fcols",this.iFixedCols.toString());h.SetAttribute("width",this.Parent.Frames[this.FrIndex].Width.toString());h.SetAttribute("lwidth",this.ListWidth.toString());var c="";for(var d=0;d<this.SortingList.Count();d++){var g=this.SortingList[d];if(c.length>0){c+=","}if(g.Index==0&&g.SortMode!=1){c+=Number.MIN_VALUE}else{c+=(g.SortMode==1?"":"-")+g.Index}}h.SetAttribute("sort",c);for(var d=0;d<this.Groups.length;d++){var l=this.Groups[d];if(!l.Collapsible){continue}var a=h.AddNewElement("group");a.SetAttribute("guid",l.iGuid);a.SetAttribute("clp",l.Collapsed?"1":"0")}var b=0;var e=true;for(var d=0;d<this.Fields.length;d++){if(e||(this.Fields[d].Flags&Glb.FLD_INLIST)!=0||(this.Fields[d].Flags&Glb.FLD_INFORM)!=0){var j=this.Fields[d];var a=h.AddNewElement("field");a.SetAttribute("code",j.Code);a.SetAttribute("idxpan",j.IdxPanel.toString());a.SetAttribute("lw",j.ListWidth.toString());a.SetAttribute("vis",(j.Flags&Glb.OBJ_VISIBLE)==0?"0":"1");if(this.IsAdvTabOrderEnabled()){a.SetAttribute("ftab",this.GetFieldIdxTabOrder(j.Index,Glb.PANEL_FORM).toString());a.SetAttribute("ltab",this.GetFieldIdxTabOrder(j.Index,Glb.PANEL_LIST).toString())}else{a.SetAttribute("ftab",b.toString());a.SetAttribute("ltab",b.toString());b++}a.SetAttribute("fil",j.VisualFlag(Glb.PFLVISPROP_CANHDEINLST)?"1":"0");a.SetAttribute("sil",j.VisualFlag(Glb.PFLVISPROP_HIDEINLIST)?"1":"0")}e=false}return k.SaveToString()};function XMLFld(){this.Fld;this.FldIdx;this.ListWidth;this.TabOrd=new Array(2);this.Visible;this.Handled=false}IDPanelSrv.prototype.set_PanelConfiguration=function(d){try{if(d==null||d.length==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,170,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Parameter null or empty");return false}var I=new XMLDoc();I.LoadFromString(d);if(!I.HasNextNode()){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,200,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Empty XML document");return false}var x=I.GetNextNode();if(x!=null&&String.compare(x.Name(),"xml",true)==0){x=(I.HasNextNode()?I.GetNextNode():null)}if(x==null||String.compare(x.Name(),"panel",true)!=0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,200,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Missing Root node");return false}var q=x.GetAttribute("code");if(q==null||String.compare(q,this.Code,true)!=0){if(q==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,180,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Missing CODE node")}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,180,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": The given configuration is not for this panel (my code is "+this.Code+", the xml panel's code is "+q+")")}return false}var h=new ArrayList();while(x.HasNextNode()){var t=x.GetNextNode();if(String.compare(t.Name(),"group")==0){var F=t.GetAttribute("guid");for(var C=0;C<this.Groups.length;C++){var k=this.Groups[C];if(k.iGuid==F){k.Collapsed=(t.GetAttribute("clp")=="1");break}}}if(String.compare(t.Name(),"field")!=0){continue}var m=t.GetAttribute("code");var b=t.GetAttribute("idxpan");var r=this.FindField(m,(b.length>0?parseInt(b):-999));if(r!=-1){try{var D=new XMLFld();h.Add(D);D.Fld=this.Fields[r];D.FldIdx=r;D.ListWidth=parseInt(t.GetAttribute("lw"),10);D.TabOrd[Glb.PANEL_LIST]=parseInt(t.GetAttribute("ltab"),10);D.TabOrd[Glb.PANEL_FORM]=parseInt(t.GetAttribute("ftab"),10);D.Visible=t.GetAttribute("vis");if(t.GetAttribute("sil")){D.Fld.set_VisualFlag(Glb.PFLVISPROP_HIDEINLIST,t.GetAttribute("sil")=="1")}if(t.GetAttribute("fil")){D.Fld.set_VisualFlag(Glb.PFLVISPROP_CANHDEINLST,t.GetAttribute("fil")=="1")}}catch(E){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,189,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": some of the Field "+m+" attributes are not integer");return false}}else{if(m!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,189,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": the Field "+m+" does not exist anymore. Skipping field configuration...")}}}if(h.Count()!=this.Fields.length){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,196,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": the panel has a different number of fields with respect to the given configuration (FieldCount = "+this.Fields.length+", XML FieldCount = "+h.Count()+")")}if(h.Count()>0){if(!this.IsAdvTabOrderEnabled()){this.InitTabOrder()}for(var H=Glb.PANEL_LIST;H<=Glb.PANEL_FORM;H++){if(H==Glb.PANEL_FORM){for(var B=0;B<h.Count();B++){h[B].Handled=false}}var u=(H==Glb.PANEL_LIST?this.ListTabOrder:this.FormTabOrder);var a=null;while(true){var n=null;for(var B=0;B<h.Count();B++){var v=h[B];if(!v.Handled&&(n==null||v.TabOrd[H]<n.TabOrd[H])){n=v}}if(n==null){break}n.Handled=true;if(a!=null){var c=this.GetFieldIdxTabOrder(n.FldIdx,H);var y=this.GetFieldIdxTabOrder(a.FldIdx,H);for(var B=0;B<this.Fields.length-1;B++){if(B>=c){u[B]=u[B+1]}}u[this.Fields.length-1]=0;if(y>c){y--}for(var B=this.Fields.length-1;B>=0;B--){if(B>=y){u[B+1]=u[B]}}u[y+1]=n.FldIdx}if(H==Glb.PANEL_LIST){this.set_ObjRect(Glb.OBJ_FIELD,n.Fld.Index,IDPanelSrv.RT_WIDTH,Glb.PANEL_LIST,n.ListWidth);if(n.Visible.length>0){this.SetFlags(Glb.OBJ_FIELD,n.Fld.Index,n.Visible=="1"?Glb.OBJ_VISIBLE:0,Glb.OBJ_VISIBLE)}}a=n}}var A=true;for(var B=0;B<this.Fields.length;B++){if(!(A||(this.Fields[B].Flags&Glb.FLD_INLIST)!=0||(this.Fields[B].Flags&Glb.FLD_INFORM)!=0)){var o=-1;for(var z=0;z<this.ListTabOrder.length;z++){if(this.ListTabOrder[z]==B){o=this.ListTabOrder[z]}if(o!=-1&&z<this.ListTabOrder.length-1){this.ListTabOrder[z]=this.ListTabOrder[z+1]}}this.ListTabOrder[this.ListTabOrder.length-2]=o;o=-1;for(var z=0;z<this.FormTabOrder.length;z++){if(this.FormTabOrder[z]==B){o=this.FormTabOrder[z]}if(o!=-1&&z<this.FormTabOrder.length-1){this.FormTabOrder[z]=this.FormTabOrder[z+1]}}this.FormTabOrder[this.FormTabOrder.length-2]=o}A=false}this.CalcLayout()}try{var l=parseInt(x.GetAttribute("fcols"),10);this.iFixedCols=l}catch(E){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,198,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Invalid format while reading FixedColumns property from configuration");return false}if(x.HasAttribute("sort")){try{this.ResetSortList();if(x.GetAttribute("sort").length>0){var s=x.GetAttribute("sort").split(",");for(var B=0;B<s.length;B++){var G=parseInt(s[B],10);if(G==Number.MIN_VALUE){this.AddToSortList(0,false)}else{this.AddToSortList(Math.abs(G),G>=0)}}if(this.iStatus==Glb.PS_DATA){this.EnableSorting()}else{if(this.iStatus==Glb.PS_QBE){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,200,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Panel sorting will be applied when panel goes in DATA status (current status is QBE)");this.EnableSortAfterPanelConf=true}}}}catch(E){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,198,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Invalid format while reading SortCriterias property from configuration");return false}}if(x.HasAttribute("width")){try{this.set_ObjRect(Glb.OBJ_RECT,0,IDPanelSrv.RT_WIDTH,0,parseInt(x.GetAttribute("width"),10))}catch(E){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,198,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Invalid format while reading PanelWidth property from configuration");return false}}if(x.HasAttribute("lwidth")){try{this.ListWidth=parseInt(x.GetAttribute("lwidth"),10)}catch(E){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,198,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Invalid format while reading ListWidth property from configuration");return false}}return true}catch(E){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,210,"Panel.SetPanelConfiguration","Panel "+this.GetDTTCaption()+": Generic error. Message = "+E.message);return false}};IDPanelSrv.prototype.SaveRTCPanelConfiguration=function(){if(this.MainFrm==null){return}if(!this.MainFrm.RTCObj.Enabled){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,211,"name","Panel "+this.GetDTTCaption()+": SaveRTCPanelConfiguration - RTC not enabled");return}var b;var e;var a=new IDPreparedStatement();var d=new IDPreparedStatement();b="insert into RTCU_PanelFields (";b=b+" RTC_Guid";b=b+",RTC_Parent";b=b+",RTC_Language";b=b+",RTC_Group";b=b+",RTC_User";b=b+",RTC_Dim1";b=b+",RTC_TabOrder1";b=b+",RTC_TabOrder2";b=b+",RTC_Visible";b=b+",RTC_Hidden";b=b+",RTC_CanHide";b=b+") values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";e="update RTCU_PanelFields set ";e=e+" RTC_Dim1 = ?";e=e+",RTC_TabOrder1 = ?";e=e+",RTC_TabOrder2 = ?";e=e+",RTC_Visible = ?";e=e+",RTC_Hidden = ?";e=e+",RTC_CanHide = ?";e=e+" where RTC_Guid = ? AND RTC_Language  = ? AND RTC_Group  = ? AND RTC_User  = ?";a.SetCommand(b);d.SetCommand(e);this.MainFrm.OpenConnection(this.MainFrm.RTCObj.DB);var c=false;var f=this;this.MainFrm.RTCObj.DB.ExecuteTrans(function(){try{for(var h=0;h<f.Fields.length;h++){var l=f.Fields[h];if(l.UserChangedField&&((l.Flags&Glb.FLD_INLIST)!=0)&&((l.Flags&Glb.FLD_LISTLIST)!=0)){d.ClearParameters();d.AddParameter(new IDVariant(l.ListWidth));d.AddParameter(new IDVariant(f.GetFieldIdxTabOrder(l.Index,Glb.PANEL_FORM)));d.AddParameter(new IDVariant(f.GetFieldIdxTabOrder(l.Index,Glb.PANEL_LIST)));d.AddParameter(new IDVariant((l.Flags&Glb.OBJ_VISIBLE)==0?"N":"Y"));d.AddParameter(new IDVariant(l.VisualFlag(Glb.PFLVISPROP_HIDEINLIST)?"Y":"N"));d.AddParameter(new IDVariant(l.VisualFlag(Glb.PFLVISPROP_CANHDEINLST)?"Y":"N"));d.AddParameter(new IDVariant(l.iGuid));d.AddParameter(new IDVariant(f.MainFrm.RolObj.glbLanguage));d.AddParameter(new IDVariant(f.MainFrm.RolObj.glbGroup));d.AddParameter(new IDVariant(f.MainFrm.RolObj.glbUserID));f.MainFrm.RTCObj.DB.ExecuteIDPS(d,false);if(f.MainFrm.RTCObj.DB.RecordsAffected()==0){var j="";if(l.Group!=-1){j=f.Groups[l.Group].iGuid}else{if(l.Page!=-1){j=f.Pages[l.Page].iGuid}else{j=f.iGuid}}a.ClearParameters();a.AddParameter(new IDVariant(l.iGuid));a.AddParameter(new IDVariant(j));a.AddParameter(new IDVariant(f.MainFrm.RolObj.glbLanguage));a.AddParameter(new IDVariant(f.MainFrm.RolObj.glbGroup));a.AddParameter(new IDVariant(f.MainFrm.RolObj.glbUserID));a.AddParameter(new IDVariant(l.ListWidth));a.AddParameter(new IDVariant(f.GetFieldIdxTabOrder(l.Index,Glb.PANEL_FORM)));a.AddParameter(new IDVariant(f.GetFieldIdxTabOrder(l.Index,Glb.PANEL_LIST)));a.AddParameter(new IDVariant((l.Flags&Glb.OBJ_VISIBLE)==0?"N":"Y"));a.AddParameter(new IDVariant(l.VisualFlag(Glb.PFLVISPROP_HIDEINLIST)?"Y":"N"));a.AddParameter(new IDVariant(l.VisualFlag(Glb.PFLVISPROP_CANHDEINLST)?"Y":"N"));f.MainFrm.RTCObj.DB.ExecuteIDPS(a,false)}l.UserChangedField=false}}b="insert into RTCU_PanelGroups (";b=b+" RTC_Guid";b=b+",RTC_Parent";b=b+",RTC_Language";b=b+",RTC_Group";b=b+",RTC_User";b=b+",RTC_Collapsed";b=b+") values (?, ?, ?, ?, ?, ?)";e="update RTCU_PanelGroups set ";e=e+" RTC_Collapsed = ?";e=e+" where RTC_Guid = ? AND RTC_Language  = ? AND RTC_Group  = ? AND RTC_User  = ?";a.SetCommand(b);d.SetCommand(e);for(var h=0;h<Groups.Length;h++){var k=f.Groups[h];if(!k.Collapsible){continue}d.ClearParameters();d.AddParameter(new IDVariant(k.Collapsed?"Y":"N"));d.AddParameter(new IDVariant(k.iGuid));d.AddParameter(new IDVariant(f.MainFrm.RolObj.glbLanguage));d.AddParameter(new IDVariant(f.MainFrm.RolObj.glbGroup));d.AddParameter(new IDVariant(f.MainFrm.RolObj.glbUserID));f.MainFrm.RTCObj.DB.ExecuteIDPS(d,false);if(f.MainFrm.RTCObj.DB.RecordsAffected()==0){a.ClearParameters();a.AddParameter(new IDVariant(k.iGuid));a.AddParameter(new IDVariant(iGuid));a.AddParameter(new IDVariant(f.MainFrm.RolObj.glbLanguage));a.AddParameter(new IDVariant(f.MainFrm.RolObj.glbGroup));a.AddParameter(new IDVariant(f.MainFrm.RolObj.glbUserID));a.AddParameter(new IDVariant(k.Collapsed?"Y":"N"));f.MainFrm.RTCObj.DB.ExecuteIDPS(a,false)}}f.MainFrm.RTCObj.DB.CommitTrans();c=true;f.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.iGuid,212,"name","Panel "+f.GetDTTCaption()+": SaveRTCPanelConfiguration - RTC configuration saved")}catch(m){f.MainFrm.RTCObj.DB.RollbackTrans();f.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,f.iGuid,213,"name","Panel "+f.GetDTTCaption()+": SaveRTCPanelConfiguration - error while saving RTC configuration (err="+m.message+")")}finally{a.Close();d.Close()}},self);if(c){this.MainFrm.RTCObj.ReloadFields(this.Parent)}};IDPanelSrv.prototype.GenericDrag=function(a,m){var h=parseInt(a.GetAttribute("par1"),10);var q=a.GetAttribute("obn");var j=this.MainFrm.RD3FindField(q);if(this.EnableMultipleSel()&&this.ShowMultipleSel()){if(this.IsDO()){var l=this.Queries[0].IDColl;if(l!=null){for(var e=0;e<l.GetCollection().Count();e++){var k=l.GetCollection()[e];if(k.Selected()){this.GenericDropHelper(a,j,m,h,k)}}}}else{var n=this.AttR;var o=this.Queries[0].GetAttRecNumber();var g=true;for(var b=0;b<this.SelectedRows.length;b++){if(this.SelectedRows[b]){this.ScrollRecTo(b+1,this.MainFrm);this.AttR=0;this.Queries[0].UpdateIMDB(this.AttR,true,false,true);this.GenericDropHelper(a,j,m,h,null,n,o);g=false}}if(g){this.AttR=n;this.ScrollRecTo(o,this.MainFrm);this.Queries[0].UpdateIMDB(this.AttR,true,false,true)}}}else{this.GenericDropHelper(a,j,m,h,null)}};IDPanelSrv.prototype.GenericDropHelper=function(d,j,l,h,k,b,m){if(b==undefined){b=-1}if(m==undefined){m=-1}if(k==null){k=this.GetDocument()}this.MainFrm.ActivedDocument=k;if(this.MainFrm.ActivedDocument!=null){var c=this.MainFrm.ActivedDocument.GetMD();this.MainFrm.ActivedProperty=c.GetProp(j.GetDOIdx(this.MainFrm.ActivedDocument))}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"IDPanel.OnGenericDrag","Panel "+this.GetDTTCaption()+": firing event OnGenericDrag");var n=new IDVariant();this.Parent.OnGenericDrag(this,n,new IDVariant(h),new IDVariant(j.Index));if(l instanceof WebFrameSrv){var a=l;var e=d.GetAttribute("oid");if(e.startsWith("tab")&&a.Parent!=null&&a.FrIndex>-1&&a.Parent.Frames[a.FrIndex].InTabbed&&a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx]!=null){var g=a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx].Content;g.GenericDrop(d,n)}else{if(l instanceof IDPanelSrv&&b>=0&&m>0){this.AttR=b;this.ScrollRecTo(m,this.MainFrm);this.Queries[0].UpdateIMDB(this.AttR,true,false,true)}a.GenericDrop(d,n)}}if(l instanceof ACommandSrv){this.MainFrm.CmdObj.GenericDrop(l,n)}};IDPanelSrv.prototype.GenericDrop=function(c,o){var m=parseInt(c.GetAttribute("par4"),10);var l=parseInt(c.GetAttribute("par5"),10);var h=parseInt(c.GetAttribute("par1"),10);var s=parseInt(c.GetAttribute("par2"),10);var k=parseInt(c.GetAttribute("par3"),10);var e=c.GetAttribute("oid");var j=this.MainFrm.RD3FindField(e);var a=e.indexOf(":lv");var r=(a==-1)?-1:parseInt(e.substr(a+3),10);var b=(j==null)?-1:j.Index;this.MainFrm.DTTObj.SetRequestName("Generic Drop","Panel"+this.GetDTTCaption()+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"IDPanel.OnGenericDrop","Panel "+this.GetDTTCaption()+": firing event OnGenericDrop");var q=new IDVariant();var n=this.GetDocument(r);if(c.GetAttribute("par6")!=null&&this.IsShowingGrouping()&&this.Queries[0].IDColl!=null){var d=parseInt(c.GetAttribute("par6"));if(d<=this.Queries[0].RecordCount()){var g=this.Queries[0].IDColl.UIMode();if(!g){this.Queries[0].IDColl.set_UIMode(true)}this.Queries[0].IDColl.set_AbsolutePosition(d);n=this.Queries[0].IDColl.GetAt();if(!g){this.Queries[0].IDColl.set_UIMode(false)}}}this.Parent.OnGenericDrop(this,o,q,new IDVariant(h),new IDVariant(m),new IDVariant(l),new IDVariant(s),new IDVariant(k),new IDVariant(b),new IDVariant(r),n)};IDPanelSrv.prototype.ResetGroupList=function(){for(var b=0;b<this.GroupingList.Count();b++){var c=this.GroupingList[b];var a=c;if(c.SortFld!=-1){a=this.Fields[c.SortFld]}a.SortMode=0;a.GroupDirection=0;a.RD3Change(RD3Glb.FLD_SORTMODE);c.RD3Change(RD3Glb.FLD_SORTMODE);c.SortMode=0;c.GroupDirection=0}this.GroupingList.Clear()};IDPanelSrv.prototype.AddToGroupingList=function(d,c,e){if(e==undefined){e=-1}var b=this.Fields[d];var a=b;if(b.SortFld!=-1){a=this.Fields[b.SortFld]}if(a.IdxPanel!=0){return}if(this.GroupingList.IndexOf(b)==-1){this.GroupingList.Add(b)}a.GroupDirection=(c)?1:-1;b.GroupVS=e;b.GroupDirection=(c)?1:-1};IDPanelSrv.prototype.RemoveFromGroupingList=function(c){var b=this.Fields[c];var a=b;if(b.SortFld!=-1){a=this.Fields[b.SortFld]}if(a.IdxPanel!=0){return}if(this.GroupingList.IndexOf(b)>=0){this.GroupingList.Remove(b)}b.RD3Change(RD3Glb.FLD_SORTMODE);b.SortMode=0;b.GroupDirection=0;this.Fields[c].RD3Change(RD3Glb.FLD_SORTMODE);this.Fields[c].SortMode=0;this.Fields[c].GroupDirection=0};IDPanelSrv.prototype.GroupingEnabled=function(){return this.iEnabledGrouping};IDPanelSrv.prototype.set_GroupingEnabled=function(a){this.iEnabledGrouping=a;this.RD3Change(RD3Glb.PAN_GROUPING);if(a==false){this.GroupRoot=null;this.ResetGroupList();this.MainFrm.RD3AddEvent("rstgrp",this.GetRD3Ident());this.ResetRD3Cache();if(this.SortingList.Count()>0){this.EnableSorting()}}};IDPanelSrv.prototype.ShowGroups=function(){return this.iShowGroups};IDPanelSrv.prototype.set_ShowGroups=function(b){this.iShowGroups=b;this.RD3Change(RD3Glb.PAN_SHOWGROUPUI);if(!this.GroupingEnabled()){return}if(b){for(var a=0;a<this.SortingList.Count();a++){var d=this.SortingList[a];this.AddToGroupingList(d.Index,d.SortMode>0)}this.SortingList.Clear()}else{for(var a=0;a<this.GroupingList.Count();a++){var c=this.GroupingList[a];this.AddToSortList(c.Index,c.SortMode>0)}this.GroupingList.Clear()}};IDPanelSrv.prototype.RefreshGrouping=function(d){if(!this.GroupingEnabled()||!this.ShowGroups()){return}if(this.iStatus!=Glb.PS_DATA){return}for(var b=0;b<this.GroupingList.Count();b++){var c=this.GroupingList[b];var a=c;if(c.SortFld!=-1){a=this.Fields[c.SortFld]}a.SortMode=a.GroupDirection;a.RD3Change(RD3Glb.FLD_SORTMODE);c.RD3Change(RD3Glb.FLD_SORTMODE);c.SortMode=c.GroupDirection}if(d){this.EnableSorting()}this.CreateGroups();this.ResetRD3Cache();this.MainFrm.RD3AddEvent("rstgrp",this.GetRD3Ident())};IDPanelSrv.prototype.AddGroupInterval=function(b,e,a,d){var f=this.Fields[b];var c=f;if(f.SortFld!=-1){c=this.Fields[f.SortFld]}if(c.IdxPanel!=0){return}if(this.GroupingList.IndexOf(f)==-1){return}f.AddGroupInterval(e,a,d)};IDPanelSrv.prototype.ResetGroupIntervals=function(a){var b=this.Fields[a];if(this.GroupingList.IndexOf(b)==-1){return}b.ResetGroupIntervals()};IDPanelSrv.prototype.IsShowingGrouping=function(){return(this.GroupingEnabled()&&this.GroupRoot!=null&&this.ShowGroups()&&this.Status()!=Glb.PS_QBE&&this.PanelMode==Glb.PANEL_LIST&&this.GroupingList.Count()>0)};IDPanelSrv.prototype.SetGroupAggregation=function(a,c,b){if(b==undefined){b=new IDVariant()}var d=this.Fields[a];d.GroupAggregation=c;d.GroupAggrLabel=b};IDPanelSrv.prototype.FireOnExpandingGroup=function(a,b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,57,"IDPanel.FireOnExpandingGroup","Panel "+this.GetDTTCaption()+": Fire FireOnExpandingGroup Event")}this.Parent.OnExpandingGroup(this,a,b)};IDPanelSrv.prototype.HandleGrouping=function(){this.set_ShowGroups(!this.ShowGroups());if(!this.ShowGroups()){this.MainFrm.RD3AddEvent("rstgrp",this.GetRD3Ident());this.ResetRD3Cache();var a=this.ActualPosition();this.set_ActualPosition(this.ActualPosition()-this.NumRows);this.set_SelectedRow(0);this.set_ActualPosition(a);this.RD3Change(RD3Glb.PAN_ACTUALROW);this.RD3Change(RD3Glb.PAN_ACTUALPOSITION);this.SendPositions=true}else{if(this.GroupRoot!=null||this.GroupingList.Count()>0){this.RefreshGrouping(true)}}};IDPanelSrv.prototype.RD3ExpandGroup=function(b,c){if(!this.GroupingEnabled()||!this.ShowGroups()||this.GroupRoot==null){return}var d=this.ActualPosition();var a=this.AttR;this.GroupRoot.RD3ExpandGroups(b,c,this.ActualPosition()+this.AttR);this.set_ActualPosition(d-a);this.set_SelectedRow(a);this.SendPositions=true};IDPanelSrv.prototype.RD3ExpandGroupByLevel=function(c){if(!this.GroupingEnabled()||!this.ShowGroups()||this.GroupRoot==null){return}var b=this.ActualPosition();var a=this.AttR;this.GroupRoot.RD3ExpandGroupByLevel(c-1);this.set_ActualPosition(b-a);this.set_SelectedRow(a);this.SendPositions=true};IDPanelSrv.prototype.CreateGroups=function(){var a=null;if(this.GroupingList.Count()>0){a=new PListGroupSrv(this);a.iStartingRecord=1;a.iEndingRecord=this.GetNumRows();a.iExpanded=true}if(a==null){return}var c=this.GroupRoot;this.GroupRoot=a;this.DisableNotification=true;this.DisableLookups=true;var e=this.ActualPosition();var b=this.AttR;this.set_SelectedRow(0);for(var d=1;d<=this.Queries[0].RecordCount();d++){this.set_ActualPosition(d);a.GenerateGroups()}this.DisableLookups=false;this.set_ActualPosition(e-b);this.set_SelectedRow(b);this.DisableNotification=false;this.RD3Change(RD3Glb.PAN_SENDGROUPS);this.GroupRoot.MantainStatus(c)};IDPanelSrv.prototype.GetDecodingField=function(c){for(var e=1;e<this.Queries.length;e++){var h=true;for(var d=0;d<this.Queries[e].LookupParams.Count();d++){var b=this.Queries[e].LookupParams[d];var g=false;if(b.MstField!=null){if(b.MstField==c){g=true}h&=g}}if(h){for(var f=0;f<this.Fields.length;f++){var a=this.Fields[f];if(a.IdxPanel==e&&a.IsVisible(this.AttR,false)){return a}}}}return c};IDPanelSrv.prototype.ExportHeader=function(){return this.ExportLabel};IDPanelSrv.prototype.set_ExportHeader=function(a){this.ExportLabel=a};IDPanelSrv.prototype.FieldTextSelectionChanged=function(b,g,a){var e=this.Fields[b];var d=new IDVariant(e.selStart);var c=new IDVariant(e.selEnd);e.selStart=g;e.selEnd=a;this.Parent.OnChangeTextSelection(this,new IDVariant(b),d,c)};IDPanelSrv.prototype.OnRD3ClientFocus=function(a,b){this.Parent.OnFocus(this,new IDVariant(a),new IDVariant(b))};IDPanelSrv.prototype.OnRD3ClientMouseOver=function(a,b){if(b<0||b>=this.NumRows){return}this.ValidatingRow=b;if(b!=this.AttR){this.Queries[0].UpdateIMDB(b,true,false,false)}this.Parent.OnMouseOver(this,new IDVariant(a),new IDVariant(b));this.ValidatingRow=-1;if(b!=this.AttR){this.Queries[0].UpdateIMDB(this.AttR,true,false,false)}};IDPanelSrv.prototype.BackgroundColor=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].BackColor}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastBackColor;if(a==-1){a=this.Fields[b].BackColor}return a}};IDPanelSrv.prototype.set_BackgroundColor=function(b,a){this.Fields[b].SetBackgroundColor(a)};IDPanelSrv.prototype.ForegroundColor=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].ForeColor}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastForeColor;if(a==-1){a=this.Fields[b].ForeColor}return a}};IDPanelSrv.prototype.set_ForegroundColor=function(b,a){this.Fields[b].SetForegroundColor(a)};IDPanelSrv.prototype.FontModifiers=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].FontMod}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastFontMod;if(a==null||a.length==0){a=this.Fields[b].FontMod}return a}};IDPanelSrv.prototype.set_FontModifiers=function(b,a){this.Fields[b].SetFontModifiers(a)};IDPanelSrv.prototype.Mask=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].Mask}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastMask;if(a==null||a.length==0){a=this.Fields[b].Mask}return a}};IDPanelSrv.prototype.set_Mask=function(b,a){this.Fields[b].SetMask(a)};IDPanelSrv.prototype.Alignment=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].Alignment}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastAlignment;if(a==-1){a=this.Fields[b].Alignment}return a}};IDPanelSrv.prototype.set_Alignment=function(b,a){this.Fields[b].SetAlignment(a)};IDPanelSrv.prototype.Watermark=function(a){return this.Fields[a].WaterMark()};IDPanelSrv.prototype.set_Watermark=function(b,a){this.Fields[b].set_WaterMark(a)};IDPanelSrv.prototype.FireGetLKE=function(b,c,f,a,e,d){this.Parent.OnGetLKE(this,b,c,f,a,e,d)};IDPanelSrv.prototype.OpenFieldComboBox=function(a){this.Fields[a].RD3Change(RD3Glb.FLD_OPENCOMBO);this.SetInput(-1,a,2)};IDPanelSrv.prototype.OpenFieldQBEFilterPopup=function(a){if(this.UseListQBEEnabled()){this.Fields[a].RD3Change(RD3Glb.FLD_OPENQBEFILTERPOPUP)}};IDPanelSrv.prototype.AddField=function(o,a,q,g,b,m,e,u,k,j,n){if(n==undefined){n=-1}var s=this.Fields.length;var t=new Array(s+1);this.Fields.copyTo(t,0);this.Fields=t;if(this.IsAdvTabOrderEnabled()){if(this.FormTabOrder!=null){this.FormTabOrder[s+1]=0;this.FormTabOrder[s+2]=0}if(this.ListTabOrder!=null){this.ListTabOrder[s+1]=0;this.ListTabOrder[s+2]=0}}this.Fields[s]=new PFieldSrv();this.Fields[s].Index=s;this.Fields[s].Parent=this;this.Fields[s].set_MultiSelectionComboBox(this.MainFrm.ParamsObj().MultiSelectionComboBox);this.set_Header(Glb.OBJ_FIELD,s,o);this.SetFieldPage(s,n,j);this.SetFlags(Glb.OBJ_FIELD,s,m,-1);this.SetNumRow(Glb.OBJ_FIELD,s,Glb.PANEL_LIST,e);this.SetNumRow(Glb.OBJ_FIELD,s,Glb.PANEL_FORM,e);this.SetFieldPanel(s,k,a,a,q,g,b,-13997);if(u==-1){u=this.MainFrm.VisualStyleList.GetVS("2CBA05B9-623A-11D4-BDF0-301B4CC10101")}this.set_VisualStyle(Glb.OBJ_FIELD,s,u);this.IMDB.TblDelete(this.MstTblIndex,0);if(s>=this.IMDB.TblNumField(this.MstTblIndex)){var h=this.IMDB.add_TblField(this.MstTblIndex);this.IMDB.set_FldCode(this.MstTblIndex,h,a);this.IMDB.SetFldParams(this.MstTblIndex,h,q,g,b)}else{this.IMDB.set_FldCode(this.MstTblIndex,s,a);this.IMDB.SetFldParams(this.MstTblIndex,s,q,g,b)}this.IMDB.TblAddNew(this.MstTblIndex,0);if(this.IsAdvTabOrderEnabled()){var r=false;var c=0;if(this.ListTabOrder!=null){for(var l=0;l<this.ListTabOrder.length;l++){if(r){var d=this.ListTabOrder[l];this.ListTabOrder[l]=c;c=d}if((this.Fields[this.ListTabOrder[l]].Flags&Glb.FLD_INLIST)==0&&(this.Fields[this.ListTabOrder[l]].Flags&Glb.FLD_INFORM)==0&&!r&&l>0){c=this.ListTabOrder[l];this.ListTabOrder[l]=s;r=true}}if(!r){for(var l=1;l<this.ListTabOrder.length;l++){if(this.ListTabOrder[l]==0){this.ListTabOrder[l]=s;break}}}}r=false;c=0;if(this.FormTabOrder!=null){for(var l=0;l<this.FormTabOrder.length;l++){if(r){var d=this.FormTabOrder[l];this.FormTabOrder[l]=c;c=d}if((this.Fields[this.FormTabOrder[l]].Flags&Glb.FLD_INLIST)==0&&(this.Fields[this.FormTabOrder[l]].Flags&Glb.FLD_INFORM)==0&&!r&&l>0){c=this.FormTabOrder[l];this.FormTabOrder[l]=s;r=true}}if(!r){for(var l=1;l<this.FormTabOrder.length;l++){if(this.FormTabOrder[l]==0){this.FormTabOrder[l]=s;break}}}}}return s};IDPanelSrv.prototype.AddGroup=function(e,h,d,a){var b=-1;switch(e){case Glb.OBJ_PAGE:b=this.Pages.length;var f=new Array(b+1);this.Pages.copyTo(f,0);this.Pages=f;this.Pages[b]=new PPageSrv();this.Pages[b].Index=b;this.Pages[b].Parent=this;this.set_Header(Glb.OBJ_PAGE,b,h);this.SetFlags(Glb.OBJ_PAGE,b,d,-1);this.set_VisualStyle(Glb.OBJ_PAGE,b,a);break;case Glb.OBJ_GROUP:b=this.Groups.length;var c=new Array(b+1);this.Groups.copyTo(c,0);this.Groups=c;this.Groups[b]=new PGroupSrv();this.Groups[b].Index=b;this.Groups[b].Parent=this;this.Groups[b].set_Collapsible(this.MainFrm.ParamsObj().UseCollapsableGroups);this.set_Header(Glb.OBJ_GROUP,b,h);this.SetFlags(Glb.OBJ_GROUP,b,d,-1);this.set_VisualStyle(Glb.OBJ_GROUP,b,a);break}return b};IDPanelSrv.prototype.OnSearchBox=function(a){var b=IDVariant.FALSE;if(b==IDVariant.FALSE){this.DoSearch(a)}};IDPanelSrv.prototype.DoSearch=function(a){this.PanelCommand(Glb.PCM_SEARCH);if(this.iSearchBoxMobileFld>=0&&this.iSearchBoxMobileFld<this.Fields.length){this.set_QBEFilter(this.iSearchBoxMobileFld,a,false)}else{for(var b=0;b<this.Fields.length;b++){var d=this.Fields[b];var c=(this.VS.Mask(d.VisualStyle)=="="||d.Mask=="=");if((d.Flags&Glb.FLD_INLIST)!=0&&(d.Flags&Glb.FLD_LISTLIST)!=0&&Glb.ClassDT(d.DataType)==Glb.DTC_CHAR&&!c){this.set_QBEFilter(b,a,false);break}}}this.PanelCommand(Glb.PCM_FIND)};IDPanelSrv.prototype.set_SearchBoxMobileFld=function(a){this.iSearchBoxMobileFld=a};IDPanelSrv.prototype.SearchBoxMobileFld=function(){return this.iSearchBoxMobileFld};IDPanelSrv.prototype.RD3MoreRows=function(){if(this.Status()==Glb.PS_DATA&&this.Queries[0].RecordCount()>this.DynamicRows){var a=this.DynamicRows+this.OrgDynRows;this.SetDynRows(a,this.DynamicHeight)}};IDPanelSrv.prototype.VisualFlag=function(a){return((this.iVisualFlags&a)!=0)};IDPanelSrv.prototype.set_VisualFlag=function(a,b){if((this.iVisualFlags&a)!=(b?a:0)){this.iVisualFlags=(this.iVisualFlags&(~a))|(b?a:0);this.RD3Change(RD3Glb.PAN_VISPROP)}};IDPanelSrv.prototype.Badge=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].iBadge}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastBadge;if(a==null||a.length==0){a=this.Fields[b].iBadge}return a}};IDPanelSrv.prototype.set_Badge=function(b,a){this.Fields[b].SetBadge(a)};IDPanelSrv.prototype.FldClassName=function(a){return this.Fields[a].ClassName()};IDPanelSrv.prototype.set_FldClassName=function(b,a){this.Fields[b].set_ClassName(a)};IDPanelSrv.prototype.GrpClassName=function(a){return this.Groups[a].ClassName()};IDPanelSrv.prototype.set_GrpClassName=function(b,a){this.Groups[b].set_ClassName(a)};IDPanelSrv.prototype.MaxLKERows=function(a){return new IDVariant(this.Fields[a].maxLKERows)};IDPanelSrv.prototype.set_MaxLKERows=function(b,a){this.Fields[b].maxLKERows=a.intValue()};IDPanelSrv.prototype.FieldAggregateFunction=function(a){return this.Fields[a].AggregateFunction};IDPanelSrv.prototype.set_FieldAggregateFunction=function(b,a){this.Fields[b].AggregateFunction=a};IDPanelSrv.prototype.SetSumField=function(b,a){this.Fields[b].AggregateOfField=a};IDPanelSrv.prototype.UpdateAggregateFields=function(){for(var a=0;a<this.Fields.length;a++){var b=this.Fields[a];if(b.AggregateOfField>=0){this.set_FieldText(b.Index,this.GetFieldAggregate(b.AggregateOfField,b.AggregateFunction).stringValue())}}};IDPanelSrv.prototype.RD3ListQBE=function(z,k){if(this.iStatus!=Glb.PS_DATA||!this.UseListQBEEnabled()){return}var v=this.iUseListQBE;this.iUseListQBE=0;this.PanelCommand(Glb.PCM_SEARCH);this.iUseListQBE=v;if(this.Fields[z].IdxPanel>0&&this.Queries[this.Fields[z].IdxPanel].LKEParams!=null){try{var a=this.Fields[z];var r=this.Queries[a.IdxPanel].LKEParams;for(var s=0;s<r.Count();s++){var t=r[s];var o=this.Fields[t.FldIdx];var u="";var f=0;while(k.indexOf(o.GetRD3Ident()+"#",f)>-1){var g="";var q=k.indexOf(o.GetRD3Ident()+"#",f);var j=o.GetRD3Ident().length+1;var d=k.indexOf("||fld",q);var b=k.indexOf("@#@",q);if(d==-1&&b==-1){g=k.substring(q+j)}else{if(d==-1){g=k.substring(q+j,b)}else{if(b==-1){g=k.substring(q+j,d)}else{if(d<b){g=k.substring(q+j,d)}else{if(b<d){g=k.substring(q+j,b)}}}}}if(g.length>0){u+=(u.length==0?"":o.GetQBESep())+g}f=q+j}this.set_QBEFilter(t.FldIdx,u);if(o.GetQBESep()==";"){u=u.replace(/;/g,"; ")}for(var l=1;l<this.Queries.length;l++){var c=false;for(var x=0;x<this.Queries[l].LookupParams.length;x++){var m=this.Queries[l].LookupParams[x];if(m.MstField==o){c=true}}if(c){for(var n=0;n<this.Fields.length;n++){var h=this.Fields[n];if(h.IdxPanel==l&&h.IsVisible(this.AttR,false)){h.bValues(this.AttR).Value=new IDVariant(u);this.Queries[l].UpdateLookup(-1,this.MainFrm);break}}}}}}catch(y){this.PanelCommand(Glb.PCM_FIND);throw y}}else{this.set_QBEFilter(z,k)}this.PanelCommand(Glb.PCM_FIND)};IDPanelSrv.prototype.RD3ClearAllListQBE=function(){if(this.iStatus!=Glb.PS_DATA||!this.UseListQBEEnabled()){return}var b=this.iUseListQBE;this.iUseListQBE=0;this.PanelCommand(Glb.PCM_SEARCH);this.iUseListQBE=b;this.PanelCommand(Glb.PCM_CANCEL);this.PanelCommand(Glb.PCM_FIND);for(var a=0;a<this.UFields();a++){if((this.bFields(a).Flags&Glb.FLD_LISTLIST)!=0){this.bFields(a).RD3Change(RD3Glb.FLD_QBEFILTER)}}};IDPanelSrv.prototype.LoadMoreRows=function(){if(this.Queries[0]==null){return}if(this.Status()==Glb.PS_UPDATE){return}if(this.LoadingPolicy()==0){return}if(this.Status()==Glb.PS_DATA&&this.Queries[0].IsDO){var b=false;if(this.Queries[0].IDColl!=null){b=this.Queries[0].IDColl.IsModified()}else{var c=this.GetDocument();if(c!=null){b=c.IsModified()}}if(b){return}}var a=(this.IsDO()&&this.Queries[0].IDColl!=null?this.Queries[0].IDColl.MaxRows:this.Queries[0].MaxRows);if(a>0){if(this.IsDO()?this.Queries[0].IDColl!=null&&this.Queries[0].IDColl.HasMoreElements:this.Queries[0].RecordCount()==a){if(this.MaxRowsOrg==0){this.MaxRowsOrg=a}this.Queries[0].MaxRows=a+this.MaxRowsOrg;this.RefreshQuery(this.MainFrm)}}};IDPanelSrv.prototype.HasListVisibilityControl=function(){for(var a=0;a<this.Fields.length;a++){if((this.Fields[a].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[a].Flags&Glb.FLD_LISTLIST)>0&&this.Fields[a].VisualFlag(Glb.PFLVISPROP_CANHDEINLST)){return true}}return false};IDPanelSrv.prototype.RD3FldChangedShowList=function(a,b){if(a.VisualFlag(Glb.PFLVISPROP_HIDEINLIST)!=b&&a.VisualFlag(Glb.PFLVISPROP_CANHDEINLST)){this.MainFrm.DTTObj.SetRequestName("Change List Layout","Panel "+this.GetDTTCaption()+" changed list layout",DTTRequest.PRI_DATA);this.RD3ChangeListVis=true;a.set_VisualFlag(Glb.PFLVISPROP_HIDEINLIST,b);a.UserChangedField=true;this.FireOnFieldListVisibilityChanged(a.Index,b,false)}};IDPanelSrv.prototype.FireOnFieldListVisibilityChanged=function(a,b,c){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,199,"IDPanel.FireOnFieldListVisibilityChanged","Panel "+this.GetDTTCaption()+": Fire OnFieldListVisibilityChanged Event")}this.Parent.OnFieldListVisibilityChanged(this,new IDVariant(a),new IDVariant(b),new IDVariant(c))};IDPanelSrv.prototype.IsFluidPanel=function(){return this.FluidPanel};IDPanelSrv.prototype.set_RowHeightResize=function(a){if(this.MainFrm.ParamsObj().UseFluid){if(this.iRowHeightResize!=a){this.iRowHeightResize=a;this.RD3Change(RD3Glb.PAN_ROWHEIGTHRES)}}else{if(this.MainFrm.BrowserInfo()==1){a=false}if(this.FluidPanel!=a){this.FluidPanel=a;this.RD3Change(RD3Glb.PAN_FLUIDPANEL);if(this.DynamicRows==0){this.SetDynRows(30,false)}}}};IDPanelSrv.prototype.RowHeightResize=function(){if(this.MainFrm.ParamsObj().UseFluid){return this.iRowHeightResize}else{return this.FluidPanel}};IDPanelSrv.prototype.GetSmartTargetFields=function(f){var a=new IDArray();if(f<0||f>=this.UFields()){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,199,"IDPanel.GetSmartTargetFields","Panel "+this.GetDTTCaption()+": Invalid field index (must be between 0 and "+this.UFields()+")");return null}var d=this.bFields(f);if(d.IdxPanel<=0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,199,"IDPanel.GetSmartTargetFields","Panel "+this.GetDTTCaption()+": Can't get target fields because the field "+d.GetDTTCaption()+" is not a smart lookup one");return null}var b=this.Queries[d.IdxPanel].LKEParams;for(var c=0;c<b.Count();c++){var e=b[c];a.add_Value(new IDVariant(e.FldIdx))}return a};function ImdbInitSrv(a){this.IMDB=new IMDBObjSrv();this.MainFrm=a}ImdbInitSrv.prototype.AppendTo=function(a){};function IndHandlerSrv(a){this.Indicators=new Array();this.MainFrm=a;this.SystemIndicator=0;if(a!=undefined){if(a.ParamsObj().MAX_INDICATORS>0){this.Indicators=new Array(a.ParamsObj().MAX_INDICATORS+1)}}}IndHandlerSrv.FilledTo=0;IndHandlerSrv.prototype.AppendTo=function(a){};IndHandlerSrv.prototype.set_Enabled=function(a,b){this.Indicators[a].set_bEnabled(this.MainFrm.ActiveFormIdx(),b)};IndHandlerSrv.prototype.set_Text=function(b,a){this.Indicators[b].set_bText(this.MainFrm.ActiveFormIdx(),a)};IndHandlerSrv.prototype.set_Visible=function(a,b){this.Indicators[a].set_bVisible(this.MainFrm.ActiveFormIdx(),b)};IndHandlerSrv.prototype.set_Image=function(a,b){this.Indicators[a].set_bImage(this.MainFrm.ActiveFormIdx(),b)};IndHandlerSrv.prototype.Enabled=function(a){return this.Indicators[a].bEnabled(this.MainFrm.ActiveFormIdx())};IndHandlerSrv.prototype.Text=function(a){return this.Indicators[a].bText(this.MainFrm.ActiveFormIdx())};IndHandlerSrv.prototype.Visible=function(a){return this.Indicators[a].bVisible(this.MainFrm.ActiveFormIdx())};IndHandlerSrv.prototype.Image=function(a){return this.Indicators[a].bImage(this.MainFrm.ActiveFormIdx())};IndHandlerSrv.prototype.SetSysMsg=function(a,b){if(b==undefined){b=""}if(this.SystemIndicator>0){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",21,"IndicatorHandler.SystemMessage","Set message to: "+a+(b.length>0?"(Img="+b+")":""))}this.set_Text(this.SystemIndicator,a);this.set_Image(this.SystemIndicator,b)}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",22,"IndicatorHandler.SystemMessage","Message "+a+" not added: Indicator Panel not found")}}};IndHandlerSrv.prototype.GetRD3Name=function(){return"inh"};IndHandlerSrv.prototype.RD3RenderDifferences=function(c,f){if(this.Indicators.length==0){return false}var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}else{for(var b=0;b<this.Indicators.length;b++){if(this.Indicators[b]!=null&&this.Indicators[b].RD3NewObj){e=c.AddNewElement("ins");e.SetAttribute("parid",this.GetRD3Name());break}}}var d=false;var a=(f)?e:c;for(var b=1;b<this.Indicators.length;b++){if(this.Indicators[b]==null){continue}if(this.Indicators[b].RD3NewObj){this.Indicators[b].RD3RenderDifferences(e,true);this.Indicators[b].RD3NewObj=false}else{d|=this.Indicators[b].RD3RenderDifferences(a,f)}}return d};function OBookSrv(a){WebFrameSrv.call(this,a);this.BookObj;this.ShowToolbar=true;this.ShowStatusBar=true;this.LastPage=0;this.WasHidden=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.BOK_MAXPROPS);this.RD3PageCache=new HashTableSrv();this.RD3DeletePage=-1;this.ToolbarEventDef=RD3Glb.EVENT_ACTIVE;this.ChangePageAnimationDef=null}OBookSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];OBookSrv[obj]=WebFrameSrv[obj]}OBookSrv.prototype.HasCaptionCommands=function(){return this.ShowToolbar};OBookSrv.prototype.ProcessRequest=function(c,b){var a=this.MainFrm;var e=this.BookObj.FrIndex();if(c.PreviewBook!=null){var d=a.GetParameter("col"+e+".x");if(d!=null&&d.length>0){c.PreviewBook=null;a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",110,"ABook.ProcessRequest","Book "+this.BookObj.GetName()+": preview closed");a.DTTObj.SetRequestName("Book Close Preview","Book "+this.BookObj.GetName()+": preview closed",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book "+this.BookObj.GetName()+" preview closed","","col");a.DTTObj.AddHelpItem(0,0,0,0,"Chiudi la preview del book "+this.BookObj.GetName());return}}if(!b){var d=a.GetParameter("top"+e+".x");if(d!=null&&d.length>0){a.DTTObj.SetRequestName("Book First Page","Book "+this.BookObj.GetName()+": Go to first page",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to first","","top");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone TOP nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,0,true)}d=a.GetParameter("bottom"+e+".x");if(d!=null&&d.length>0){a.DTTObj.SetRequestName("Book Last Page","Book "+this.BookObj.GetName()+": Go to last page",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to last","","bottom");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone BOTTOM nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,1,true)}d=a.GetParameter("next"+e+".x");if(d!=null&&d.length>0){a.DTTObj.SetRequestName("Book Next Page","Book "+this.BookObj.GetName()+": Go to next page",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to next","","next");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone NEXT nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,3,true)}d=a.GetParameter("prev"+e+".x");if(d!=null&&d.length>0&&this.BookObj.GetPageNumber()>1){a.DTTObj.SetRequestName("Book Previous Page","Book "+this.BookObj.GetName()+": Go to previous page",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to prev","","prev");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PREVIOUS nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,2,true)}d=a.GetParameter("print"+e+".x");if(d!=null&&d.length>0){a.DTTObj.SetRequestName("Book Print","Book "+this.BookObj.GetName()+": printing to PDF file",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book print","","print");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PRINT nella toolbar del book");this.BookCommand(IDREGlb.BCM_PRINT,0,true)}}this.BookObj.ProcessRequest(a,b)};OBookSrv.prototype.Resize=function(d,b){var c=this.BookObj.HideBorder()?8:0;var a=this.BookObj.HideBorder()?8:0;WebFrameSrv.prototype.Resize.call(this,d,b);this.BookObj.SetSize(d-c,b-a)};OBookSrv.prototype.InitDefMasks=function(){this.BookObj.SetDefaultMasks(this.Parent.MainFrm.ParamsObj().DefaultCurrencyMask,this.Parent.MainFrm.ParamsObj().DefaultFloatMask,this.Parent.MainFrm.ParamsObj().DefaultDateMask,this.Parent.MainFrm.ParamsObj().DefaultTimeMask)};OBookSrv.prototype.Fire_OnFormattingPage=function(a){this.Parent.OnFormattingPage(this,a)};OBookSrv.prototype.Fire_OnAfterFormattingPage=function(a){this.Parent.OnAfterFormattingPage(this,a)};OBookSrv.prototype.Fire_OnFormattingSection=function(a){this.Parent.OnFormattingSection(this,a)};OBookSrv.prototype.Fire_OnAfterFormattingSection=function(a){this.Parent.OnAfterFormattingSection(this,a)};OBookSrv.prototype.Fire_OnChangingSpan=function(d,a,b,c){this.Parent.OnChangingSpan(this,d,a,b,c)};OBookSrv.prototype.Fire_OnBoxDrop=function(b,a){this.Parent.OnBoxDrop(this,b,a)};OBookSrv.prototype.Fire_OnBoxTransform=function(d,e,c,f,a,b){this.Parent.OnBoxTransform(this,d,e,c,f,a,b)};OBookSrv.prototype.Fire_OnConnecting=function(a){this.Parent.OnConnecting(this,a)};OBookSrv.prototype.Fire_Activated=function(b,a){this.Parent.Activated(this,b,a)};OBookSrv.prototype.Fire_OnIMDBUpdate=function(a){this.Parent.OnIMDBUpdate(this,a)};OBookSrv.prototype.Fire_OnPreview=function(){if(this.Parent.PreviewBook==null){this.Parent.RD3Change(RD3Glb.FRM_PREVIEW)}this.Parent.OnPreview(this)};OBookSrv.prototype.BookCommand=function(g,b,f,d){if(b==undefined){b=0}if(f==undefined){f=false}if(d==undefined){d=0}var c=-2;var e=-2;var a=new IDVariant();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": received command "+this.DecodeCommand(g)+"; fire OnBookCommand event"+(f?" (USER operation)":""));this.Parent.OnBookCommand(this,new IDVariant(g),a,new IDVariant(f));if(a.isTrue()){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": command canceled");return false}switch(g){case IDREGlb.BCM_PRINT:c=this.BookObj.GetPageNumber();e=c;this.BookObj.set_PrintDestination(IDREGlb.PRN_PDF);this.BookObj.PrintBook(1,-1);this.MainFrm.RedirectTo().set(new IDVariant(this.BookObj.GetWebFileName()));this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",111,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": printed to file "+this.BookObj.GetWebFileName());this.MainFrm.set_RedirectNewWindow(true);this.BookObj.set_PrintDestination(IDREGlb.PRN_SCREEN);break;case IDREGlb.BCM_NAVIGATION:switch(b){case 0:c=1;e=1;break;case 1:c=this.BookObj.GetLastCachedPage();if(c==0){c=1}e=-1;break;case 2:c=this.BookObj.GetPageNumber()-1;e=c;break;case 3:c=this.BookObj.GetPageNumber()+1;e=c;break;case 4:c=d;e=d;break}break;case IDREGlb.BCM_CSV:this.ExportData();break}if(c>-2&&e>-2){this.BookObj.PrintBook(c,e);if(this.RD3Changed||(this.ToolbarEventDef&RD3Glb.EVENT_CLIENTSIDE)==0){this.RD3Change(RD3Glb.BOK_PAGENUM);this.RD3Change(RD3Glb.BOK_PAGETOTAL);this.RD3Change(RD3Glb.BOK_PAGECONFIRMED)}}return true};OBookSrv.prototype.DecodeCommand=function(a){switch(a){case IDREGlb.BCM_PRINT:return"Print";case IDREGlb.BCM_NAVIGATION:return"Navigate";case IDREGlb.BCM_CSV:return"Export"}return""+a};OBookSrv.prototype.ExportData=function(e,d){if(d==undefined){d=true}if(!d){var a=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": received command "+this.DecodeCommand(IDREGlb.BCM_CSV)+"; fire OnBookCommand event")}this.Parent.OnBookCommand(this,new IDVariant(IDREGlb.BCM_CSV),a,new IDVariant(false));if(a.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": command canceled")}return""}}for(var c=0;c<this.BookObj.Book.ReportsList.Count();c++){var b=this.BookObj.Book.ReportsList[c];if(b.ParentBox!=null){continue}if(!b.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(b.GetFlag(IDREGlb.FL_REPORT_ANYPAGE)){continue}return b.ExportData(this.MainFrm,e)}return""};OBookSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.BookObj.FrIndex()+":"+this.Parent.FormIdx};OBookSrv.prototype.GetRD3Name=function(){return"book"};OBookSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};OBookSrv.prototype.RD3RenderDifferences=function(f,j,q){this.FrIndex=this.BookObj.FrIndex();var o=this.RD3Changed;var d=WebFrameSrv.prototype.RD3RenderDifferences.call(this,f,j,q);if(f==null){f=d}o|=(d!=null);if(f==null&&this.RD3Changed){f=j.AddNewElement("chg");f.SetAttribute("id",this.GetRD3Ident());d=f}if(q){if(this.ToolbarEventDef!=RD3Glb.EVENT_ACTIVE){f.SetAttribute("tck",this.ToolbarEventDef.toString())}if(this.ChangePageAnimationDef!=null){f.SetAttribute("cpa",this.ChangePageAnimationDef)}}if(q||this.RD3Changed){var a=false;for(var h=0;h<RD3Glb.BOK_MAXPROPS;h++){if(this.RD3PropChg[h]||q){a=true;this.SetRD3Property(h,f,q)}}this.RD3PropChg.SetAll(false);if(this.RD3DeletePage!=-1){f.SetAttribute("dgp",this.RD3DeletePage.toString());this.RD3DeletePage=-1;a=true}if(!q&&!a){j.RemoveNode(f);f=null}}if(q||this.RD3Changed){var l=this.BookObj.GetPageNumber();if(!this.RD3PageCache.containsKey(l)||q||this.BookObj.Book.CacheSize()!=1){if(this.BookObj.Book.CacheSize()==1&&!q&&this.BookObj.RD3ResendPage(l)){q=true}if(this.BookObj.RD3RenderDifference(f,j,q)){this.RD3PageCache[l]=true}if(this.BookObj.Book.CacheSize()!=1&&j!=null&&"rd3".equals(j.Name())&&j.HasNextNode()){var b=new ArrayList();while(j.HasNextNode()){var g=j.GetNextNode();if(g.Name()==null||!g.Name().equals("del")){continue}var c=g.GetAttribute("id");if(c==null||c.length<3){continue}c=c.substring(0,3);if(!c.equals("sec")&&!c.equals("box")&&!c.equals("spn")){continue}b.Add(g)}for(var h=0;h<b.Count();h++){var g=b[h];g.GetNode().parentNode.insertBefore(g.GetNode(),g.GetNode().parentNode.getFirstChild())}}}else{if(this.BookObj.Book.PE.PrintingPage!=null&&this.BookObj.Book.PE.LastRD3Page!=null&&this.BookObj.Book.PE.LastRD3Page.PageNum!=l){this.BookObj.Book.PE.LastRD3Page=this.BookObj.Book.PE.PrintingPage;if(this.BookObj.Book.PE.LastRD3Page.RD3ObjMap==null){this.BookObj.Book.PE.LastRD3Page.RD3RenderDifference(new XMLDoc().AddNewElement("dummy"),false,null)}}}}if(!q){var k=new ArrayList();this.BookObj.Book.GetSubForm(k);for(var m=0;m<k.Count();m++){var e=k[m];o|=e.RD3RenderDifferences(j,q)}}this.RD3Changed=false;return o?d:null};OBookSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.BOK_SHOWSTATUSBAR:if(b&&this.ShowStatusBar){break}c.SetAttribute("ssb",this.ShowStatusBar?"1":"0");break;case RD3Glb.BOK_SHOWTOOLBAR:if(b&&this.ShowToolbar){break}c.SetAttribute("stb",this.ShowToolbar?"1":"0");break;case RD3Glb.BOK_PAGENUM:c.SetAttribute("pag",this.BookObj.GetPageNumber().toString());break;case RD3Glb.BOK_PAGETOTAL:c.SetAttribute("ptt",this.BookObj.GetTotalPagesNumber().toString());break;case RD3Glb.BOK_PAGECONFIRMED:c.SetAttribute("pcf",(this.BookObj.GetTotalPagesNumberConf()?"1":"0"));break;case RD3Glb.BOK_HIDEBORDER:c.SetAttribute("hib",(this.BookObj.HideBorder()?"1":"0"));break;case RD3Glb.BOK_ENABLEDCOMMANDS:if(b&&this.BookObj.Book.EnabledCommands==-5){break}c.SetAttribute("enc",this.BookObj.Book.EnabledCommands.toString());break;case RD3Glb.BOK_CACHESIZE:if(b&&this.BookObj.Book.CacheSize()==1){break}c.SetAttribute("csz",this.BookObj.Book.CacheSize().toString());break;case RD3Glb.BOK_FIXEDWIDTH:if(b&&this.BookObj.Book.FixedWidth==0){break}c.SetAttribute("fiw",this.BookObj.Book.FixedWidth.toString());break;case RD3Glb.BOK_FIXEDHEIGHT:if(b&&this.BookObj.Book.FixedHeight==0){break}c.SetAttribute("fih",this.BookObj.Book.FixedHeight.toString());break;case RD3Glb.BOK_SCROLLDIR:if(b&&this.BookObj.ScrollDir==0){break}c.SetAttribute("scd",this.BookObj.ScrollDir.toString());break;case RD3Glb.BOK_FORCESNAP:if(b&&this.BookObj.ForceSnap){break}c.SetAttribute("fsn",this.BookObj.ForceSnap?"1":"0");break;case RD3Glb.BOK_OPTIMIZEDOM:if(b&&!this.BookObj.OptimizeDOM){break}c.SetAttribute("opt",this.BookObj.OptimizeDOM?"1":"0");break}};OBookSrv.prototype.RD3ResetPageCache=function(d){var j=true;if(this.RD3PageCache.count()==1&&this.RD3PageCache.containsKey(this.BookObj.GetLastRD3Page())){j=false}if(this.BookObj.Book.CacheSize()!=1&&!d){var a=this.BookObj.Book.PE.LastRD3MultiPages;var f=(a[0]==null?0:a[0].PageNum);var g=(a[a.length-1]==null?0:a[a.length-1].PageNum);if(f>0&&g>0){var h=this.RD3PageCache.keys();for(var b=0;b<h.length;b++){var c=h[b];if(c<f||c>g){this.RD3PageCache.remove(c)}}for(var b=0;b<a.length;b++){if(a[b]!=null){this.RD3PageCache.remove(a[b].PageNum)}}}else{this.RD3PageCache.clear()}if(j){var e=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());if(f>0){e.SetAttribute("from",f.toString())}if(g>0){e.SetAttribute("to",g.toString())}}}else{this.RD3PageCache.clear();if(j){this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident())}}this.RD3Changed=true};OBookSrv.prototype.RD3ToolbarHandler=function(b,a){if(b=="top"){this.MainFrm.DTTObj.SetRequestName("Book First Page","Book "+this.BookObj.GetName()+": Go to first page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to first","","top");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone TOP nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,0,true)}else{if(b=="bottom"){this.MainFrm.DTTObj.SetRequestName("Book Last Page","Book "+this.BookObj.GetName()+": Go to last page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to last","","bottom");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone BOTTOM nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,1,true)}else{if(b=="prev"){this.MainFrm.DTTObj.SetRequestName("Book Previous Page","Book "+this.BookObj.GetName()+": Go to previous page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to prev","","prev");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PREVIOUS nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,2,true)}else{if(b=="next"){this.MainFrm.DTTObj.SetRequestName("Book Next Page","Book "+this.BookObj.GetName()+": Go to next page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to next","","next");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone NEXT nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,3,true)}else{if(b=="print"){this.MainFrm.DTTObj.SetRequestName("Book Print","Book "+this.BookObj.GetName()+": printing to PDF file",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book print","","print");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PRINT nella toolbar del book");this.BookCommand(IDREGlb.BCM_PRINT,0,true)}else{if(b=="csv"){this.MainFrm.DTTObj.SetRequestName("Book Export","Book "+this.BookObj.GetName()+": exporting to CSV file",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book export","","csv");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone EXCEL nella toolbar del book");this.BookCommand(IDREGlb.BCM_CSV,0,true)}else{if(b=="goto"){this.MainFrm.DTTObj.SetRequestName("Goto Page","Book "+this.BookObj.GetName()+": going to page "+a,DTTRequest.PRI_CMD);this.BookCommand(IDREGlb.BCM_NAVIGATION,4,true,a)}}}}}}}};OBookSrv.prototype.ShowTool=function(){return this.ShowToolbar};OBookSrv.prototype.set_ShowTool=function(a){this.ShowToolbar=a;this.RD3Change(RD3Glb.BOK_SHOWTOOLBAR)};OBookSrv.prototype.ShowStatus=function(){return this.ShowStatusBar};OBookSrv.prototype.set_ShowStatus=function(a){this.ShowStatusBar=a;this.RD3Change(RD3Glb.BOK_SHOWSTATUSBAR)};OBookSrv.prototype.set_Width=function(a){if(this.Width!=a){this.Parent.Frames[this.BookObj.FrIndex()].Width=a;this.Parent.Frames[this.BookObj.FrIndex()].RD3Change(RD3Glb.AFR_WIDTH);this.Width=a}};OBookSrv.prototype.set_Height=function(a){if(this.Height!=a){this.Parent.Frames[this.BookObj.FrIndex()].Height=a;this.Parent.Frames[this.BookObj.FrIndex()].RD3Change(RD3Glb.AFR_HEIGHT);this.Height=a}};OBookSrv.prototype.RD3Resize=function(b,e,d){var c=this.BookObj.HideBorder()?-4:6;var a=this.BookObj.HideBorder()?-4:6;WebFrameSrv.prototype.RD3Resize.call(this,b,e,d);if(this.Visible){this.BookObj.SetSize(this.Width-c+6,this.Height-a+6)}};OBookSrv.prototype.RD3EndRequest=function(){var c=new ArrayList();this.BookObj.Book.GetSubForm(c);for(var d=0;d<c.Count();d++){var a=c[d];for(var b=0;b<a.Frames.length;b++){if(a.Frames[b]!=null&&a.Frames[b].Content!=null){if(this.Parent==this.MainFrm.ActiveForm()&&a.Frames[b].Content instanceof IDPanelSrv){a.Frames[b].Content.RD3Validate=true}a.Frames[b].Content.RD3EndRequest()}}}if(this.WasHidden){if(this.Visible&&!this.Collapsed&&this.Exposed()){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"OBook.UpdateBook","Book"+this.BookObj.GetName()+": update performed for the first time (the book was either invisible, collapsed or not exposed)");this.BookObj.UpdateBook(this.WasHidden);this.WasHidden=false}}};OBookSrv.prototype.RD3RawClick=function(a,j,g,m,f,l,c){var h=c.GetAttribute("par4");var d=-1;var e=null;if(h.startsWith("box:")){e=this.BookObj.RD3FindBox(h)}if(e!=null){d=this.BookObj.MoveDSEToBox(e)}var k=new IDVariant();if(this.MainFrm!=null){var b=(l)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(b,"Book"+this.BookObj.GetName()+" "+b,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"Book."+b,"Book "+this.BookObj.GetName()+": firing event "+b)}if(l){this.Parent.OnMouseDoubleClick(this,new IDVariant(a),new IDVariant(j),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(d),k)}else{this.Parent.OnMouseClick(this,new IDVariant(a),new IDVariant(j),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(d),k)}return k.isTrue()};OBookSrv.prototype.GenericDrag=function(b,g){var f=parseInt(b.GetAttribute("par1"),10);var j=b.GetAttribute("obn");var c=b.GetAttribute("oid");var e=this.MainFrm.RD3FindBox(j);this.BookObj.MoveDSEToBox(e);this.MainFrm.ActivedDocument=null;this.MainFrm.ActivedProperty=null;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"OBook.OnGenericDrag","Book "+this.BookObj.GetName()+": firing event OnGenericDrag");var h=new IDVariant();this.Parent.OnGenericDrag(this,h,new IDVariant(f),new IDVariant(e.GetIndex()));if(g instanceof WebFrameSrv){var a=g;if(c.startsWith("tab")&&a.Parent!=null&&a.FrIndex>-1&&a.Parent.Frames[a.FrIndex].InTabbed&&a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx]!=null){var d=a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx].Content;d.GenericDrop(b,h)}else{a.GenericDrop(b,h)}}if(g instanceof ACommandSrv){this.MainFrm.CmdObj.GenericDrop(g,h)}};OBookSrv.prototype.GenericDrop=function(a,h){var g=parseFloat(a.GetAttribute("par4"));var f=parseFloat(a.GetAttribute("par5"));var d=parseInt(a.GetAttribute("par1"),10);var k=parseInt(a.GetAttribute("par2"),10);var e=parseInt(a.GetAttribute("par3"),10);var b=a.GetAttribute("oid");var c=this.MainFrm.RD3FindBox(b);this.BookObj.MoveDSEToBox(c);this.MainFrm.DTTObj.SetRequestName("Generic Drop","Book "+this.BookObj.GetName()+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"OBook.OnGenericDrop","Book "+this.BookObj.GetName()+": firing event OnGenericDrop");var j=new IDVariant();this.Parent.OnGenericDrop(this,h,j,new IDVariant(d),new IDVariant(g),new IDVariant(f),new IDVariant(k),new IDVariant(e),new IDVariant(c.GetIndex()))};function OButBarSrv(a){WebFrameSrv.call(this,a);this.CSetIndex;this.Vertical;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.BBR_MAXPROPS)}OButBarSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];OButBarSrv[obj]=WebFrameSrv[obj]}OButBarSrv.prototype.ProcessRequest=function(b,a){if(!a){this.MainFrm.CmdObj.ProcessRequest(this.CSetIndex,b,w)}};OButBarSrv.prototype.GetRD3Name=function(){return"bbr"};OButBarSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};OButBarSrv.prototype.RD3RenderDifferences=function(f,c,e){this.Parent.MainFrm.CmdObj.DTTTrace(this.Parent.MainFrm,this.CSetIndex,DTTEngine.TRC_ITBUTBAR);var d=this.RD3Changed;var a=WebFrameSrv.prototype.RD3RenderDifferences.call(this,f,c,e);if(f==null){f=a}d|=(a!=null);if(f==null&&this.RD3Changed){f=c.AddNewElement("chg");f.SetAttribute("id",this.GetRD3Ident());a=f}if(e||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||e){this.SetRD3Property(b,f,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}return d?a:null};OButBarSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.BBR_CMDSETIDX:if(this.CSetIndex==0&&b){break}c.SetAttribute("cms","cms:"+this.CSetIndex);break;case RD3Glb.BBR_VERTICAL:if(!this.Vertical&&b){break}c.SetAttribute("bvr",this.Vertical?"1":"0");break}};function ATabSrv(){this.Content;this.Flags=0;this.Image="";this.Header="";this.Tooltip="";this.Style=0;this.Badge="";this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TAB_MAXPROPS);this.RD3NewObj=false;this.RD3DelObj=false}ATabSrv.prototype.GetRD3Ident=function(){var b=this.Content.GetRD3Ident();var a=b.indexOf(":");return this.GetRD3Name()+b.substr(a)};ATabSrv.prototype.GetRD3Name=function(){return"tab"};ATabSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ATabSrv.prototype.RD3RenderDifference=function(c,f,a){var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}if(e==null&&this.RD3Changed){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||f){this.SetRD3Property(b,e,f,a)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}return d};ATabSrv.prototype.SetRD3Property=function(a,d,c,b){switch(a){case RD3Glb.TAB_IMAGE:if(this.Image.length==0&&c){break}d.SetAttribute("img",this.Image);break;case RD3Glb.TAB_HEADER:if(this.Header.length==0&&c){break}d.SetAttribute("cap",this.Header);break;case RD3Glb.TAB_TOOLTIP:if(this.Tooltip.length==0&&c){break}d.SetAttribute("tip",this.Tooltip);break;case RD3Glb.TAB_STYLE:if(this.Style==0&&c){break}d.SetAttribute("sty",b.VisualStyleList.GetTrueIdx(this.Style).toString());break;case RD3Glb.TAB_CONTENT:d.SetAttribute("con",this.Content.GetRD3Ident());break;case RD3Glb.TAB_BADGE:if(this.Badge.length==0&&c){break}d.SetAttribute("bdg",this.Badge);break}};function OTabViewSrv(a){WebFrameSrv.call(this,a);this.ItemList;this.SelectedTab=0;this.Placement;this.HiddenTabs;this.AutoSize=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TAB_MAXPROPS);this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.ChangePageAnimationDef=null}OTabViewSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];OTabViewSrv[obj]=WebFrameSrv[obj]}OTabViewSrv.prototype.SetItemCount=function(b){this.ItemList=new Array(b+1);for(var a=1;a<this.ItemList.length;a++){this.ItemList[a]=new ATabSrv()}};OTabViewSrv.prototype.ItemCount=function(){return this.ItemList.length-1};OTabViewSrv.prototype.SetItem=function(g,e,d,a,c,b){this.ItemList[g].Content=e;this.ItemList[g].Flags=d;this.ItemList[g].Image=a;this.ItemList[g].Tooltip=b;this.ItemList[g].Header=e.Caption;if(e.Description!=null){this.ItemList[g].Tooltip=e.Description}if(e.Content.iImage!=null){this.ItemList[g].Image=e.Content.iImage}e.Exposed=false;e.Content.set_Exposed(false);e.TabIdx=this.FrIndex};OTabViewSrv.prototype.GetItem=function(a){return this.ItemList[a].Content};OTabViewSrv.prototype.SelectedPageIndex=function(){if(this.SelectedTab>=0&&this.SelectedTab<this.ItemList.length&&this.ItemList[this.SelectedTab]!=null&&this.ItemList[this.SelectedTab].Content!=null){return this.ItemList[this.SelectedTab].Content.Index}return -1};OTabViewSrv.prototype.GetNumTab=function(){var b=0;for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Content.Visible){b++}}return b};OTabViewSrv.prototype.SelectTab=function(d,l){if(this.ItemList.length==1){return}var b=this.SelectedTab>0&&this.ItemList[this.SelectedTab].Content!=null&&this.ItemList[this.SelectedTab].Content.Content instanceof IDPanelSrv&&this.ItemList[this.SelectedTab].Content.Content.HasFocus();if(d!=this.SelectedTab){var j=this.SelectedTab;this.SelectedTab=d;var m=new IDVariant();var c=0;if(j>0){c=this.ItemList[j].Content.Index}var g=this.Parent.Document();if(this.SelectedTab>0&&this.ItemList[this.SelectedTab].Content!=null&&this.ItemList[this.SelectedTab].Content.Content instanceof IDPanelSrv){var k=this.ItemList[this.SelectedTab].Content.Content;var e=null;if(k.MasterPanelCode!=null){e=this.Parent.SearchPanel(k.MasterPanelCode)}else{if(k.MasterPanelIdx>0){e=this.Parent.Frames[k.MasterPanelIdx].Content}}if(e!=null){if(e.Queries[0].IsMasterDO){this.Parent.set_Document(e.GetDocument())}}else{if(k.Queries[0].IsMasterDO){this.Parent.set_Document(null)}}}var h=this.Parent.Document();if(!this.HiddenTabs){this.Parent.TabClick(this,new IDVariant(c),m)}if(m.isTrue()){this.SelectedTab=j;if(h==this.Parent.Document()){this.Parent.set_Document(g)}return}}if(this.SelectedTab>0&&this.AutoSize){var a=this.ItemList[this.SelectedTab].Content.Content.GetContentSize();if(a!=null){this.Parent.Frames[this.FrIndex].FixedHeight=a.Height+Glb.PAN_OFFS_PAGEY+Glb.PAN_OFFS_Y;this.ItemList[this.SelectedTab].Content.FixedHeight=a.Height+Glb.PAN_OFFS_Y}}for(var f=1;f<this.ItemList.length;f++){this.ItemList[f].Content.Exposed=false;this.ItemList[f].Content.Content.set_Exposed(false)}if(this.SelectedTab>0&&this.Parent.Frames[this.FrIndex].Exposed){this.ItemList[this.SelectedTab].Content.Exposed=true;this.ItemList[this.SelectedTab].Content.Content.set_Exposed(true);if(b){if(this.SelectedTab>0&&this.ItemList[this.SelectedTab].Content!=null&&this.ItemList[this.SelectedTab].Content.Content instanceof IDPanelSrv){this.ItemList[this.SelectedTab].Content.Content.SetInput()}else{if(this.Parent.FocusPriority<2){this.Parent.ActiveElement="CMD"}}}}this.RD3Change(RD3Glb.TBV_SELECTEDTAB)};OTabViewSrv.prototype.SelectFrameByIndex=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){this.SelectTab(a,true);return}}};OTabViewSrv.prototype.MoveTo=function(a){this.SelectTab(Math.min(Math.max(1,a),this.ItemList.length-1),true)};OTabViewSrv.prototype.MovePrev=function(){for(var a=this.SelectedTab-1;a>0;a--){if(!this.ItemList[a].RD3DelObj&&this.ItemList[a].Content.Content.Visible){this.SelectTab(a,true);break}}};OTabViewSrv.prototype.MoveNext=function(){for(var a=this.SelectedTab+1;a<this.ItemList.length;a++){if(!this.ItemList[a].RD3DelObj&&this.ItemList[a].Content.Content.Visible){this.SelectTab(a,true);break}}};OTabViewSrv.prototype.GetPageIndex=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){return a}}return 0};OTabViewSrv.prototype.FindFrame=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content==b){return a}}return 0};OTabViewSrv.prototype.ProcessRequest=function(d,b){var a=this.MainFrm;if(!b){for(var c=1;c<this.ItemList.length;c++){var e=a.GetParameter("page"+this.FrIndex+"_"+c+".x");if(e!=null&&e.length>0){this.SelectTab(c,true);a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,31,"ATabView.ProcessRequest","Tabbed "+this.Parent.Frames[this.FrIndex].Caption+": selected page "+this.ItemList[this.SelectedTab].Content.Caption);a.DTTObj.SetRequestName("Tab Page Select","Selected page "+this.ItemList[this.SelectedTab].Content.Caption,DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TABSELPG,"Tabbed change page","",c);a.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la pagina "+this.ItemList[this.SelectedTab].Content.Caption+" nella tab view");break}}this.CheckForHiddenPage(a)}if(this.SelectedTab>0){this.ItemList[this.SelectedTab].Content.ProcessRequest(b)}};OTabViewSrv.prototype.SearchObject=function(a){for(var b=1;b<this.ItemList.length;b++){var c=this.ItemList[b].Content.Content.SearchObject(a);if(c!=null){return c}}return null};OTabViewSrv.prototype.CheckForHiddenPage=function(a){if(this.SelectedTab>0&&!this.ItemList[this.SelectedTab].Content.Content.Visible){var c=false;for(var b=1;b<this.ItemList.length;b++){if(this.ItemList[b].Content.Content.Visible){c=true;a.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,32,"ATabView.CheckHiddenPage","The page "+this.ItemList[this.SelectedTab].Content.Caption+" has an invisible content. Selecting page "+this.ItemList[b].Content.Caption+" instead");this.SelectTab(b,true);break}}if(!c){a.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,33,"ATabView.CheckHiddenPage","The page "+this.ItemList[this.SelectedTab].Content.Caption+" has an invisible content and no visible pages have been found");this.SelectTab(0,true)}}};OTabViewSrv.prototype.DTTTrace=function(a){if(a.DTTObj.AddTraceItem(this.iGuid,DTTEngine.TRC_ITTABBED,"Tabbed.Render","")){if(this.ItemList[this.SelectedTab]!=null&&this.ItemList[this.SelectedTab].Content!=null){var b="PG="+this.ItemList[this.SelectedTab].Content.Caption;a.DTTObj.AddTraceToken(this.iGuid,DTTEngine.TRC_TABCAPTION,"Tabbed.Caption",this.Parent.Frames[this.FrIndex].Caption,b)}}};OTabViewSrv.prototype.SetItemImage=function(b,c){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){if(!this.ItemList[a].Image.equals(c)||c.length==0){this.ItemList[a].Image=(c.length==0?"$":c);this.ItemList[a].RD3Change(RD3Glb.TAB_IMAGE)}return}}};OTabViewSrv.prototype.SetItemCaption=function(c,b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==c){if(!this.ItemList[a].Header.equals(b)){this.ItemList[a].Header=b;this.ItemList[a].RD3Change(RD3Glb.TAB_HEADER)}return}}};OTabViewSrv.prototype.GetItemCaption=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){return this.ItemList[a].Header}}return""};OTabViewSrv.prototype.SetItemStyle=function(c,b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==c){if(this.ItemList[a].Style!=b){this.ItemList[a].Style=b;this.ItemList[a].RD3Change(RD3Glb.TAB_STYLE)}return}}};OTabViewSrv.prototype.GetItemStyle=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){return this.ItemList[a].Style}}return 0};OTabViewSrv.prototype.SetItemTooltip=function(b,c){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){if(!this.ItemList[a].Tooltip.equals(c)){this.ItemList[a].Tooltip=c;this.ItemList[a].RD3Change(RD3Glb.TAB_TOOLTIP)}return}}};OTabViewSrv.prototype.GetItemTooltip=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){return this.ItemList[a].Tooltip}}return""};OTabViewSrv.prototype.ChangeItemVisibility=function(b,a){this.CheckForHiddenPage(a)};OTabViewSrv.prototype.Resize=function(e,b){var a=e;var d=b;for(var c=1;c<this.ItemList.length;c++){this.ItemList[c].Content.Resize(a,d);this.ItemList[c].Content.Width=a;this.ItemList[c].Content.Height=d;this.ItemList[c].Content.FixedWidth=a;this.ItemList[c].Content.FixedHeight=d}};OTabViewSrv.prototype.set_Exposed=function(a){WebFrameSrv.prototype.set_Exposed.call(this,a);if(this.SelectedTab>0){this.ItemList[this.SelectedTab].Content.Exposed=a;this.ItemList[this.SelectedTab].Content.Content.set_Exposed(a)}};OTabViewSrv.prototype.GetRD3Name=function(){return"tbv"};OTabViewSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};OTabViewSrv.prototype.RD3RenderDifferences=function(b,f,j){this.DTTTrace(this.Parent.MainFrm);if(!j&&!this.RD3Changed){for(var e=1;e<this.ItemList.length;e++){if(this.ItemList[e].RD3NewObj||this.ItemList[e].RD3DelObj){this.RD3Changed=true;break}}}var h=this.RD3Changed;var a=WebFrameSrv.prototype.RD3RenderDifferences.call(this,b,f,j);if(b==null){b=a}h|=(a!=null);if(b==null&&this.RD3Changed){b=f.AddNewElement("chg");b.SetAttribute("id",this.GetRD3Ident());a=b}if(j||this.RD3Changed){for(var e=0;e<this.RD3PropChg.length;e++){if(this.RD3PropChg[e]||j){this.SetRD3Property(e,b,j)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(j){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("clk",this.ClickEventDef.toString())}if(this.ChangePageAnimationDef!=null){b.SetAttribute("cpa",this.ChangePageAnimationDef)}}if(this.ItemList!=null){var d=(j)?b:f;for(var e=1;e<this.ItemList.length;e++){if(this.ItemList[e].RD3NewObj){this.ItemList[e].RD3RenderDifference(b,true,this.MainFrm);this.ItemList[e].RD3NewObj=false}else{if(this.ItemList[e].RD3DelObj){if(!j){var c=f.AddNewElement("chg");c.SetAttribute("id",this.ItemList[e].GetRD3Ident());c.SetAttribute("dcl","1")}var g=this.ItemList;this.ItemList=new Array(g.length-1);Array.copy(g,0,this.ItemList,0,e);if(g.length>e+1){Array.copy(g,e+1,this.ItemList,e,g.length-e-1)}if(this.SelectedTab>e){this.SelectedTab--;this.RD3Change(RD3Glb.TBV_SELECTEDTAB)}e--}else{h|=this.ItemList[e].RD3RenderDifference(d,j,this.Parent.MainFrm)}}}}return h?a:null};OTabViewSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.TBV_SELECTEDTAB:if(this.SelectedTab==0&&b){break}if(this.Parent!=null){this.CheckForHiddenPage(this.Parent.MainFrm)}c.SetAttribute("sel",this.SelectedTab.toString());break;case RD3Glb.TBV_PLACEMENT:if(this.Placement==0&&b){break}c.SetAttribute("pla",this.Placement.toString());break;case RD3Glb.TBV_HIDDENTABS:if(!this.HiddenTabs&&b){break}c.SetAttribute("hid",this.HiddenTabs?"1":"0");break;case RD3Glb.TBV_AUTOSIZE:if(!this.AutoSize&&b){break}c.SetAttribute("asz",this.AutoSize?"1":"0");break}};OTabViewSrv.prototype.RD3FindTab=function(c){for(var a=1;a<this.ItemList.length;a++){var b=this.ItemList[a];if(b.GetRD3Ident().equals(c)){return b}}return null};OTabViewSrv.prototype.RD3SelectTab=function(d){var b=this.SelectedTab;var c=this.RD3FindTab(d);var a=this.Parent.MainFrm;if(c!=null){this.SelectFrameByIndex(c.Content.Index);if(this.SelectedTab>0){a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,31,"ATabView.ProcessRequest","Tabbed "+this.Parent.Frames[this.FrIndex].Caption+": selected page "+this.ItemList[this.SelectedTab].Content.Caption);a.DTTObj.SetRequestName("Tab Page Select","Selected page "+this.ItemList[this.SelectedTab].Content.Caption,DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TABSELPG,"Tabbed change page","",this.SelectedTab);a.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la pagina "+this.ItemList[this.SelectedTab].Content.Caption+" nella tab view")}this.CheckForHiddenPage(a)}if(this.SelectedTab==b&&this.ClickEventDef==RD3Glb.EVENT_ACTIVE){this.RD3Change(RD3Glb.TBV_SELECTEDTAB)}};OTabViewSrv.prototype.RD3RawClick=function(c,h,g,q,f,o,e){var b=e.GetAttribute("par4");var l=b.indexOf(":");var k=b.indexOf(":",l+1);var a=-1;if(l>-1&&k>-1&&b.startsWith("tab:")){var j=b.substr(l+1,k-l-1);a=parseInt(j,10)}var m=new IDVariant();if(this.MainFrm!=null){var d=(o)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(d,"TabbedView "+this.Code+" "+d,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"TabbedView."+d,"TabbedView "+this.Code+": firing event "+d)}if(o){this.Parent.OnMouseDoubleClick(this,new IDVariant(c),new IDVariant(h),new IDVariant(g),new IDVariant(q),new IDVariant(f),new IDVariant(a),m)}else{this.Parent.OnMouseClick(this,new IDVariant(c),new IDVariant(h),new IDVariant(g),new IDVariant(q),new IDVariant(f),new IDVariant(a),m)}return m.isTrue()};OTabViewSrv.prototype.AddSubFormByIndex=function(a){var b=this.MainFrm.CreateFormByIndex(a.intValue());this.AddSubForm(b);return b};OTabViewSrv.prototype.AddSubForm=function(a){Array.resize(this.Parent.Frames,this.Parent.Frames.length+1);var b=new AFrameSrv(this.Parent.Frames.length-1);this.Parent.Frames[this.Parent.Frames.length-1]=b;b.Parent=this.Parent;b.InTabbed=true;b.FrHidden=true;b.RD3NewObj=true;var c=new ASubFormSrv(this.Parent);b.Content=c;c.FrIndex=b.Index;c.Height=this.Height;c.Width=this.Width;c.Init(a,a.MainFrm);b.Caption=a.Caption().stringValue();Array.resize(this.ItemList,this.ItemList.length+1);this.ItemList[this.ItemList.length-1]=new ATabSrv();this.ItemList[this.ItemList.length-1].RD3NewObj=true;this.SetItem(this.ItemList.length-1,b,0,a.Image(),"","")};OTabViewSrv.prototype.DelSubForm=function(d){var a=null;var e=null;for(var c=1;c<this.Parent.Frames.length;c++){if(this.Parent.Frames[c].Content instanceof ASubFormSrv&&this.Parent.Frames[c].Content.pSubForm==d){a=this.Parent.Frames[c];for(var b=1;b<this.ItemList.length;b++){if(this.ItemList[b].Content!=null&&this.ItemList[b].Content.Content==this.Parent.Frames[c].Content){e=this.ItemList[b];break}}break}}if(a!=null&&e!=null){a.RD3DelObj=true;e.RD3DelObj=true;if(this.ItemList[this.SelectedTab]==e&&this.SelectedTab>1){for(var c=this.SelectedTab-1;c>=1;c--){if(!this.ItemList[c].RD3DelObj&&this.ItemList[c].Content!=null&&this.ItemList[c].Content.Content!=null&&this.ItemList[c].Content.Content.Visible){this.SelectTab(c,true);break}}}return true}return false};OTabViewSrv.prototype.GetSubFormIndex=function(c){for(var b=1;b<this.ItemList.length;b++){if(this.ItemList[b].Content!=null&&this.ItemList[b].Content.Content!=null&&this.ItemList[b].Content.Content instanceof ASubFormSrv){var a=this.ItemList[b].Content.Content;if(a.pSubForm==c){return new IDVariant(this.ItemList[b].Content.Index)}}}return new IDVariant(-1)};OTabViewSrv.prototype.GenericDrag=function(b,h){var g=parseInt(b.GetAttribute("par1"),10);var l=b.GetAttribute("obn");var c=b.GetAttribute("oid");this.MainFrm.ActivedDocument=null;this.MainFrm.ActivedProperty=null;var d=-1;for(var e=1;e<this.ItemList.length;e++){var k=this.ItemList[e];if(l.startsWith(k.GetRD3Ident())){d=k.Content.Index;break}}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"OBook.OnGenericDrag","TabbedView "+this.Parent.Frames[this.FrIndex].Caption+": firing event OnGenericDrag");var j=new IDVariant();this.Parent.OnGenericDrag(this,j,new IDVariant(g),new IDVariant(d));if(h instanceof WebFrameSrv){var a=h;if(c.startsWith("tab")&&a.Parent!=null&&a.FrIndex>-1&&a.Parent.Frames[a.FrIndex].InTabbed&&a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx]!=null){var f=a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx].Content;f.GenericDrop(b,j)}else{a.GenericDrop(b,j)}}if(h instanceof ACommandSrv){this.MainFrm.CmdObj.GenericDrop(h,j)}};OTabViewSrv.prototype.GenericDrop=function(a,j){var h=parseFloat(a.GetAttribute("par4"));var g=parseFloat(a.GetAttribute("par5"));var e=parseInt(a.GetAttribute("par1"),10);var m=parseInt(a.GetAttribute("par2"));var f=parseInt(a.GetAttribute("par3"));var b=a.GetAttribute("oid");var d=-1;for(var c=1;c<this.ItemList.length;c++){var l=this.ItemList[c];if(b.startsWith(l.GetRD3Ident())){d=l.Content.Index;break}}this.MainFrm.DTTObj.SetRequestName("Generic Drop","Tabbed "+this.Code+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"TabbedView.OnGenericDrop","TabbedView "+this.Parent.Frames[this.FrIndex].Caption+": firing event OnGenericDrop");var k=new IDVariant();this.Parent.OnGenericDrop(this,j,k,new IDVariant(e),new IDVariant(h),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(d))};OTabViewSrv.prototype.SetItemBadge=function(c,a){for(var b=1;b<this.ItemList.length;b++){if(this.ItemList[b].Content.Index==c){if(!this.ItemList[b].Badge.equals(a)){this.ItemList[b].Badge=a;this.ItemList[b].RD3Change(RD3Glb.TAB_BADGE)}return}}};OTabViewSrv.prototype.GetItemBadge=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){return this.ItemList[a].Badge}}return""};OTabViewSrv.prototype.set_HideTabs=function(a){if(this.HiddenTabs!=a){this.HiddenTabs=a;this.RD3Change(RD3Glb.TBV_HIDDENTABS)}};OTabViewSrv.prototype.HideTabs=function(){return this.HiddenTabs};function ParamsSrv(){this.MAX_FORMS=0;this.MAX_INDICATORS=0;this.MAX_COMMANDS=0;this.MAX_COMMAND_SETS=0;this.MAX_TIMERS=0;this.ICDebug=0;this.DemoMode=0;this.UseFastRowSelector=true;this.PanelIsLockable=true;this.InfoMessages=true;this.UseSmallIcon=true;this.Theme="classic";this.AutoDynRows=0;this.ActImgWidth=0;this.NativeBlob=false;this.UseClientMask=false;this.DefaultDateMask="";this.DefaultTimeMask="";this.DefaultCurrencyMask="";this.DefaultFloatMask="";this.UseDecimalDot=false;this.PanelConfirmDelete=true;this.PanelHighlightDelete=true;this.ShowFieldImageInValue=true;this.ShowDisabledFieldActivator=true;this.ConvertNullToValue=true;this.PanelsSortAlways=true;this.IWCacheControl="NONE";this.AutoSaveType="NONE";this.UseRD=true;this.UseRD3=true;this.TruePopup=true;this.UseIDTag=true;this.ShowRD=true;this.UseFK=true;this.UseDoubleClick=true;this.EditUpdErrorMode=0;this.EditInsErrorMode=0;this.FinalUpdErrorMode=0;this.FinalInsErrorMode=0;this.PanelCommandMask=-1;this.PanelExtendedCommandMask=-1;this.EnablePanelMultiSelection=true;this.ShowPanelMultiSelection=false;this.ActivePanelMultiSelection=false;this.SelectAllOnlyVisible=false;this.PanelQBEEmpty=false;this.HelpFeatures="";this.HtmlConstraints=Glb.WEBVALID_NONE;this.UseCollapsableFrames=true;this.ChangeRowDelay=0;this.SmartLookupIcon="NO";this.ShowDisabledIcons=false;this.RightAlignedIcons=false;this.AllowMasterPanelNav=true;this.PanelsLikeSearch=true;this.ToolbarPosition=Glb.FORMTOOL_RIGHT;this.BorderType=Glb.BORDER_THICK;this.TooltipErrorMode=Glb.ERRTOOLTIP_OVER;this.MaxRequestSize=100*1024;this.EnableGFX=true;this.EnableSound=true;this.EnableRichTooltip=true;this.MultiSelectionComboBox=true;this.UseCollapsableGroups=false;this.TooltipOnEachRow=false;this.EnableFrameResize=false;this.QBETrueLessThan=false;this.PanelEnableInsertWhenLocked=false;this.PanelFixActiveRowWhenScrolled=true;this.LKEDOAllProperties=true;this.PanelFreezeWhenHidden=true;this.PanelsUseTab=true;this.PanelNewInsertMode=false;this.ResponseBufferSize=48;this.CompressResponse=true;this.LANGUAGE="ITA";this.UseRD4=false;this.LoadingPolicy=1;this.PullToRefresh=true;this.UseHTML5Upload=true;this.CompletePanelBorders=true;this.UseZones=true;this.EnableVoice=false;this.UseIDEditor=true;this.EnterChangeFocus=false;this.PanelsLikeMode=Glb.PAN_LIKESTARTS;this.PanelRefreshOnSort=false;this.PanelListQBE=0;this.IonicDarkMode=Glb.DARKMODE_AUTO;this.ExportUTF8=false;this.MaxLookupRows=30;this.PanelLimitOnGetSmartLookup=false;this.PanelInvalidLkeToNull=false;this.PanelInsertMaxScroll=true;this.PanelsRowHeightResize=false;this.UseFluid=false;this.GlobalToolbarPosition=Glb.GLOBALTOOLBARPOSITION_UNDER}function PBlobCacheSrv(){this.BlobNum;this.FldIndex;this.RSIndex;this.BookMark;this.Size;this.ToDownload;this.IsValid=-1;this.MimeType="";this.FileName="";this.Extension=""}PBlobCacheSrv.prototype.isText=function(){return this.MimeType.startsWith("text/")};PBlobCacheSrv.prototype.isImage=function(){return this.MimeType.startsWith("image/")};PBlobCacheSrv.prototype.isBinary=function(){return"ZIP;RAR;BIN".indexOf(this.Extension.toUpperCase())>=0};function PDFPrintSrv(){this.PDFFile="";this.MsgText="";this.FromPage=0;this.ToPage=0;this.FitToPaper=true;this.AutoDelete=false;this.PrintDlg=false;this.Printed=false;this.Rendered=false}function PFieldSrv(){this.Parent;this.Index;this.VisualStyle=0;this.Flags;this.DesignFlags=-1;this.RoleFlags=-1;this.Image="";this.ImageResMode=1;this.Header="";this.AbbrHeaderList="";this.AbbrHeaderForm="";this.Tooltip="";this.iGuid;this.Page;this.Group;this.IdxPanel=-1;this.Expr;this.Code="";this.DataType;this.MaxLength;this.vScale;this.iVisualFlags;this.ValueList=new ArrayList();this.ListLeft;this.ListTop;this.ListWidth;this.ListHeight;this.FormLeft;this.FormTop;this.FormWidth;this.FormHeight;this.FormNumRow;this.ListNumRow;this.DesignListRect;this.DesignFormRect;this.SortMode=0;this.SortFld=-1;this.LastQBE="";this.LastQBEPos=new Array(0);this.QBEEnabled=true;this.MaxAutoShowSize=50*1024;this.MaxUploadSize=10*1024*1024;this.BlobNewWindow=true;this.MultiUpload=false;this.MaxUploadFiles=0;this.UploadExtensions="";this.UploadDescription="";this.MstCol;this.SubFrame=0;this.CmdIdx=0;this.HResMode=new Array(2);this.VResMode=new Array(2);this.HeaderSize=new Array(2);this.Values=new Array(0);this.RSIdx=-1;this.ImdbIdx=-2;this.PriIdx=-1;this.QueryValueSource;this.Unbound=false;this.CauseValidation=true;this.IsNamed=false;this.IsExtended=false;this.IDLista="";this.EditorType=0;this.ActImg=null;this.ActWidth=-9999;this.Transformation=0;this.TrFormat="";this.TrOffset=0;this.QBELike=true;this.flLookupExtended=false;this.PosDimPerc;this.CellSubForms;this.FontList;this.ColorList;this.TokenList;this.iShowEditorToolbar=true;this.iToolCommandEnabled=-1;this.iDefaultFormatting="";this.GroupIntervals=new ArrayList();this.GroupAggregation=PListGroupAggrSrv.AGGR_NONE;this.GroupAggrLabel=null;this.GroupDirection=0;this.ForeColor=-2;this.BackColor=-2;this.FontMod="";this.Mask="";this.Alignment=-1;this.AggregateOfField=-1;this.AggregateFunction=Glb.FLDAGGRFUN_SUM;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.FLD_MAXPROPS);this.UseHilight=false;this.UserChangedField=false;this.CalculateMask=true;this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.ChangeEventDef=RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE;this.iMultiSelectionComboBox=true;this.iQBESep=null;this.iMultiCriteria=false;this.GroupVS=-1;this.useTextSelection=false;this.sendSelection=false;this.selStart=-1;this.selEnd=-1;this.iWaterMark="";this.iBadge="";this.iClassName;this.maxLKERows=30;this.QBEComboFilterValue=null;this.QBEFilterPopup=null;this.iRowBreakBefore=false}PFieldSrv.prototype.IsActive=function(){return(this.Flags&Glb.FLD_ACTIVE)!=0};PFieldSrv.prototype.SetCustomContentCls=function(c,d){if(this.CustomElementCls==null&&d.equals("CustomElementSubForm")){for(var a=0;a<this.Values.length;a++){var b=this.Values[a];if(b.iCustomElement==null){b.iCustomElement=new CustomElement(b,"CustomElementSubForm");b.iCustomElement.RD3NewObj=true;b.RD3Change(RD3Glb.VAL_TEXT)}}}this.CustomElementCls=d;this.FieldCode=c};PFieldSrv.prototype.GetCustomElem=function(){if(this.CustomElementCls==null){return null}return this.Values[this.Parent.ValidatingRow==-1?this.Parent.AttR:this.Parent.ValidatingRow].iCustomElement};PFieldSrv.prototype.FldRect=function(b){var a=new RectSrv();if(b==Glb.PANEL_LIST){a.Left=this.ListLeft;a.Top=this.ListTop;a.Width=this.ListWidth;a.Height=this.ListHeight;if((this.Flags&Glb.FLD_LISTLIST)==0&&this.Parent.ShowRowSelector){a.Left+=Glb.SELECT_OFFSET}}else{a.Left=this.FormLeft;a.Top=this.FormTop;a.Width=this.FormWidth;a.Height=this.FormHeight}return a};PFieldSrv.prototype.set_FldRect=function(b,a){if(b==Glb.PANEL_LIST){this.ListLeft=a.Left;this.ListTop=a.Top;this.ListWidth=a.Width;this.ListHeight=a.Height;this.RD3Change(RD3Glb.FLD_LISTLEFT);this.RD3Change(RD3Glb.FLD_LISTTOP);this.RD3Change(RD3Glb.FLD_LISTWIDTH);this.RD3Change(RD3Glb.FLD_LISTHEIGHT)}else{this.FormLeft=a.Left;this.FormTop=a.Top;this.FormWidth=a.Width;this.FormHeight=a.Height;this.RD3Change(RD3Glb.FLD_FORMLEFT);this.RD3Change(RD3Glb.FLD_FORMTOP);this.RD3Change(RD3Glb.FLD_FORMWIDTH);this.RD3Change(RD3Glb.FLD_FORMHEIGHT)}};PFieldSrv.prototype.IsPresent=function(a){if(a==undefined){a=true}if(this.Page!=-1){if((this.Parent.bPages(this.Page).Flags&Glb.OBJ_VISIBLE)==0){return false}}if(this.Group!=-1){if((this.Parent.bGroups(this.Group).Flags&Glb.OBJ_VISIBLE)==0){return false}}if(a&&(this.Flags&Glb.OBJ_VISIBLE)==0){return false}if(this.Page>-1&&this.Parent.PanelPage!=this.Page){return false}if(this.Parent.PanelMode==Glb.PANEL_LIST){if((this.Flags&Glb.FLD_INLIST)>0){return true}}else{if((this.Flags&Glb.FLD_INFORM)>0){return true}}return false};PFieldSrv.prototype.SetRect=function(d,c,b,a){this.set_FldRect(d,c);this.HResMode[d]=b;this.VResMode[d]=a;if(d==0){this.RD3Change(RD3Glb.FLD_LISTHRESMODE);this.RD3Change(RD3Glb.FLD_LISTVRESMODE);this.DesignListRect=c}if(d==1){this.RD3Change(RD3Glb.FLD_FORMHRESMODE);this.RD3Change(RD3Glb.FLD_FORMVRESMODE);this.DesignFormRect=c}};PFieldSrv.prototype.SetHeaderSize=function(b,a){this.HeaderSize[b]=a;if(b==0){this.RD3Change(RD3Glb.FLD_LISTHDRSIZE)}if(b==1){this.RD3Change(RD3Glb.FLD_FORMHDRSIZE)}};PFieldSrv.prototype.set_HdrSize=function(b,a){this.SetHeaderSize(b,a)};PFieldSrv.prototype.HdrSize=function(a){return this.HeaderSize[a]};PFieldSrv.prototype.SetVisualStyle=function(c){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.VisualStyle!=c){var a=(this.VisualStyle==0?1:this.Parent.VS.ControlType(this.VisualStyle));var b=(c==0?1:this.Parent.VS.ControlType(c));if(b==Glb.VISCTRL_HTMLEDIT){this.Parent.SetFieldEditor(this.Index,1)}else{if(a==Glb.VISCTRL_HTMLEDIT){this.Parent.SetFieldEditor(this.Index,0)}}this.VisualStyle=c;this.RD3Change(RD3Glb.FLD_VISATTR)}}else{this.Values[this.Parent.ValidatingRow].VisualStyle=c}};PFieldSrv.prototype.SetDynFlags=function(a,b){if((b&Glb.OBJ_VISIBLE)>0){this.Values[this.Parent.ValidatingRow].Visible=((a&Glb.OBJ_VISIBLE)!=0)?1:0}if((b&Glb.OBJ_ENABLED)>0){this.Values[this.Parent.ValidatingRow].Enabled=((a&Glb.OBJ_ENABLED)!=0)?1:0}};PFieldSrv.prototype.GetDynFlags=function(){var a=this.Flags;if(this.Values[this.Parent.ValidatingRow].LastVisible==0){a=a&(~Glb.OBJ_VISIBLE)}if(this.Values[this.Parent.ValidatingRow].LastEnabled==0){a=a&(~Glb.OBJ_ENABLED)}return a};PFieldSrv.prototype.AddVLItem=function(c,a,e,d,f){var b=new PVLItemSrv();b.Name=a;b.Description=e;b.Image=d;b.Value=c;b.VisIdx=f;this.ValueList.Add(b)};PFieldSrv.prototype.IsVertHeader=function(a){if(a==Glb.PANEL_LIST){return(this.Flags&Glb.FLD_VERTHDRLIST)!=0}else{return(this.Flags&Glb.FLD_VERTHDRFORM)!=0}};PFieldSrv.prototype.IsHeaderHidden=function(a){if(a==Glb.PANEL_LIST){return(this.Flags&Glb.FLD_NOHDRLIST)!=0}else{return(this.Flags&Glb.FLD_NOHDRFORM)!=0}};PFieldSrv.prototype.GetHeaderRect=function(a){var b=new RectSrv();if(a==Glb.PANEL_LIST&&(this.Flags&Glb.FLD_LISTLIST)!=0){b.Left=this.ListLeft;b.Top=this.Parent.ListTop;b.Width=this.ListWidth;b.Height=this.Parent.HeaderSize;return b}if(!this.IsHeaderHidden(a)){b=this.FldRect(a);if(this.IsVertHeader(a)){b.Height=this.HeaderSize[a]}else{b.Width=this.HeaderSize[a]}}return b};PFieldSrv.prototype.GetValueRect=function(b,a){var c=this.FldRect(b);if(b==Glb.PANEL_LIST&&(this.Flags&Glb.FLD_LISTLIST)!=0){c.Top=c.Top+a*(this.Parent.MaxHRow+this.Parent.OffsetRow());return c}if(!this.IsHeaderHidden(b)){if(this.IsVertHeader(b)){c.Height=c.Height-this.HeaderSize[b]-Glb.HEADER_GAP;c.Top=c.Top+this.HeaderSize[b]+Glb.HEADER_GAP}else{c.Width=c.Width-this.HeaderSize[b]-Glb.HEADER_GAP;c.Left=c.Left+this.HeaderSize[b]+Glb.HEADER_GAP}}return c};PFieldSrv.prototype.IsComboOptional=function(b){if((this.Flags&Glb.FLD_ISOPT)!=0){return true}else{if(this.Parent.Status()==Glb.PS_QBE){return true}else{if(this.Values[b].Value.Type==IDVariant.NULL){return true}else{if(this.ValueList.Count()>0){var c=false;for(var a=0;a<this.ValueList.Count();a++){if(this.Values[b].Value.equals(this.ValueList[a].Value)){c=true;break}}return !c}else{if(this.QueryValueSource!=null&&this.QueryValueSource.RS!=null){var c=false;this.QueryValueSource.RS.MoveFirst();while(!this.QueryValueSource.RS.EOF()){if(this.Values[b].Value.equals(this.QueryValueSource.RS.Get(1))){c=true;break}this.QueryValueSource.RS.MoveNext()}this.QueryValueSource.RS.MoveFirst();return !c}}}}}return false};PFieldSrv.prototype.GetDisabledComboHtml=function(d){var c="";var b=this.GetVisualStyle(d);var e=this.GetValueRect(this.Parent.PanelMode,0);var a=(this.Values[d].ValueListIndexes.length>0?this.Values[d].ValueListIndexes[0]:null);if(a!=null){if(this.CanActivate(d)&&(this.VisFlags(d)&Glb.FL_VIS_HYPERLINK)!=0){c+='<span style="position:absolute;'+this.Parent.VS.GetWebRect(b,(this.Parent.PanelMode==Glb.PANEL_FORM?Glb.VISBDI_VALFORM:Glb.VISBDI_VALUE),0,0,-999,-999,Glb.WEBSTY_SPAN,this.Parent.MainFrm.BrowserClass)+'">';c+="<input "+this.Parent.MainFrm.DTTObj.GetDTTID(this.iGuid,d+"act")+"type=image name=A"+this.Parent.FrIndex+"C"+this.Index+"R"+d+' src="images/tsubmit.gif" style="'+this.Parent.VS.GetWebRect(b,(this.Parent.PanelMode==Glb.PANEL_FORM?Glb.VISBDI_VALFORM:Glb.VISBDI_VALUE),-999,-999,e.Width,e.Height,Glb.WEBSTY_INP,this.Parent.MainFrm.BrowserClass)+'">';c+="</span>"}if(a.Image.length>0&&(this.VisFlags(d)&Glb.FL_VIS_SHOWIMAGE)!=0){c+='<img src="images/'+a.Image+'" align=top';if(this.Values[d].Tooltip.length==0&&!a.Description.equals("")){c+=' alt="'+Glb.HTMLEncode(a.Description)+'"'}c+=">&nbsp; "}if(a.Name.length>0&&(this.VisFlags(d)&Glb.FL_VIS_SHOWDESCR)!=0){c+=Glb.HTMLEncode(a.Name)}}return c};PFieldSrv.prototype.set_BuffSize=function(c){var a=new Array(c);for(var b=0;b<c;b++){if(b<this.Values.length&&this.Values[b]!=null){a[b]=this.Values[b]}else{a[b]=new PValueSrv(this,b);this.CalculateMask=true}}this.Values=a};PFieldSrv.prototype.ProcessRequest=function(f){if(!this.IsPresent()||this.IdxPanel<0||this.DataType==Glb.DT_DOC_OLE){return false}if(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams==null){return false}var b=0;var a=this.Parent.NumRows-1;if(this.Parent.PanelMode==Glb.PANEL_LIST&&(this.Flags&Glb.FLD_LISTLIST)==0){b=this.Parent.AttR;a=this.Parent.AttR}var c=false;var g=this.Parent.MainFrm;for(var e=b;e<=a;e++){var j;if(g.RDStatus==Glb.RD_ACTIVE){var h=new IDVariant(g.GetParameter("F"+this.Parent.FrIndex+"C"+this.Index+"R"+e));if(h.Type==IDVariant.NULL){continue}j=h.stringValue()}else{j=g.GetParameter("F"+this.Parent.FrIndex+"C"+this.Index+"R"+e)}if(j==null){j=""}var d=this.ProcessRowChange(g,j,e);c=c||d}return c};PFieldSrv.prototype.ProcessRowChange=function(d,g,q){if(this.DataType==Glb.DT_CHAR&&g.trim().length==0){g=g.trim()}var a=false;var v=g;var m=(g.length==0);if(this.Parent.Status()==Glb.PS_QBE){if(m||(g.charAt(0)=="="&&!this.HasConcept("DO_ID"))){this.iMultiCriteria=false}else{this.iMultiCriteria=(g.indexOf(this.GetQBESep())>0)}}if(this.IsEnabled(q,false)&&((this.Flags&Glb.FLD_AUTOLOOKUP)==0||(this.Flags&Glb.FLD_CANACTIVATE)==0||this.Parent.MainFrm.ParamsObj().UseRD3)){var b=(this.Parent.VS.Flags(this.GetVisualStyle(q))&Glb.FL_VIS_PASSWORD)!=0;if(b){var x=true;for(var n=0;n<g.length&&x;n++){if(g.charAt(n)!="*"){x=false}}if(x){g=""}}if(this.IdxPanel>0){if(this.Parent.Queries[this.IdxPanel].LKEParams!=null&&g.length>3&&g.substr(0,3).equals("LKE")){g=g.substr(3);if(g.equals("NULL")){var u=this.Values[q].GetLkeRS();if(u!=null){a=this.Parent.bQueries(this.IdxPanel).GetLKERow(-1,q,true,u,-1);this.Values[q].SetLkeRS(null);if(!a){this.Values[q].SetValue(this.Values[q].OrgValue);this.Values[q].RD3Change(RD3Glb.VAL_TEXT)}}g=null}else{if(g.equals("MORE")){this.Activate(q);this.Values[q].SetLkeRS(null);this.Values[q].RD3Change(RD3Glb.VAL_TEXT);g=null}else{if(g.equals("PREC")){this.Values[q].SetValue(this.Values[q].OrgValue);this.Values[q].RD3Change(RD3Glb.VAL_TEXT);this.Values[q].SetLkeRS(null);g=null}else{var t=("LKE"+g).split(";");for(var o=0;o<t.length;o++){g=t[o];if(!g.startsWith("LKE")){this.Parent.Queries[this.IdxPanel].UpdateLookup(0,d);break}try{var c=parseInt(g.substr(3),10);if(c>0){var u=this.Values[q].GetLkeRS();if(u!=null){a=this.Parent.Queries[this.IdxPanel].GetLKERow(c,q,false,u,o);if(!a){this.Values[q].SetValue(this.Values[q].OrgValue);this.Values[q].RD3Change(RD3Glb.VAL_TEXT)}}g=null}}catch(r){}}this.Values[q].SetLkeRS(null)}}}}}if(g!=null&&(!b||g.length>0||m)){var y=this.Values[q].Modified;if(this.CtrlType(q)==Glb.VISCTRL_CHECK){if(this.ValueList.Count()==0){d.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",104,"PField.ProcessRequest","Row "+(this.Parent.AttR+1)+" Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": can't set value because cell is a checkbox but it has no value list")}else{var f=(this.Parent.MainFrm.BrowserInfo(false)==1&&this.Parent.MainFrm.BrowserInfo(true)<10)||(this.Parent.MainFrm.BrowserInfo(false)==3&&this.Parent.MainFrm.BrowserInfo(true)<6);if(this.Parent.Status()==Glb.PS_QBE&&(g=="---"||(g.length==0&&f))){a=this.Values[q].SetNewValue(new IDVariant())}else{if(!(this.Parent.Status()==Glb.PS_DATA&&g.length==0&&IDL.IsNull(this.Values[q].Value))){a=this.Values[q].SetCheck(g,this.Parent.Status()!=Glb.PS_QBE)}}}}else{if((this.Flags&Glb.FLD_AUTOLOOKUP)>0&&!(this.Parent.Status()==Glb.PS_QBE&&this.iMultiCriteria)){a=this.Values[q].SetNewAutoLookupValue(g)}else{a=this.Values[q].SetNewText(g,this.Parent.Status()!=Glb.PS_QBE)}}if(!y&&this.IdxPanel==0&&!this.Values[q].Value.equals(this.Values[q].LastValue)){var h=true;if(this.Values[q].Value.Type==IDVariant.STRING&&this.Values[q].LastValue.Type==IDVariant.STRING){if(this.Values[q].Value.stringValue().trim()==this.Values[q].LastValue.stringValue().trim()){h=false}}if(this.ValueList.Count()>0&&this.CtrlType(q)==Glb.VISCTRL_CHECK&&this.Values[q].LastValue.Type==IDVariant.NULL&&this.Values[q].Value.intValue()==0){h=false}if(h){d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",104,"PField.ProcessRequest","Row "+(this.Parent.AttR+1)+" Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": value changed from "+Glb.HTMLEncode(this.Values[q].LastValue.toString(),true,false)+" to "+Glb.HTMLEncode(this.Values[q].Value.toString(),true,false)+" for row "+(q+1)+(this.Unbound?" (UNBOUND)":""));d.DTTObj.SetRequestName("Panel Modified","Panel "+this.Parent.GetDTTCaption()+" modified",DTTRequest.PRI_DATA);d.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_FLDCHG,"Field "+this.GetDTTCaption()+" value changed",v,q);if((this.Flags&Glb.FLD_AUTOLOOKUP)>0){if(this.QueryValueSource==null){for(var l=0;l<this.Parent.UQueries();l++){if(this.Parent.bQueries(l).FieldIndex==this.Index){this.QueryValueSource=this.Parent.bQueries(l);break}}}d.DTTObj.AddHelpItem(0,0,0,0,"Cambia il valore del campo "+this.GetDTTCaption()+(this.Tooltip!=null&&this.Tooltip.length>0?" ("+this.Tooltip+")":"")+" sulla la riga "+(q+1)+" in "+this.QueryValueSource.GetValueSourceValue(this.Values[q].Value));this.QueryValueSource=null}else{if(this.ValueList.Count()>0&&this.Values[q].ValueListIndexes.length>0){if(this.CtrlType(q)==Glb.VISCTRL_CHECK){d.DTTObj.AddHelpItem(0,0,0,0,(this.Values[q].ValueListIndexes[0]==this.ValueList[0]?"Attiva":"Disattiva")+" il checkbox nel campo "+this.GetDTTCaption()+(this.Tooltip!=null&&this.Tooltip.length>0?" ("+this.Tooltip+")":"")+" sulla la riga "+(q+1))}else{d.DTTObj.AddHelpItem(0,0,0,0,"Cambia il valore del campo "+this.GetDTTCaption()+(this.Tooltip!=null&&this.Tooltip.length>0?" ("+this.Tooltip+")":"")+" sulla la riga "+(q+1)+" in "+this.Values[q].GetComboName())}}else{d.DTTObj.AddHelpItem(0,0,0,0,"Cambia il valore del campo "+this.GetDTTCaption()+(this.Tooltip!=null&&this.Tooltip.length>0?" ("+this.Tooltip+")":"")+" sulla la riga "+(q+1)+" in "+this.Values[q].Text)}}}}if(this.Unbound&&this.Values[q].Modified&&this.Parent.Status()!=Glb.PS_QBE){this.Parent.Queries[0].WriteUnboundValue(q,this)}if(!this.CauseValidation&&this.Values[q].Modified&&this.Parent.Status()!=Glb.PS_QBE){this.Values[q].LastRDText=this.GetRD2Text(q);this.Values[q].Modified=false;a=false}if(this.IdxPanel>0&&a){this.Parent.Queries[this.IdxPanel].AddLKERow(q);this.Values[q].LastRDText=this.GetRD2Text(q);this.Values[q].Modified=false;a=false}}}if(a){this.Parent.SetRDRowSel(q,true);this.Values[q].LastRDText=this.GetRD2Text(q)}return a};PFieldSrv.prototype.ClearBuffer=function(c){var a=this.Parent.ValidatingRow;for(var b=0;b<this.Values.length;b++){this.Parent.ValidatingRow=b;this.Values[b].Clear(c)}this.Parent.ValidatingRow=a};PFieldSrv.prototype.SetBuffer=function(b,a,c){this.GetRSIdx(a);if((this.DataType==Glb.DT_DOC_OLE)){this.Values[b].SetValue(new IDVariant(c.GetBlobFromCache(this.Index,this.GetRSIdx(null),this.MaxAutoShowSize)));this.Values[b].SetOriginal()}else{try{this.Values[b].SetValue(Glb.GetTD(a.Get(this.GetRSIdx(null)),this.Transformation,this.TrFormat,this.TrOffset,this.MaxLength))}catch(d){}if((this.Values[b].Text.length>this.MaxLength)){if(Glb.ClassDT(this.DataType)==Glb.DTC_NUMBER){var f=this.Values[b].Text.length;if(this.Values[b].Text.substr(0,1).equals("-")){f=f-1}if(this.Values[b].Text.indexOf(".")!=-1){f=f-1}if(f>this.MaxLength){this.MaxLength=f;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}else{this.MaxLength=this.Values[b].Text.length;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}this.Values[b].SetOriginal()}if(this.Values[b].Value.Type==IDVariant.DECIMAL&&this.vScale>0){this.Values[b].Value.Value=Math.round((this.Values[b].Value.Value*(Math.pow(10,this.vScale))))/Math.pow(10,this.vScale)}};PFieldSrv.prototype.SetIMDBBuffer=function(a,d,b){this.GetRSIMDBIdx(d);if((this.DataType==Glb.DT_DOC_OLE)){this.Values[a].SetValue(new IDVariant(b.GetBlobFromCache(this.Index,this.GetRSIdx(null),this.MaxAutoShowSize)));this.Values[a].SetOriginal()}else{this.Values[a].SetValue(this.Parent.IMDB.Value(d,this.GetRSIdx(null),Glb.IMDB_CURSOR));this.Values[a].SetOriginal();if((this.Values[a].Text.length>this.MaxLength)){if(Glb.ClassDT(this.DataType)==Glb.DTC_NUMBER){var c=this.Values[a].Text.length;if(this.Values[a].Text.substr(0,1).equals("-")){c=c-1}if(this.Values[a].Text.indexOf(".")!=-1){c=c-1}if(c>this.MaxLength){this.MaxLength=c;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}else{this.MaxLength=this.Values[a].Text.length;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}}};PFieldSrv.prototype.SetDOBuffer=function(d,b,e,c){if(c==undefined){c=-1}var a=this.GetDOIdx(b);if(this.DataType==Glb.DT_DOC_OLE){this.Values[d].SetValue(new IDVariant(e.GetBlobFromCache(this.Index,this.GetRSIdx(null),this.MaxAutoShowSize)));this.Values[d].RD3Change(RD3Glb.VAL_TEXT);this.Values[d].SetOriginal()}else{var g=null;if(a<1){if(this.IsNamed){g=b.GetNamedPropertyValue(this.Code)}else{g=new IDVariant(this.Code)}}else{g=b.GetPropByIndex(a)}if(c>0){g=new IDVariant(this.Values[d].Text+this.Parent.MainFrm.ComboNameSep+g.stringValue())}if(this.IsNamed&&this.Values[d].Text!=g.stringValue()){this.Values[d].RD3Change(RD3Glb.VAL_TEXT)}this.Values[d].SetValue(g);this.Values[d].SetOriginal();if(this.Values[d].Text.length>this.MaxLength){if(Glb.ClassDT(this.DataType)==Glb.DTC_NUMBER){var f=this.Values[d].Text.length;if(this.Values[d].Text.substr(0,1).equals("-")){f=f-1}if(this.Values[d].Text.indexOf(".")!=-1){f=f-1}if(f>this.MaxLength){this.MaxLength=f;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}else{this.MaxLength=this.Values[d].Text.length;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}}};PFieldSrv.prototype.GetRSIdx=function(a){var b;if(this.Transformation==Glb.TRANSF_SUBSTR||this.Transformation==Glb.TRANSF_C2TOI){b=this.TrFormat}else{b=this.Code}if(a!=null&&this.RSIdx==-1){try{this.RSIdx=a.findColumn(b)}catch(c){}}if(a!=null&&this.RSIdx==-1){try{this.RSIdx=a.findColumn(b.toUpperCase())}catch(c){}}if(a!=null&&this.RSIdx!=-1){a.setColUnbound(this.RSIdx,this.Unbound)}return this.RSIdx};PFieldSrv.prototype.GetRSIMDBIdx=function(a){if(this.RSIdx==-1){this.RSIdx=this.Parent.IMDB.FldByCode(a,this.Code)}return this.RSIdx};PFieldSrv.prototype.bValues=function(a){return this.Values[a]};PFieldSrv.prototype.UValues=function(){return this.Values.length};PFieldSrv.prototype.GetIMDBIdx=function(){if(this.ImdbIdx==-2){if(this.Parent.MstTblIndex>-1){this.ImdbIdx=this.Parent.IMDB.FldByCode(this.Parent.MstTblIndex,this.Code)}else{this.ImdbIdx=-1}}return this.ImdbIdx};PFieldSrv.prototype.GetDOIdx=function(a){if(this.RSIdx==-1&&a!=null){this.RSIdx=a.GetPropIndex(this.Code);if(this.RSIdx<1){this.RSIdx=a.GetPropertyIndex(this.Code)}if(this.RSIdx<1){var b=a.GetNamedPropertyDefinition(this.Code);if(b.DataType!=0){this.IsNamed=true;this.DataType=b.DataType;this.RD3Change(RD3Glb.FLD_DATATYPE);if(b.MaxLength!=0){this.MaxLength=b.MaxLength;this.vScale=b.vScale;this.RD3Change(RD3Glb.FLD_MAXLENGTH);this.RD3Change(RD3Glb.FLD_SCALE)}if(b.UIName!=null&&b.UIName.length>0){this.Header=b.UIName;this.AbbrHeaderForm=b.UIName;this.AbbrHeaderList=b.UIName;this.RD3Change(RD3Glb.FLD_HEADER);this.RD3Change(RD3Glb.FLD_FORMHEADER);this.RD3Change(RD3Glb.FLD_LISTHEADER)}}}}return this.RSIdx};PFieldSrv.prototype.UpdateField=function(e,d){if(e==undefined||e instanceof IDVariant){e=null;d=this.Parent.AttR}else{if(typeof(e)=="number"){d=e;e=null}}var a;if(d<0||d>=this.Values.length){return false}if(e==null){this.GetIMDBIdx();if(this.ImdbIdx<0){return false}a=this.Parent.IMDB.Value(this.Parent.MstTblIndex,this.ImdbIdx,0)}else{a=e}var f=this.Values[d].Value;if(!a.equals(f)){var c=this.Values[d].SetNewValue(a);if((this.Flags&Glb.FLD_AUTOLOOKUP)!=0){for(var b=0;b<this.Parent.UQueries();b++){if(this.Parent.bQueries(b).FieldIndex==this.Index){this.Parent.bQueries(b).UpdateLookup(d,this.Parent.MainFrm);break}}}if(this.Parent.MainFrm!=null){this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",103,"PField.UpdateField","Row "+(d+1)+" Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": value changed from "+f.toString()+" to "+a.toString())}if(this.Unbound&&this.Values[d].Modified&&this.Parent.Status()!=Glb.PS_QBE){this.Parent.Queries[0].WriteUnboundValue(d,this)}if(!this.CauseValidation&&this.Values[d].Modified&&this.Parent.Status()!=Glb.PS_QBE){this.Values[d].Modified=false;c=false}return c}else{return false}};PFieldSrv.prototype.DeleteBlob=function(c){var a=this.Parent.bQueries(0).GetBlobData(this.Index,this.Values[this.Parent.AttR].Value.intValue());if(a!=null){this.Parent.bQueries(0).DeleteBlob(c,a);this.Values[this.Parent.AttR].RD3Change(RD3Glb.VAL_TEXT)}};PFieldSrv.prototype.ValidateCell=function(e){if(this.IdxPanel!=0){return}var b=this.Values[e].NotValidated;var d=this.Values[e].IsError();this.Values[e].ClearError();var f=this.Parent.bQueries(0).RecordCount();var a=this.Parent.bQueries(0).GetAttRecNumber()+e;if(this.Values[e].Modified||b||d||a>f){var c=new IDVariant();this.Parent.FireValidateCell(new IDVariant(this.Index),new IDVariant(this.Values[e].Modified),c,new IDVariant(this.Values[e].LastModified),new IDVariant(true),new IDVariant(a>f))}if((this.Flags&Glb.FLD_ISOPT)==0&&(IDL.IsNull(this.Values[e].Value))&&this.IsEnabled(e,false)&&!b&&(!this.Parent.bQueries(0).IsDO||this.IsExtended)){if(this.Parent.CanAddErrMsg(e,IDPanelSrv.EM_FIELD)){this.Values[e].SetError(this.Parent.MainFrm.RTCObj.GetConst("A61E8784-7812-44E2-9001-937ED881302F","E' necessario inserire un valore"),IDDocument.ERR_ERROR)}if(this.Parent.CanAddErrMsg(e)){this.Parent.Parent.SetMessage(this,AMessageSrv.MSG_STOP,this.Values[e].GetErrorText(),"","VAL",(this.Parent.NumRows>1)?e+1:0,false);if(this.IsPresent()&&this.IsVisible(e)&&this.Parent.Parent.FocusPriority==0){this.Parent.SetInput(e,this.Index,1,false)}}this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,181,"PField.ValidateCell","Panel "+this.Parent.GetDTTCaption()+": error for field "+this.GetDTTCaption()+" at row "+(e+1)+" - "+this.Values[e].GetErrorText())}};PFieldSrv.prototype.GetVisualStyle=function(a){if(this.Values[a].VisualStyle==-1){return this.VisualStyle}else{return this.Values[a].VisualStyle}};PFieldSrv.prototype.IsVisible=function(b,a){if(a==undefined){a=true}if(this.Page!=-1){if((this.Parent.bPages(this.Page).Flags&Glb.OBJ_VISIBLE)==0){return false}}if(this.Group!=-1){if((this.Parent.bGroups(this.Group).Flags&Glb.OBJ_VISIBLE)==0){return false}}if((this.Flags&Glb.OBJ_VISIBLE)==0){return false}if(b<0||b>=this.Values.length){return false}if(this.Values[b].Visible==-1||!a){return(this.Flags&Glb.OBJ_VISIBLE)!=0}else{return this.Values[b].Visible==1}};PFieldSrv.prototype.IsEnabled=function(c,b,d){if(b==undefined){b=false}if(d==undefined){d=false}if(this.IdxPanel<0&&!d){return false}if(this.IdxPanel>0&&!d){if(this.Parent.Queries[this.IdxPanel].LKEParams==null){return false}}if(!this.IsVisible(c)){return false}if(this.Parent.Status()==Glb.PS_QBE){return(this.Parent.Flags&Glb.PAN_CANSELECT)!=0&&c==0&&this.QBEEnabled}var e=this.Parent.bQueries(0).RecordCount();var a=this.Parent.bQueries(0).GetAttRecNumber()+c;if(a>e&&(this.Parent.Flags&Glb.PAN_CANINSERT)==0&&!b){return false}if(a<=e&&(this.Parent.Flags&Glb.PAN_CANUPDATE)==0&&!b&&(!this.Parent.IsDO()||(this.Parent.GetDocument(c)!=null&&(!this.Parent.GetDocument(c).Inserted()||(this.Parent.Flags&Glb.PAN_CANINSERT)==0)))){return false}if(this.DataType==Glb.DT_DOC_OLE&&(a>e||this.Parent.iStatus!=Glb.PS_DATA)&&!b){return false}if(this.Unbound&&a>e&&!b){return false}if(this.Parent.Locked()&&this.CauseValidation){return false}if(this.Page!=-1){if((this.Parent.bPages(this.Page).Flags&Glb.OBJ_ENABLED)==0){return false}}if(this.Group!=-1){if((this.Parent.bGroups(this.Group).Flags&Glb.OBJ_ENABLED)==0){return false}}if((this.Flags&Glb.OBJ_ENABLED)==0){return false}if(this.Values[c].Enabled==-1){return(this.Flags&Glb.OBJ_ENABLED)!=0}else{return this.Values[c].Enabled==1}};PFieldSrv.prototype.IsEnabledButton=function(){if(this.IdxPanel>=0){return false}if((this.Flags&Glb.OBJ_ENABLED)==0&&(this.Flags&Glb.FLD_NOACTD)!=0){return false}if(this.Parent.VS.ControlType(this.VisualStyle)==Glb.VISCTRL_BUTTON){return true}return false};PFieldSrv.prototype.IsFieldEnabled=function(a){if(this.IdxPanel<0){return((this.Flags&Glb.OBJ_ENABLED)!=0)}return this.IsEnabled(a)};PFieldSrv.prototype.ResetDynProp=function(){for(var a=0;a<this.Values.length;a++){this.Values[a].ClearDynProp()}};PFieldSrv.prototype.CanActivate=function(b,d){if(d==undefined){d=true}var c=this.IsEnabled(b,false,true);if((this.Flags&Glb.FLD_NOACTD)!=0&&!c){return false}if((this.VisFlags(b)&Glb.FL_VIS_HYPERLINK)!=0){return true}if((this.Flags&Glb.FLD_CANACTIVATE)!=0){return true}if(c&&d){for(var a=0;a<this.Parent.UQueries();a++){if(this.Parent.bQueries(a).FieldIndex==this.Index&&(this.Flags&Glb.FLD_AUTOLOOKUP)==0){return true}}}return false};PFieldSrv.prototype.CouldActivate=function(b){if((this.VisFlags(b)&Glb.FL_VIS_HYPERLINK)!=0){return true}if((this.Flags&Glb.FLD_CANACTIVATE)!=0){return true}for(var a=0;a<this.Parent.UQueries();a++){if(this.Parent.bQueries(a).FieldIndex==this.Index&&(this.Flags&Glb.FLD_AUTOLOOKUP)==0){return true}}return false};PFieldSrv.prototype.Activate=function(f){if(this.IsEnabled(f,false)&&(this.Flags&Glb.FLD_CANACTIVATE)==0){for(var g=0;g<this.Parent.UQueries();g++){if(this.Parent.bQueries(g).FieldIndex==this.Index){this.QueryValueSource=this.Parent.bQueries(g);this.Values[f].RD3Change(RD3Glb.VAL_VALUELIST);return}}}if(this.Parent.MainFrm!=null){this.Parent.MainFrm.ActivedDocument=null;this.Parent.MainFrm.ActivedProperty=null;this.Parent.MainFrm.ActivedExtProperty=null}var m=this.Parent.GetDocument(f);if(m!=null&&this.Parent.MainFrm!=null&&this.IdxPanel>=0){this.Parent.MainFrm.ActivedDocument=m;var c=m.GetMD();var k=null;if(this.IdxPanel==0){if(this.GetDOIdx(m)>0){k=c.GetProp(this.GetDOIdx(m));this.Parent.MainFrm.ActivedProperty=k}}else{var l=this.Parent.bQueries(this.IdxPanel).GetMstField();if(l!=null&&l.GetDOIdx(m)>0){k=c.GetProp(l.GetDOIdx(m));this.Parent.MainFrm.ActivedProperty=k}}if(k!=null){if(k.ExtPropIdx>0){var j=null;try{j=m.GetExtSchema()}catch(h){this.Parent.MainFrm.DTTObj.AddException(this.iGuid,"PField.Activate","Can't get Extended Schema",h)}var b=j.GetProp(k.ExtPropIdx);if(j!=null){this.Parent.MainFrm.ActivedExtProperty=b}if(b.Lookup!=null&&b.Lookup.length>0){this.Parent.MainFrm.Show(b.Lookup,1,this.Parent.Parent);return}}}}var n=new IDVariant();this.Parent.FireCellActivated(new IDVariant(this.Index),n);if(n.isFalse()&&f<this.UValues()&&(this.VisFlags(f)&Glb.FL_VIS_HYPERLINK)!=0){var a="";if(this.IdxPanel==-1){a=this.Header}else{a=this.Values[f].Text}if(a.indexOf("://")>0){this.Parent.MainFrm.set_RedirectTo(new IDVariant(a));this.Parent.MainFrm.set_RedirectNewWindow(this.Parent.Parent.MainFrm.ShiftKey())}}};PFieldSrv.prototype.Colors=function(a,b){return this.Parent.VS.Color(this.GetVisualStyle(b),a)};PFieldSrv.prototype.GradColor=function(a,b){if(this.Colors(a,b)!=-1){return this.Parent.VS.GradCol(this.GetVisualStyle(b),a)}else{return -1}};PFieldSrv.prototype.GradDir=function(a,b){return this.Parent.VS.GradDir(this.GetVisualStyle(b),a)};PFieldSrv.prototype.Opacity=function(a,b){return this.Parent.VS.Opacity(this.GetVisualStyle(b),a)};PFieldSrv.prototype.Fonts=function(a,b){return this.Parent.VS.Font(this.GetVisualStyle(b),a)};PFieldSrv.prototype.AutoAlign=function(a){return this.Parent.VS.Alignment(this.GetVisualStyle(a),Glb.VISALI_VALUE)==Glb.VISALN_AUTO};PFieldSrv.prototype.CtrlType=function(a){return this.Parent.VS.ControlType(this.GetVisualStyle(a))};PFieldSrv.prototype.VisFlags=function(a){return this.Parent.VS.Flags(this.GetVisualStyle(a))};PFieldSrv.prototype.HdrFormStyle=function(a){return Glb.WebBorderStyle(this.Parent.VS.BorderType(this.GetVisualStyle(a),Glb.VISBDI_HDRFORM),false)};PFieldSrv.prototype.IsRightAligned=function(c,a){var b;if(c==-1){b=this.Parent.VS.Alignment(this.VisualStyle,(a)?Glb.VISALI_HDRFORM:Glb.VISALI_HDRLIST)}else{b=this.Parent.VS.Alignment(this.GetVisualStyle(c),Glb.VISALI_VALUE)}if(b==Glb.VISALN_AUTO){if(Glb.ClassDT(this.DataType)==Glb.DTC_NUMBER&&((this.Flags&Glb.FLD_AUTOLOOKUP)==0)){b=Glb.VISALN_DX}else{b=Glb.VISALN_SX}}return(b==Glb.VISALN_DX)};PFieldSrv.prototype.ToString=function(){return this.Header};PFieldSrv.prototype.GetClientMask=function(g,u,v,A,t,f,a,k){var x;var o;if(this.Parent.MainFrm.ParamsObj().UseClientMask){if((this.Parent.Status()==Glb.PS_QBE||(this.Flags&Glb.FLD_AUTOLOOKUP)!=0)&&("=<>".indexOf(A)==-1||A.length==0)){g.set(new IDVariant(t));u.set(new IDVariant(""))}else{switch(Glb.ClassDT(this.DataType)){case Glb.DTC_CHAR:f.set(new IDVariant("A"));x=A;if(A.equals(">")){g.set(new IDVariant(t.toUpperCase()));u.set(new IDVariant(A))}else{if(A.equals("<")){g.set(new IDVariant(t.toLowerCase()));u.set(new IDVariant(A))}else{if(A.length>0&&!(this.IdxPanel>0&&(this.Flags&Glb.OBJ_ENABLED)!=0)){var n=x.charAt(x.length-1);if(k&&(n=="A"||n=="a"||n=="&"||n=="#"||n=="%")){while(x.length<this.MaxLength){x+=n}}if(x.length>this.MaxLength){x=x.remove(this.MaxLength,x.length-this.MaxLength)}o=x;var q=0;var b=true;for(var s=0;s<o.length;s++){var m=o.charAt(s);if(m=="A"||m=="a"||m=="&"||m=="#"||m=="%"){if(q>=t.length){o=o.remove(s,o.length-s);break}o=o.substr(0,s)+t.charAt(q)+o.substr(s+1);q++;b=false}else{if(b&&q<t.length){if(o.charAt(s)==t.charAt(q)){q++}else{q=0;b=false}}else{if(!b&&q<t.length){if(o.charAt(s)==t.charAt(q)){q++}}else{o=o.remove(s,o.length-s);break}}}}g.set(new IDVariant(o));u.set(new IDVariant(x))}else{g.set(new IDVariant(t))}}}break;case Glb.DTC_DATE:f.set(new IDVariant("D"));if(A.length>0){u.set(new IDVariant(A))}else{switch(this.DataType){case Glb.DT_DATE:u.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultDateMask));break;case Glb.DT_TIME:u.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultTimeMask));break;case Glb.DT_DATETIME:u.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultDateMask+" "+this.Parent.MainFrm.ParamsObj().DefaultTimeMask));break}}if(u.stringValue().length==0){g.set(new IDVariant(t))}else{g.set(IDL.Format(v,u,this.Parent.MainFrm))}break;case Glb.DTC_NUMBER:f.set(new IDVariant("N"));if(A.length>0){u.set(new IDVariant(A))}else{switch(this.DataType){case Glb.DT_NUM_CURRENCY:u.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultCurrencyMask));break;case Glb.DT_NUM_FIXED:u.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultCurrencyMask));break;case Glb.DT_NUM_FLOAT:u.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultFloatMask));break;case Glb.DT_NUM_INTEGER:u.set(IDL.Add(IDL.Replicate(new IDVariant("#"),new IDVariant(this.MaxLength-1)),new IDVariant("0")));break}}if(u.stringValue().length==0){g.set(new IDVariant(t))}else{x=u.stringValue();var y=-1;var d=-1;var h=x.indexOf(".");switch(this.DataType){case Glb.DT_NUM_CURRENCY:y=this.MaxLength;if(h>-1){d=x.length-h-1}break;case Glb.DT_NUM_FIXED:y=this.MaxLength;d=this.vScale;break;case Glb.DT_NUM_INTEGER:y=this.MaxLength;d=0;break}var r=y-d;var c=0;if(r>0){if(h==-1){h=x.length}for(var e=h-1;e>=0;e--){if(x.charAt(e)=="0"||x.charAt(e)=="#"){c++;if(c==r){if(e>0){x=x.remove(0,e)}break}}}}h=x.indexOf(".");if(h>-1&&d>=0){r=d;if(r==0){x.length=h}else{c=0;for(var e=h+1;e<x.length;e++){if(x.charAt(e)=="0"||x.charAt(e)=="#"){c++;if(c==r){x.length=e+1;break}}}}}u.set(new IDVariant(x));g.set(IDL.Format(v,u,this.Parent.MainFrm));for(var e=0;e<x.length;e++){if(x.charAt(e)=="."){break}if(x.charAt(e)=="0"){x=x.substr(0,e)+"#"+x.substr(e+1)}}if(!this.Parent.MainFrm.ParamsObj().UseDecimalDot){h=x.indexOf(".");x.replace(",",".");if(h>=0){x=x.substr(0,h)+","+x.substr(h+1)}}u.set(new IDVariant(x))}break}if(a){g.set(new IDVariant(t))}}}else{if(this.Parent.Status()!=Glb.PS_QBE&&A.length>0){g.set(IDL.Format(v,new IDVariant(A),this.Parent.MainFrm))}else{g.set(new IDVariant(t))}u.set(new IDVariant(""))}};PFieldSrv.prototype.GetDTTCaption=function(){if(!this.Header.equals("")){return this.Header}else{if(this.AbbrHeaderList.length>this.AbbrHeaderForm.length){return this.AbbrHeaderList}else{return this.AbbrHeaderForm}}};PFieldSrv.prototype.UpdateSubFrame=function(){if(this.SubFrame<1||this.Parent.Parent==null){return}var a=this.Parent.Parent.Frames[this.SubFrame];a.Exposed=this.IsVisible(0)&&this.IsPresent();if(a.Width==0){a.Width=this.FormWidth-20;a.Height=this.FormHeight-20;a.RD3Change(RD3Glb.AFR_WIDTH);a.RD3Change(RD3Glb.AFR_HEIGHT)}if(a.Content!=null){a.Content.set_Exposed(this.IsVisible(0)&&this.IsPresent())}};PFieldSrv.prototype.IsReadOnly=function(a,b){if(this.Parent.MainFrm.ParamsObj().UseFK||this.Parent.MainFrm.ParamsObj().UseRD3){if((this.Flags&Glb.OBJ_ENABLED)==0||this.IdxPanel<0){return false}if(this.Parent.Status()==Glb.PS_QBE&&b>0){return false}if(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams==null){return false}if((this.Parent.VS.Flags(a)&Glb.FL_VIS_HYPERLINK)==0){return true}}return false};PFieldSrv.prototype.GetRD2Text=function(f){var e;var l=new IDVariant();var c=new IDVariant();var k=new IDVariant();var g;if(this.Parent.PanelMode==Glb.PANEL_LIST){g=this.ListNumRow>1}else{g=this.FormNumRow>1}var b=this.GetVisualStyle(f);var h=this.CtrlType(f);if(h==Glb.VISCTRL_CHECK&&this.ValueList.Count()>0){if(this.Values[f].ValueListIndexes.length>0&&this.Values[f].ValueListIndexes[0]==this.ValueList[0]){e="on"}else{e="no"}}else{if(this.ValueList.Count()>0&&(h==Glb.VISCTRL_COMBO||h==Glb.VISCTRL_AUTO)&&!this.IsEnabled(f)){e=this.GetDisabledComboHtml(f)}else{if(this.IsEnabled(f)&&(this.Flags&Glb.FLD_AUTOLOOKUP)!=0&&(this.Flags&Glb.FLD_CANACTIVATE)==0){e=this.Values[f].Value.toString()}else{var d=(this.Parent.VS.Flags(b)&Glb.FL_VIS_PASSWORD)!=0;if(d){e=IDL.Replicate(new IDVariant("*"),new IDVariant(this.Values[f].Text.length)).stringValue()}else{var a=this.Parent.VS.Mask(b);var j=true;if(!this.Values[f].DynMask.equals("")){a=this.Values[f].DynMask;j=false}else{if(!this.Mask.equals("")){a=this.Mask;j=false}}if(!a.equals("=")&&this.EditorType!=1){this.GetClientMask(l,c,this.Values[f].Value,a,this.Values[f].Text,k,this.Values[f].DynText,j);e=l.stringValue();this.Values[f].Text=e;this.Values[f].Mask=c.stringValue()}else{e=this.Values[f].Text}if(!this.IsEnabled(f)&&(!this.IsReadOnly(b,f)||g)){if(!a.equals("=")&&this.EditorType!=1){e=Glb.HTMLEncode(e);e=PFieldSrv.EncodeMultiLineSpaces(e);e=e.replace(/\r\n/g,"<br>");e=e.replace(/\r/g,"<br>");e=e.replace(/\n/g,"<br>")}}}}}}return e};PFieldSrv.prototype.Resize=function(c,b,f){var d;if(f==Glb.PANEL_LIST){d=(this.Flags&Glb.FLD_INLIST)!=0&&(this.Flags&Glb.FLD_LISTLIST)==0}else{d=(this.Flags&Glb.FLD_INFORM)!=0}if(d&&this.HResMode[f]==Glb.RESMODE_MOVE){if(f==Glb.PANEL_LIST){this.ListLeft=this.ListLeft+c;this.RD3Change(RD3Glb.FLD_LISTLEFT)}else{this.FormLeft=this.FormLeft+c;this.RD3Change(RD3Glb.FLD_FORMLEFT)}}if(d&&this.HResMode[f]==Glb.RESMODE_STRETCH){if(f==Glb.PANEL_LIST){this.ListWidth=this.ListWidth+c;this.RD3Change(RD3Glb.FLD_LISTWIDTH)}else{this.FormWidth=this.FormWidth+c;this.RD3Change(RD3Glb.FLD_FORMWIDTH)}}if(d&&this.VResMode[f]==Glb.RESMODE_MOVE){if(f==Glb.PANEL_LIST){this.ListTop=this.ListTop+b;this.RD3Change(RD3Glb.FLD_LISTTOP)}else{this.FormTop=this.FormTop+b;this.RD3Change(RD3Glb.FLD_FORMTOP)}}if(d&&this.VResMode[f]==Glb.RESMODE_STRETCH){if(f==Glb.PANEL_LIST){this.ListHeight=this.ListHeight+b;this.RD3Change(RD3Glb.FLD_LISTHEIGHT)}else{this.FormHeight=this.FormHeight+b;this.RD3Change(RD3Glb.FLD_FORMHEIGHT)}}if(this.SubFrame!=0&&(this.VResMode[f]==Glb.RESMODE_STRETCH||this.HResMode[f]==Glb.RESMODE_STRETCH)){var e=0;var a=0;if(f==Glb.PANEL_LIST){e=this.ListWidth-20;a=this.ListHeight-38}else{e=this.FormWidth-20;a=this.FormHeight-38}this.Parent.Parent.Frames[this.SubFrame].Content.Resize(e,a)}};PFieldSrv.prototype.CanResizeList=function(a,b){if(this.Page!=-1&&this.Page!=b){return false}if((this.Flags&Glb.OBJ_VISIBLE)==0){return false}if((this.Flags&Glb.FLD_INLIST)==0){return false}if((this.Flags&Glb.FLD_LISTLIST)==0){return false}if(this.HResMode[Glb.PANEL_LIST]!=Glb.RESMODE_STRETCH){return false}if(this.ListWidth<=48&&a<0){return false}return true};PFieldSrv.EncodeMultiLineSpaces=function(b){var f=b;var e=true;var a=true;for(var c=0;c<f.length;c++){var d=f.charAt(c);if(d==" "){if(!a){a=true}else{f=f.remove(c,1);f=f.insert(c,"&nbsp;");c+=5}}else{e=(d=="\r"||d=="\n");a=e}}return f};PFieldSrv.prototype.ExtendLookup=function(e,a){var d=this.Parent.Queries[this.IdxPanel].GetMstField();if(d!=null&&this.flLookupExtended!=a){this.flLookupExtended=a;var g=this.FormLeft;var b=this.HeaderSize[Glb.PANEL_FORM];var c=this.AbbrHeaderForm;this.FormWidth=this.FormWidth+this.FormLeft-d.FormLeft;this.FormLeft=d.FormLeft;this.HeaderSize[Glb.PANEL_FORM]=d.HeaderSize[Glb.PANEL_FORM];this.AbbrHeaderForm=d.AbbrHeaderForm;d.FormLeft=g;d.HeaderSize[Glb.PANEL_FORM]=b;d.AbbrHeaderForm=c;this.Parent.SetFlags(Glb.OBJ_FIELD,this.Index,a?0:Glb.FLD_NOHDRFORM,Glb.FLD_NOHDRFORM)}var f=this.Parent.Queries[this.IdxPanel];f.ExtendLookup(e)};PFieldSrv.prototype.EnterUploadMode=function(a){if(a==undefined){a=true}if(this.DataType==Glb.DT_DOC_OLE){if(this.bValues(this.Parent.AttR).Uploading!=a){this.Parent.Parent.ResetUpload();this.Parent.Parent.UploadingPanel=(a?this.Parent:null);this.bValues(this.Parent.AttR).Uploading=a;this.bValues(this.Parent.AttR).RD3Change(RD3Glb.VAL_TEXT)}}};PFieldSrv.prototype.GetRD3Name=function(){return"fld"};PFieldSrv.prototype.GetRD3Ident=function(b,a){if(b==undefined&&a==undefined){return this.GetRD3Name()+":"+this.Index+":"+this.Parent.FrIndex+":"+this.Parent.Parent.FormIdx}if(a||this.IdxPanel==-1){return this.GetRD3Ident()+(this.Parent.Layout()==Glb.PANEL_FORM?":fc":":lc")}else{if(this.Parent.Layout()==Glb.PANEL_FORM){return this.GetRD3Ident()+":fv"}else{if(b<0||b>=this.Parent.NumRows){b=this.Parent.SelectedRow()}return this.GetRD3Ident()+":lv"+b}}};PFieldSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};PFieldSrv.prototype.RD3RenderDifference=function(f,j,d){if(!d&&j&&this.Index==0){d=true}if(!d&&this.Parent.MainFrm.RD3CanOWA){d=true}if(!d&&(this.Flags&(Glb.FLD_INLIST|Glb.FLD_INFORM))==0){return false}if(this.CalculateMask&&this.Parent.Status()!=Glb.PS_QBE){this.CalculateMask=false;for(var g=0;g<this.Values.length;g++){this.GetRD2Text(g)}}var b=null;if(j){b=f.AddNewElement(this.GetRD3Name())}if(b==null&&this.RD3Changed){b=f.AddNewElement("chg")}if(b!=null){b.SetAttribute("id",this.GetRD3Ident())}var h=this.RD3Changed;if(j||this.RD3Changed){for(var e=0;e<this.RD3PropChg.length;e++){if(this.RD3PropChg[e]||j){this.SetRD3Property(e,b,j)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(j){if(this.MultiUpload){b.SetAttribute("mup",(this.MultiUpload?"1":"0"))}if(this.MaxUploadSize!=(10*1024*1024)){b.SetAttribute("mus",this.MaxUploadSize.toString())}if(this.MaxUploadFiles!=0){b.SetAttribute("muf",this.MaxUploadFiles.toString())}if(!this.UploadExtensions.equals("")){b.SetAttribute("uex",this.UploadExtensions)}if(!this.UploadDescription.equals("")){b.SetAttribute("uds",this.UploadDescription)}if(this.AggregateOfField>=0){b.SetAttribute("aof",this.AggregateOfField.toString())}if(this.HasConcept("DO_ID")){b.SetAttribute("cvs"," ")}var k=this.ChangeEventDef;if((this.Flags&Glb.FLD_ACTIVE)!=0){k|=RD3Glb.EVENT_IMMEDIATE}if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("clk",this.ClickEventDef.toString())}if(k!=(RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE)){b.SetAttribute("chg",k.toString())}if(this.Parent.MainFrm.RD3CanOWA&&!this.Parent.IsIMDB()){b.SetAttribute("dbc",this.Code);if((this.Flags&Glb.FLD_ISKEY)!=0){b.SetAttribute("ipk","1")}}if(!this.QBELike){b.SetAttribute("qbl","0")}}var c=(j)?b:f;var a=(d||(this.Parent.PanelMode==Glb.PANEL_LIST&&(this.Flags&Glb.FLD_INLIST)!=0)||(this.Parent.PanelMode==Glb.PANEL_FORM&&(this.Flags&Glb.FLD_INFORM)!=0));if(this.IdxPanel>-1&&a){if(j&&this.Parent.Status()==Glb.PS_QBE){h|=this.Values[0].RD3RenderDifferences(c,j)}else{for(var e=0;e<this.Values.length;e++){h|=this.Values[e].RD3RenderDifferences(c,j)}}}return h};PFieldSrv.prototype.SetRD3Property=function(y,u,E){switch(y){case RD3Glb.FLD_INDEX:u.SetAttribute("idx",this.Index.toString());break;case RD3Glb.FLD_VISIBLE:if((this.Flags&Glb.OBJ_VISIBLE)!=0&&E){break}u.SetAttribute("vis",((this.Flags&Glb.OBJ_VISIBLE)!=0)?"1":"0");break;case RD3Glb.FLD_ENABLED:var C=(this.Flags&Glb.OBJ_ENABLED)!=0;if(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams==null){C=false}if(C&&E){break}u.SetAttribute("ena",C?"1":"0");break;case RD3Glb.FLD_VISATTR:u.SetAttribute("sty",this.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle).toString());break;case RD3Glb.FLD_LISTLIST:if((this.Flags&Glb.FLD_LISTLIST)!=0&&E){break}u.SetAttribute("lli",((this.Flags&Glb.FLD_LISTLIST)!=0)?"1":"0");break;case RD3Glb.FLD_CANACTIVATE:if((this.Flags&Glb.FLD_CANACTIVATE)==0&&E){break}u.SetAttribute("act",((this.Flags&Glb.FLD_CANACTIVATE)!=0)?"1":"0");break;case RD3Glb.FLD_ACTIVABLEDISABLED:if((this.Flags&Glb.FLD_NOACTD)!=0&&E){break}u.SetAttribute("acd",((this.Flags&Glb.FLD_NOACTD)==0)?"1":"0");break;case RD3Glb.FLD_QVS:var k=false;if((this.Flags&Glb.FLD_AUTOLOOKUP)==0){for(var A=0;A<this.Parent.UQueries();A++){if(this.Parent.bQueries(A).FieldIndex==this.Index){k=true;break}}}else{u.SetAttribute("alo","1")}if(!k&&E){break}u.SetAttribute("qvs",k?"1":"0");break;case RD3Glb.FLD_ACTWIDTH:if(this.ActWidth==-9999&&E){break}u.SetAttribute("acw",this.ActWidth.toString());break;case RD3Glb.FLD_ACTIMAGE:if((this.ActImg==null||this.ActImg.equals(""))&&E){break}u.SetAttribute("aci",(this.ActImg==null)?"":this.ActImg.toString());break;case RD3Glb.FLD_OPTIONAL:if((this.Flags&Glb.FLD_ISOPT)!=0&&E){break}u.SetAttribute("opt",((this.Flags&Glb.FLD_ISOPT)!=0)?"1":"0");break;case RD3Glb.FLD_IMAGE:if(this.Image.length==0&&E){break}u.SetAttribute("img",this.Image);break;case RD3Glb.FLD_IMGRESMODE:if(this.ImageResMode==1&&E){break}u.SetAttribute("irm",this.ImageResMode.toString());break;case RD3Glb.FLD_HEADER:var f;var g=this.Mask.equals("")?this.Parent.VS.Mask(this.VisualStyle):this.Mask;if(g.length>0&&this.IdxPanel<0){f=IDL.Format(new IDVariant(this.Header),new IDVariant(g),this.Parent.MainFrm).stringValue()}else{f=this.Header}if(f.length==0&&E){break}u.SetAttribute("hdr",f);break;case RD3Glb.FLD_TOOLTIP:if(this.Tooltip.length==0&&E){break}u.SetAttribute("tip",this.Tooltip);break;case RD3Glb.FLD_PAGE:if(this.Page==0&&E){break}u.SetAttribute("pag",this.Page.toString());break;case RD3Glb.FLD_GROUP:if(this.Group==-1&&E){break}if(this.Group!=-1){u.SetAttribute("gru",""+this.Parent.Groups[this.Group].GetRD3Ident())}break;case RD3Glb.FLD_DATATYPE:u.SetAttribute("dat",this.DataType.toString());break;case RD3Glb.FLD_MAXLENGTH:if(this.MaxLength==255&&E){break}u.SetAttribute("max",this.MaxLength.toString());break;case RD3Glb.FLD_SORTMODE:if(this.SortMode==0&&E){break}u.SetAttribute("smo",this.SortMode.toString());if(this.Parent.UseListQBEEnabled()){if(this.Parent.GroupingList.IndexOf(this)>=0&&this.Parent.GroupingEnabled()&&this.Parent.ShowGroups()){u.SetAttribute("gro",this.SortMode.toString())}else{u.SetAttribute("gro","0")}}break;case RD3Glb.FLD_INLIST:if((this.Flags&Glb.FLD_INLIST)!=0&&E){break}u.SetAttribute("inl",((this.Flags&Glb.FLD_INLIST)!=0)?"1":"0");break;case RD3Glb.FLD_LISTHEADER:if(this.AbbrHeaderList.length==0&&E){break}u.SetAttribute("lih",this.AbbrHeaderList);break;case RD3Glb.FLD_HDRLIST:if((this.Flags&Glb.FLD_NOHDRLIST)==0&&E){break}u.SetAttribute("hdl",((this.Flags&Glb.FLD_NOHDRLIST)==0)?"1":"0");break;case RD3Glb.FLD_HDRLISTABOVE:if((this.Flags&Glb.FLD_VERTHDRLIST)==0&&E){break}u.SetAttribute("hla",((this.Flags&Glb.FLD_VERTHDRLIST)!=0)?"1":"0");break;case RD3Glb.FLD_LISTLEFT:if(this.ListLeft==0&&E){break}u.SetAttribute("lle",this.ListLeft.toString());break;case RD3Glb.FLD_LISTTOP:if(this.ListTop==0&&E){break}u.SetAttribute("lto",this.ListTop.toString());break;case RD3Glb.FLD_LISTWIDTH:if(this.ListWidth==0&&E){break}u.SetAttribute("lwi",this.ListWidth.toString());break;case RD3Glb.FLD_LISTHEIGHT:if(this.ListHeight==0&&E){break}u.SetAttribute("lhe",this.ListHeight.toString());break;case RD3Glb.FLD_LISTHDRSIZE:if((this.HeaderSize[Glb.PANEL_LIST]==0||((this.Flags&Glb.FLD_INLIST)!=0&&(this.Flags&Glb.FLD_LISTLIST)!=0))&&E){break}u.SetAttribute("lhs",this.HeaderSize[Glb.PANEL_LIST].toString());break;case RD3Glb.FLD_LISTNUMROWS:if(this.ListNumRow==0&&E){break}u.SetAttribute("lnr",this.ListNumRow.toString());break;case RD3Glb.FLD_LISTHRESMODE:if(this.HResMode[Glb.PANEL_LIST]==1&&E){break}u.SetAttribute("lhr",this.HResMode[Glb.PANEL_LIST].toString());break;case RD3Glb.FLD_LISTVRESMODE:if(this.VResMode[Glb.PANEL_LIST]==1&&E){break}u.SetAttribute("lvr",this.VResMode[Glb.PANEL_LIST].toString());break;case RD3Glb.FLD_INFORM:if((this.Flags&Glb.FLD_INFORM)!=0&&E){break}u.SetAttribute("inf",((this.Flags&Glb.FLD_INFORM)!=0)?"1":"0");break;case RD3Glb.FLD_FORMHEADER:if(this.AbbrHeaderForm.length==0&&E){break}u.SetAttribute("foh",this.AbbrHeaderForm);break;case RD3Glb.FLD_HDRFORM:if((this.Flags&Glb.FLD_NOHDRFORM)==0&&E){break}u.SetAttribute("hdf",((this.Flags&Glb.FLD_NOHDRFORM)==0)?"1":"0");break;case RD3Glb.FLD_HDRFORMABOVE:if((this.Flags&Glb.FLD_VERTHDRFORM)==0&&E){break}u.SetAttribute("hfa",((this.Flags&Glb.FLD_VERTHDRFORM)!=0)?"1":"0");break;case RD3Glb.FLD_FORMLEFT:if(this.FormLeft==0&&E){break}u.SetAttribute("fle",this.FormLeft.toString());break;case RD3Glb.FLD_FORMTOP:if(this.FormTop==0&&E){break}u.SetAttribute("fto",this.FormTop.toString());break;case RD3Glb.FLD_FORMWIDTH:if(this.FormWidth==0&&E){break}u.SetAttribute("fwi",this.FormWidth.toString());break;case RD3Glb.FLD_FORMHEIGHT:if(this.FormHeight==0&&E){break}u.SetAttribute("fhe",this.FormHeight.toString());break;case RD3Glb.FLD_FORMHDRSIZE:if(this.HeaderSize[Glb.PANEL_FORM]==0&&E){break}u.SetAttribute("fhs",this.HeaderSize[Glb.PANEL_FORM].toString());break;case RD3Glb.FLD_FORMNUMROWS:if(this.FormNumRow==0&&E){break}u.SetAttribute("fnr",this.FormNumRow.toString());break;case RD3Glb.FLD_FORMHRESMODE:if(this.HResMode[Glb.PANEL_FORM]==1&&E){break}u.SetAttribute("fhr",this.HResMode[Glb.PANEL_FORM].toString());break;case RD3Glb.FLD_FORMVRESMODE:if(this.VResMode[Glb.PANEL_FORM]==1&&E){break}u.SetAttribute("fvr",this.VResMode[Glb.PANEL_FORM].toString());break;case RD3Glb.FLD_IDXPANEL:if(this.IdxPanel==0&&E){break}u.SetAttribute("idp",this.IdxPanel.toString());break;case RD3Glb.FLD_SUBFRAME:if(this.SubFrame==0&&E){break}u.SetAttribute("sub",this.Parent.Parent.Frames[this.SubFrame].Content.GetRD3Ident());break;case RD3Glb.FLD_TABORDER:if(this.Parent.IsAdvTabOrderEnabled()){u.SetAttribute("lta",this.Parent.GetFieldIdxTabOrder(this.Index,Glb.PANEL_LIST).toString());u.SetAttribute("fta",this.Parent.GetFieldIdxTabOrder(this.Index,Glb.PANEL_FORM).toString())}break;case RD3Glb.FLD_VALUELIST:if(this.ValueList.Count()==0&&E){break}var B=u.AddNewElement("vls");if(this.ValueList.Count()>0){for(var A=0;A<this.ValueList.Count();A++){this.ValueList[A].RD3RenderDifference(B,E,this.Parent.MainFrm)}}else{B.SetAttribute("del","1")}break;case RD3Glb.FLD_EDITORTYPE:if(this.EditorType==0&&E){break}u.SetAttribute("edi",this.EditorType.toString());break;case RD3Glb.FLD_SCALE:if(this.vScale==0&&E){break}u.SetAttribute("fsc",this.vScale.toString());break;case RD3Glb.FLD_CMDIDX:if(this.CmdIdx==0&&E){break}u.SetAttribute("cmd","cmd:"+this.CmdIdx);break;case RD3Glb.FLD_CAUSEVALIDATION:if(this.CauseValidation&&E){break}u.SetAttribute("cva",this.CauseValidation?"1":"0");break;case RD3Glb.FLD_CANSORT:var D=(this.IdxPanel==0||this.SortFld!=-1)&&this.DataType!=Glb.DT_DOC_OLE;if(D&&E){break}u.SetAttribute("srt",D?"1":"0");break;case RD3Glb.FLD_LKE:var C=(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams!=null);if(!C&&E){break}u.SetAttribute("lke",C?"1":"0");break;case RD3Glb.FLD_QBEENAB:if(this.QBEEnabled&&E){break}u.SetAttribute("qen",this.QBEEnabled?"1":"0");break;case RD3Glb.FLD_SUPERACTIVE:if((this.Flags&Glb.FLD_SUPERACTIVE)==0&&E){break}u.SetAttribute("sac",((this.Flags&Glb.FLD_SUPERACTIVE)!=0)?"1":"0");break;case RD3Glb.FLD_USEHL:if(!this.UseHilight&&E){break}u.SetAttribute("uhl",this.UseHilight?"1":"0");break;case RD3Glb.FLD_VISPROP:if(this.iVisualFlags==-1&&E){break}u.SetAttribute("vfl",this.iVisualFlags.toString());break;case RD3Glb.FLD_UNBOUND:if(!this.Unbound&&E){break}u.SetAttribute("unb",this.Unbound?"1":"0");break;case RD3Glb.FLD_COMBOMULTISEL:if(this.MultiSelectionComboBox()&&E){break}u.SetAttribute("cms",this.MultiSelectionComboBox()?"1":"0");break;case RD3Glb.FLD_USETEXTSELECTION:if(!this.UseTextSelection()&&E){break}u.SetAttribute("uts",this.UseTextSelection()?"1":"0");break;case RD3Glb.FLD_BACKCOLOR:if(this.BackColor==-2&&E){break}u.SetAttribute("bkc",(this.BackColor==-2?"":Glb.GetWebColor(this.BackColor)));break;case RD3Glb.FLD_FORECOLOR:if(this.ForeColor==-2&&E){break}u.SetAttribute("frc",(this.ForeColor==-2?"":Glb.GetWebColor(this.ForeColor)));break;case RD3Glb.FLD_MASK:if(this.Mask.length==0&&E){break}u.SetAttribute("msk",this.Mask);break;case RD3Glb.FLD_FONTMOD:if(this.FontMod.length==0&&E){break}u.SetAttribute("ftm",this.FontMod);break;case RD3Glb.FLD_ALIGN:if(this.Alignment==-1&&E){break}u.SetAttribute("aln",this.Alignment.toString());break;case RD3Glb.FLD_WATERMARK:if(this.iWaterMark.equals("")&&E){break}u.SetAttribute("wtm",this.iWaterMark);break;case RD3Glb.FLD_OPENCOMBO:if(E){break}u.SetAttribute("ocb","1");break;case RD3Glb.FLD_BADGE:if(this.iBadge.length==0&&E){break}u.SetAttribute("bdg",this.iBadge);break;case RD3Glb.FLD_EDCOLORS:if((this.ColorList==null)||(this.ColorList.Count()==0&&E)){break}var m=u.AddNewElement("cls");if(this.ColorList.Count()>0){for(var x=0;x<this.ColorList.Count();x++){m.SetAttribute("col"+x,this.ColorList.Get(x))}}else{m.SetAttribute("del","1")}break;case RD3Glb.FLD_EDFONTS:if((this.FontList==null)||(this.FontList.Count()==0&&E)){break}var o=u.AddNewElement("fls");if(this.FontList.Count()>0){for(var q=0;q<this.FontList.Count();q++){var s=this.FontList.Get(q);s.RD3RenderDifference(o,E,this.Parent.MainFrm)}}else{o.SetAttribute("del","1")}break;case RD3Glb.FLD_EDTOKENS:if((this.TokenList==null)||(this.TokenList.Count()==0&&E)){break}var h=u.AddNewElement("tks");if(this.TokenList.Count()>0){for(var q=0;q<this.TokenList.Count();q++){var F=this.TokenList.Get(q);F.RD3RenderDifference(h,E,this.Parent.MainFrm)}}else{h.SetAttribute("del","1")}break;case RD3Glb.FLD_EDTOOLBAR:if(this.ShowEditorToolbar()&&E){break}u.SetAttribute("uet",this.ShowEditorToolbar()?"1":"0");break;case RD3Glb.FLD_EDCOMMANDS:if(this.iToolCommandEnabled==-1&&E){break}u.SetAttribute("itc",this.iToolCommandEnabled.toString());break;case RD3Glb.FLD_DEFFORMAT:if(this.iDefaultFormatting==""&&E){break}u.SetAttribute("def",this.iDefaultFormatting);break;case RD3Glb.FLD_CLASSNAME:if((this.iClassName==null||this.iClassName.length==0)&&E){break}u.SetAttribute("cln",(this.iClassName==null)?"":this.iClassName);break;case RD3Glb.FLD_POSDIMPERC:if(!this.PosDimPerc&&E){break}u.SetAttribute("pdp",this.PosDimPerc.join(","));break;case RD3Glb.FLD_QBEFILTER:if(((this.LastQBE==null||this.LastQBE.length==0)&&E)||!this.Parent.UseListQBEEnabled()){break}u.SetAttribute("qbf",this.LastQBE?this.LastQBE:"");break;case RD3Glb.FLD_QBESENDCOMBO:if(E){break}var r=this.Values.length>0?this.Values[0]:null;var c=new PValueSrv(this,r.Index);c.Text=this.QBEComboFilterValue?this.QBEComboFilterValue:"";c.Value=new IDVariant(c.Text);var l=0;if(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams!=null){this.Values[0]=c;var d=this.Parent.iStatus;var a=this.Parent.Parent.IdxFieldActived;this.Parent.iStatus=Glb.PS_QBE;this.Parent.Parent.IdxFieldActived=this.Index;this.Parent.bQueries(this.IdxPanel).QBEComboQuery=true;this.Parent.bQueries(this.IdxPanel).AddLKERow(0);this.Parent.bQueries(this.IdxPanel).UpdateLKE(this.Parent.MainFrm);this.Parent.bQueries(this.IdxPanel).QBEComboQuery=true;this.Values[0]=r;this.Parent.iStatus=d;this.Parent.Parent.IdxFieldActived=a;l=1}if((this.Flags&Glb.FLD_AUTOLOOKUP)!=0){l=2}if(l==0){for(var z=0;z<this.Parent.UQueries();z++){if(this.Parent.bQueries(z).FieldIndex==this.Index){this.QueryValueSource=this.Parent.bQueries(z);l=3;break}}}if(l==0){break}var n=u.AddNewElement("vnl");n.SetAttribute("typ",l.toString());n.SetAttribute("popup",this.QBEFilterPopup?this.QBEFilterPopup:"");switch(l){case 1:this.Parent.bQueries(this.IdxPanel).GetLKEValues(this.Parent.MainFrm,this.CanActivate(c.Index),c,n,true);break;case 2:this.QueryValueSource.GetValueSource(this.Parent.MainFrm,c.Index,new IDVariant(),Glb.ClassDT(this.DataType)==Glb.DTC_CHAR,true,false,n);break;case 3:this.QueryValueSource.GetValueSource(this.Parent.MainFrm,c.Index,new IDVariant(),Glb.ClassDT(this.DataType)==Glb.DTC_CHAR,false,false,n);this.QueryValueSource=null;break}this.QBEFilterPopup=null;this.QBEComboFilterValue=null;break;case RD3Glb.FLD_OPENQBEFILTERPOPUP:if(E){break}u.SetAttribute("oqbf","1");break;case RD3Glb.FLD_ROWBREAKBEFORE:if(this.iRowBreakBefore==false&&E){break}u.SetAttribute("fbr",this.iRowBreakBefore?"1":"0");break}};PFieldSrv.prototype.RD3Resize=function(b){var a=b.GetAttribute("obn");if(a.equals("list")){this.ListWidth=parseInt(b.GetAttribute("par1"),10);this.ListHeight=parseInt(b.GetAttribute("par2"),10);this.ListLeft=parseInt(b.GetAttribute("par3"),10);this.ListTop=parseInt(b.GetAttribute("par4"),10);this.UserChangedField=false}if(a.equals("form")){this.FormWidth=parseInt(b.GetAttribute("par1"),10);this.FormHeight=parseInt(b.GetAttribute("par2"),10);this.FormLeft=parseInt(b.GetAttribute("par3"),10);this.FormTop=parseInt(b.GetAttribute("par4"),10)}};PFieldSrv.prototype.ClearLastValue=function(){if(this.IdxPanel!=-1){for(var a=0;a<this.Values.length;a++){this.Values[a].LastModified=false}}};PFieldSrv.prototype.VisualFlag=function(a){return((this.iVisualFlags&a)!=0)};PFieldSrv.prototype.set_VisualFlag=function(a,b){if((this.iVisualFlags&a)!=(b?a:0)){this.iVisualFlags=(this.iVisualFlags&(~a))|(b?a:0);this.RD3Change(RD3Glb.FLD_VISPROP);if(a==Glb.FLDVISPROP_ONEACHKEY){this.Parent.SetFieldSuperActive(this.Index,b)}if(a==Glb.FLDVISPROP_SHOWACT&&!b){this.Parent.SetFieldActivator(this.Index,-1)}}};PFieldSrv.prototype.MultiSelectionComboBox=function(){return this.iMultiSelectionComboBox};PFieldSrv.prototype.set_MultiSelectionComboBox=function(a){if(this.iMultiSelectionComboBox!=a){this.iMultiSelectionComboBox=a;this.RD3Change(RD3Glb.FLD_COMBOMULTISEL)}};PFieldSrv.prototype.HasConcept=function(c){if(!this.Parent.IsDO()){return(c.equals("DO_ID")&&this.DataType==Glb.DT_CHAR_FIXED&&this.MaxLength==20)}if(this.IdxPanel!=0){return false}var j=this.Parent.bQueries(0).DocTempl;if(j==null){try{var f=(this.Parent.MainFrm.CompNameSpace!=null?this.Parent.MainFrm.CompNameSpace+".":"")+this.Parent.bQueries(0).MstTableName;try{j=(new Function("return new "+f+"();"))();if(j&&!(j instanceof IDDocument)){j=null}}catch(b){}if(j!=null){j.SetMainFrm(this.Parent.MainFrm,this.Parent.IMDB)}else{for(var a=0;a<this.Parent.MainFrm.GetCompList().Count();a++){try{var g=this.Parent.MainFrm.GetCompList()[a];f=g.CompNameSpace+"."+this.Parent.bQueries(0).MstTableName;j=(new Function("return new "+f+"();"))();if(j&&!(j instanceof IDDocument)){j=null}if(j!=null){j.SetMainFrm(g,g.IMDB);break}}catch(b){}}}}catch(h){}}if(j!=null){if(this.GetDOIdx(j)>0){return(c.equals(j.GetMD().GetProp(this.GetDOIdx(j)).Concept))}}return false};PFieldSrv.prototype.GetQBESep=function(){if(this.iQBESep==null){if(this.HasConcept("DO_ID")){this.iQBESep=" "}else{this.iQBESep=";"}}return this.iQBESep};PFieldSrv.prototype.SetSubForm=function(l,f,m,k){if(f!=(this.IdxPanel==-1)){if(this.IdxPanel!=-1){this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,78,"PField.SetSubForm","Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": can't add a sub-form inside a non-static field. Use the SetValueSubForm method instead")}else{this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,78,"PField.SetSubForm","Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": can't add a sub-form inside a static field. Use the SetLabelSubForm method instead")}return}if(f&&m==-1){m=this.Parent.PanelMode}else{if(!f&&k==-1){k=(this.Parent.ValidatingRow>-1?this.Parent.ValidatingRow:this.Parent.AttR)+1}}if(l==null){if(f){this.Parent.SetSubFrame(Index,0)}else{this.SetSubFrame(k,null)}return}for(var c=1;c<this.Parent.Parent.Frames.length;c++){var e=this.Parent.Parent.Frames[c];if(e.Content instanceof ASubFormSrv&&e.Content.pSubForm==l){if(f){this.Parent.SetSubFrame(Index,c)}else{var n=e.Content;var g=-1;for(var b=0;b<this.Values.length;b++){var o=this.Values[b];var a=o.iCustomElement.Property("SubForm");if(a!=null&&a.stringValue().equals(n.GetRD3Ident())){g=b+1;break}}if(g!=k){if(g!=-1){this.SetSubFrame(g,null)}this.SetSubFrame(k,n)}}return}}Array.resize(this.Parent.Parent.Frames,this.Parent.Parent.Frames.length+1);var h=new AFrameSrv(this.Parent.Parent.Frames.length-1);this.Parent.Parent.Frames[this.Parent.Parent.Frames.length-1]=h;h.Parent=this.Parent.Parent;h.FrHidden=true;h.RD3NewObj=true;var d=new ASubFormSrv(this.Parent.Parent);h.Content=d;d.FrIndex=h.Index;d.Height=(m==Glb.PANEL_LIST?this.ListHeight:this.FormHeight);d.Width=(m==Glb.PANEL_LIST?this.ListWidth:this.FormWidth);d.Init(l,l.MainFrm);if(f){this.Parent.SetSubFrame(Index,this.Parent.Parent.Frames.length-1)}else{this.SetSubFrame(k,d)}};PFieldSrv.prototype.GetSubForm=function(c,b){if(c!=(this.IdxPanel==-1)){if(this.IdxPanel!=-1){this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,78,"PField.SetSubForm","Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": can't add a sub-form inside a non-static field. Use the GetValueSubForm method instead")}else{this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,78,"PField.SetSubForm","Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": can't add a sub-form inside a static field. Use the GetLabelSubForm method instead")}return null}if(!c&&b==-1){b=(this.Parent.ValidatingRow>-1?this.Parent.ValidatingRow:this.Parent.AttR)+1}var a=null;if(c){if(this.SubFrame==0){return null}a=this.Parent.Parent.Frames[this.SubFrame]}else{if(b<1||b>this.Parent.NumRows){return null}if(this.CellSubForms==null){return null}var e=this.Values[b-1];var d=this.CellSubForms[e.GetRD3Ident()];if(d==null){return null}this.SetCustomContentCls("","CustomElementSubForm");var f=e.iCustomElement.Property("SubForm");if(f==null||!f.stringValue().equals(d.GetRD3Ident())){e.iCustomElement.set_Property("SubForm",new IDVariant(d.GetRD3Ident()))}a=this.Parent.Parent.Frames[d.FrIndex]}if(a!=null&&a.Content instanceof ASubFormSrv){return a.Content.GetIntForm()}return null};PFieldSrv.prototype.SetSubFrame=function(a,c){this.SetCustomContentCls("","CustomElementSubForm");var b=this.Values[a-1];if(c!=null){b.iCustomElement.set_Property("SubForm",new IDVariant(c.GetRD3Ident()))}else{b.iCustomElement.set_Property("SubForm",new IDVariant())}if(c!=null){if(this.CellSubForms==null){this.CellSubForms=new HashTableSrv()}this.CellSubForms[b.GetRD3Ident()]=c}else{if(this.CellSubForms!=null){this.CellSubForms.remove(b.GetRD3Ident())}}};function GroupIntervalSrv(c,a,b){this.Min=c;this.Max=a;this.Label=b}PFieldSrv.prototype.AddGroupInterval=function(d,a,c){var b=new GroupIntervalSrv(d,a,c);this.GroupIntervals.Add(b)};PFieldSrv.prototype.ResetGroupIntervals=function(){this.GroupIntervals.Clear()};PFieldSrv.prototype.GetGroupLabel=function(k,a,g,l){for(var d=0;d<this.GroupIntervals.Count();d++){var h=this.GroupIntervals[d];if((k.compareTo(h.Min)>=0)&&(k.compareTo(h.Max)<=0)){return h.Label}}if(!this.UseAutomaticLabels()||!l){return k}if((this.DataType==Glb.DT_DATE||this.DataType==Glb.DT_DATETIME)&&(k.Type==IDVariant.DATETIME)){if(IDL.GetDate(k).equals(IDL.Today())){return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("982BE4E3-A288-4AD4-A4D6-426F4E62BEDB","Oggi",false))}if(IDL.GetDate(k).equals(IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today()))){return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("8052BA86-1C6A-4268-BABA-28CA9E6F94E7","Ieri",false))}if(IDL.GetDate(k).equals(IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today()))){return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("A4E7F53D-043D-435F-8089-E1C6495A13B0","Domani",false))}if(!IDL.Year(k).equals(IDL.Year(IDL.Today()))){var j=IDL.Year(IDL.Today()).intValue()-IDL.Year(k).intValue();if(j>0){return new IDVariant(j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("3E2037C7-3712-42C7-975A-12EC4F99C15F"," anno fa",false):this.Parent.MainFrm.RTCObj.GetConst("1DFEBB1D-F287-4720-9919-EA6F53B67F4D"," anni fa",false)))}else{j=Math.abs(j);return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("794F8147-A11A-45BA-BA8E-BD91023786B1","Fra ",false)+j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("1EB8E8FD-6881-4748-86A7-B9445B654575"," anno",false):this.Parent.MainFrm.RTCObj.GetConst("585A5B58-FF3B-460D-ADDF-5509B131314E"," anni",false)))}}if(!IDL.Month(k).equals(IDL.Month(IDL.Today()))){var j=IDL.Month(IDL.Today()).intValue()-IDL.Month(k).intValue();if(j>0){return new IDVariant(j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("7E17BDA7-3102-4781-9B37-60B94EFE8DE5"," mese fa",false):this.Parent.MainFrm.RTCObj.GetConst("D354B2CC-3B66-4AA6-AEBA-3BB5A90C16C6"," mesi fa",false)))}else{j=Math.abs(j);return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("794F8147-A11A-45BA-BA8E-BD91023786B1","Fra ",false)+j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("4EA2817C-F2F0-45AC-992F-466A670C5920"," mese",false):this.Parent.MainFrm.RTCObj.GetConst("A1B47221-170D-4F68-85BF-E62D129F9D41"," mesi",false)))}}if(!IDL.Week(k).equals(IDL.Week(IDL.Today()))){var j=IDL.Week(IDL.Today()).intValue()-IDL.Week(k).intValue();if(j>0){return new IDVariant(j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("D6B70782-C74E-4F3A-B0DB-FCFFF3B198F7"," settimana fa",false):this.Parent.MainFrm.RTCObj.GetConst("2D3E27ED-49E1-49FD-B088-2240F7D06260"," settimane fa",false)))}else{j=Math.abs(j);return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("794F8147-A11A-45BA-BA8E-BD91023786B1","Fra ",false)+j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("58F52C18-8170-4126-9607-F7CE9B8BF763"," settimana",false):this.Parent.MainFrm.RTCObj.GetConst("B6AC70E1-6090-44C6-9C14-CD4284590EB7"," settimane",false)))}}}if(((this.DataType==Glb.DT_CHAR)||(this.DataType==Glb.DT_CHAR_FIXED))&&!a){return new IDVariant(k.stringValue().length>0?k.stringValue().substr(0,1).toUpperCase():"("+this.Parent.MainFrm.RTCObj.GetConst("5C9238CA-6E6E-4844-843D-7C49454664A1","vuoto",true)+")")}if(((this.DataType==Glb.DT_NUM_FIXED)||(this.DataType==Glb.DT_NUM_FLOAT)||(this.DataType==Glb.DT_NUM_INTEGER)||(this.DataType==Glb.DT_NUM_CURRENCY))&&!a){if(g==null){return new IDVariant("GRPLB:1")}var b=Math.floor((this.Parent.GetNumRows()+0)/10);if(k.equals(g.Last)){return g.iLabel}if(g.Count()>=b){try{var c=parseInt(g.iLabel.stringValue().substr(6),10);return new IDVariant("GRPLB:"+(c+1))}catch(f){return g.iLabel}}return g.iLabel}return k};PFieldSrv.prototype.UseAutomaticLabels=function(){return(this.iVisualFlags&Glb.FLDVISPROP_AUTOCLUSTER)>0};PFieldSrv.prototype.SetBackgroundColor=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.BackColor!=a){this.BackColor=a;this.RD3Change(RD3Glb.FLD_BACKCOLOR)}}else{this.Values[this.Parent.ValidatingRow].BackColor=a}};PFieldSrv.prototype.SetForegroundColor=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.ForeColor!=a){this.ForeColor=a;this.RD3Change(RD3Glb.FLD_FORECOLOR)}}else{this.Values[this.Parent.ValidatingRow].ForeColor=a}};PFieldSrv.prototype.SetFontModifiers=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(!this.FontMod.equals(a)){this.FontMod=a;this.RD3Change(RD3Glb.FLD_FONTMOD)}}else{this.Values[this.Parent.ValidatingRow].FontMod=a}};PFieldSrv.prototype.SetMask=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(!this.Mask.equals(a)){this.Mask=a;if(this.Parent.Status()>0){this.Parent.ResetRD3Cache()}this.RD3Change(RD3Glb.FLD_MASK);this.CalculateMask=true}}else{this.Values[this.Parent.ValidatingRow].DynMask=a;this.CalculateMask=true}};PFieldSrv.prototype.SetAlignment=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.Alignment!=a){this.Alignment=a;this.RD3Change(RD3Glb.FLD_ALIGN)}}else{this.Values[this.Parent.ValidatingRow].Alignment=a}};PFieldSrv.prototype.UseTextSelection=function(){return this.useTextSelection};PFieldSrv.prototype.set_UseTextSelection=function(a){this.useTextSelection=a};PFieldSrv.prototype.SelStart=function(){return this.selStart};PFieldSrv.prototype.SelEnd=function(){return this.selEnd};PFieldSrv.prototype.set_TextSelection=function(b,a){this.selStart=b;this.selEnd=a;if(!this.Parent.Parent.ActiveElement.equals("F"+this.Parent.FrIndex+"C"+this.Index+"R"+this.Parent.AttR)){this.Parent.SetInput(-1,this.Index,2,true,true)}this.sendSelection=true};PFieldSrv.prototype.WaterMark=function(){return this.iWaterMark};PFieldSrv.prototype.set_WaterMark=function(a){this.iWaterMark=a;this.RD3Change(RD3Glb.FLD_WATERMARK)};PFieldSrv.prototype.ClassName=function(){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){return this.iClassName}else{var a=this.bValues(this.Parent.ValidatingRow).LastCSSClass;if(a==null||a.length==0){a=this.iClassName}return a}};PFieldSrv.prototype.set_ClassName=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){this.iClassName=a;this.RD3Change(RD3Glb.FLD_CLASSNAME)}else{this.Values[this.Parent.ValidatingRow].CSSClass=a}};PFieldSrv.prototype.SetBadge=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.iBadge!=a){this.iBadge=a;this.RD3Change(RD3Glb.FLD_BADGE)}}else{this.Values[this.Parent.ValidatingRow].Badge=a}};PFieldSrv.prototype.setFieldEditor=function(){this.ColorList=new ArrayList();this.ColorList.Add("#FFFF00");this.ColorList.Add("#00FF00");this.ColorList.Add("#FF7200");this.ColorList.Add("#00FFFF");this.ColorList.Add("#FF00FF");this.ColorList.Add("#0000FF");this.ColorList.Add("#FF0000");this.ColorList.Add("#000080");this.ColorList.Add("#008080");this.ColorList.Add("#008000");this.ColorList.Add("#800080");this.ColorList.Add("#800000");this.ColorList.Add("#808000");this.ColorList.Add("#808080");this.ColorList.Add("#C0C0C0");this.ColorList.Add("#000000");this.ColorList.Add("#FFFFFF");this.ColorList.Add("transparent");this.FontList=new ArrayList();var a=new PVLItemSrv();a.Name="Arial";a.Value=new IDVariant("Arial");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Times New Roman";a.Value=new IDVariant("Times New Roman");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Helvetica";a.Value=new IDVariant("Helvetica");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Tahoma";a.Value=new IDVariant("Tahoma");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Verdana";a.Value=new IDVariant("Verdana");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Courier New";a.Value=new IDVariant("Courier New");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Impact";a.Value=new IDVariant("Impact");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Georgia";a.Value=new IDVariant("Georgia");this.FontList.Add(a);this.TokenList=new ArrayList();this.RD3Change(RD3Glb.FLD_EDCOLORS);this.RD3Change(RD3Glb.FLD_EDFONTS)};PFieldSrv.prototype.AddColor=function(a){if(typeof(a)=="number"){a=Glb.GetWebColor(a)}if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}this.ColorList.Add(a);this.RD3Change(RD3Glb.FLD_EDCOLORS)};PFieldSrv.prototype.ClearColors=function(){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}this.ColorList.Clear();this.RD3Change(RD3Glb.FLD_EDCOLORS)};PFieldSrv.prototype.AddFont=function(b,c){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}if(c==undefined){c=b}var a=new PVLItemSrv();a.Name=c;a.Value=new IDVariant(b);this.FontList.Add(a);this.RD3Change(RD3Glb.FLD_EDFONTS)};PFieldSrv.prototype.ClearFonts=function(){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}this.FontList.Clear();this.RD3Change(RD3Glb.FLD_EDFONTS)};PFieldSrv.prototype.AddToken=function(b,c){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}var a=new PVLItemSrv();a.Name=b;a.Value=new IDVariant(c);this.TokenList.Add(a);this.RD3Change(RD3Glb.FLD_EDTOKENS)};PFieldSrv.prototype.ClearTokens=function(){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}this.TokenList.Clear();this.RD3Change(RD3Glb.FLD_EDTOKENS)};PFieldSrv.prototype.ShowEditorToolbar=function(){return this.iShowEditorToolbar};PFieldSrv.prototype.set_ShowEditorToolbar=function(a){this.iShowEditorToolbar=a;this.RD3Change(RD3Glb.FLD_EDTOOLBAR)};PFieldSrv.prototype.SendEditorCommand=function(d,b,c){if(b==undefined){b=""}if(c==undefined){c=true}var a=this.Parent.MainFrm.RD3AddEvent("edcmd",this.GetRD3Ident());a.SetAttribute("CMD",d);a.SetAttribute("RES",(c?"-1":"0"));if(b.length>0){a.SetAttribute("VAL",b)}};PFieldSrv.prototype.SetToolbarCommandEnabled=function(c,a){var b=this.iToolCommandEnabled;this.iToolCommandEnabled=(this.iToolCommandEnabled&(~c))|((a)?c:0);if(b!=this.iToolCommandEnabled){this.RD3Change(RD3Glb.FLD_EDCOMMANDS)}};PFieldSrv.prototype.IsToolbarCommandEnabled=function(a){return(this.iToolCommandEnabled&a)!=0};PFieldSrv.prototype.DefaultFormatting=function(){return this.iDefaultFormatting};PFieldSrv.prototype.set_DefaultFormatting=function(a){this.iDefaultFormatting=a;this.RD3Change(RD3Glb.FLD_DEFFORMAT)};PFieldSrv.prototype.ExecuteLISTQBECombo=function(b,a){this.QBEComboFilterValue=b;this.QBEFilterPopup=a;this.RD3Change(RD3Glb.FLD_QBESENDCOMBO)};PFieldSrv.prototype.RowBreakBefore=function(){return this.iRowBreakBefore};PFieldSrv.prototype.set_RowBreakBefore=function(a){this.iRowBreakBefore=a;this.RD3Change(RD3Glb.FLD_ROWBREAKBEFORE)};function PGroupSrv(){this.Parent;this.Index;this.VisualStyle;this.Flags;this.DesignFlags=-1;this.RoleFlags=-1;this.Image="";this.Header="";this.Tooltip="";this.ListLeft;this.ListTop;this.ListWidth;this.ListHeight;this.FormLeft;this.FormTop;this.FormWidth;this.FormHeight;this.Page=0;this.ListHdrPos=Glb.HDRGRP_INNER;this.FormHdrPos=Glb.HDRGRP_INNER;this.HeaderHeight;this.HeaderWidth;this.AlreadyRendered=false;this.iGuid;this.Collapsed=false;this.Collapsible=false;this.ListMovedFields=false;this.FormMovedFields=false;this.ExpandOnError=true;this.InList=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.PGR_MAXPROPS);this.iClassName;this.CollapseAnimationDef=null}PGroupSrv.prototype.GrpRect=function(b){var a=new RectSrv();if(b==Glb.PANEL_LIST){a.Left=this.ListLeft+((this.Parent.ShowRowSelector)?Glb.SELECT_OFFSET:0);a.Top=this.ListTop;a.Width=this.ListWidth;a.Height=this.ListHeight}else{a.Left=this.FormLeft;a.Top=this.FormTop;a.Width=this.FormWidth;a.Height=this.FormHeight}return a};PGroupSrv.prototype.set_GrpRect=function(b,a){if(b==Glb.PANEL_LIST){this.ListLeft=a.Left;this.ListTop=a.Top;this.ListWidth=a.Width;this.ListHeight=a.Height;this.RD3Change(RD3Glb.PGR_LISTLEFT);this.RD3Change(RD3Glb.PGR_LISTTOP);this.RD3Change(RD3Glb.PGR_LISTWIDTH);this.RD3Change(RD3Glb.PGR_LISTHEIGTH)}else{this.FormLeft=a.Left;this.FormTop=a.Top;this.FormWidth=a.Width;this.FormHeight=a.Height;this.RD3Change(RD3Glb.PGR_FORMLEFT);this.RD3Change(RD3Glb.PGR_FORMTOP);this.RD3Change(RD3Glb.PGR_FORMWIDTH);this.RD3Change(RD3Glb.PGR_FORMHEIGHT)}};PGroupSrv.prototype.Resize=function(){var d=0;var g=0;var j=0;var c=0;var h=0;var a=0;for(var b=0;b<this.Parent.UFields();b++){var e=this.Parent.bFields(b);if(e.Group==this.Index){if((e.Flags&Glb.FLD_INLIST)!=0&&(e.Flags&Glb.FLD_LISTLIST)!=0&&(e.Flags&Glb.OBJ_VISIBLE)!=0){if(d==0){g=e.ListLeft}d=d+e.ListWidth}if((e.Flags&Glb.FLD_INFORM)!=0&&(e.Flags&Glb.OBJ_VISIBLE)!=0){if(c==0){j=e.FormLeft;h=e.FormTop;c=e.FormLeft+e.FormWidth;a=e.FormTop+e.FormHeight}else{j=(j<e.FormLeft?j:e.FormLeft);h=(h<e.FormTop?h:e.FormTop);c=(c>e.FormLeft+e.FormWidth?c:e.FormLeft+e.FormWidth);a=(a>e.FormTop+e.FormHeight?a:e.FormTop+e.FormHeight)}}}}this.ListLeft=g-((this.Parent.ShowRowSelector)?Glb.SELECT_OFFSET:0);this.ListWidth=d;j=j-4;c=c+4;h=h-4;a=a+4;switch(this.FormHdrPos){case Glb.HDRGRP_INNER:h=h-this.HeaderHeight;break;case Glb.HDRGRP_ONBORDER:h=h-this.HeaderHeight/2;break}this.FormLeft=j;this.FormTop=h;this.FormWidth=c-j;this.FormHeight=a-h};PGroupSrv.prototype.set_Collapsed=function(b,a){if(a==undefined){a=false}if(this.Collapsed!=b){this.Collapsed=b;this.RD3Change(RD3Glb.PGR_COLLAPSED);this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",30,"PGroup.SetCollapsed","Group "+this.Header+(this.Collapsed?" collapsed":" expanded"));this.Parent.MainFrm.DTTObj.SetRequestName((b?"Collapse":"Expand")+" Group","Group "+this.Header+(this.Collapsed?" collapsed":" expanded"),DTTRequest.PRI_CMD);this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",30,"PGroup.SetCollapsed","Group "+this.Header+": Firing OnChangeGroupCollapse event");this.Parent.Parent.OnChangeGroupCollapse(this.Parent,new IDVariant(this.Index))}if(this.Parent.PanelMode==Glb.PANEL_LIST){this.ListMovedFields=a;this.FormMovedFields=false}else{this.FormMovedFields=a;this.ListMovedFields=false}};PGroupSrv.prototype.set_Collapsible=function(a){if(this.Collapsible!=a){this.Collapsible=a;this.RD3Change(RD3Glb.PGR_COLLAPSIBLE)}};PGroupSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index+":"+this.Parent.FrIndex+":"+this.Parent.Parent.FormIdx};PGroupSrv.prototype.GetRD3Name=function(){return"grp"};PGroupSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};PGroupSrv.prototype.RD3RenderDifference=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.CollapseAnimationDef!=null){d.SetAttribute("cla",this.CollapseAnimationDef)}}return c};PGroupSrv.prototype.SetRD3Property=function(a,d,c){switch(a){case RD3Glb.PGR_VISUALSTYLE:d.SetAttribute("sty",this.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle).toString());break;case RD3Glb.PGR_FLAGS:d.SetAttribute("flg",this.Flags.toString());break;case RD3Glb.PGR_IMAGE:if(this.Image.length==0&&c){break}d.SetAttribute("img",this.Image);break;case RD3Glb.PGR_HEADER:if(this.Header.length==0&&c){break}d.SetAttribute("cap",this.Header);break;case RD3Glb.PGR_TOOLTIP:if(this.Tooltip.length==0&&c){break}d.SetAttribute("tip",this.Tooltip);break;case RD3Glb.PGR_LISTLEFT:var b=this.ListLeft+((this.Parent.ShowRowSelector)?Glb.SELECT_OFFSET:0);if(b==0&&c){break}d.SetAttribute("lle",b.toString());break;case RD3Glb.PGR_LISTTOP:if(this.ListTop==0&&c){break}d.SetAttribute("lto",this.ListTop.toString());break;case RD3Glb.PGR_LISTWIDTH:if(this.ListWidth==0&&c){break}d.SetAttribute("lwi",this.ListWidth.toString());break;case RD3Glb.PGR_LISTHEIGTH:if(this.ListHeight==0&&c){break}d.SetAttribute("lhe",this.ListHeight.toString());break;case RD3Glb.PGR_FORMLEFT:if(this.FormLeft==0&&c){break}d.SetAttribute("fle",this.FormLeft.toString());break;case RD3Glb.PGR_FORMTOP:if(this.FormTop==0&&c){break}d.SetAttribute("fto",this.FormTop.toString());break;case RD3Glb.PGR_FORMWIDTH:if(this.FormWidth==0&&c){break}d.SetAttribute("fwi",this.FormWidth.toString());break;case RD3Glb.PGR_FORMHEIGHT:if(this.FormHeight==0&&c){break}d.SetAttribute("fhe",this.FormHeight.toString());break;case RD3Glb.PGR_PAGE:if(this.Page==0&&c){break}d.SetAttribute("pag",this.Page.toString());break;case RD3Glb.PGR_LISTHDERPOS:if(this.ListHdrPos==0&&c){break}d.SetAttribute("lhp",this.ListHdrPos.toString());break;case RD3Glb.PGR_FORMHDRPOS:if(this.FormHdrPos==0&&c){break}d.SetAttribute("fhp",this.FormHdrPos.toString());break;case RD3Glb.PGR_HEADERHEIGHT:if(this.HeaderHeight==0&&c){break}d.SetAttribute("hhe",this.HeaderHeight.toString());break;case RD3Glb.PGR_HEADERWIDTH:if(this.HeaderWidth==0&&c){break}d.SetAttribute("hwi",this.HeaderWidth.toString());break;case RD3Glb.PGR_INLIST:if((this.ListTop>0)&&c){break}d.SetAttribute("inl",(this.ListTop<0)?"1":"0");break;case RD3Glb.PGR_COLLAPSED:d.SetAttribute("mfl",this.ListMovedFields?"1":"0");d.SetAttribute("mff",this.FormMovedFields?"1":"0");if(!this.Collapsed&&c){break}d.SetAttribute("col",this.Collapsed?"1":"0");break;case RD3Glb.PGR_COLLAPSIBLE:if(!this.Collapsible&&c){break}d.SetAttribute("clp",this.Collapsible?"1":"0");break;case RD3Glb.PGR_CLASSNAME:if(!this.iClassName&&c){break}d.SetAttribute("cln",this.iClassName?this.iClassName:"");break}};PGroupSrv.prototype.ClassName=function(){return this.iClassName};PGroupSrv.prototype.set_ClassName=function(a){this.iClassName=a;this.RD3Change(RD3Glb.PGR_CLASSNAME)};PListGroupSrv.EXPAND_ALL=0;PListGroupSrv.EXPAND_SELECTED=1;function PListGroupSrv(c){this.iLabel=new IDVariant();this.iStartingRecord=0;this.iEndingRecord=0;this.FieldIdx=-1;this.Level=-1;this.VisualStyle=-1;this.iExpanded=false;this.Min;this.Max;this.Last;this.GroupList=new ArrayList();this.Parent=c;this.AggrList=new ArrayList();for(var a=0;a<this.Parent.Fields.length;a++){var b=this.Parent.Fields[a];this.AggrList.Add(new PListGroupAggrSrv(b.Code,b.Index,b.GroupAggregation,b.GroupAggrLabel,this.Parent))}if(c.MainFrm.IsMobile()){this.iExpanded=true}}PListGroupSrv.prototype.GetRD3Name=function(){return"grl"};PListGroupSrv.prototype.Count=function(){return this.iEndingRecord-this.iStartingRecord+1};PListGroupSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Parent.FrIndex+":"+this.Parent.Parent.FormIdx+":"+this.Level+":"+this.iStartingRecord+":"+this.iEndingRecord};PListGroupSrv.prototype.RD3RenderDifference=function(d){var f=d.AddNewElement("lsg");f.SetAttribute("id",this.GetRD3Ident());f.SetAttribute("str",this.iStartingRecord.toString());f.SetAttribute("end",this.iEndingRecord.toString());f.SetAttribute("lvl",this.Level.toString());if(this.VisualStyle!=-1){f.SetAttribute("sty",this.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle).toString())}f.SetAttribute("exp",this.iExpanded?"1":"0");var c=this.iLabel.stringValue();if(IDL.IsNull(this.iLabel)){c="("+this.Parent.MainFrm.RTCObj.GetConst("5C9238CA-6E6E-4844-843D-7C49454664A1","vuoto",true)+")"}if(c.indexOf("GRPLB:")!=-1){c=this.Min.stringValue()+" - "+this.Max.stringValue();var a=this.Parent.VS.Mask(this.Parent.bFields(this.FieldIdx).VisualStyle);var g=true;if(!this.Parent.bFields(this.FieldIdx).Mask.equals("")){a=this.Parent.bFields(this.FieldIdx).Mask;g=false}if(!a.equals("=")){var h=new IDVariant();if(!IDL.IsNull(this.Min)){var b=new IDVariant();var j=new IDVariant();this.Parent.bFields(this.FieldIdx).GetClientMask(h,b,this.Min,a,this.Min.stringValue(),j,false,g)}else{h=new IDVariant("("+this.Parent.MainFrm.RTCObj.GetConst("5C9238CA-6E6E-4844-843D-7C49454664A1","vuoto",true)+")")}if(h.stringValue().equals("")){h=new IDVariant("0")}var k=new IDVariant();if(!IDL.IsNull(this.Max)){var b=new IDVariant();var j=new IDVariant();this.Parent.bFields(this.FieldIdx).GetClientMask(k,b,this.Max,a,this.Max.stringValue(),j,false,g)}else{k=new IDVariant("("+this.Parent.MainFrm.RTCObj.GetConst("5C9238CA-6E6E-4844-843D-7C49454664A1","vuoto",true)+")")}if(k.stringValue().equals("")){k=new IDVariant("0")}if(h.equals(k)){c=h.stringValue()}else{c=h.stringValue()+" - "+k.stringValue()}}}f.SetAttribute("lbl",c);for(var e=0;e<this.AggrList.Count();e++){this.AggrList[e].RD3RenderDifference(f)}for(var e=0;e<this.GroupList.Count();e++){this.GroupList[e].RD3RenderDifference(f)}};PListGroupSrv.prototype.RD3Expand=function(a,c,b,e,j){if(a.equals(this.GetRD3Ident())){if(this.iExpanded==c){return true}this.iExpanded=c;if(j>0){this.Parent.UpdateDynRows(j)}var g=c?this.iStartingRecord:this.iEndingRecord;if(b!=-1&&b!=this.Parent.NumRows-1){this.Parent.AttR=b;g=(c?this.iStartingRecord:this.iEndingRecord)-b;if(g<=0){this.Parent.AttR=(b+g)-1;g=1}}this.Parent.set_ActualPosition(g);this.Parent.FireOnExpandingGroup(new IDVariant(this.iExpanded),new IDVariant(e));if(!e){var h=this.Parent.MainFrm.RD3AddEvent("expgrp",this.GetRD3Ident());h.SetAttribute("exp",this.iExpanded?"1":"0")}this.Parent.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.Parent.RD3Change(RD3Glb.PAN_ACTUALROW,false);return true}else{var f=false;for(var d=0;d<this.GroupList.Count();d++){f|=this.GroupList[d].RD3Expand(a,c,b,e,j);if(f){break}}return f}};PListGroupSrv.prototype.RD3ExpandGroups=function(a,c,e){if(a==PListGroupSrv.EXPAND_SELECTED&&!(this.iStartingRecord<=e&&e<=this.iEndingRecord)){return}var d=a==PListGroupSrv.EXPAND_ALL?c:true;if(this.Level!=-1){this.RD3Expand(this.GetRD3Ident(),d,-1,false,-1)}for(var b=0;b<this.GroupList.Count();b++){this.GroupList[b].RD3ExpandGroups(a,c,e)}};PListGroupSrv.prototype.RD3ExpandGroupByLevel=function(b){if(this.Level<=b){this.RD3Expand(this.GetRD3Ident(),true,-1,false,-1)}for(var a=0;a<this.GroupList.Count();a++){this.GroupList[a].RD3ExpandGroupByLevel(b)}};PListGroupSrv.prototype.GenerateGroups=function(){var g=this.Level+1;this.UpdateGroupAggregations();if(g>=this.Parent.GroupingList.Count()){return}var l=this.Parent.GroupingList[g];var j=this.Parent.GetDecodingField(l);var c=(j.Index!=l.Index);if(j.IdxPanel>0){this.Parent.bQueries(j.IdxPanel).UpdateLookup(this.Parent.AttR,this.Parent.MainFrm);c=true}if((j.Flags&Glb.FLD_AUTOLOOKUP)!=0){for(var e=1;e<this.Parent.UQueries();e++){if(this.Parent.bQueries(e).FieldIndex==j.Index){this.Parent.bQueries(e).UpdateLookup(this.Parent.AttR,this.Parent.MainFrm)}}}if(this.GroupList.Count()==0){var a=null;var b=false;if((j.Flags&Glb.FLD_AUTOLOOKUP)!=0){a=new IDVariant(j.bValues(this.Parent.AttR).Text);b=true}else{if(j.ValueList.Count()>0){if(j.bValues(this.Parent.AttR).ValueListIndexes.length>0){a=new IDVariant(j.bValues(this.Parent.AttR).ValueListIndexes[0].Name);b=true}else{a=new IDVariant(j.bValues(this.Parent.AttR).Text)}}else{a=j.bValues(this.Parent.AttR).Value}}var m=new PListGroupSrv(this.Parent);m.Level=g;m.iStartingRecord=this.Parent.ActualPosition();m.iEndingRecord=this.Parent.ActualPosition();m.FieldIdx=j.Index;m.VisualStyle=j.GroupVS==-1?j.VisualStyle:j.GroupVS;m.Min=a;m.Max=a;m.Last=a;var d=(g==this.Parent.GroupingList.Count()-1);m.iLabel=j.GetGroupLabel(a,(b||c),null,d);this.GroupList.Add(m)}var o=this.GroupList[this.GroupList.Count()-1];var f=null;var h=null;var k=false;if((j.Flags&Glb.FLD_AUTOLOOKUP)!=0){h=new IDVariant(j.bValues(this.Parent.AttR).Text);k=true}else{if(j.ValueList.Count()>0){if(j.bValues(this.Parent.AttR).ValueListIndexes.length>0){h=new IDVariant(j.bValues(this.Parent.AttR).ValueListIndexes[0].Name);k=true}else{h=new IDVariant(j.bValues(this.Parent.AttR).Text)}}else{h=j.bValues(this.Parent.AttR).Value}}var n=(g==this.Parent.GroupingList.Count()-1);f=j.GetGroupLabel(h,(k||c),o,n);if(f.equals(o.iLabel)){o.iEndingRecord=this.Parent.ActualPosition();o.Last=h;if(h.compareTo(o.Min)<0){o.Min=h}if(h.compareTo(o.Max)>0){o.Max=h}}else{var m=new PListGroupSrv(this.Parent);m.Level=g;m.iLabel=f;m.iStartingRecord=this.Parent.ActualPosition();m.iEndingRecord=this.Parent.ActualPosition();m.FieldIdx=j.Index;m.VisualStyle=j.GroupVS==-1?j.VisualStyle:j.GroupVS;m.Min=h;m.Max=h;m.Last=h;this.GroupList.Add(m);o=m}o.GenerateGroups()};PListGroupSrv.prototype.UpdateGroupAggregations=function(){for(var b=0;b<this.AggrList.Count();b++){try{var a=this.AggrList[b];var c=this.Parent.Fields[a.FieldIdx];if(c.GroupAggregation==PListGroupAggrSrv.AGGR_NONE){continue}if(c.IdxPanel>0){this.Parent.bQueries(c.IdxPanel).UpdateLookup(0,this.Parent.MainFrm)}var f=null;if((c.Flags&Glb.FLD_AUTOLOOKUP)!=0){f=new IDVariant(c.bValues(this.Parent.AttR).Text)}else{if(c.ValueList.Count()>0){if(c.bValues(this.Parent.AttR).ValueListIndexes.length>0){f=new IDVariant(c.bValues(this.Parent.AttR).ValueListIndexes[0].Name)}else{f=new IDVariant(c.bValues(this.Parent.AttR).Text)}}else{f=c.bValues(this.Parent.AttR).Value}}a.CountNN+=1;if(f.compareTo(a.Min)<0||a.Min.Type==IDVariant.NULL){a.Min=f}if(f.compareTo(a.Max)>0||a.Max.Type==IDVariant.NULL){a.Max=f}a.Sum=IDL.Add(a.Sum,f);if(f.Type==IDVariant.INTEGER||f.Type==IDVariant.DECIMAL||f.Type==IDVariant.FLOAT){a.Sum2=IDL.Add(a.Sum2,new IDVariant(f.dblValue()*f.dblValue()))}}catch(d){}}};PListGroupSrv.prototype.MantainStatus=function(d){if(d==null){return}var c=true;var e=d;if(this.Level!=-1){c=false;for(var a=0;a<d.GroupList.Count();a++){var b=d.GroupList[a];if(b.iLabel.equals(this.iLabel)&&b.FieldIdx==this.FieldIdx){if(b.iExpanded&&!(this.iEndingRecord<=this.Parent.ActualPosition()+this.Parent.NumRows)&&!this.Parent.MainFrm.IsMobile()){this.iExpanded=false;c=false;break}this.iExpanded=b.iExpanded;e=b;c=true;break}}}if(!c){return}for(var a=0;a<this.GroupList.Count();a++){this.GroupList[a].MantainStatus(e)}};PListGroupSrv.prototype.getLabelNumber=function(){var b=this.Level==-1?0:1;for(var a=0;a<this.GroupList.Count();a++){b+=this.GroupList[a].getLabelNumber()}return b};PListGroupAggrSrv.AGGR_NONE=0;PListGroupAggrSrv.AGGR_SUM=1;PListGroupAggrSrv.AGGR_MIN=2;PListGroupAggrSrv.AGGR_MAX=3;PListGroupAggrSrv.AGGR_COUNT=4;PListGroupAggrSrv.AGGR_MEDIA=5;PListGroupAggrSrv.AGGR_MINMAX=6;PListGroupAggrSrv.AGGR_SCARTO=7;function PListGroupAggrSrv(e,c,b,a,d){this.CountNN=0;this.Sum=new IDVariant(0);this.Min=new IDVariant();this.Max=new IDVariant();this.Sum2=new IDVariant(0);this.FieldCode=e;this.FieldIdx=c;this.Aggr=b;this.Label=a;this.ParentPanel=d}PListGroupAggrSrv.prototype.RD3RenderDifference=function(e){if(this.Aggr==PListGroupAggrSrv.AGGR_NONE){return}var d=e.AddNewElement("agr");var c=new IDVariant();switch(this.Aggr){case PListGroupAggrSrv.AGGR_SUM:c=this.FormatAggr(this.Sum);break;case PListGroupAggrSrv.AGGR_MIN:c=this.FormatAggr(this.Min);break;case PListGroupAggrSrv.AGGR_MAX:c=this.FormatAggr(this.Max);break;case PListGroupAggrSrv.AGGR_COUNT:c=new IDVariant(this.CountNN);break;case PListGroupAggrSrv.AGGR_MEDIA:if(this.Sum.Type==IDVariant.INTEGER||this.Sum.Type==IDVariant.DECIMAL||this.Sum.Type==IDVariant.FLOAT){c=this.FormatAggr(new IDVariant(IDL.Div(this.Sum,new IDVariant(this.CountNN))))}else{c=new IDVariant("-")}break;case PListGroupAggrSrv.AGGR_MINMAX:c=new IDVariant(this.FormatAggr(this.Min).stringValue()+"-"+this.FormatAggr(this.Max).stringValue());break;case PListGroupAggrSrv.AGGR_SCARTO:if(this.Sum.Type==IDVariant.INTEGER||this.Sum.Type==IDVariant.DECIMAL||this.Sum.Type==IDVariant.FLOAT){var b=Math.sqrt(this.CountNN*this.Sum2.dblValue()-(this.Sum.dblValue()*this.Sum.dblValue()))/this.CountNN;c=new IDVariant(this.FormatAggr(IDL.Div(this.Sum,new IDVariant(this.CountNN))).stringValue()+"+-"+(2*b))}else{c=new IDVariant("-")}break}if(IDL.IsNull(this.Label)){switch(this.Aggr){case PListGroupAggrSrv.AGGR_SUM:this.Label=new IDVariant("Sum: ");break;case PListGroupAggrSrv.AGGR_MIN:this.Label=new IDVariant("Min: ");break;case PListGroupAggrSrv.AGGR_MAX:this.Label=new IDVariant("Max: ");break;case PListGroupAggrSrv.AGGR_COUNT:Label=new IDVariant("Num: ");break;case PListGroupAggrSrv.AGGR_MEDIA:this.Label=new IDVariant("Med: ");break;case PListGroupAggrSrv.AGGR_MINMAX:this.Label=new IDVariant("Min-Max: ");break;case PListGroupAggrSrv.AGGR_SCARTO:this.Label=new IDVariant("Med+-2Stdev: ");break}}var a=this.Label.stringValue()+c.stringValue();d.SetAttribute("shw",a);d.SetAttribute("fid",this.FieldIdx.toString())};PListGroupAggrSrv.prototype.FormatAggr=function(e){if(e.Type==IDVariant.BLOB||e.Type==IDVariant.DATETIME||e.Type==IDVariant.MILLIS_DAY||e.Type==IDVariant.NULL||e.Type==IDVariant.STRING||e.Type==IDVariant.VB_DAY_OFFS){return e}var d=this.ParentPanel.Fields[this.FieldIdx];var c=d.VisualStyle;var g=this.ParentPanel.VS.Mask(c);var f=true;if(!d.Mask.equals("")){g=d.Mask;f=false}if(!g.equals("=")&&d.EditorType!=1){var h=new IDVariant();var b=new IDVariant();var a=new IDVariant();d.GetClientMask(h,b,e,g,e.stringValue(),a,false,f);return h}return e};function PLookupParamSrv(){this.TblIdx=-1;this.FldIdx=-1;this.MstField;this.DataType;this.MaxLength;this.vScale;this.PropName="";this.PropIdx=-1;this.AutoLookup=false;this.Value=null}function PLookupValueSrv(){this.ParamList=new ArrayList();this.ValueList=new ArrayList();this.Loaded=false}function PPageSrv(){this.Parent;this.Index;this.VisualStyle;this.Flags;this.DesignFlags=-1;this.RoleFlags=-1;this.Image="";this.Header="";this.Tooltip="";this.iBadge="";this.iGuid;this.Style=0;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.PPG_MAXPROPS)}PPageSrv.prototype.Badge=function(){return this.iBadge};PPageSrv.prototype.set_Badge=function(a){this.iBadge=a;this.RD3Change(RD3Glb.PPG_BADGE)};PPageSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index+":"+this.Parent.FrIndex+":"+this.Parent.Parent.FormIdx};PPageSrv.prototype.GetRD3Name=function(){return"ppg"};PPageSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};PPageSrv.prototype.RD3RenderDifference=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){}return c};PPageSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.PPG_VISUALSTYLE:c.SetAttribute("sty",this.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle).toString());break;case RD3Glb.PPG_FLAGS:c.SetAttribute("flg",this.Flags.toString());break;case RD3Glb.PPG_IMAGE:if(this.Image.length==0&&b){break}c.SetAttribute("img",this.Image);break;case RD3Glb.PPG_HEADER:if(this.Header.length==0&&b){break}c.SetAttribute("cap",this.Header);break;case RD3Glb.PPG_TOOLTIP:if(this.Tooltip.length==0&&b){break}c.SetAttribute("tip",this.Tooltip);break;case RD3Glb.PPG_STYLE:if(this.Style==0&&b){break}c.SetAttribute("pst",this.Style.toString());break;case RD3Glb.PPG_BADGE:if(this.iBadge.length==0&&b){break}c.SetAttribute("bdg",this.iBadge);break;case RD3Glb.PPG_INDEX:c.SetAttribute("ind",this.Index.toString());break}};PQuerySrv.LKE_OLDSEL_OFFSET=1000;PQuerySrv.MAX_COLL_ROWS=500;function PQuerySrv(){this.Parent;this.Index;this.FieldIndex=-1;this.DB;this.DBType;this.IMDBDataSource=-1;this.IMDBPrimaryTable=-1;this.IMDBOrigTable=null;this.iGuid;this.Text=new Array(Glb.SQL_MAXQUERIES);this.RS=new IDCachedRowSet();this.QueryOK;this.LastPreparedQueryIndex=0;this.LastWhereClause="";this.MstTableName;this.AIFieldIndex=-1;this.AIQuery;this.MaxRows=0;this.ActualPosition=0;this.LookupValues=new ArrayList();this.LookupParams=new ArrayList();this.LKEParams=null;this.LKERows=null;this.LastLKERow=0;this.LastLKETry=0;this.UnboundData=new ArrayList();this.DOSortCriteria=null;this.QBEComboQuery=false;this.LkeMS=null;this.iIsMultiSelect=-2;this.VisibleColumns=null;this.HeaderColumns=null;this.OrderColumns=null;this.DecodeColumn=0;this.VisibilityColumnsMode=Glb.QRY_VISDEF;this.ExpressionColumns=null;this.QueryParameters=new ArrayList();this.NumQBEParameters=0;this.BlobCache=new ArrayList();this.RSParam=new ArrayList();this.LkeRSLimitedBySystem=false;this.LastSQL="";this.LookupLoaded=null;this.Document;this.DocTempl;this.DocFilter;this.IDColl;this.CollUpdCount=0;this.IsDO=false;this.IsMasterDO=false;this.LastRC=0;this.SortColumns=null;this.SortAscending=null;this.NumSort=0;this.LookupRows=null;this.CursorPos=0;this.PreviousLookupParam=null;this.PreviousLkeParam=null;this.PreviuosDocument=null;this.RS.pQuery=this}PQuerySrv.prototype.SetText=function(b,a){this.Text[b]=a};PQuerySrv.prototype.FindData=function(r,I){var B=new IDVariant();var J="";var u=true;this.Parent.FireBeforeFind(B);if(B.isTrue()){r.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",89,"PQuery.FindData","Panel "+this.Parent.GetDTTCaption()+": find data canceled");return false}else{if(this.IsDO){if(this.DocTempl!=null){this.IDColl.Clear();if(!I){this.DocTempl.Clear();this.NumQBEParameters=0;for(var E=0;E<this.Parent.UMaster();E++){var G=this.Parent.bMaster(E);var D=G.LastQBE;var F=G.GetDOIdx(this.DocTempl);if((!G.QBELike||G.HasConcept("DO_ID")||(G.Flags&Glb.FLD_AUTOLOOKUP)!=0)&&D.length>0){D="§"+D}if(G.IsNamed){this.DocTempl.SetNamedPropertyValue(G.Code,new IDVariant(D))}else{if(F>0){this.DocTempl.SetPropByIndex(F,new IDVariant(D))}}if(D!=null&&D.length>0){this.NumQBEParameters++}}if(this.MaxRows>0){this.IDColl.MaxRows=this.MaxRows}else{this.IDColl.MaxRows=PQuerySrv.MAX_COLL_ROWS}if(this.DOSortCriteria!=null){this.IDColl.ClearSort();for(var E=0;E<this.DOSortCriteria.Count();E++){this.IDColl.SortBy(this.DOSortCriteria[E])}}try{this.LastWhereClause="";if(!this.QueryOK){this.UpdateParam(false)}var n=this.Text[Glb.SQL_WHERE];if(n!=null){var K=0;for(var E=0;E<this.RSParam.Count();E++){var y=this.RSParam[E];var v=false;var A=K;for(;A<n.length;A++){if(n.charAt(A)=="'"){v=!v}else{if(n.charAt(A)=="?"&&!v){K=A;break}}}if(A>=n.length){break}n=n.remove(A,1);var c=IDL.FMT_NUM;switch(y.Type){case IDVariant.STRING:c=IDL.FMT_CHAR;break;case IDVariant.DATETIME:var b=this.DocTempl.GetMD().GetDBType();if(Glb.ClassDB(b)==Glb.DBC_ACCESS){c=IDL.FMT_DAT1}else{if(Glb.ClassDB(b)==Glb.DBC_ORACLE||Glb.ClassDB(b)==Glb.DBC_POSTGRES){c=IDL.FMT_DAT3}else{if(Glb.ClassDB(b)==Glb.DBC_SQLITE){c=IDL.FMT_DAT4}else{if(b==Glb.DBT_DB2400&&this.DB.UseAS400Date){c=IDL.FMT_DAT5}else{c=IDL.FMT_DAT2}}}}break}n=n.insert(A,IDL.CSql(y,c,this.DB))}}this.DocTempl.LoadCollectionBE(this.IDColl,true,0,n);var h=new IDVariant();var q=new IDVariant();var t=new IDVariant();this.DocTempl.GetQBEClauses(this.IDColl,true,h,q,t);this.LastWhereClause=(h.stringValue().length>0?"where "+h.stringValue():"")}catch(H){r.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",90,"PQuery.FindData","Panel "+this.Parent.GetDTTCaption()+": Find data error ("+H.message+")");u=false;this.ActualPosition=0;this.Parent.FireDBError(new IDVariant(true),new IDVariant(false),H,Glb.PANOP_FIND,null)}}}if(this.IDColl!=null&&this.DocFilter!=null){this.DocFilter.Clear();for(var E=0;E<this.Parent.UMaster();E++){var G=this.Parent.bMaster(E);var D=G.LastQBE;var F=G.GetDOIdx(this.DocFilter);if((!G.QBELike||G.HasConcept("DO_ID")||(G.Flags&Glb.FLD_AUTOLOOKUP)!=0)&&D.length>0){D="§"+D}if(G.IsNamed){this.DocFilter.SetNamedPropertyValue(G.Code,new IDVariant(D))}else{if(F>0){this.DocFilter.SetPropByIndex(F,new IDVariant(D))}}}this.IDColl.FilterDocs(this.DocFilter,true)}this.ActualPosition=1;if(this.IDColl!=null){this.IDColl.MoveFirst()}if(this.IDColl!=null&&this.IDColl.Count()>1&&this.Parent.SortingList!=null&&this.Parent.SortingList.Count()>0){this.EnableSorting(this.Parent.SortingList);this.GotoFirst()}if(this.IDColl!=null){var g=this.IDColl.UIMode();if(!g){this.IDColl.set_UIMode(true)}this.LastRC=this.IDColl.Count();if(!g){this.IDColl.set_UIMode(false)}}else{if(this.Document!=null){this.LastRC=1}else{this.LastRC=0}}this.BlobCache.Clear();return true}if(this.IMDBDataSource>-1){if((this.Parent.Flags&Glb.PAN_CANSELECT)!=0){var k=new ArrayList();var j=new ArrayList();for(var E=0;E<this.Parent.UMaster();E++){var G=this.Parent.bMaster(E);var D=G.LastQBE;if((!G.QBELike||G.HasConcept("DO_ID")||(G.Flags&Glb.FLD_AUTOLOOKUP)!=0)&&D.length>0){D="§"+D}if(D.length>0){k.Add(G.GetIMDBIdx());j.Add(new IDVariant(D))}}if(this.IMDBOrigTable==null||(this.Parent.IMDB.TblModified(this.IMDBDataSource,Glb.GlbRefModIdx)&&!this.Parent.IMDB.Table(this.IMDBDataSource).IsFiltered)){this.IMDBOrigTable=new IMDBTableSrv(this.Parent.IMDB);this.IMDBOrigTable.CopyFrom(this.Parent.IMDB.Table(this.IMDBDataSource),true)}else{this.Parent.IMDB.TblTruncate(this.IMDBDataSource);this.Parent.IMDB.Table(this.IMDBDataSource).CopyFrom(this.IMDBOrigTable,true)}if(k.Count()>0){this.Parent.IMDB.TblFilter(this.IMDBDataSource,k,j,Glb.IMDB_CURSOR,true,this.Parent.MainFrm)}}this.Parent.IMDB.TblMoveFirst(this.IMDBDataSource,Glb.IMDB_CURSOR);this.ActualPosition=1;this.Parent.UpdateDynRows(this.RecordCount());this.BlobCache.Clear();return true}if(!this.QueryOK){this.UpdateParam(false)}while(this.NumQBEParameters>0){this.RSParam.RemoveAt(this.RSParam.Count()-1);this.NumQBEParameters--}var C=this.GetQBE(0);var m=this.GetQBE(1);for(var E=0;E<Glb.SQL_MAXQUERIES;E++){switch(E){case Glb.SQL_WHERE:if(!I){if(C.length==0){this.LastWhereClause=this.Text[E]+"\r\n"}else{if(this.Text[E].length==0){this.LastWhereClause="where ("+C+")\r\n"}else{this.LastWhereClause=this.Text[E]+"\r\nand ("+C+")\r\n"}}J=J+this.LastWhereClause}else{J=J+"where 0=1\r\n"}break;case Glb.SQL_HAVING:if(m.length==0){J=J+this.Text[E]+"\r\n"}else{if(this.Text[E].length==0){J=J+"having ("+m+")\r\n"}else{J=J+this.Text[E]+"\r\nand ("+m+")\r\n"}}break;default:J=J+this.Text[E]+"\r\n";break}}var l=new IDVariant(J);this.PrepareParam(true,l);J=l.stringValue();var a=J;J=this.Parent.MainFrm.HandleTableSubst(J,0);try{this.ActualPosition=0;r.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Find data","Panel find data",DTTEngine.STMT_QRY_SELECT,J);try{var o=1;for(var E=0;E<this.RSParam.Count();E++){var d=this.RSParam[E];r.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+o++,d)}}catch(H){}if((this.Parent.Flags&Glb.PAN_CANDELETE)==0&&(this.Parent.Flags&Glb.PAN_CANUPDATE)==0&&(this.Parent.Flags&Glb.PAN_CANINSERT)==0){this.RS.setReadOnly()}else{this.RS.setUpdatable()}this.LastSQL=J;this.DB.MaxRows=this.MaxRows;this.RS.setCommand(this.DB.ApplySubstitutions(J));this.RS.setMaxRows(this.MaxRows);this.InitConnection();if(I){this.RS.execute(new ArrayList(),this.DB)}else{this.RS.execute(this.RSParam,this.DB)}r.DTTObj.AddDBDataSource(this.RS,J);r.DTTObj.EndQuery(this.iGuid);this.DB.MaxRows=0;if(this.LookupRows!=null){this.LookupRows=null;this.CursorPos=1}if(!this.RSEOF()){this.StartSort();this.GotoFirst()}this.BlobCache.Clear();this.ClearUnboundData();this.ActualPosition=1}catch(x){r.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",90,"PQuery.FindData","Panel "+this.Parent.GetDTTCaption()+": Find data error ("+x.message+")");u=false;this.ActualPosition=0;this.Parent.FireDBError(new IDVariant(true),new IDVariant(false),x,Glb.PANOP_FIND,null)}finally{if(!J.equals(a)){this.RS.setCommand(this.DB.ApplySubstitutions(a))}}}this.PrepareLastWhereClause();this.Parent.UpdateDynRows(this.RecordCount());return u};PQuerySrv.prototype.GetQBE=function(a){var A;var G="";var F=this.Parent.MainFrm.ParamsObj().PanelsLikeMode;for(var z=0;z<this.Parent.UMaster();z++){var D=this.Parent.bMaster(z);var k=true;if(!D.QBELike||(D.Flags&Glb.FLD_AUTOLOOKUP)!=0){k=false}if(!D.iMultiCriteria&&(D.Flags&Glb.FLD_AUTOLOOKUP)!=0){A=D.bValues(0).Value.stringValue();if(A.length>0&&A!="."&&A!="!"){A="="+A}}else{A=D.bValues(0).Text}if((((a==0&&(D.Flags&Glb.FLD_ISAGGR)==0)||(a==1&&(D.Flags&Glb.FLD_ISAGGR)!=0))&&A.length>0)){var q="";var s;var g=-1;var e=-1;var y=true;while(g>=0||y){y=false;if(A.charAt(0)!="="){g=A.indexOf(D.GetQBESep(),g+1)}if(g>=0){s=A.substr(e+1,g-(e+1))}else{s=A.substr(e+1)}var n="";var o=new Array(2);o[0]="";o[1]="";if(s.length>0){if(D.HasConcept("DO_ID")){if(s=="."){n="not "+D.Expr+" is null"}else{if(s=="!"){n=D.Expr+" is null"}else{if(s[0]=="#"&&s.length==21){n=D.Expr+" <> ?";o[0]=s.substring(1)}else{if(s[0]=="="&&s.length==21){n=D.Expr+" = ?";o[0]=s.substring(1)}else{n=D.Expr+" = ?";o[0]=s}}}}}else{if(s.length>1&&s.charAt(0)==">"){if(this.Parent.MainFrm.ParamsObj().QBETrueLessThan){n=D.Expr+" > ?"}else{n=D.Expr+" >= ?"}o[0]=s.substr(1);if(D.DataType==Glb.DT_DATETIME||D.DataType==Glb.DT_DATE){var E=IDL.ParsePartialDate(this.Parent.MainFrm,o[0],(this.Parent.MainFrm.ParamsObj().QBETrueLessThan?1:0));if(E.Type!=IDVariant.NULL){n=D.Expr+" >= ?";o[0]=E.stringValue()}}}if(s.length>1&&s.charAt(0)=="<"){if(this.Parent.MainFrm.ParamsObj().QBETrueLessThan){n=D.Expr+" < ?"}else{n=D.Expr+" <= ?"}o[0]=s.substr(1);if(D.DataType==Glb.DT_DATETIME||D.DataType==Glb.DT_DATE){var E=IDL.ParsePartialDate(this.Parent.MainFrm,o[0],(this.Parent.MainFrm.ParamsObj().QBETrueLessThan?0:1));if(E.Type!=IDVariant.NULL){n=D.Expr+" < ?";o[0]=E.stringValue()}}}if(s.length==1&&s.charAt(0)=="."){n=D.Expr+" is not null"}if(s.length==1&&s.charAt(0)=="!"){n=D.Expr+" is null"}if(s.length>1&&s.charAt(0)=="#"){s=s.substr(1);if(k&&Glb.ClassDT(D.DataType)==Glb.DTC_CHAR){s=s.replace(/\%/g,"*");if((D.Flags&Glb.FLD_AUTOLOOKUP)==0&&s.indexOf("*")==-1){s=(F==Glb.PAN_LIKECONTAINS?"*":"")+s+"*"}var I=0;var l=this.Parent.VS.Mask(D.VisualStyle);if(l.equals(">")){n="(";o[0]=s.toUpperCase()}else{if(l.equals("<")){n="(";o[0]=s.toLowerCase()}else{switch(Glb.ClassDB(this.DBType)){case Glb.DBC_ACCESS:n="lcase(";o[0]=s.toLowerCase();break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:case Glb.DBC_DB2:case Glb.DBC_SQLSRV:n="lower(";o[0]=s.toLowerCase();I=(this.DB.Unicode?4000:8000);break;case Glb.DBC_ORACLE:n="lower(";o[0]=s.toLowerCase();I=2000;break;default:n="(";o[0]=s;break}if(I>0&&D.MaxLength>I){n="(";o[0]=s}}}var B=new IDVariant(o[0]);var x=new IDVariant();IDL.LikeEscape(this.DBType,B,x);o[0]=B.stringValue().replace(/\*/g,"%");n+=D.Expr+") not like ?"+x.stringValue()}else{n=D.Expr+" <> ?";o[0]=s;if(D.DataType==Glb.DT_DATETIME||D.DataType==Glb.DT_DATE){var v=IDL.ParsePartialDate(this.Parent.MainFrm,o[0],0);var u=IDL.ParsePartialDate(this.Parent.MainFrm,o[0],1);if(v.Type!=IDVariant.NULL){n=D.Expr+" < ? or "+D.Expr+" >= ?";o[0]=v.stringValue();o[1]=u.stringValue()}}}}if(s.length>1&&s.charAt(0)=="="){n=D.Expr+" = ?";o[0]=s.substr(1)}else{if(Glb.ClassDT(D.DataType)==Glb.DTC_CHAR&&s.length>1&&s.charAt(s.length-1)=="&"){if(Glb.ClassDB(this.DBType)!=Glb.DBC_ACCESS&&Glb.ClassDB(this.DBType)!=Glb.DBC_ODBC&&Glb.ClassDB(this.DBType)!=Glb.DBC_POSTGRES){n="soundex("+D.Expr+") = soundex(?)";o[0]=s.substr(0,s.length-1)}else{s=s.substr(0,s.length-1)+"*"}}if(n.length==0){var r;r=s.indexOf(":");if(r>=0){var H=false;if(Glb.ClassDT(D.DataType)==Glb.DTC_DATE){H=true;var v=IDL.ParsePartialDate(this.Parent.MainFrm,s.substr(0,r),0);var u=IDL.ParsePartialDate(this.Parent.MainFrm,s.substr(r+1),1);var m=(v.Type!=IDVariant.NULL||u.Type!=IDVariant.NULL);if(s.indexOf("/")!=-1||s.indexOf("-")!=-1||m){var b;for(b=r+1;b<s.length;b++){if(s.charAt(b)==":"){r=b}else{if(s.charAt(b)=="/"||s.charAt(b)=="-"){break}}}if(b<=s.length){var j=s.substr(0,r);var h=s.substr(r+1);if(j.length>0&&h.length>0){if(v.Type==IDVariant.NULL&&u.Type==IDVariant.NULL){n=D.Expr+" between ? and ?";o[0]=j;o[1]=h}else{n=D.Expr+" >= ?";if(v.Type==IDVariant.NULL){o[0]=j}else{o[0]=v.stringValue()}if(u.Type==IDVariant.NULL){n+=" and "+D.Expr+" <= ?";o[1]=h}else{n+=" and "+D.Expr+" < ?";o[1]=u.stringValue()}}}else{if(j.length>0){n=D.Expr+" >= ?";if(v.Type==IDVariant.NULL){o[0]=j}else{o[0]=v.stringValue()}}else{if(h.length>0){if(u.Type==IDVariant.NULL){n=D.Expr+" <= ?";o[0]=h}else{n=D.Expr+" < ?";o[0]=u.stringValue()}}}}}}else{var t=new ArrayList();for(var b=0;b<s.length;b++){if(s.charAt(b)==":"){t.Add(b)}}if(t.Count()>2&&(t.Count()%2)==1){r=t[(t.Count()-1)/2];var j=s.substr(0,r);var h=s.substr(r+1);if(j.length>0&&h.length>0){n=D.Expr+" between ? and ?";o[0]=j;o[1]=h}else{if(j.length>0){n=D.Expr+" >= ?";o[0]=j}else{if(h.length>0){n=D.Expr+" <= ?";o[0]=h}}}}}}if(!H){var j=s.substr(0,r);var h=s.substr(r+1);if(j.length>0&&h.length>0){n=D.Expr+" between ? and ?";o[0]=j;o[1]=h}else{if(j.length>0){n=D.Expr+" >= ?";o[0]=j}else{if(h.length>0){n=D.Expr+" <= ?";o[0]=h}}}}}}if(n.length==0){var C=s.indexOf(" ")>=0&&(s.indexOf(":")>=0||s.indexOf(".")>=0);var v=IDL.ParsePartialDate(this.Parent.MainFrm,s,0);var u=IDL.ParsePartialDate(this.Parent.MainFrm,s,1);if((D.DataType==Glb.DT_DATETIME||D.DataType==Glb.DT_DATE)&&v.Type!=IDVariant.NULL){n=D.Expr+" >= ? and "+D.Expr+" < ?";o[0]=v.stringValue();o[1]=u.stringValue()}else{if(((D.DataType==Glb.DT_DATETIME&&!C)||(Glb.ClassDB(this.DBType)==Glb.DBC_SQLITE&&D.DataType==Glb.DT_DATE))){v=new IDVariant(s,IDVariant.DATETIME);if(v.Type!=IDVariant.NULL){n=D.Expr+" between ? and ?";o[0]=s;o[1]=s+" 23:59:59"}else{n=D.Expr+" = ?";o[0]=s}}else{if(k&&Glb.ClassDT(D.DataType)==Glb.DTC_CHAR){s=s.replace(/\%/g,"*");if((D.Flags&Glb.FLD_AUTOLOOKUP)==0&&s.indexOf("*")==-1){s=(F==Glb.PAN_LIKECONTAINS?"*":"")+s+"*"}var I=0;var l=this.Parent.VS.Mask(D.VisualStyle);if(l.equals(">")){n="(";o[0]=s.toUpperCase()}else{if(l.equals("<")){n="(";o[0]=s.toLowerCase()}else{switch(Glb.ClassDB(this.DBType)){case Glb.DBC_ACCESS:n="lcase(";o[0]=s.toLowerCase();break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:case Glb.DBC_DB2:case Glb.DBC_SQLSRV:n="lower(";o[0]=s.toLowerCase();I=(this.DB.Unicode?4000:8000);break;case Glb.DBC_ORACLE:n="lower(";o[0]=s.toLowerCase();I=2000;break;default:n="(";o[0]=s;break}if(I>0&&D.MaxLength>I){n="(";o[0]=s}}}var B=new IDVariant(o[0]);var x=new IDVariant();IDL.LikeEscape(this.DBType,B,x);o[0]=B.stringValue().replace(/\*/g,"%");n+=D.Expr+") like ?"+x.stringValue()}else{n=D.Expr+" = ?";o[0]=s}}}}}}for(var c=0;c<o.length;c++){if(o[c].length>0){D.bValues(0).Validate(o[c].trim());this.RSParam.Add(D.bValues(0).Value);this.NumQBEParameters++}}if(n.length>0){if(q.length>0){q=q+" or "}q=q+"("+n+")"}}e=g}if(q.length>0){if(G.length>0){G=G+" and "}G=G+"("+q+")"}}}return G};PQuerySrv.prototype.FillPanel=function(a,j){if(j==undefined){j=true}this.Parent.RD3Change(RD3Glb.PAN_ACTUALPOSITION);this.Parent.RD3Change(RD3Glb.PAN_ACTUALROW);for(var c=0;c<this.Parent.UFields();c++){this.Parent.bFields(c).ClearBuffer(j)}if(a==null){return}try{if(this.IsDO&&this.IDColl!=null){this.IDColl.set_UIMode(true);this.CollUpdCount=this.IDColl.UpdateCount();this.LastRC=this.IDColl.Count()}for(var f=0;f<this.Parent.NumRows;f++){this.Parent.SetRowError(f,"");if(this.IsDO){if(this.IDColl!=null){if(this.IDColl.IsEof()){break}}else{if(this.Document!=null){if(f>0){break}}else{break}}}else{if(this.IMDBDataSource==-1){if(this.RSEOF()){break}}else{if(this.Parent.IMDB.Eof(this.IMDBDataSource,Glb.IMDB_CURSOR)){break}}}if(this.IsDO){var d=this.GetAttRecNumber()+f-1;if(this.IDColl!=null){this.Document=this.IDColl.GetAt()}var b=this.Document.UpdateCount();if(this.Parent.RD3UpdateCount!=null){if(d>=this.Parent.RD3UpdateCount.length||(this.Parent.RD3UpdateCount[d]||0)!=b){if(d<this.Parent.RD3ListCache.length){this.Parent.RD3ListCache[d]=false}if(d<this.Parent.RD3FormCache.length){this.Parent.RD3FormCache[d]=false}}if(d<this.Parent.RD3UpdateCount.length){this.Parent.RD3UpdateCount[d]=b}}this.Parent.set_RowUpdateCount(f,b)}for(var c=0;c<this.Parent.UMaster();c++){if(this.IsDO){this.Parent.bMaster(c).SetDOBuffer(f,this.Document,this)}else{if(this.IMDBDataSource>-1){this.Parent.bMaster(c).SetIMDBBuffer(f,this.IMDBDataSource,this)}else{this.Parent.bMaster(c).SetBuffer(f,this.RS,this)}}}if(this.IsDO){var h=0;if(this.IDColl!=null){h=this.IDColl.AbsolutePosition()}this.Parent.DumpDocErrors(this.Document,f,false,null);if(this.IDColl!=null){this.IDColl.set_AbsolutePosition(h)}}if(this.IsDO){if(this.IDColl!=null){this.IDColl.MoveNext()}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR)}else{this.GotoNext()}}}if(this.Parent.RD3UpdateCount!=null&&this.RecordCount()<this.Parent.RD3UpdateCount.length){this.Parent.ClearRD3Cache(this.RecordCount()+1,this.Parent.RD3UpdateCount.length);this.Parent.UpdateDynRows(this.RecordCount())}}catch(g){}this.DoUpdateLookups(-1,a);this.UpdateIMDB(this.Parent.AttR,true,true,true);if(this.IsDO&&this.IDColl!=null){this.IDColl.set_UIMode(false)}if(this.Parent.ShowMultipleSel()||this.IsDO){this.Parent.SetRDRowSel(-1,true)}};PQuerySrv.prototype.RecordCount=function(){if(this.IsDO){if(this.IDColl!=null){return this.LastRC}else{if(this.Document!=null){return 1}}return 0}if(this.IMDBDataSource>-1){return this.Parent.IMDB.TblNumRows(this.IMDBDataSource)}try{if(!this.RS.IsOpen()){return -1}else{if(this.RS.RecordCount()==-1){return this.ActualPosition+100}else{return this.RS.RecordCount()}}}catch(a){return -1}};PQuerySrv.prototype.GetAttRecNumber=function(){return this.ActualPosition};PQuerySrv.prototype.ScrollBy=function(a){this.ScrollTo(this.ActualPosition+a)};PQuerySrv.prototype.ScrollTo=function(f){var d=false;var c=this.Parent.PanelMode==Glb.PANEL_FORM&&(this.Parent.Flags&Glb.PAN_CANINSERT)!=0;this.ActualPosition=f;if(c){if(this.ActualPosition>this.RecordCount()){this.ActualPosition=this.RecordCount()+1;d=true}}else{if(this.ActualPosition>this.RecordCount()){this.ActualPosition=this.RecordCount()}}if(this.ActualPosition<1){this.ActualPosition=1}if(this.IsDO){if(this.IDColl!=null){this.IDColl.set_UIMode(true);if(d){this.IDColl.MoveLast();this.IDColl.MoveNext()}else{this.IDColl.set_AbsolutePosition(this.ActualPosition)}this.IDColl.set_UIMode(false)}}else{if(this.IMDBDataSource>-1){if(d){this.Parent.IMDB.TblMoveLast(this.IMDBDataSource,Glb.IMDB_CURSOR);this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR)}else{this.Parent.IMDB.TblMoveFirst(this.IMDBDataSource,Glb.IMDB_CURSOR);var a=1;while(a<this.ActualPosition){this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR);a++}}}else{try{if(d){this.GotoLast();this.GotoNext()}else{this.GotoAbsolute(this.ActualPosition)}}catch(b){}}}};PQuerySrv.prototype.CloseData=function(){try{if(this.IMDBDataSource==-1&&!this.IsDO){this.RS.Close()}if(this.IsDO&&this.DocTempl!=null){this.IDColl.Clear();this.CollUpdCount=this.IDColl.UpdateCount()}this.FillPanel(null)}catch(a){}};PQuerySrv.prototype.UpdateLookup=function(a,n){var d=a;var c=a;if(a==-1){d=0;c=this.Parent.NumRows-1}if(!this.QueryOK||this.LastPreparedQueryIndex!=0){this.PrepareLookup(0)}if(this.IsDO&&this.Document!=null){for(var h=0;h<this.LookupParams.Count();h++){var b=this.LookupParams[h];if(b.TblIdx==this.Parent.MstTblIndex){var r=this.Parent.IMDB.FldCode(b.TblIdx,b.FldIdx);b.TblIdx=-1;for(var k=0;k<this.Parent.UMaster();k++){if(this.Parent.bMaster(k).Code.equals(r)){b.MstField=this.Parent.bMaster(k);break}}}if(b.PropIdx==-1&&b.PropName.length>0){b.PropIdx=this.Document.GetPropIndex(b.PropName);if(b.PropIdx<1){b.PropIdx=this.Document.GetPropertyIndex(b.PropName)}if(b.PropIdx<1){this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.iGuid,100,"PQuery.UpdateLookup","Cannot Find Document Property <"+b.PropName+" in document: "+this.Document)}b.PropName=""}}}for(var g=d;g<=c;g++){var m=null;var o=null;if(this.Parent.Status()==Glb.PS_QBE){for(var h=0;h<this.LookupParams.Count();h++){var b=this.LookupParams[h];if(b.Value==null){if(b.MstField!=null){if(!b.MstField.iMultiCriteria&&(b.MstField.Flags&Glb.FLD_AUTOLOOKUP)!=0){o=b.MstField.bValues(g).Value.stringValue().split(b.MstField.GetQBESep().charAt(0))}else{o=b.MstField.bValues(g).Text.split(b.MstField.GetQBESep().charAt(0))}}else{var q=";";if(this.Parent.IMDB.GetFldDataType(b.TblIdx,b.FldIdx)==Glb.DT_CHAR_FIXED&&this.Parent.IMDB.GetFldMaxLength(b.TblIdx,b.FldIdx)==20){q=" "}o=this.Parent.IMDB.Value(b.TblIdx,b.FldIdx,0).stringValue().split(q)}if(o.length>1){m=b;break}}}}if(m==null){this.UpdateLookupRow(g,n,-1)}else{var l;var f=null;if(m.MstField!=null){f=m.MstField.bValues(g).Text;l=new IDVariant(m.MstField.bValues(g).Value)}else{l=this.Parent.IMDB.Value(m.TblIdx,m.FldIdx,0)}for(var e=0;e<o.length;e++){if(m.MstField!=null){m.MstField.bValues(g).Value=new IDVariant(o[e],IDL.DataType2IDVariantType(m.MstField.DataType))}else{this.Parent.IMDB.set_Value(m.TblIdx,m.FldIdx,0,new IDVariant(o[e]))}this.UpdateLookupRow(g,n,e)}if(m.MstField!=null){m.MstField.bValues(g).Text=f;m.MstField.bValues(g).Value=l}else{this.Parent.IMDB.set_Value(m.TblIdx,m.FldIdx,0,new IDVariant(l))}}}};PQuerySrv.prototype.UpdateLookupRow=function(a,G,H){if(this.LookupLoaded==null){this.LookupLoaded=new Array(this.Parent.NumRows)}else{if(this.LookupLoaded.length<this.Parent.NumRows){Array.resize(this.LookupLoaded,this.Parent.NumRows)}}if(this.IsDO){var K=false;var L=false;if(this.Document!=null){var d=this.Document.GetMD();this.Document.Clear();for(var r=0;r<this.LookupParams.Count();r++){var J=this.LookupParams[r];if(J.Value==null){var I;if(J.MstField!=null){I=J.MstField.bValues(a).Value;if(J.MstField.IsExtended&&J.MstField.IDLista.length>0){var Q=this.Document.GetPropertyIndex("DO_LISTID",true,true,true,true);if(Q>0){this.Document.SetPropByIndex(Q,new IDVariant(J.MstField.IDLista))}}}else{I=this.Parent.IMDB.Value(J.TblIdx,J.FldIdx,0)}if(J.PropIdx>0){if(I.Type!=IDVariant.NULL){this.Document.SetPropByIndex(J.PropIdx,I);if(J.MstField!=null){K=true;if(d.GetProp(J.PropIdx).PK){L=true}}}}}else{this.Document.SetPropByIndex(J.PropIdx,J.Value)}}var b=true;for(var R=1;R<=d.GetNumProp();R++){var x=d.GetProp(R);if("DO_CODE".equals(x.Concept)&&this.Document.GetPropByIndex(R).Type!=IDVariant.NULL){b=true;break}if(b&&x.PK&&this.Document.GetPropByIndex(R).Type==IDVariant.NULL){var A=new Array(Glb.SQL_MAXQUERIES);var o=new ArrayList();this.Document.GetMasterQuery(A,new IDVariant(),o);if(o.IndexOf(x.Index)==-1&&A[0]){b=false}}}if(!b||!L){this.Document.Clear();var n;if(this.Parent.IsDO()&&this.Parent.Status()!=Glb.PS_UPDATE){n=(this.Parent.GetDocument(a)==null)}else{n=(this.Parent.IsNewRow(a)&&!this.Parent.IsRowModified(a))}if(this.Parent.Status()!=Glb.PS_QBE&&!n){G.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",88,"PQuery.UpdateLookup","Panel "+this.Parent.GetDTTCaption()+": the lookup query was not performed for row "+(a+1)+" because the primary key is non complete.")}}else{if(this.Document.Updated()){for(var r=0;r<this.LookupParams.Count();r++){var J=this.LookupParams[r];if(J.Value!=null&&J.PropIdx>0){this.Document.SetPropByIndex(J.PropIdx,J.Value)}}}if(K){this.Document.LoadLookupValues(true)}}if(this.IsMultiSelect()&&this.Parent.Status()==Glb.PS_QBE){if(this.LkeMS==null){this.LkeMS=new IDCachedRowSet();var t=new ArrayList();for(var R=1;R<=d.GetNumProp();R++){var x=d.GetProp(R);if(((x.DBCode!=null&&x.DBCode.length>0)||x.IOTCode.length>0)&&x.DataType!=Glb.DT_DOC_OLE){t.Add(R)}}var m=new IDCachedRowSetMetaData();m.setColumnCount(t.Count());for(var R=0;R<t.Count();R++){var x=d.GetProp(t[R]);m.setColumnName(R+1,x.ObjTag);m.setColumnType(R+1,IDCachedRowSetMetaData.GetCSharpType(x.DataType))}this.LkeMS.setMetaData(m)}else{if(H<=0){this.LkeMS.RemoveAllRows()}}if(L){var u=new ArrayList();for(var R=1;R<=d.GetNumProp();R++){var x=d.GetProp(R);if(((x.DBCode!=null&&x.DBCode.length>0)||x.IOTCode.length>0)&&x.DataType!=Glb.DT_DOC_OLE){u.Add(this.Document.GetPropByIndex(R))}}this.LkeMS.AddRow(u)}}if(this.FieldIndex>-1){var S=this.Parent.bFields(this.FieldIndex);var D=S.bValues(a).LastValue;var s=this.Document.GetAutoLookupCode();var g=this.Document.GetAutoLookupDescription();if(H>0){s=new IDVariant(S.bValues(a).Value.stringValue()+S.GetQBESep()+s.stringValue());g=new IDVariant(S.bValues(a).Text+G.ComboNameSep+g.stringValue())}S.bValues(a).SetAutoLookupValues(new IDVariant(s),new IDVariant(g));if(H>0){S.bValues(a).LastValue=new IDVariant(D)}}else{for(var P=0;P<this.Parent.UFields();P++){var S=this.Parent.bFields(P);if(S.IdxPanel==this.Index){var M=S.bValues(a).Text;var D=S.bValues(a).LastValue;if(this.PreviuosDocument!=null){S.bValues(a).SetValue(new IDVariant((H>0?S.bValues(a).Text+G.ComboNameSep:"")+this.Document.GetName()))}else{S.SetDOBuffer(a,this.Document,this,H)}if(H>0){S.bValues(a).LastValue=new IDVariant(D)}if(M!=this.Parent.bFields(P).bValues(a).Text){this.Parent.bFields(P).bValues(a).RD3Change(RD3Glb.VAL_TEXT)}}}}this.LookupLoaded[a]=this.Document.Loaded()}}else{var h=false;var N=null;for(var B=0;B<this.LookupValues.Count();B++){var q;var N=this.LookupValues[B];h=true;var Q=0;for(var r=0;r<this.LookupParams.Count();r++){var J=this.LookupParams[r];var I=N.ParamList[Q];if(J.MstField!=null){q=J.MstField.bValues(a).Value;if(!I.equals(q)){h=false;break}}else{q=this.Parent.IMDB.Value(J.TblIdx,J.FldIdx,0);if(!I.equals(q)){h=false;break}}Q++}if(h){break}}var C=true;if(!h){N=new PLookupValueSrv();this.LookupValues.Add(N);this.RSParam.Clear();for(var r=0;r<this.LookupParams.Count();r++){var J=this.LookupParams[r];if(J.MstField!=null){var F=new IDVariant(J.MstField.bValues(a).Value);this.RSParam.Add(F);N.ParamList.Add(F)}else{var F=new IDVariant(this.Parent.IMDB.Value(J.TblIdx,J.FldIdx,0));this.RSParam.Add(F);N.ParamList.Add(F)}}var U=this.RS.getCommand();var c=this.Parent.MainFrm.HandleTableSubst(U,1);if(!c.equals(U)){this.RS.setCommand(c)}C=true;try{G.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Update lookup (row "+(a+1)+")","Update Lookup query",DTTEngine.STMT_QRY_SELECT,this.RS.getCommand());try{var E=1;for(var y=0;y<this.RSParam.Count();y++){var O=this.RSParam[y];G.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+E++,O)}}catch(T){}this.InitConnection();this.RS.execute(this.RSParam,this.DB);G.DTTObj.AddDBDataSource(this.RS,this.RS.getCommand());G.DTTObj.EndQuery(this.iGuid);if(this.RS.RecordCount()>1){G.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",91,"PQuery.UpdateLookup","Panel "+this.Parent.GetDTTCaption()+": the lookup query returned more than one records (Num Records = "+this.RS.RecordCount()+")")}if(C){if(this.LkeMS==null&&this.IsMultiSelect()&&this.Parent.Status()==Glb.PS_QBE){this.LkeMS=new IDCachedRowSet();this.LkeMS.setMetaData(this.RS.getMetaData())}if(!this.RS.EOF()){this.RS.MoveFirst()}if(this.RS.size()>0){N.Loaded=true;if(this.FieldIndex>-1){N.ValueList.Add(this.RS.Get(1));N.ValueList.Add(this.RS.Get(this.DecodeColumn>0?this.DecodeColumn:this.RS.GetNumFields()))}else{if(this.IsMultiSelect()){for(var R=0;R<this.RS.GetNumFields();R++){N.ValueList.Add(this.RS.Get(R+1))}}for(var P=0;P<this.Parent.UFields();P++){var S=this.Parent.bFields(P);if(S.IdxPanel==this.Index){if(this.IsMultiSelect()){S.GetRSIdx(this.RS)}else{N.ValueList.Add(this.RS.Get(S.GetRSIdx(this.RS)))}}}}}this.RS.Close()}}catch(T){G.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",158,"PQuery.UpdateLookup","Panel "+this.Parent.GetDTTCaption()+" - Error: "+T.message);G.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()));C=false}finally{if(!c.equals(U)){this.RS.setCommand(U)}}}if(this.LkeMS!=null&&this.IsMultiSelect()&&this.Parent.Status()==Glb.PS_QBE){if(H<=0){this.LkeMS.RemoveAllRows()}if(N.ValueList.Count()>0){this.LkeMS.AddRow(N.ValueList)}}if(C){if(this.FieldIndex>-1){if(N.ValueList.Count()==2){var S=this.Parent.bFields(this.FieldIndex);var D=S.bValues(a).LastValue;var s=IDVariant.convertObject(N.ValueList[0]);var g=IDVariant.convertObject(N.ValueList[1]);if(H>0){s=new IDVariant(S.bValues(a).Value.stringValue()+S.GetQBESep()+s.stringValue());g=new IDVariant(S.bValues(a).Text+G.ComboNameSep+g.stringValue())}S.bValues(a).SetAutoLookupValues(new IDVariant(s),new IDVariant(g));if(H>0){S.bValues(a).LastValue=new IDVariant(D)}if(S.SortFld!=-1&&this.Parent.Status()!=Glb.PS_QBE){this.Parent.bFields(S.SortFld).bValues(a).SetNewValue(new IDVariant(g));if(!this.Parent.Queries[0].IsDO){this.Parent.Queries[0].WriteUnboundValue(a,this.Parent.bFields(S.SortFld))}}if(!S.IsEnabled(a)){this.LastPreparedQueryIndex=-1}}}else{var Q=0;for(var P=0;P<this.Parent.UFields();P++){var S=this.Parent.bFields(P);if(S.IdxPanel==this.Index){if(N.ValueList.Count()>0){var M=S.bValues(a).Text;var D=S.bValues(a).LastValue;var g;if(this.IsMultiSelect()){g=IDVariant.convertObject(N.ValueList[S.GetRSIdx(null)-1])}else{g=IDVariant.convertObject(N.ValueList[Q])}if(H>0){g=new IDVariant(S.bValues(a).Text+G.ComboNameSep+g.stringValue())}S.bValues(a).SetValue(new IDVariant(g));S.bValues(a).OrgValue=new IDVariant(S.bValues(a).Value);if(H>0){S.bValues(a).LastValue=new IDVariant(D)}if(M!=S.bValues(a).Text){S.bValues(a).RD3Change(RD3Glb.VAL_TEXT)}if(S.SortFld!=-1&&this.Parent.Status()!=Glb.PS_QBE){M=this.Parent.bFields(S.SortFld).bValues(a).Text;this.Parent.bFields(S.SortFld).bValues(a).SetNewValue(new IDVariant(g));if(!this.Parent.Queries[0].IsDO){this.Parent.Queries[0].WriteUnboundValue(a,this.Parent.bFields(S.SortFld))}if(M!=this.Parent.bFields(S.SortFld).bValues(a).Text){this.Parent.bFields(S.SortFld).bValues(a).RD3Change(RD3Glb.VAL_TEXT)}}Q++}else{var M=S.bValues(a).Text;S.bValues(a).SetValue(new IDVariant());S.bValues(a).OrgValue=new IDVariant();if(M!=S.bValues(a).Text){S.bValues(a).RD3Change(RD3Glb.VAL_TEXT)}if(S.SortFld!=-1&&this.Parent.Status()!=Glb.PS_QBE){M=this.Parent.bFields(S.SortFld).bValues(a).Text;this.Parent.bFields(S.SortFld).bValues(a).SetNewValue(new IDVariant());if(!this.Parent.Queries[0].IsDO){this.Parent.Queries[0].WriteUnboundValue(a,this.Parent.bFields(S.SortFld))}if(M!=this.Parent.bFields(S.SortFld).bValues(a).Text){this.Parent.bFields(S.SortFld).bValues(a).RD3Change(RD3Glb.VAL_TEXT)}}}}}}}this.LookupLoaded[a]=N.Loaded}};PQuerySrv.prototype.PrepareLookup=function(k){if(this.IsDO){this.QueryOK=true;return}this.LastPreparedQueryIndex=k;this.LookupParams.Clear();var j=-1;var c=this.Text[k];var g=true;while(j>=0||g){g=false;j=c.indexOf("~~",j+1);var h=c.indexOf("~~",j+1);if(j>=0&&h>=0){var l=c.substr(j+2,h-(j+2));c=c.substr(0,j)+"?"+c.substr(h+2);var a=l.lastIndexOf(".");var d=new PLookupParamSrv();this.LookupParams.Add(d);if(a>=0){d.TblIdx=this.Parent.IMDB.TblByCode(l.substr(0,a),this.Parent.MainFrm);if(d.TblIdx>-1){d.FldIdx=this.Parent.IMDB.FldByCode(d.TblIdx,l.substr(a+1))}if(d.FldIdx>-1){d.DataType=this.Parent.IMDB.GetFldDataType(d.TblIdx,d.FldIdx);d.MaxLength=this.Parent.IMDB.GetFldMaxLength(d.TblIdx,d.FldIdx);d.vScale=this.Parent.IMDB.GetFldScale(d.TblIdx,d.FldIdx)}}else{for(var b=0;b<this.Parent.UMaster();b++){if(this.Parent.bMaster(b).Code.equals(l)){d.MstField=this.Parent.bMaster(b);break}}}}}try{this.RS.setCommand(this.DB.ApplySubstitutions(c))}catch(f){}this.QueryOK=true};PQuerySrv.prototype.DeleteRecord=function(o){var l=true;var m=null;if(this.ActualPosition+this.Parent.AttR>this.RecordCount()){return false}if(this.IsDO){var j=this.Parent.GetDocument();m=j;var a=new IDVariant();var c=j.GetLock(9999,"",a);if(c){j.set_Deleted(true);if(this.IsMasterDO){try{l=j.Validate(0,9999,true);if(l){l=j.SaveToDB()}}catch(h){l=false}if(!l){this.Parent.DumpDocErrors(j,this.Parent.AttR,false,null);this.Parent.FireDBError(new IDVariant(true),new IDVariant(true),null,Glb.PANOP_DELETE,j.GetFailedDoc())}}else{if(this.IDColl==null){this.Parent.SetDocument(null)}}if(!l){j.set_Deleted(false)}else{this.RefreshAllLookups();j.ReleaseLock()}if(this.IDColl!=null){if(l&&this.DocTempl!=null){this.IDColl.PurgeDeleted()}this.Parent.UpdateDynRows(this.RecordCount())}}else{j.ClearErrors();j.AddDocError(a.stringValue());this.Parent.DumpDocErrors(j,this.Parent.AttR,false,null);l=false}}else{if(this.IMDBDataSource>-1){this.IMDBAbsolutePosition(this.ActualPosition+this.Parent.AttR);m=this.Parent.IMDB.Table(this.IMDBDataSource).AttPos[Glb.IMDB_CURSOR].RowBookMark;this.Parent.IMDB.SynchronizeRows(this.IMDBDataSource,Glb.IMDB_CURSOR,Glb.IMDB_CURSOR);this.Parent.IMDB.TblDelete(this.IMDBPrimaryTable,Glb.IMDB_CURSOR)}else{try{this.GotoAbsolute(this.ActualPosition+this.Parent.AttR);m=this.RS.BookMark();this.RS.setTableName(this.DB.ApplySubstitutions(this.MstTableName));this.RS.deleteRow();this.InitConnection();this.RS.acceptChanges(this.DB);if(this.LookupRows!=null){var n=this.ActualPosition+this.Parent.AttR-1;var f=this.LookupRows;this.LookupRows=new Array(f.length-1);Array.copy(f,0,this.LookupRows,0,n);Array.copy(f,n+1,this.LookupRows,n,f.length-n-1);for(var g=0;g<this.LookupRows.length;g++){if(this.LookupRows[g]>f[n]){this.LookupRows[g]--}}}}catch(r){l=false;this.Parent.FireDBError(new IDVariant(true),new IDVariant(false),r,Glb.PANOP_DELETE,null)}if(!l){try{this.RS.refreshRow()}catch(h){}}else{if(this.IMDBDataSource==-1){this.RefreshAllLookups()}this.Parent.UpdateDynRows(this.RecordCount())}}}if(l){for(var q=0;q<this.BlobCache.Count();q++){var k=this.BlobCache[q];if(k.BookMark==m){this.BlobCache.RemoveAt(q--)}else{if(!this.IsDO&&this.IMDBDataSource==-1){if(k.BookMark>m){k.BookMark=k.BookMark-1}}}}}return l};PQuerySrv.prototype.RefreshAllLookups=function(){if(this.Parent.MainFrm==null){return}var a="";if(this.IDColl!=null&&this.IDColl.Count()>0){var b=this.IDColl.AbsolutePosition();this.IDColl.MoveFirst();var c=this.IDColl.GetAt();this.IDColl.set_AbsolutePosition(b);if(c!=null&&c.GetMD()!=null){a=c.GetMD().DBCode}}else{if(this.Document!=null&&this.Document.GetMD()!=null){a=this.Document.GetMD().DBCode}}this.Parent.MainFrm.RefreshAllLookups(this.MstTableName,a)};PQuerySrv.prototype.RefreshQuery=function(l){if(this.IMDBDataSource>-1){return true}if(this.IsDO){if(this.DocTempl!=null){var c=this.ActualPosition;this.FindData(l,false);this.ScrollTo(c)}if(this.IDColl!=null){this.Parent.UpdateDynRows(this.RecordCount())}return true}var b=this.RS.getCommand();var f=this.Parent.MainFrm.HandleTableSubst(b,0);if(!f.equals(b)){this.RS.setCommand(f)}var j=true;try{this.RS.Close();this.InitConnection();if(this.LastSQL.length>0&&this.RS.getMaxRows()!=this.MaxRows){this.DB.MaxRows=this.MaxRows;this.RS.setCommand(this.DB.ApplySubstitutions(this.LastSQL));this.RS.setMaxRows(this.MaxRows)}l.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Refresh query","Panel find data",DTTEngine.STMT_QRY_SELECT,this.RS.getCommand());try{var a=1;for(var h=0;h<this.RSParam.Count();h++){var k=this.RSParam[h];l.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+a++,k)}}catch(g){}this.RS.execute(this.RSParam,this.DB);if(this.LookupRows!=null){this.LookupRows=null;this.CursorPos=1}if(!this.RSEOF()){this.StartSort();this.GotoFirst()}l.DTTObj.AddDBDataSource(this.RS,this.RS.getCommand());l.DTTObj.EndQuery(this.iGuid);for(var d=1;d<this.Parent.UQueries();d++){if(this.Parent.bQueries(d).FieldIndex==-1){this.Parent.bQueries(d).ClearLookupBuffer()}else{if((this.Parent.bFields(this.Parent.bQueries(d).FieldIndex).Flags&Glb.FLD_AUTOLOOKUP)!=0){this.Parent.bQueries(d).ClearLookupBuffer()}}}this.BlobCache.Clear();this.ClearUnboundData()}catch(g){j=false;if(this.RS.getCommand()==null){l.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,80,"PQuery.RefreshQuery","Panel "+this.Parent.GetDTTCaption()+": Recordset not initialized. Use FindData first.")}}finally{if(!f.equals(b)){this.RS.setCommand(b)}}this.Parent.UpdateDynRows(this.RecordCount());return j};PQuerySrv.prototype.ClearLookupBuffer=function(){this.LookupValues.Clear();this.LastPreparedQueryIndex=-1};PQuerySrv.prototype.UpdateRecords=function(E){var y=new IDVariant();var M;var u=null;var N=false;var x=0;var v=0;var B=false;var G=new IDVariant();E.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,58,"IDPanel.FireBeforeCommit","Panel "+this.Parent.GetDTTCaption()+": Fire BeforeCommit Event");this.Parent.Parent.BeforeCommit(this.Parent,y);if(y.isTrue()){E.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",92,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": update records canceled");return false}var h=this.ActualPosition;var L=this.RecordCount();if(this.IDColl!=null){this.IDColl.set_UIMode(true)}var A=true;for(var K=0;K<this.Parent.NumRows;K++){var o=false;try{if(h+K<=L){if(K==0){if(this.IsDO){if(this.IDColl!=null){this.IDColl.set_AbsolutePosition(this.ActualPosition+K)}}else{if(this.IMDBDataSource>-1){this.IMDBAbsolutePosition(this.ActualPosition+K)}else{this.GotoAbsolute(this.ActualPosition+K)}}}else{if(this.IsDO){if(this.IDColl!=null){this.IDColl.MoveNext()}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR)}else{this.GotoNext()}}}}var H=false;var c=true;for(var J=0;J<this.Parent.UMaster();J++){H=H||this.Parent.bMaster(J).bValues(K).Modified;c=c&&this.Parent.bMaster(J).bValues(K).Text.length==0}if(this.IsDO&&(this.Parent.Flags&Glb.PAN_NEWINSMODE)!=0&&c&&h+K>L){c=false;this.Parent.bMaster(0).bValues(K).Modified=false}if(H&&(!c||h+K<=L)){this.Parent.ValidatingRow=K;this.Parent.bQueries(0).UpdateIMDB(K,true,false,false);y=new IDVariant();if(h+K>L){this.Parent.FireBeforeInsert(y);if(y.isFalse()){if(this.IsDO){if(this.IDColl!=null){try{var r=this.IDColl.Count();this.Parent.FireCreateDocument(this.IDColl,this.MstTableName);if(this.IDColl.Count()==r){E.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",98,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": Can't add new children");o=true}else{this.LastRC++}}catch(P){E.DTTObj.AddException("","PQuery.UpdateRecords","Execption while creating document",P)}}}else{if(this.IMDBDataSource==-1){this.RS.moveToInsertRow()}else{this.Parent.IMDB.TblAddNew(this.IMDBPrimaryTable,Glb.IMDB_CURSOR);this.Parent.IMDB.TblAddNew(this.IMDBDataSource,Glb.IMDB_CURSOR);this.Parent.IMDB.TblLinkRow(this.IMDBDataSource,Glb.IMDB_CURSOR,this.IMDBPrimaryTable,Glb.IMDB_CURSOR);for(var I=0;I<this.Parent.UMaster();I++){if(this.Parent.bMaster(I).PriIdx>-1){this.Parent.IMDB.TblLinkField(this.IMDBDataSource,this.Parent.bMaster(I).GetIMDBIdx(),Glb.IMDB_CURSOR,this.IMDBPrimaryTable,this.Parent.bMaster(I).PriIdx,Glb.IMDB_CURSOR)}}}}}else{E.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",93,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": insert canceled")}M=true}else{this.Parent.FireBeforeUpdate(y);if(y.isTrue()){E.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",94,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": update canceled")}M=false}if(y.isFalse()){if(this.Parent.MstTblIndex>-1&&this.Parent.IMDB.TblModified(this.Parent.MstTblIndex,Glb.GlbRefModIdx)){for(var J=0;J<this.Parent.UMaster();J++){if(this.Parent.bMaster(J).IdxPanel==0){var Q=this.Parent.bMaster(J).GetIMDBIdx();if(Q>-1){if(this.Parent.bMaster(J).bValues(K).Value.CompareTo(this.Parent.IMDB.Value(this.Parent.MstTblIndex,Q,0))!=0){E.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",95,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": field value changed from "+this.Parent.bMaster(J).bValues(K).Value+" to "+this.Parent.IMDB.Value(this.Parent.MstTblIndex,Q,0))}this.Parent.bMaster(J).bValues(K).SetNewValue(this.Parent.IMDB.Value(this.Parent.MstTblIndex,Q,0))}}}}if(this.AIFieldIndex>-1){u=this.Parent.bFields(this.AIFieldIndex)}if(u!=null&&this.AIQuery.length>0){if(IDL.IsNull(u.bValues(K).Value)){try{if(!this.DB.IsOpen()){E.OpenConnection(this.DB)}var D=this.DB.OpenRSR(this.AIQuery);if(!D.EOF()){u.bValues(K).SetNewValue(D.Get(1))}D.Close()}catch(F){E.DTTObj.AddException("","PQuery.UpdateRecords","Execption while updating autoincrement field",F)}if(IDL.IsNull(u.bValues(K).Value)){u.bValues(K).SetNewValue(new IDVariant(1));E.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",96,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": empty autoincrement field substituted with 1")}}}if(this.IsDO){if(o){this.Document=null;B=false}else{if(this.IDColl!=null){this.Document=this.IDColl.GetAt()}if(this.Document!=null){B=this.Document.GetLock(9999,"",G);if(B){this.Document.BeginTrans()}}}}var q=false;for(var J=0;J<this.Parent.UMaster();J++){if(this.Parent.bMaster(J).bValues(K).Modified){if(this.Parent.bMaster(J).DataType==Glb.DT_DOC_OLE&&this.IMDBDataSource==-1){if(this.Parent.bMaster(J).bValues(K).Text.length>0){}else{this.RS.Set(this.Parent.bMaster(J).GetRSIdx(this.RS),new IDVariant())}}else{if(this.IsDO){if(this.Document!=null&&B){var g=this.Parent.bMaster(J).GetDOIdx(this.Document);if(g<1){if(this.Parent.bMaster(J).IsNamed){this.Document.SetNamedPropertyValue(this.Parent.bMaster(J).Code,this.Parent.bMaster(J).bValues(K).Value)}}else{this.Document.SetPropByIndex(g,this.Parent.bMaster(J).bValues(K).Value)}}}else{if(this.IMDBDataSource==-1){var O=this.Parent.bMaster(J);var l;if(M){l=new IDVariant()}else{l=this.RS.Get(O.GetRSIdx(this.RS))}var n=Glb.GetTI(l,O.bValues(K).Value,O.Transformation,O.TrFormat,O.TrOffset,O.MaxLength);if(!this.Parent.bMaster(J).Unbound){this.RS.Set(this.Parent.bMaster(J).GetRSIdx(this.RS),n)}}else{this.Parent.IMDB.set_Value(this.IMDBDataSource,this.Parent.bMaster(J).GetIMDBIdx(),Glb.IMDB_CURSOR,this.Parent.bMaster(J).bValues(K).Value)}}}if(M&&(h+K>this.RecordCount()+1)&&!this.IsDO){q=true}}}if(q){for(var b=0;b<this.Parent.Fields.length;b++){var O=this.Parent.Fields[b];if(K<O.Values.length){O.Values[K].RD3Change(RD3Glb.VAL_TEXT)}var a=this.RecordCount()+1-h;if(a<O.Values.length&&a>=0){O.Values[a].RD3Change(RD3Glb.VAL_TEXT)}}}if(this.IMDBDataSource==-1&&!this.IsDO){this.RS.setTableName(this.DB.ApplySubstitutions(this.MstTableName));if(M){this.RS.insertRow()}else{this.RS.updateRow()}this.RS.moveToCurrentRow();this.InitConnection();this.RS.acceptChanges(this.DB);if(M){N=true;this.RS.MoveLast()}if(u!=null&&M){var m=this.DBType;if(m==Glb.DBT_SQLSRV2K||m==Glb.DBT_SQLSRV05){m=Glb.DBT_SQLSRV7}var S=new IDVariant(this.RS.IntDS.insertId);if(S==undefined){S=Glb.GetLIV(this.DB,m,this.DB.ApplySubstitutions(this.MstTableName),u.Code)}if(S.intValue()>0){this.RS.Set(u.GetRSIdx(this.RS),S);this.RS.setOriginalValue(u.GetRSIdx(this.RS))}}}if(this.IMDBDataSource==-1&&!this.IsDO){try{for(var J=0;J<this.Parent.UFields();J++){var O=this.Parent.bFields(J);if(O.IdxPanel==0&&O.DataType!=Glb.DT_DOC_OLE){var Q=O.GetIMDBIdx();var t=O.GetRSIdx(this.RS);if(Q>-1&&t>-1){var d=Glb.GetTD(this.RS.Get(t),O.Transformation,O.TrFormat,O.TrOffset,O.MaxLength);this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,Q,0,d);O.bValues(K).SetValue(d);O.bValues(K).SetOriginal();if(O.Index==this.AIFieldIndex){O.bValues(K).RD3Change(RD3Glb.VAL_TEXT)}}}}}catch(P){E.DTTObj.AddException("","PQuery.UpdateRecords","Execption while updating IMDB field from RS one",P);if(this.Parent.MstTblIndex>-1){this.Parent.IMDB.TblResetModified(this.Parent.MstTblIndex,-1)}}}if(M){this.Parent.FireAfterInsert()}else{this.Parent.FireAfterUpdate()}x++;if(this.IsDO){if(this.Document!=null){if(B){this.Document.EndTrans();if(this.IDColl!=null){if(this.CollUpdCount!=this.IDColl.UpdateCount()){this.LastRC=this.IDColl.Count();this.CollUpdCount=this.IDColl.UpdateCount()}}this.Document.Validate(1,0,true);this.Parent.DumpDocErrors(this.Document,K,false,null)}else{this.Document.ClearErrors();this.Document.AddDocError(G.stringValue())}if(this.Document.Deleted()){this.Parent.ClearRD3Cache(this.ActualPosition+K)}}else{if(o){if((this.Parent.Flags&Glb.PAN_NEWINSMODE)!=0&&this.IDColl!=null&&this.IDColl.Parent()!=null){var F=new IDVariant();if(!this.IDColl.Parent().GetLock(9999,"",F)){this.Parent.Parent.SetMessage(this.Parent,AMessageSrv.MSG_STOP,F.stringValue(),"","VAL",(this.Parent.NumRows>1)?K+1:0,false)}}}}}}for(var J=0;J<this.Parent.UMaster();J++){this.Parent.bMaster(J).bValues(K).Modified=false}}}catch(F){E.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",97,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": DB error while updating records (Error = "+F.message+")");v++;A=false;y=new IDVariant(true);this.Parent.FireDBError(y,new IDVariant(false),F,Glb.PANOP_UPDATE,null);if(y.isTrue()){E.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",98,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": update operation interrupted after a DB error");break}}}if(this.IDColl!=null){this.IDColl.set_UIMode(false)}this.Parent.ValidatingRow=-1;if(!A){if(this.IMDBDataSource==-1&&!this.IsDO){try{this.RS.moveToCurrentRow();this.RS.restoreOriginal()}catch(P){}}}else{}try{if(N){if(this.LookupRows!=null&&this.LookupRows.length<this.RecordCount()){var C=this.LookupRows.length;Array.resize(this.LookupRows,this.RecordCount());for(var R=C;R<this.LookupRows.length;R++){this.LookupRows[R]=R+1}}}if(this.RS!=null&&this.IMDBDataSource==-1&&!this.IsDO){this.RS.MoveLast();if(this.ActualPosition<=this.RecordCount()){this.RS.MoveFirst();this.GotoAbsolute(this.ActualPosition)}else{this.GotoLast()}}}catch(P){}if(!this.IsDO||!this.IsMasterDO||!this.Parent.FinalUpdate){E.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,59,"IDPanel.FireAfterCommit","Panel "+this.Parent.GetDTTCaption()+": Fire AfterCommit Event");this.Parent.Parent.AfterCommit(this.Parent,new IDVariant(x),new IDVariant(v))}this.UpdateIMDB(this.Parent.AttR,true,false,false);if(this.IMDBDataSource==-1&&x>0){this.RefreshAllLookups()}this.Parent.UpdateDynRows(this.RecordCount());return A};PQuerySrv.prototype.UpdateIMDB=function(c,b,a,d){var f=b;if(this.Parent.MstTblIndex==-1){if(this.IsDO&&a){this.Parent.FireOnChangeRow()}return false}if(this.Parent.IMDB==null){return false}for(var g=0;g<this.Parent.IMDB.TblNumField(this.Parent.MstTblIndex);g++){this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,g,0,new IDVariant())}if(this.IsDO){if(this.Document==null){b=false}if(this.IDColl==null){b=false}if(this.IDColl!=null){if(this.IDColl.IsEof()){b=false}}}else{if(this.IMDBDataSource==-1&&this.RS.size()==0){b=false}else{if(this.ActualPosition+c>this.RecordCount()){b=false}}}if(b&&d){if(this.IsDO){if(this.IDColl!=null){this.IDColl.set_AbsolutePosition(this.ActualPosition+c)}}else{if(this.IMDBDataSource>-1){if(!this.IMDBAbsolutePosition(this.ActualPosition+c)){b=false}}else{b=false;try{this.GotoAbsolute(this.ActualPosition+c);b=true}catch(h){}}}}if(f){if(this.IDColl!=null){this.Document=this.IDColl.GetAt()}if(b){for(var g=0;g<this.Parent.UMaster();g++){var j=this.Parent.bMaster(g);var l=j.GetIMDBIdx();if(l>-1){if(this.IsDO){if(this.Document!=null&j.GetDOIdx(this.Document)>0){this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,l,0,this.Document.GetPropByIndex(j.GetDOIdx(this.Document)))}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,l,0,this.Parent.IMDB.Value(this.IMDBDataSource,j.GetRSIMDBIdx(this.IMDBDataSource),Glb.IMDB_CURSOR))}else{try{var k=this.RS.Get(j.GetRSIdx(this.RS));k=Glb.GetTD(k,j.Transformation,j.TrFormat,j.TrOffset,j.MaxLength);this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,l,0,k)}catch(h){}}}}}}for(var g=0;g<this.Parent.UMaster();g++){var l=this.Parent.bMaster(g).GetIMDBIdx();if(l>-1&&c>=0&&c<this.Parent.NumRows){this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,l,0,this.Parent.bMaster(g).bValues(c).Value)}}}if(a){this.Parent.FireOnChangeRow()}return b};PQuerySrv.prototype.UpdateParam=function(d){if(this.IMDBDataSource>-1){return this.Parent.IMDB.TblModified(this.IMDBDataSource,1)||d}var g=false;var b=false;if(!this.QueryOK){this.PrepareParam();g=this.QueryParameters.Count()>0}var c=0;for(var e=0;e<this.QueryParameters.Count();e++){var a=this.QueryParameters[e];if(a.TblIdx>-1&&a.FldIdx>-1){if(this.Parent.IMDB.TblModified(a.TblIdx,Glb.GlbRefModIdx)||d){b=true;if(!this.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0).equals(a.AttValue)){a.AttValue=this.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0);g=true}}}c=c+1}if(g){this.RSParam.Clear();this.NumQBEParameters=0;for(var f=0;f<this.QueryParameters.Count();f++){var a=this.QueryParameters[f];this.RSParam.Add(a.AttValue)}}return g&&b};PQuerySrv.prototype.PrepareParam=function(f,e){if(e==undefined){e=null}var d;for(var c=Glb.SQL_SELECT;c<=Glb.SQL_WHERE;c++){if(this.Text[c]==null){continue}if(!f){d=this.Text[c]}else{d=e.stringValue()}var j=-1;var h=-1;var g=true;while(g||(j>-1&&h>-1)){g=false;j=d.indexOf("~~",j+1);h=d.indexOf("~~",j+1);if(j>=0&&h>=0){var k=d.substr(j+2,h-(j+2));if(!f){d=d.substr(0,j)+"?"+d.substr(h+2)}var a=new PQueryParamSrv();if(!f){this.QueryParameters.Add(a)}var b=k.lastIndexOf(".");if(b>=0){a.TblIdx=this.Parent.IMDB.TblByCode(k.substr(0,b),this.Parent.MainFrm);if(a.TblIdx>-1){a.FldIdx=this.Parent.IMDB.FldByCode(a.TblIdx,k.substr(b+1))}}if(a.FldIdx>-1){a.AttValue=this.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0);a.DataType=this.Parent.IMDB.GetFldDataType(a.TblIdx,a.FldIdx);a.MaxLength=this.Parent.IMDB.GetFldMaxLength(a.TblIdx,a.FldIdx);a.vScale=this.Parent.IMDB.GetFldScale(a.TblIdx,a.FldIdx);if(f){d=d.substr(0,j)+Glb.ToSql(a.AttValue,this.DBType,this.DB)+d.substr(h+2)}}}}if(!f){this.Text[c]=d}else{e.set(new IDVariant(d));break}}this.QueryOK=true};PQuerySrv.prototype.GetBlobFromCache=function(d,h,j){var e=null;if(this.IsDO){if(this.IDColl!=null){e=this.IDColl.GetAt()}else{if(this.Document!=null){e=this.Document}}}else{if(this.IMDBDataSource>-1){e=this.Parent.IMDB.GetRowBookMark(this.IMDBDataSource,Glb.IMDB_CURSOR)}else{e=this.RS.BookMark()}}var c=null;if(this.IsDO){if(this.RSIndex<1){if(this.Parent.Fields[d].IsNamed){c=e.GetNamedPropertyValue(this.Parent.Fields[d].Code)}else{c=new IDVariant()}}else{c=e.GetPropByIndex(h)}}else{if(this.IMDBDataSource>-1){c=this.Parent.IMDB.Value(this.IMDBDataSource,h,Glb.IMDB_CURSOR)}else{c=this.RS.Get(h)}}var a;for(var g=0;g<this.BlobCache.Count();g++){a=this.BlobCache[g];if(a.FldIndex==d&&a.BookMark==e){if(c.Type==IDVariant.NULL){a.IsValid=0;a.MimeType="";a.Size=0;a.ToDownload=false}return a.BlobNum}}a=new PBlobCacheSrv();this.BlobCache.Add(a);a.BlobNum=Math.floor(Math.random()*1000000000)+1;a.BookMark=e;a.FldIndex=d;a.RSIndex=h;a.Size=-1;var f=null;if(c.Type!=IDVariant.NULL){f=c.Value;a.Size=f.length}if(a.Size==-1){a.Size=0}a.ToDownload=(a.Size<j)&&!this.Parent.Parent.MainFrm.ParamsObj().NativeBlob;if(!this.Parent.Parent.MainFrm.ParamsObj().NativeBlob){this.GetMimeData(a,f)}return a.BlobNum};PQuerySrv.prototype.GetBlobData=function(d,c){for(var e=0;e<this.BlobCache.Count();e++){var a=this.BlobCache[e];if((a.FldIndex==d||d==-1)&&a.BlobNum==c){return a}}return null};PQuerySrv.prototype.DownloadBlob=function(h,n,d){var m=this.GetBlobData(-1,h);if(m!=null&&m.IsValid!=0){try{var f;if(this.IsDO){if(m.RSIndex<1){if(this.Parent.Fields[m.FldIndex].IsNamed){f=m.BookMark.GetNamedPropertyValue(this.Parent.Fields[m.FldIndex].Code)}else{f=new IDVariant()}}else{f=m.BookMark.GetPropByIndex(m.RSIndex)}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblGoToAbsoluteRow(this.IMDBDataSource,Glb.IMDB_CURSOR,m.BookMark);f=this.Parent.IMDB.Value(this.IMDBDataSource,m.RSIndex,Glb.IMDB_CURSOR)}else{this.RS.absolute(m.BookMark);f=this.RS.Get(m.RSIndex)}}var u=f.Value;if(m.IsValid==-1){this.GetMimeData(m,u)}if(m.IsValid==1){if(!this.Parent.MainFrm.ParamsObj().NativeBlob){u=u.substring(16)}var r=new IDVariant();var q=new IDVariant(1);var g=new IDVariant(m.FileName);var c=new IDVariant(m.Extension);var o=new IDVariant(m.MimeType);this.Parent.Parent.OnDownloadBlob(this.Parent,r,new IDVariant(m.FldIndex),new IDVariant(m.Size),c,q,g,o);if(!c.stringValue().equals(m.Extension)&&o.stringValue()==m.MimeType){o=new IDVariant(this.Parent.MainFrm.GetMimeType(c.stringValue()))}m.FileName=g.stringValue();m.Extension=c.stringValue();m.MimeType=o.stringValue();if(r.isFalse()){if(n!=null){if(m.Extension.length>0&&!m.isText()){if(m.FileName.length==0){m.FileName="documento."+m.Extension}else{if(!m.FileName.toUpperCase().endsWith("."+m.Extension.toUpperCase())){m.FileName+="."+m.Extension}}}var a=m.isText()?"":m.FileName;n.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",157,"PQuery.DownloadBlob","Panel "+this.Parent.GetDTTCaption()+": about to download blob");n.DTTObj.AddParameter("","","File Name",new IDVariant(a));n.DTTObj.AddParameter("","","Mime Type",new IDVariant(o));n.DTTObj.AddParameter("","","Size",new IDVariant(m.Size));n.DTTObj.AddParameter("","","Inline",q)}if(d){m.FileName=u}else{if(n.ShellObject.IsInsideShell()){m.FileName=Glb.SaveBlob(n,f).stringValue();if(m.FileName.length>0){m.FileName=m.FileName.substring(n.RealPath.length+1)}}else{var t=new Uint8Array(u.length);for(var j=0;j<u.length;j++){t[j]=u.charCodeAt(j)}var k=new BlobBuilder();k.append(t.buffer);var f=k.getBlob(o);m.FileName=URL.createObjectURL(f)}}return true}else{if(n!=null){n.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",99,"PQuery.DownloadBlob","Panel "+this.Parent.GetDTTCaption()+": blob download canceled")}}}}catch(l){n.DTTObj.AddException("","PQuery.DownloadBlob","Execption while handling blob download",l)}}return false};PQuerySrv.prototype.GetMimeData=function(a,d){if(this.Parent.MainFrm.ParamsObj().NativeBlob){a.Extension="bin";a.IsValid=1;return}a.IsValid=0;if(d==null){return}if(d.length-d.Position<16){return}if(d.substr(0,4)=="BLOB"){var e=Math.min(d.indexOf(String.fromCharCode(0)),15);var c=d.substring(4,e);a.IsValid=1;a.Extension=c;a.MimeType=this.Parent.MainFrm.GetMimeType(a.Extension)}else{this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"PQuery.GetMimeData","Panel "+this.Parent.GetDTTCaption()+": unknown Blob type (header not found)")}};PQuerySrv.prototype.WriteTextBlob=function(a,b){this.DownloadBlob(a,b,true)};PQuerySrv.prototype.SaveBlobFile=function(c,d){var a=this.GetBlobData(-1,c);if(a!=null&&a.IsValid!=0){try{var f;if(this.IsDO){if(a.RSIndex<1){if(this.Parent.Fields[a.FldIndex].IsNamed){f=a.BookMark.GetNamedPropertyValue(this.Parent.Fields[a.FldIndex].Code)}else{f=new IDVariant()}}else{f=a.BookMark.GetPropByIndex(a.RSIndex)}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblGoToAbsoluteRow(this.IMDBDataSource,Glb.IMDB_CURSOR,a.BookMark);f=this.Parent.IMDB.Value(this.IMDBDataSource,a.RSIndex,Glb.IMDB_CURSOR)}else{this.RS.absolute(a.BookMark);f=this.RS.Get(a.RSIndex)}}a.FileName="";a.FileName=Glb.SaveBlob(d,f).stringValue();d.AddTempFile(a.FileName);if(d.ShellObject.IsInsideShell()&&a.FileName.length>0){a.FileName=Glb.ToRelativeUrl(this.Parent.MainFrm,a.FileName)}}catch(g){d.DTTObj.AddException("","PQuery.SaveBlobFile","Execption while saving blob to file",g)}}};PQuerySrv.prototype.DeleteBlob=function(e,a){var d=new IDVariant(a.Extension);var c=new IDVariant(-1);var f=new IDVariant();e.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.DeleteBlob","Panel "+this.Parent.GetDTTCaption()+": Fire BeforeBlobUpdate Event");this.Parent.Parent.BeforeBlobUpdate(this.Parent,f,new IDVariant(a.FldIndex),c,d,new IDVariant(""));if(f.isTrue()){e.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",101,"PQuery.DeleteBlob","Panel "+this.Parent.GetDTTCaption()+": blob deletion canceled");return}try{if(this.IsDO){if(a.RSIndex<1){if(this.Parent.Fields[a.FldIndex].IsNamed){a.BookMark.SetNamedPropertyValue(this.Parent.Fields[a.FldIndex].Code,new IDVariant())}}else{a.BookMark.SetPropByIndex(a.RSIndex,new IDVariant())}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblGoToAbsoluteRow(this.IMDBDataSource,Glb.IMDB_CURSOR,a.BookMark);this.Parent.IMDB.set_Value(this.IMDBDataSource,a.RSIndex,Glb.IMDB_CURSOR,new IDVariant())}else{this.InitConnection();this.RS.absolute(a.BookMark);this.RS.setTableName(this.DB.ApplySubstitutions(this.MstTableName));this.RS.updateNull(a.RSIndex);this.RS.updateRow();this.RS.acceptChanges(this.DB)}}e.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,53,"PQuery.DeleteBlob","Panel "+this.Parent.GetDTTCaption()+": Fire AfterBlobUpdate Event");this.Parent.Parent.AfterBlobUpdate(this.Parent,new IDVariant(a.FldIndex),c,d);a.IsValid=0;a.MimeType="";a.Size=0;a.ToDownload=false}catch(g){e.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",90,"PQuery.DeleteBlob","Panel "+this.Parent.GetDTTCaption()+": Delete Blob error (Err="+g.message+")")}};PQuerySrv.prototype.GetValueSource=function(n,N,M,y,o,K,t){var b=false;if(o){if(!this.QueryOK||this.LastPreparedQueryIndex!=1){this.PrepareLookup(1);b=true}}else{if(!this.QueryOK||this.LastPreparedQueryIndex!=0){this.PrepareLookup(0);b=true}}if(y&&M.stringValue().length==0){y=false}if(this.IsDO){if(this.Document!=null){if(K){b=true}else{this.Document.Clear();for(var H=0;H<this.LookupParams.Count();H++){var A=this.LookupParams[H];if(o&&A.AutoLookup){continue}if(A.TblIdx==this.Parent.MstTblIndex){var x=this.Parent.IMDB.FldCode(A.TblIdx,A.FldIdx);A.TblIdx=-1;for(var l=0;l<this.Parent.UMaster();l++){if(this.Parent.bMaster(l).Code.equals(x)){A.MstField=this.Parent.bMaster(l);break}}}if(A.PropIdx==-1&&A.PropName.length>0){A.PropIdx=this.Document.GetPropIndex(A.PropName);if(A.PropIdx<1){A.PropIdx=this.Document.GetPropertyIndex(A.PropName)}A.PropName=""}var q;if(A.MstField!=null){q=A.MstField.bValues(N).Value}else{if(A.Value!=null){q=A.Value}else{q=this.Parent.IMDB.Value(A.TblIdx,A.FldIdx,0)}}if(A.PropIdx>0){this.Document.SetPropByIndex(A.PropIdx,q)}}try{this.Document.LoadValueSource(this.RS,this.VisibleColumns)}catch(J){}}}}else{if(this.LookupParams.Count()!=this.RSParam.Count()){b=true}if(!b){for(var B=0;B<this.LookupParams.Count();B++){var A=this.LookupParams[B];var E=this.RSParam[B];if(A.MstField==null){b|=!E.equals(this.Parent.IMDB.Value(A.TblIdx,A.FldIdx,0))}else{if(this.Parent.Status()==Glb.PS_QBE&&(A.MstField.Flags&Glb.FLD_AUTOLOOKUP)==0){b|=!E.equals(new IDVariant(A.MstField.bValues(N).Text))}else{b|=!E.equals(A.MstField.bValues(N).Value)}}}}if(b){this.RSParam.Clear();var a=this.RS.getCommand();var k=this.Parent.MainFrm.HandleTableSubst(a,2);if(!k.equals(a)){this.RS.setCommand(k)}try{for(var r=0;r<this.LookupParams.Count();r++){var A=this.LookupParams[r];if(A.MstField==null){this.RSParam.Add(this.Parent.IMDB.Value(A.TblIdx,A.FldIdx,0))}else{if(this.Parent.Status()==Glb.PS_QBE&&(A.MstField.Flags&Glb.FLD_AUTOLOOKUP)==0){this.RSParam.Add(new IDVariant(A.MstField.bValues(N).Text))}else{this.RSParam.Add(A.MstField.bValues(N).Value)}}}n.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Get value source","Value Source Query",DTTEngine.STMT_QRY_SELECT,this.RS.getCommand());var m=1;for(var f=0;f<this.RSParam.Count();f++){var d=this.RSParam[f];n.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+m++,d)}this.InitConnection();this.RS.execute(this.RSParam,this.DB);if(!this.RS.EOF()){this.RS.MoveNext()}n.DTTObj.AddDBDataSource(this.RS,this.RS.getCommand());n.DTTObj.EndQuery(this.iGuid)}catch(x){n.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",159,"PQuery.GetValueSource","Panel "+this.Parent.GetDTTCaption()+" - Error: "+x.message);n.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()))}finally{if(!k.equals(a)){this.RS.setCommand(a)}}}}if(!K&&this.RS.IsOpen()){try{var g=this.DecodeColumn>0?this.DecodeColumn:this.RS.GetNumFields();var j=false;if(t!=null&&this.HeaderColumns!=null&&this.VisibleColumns!=null){var c="";for(var F=0;F<this.VisibleColumns.Count();F++){var C=this.VisibleColumns[F];if(this.RS.findColumn(C)!=-1){c+=(c.length>0?"|":"")+this.HeaderColumns[C]}else{n.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",159,"PQuery.GetValueSource","Panel "+this.Parent.GetDTTCaption()+" - Column "+C+" is not in the query's select list");n.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()))}}t.SetAttribute("hdr",c);var L=this.RS.GetName(g);for(var F=0;F<this.VisibleColumns.Count();F++){if(String.compare(this.VisibleColumns[F],L,true)==0){t.SetAttribute("dcc",(F+1).toString());break}}}if(this.Parent.bFields(this.FieldIndex).IsComboOptional(N)){if(t==null){}else{var D=t.AddNewElement("vli");D.SetAttribute("txt","");D.SetAttribute("val","")}}while(!this.RS.EOF()){if(t==null){}else{var D=t.AddNewElement("vli");if(this.VisibleColumns!=null){var u="";for(var F=0;F<this.VisibleColumns.Count();F++){var C=this.VisibleColumns[F];if(this.RS.findColumn(C)!=-1){u+=(u.length>0?"|":"")+this.RS.Get(C).stringValue()}}D.SetAttribute("txt",u)}else{D.SetAttribute("txt",this.RS.Get(g).stringValue())}D.SetAttribute("val",this.RS.Get(1).stringValue());var G=new IDVariant(true);var I=new IDVariant("");var h=new IDVariant("");if(this.RS.findColumn("ENABLED")!=-1){G=this.RS.Get("ENABLED")}if(this.RS.findColumn("ICON")!=-1){I=this.RS.Get("ICON")}if(this.RS.findColumn("GROUPID")!=-1){h=this.RS.Get("GROUPID")}if(G.Type!=IDVariant.NULL&&G.booleanValue()!=true){D.SetAttribute("ena",G.booleanValue()?"-1":"0")}if(I.Type!=IDVariant.NULL&&!I.stringValue().equals("")){D.SetAttribute("img",I.stringValue())}if(h.Type!=IDVariant.NULL&&!h.stringValue().equals("")){D.SetAttribute("gru",h.stringValue())}}this.RS.MoveNext()}if(this.RS.RecordCount()>0){this.RS.MoveFirst()}}catch(x){n.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",159,"PQuery.GetValueSource","Panel "+this.Parent.GetDTTCaption()+" - Error while filling the ComboBox: "+x.message);n.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()))}}return b};PQuerySrv.prototype.GetValueSourceValue=function(a){var b=false;var c=new IDVariant();if(this.RS.IsOpen()){while(!this.RS.EOF()){if(this.RS.Get(1).equals(a)){b=true}else{if(this.RS.Get(1).Type==IDVariant.STRING&&a.Type!=IDVariant.NULL){if(this.RS.Get(1).stringValue().trim()==a.stringValue().trim()){b=true}}}if(b){c=this.RS.Get(this.DecodeColumn>0?this.DecodeColumn:this.RS.GetNumFields());break}this.RS.MoveNext()}if(this.RS.RecordCount()>0){this.RS.MoveFirst()}}return c};PQuerySrv.prototype.DoUpdateLookups=function(c,a){if(this.Parent.DisableLookups){return}for(var b=1;b<this.Parent.UQueries();b++){if(this.Parent.bQueries(b).FieldIndex==-1){this.Parent.bQueries(b).UpdateLookup(c,a)}else{if((this.Parent.bFields(this.Parent.bQueries(b).FieldIndex).Flags&Glb.FLD_AUTOLOOKUP)!=0){this.Parent.bQueries(b).UpdateLookup(c,a)}}}};PQuerySrv.prototype.EnableSorting=function(b){var e=true;var c=this.Parent.MainFrm;c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.EnableSorting","Panel "+this.Parent.GetDTTCaption()+": Enable sorting");if(this.IsDO){if(this.IDColl!=null){this.IDColl.ClearSort();for(var d=0;d<b.Count();d++){var g=b[d];c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.EnableSorting","Panel "+this.Parent.GetDTTCaption()+": Sort records by field "+g.GetDTTCaption()+" ("+(g.SortMode==-1?"descending":"ascending")+")");var a=g.GetDOIdx(null);if(a<0){this.IDColl.ClearSort();return false}this.IDColl.SortBy(a*g.SortMode)}this.IDColl.EnableSort();c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.EnableSorting","Panel "+this.Parent.GetDTTCaption()+": Data sorted")}return e}if(this.IMDBDataSource>-1){this.Parent.IMDB.TblInitSort(this.IMDBDataSource)}else{this.InitSort()}for(var d=0;d<b.Count();d++){var g=b[d];c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.EnableSorting","Panel "+this.Parent.GetDTTCaption()+": Sort records by field "+g.GetDTTCaption()+" ("+(g.SortMode==-1?"descending":"ascending")+")");if(this.IMDBDataSource>-1){this.Parent.IMDB.TblSortBy(this.IMDBDataSource,g.GetRSIMDBIdx(this.IMDBDataSource),(g.SortMode==1))}else{this.SortBy(g.GetRSIdx(this.RS),(g.SortMode==1))}}if(this.IMDBDataSource>-1){this.Parent.IMDB.TblStartSort(this.IMDBDataSource)}else{this.StartSort()}if(this.RecordCount()<=0){e=false}c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.EnableSorting","Panel "+this.Parent.GetDTTCaption()+": Data sorted");return e};PQuerySrv.prototype.UploadBlob=function(h,d){var m=false;var o=this.Parent.MainFrm;var n=this.GetBlobData(-1,h);if(n!=null){try{var s=o.Request.Files[0];if(s.ContentLength>d){throw new Error("Uploaded file size ("+s.ContentLength+" bytes) exceeds upload limit of "+d+" bytes")}var c=s.FileName;var a=new IDVariant();var r="";var g=c.lastIndexOf(".");if(g>-1){a=new IDVariant(c.substr(g+1));r=c.substr(0,g)}else{r=c}var q=new IDVariant();o.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": Fire BeforeBlobUpdate Event");this.Parent.Parent.BeforeBlobUpdate(this.Parent,q,new IDVariant(n.FldIndex),new IDVariant(s.ContentLength),a,new IDVariant(c));if(q.isFalse()){if(this.IsDO){if(n.RSIndex<1){if(this.Parent.Fields[n.FldIndex].IsNamed){n.BookMark.SetNamedPropertyValue(this.Parent.Fields[n.FldIndex].Code,Glb.LoadBlob(this.Parent.MainFrm,s))}}else{n.BookMark.SetPropByIndex(n.RSIndex,Glb.LoadBlob(this.Parent.MainFrm,s))}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblGoToAbsoluteRow(this.IMDBDataSource,Glb.IMDB_CURSOR,n.BookMark);this.Parent.IMDB.set_Value(this.IMDBDataSource,n.RSIndex,Glb.IMDB_CURSOR,Glb.LoadBlob(this.Parent.MainFrm,s))}else{this.InitConnection();this.RS.absolute(n.BookMark);this.RS.setTableName(this.DB.ApplySubstitutions(this.MstTableName));Glb.LoadBlob(o,this.RS,n.RSIndex,s,this.DB)}}n.IsValid=1;n.MimeType=o.GetMimeType(a.stringValue());n.Size=s.ContentLength+(this.Parent.Parent.MainFrm.ParamsObj().NativeBlob?0:16);n.Extension=a.stringValue();n.ToDownload=n.Size<this.Parent.Fields[n.FldIndex].MaxAutoShowSize;o.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,53,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": Fire AfterBlobUpdate Event");this.Parent.Parent.AfterBlobUpdate(this.Parent,new IDVariant(n.FldIndex),new IDVariant(s.ContentLength),a);o.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,84,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": blob successfully uploaded");m=true;this.Parent.SetInfoMessage(o.RTCObj.GetConst("C3B4AFB6-764C-4D37-8783-F058E9718E88","Il file è stato caricato."))}else{o.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",102,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": blob upload canceled");o.AddTempFile(n.FileName)}var t=new Uint8Array(s.Content.length);for(var j=0;j<s.Content.length;j++){t[j]=s.Content.charCodeAt(j)}var k=new BlobBuilder();k.append(t.buffer);var f=o.GetMimeType(a.stringValue());n.FileName=URL.createObjectURL(k.getBlob(f))}catch(l){o.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,84,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": blob not uploaded (Error = "+l.message+")");this.Parent.SetInfoMessage(AMessageSrv.MSG_WARN,o.RTCObj.GetConst("93D4A2C8-F406-4B9C-9D48-3B54247F2412","Il file NON è stato caricato."),2)}}return m};PQuerySrv.prototype.PrepareLastWhereClause=function(){try{var f=0;var d=0;var a=false;var m=false;var c=this.RS.getParams();var g=this.Text[Glb.SQL_SELECT]+this.Text[Glb.SQL_FROM];for(var l=0;l<g.length;l++){if(!m&&g.charAt(l)=="'"){a=!a}if(!a&&g.charAt(l)=='"'){m=!m}if(!a&&!m){if(g.charAt(l)=="?"){d++}}}a=false;m=false;while(f<this.LastWhereClause.length){if(!m&&this.LastWhereClause.charAt(f)=="'"){a=!a}if(!a&&this.LastWhereClause.charAt(f)=='"'){m=!m}if(!a&&!m){if(this.LastWhereClause.charAt(f)=="?"){var k=IDVariant.convertObject(c[d++]);if(k==null){this.LastWhereClause=this.LastWhereClause.substr(0,f)+"NULL"+this.LastWhereClause.substr(f+1)}else{var b=IDL.FMT_NUM;switch(k.Type){case IDVariant.STRING:b=IDL.FMT_CHAR;break;case IDVariant.DATETIME:if(Glb.ClassDB(this.DBType)==Glb.DBC_ACCESS){b=IDL.FMT_DAT1}else{if(Glb.ClassDB(this.DBType)==Glb.DBC_ORACLE||Glb.ClassDB(this.DBType)==Glb.DBC_POSTGRES){b=IDL.FMT_DAT3}else{if(Glb.ClassDB(this.DBType)==Glb.DBC_SQLITE){b=IDL.FMT_DAT4}else{if(this.DBType==Glb.DBT_DB2400&&this.DB.UseAS400Date){b=IDL.FMT_DAT5}else{b=IDL.FMT_DAT2}}}}break}this.LastWhereClause=this.LastWhereClause.substr(0,f)+IDL.CSql(k,b,this.DB)+this.LastWhereClause.substr(f+1)}}else{f++}}else{f++}}}catch(h){}};PQuerySrv.prototype.IMDBAbsolutePosition=function(c){c=c-1;if(this.IMDBDataSource==-1){return false}var a=this.Parent.IMDB.TblNumRows(this.IMDBDataSource);if(a<=c){this.Parent.IMDB.TblMoveLast(this.IMDBDataSource,Glb.IMDB_CURSOR);return false}this.Parent.IMDB.TblMoveFirst(this.IMDBDataSource,Glb.IMDB_CURSOR);for(var b=0;b<c;b++){this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR)}return true};PQuerySrv.prototype.CheckIMDBLookupParam=function(){for(var a=0;a<this.LookupParams.Count();a++){var b=this.LookupParams[a];if(b.MstField==null&&b.TblIdx>-1){if(this.Parent.IMDB.TblModified(b.TblIdx,1)){return true}}}return false};PQuerySrv.prototype.InitConnection=function(){if(!this.DB.IsOpen()){this.Parent.MainFrm.OpenConnection(this.DB)}};PQuerySrv.prototype.GotoAbsolute=function(a){if(this.LookupRows==null||this.LookupRows.length<a){this.RS.absolute(a)}else{this.RS.absolute(this.LookupRows[a-1])}this.CursorPos=a};PQuerySrv.prototype.GotoNext=function(){if(this.LookupRows==null){this.RS.MoveNext()}else{this.CursorPos++;if(this.CursorPos<=this.LookupRows.length){this.RS.absolute(this.LookupRows[this.CursorPos-1])}}};PQuerySrv.prototype.GotoFirst=function(){if(this.LookupRows==null){this.RS.MoveFirst()}else{this.GotoAbsolute(1)}};PQuerySrv.prototype.GotoLast=function(){if(this.LookupRows==null){this.RS.MoveLast()}else{this.GotoAbsolute(this.LookupRows.length)}};PQuerySrv.prototype.RSEOF=function(){if(this.LookupRows==null){return this.RS.EOF()}else{return this.CursorPos>this.LookupRows.length}};PQuerySrv.prototype.InitSort=function(){this.LookupRows=null;this.NumSort=0;this.CursorPos=1};PQuerySrv.prototype.SortBy=function(b,a){if(this.SortColumns==null){this.SortColumns=new Array(32);this.SortAscending=new Array(32)}this.SortColumns[this.NumSort]=b;this.SortAscending[this.NumSort]=a;this.NumSort++};PQuerySrv.prototype.StartSort=function(){if(this.NumSort==0||this.RS.size()==0){return}var b=new Array(this.RS.size());for(var c=0;c<b.length;c++){b[c]=c+1}function e(g,a){var h=0;for(var l=0;l<d.NumSort&&h==0;l++){var k=null;var j=null;try{k=d.RS.GetObjectDirect(g,d.SortColumns[l]);j=d.RS.GetObjectDirect(a,d.SortColumns[l]);if(d.Parent!=null){try{var m=d.Parent.SortingList[l];if(m.Transformation!=Glb.TRANSF_NONE&&m.Transformation!=Glb.TRANSF_NULL){var q=Glb.GetTD(IDVariant.convertObject(k),m.Transformation,m.TrFormat,m.TrOffset,m.MaxLength);var o=Glb.GetTD(IDVariant.convertObject(j),m.Transformation,m.TrFormat,m.TrOffset,m.MaxLength);k=q.Value;j=o.Value}}catch(n){}}if(k==null){h=(j==null)?0:-1}else{if(j==null){h=(k==null)?0:1}else{if(typeof(k)=="string"&&typeof(k)=="string"){h=String.compare(k,j,true)}else{if(k<j){h=-1}else{if(k>j){h=1}else{h=0}}}}}if(!d.SortAscending[l]){h=-h}}catch(n){WriteToConsoleError("[SortRS::Compare] Exception while sorting RS: "+n)}}return h}var d=this;b=b.sort(e);delete d;this.LookupRows=new Array(this.RS.size());for(var c=0;c<b.length;c++){this.LookupRows[c]=b[c]}};PQuerySrv.prototype.WriteUnboundValue=function(c,a){var b=true;try{if(this.IMDBDataSource>-1){this.IMDBAbsolutePosition(this.ActualPosition+c)}else{this.GotoAbsolute(this.ActualPosition+c)}if(this.IMDBDataSource==-1){this.RS.Set(a.GetRSIdx(this.RS),a.bValues(c).Value)}else{this.Parent.IMDB.set_Value(this.IMDBDataSource,a.GetRSIdx(null),Glb.IMDB_CURSOR,a.bValues(c).Value)}if(this.IMDBDataSource==-1){this.RS.updateRow();this.RS.setOriginalRow()}}catch(d){b=false}return b};PQuerySrv.prototype.ClearUnboundData=function(){this.UnboundData.Clear()};PQuerySrv.prototype.AddLookupParam=function(a,e,d,c){var b=new PLookupParamSrv();b.TblIdx=a;b.FldIdx=e;b.PropName=d;b.AutoLookup=c;this.LookupParams.Add(b)};PQuerySrv.prototype.AddLookupValue=function(c,a){var b=new PLookupParamSrv();b.PropName=c;b.Value=a;this.LookupParams.Add(b)};PQuerySrv.prototype.AddLKEParam=function(c,a){if(this.LKEParams==null){this.LKEParams=new ArrayList();this.LKERows=new ArrayList()}var b=new PLookupParamSrv();b.FldIdx=c;b.PropName=a;this.LKEParams.Add(b)};PQuerySrv.prototype.AddVisibleColumn=function(a){if(this.VisibleColumns==null){this.VisibleColumns=new ArrayList()}this.VisibleColumns.Add(a)};PQuerySrv.prototype.AddHeaderColumn=function(a,b){if(this.HeaderColumns==null){this.HeaderColumns=new HashTableSrv();this.OrderColumns=new ArrayList()}this.HeaderColumns[a]=b;this.OrderColumns.Add(a)};PQuerySrv.prototype.SetDecodeColumn=function(a){this.DecodeColumn=a};PQuerySrv.prototype.AddExpressionColumn=function(a,b){if(this.ExpressionColumns==null){this.ExpressionColumns=new HashTableSrv()}this.ExpressionColumns[a]=b};PQuerySrv.prototype.AddLKERow=function(a){if(!this.LKERows.Contains(a)){this.LKERows.Add(a)}};PQuerySrv.prototype.UpdateLKE=function(a){if(this.LKEParams==null){return false}var d=false;for(var c=0;c<this.LKERows.Count();c++){var b=this.LKERows[c];if(this.IsDO){d=d|this.UpdateDoLKE(a,b)}else{d=d|this.UpdateLKERow(a,b)}}this.LKERows.Clear();return d};PQuerySrv.prototype.UpdateDoLKE=function(g,C){if(this.Document!=null){var d=false;var u;try{this.Document.Clear();var b=new ArrayList();for(var c=0;c<this.LookupParams.Count();c++){var n=this.LookupParams[c];if(n.PropIdx==-1&&n.PropName.length>0){n.PropIdx=this.Document.GetPropIndex(n.PropName);if(n.PropIdx<1){n.PropIdx=this.Document.GetPropertyIndex(n.PropName)}n.PropName=""}if(n.Value!=null){if(n.PropIdx>0){this.Document.SetPropByIndex(n.PropIdx,n.Value);b.Add(n.PropIdx)}}else{if(n.TblIdx!=this.Parent.mMstTblIndex&&n.TblIdx>-1&&n.FldIdx>-1){if(n.PropIdx>0){var h=this.Parent.IMDB.Value(n.TblIdx,n.FldIdx,0);this.Document.SetPropByIndex(n.PropIdx,h);b.Add(n.PropIdx)}}if(n.MstField!=null){var k=false;for(var A=0;A<this.LKEParams.Count();A++){var q=this.LKEParams[A];if(q.FldIdx==n.MstField.Index){k=true;break}}if(!k){if(n.PropIdx>0){var h;if(this.QBEComboQuery==true){h=new IDVariant(n.MstField.LastQBE)}else{if(this.Parent.Status()==Glb.PS_QBE){h=new IDVariant(n.MstField.bValues(C).Text)}else{h=n.MstField.bValues(C).Value}}this.Document.SetPropByIndex(n.PropIdx,h);b.Add(n.PropIdx)}}if(n.MstField.IsExtended&&n.MstField.IDLista.length>0){var s=this.Document.GetPropertyIndex("DO_LISTID",true,true,true,true);if(s>0){this.Document.SetPropByIndex(s,new IDVariant(n.MstField.IDLista));b.Add(s)}}}}}for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){if(!this.Parent.bFields(t).bValues(C).Value.equals(this.Parent.bFields(t).bValues(C).OrgValue)){if(this.PreviuosDocument!=null){var B=this.Document.GetMD();for(var s=1;s<=B.GetNumProp();s++){if(B.GetProp(s).DescribeRow){this.Document.SetPropByIndex(s,this.Parent.bFields(t).bValues(C).Value)}}}else{if(this.Parent.bFields(t).GetDOIdx(this.Document)>0){this.Document.SetPropByIndex(this.Parent.bFields(t).GetDOIdx(this.Document),this.Parent.bFields(t).bValues(C).Value)}}}}}d=false;u=true;var x=new IDVariant(d);var m=this.Parent.GetDocument(C);if(m==null){m=this.Parent.LastMasterDocument}for(var t=0;t<this.Parent.UFields();t++){var y=this.Parent.bFields(t);if(y.IdxPanel==this.Index&&y.QBEFilterPopup!=null){m=null;break}}this.LastLKETry=this.Document.GetLKE(this.RS,x,b,m);d=x.isTrue();if(this.RS.RecordCount()>0){u=false}}catch(z){u=true}if(u&&g.ParamsObj().PanelInvalidLkeToNull){u=false;d=true}try{var a=false;if(this.LkeMS!=null&&this.LkeMS.RecordCount()>0){a=true}if(d&&!this.QBEComboQuery){for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){this.Parent.bFields(t).bValues(C).SetValue(new IDVariant(""))}}return this.ActivateLKE(C,true)}if(!a&&u&&!this.QBEComboQuery){for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){this.Parent.bFields(t).bValues(C).SetValue(this.Parent.bFields(t).bValues(C).OrgValue)}}return false}var r=false;if(g.ParamsObj().UseRD3){for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){r|=((this.Parent.bFields(t).Flags&Glb.FLD_ACTIVE)!=0)}}}if(!a&&this.RS.RecordCount()==1&&!r&&!this.QBEComboQuery){this.RS.MoveFirst();var o=this.ActivateLKE(C,false);for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){if(this.Parent.bFields(t).bValues(C).Value.stringValue().equals("*")){this.Parent.bFields(t).bValues(C).SetLkeRS(this.RS);return false}else{if(!o){this.Parent.bFields(t).bValues(C).SetValue(this.Parent.bFields(t).bValues(C).OrgValue)}this.Parent.bFields(t).bValues(C).SetLkeRS(null)}}}return o}this.Parent.bFields(this.Parent.Parent.IdxFieldActived).bValues(C).SetLkeRS(this.RS)}catch(z){}}return false};PQuerySrv.prototype.UpdateLKERow=function(m,D){if(!this.QueryOK||this.LastPreparedQueryIndex!=1){this.PrepareLookup(1)}this.RSParam.Clear();for(var n=0;n<this.LookupParams.Count();n++){var r=this.LookupParams[n];if(r.MstField==null){this.RSParam.Add(this.Parent.IMDB.Value(r.TblIdx,r.FldIdx,0))}else{if(this.QBEComboQuery==true){this.RSParam.Add(new IDVariant(r.MstField.LastQBE))}else{if(this.Parent.Status()==Glb.PS_QBE){this.RSParam.Add(new IDVariant(r.MstField.bValues(D).Text))}else{this.RSParam.Add(r.MstField.bValues(D).Value)}}}}var y=0;var j=this.RS.getCommand();var a=j;var k=this.Parent.MainFrm.HandleTableSubst(j,3);if(!k.equals(a)){this.RS.setCommand(k);j=k}var h=false;var x=false;var q=-1;var f=m.ParamsObj().MaxLookupRows;for(var v=0;v<this.Parent.UFields();v++){if(this.Parent.bFields(v).IdxPanel==this.Index){q=this.Parent.bFields(v).Index;f=this.Parent.bFields(v).maxLKERows;break}}try{do{this.RS.setCommand(this.DB.ApplySubstitutions(j));if(!this.AddLKEQBE(y,D)){h=true;break}var B="";if(!B.equals(this.RS.getCommand())){B=this.RS.getCommand();if(this.RS.IsOpen()){this.RS.Close()}var c=new IDVariant();var A=new IDVariant();var C=new IDVariant();this.Parent.FireGetLKE(this.RS,new IDVariant(y),C,c,A,new IDVariant(q));this.LkeRSLimitedBySystem=m.ParamsObj().PanelLimitOnGetSmartLookup;if(A.isTrue()||this.RS.RecordCount()>0){break}if(C.isTrue()){h=true;break}if(c.isFalse()){m.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Update LKE","Editable Lookup Query",DTTEngine.STMT_QRY_SELECT,B);var l=1;for(var g=0;g<this.RSParam.Count();g++){var b=this.RSParam[g];m.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+l++,b)}this.RS.setMaxRows(f+1);this.LkeRSLimitedBySystem=true;this.InitConnection();this.RS.execute(this.RSParam,this.DB);m.DTTObj.AddDBDataSource(this.RS,B);m.DTTObj.EndQuery(this.iGuid);this.LastLKERow=D;this.LastLKETry=y}}y++}while(this.RS.RecordCount()==0&&y<5);if(this.RS.RecordCount()==0){x=true}}catch(o){m.DTTObj.AddMsg((y>3)?DTTEngine.DTTMSG_WARN:DTTEngine.DTTMSG_ERROR,"",173,"PQuery.UpdateLKE","Panel "+this.Parent.GetDTTCaption()+": Update LKE error ("+o.message+")");x=true}finally{if(!k.equals(a)){j=a}}if(x&&m.ParamsObj().PanelInvalidLkeToNull){x=false;h=true}try{this.RS.setCommand(this.DB.ApplySubstitutions(j))}catch(z){}var d=false;if(this.LkeMS!=null&&this.LkeMS.RecordCount()>0){d=true}if(h&&!this.QBEComboQuery){for(var v=0;v<this.Parent.UFields();v++){if(this.Parent.bFields(v).IdxPanel==this.Index){this.Parent.bFields(v).bValues(D).SetValue(new IDVariant(""))}}return this.ActivateLKE(D,true)}if(!d&&x&&!this.QBEComboQuery){for(var v=0;v<this.Parent.Fields.length;v++){if(this.Parent.bFields(v).IdxPanel==this.Index){this.Parent.bFields(v).bValues(D).SetValue(this.Parent.bFields(v).bValues(D).OrgValue)}}return false}var u=false;if(m.ParamsObj().UseRD3){for(var v=0;v<this.Parent.UFields();v++){if(this.Parent.bFields(v).IdxPanel==this.Index){u|=((this.Parent.bFields(v).Flags&Glb.FLD_ACTIVE)!=0)}}}if(!d&&this.RS.RecordCount()==1&&!u&&!this.QBEComboQuery){this.RS.MoveFirst();var t=this.ActivateLKE(D,false);for(var v=0;v<this.Parent.UFields();v++){if(this.Parent.bFields(v).IdxPanel==this.Index){if(this.Parent.bFields(v).bValues(D).Value.stringValue().equals("*")){this.Parent.bFields(v).bValues(D).SetLkeRS(this.RS);return false}else{if(!t){this.Parent.bFields(v).bValues(D).SetValue(this.Parent.bFields(v).bValues(D).OrgValue)}this.Parent.bFields(v).bValues(D).SetLkeRS(null)}}}return t}this.Parent.bFields(this.Parent.Parent.IdxFieldActived).bValues(D).SetLkeRS(this.RS);return false};PQuerySrv.prototype.ActivateLKE=function(d,m,h){if(h==undefined){h=-1}this.LastPreparedQueryIndex=-1;var c=false;for(var g=0;g<this.LKEParams.Count();g++){var b=this.LKEParams[g];try{var j=this.Parent.bFields(b.FldIdx);j.iMultiCriteria=false;if(m){c=c|j.bValues(d).SetNewText("",this.Parent.Status()!=Glb.PS_QBE)}else{var o=j.bValues(d).LastValue;var n=(h<=0&&(j.Flags&Glb.FLD_AUTOLOOKUP)!=0?j.bValues(d).Value.stringValue():j.bValues(d).Text);var a=(h>0?n+j.GetQBESep():"")+this.RS.Get(b.PropName).stringValue();c=c|j.bValues(d).SetNewText(a,this.Parent.Status()!=Glb.PS_QBE);if(h>0){j.bValues(d).LastValue=new IDVariant(o);j.iMultiCriteria=true}}}catch(k){}}return c};PQuerySrv.prototype.AddLKEQBE=function(D,G){var n=false;try{var A="";var m="";var q;for(var C=0;C<this.Parent.Fields.length;C++){if(this.Parent.bFields(C).IdxPanel==this.Index){q=this.Parent.bFields(C).bValues(G).Text;if(q.length>0&&!this.Parent.bFields(C).bValues(G).Value.equals(this.Parent.bFields(C).bValues(G).OrgValue)){var k=false;n=true;q=q.replace(/\%/g,"*");if(q.charAt(0)!="*"&&q.charAt(q.length-1)!="*"){if(D==0){k=true}else{if(D==1){q+="*"}else{q="*"+q+"*"}}}if(k){switch(Glb.ClassDT(this.Parent.bFields(C).DataType)){case Glb.DTC_CHAR:m=IDL.CSql(new IDVariant(q),IDL.FMT_CHAR,this.DB);break;case Glb.DTC_DATE:var d=IDL.FMT_DAT2;if(Glb.ClassDB(this.DBType)==Glb.DBC_ACCESS){d=IDL.FMT_DAT1}else{if(Glb.ClassDB(this.DBType)==Glb.DBC_ORACLE||Glb.ClassDB(this.DBType)==Glb.DBC_POSTGRES){d=IDL.FMT_DAT3}else{if(Glb.ClassDB(this.DBType)==Glb.DBC_SQLITE){d=IDL.FMT_DAT4}else{if(this.DBType==Glb.DBT_DB2400&&this.DB.UseAS400Date){d=(this.Parent.bFields(C).DataType==Glb.DT_DATETIME?IDL.FMT_DAT6:IDL.FMT_DAT5)}}}}m=IDL.CSql(new IDVariant(q),d,this.DB);break;case Glb.DTC_NUMBER:m=IDL.CSql(new IDVariant(q),IDL.FMT_NUM,this.DB);break}m=this.Parent.bFields(C).Expr+" = "+m}else{var f=this.Parent.VS.Mask(this.Parent.bFields(C).VisualStyle);var t;if(f.equals(">")){m="((";t=new IDVariant(q.toUpperCase())}else{if(f.equals("<")){m="((";t=new IDVariant(q.toLowerCase())}else{t=new IDVariant(q.toLowerCase());switch(Glb.ClassDB(this.DBType)){case Glb.DBC_ACCESS:m="lcase(cstr('' & ";break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:m="lower((";break;case Glb.DBC_DB2:m="lower(char(";break;case Glb.DBC_SQLSRV:m="lower(convert("+(this.DB.Unicode?"nvarchar(4000)":"varchar(8000)")+", ";break;case Glb.DBC_ORACLE:m="lower(to_char(";break;default:m="((";t=new IDVariant(q);break}}}var y=new IDVariant();IDL.LikeEscape(this.DBType,t,y);t=new IDVariant(t.stringValue().replace(/\*/g,"%"));m+=this.Parent.bFields(C).Expr+")) like "+IDL.CSql(t,IDL.FMT_CHAR,this.DB)+y.stringValue()}if(A.length>0){if(D>2){A+=" or "}else{A+=" and "}}A+=m}}}if(D>3){if(!this.RS.IsOpen()){this.InitConnection();this.RS.execute(this.RSParam,this.DB)}for(var C=1;C<=this.RS.GetNumFields();C++){var s=false;if(this.VisibleColumns!=null){for(var B=0;B<this.VisibleColumns.Count();B++){if(String.compare(this.VisibleColumns[B],this.RS.GetName(C),true)==0){s=true;break}}}if(!s&&this.VisibilityColumnsMode==Glb.QRY_VISDEF){s=true;for(var h=0;h<this.LKEParams.Count();h++){var z=this.LKEParams[h];if(String.compare(z.PropName,this.RS.GetName(C),true)==0){s=false;break}}}if(s){for(var B=0;B<this.Parent.Fields.length;B++){if(this.Parent.bFields(B).IdxPanel==this.Index){q=this.Parent.bFields(B).bValues(G).Text;if(q.length>0&&!this.Parent.bFields(B).bValues(G).Value.Equals(this.Parent.bFields(B).bValues(G).OrgValue)){if(String.compare(this.Parent.bFields(B).Code,(this.RS.GetName(C)),true)==0){s=false;break}}}}}if(s){for(var B=0;B<this.Parent.Fields.length;B++){if(this.Parent.bFields(B).IdxPanel==this.Index){q=this.Parent.bFields(B).bValues(G).Text;if(q.length>0&&!this.Parent.bFields(B).bValues(G).Value.equals(this.Parent.bFields(B).bValues(G).OrgValue)){n=true;q=q.Replace(/\%/g,"*");if(q.charAt(0)!="*"&&q.charAt(q.length-1)!="*"){q="*"+q+"*"}var f=this.Parent.VS.Mask(this.Parent.bFields(B).VisualStyle);var t;if(f.equals(">")){m="((";t=new IDVariant(q.toUpperCase())}else{if(f.equals("<")){m="((";t=new IDVariant(q.toLowerCase())}else{t=new IDVariant(q.toLowerCase());switch(Glb.ClassDB(this.DBType)){case Glb.DBC_ACCESS:m="lcase(cstr('' & ";break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:m="lower((";break;case Glb.DBC_DB2:m="lower(char(";break;case Glb.DBC_SQLSRV:m="lower(convert("+(this.DB.Unicode?"nvarchar(4000)":"varchar(8000)")+", ";break;case Glb.DBC_ORACLE:m="lower(to_char(";break;default:m="((";t=new IDVariant(q);break}}}var y=new IDVariant();IDL.LikeEscape(this.DBType,t,y);t=new IDVariant(t.stringValue().replace(/\*/g,"%"));var r;if(this.ExpressionColumns!=null&&this.ExpressionColumns.containsKey(this.RS.GetName(C))){r=this.ExpressionColumns[this.RS.GetName(C)]}else{r=this.RS.GetAlias(C)+this.RS.GetName(C)}m+=r+")) like "+IDL.CSql(t,IDL.FMT_CHAR,this.DB)+y.stringValue();if(A.length>0){A+=" or "}A+=m}}}}}}if(n){var F=this.RS.getCommand();var c=[-1,-1,-1];var u=["order by","group by","where "];var o=0;var b=false;for(var C=0;C<F.length;C++){if(F[C]=="'"){b=!b}if(b){continue}if(F[C]=="("){o++}else{if(F[C]==")"){o--}else{if(o==0){for(var B=0;B<3;B++){var g=u[B];if(c[B]==-1&&C+g.length<F.length){c[B]=C;for(var a=0;a<g.length;a++){if(F[C+a]!=g[a]){c[B]=-1;break}}}}}}}if(c[0]!=-1&&c[1]!=-1&&c[2]!=-1){break}}if(c[2]>0){A=" and ("+A+")"}else{A=" where "+A}var x=32767;if(c[0]!=-1&&c[0]<x){x=c[0]}if(c[1]!=-1&&c[1]<x){x=c[1]}if(x>=F.length){x=F.length-1}F=F.substr(0,x)+" "+A+" "+F.substr(x);this.RS.setCommand(this.DB.ApplySubstitutions(F))}}catch(E){}return n};PQuerySrv.prototype.GetLKEValues=function(Q,I,S,F,m){if(m==undefined){m=false}try{var ah=Q.ParamsObj().MaxLookupRows;for(var aa=0;aa<this.Parent.UFields();aa++){if(this.Parent.bFields(aa).IdxPanel==this.Index){ah=this.Parent.bFields(aa).maxLKERows;break}}var s=S.OrgValue;var q=S.Text.toLowerCase();var t=S.GetLkeRS();var H=t;var B;if(!t.IsOpen()&&this.LkeMS!=null){H=this.LkeMS}if(this.LkeMS!=null&&this.Parent.Status()!=Glb.PS_QBE){this.LkeMS.RemoveAllRows()}var ae=new ArrayList();for(var aa=1;aa<=H.GetNumFields();aa++){var K=false;var A=true;if(this.VisibleColumns!=null){for(var Y=0;Y<this.VisibleColumns.Count();Y++){if(String.compare(this.VisibleColumns[Y],H.GetName(aa),true)==0){K=true;A=false;break}}}if(!K&&this.VisibilityColumnsMode==Glb.QRY_VISDEF){K=true;for(var C=0;C<this.LKEParams.Count();C++){var X=this.LKEParams[C];if(String.compare(X.PropName,H.GetName(aa),true)==0){K=false;break}}if(K){K=this.LastLKETry>=4;for(var Y=0;Y<this.Parent.Fields.length;Y++){var ab=this.Parent.bFields(Y);if(ab.IdxPanel>-1&&(ab.Flags&(Glb.FLD_INLIST|Glb.FLD_INFORM))!=0){if(String.compare(ab.Code,H.GetName(aa),true)==0){K=true;A=false;break}}}}}if(A&&q=="*"){K=false}if(K){if(!A){ae.Add(aa)}else{if(t.IsOpen()){B=1;t.MoveFirst();while(!t.EOF()&&(!this.LkeRSLimitedBySystem||B<=ah)){var R=t.Get(aa).stringValue().toLowerCase();if(R.indexOf(q)>-1){ae.Add(aa);break}t.MoveNext();B++}}}}}if(this.OrderColumns!=null){var O=ae;ae=new ArrayList();for(var aa=0;aa<this.OrderColumns.Count();aa++){var ad=H.findColumn(this.OrderColumns[aa]);if(ad>0&&O.indexOf(ad)!=-1){ae.Add(ad)}}}if(F!=null&&(this.VisibleColumns!=null||ae.Count()>=2)){var T="";for(var aa=0;aa<ae.Count();aa++){var ag=H.GetName(ae[aa]);var J="";if(this.HeaderColumns!=null){var D=this.HeaderColumns.keys();for(var N=0;N<D.length;N++){var z=D[N];if(String.compare(z,ag,true)==0){J=this.HeaderColumns[z];break}}}if(J.length==0&&this.Document!=null){var u=this.Document.GetMD();for(var Y=1;Y<=u.GetNumProp();Y++){var G=u.GetProp(Y);if(String.compare(G.ObjTag,ag,true)==0){J=G.UIName;break}}}T+=(T.length>0?"|":"")+J}F.SetAttribute("hdr",T);var r=S.Parent.GetRSIdx(t);for(var aa=0;aa<ae.Count();aa++){if(ae[aa]==r){F.SetAttribute("dcc",(aa+1).toString());break}}}if(F!=null&&this.LkeMS!=null&&this.LkeMS.RecordCount()>0){this.LkeMS.MoveFirst();while(!this.LkeMS.EOF()){var P=F.AddNewElement("vli");var n="";for(var aa=0;aa<ae.Count();aa++){n+=(aa>0?"|":"")+this.LkeMS.Get(t.GetName(ae[aa])).stringValue()}P.SetAttribute("txt",n);P.SetAttribute("val","LKE"+(PQuerySrv.LKE_OLDSEL_OFFSET+this.LkeMS.BookMark()));var o=new IDVariant("");if(this.LkeMS.findColumn("ICON")!=-1){o=this.LkeMS.Get("ICON")}if(o.Type!=IDVariant.NULL&&!o.stringValue().equals("")){P.SetAttribute("img",o.stringValue())}if(m){var U="";for(var W=0;W<this.LKEParams.Count();W++){var y=this.LKEParams[W];var d=this.Parent.bFields(y.FldIdx);var E=this.LkeMS.Get(y.PropName).stringValue();U+=(U.length>0?"||":"")+d.GetRD3Ident()+"#"+E}P.SetAttribute("rval",U)}this.LkeMS.MoveNext()}}B=1;if(t.IsOpen()&&t.RecordCount()>0){t.MoveFirst()}while(t.IsOpen()&&!t.EOF()&&(!this.LkeRSLimitedBySystem||B<=ah)){var af="";if(F==null||(this.VisibleColumns==null&&ae.Count()<2)){for(var C=0;C<ae.Count();C++){var R=t.Get(ae[C]);if(R.Type!=IDVariant.NULL){if(af.length>0){af+=" : "}af+=R.stringValue()}}}else{for(var aa=0;aa<ae.Count();aa++){var R=t.Get(ae[aa]).stringValue();if(aa>0){af+="|"}af+=R}}if(F==null){}else{var h=false;if(this.LkeMS!=null){this.LkeMS.MoveFirst();while(!this.LkeMS.EOF()){var M=true;for(var aa=0;aa<t.GetNumFields();aa++){var f=t.GetName(aa+1);if(!this.LkeMS.Get(f).equals(t.Get(f))){M=false;break}}if(M){h=true;break}this.LkeMS.MoveNext()}}if(!h){var P=F.AddNewElement("vli");P.SetAttribute("txt",af);P.SetAttribute("val","LKE"+t.BookMark());var a=new IDVariant(true);var o=new IDVariant("");var x=new IDVariant("");if(t.findColumn("ENABLED")!=-1){a=t.Get("ENABLED")}if(t.findColumn("ICON")!=-1){o=t.Get("ICON")}if(t.findColumn("GROUPID")!=-1){x=t.Get("GROUPID")}if(a.Type!=IDVariant.NULL&&a.booleanValue()!=true){P.SetAttribute("ena",a.booleanValue()?"-1":"0")}if(o.Type!=IDVariant.NULL&&!o.stringValue().equals("")){P.SetAttribute("img",o.stringValue())}if(x.Type!=IDVariant.NULL&&!x.stringValue().equals("")){P.SetAttribute("gru",x.stringValue())}if(this.LKEParams!=null&&this.LKEParams.Count()>0){var U="";var g=true;for(var V=0;V<this.LKEParams.Count();V++){var y=this.LKEParams[V];var d=this.Parent.bFields(y.FldIdx);var k=t.Get(y.PropName);if(m){var E=k.stringValue();U+=(U.length>0?"||":"")+d.GetRD3Ident()+"#"+E}else{var L=d.bValues(d.Parent.AttR);if(!k.equals(L.Value)){g=false;break}}}if(m){P.SetAttribute("rval",U)}else{if(g){P.SetAttribute("lkes","-1")}}}}}t.MoveNext();B++}if(this.LkeRSLimitedBySystem&&B==ah+1&&!t.EOF()){var Z=Q.RTCObj.GetConst("9618341E-082A-41a8-B0E8-7A28BA7EF2BD","(altri valori...)");if(F==null){}else{var P=F.AddNewElement("vli");P.SetAttribute("txt",Z);P.SetAttribute("val","LKEPLUS");P.SetAttribute("ena","0")}}if(!m){if(F==null){}else{var P=F.AddNewElement("vli");P.SetAttribute("txt","-");P.SetAttribute("val","LKENULL")}if(s.Type!=IDVariant.NULL){if(F==null){}else{if(!this.IsMultiSelect()||this.Parent.Status()!=Glb.PS_QBE){var P=F.AddNewElement("vli");P.SetAttribute("txt","("+s+")");P.SetAttribute("val","LKEPREC")}}}}if(I){if(F==null){}else{var P=F.AddNewElement("vli");P.SetAttribute("txt","...");P.SetAttribute("val","LKEMORE")}}}catch(ac){}};PQuerySrv.prototype.GetLKERow=function(d,c,f,b,a){if(d<=PQuerySrv.LKE_OLDSEL_OFFSET){this.RS.CopyFrom(b)}else{this.RS.CopyFrom(this.LkeMS);d-=PQuerySrv.LKE_OLDSEL_OFFSET}try{this.RS.absolute(d)}catch(g){}return this.ActivateLKE(c,f,a)};PQuerySrv.prototype.ValidateLookup=function(a,s){if(this.FieldIndex>-1){return}var n=this.GetMstField();if(n!=null&&n.IsExtended&&n.IDLista.length==0){return}var q=false;var d=false;var t=false;var g=0;var m=null;var u=null;for(var j=0;j<this.LookupParams.Count();j++){var e=this.LookupParams[j];if(e.MstField!=null){if(e.MstField.bValues(a).Value.Type==IDVariant.NULL){q=true;if(e.MstField.IsVisible(a)){d=true}else{if((e.MstField.Flags&Glb.FLD_ISOPT)==0){t=true}}}if(e.MstField.IsVisible(a)){m=e.MstField;g++;u=((u==null)?"":u+", ")+e.MstField.Header}}}if(!q||(!d&&t)){var f=false;for(var h=0;h<this.Parent.Fields.length;h++){if(this.Parent.bFields(h).IdxPanel==this.Index){if(this.Parent.bFields(h).bValues(a).Value.Type!=IDVariant.NULL){f=true;break}}}if(!f&&g==0&&this.Parent.bQueries(0).IsDO){f=true}if(!f){for(var h=0;h<this.Parent.Fields.length;h++){if(this.Parent.bFields(h).IdxPanel==this.Index){if(!this.LookupLoaded[a]&&(this.Parent.bFields(h).Flags&Glb.FLD_ISOPT)==0&&this.Parent.bFields(h).bValues(a).Value.Type==IDVariant.NULL){var k;switch(g){case 0:k=this.Parent.MainFrm.RTCObj.GetConst("A61E8784-7812-44E2-9001-937ED881302F","E' necessario inserire un valore");break;case 1:k=IDL.FormatMessage(new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("4431C58E-5256-4339-9F77-905513EC5117","Il codice inserito nel campo |1 non esiste")),new IDVariant(u)).stringValue();break;default:k=IDL.FormatMessage(new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("8093940E-606E-4A4F-BB7F-65137D090C1B","I codici inseriti nei campi |1 non corrispondono")),new IDVariant(u)).stringValue();break}if(s){var o=new ArrayList();this.GetRelevantDocProp(o,s);var b=o[0];if(b==0){s.AddDocError(k)}else{if(s.GetPropError(b)==null){s.SetPropError(b,k)}}continue}if(m==null){m=this.Parent.bFields(h)}if(this.Parent.CanAddErrMsg(a,IDPanelSrv.EM_FIELD)){m.Values[a].SetError(k,IDDocument.ERR_ERROR)}if(this.Parent.CanAddErrMsg(a,IDPanelSrv.EM_MESSAGE)){this.Parent.Parent.SetMessage(m,AMessageSrv.MSG_STOP,m.Values[a].GetErrorText(),"","VAL",(this.Parent.NumRows>1)?a+1:0,false);if(this.Parent.Parent.FocusPriority==0){this.Parent.SetInput(a,m.Index,1,false)}}this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.bFields(h).iGuid,180,"PQuery.ValidateLookup","Panel "+this.Parent.GetDTTCaption()+": error for field "+this.Parent.bFields(h).GetDTTCaption()+" at row "+(a+1)+" - "+m.Values[a].GetErrorText())}}}}}};PQuerySrv.prototype.CollIsModified=function(){if(this.IDColl!=null){if(this.CollUpdCount!=this.IDColl.UpdateCount()){return true}}return false};PQuerySrv.prototype.GetMstField=function(){return this.LookupParams.Count()>0?this.LookupParams[0].MstField:null};PQuerySrv.prototype.GetRelevantDocProp=function(f,e){f.Clear();if(this.LKEParams!=null){for(var a=0;a<this.LKEParams.Count();a++){var b=this.LKEParams[a];if(b.FldIdx>=0){f.Add(this.Parent.bFields(b.FldIdx).GetDOIdx(e))}}}};PQuerySrv.prototype.AddDOSortCriteria=function(a){if(this.DOSortCriteria==null){this.DOSortCriteria=new ArrayList()}this.DOSortCriteria.Add(a)};PQuerySrv.prototype.ExtendLookup=function(c){if(c!=null){if(this.PreviuosDocument==null){if(this.LKEParams.Count()>0){this.PreviousLkeParam=this.LKEParams[0]}this.PreviousLookupParam=this.LookupParams[0];this.PreviuosDocument=this.Document;this.LookupParams.Clear();this.LKEParams.Clear();var b=new PLookupParamSrv();b.TblIdx=this.PreviousLookupParam.TblIdx;b.FldIdx=this.PreviousLookupParam.FldIdx;b.MstField=this.PreviousLookupParam.MstField;b.PropName="";b.PropIdx=c.GetDstProp(0);b.AutoLookup=false;this.LookupParams.Add(b);this.Document=this.Document.CreateDocument(c.GetDocumentClass());var d=this.Document.GetMD();var a=d.GetProp(c.GetDstProp(0));this.AddLKEParam(this.GetMstField().Index,a.ObjTag);this.LookupValues.Clear();this.UpdateLookup(-1,this.Parent.MainFrm)}}else{if(this.PreviousLookupParam!=null){this.LookupParams.Clear();this.LookupParams.Add(this.PreviousLookupParam);this.PreviousLookupParam=null;this.Document=this.PreviuosDocument;this.PreviuosDocument=null;this.LKEParams.Clear();if(this.PreviousLkeParam!=null){this.LKEParams.Add(this.PreviousLkeParam)}this.PreviousLkeParam=null;this.LookupValues.Clear()}}};PQuerySrv.prototype.OnValueChange=function(d,a,c){if(this.Parent!=null){if(this.LookupRows!=null&&d<this.LookupRows.length){for(var b=0;b<this.LookupRows.length;b++){if(this.LookupRows[b]-1==d){d=b;break}}}this.Parent.OnValueChange(d,a,c)}};PQuerySrv.prototype.IsMultiSelect=function(){if(this.iIsMultiSelect!=-2){return(this.iIsMultiSelect==-1)}this.iIsMultiSelect=0;if(this.LKEParams==null){return false}if(!this.Parent.MainFrm.ParamsObj().UseRD3){return false}for(var a=0;a<this.Parent.UFields();a++){if(this.Parent.bFields(a).IdxPanel==this.Index&&this.Parent.bFields(a).MultiSelectionComboBox()){this.iIsMultiSelect=-1;return true}}return false};function PQueryParamSrv(){this.TblIdx=-1;this.FldIdx=-1;this.RepIdx=-1;this.AttValue;this.DataType;this.MaxLength;this.vScale}function PValueSrv(b,a){this.Value=new IDVariant();this.OrgValue=new IDVariant();this.LastValue=new IDVariant();this.Text="";this.LastText="";this.Mask="";this.NotValidated;this.Modified;this.LastModified;this.CheckEmpty;this.Parent=b;this.Index=a;this.ValueListIndexes=new Array(0);this.Uploading;this.ErrorText="";this.ErrorType=IDDocument.ERR_NONE;this.ErrorAck=false;this.JustBorn=true;this.Enabled=-1;this.Visible=-1;this.VisualStyle=-1;this.DynText=false;this.Tooltip="";this.ForeColor=-2;this.BackColor=-2;this.FontMod="";this.DynMask="";this.Alignment=-1;this.Badge="";this.CSSClass="";this.LastEnabled=0;this.LastVisible=0;this.LastVisualStyle=0;this.LastTooltip="";this.LastForeColor=-2;this.LastBackColor=-2;this.LastFontMod="";this.LastMask="";this.LastAlignment=-1;this.LastBadge="";this.LastCSSClass="";this.LastRDText="";this.LkeRS=null;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.VAL_MAXPROPS);if(this.Parent.CustomElementCls!=null){this.iCustomElement=new CustomElement(this,this.Parent.CustomElementCls)}}PValueSrv.prototype.SetLkeRS=function(a){if(a==null){this.LkeRS=null}else{this.LkeRS=new IDCachedRowSet();this.LkeRS.CopyFrom(a)}this.RD3Change(RD3Glb.VAL_VALUELIST)};PValueSrv.prototype.GetLkeRS=function(){return this.LkeRS};PValueSrv.prototype.SetNewText=function(d,c){var g="";var h=d;if(this.Mask.length>0&&c){switch(Glb.ClassDT(this.Parent.DataType)){case Glb.DTC_NUMBER:var k=d;do{var a;if(!this.Parent.Parent.MainFrm.ParamsObj().UseDecimalDot){a=k.indexOf(".")}else{a=k.indexOf(",")}if(a==-1){break}else{k=k.remove(a,1)}}while(true);var e=k.indexOf(",");if(e>-1){k=k.substr(0,e)+"."+k.substr(e+1)}d=k;break;case Glb.DTC_DATE:if(this.Parent.DataType==Glb.DT_DATE||this.Parent.DataType==Glb.DT_DATETIME){var o=this.GetToken(d,this.Mask,"yyyy");if(o.length>0){g+=o+"-"}else{o=this.GetToken(d,this.Mask,"yy");g+=o+"-"}g+=this.GetToken(d,this.Mask,"mm")+"-";g+=this.GetToken(d,this.Mask,"dd")+" "}if(this.Parent.DataType==Glb.DT_TIME||this.Parent.DataType==Glb.DT_DATETIME){var o=this.GetToken(d,this.Mask,"hh");if(o.length>0){g+=o+":"}o=this.GetToken(d,this.Mask,"nn");if(o.length>0){g+=o}o=this.GetToken(d,this.Mask,"ss");if(o.length>0){g+=":"+o}}if(g.length==0||g.equals("-- ")){d=""}else{var n=new IDVariant(g);n=IDL.ToDateTime(n,new IDVariant(this.Mask));d=IDL.Format(n,new IDVariant(this.Mask),this.Parent.Parent.MainFrm).stringValue()}break;case Glb.DTC_CHAR:if(this.Mask.equals(">")){d=d.toUpperCase()}else{if(this.Mask.equals("<")){d=d.toLowerCase()}else{if(!(this.Parent.IdxPanel>0&&this.Parent.IsEnabled(this.Index))){var f=Math.min(d.length,this.Mask.length);for(var j=0;j<f;j++){if("Aa#&%".indexOf(this.Mask.charAt(j))>=0&&d.charAt(j)!="_"){g+=d.charAt(j)}}d=g}}}break}}this.LastText=d;this.NotValidated=false;if(!h.equals(this.Text)||(this.Parent.IdxPanel>0&&this.Text.equals("*"))){var l=this.Validate(d);if(!c||l){this.Text=d;this.Modified=true;this.LastModified=true;this.RD3Change(RD3Glb.VAL_TEXT)}else{this.NotValidated=c}}return this.Modified};PValueSrv.prototype.SetCheck=function(b,c){var a;if(b.length>0){a=this.Parent.ValueList[0]}else{this.CheckEmpty=true;a=this.Parent.ValueList[1]}return this.SetNewValue(a.Value)};PValueSrv.prototype.Validate=function(a){this.LastValue=new IDVariant(this.Value);if(a.length==0){this.Value=new IDVariant();this.ValueListIndexes=new Array(0);return true}else{var c=IDVariant.STRING;switch(this.Parent.DataType){case Glb.DT_NUM_INTEGER:c=IDVariant.INTEGER;break;case Glb.DT_NUM_FLOAT:c=IDVariant.FLOAT;break;case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:c=IDVariant.DECIMAL;break;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:c=IDVariant.DATETIME;break;case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:if(a.length>0&&this.Parent.ValueList.Count()==0&&this.Parent.DataType==Glb.DT_CHAR){if(IDL.IsWhiteSpace(a.charAt(a.length-1))||IDL.IsWhiteSpace(a.charAt(0))){var e=a;while(e.length>0&&IDL.IsWhiteSpace(e.charAt(e.length-1))){e=e.remove(e.length-1,e.length-(e.length-1))}while(e.length>0&&IDL.IsWhiteSpace(e.charAt(0))){e=e.remove(0,1-0)}a=e}}if(this.Parent.MaxLength>0&&a.length>this.Parent.MaxLength&&this.Parent.Parent.Status()!=Glb.PS_QBE&&this.Parent.IdxPanel==0){a=a.substr(0,this.Parent.MaxLength)}break}var f=a;if(this.Parent.Parent.Status()!=Glb.PS_QBE&&this.Mask.length>0&&Glb.ClassDT(this.Parent.DataType)==Glb.DTC_DATE){var b="";if(this.Parent.DataType==Glb.DT_DATE||this.Parent.DataType==Glb.DT_DATETIME){var d=this.GetToken(a,this.Mask,"yyyy");if(d.length>0){b+=d+"-"}else{d=this.GetToken(a,this.Mask,"yy");b+=d+"-"}b+=this.GetToken(a,this.Mask,"mm")+"-";b+=this.GetToken(a,this.Mask,"dd")+" "}if(this.Parent.DataType==Glb.DT_TIME||this.Parent.DataType==Glb.DT_DATETIME){var d=this.GetToken(a,this.Mask,"hh");if(d.length>0){b+=d+":"}d=this.GetToken(a,this.Mask,"nn");if(d.length>0){b+=d}d=this.GetToken(a,this.Mask,"ss");if(d.length>0){b+=":"+d}}if(b.length!=0&&!b.equals("-- ")){f=b}}this.Value=new IDVariant(f);if(c==IDVariant.DATETIME&&this.Parent.Parent.Status()!=Glb.PS_QBE&&(this.Mask.length>0||this.Parent.Mask.length>0)){this.Value=IDL.ToDateTime(this.Value,new IDVariant(this.Mask.length>0?this.Mask:this.Parent.Mask))}else{this.Value.changeType(c)}this.SearchValueList();return this.Value.Type!=IDVariant.NULL}};PValueSrv.prototype.Clear=function(a){if(a==undefined){a=true}this.Value=new IDVariant();this.OrgValue=new IDVariant();this.LastValue=new IDVariant();this.LastVisualStyle=0;if(this.Modified){this.RD3Change(RD3Glb.VAL_TEXT)}this.Text="";this.NotValidated=false;this.Modified=false;this.LastModified=false;this.ValueListIndexes=new Array(0);this.Uploading=false;this.CheckEmpty=false;if(a&&this.LkeRS!=null){this.RD3Change(RD3Glb.VAL_TEXT);this.LkeRS=null}this.ErrorAck=false;this.ClearError();this.ClearDynProp();if(this.iCustomElement!=null){this.iCustomElement.Clear()}};PValueSrv.prototype.SetOriginal=function(){this.OrgValue=new IDVariant(this.Value);this.LastValue=new IDVariant(this.Value)};PValueSrv.prototype.ClearError=function(){if(this.ErrorType!=IDDocument.ERR_NONE){this.Parent.Parent.Parent.ClearMessages(this.Parent,null,(this.Parent.Parent.NumRows>1)?this.Parent.Parent.ValidatingRow+1:0);this.RD3Change(RD3Glb.VAL_ERRORTEXT);this.RD3Change(RD3Glb.VAL_ERRORTYPE);var a=this.Parent.Parent.Queries[0].GetAttRecNumber()-1;this.Parent.Parent.SetRDRowSel(a+this.Index,true)}this.ErrorType=IDDocument.ERR_NONE;this.ErrorText=""};PValueSrv.prototype.SetError=function(c,b){if(this.ErrorType!=b||!c.equals(this.ErrorText)){this.RD3Change(RD3Glb.VAL_ERRORTYPE);this.RD3Change(RD3Glb.VAL_ERRORTEXT);if(this.Parent.Group!=-1){var a=this.Parent.Parent.Groups[this.Parent.Group];if(a.ExpandOnError){a.set_Collapsed(false)}}}this.ErrorType=b;this.ErrorText=c;if(b!=IDDocument.ERR_ERROR){return this.ErrorAck}else{return false}};PValueSrv.prototype.SetAck=function(a){if(this.ErrorType==IDDocument.ERR_WARNING||this.ErrorType==IDDocument.ERR_WARNACK){this.ErrorAck=a;if(a){this.ClearError()}}};PValueSrv.prototype.GetErrorText=function(){return this.ErrorText};PValueSrv.prototype.IsError=function(){return(this.ErrorType==IDDocument.ERR_ERROR||(this.ErrorType==IDDocument.ERR_WARNACK&&!this.ErrorAck))};PValueSrv.prototype.GetErrorType=function(){if(this.ErrorAck&&(this.ErrorType==IDDocument.ERR_WARNING||this.ErrorType==IDDocument.ERR_WARNACK)){return IDDocument.ERR_NONE}return this.ErrorType};PValueSrv.prototype.ClearDynProp=function(){this.DynText=false;this.Enabled=-1;this.Visible=-1;this.VisualStyle=-1;this.Tooltip="";this.BackColor=-2;this.ForeColor=-2;this.FontMod="";this.Alignment=-1;this.DynMask="";this.Badge="";this.CSSClass="";if(this.ValueListIndexes.length>0){this.VisualStyle=this.ValueListIndexes[0].VisIdx}};PValueSrv.prototype.SetValue=function(b){var a=this.Text;this.LastValue=this.Value;this.Value=b;this.NotValidated=false;this.SearchValueList();this.Text=b.stringValue();if(this.Modified&&this.Text!=a){this.RD3Change(RD3Glb.VAL_TEXT)}};PValueSrv.prototype.SetNewValue=function(b){this.LastValue=this.Value;this.NotValidated=false;if(this.Value.equals(b)){return this.Modified}var a=this.Text;this.Value=b;this.SearchValueList();this.Text=b.stringValue();if(this.Text!=a){this.RD3Change(RD3Glb.VAL_TEXT)}this.Modified=true;this.LastModified=true;return this.Modified};PValueSrv.prototype.SearchValueList=function(){this.ValueListIndexes=new Array(0);var b=new ArrayList();var d=this.Value.stringValue().split(this.Parent.GetQBESep().charAt(0));for(var f=0;f<this.Parent.ValueList.Count();f++){var c=this.Parent.ValueList[f];for(var e=0;e<d.length;e++){if(c.Value.equals(new IDVariant(d[e]))){b.Add(c);if(c.VisIdx!=-1){this.VisualStyle=c.VisIdx}}}}if(b.Count()>0){this.ValueListIndexes=new Array(b.Count());for(var e=0;e<b.Count();e++){this.ValueListIndexes[e]=b[e]}return true}return false};PValueSrv.prototype.GetComboName=function(){var a="";for(var c=0;c<this.ValueListIndexes.length;c++){var b=this.ValueListIndexes[c];a+=(a.length>0?this.Parent.Parent.MainFrm.ComboNameSep:"")+b.Name}return a};PValueSrv.prototype.SetAutoLookupValues=function(b,a){if(b==null||!b.equals(this.Value)){this.LastValue=this.Value;this.Value=new IDVariant(b)}this.Text=a.stringValue()};PValueSrv.prototype.SetNewAutoLookupValue=function(b){var a=this.Value;this.NotValidated=false;this.Validate(b);if(this.Value.equals(a)){return this.Modified}this.LastValue=a;this.Text=this.Value.stringValue();this.Modified=true;this.LastModified=true;return this.Modified};PValueSrv.prototype.GetToken=function(a,b,d){var c=b.indexOf(d);if(c==-1||a.length<c+d.length||a.substr(c,d.length).equals(d)){return""}else{return a.substr(c,d.length)}};PValueSrv.prototype.IsEmptyValue=function(){if(this.CheckEmpty||this.Text.length==0){return true}else{return false}};PValueSrv.prototype.SaveDynProp=function(){if(this.Visible!=this.LastVisible||this.JustBorn){this.RD3Change(RD3Glb.VAL_VISIBLE)}if(this.Enabled!=this.LastEnabled||this.JustBorn){this.RD3Change(RD3Glb.VAL_ENABLED)}if(this.VisualStyle!=this.LastVisualStyle||this.JustBorn){this.RD3Change(RD3Glb.VAL_VISUALSTYLE)}if(!this.Tooltip.equals(this.LastTooltip)||this.JustBorn){this.RD3Change(RD3Glb.VAL_TOOLTIP)}if(this.BackColor!=this.LastBackColor||this.JustBorn){this.RD3Change(RD3Glb.VAL_BACKCOLOR)}if(this.ForeColor!=this.LastForeColor||this.JustBorn){this.RD3Change(RD3Glb.VAL_FORECOLOR)}if(!this.DynMask.equals(this.LastMask)){this.RD3Change(RD3Glb.VAL_MASK);this.RD3Change(RD3Glb.VAL_TEXT)}else{if(this.JustBorn){this.RD3Change(RD3Glb.VAL_MASK)}}if(!this.FontMod.equals(this.LastFontMod)||this.JustBorn){this.RD3Change(RD3Glb.VAL_FONTMOD)}if(this.Alignment!=this.LastAlignment||this.JustBorn){this.RD3Change(RD3Glb.VAL_ALIGN)}if(!this.Badge.equals(this.LastBadge)||this.JustBorn){this.RD3Change(RD3Glb.VAL_BADGE)}if(!this.CSSClass.equals(this.LastCSSClass)||this.JustBorn){this.RD3Change(RD3Glb.VAL_CLASS)}this.LastEnabled=this.Enabled;this.LastVisible=this.Visible;this.LastVisualStyle=this.VisualStyle;this.LastTooltip=this.Tooltip;this.LastBackColor=this.BackColor;this.LastForeColor=this.ForeColor;this.LastMask=this.DynMask;this.LastAlignment=this.Alignment;this.LastFontMod=this.FontMod;this.LastBadge=this.Badge;this.LastCSSClass=this.CSSClass;this.JustBorn=false};PValueSrv.prototype.WasDynChanged=function(){if(this.LastVisualStyle!=this.VisualStyle||this.LastEnabled!=this.Enabled||this.LastVisible!=this.Visible||!this.LastTooltip.equals(this.Tooltip)||this.LastBackColor!=this.BackColor||this.LastForeColor!=this.ForeColor||!this.LastMask.equals(this.DynMask)||this.LastAlignment!=this.Alignment||!this.LastFontMod.equals(this.FontMod)||!this.LastBadge.equals(this.Badge)||!this.LastCSSClass.equals(this.CSSClass)){return true}else{return false}};PValueSrv.prototype.GetRD3Ident=function(){var a=this.Parent.Parent.bQueries(0).GetAttRecNumber();if(a==0||this.Parent.Parent.Status()==Glb.PS_QBE){a=1}return this.GetRD3Name()+":"+(this.Index+a)+":"+this.Parent.Index+":"+this.Parent.Parent.FrIndex+":"+this.Parent.Parent.Parent.FormIdx};PValueSrv.prototype.GetRD3Name=function(){return"val"};PValueSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};PValueSrv.prototype.RD3ResetChange=function(){this.RD3Changed=false};PValueSrv.prototype.GetRD3Changed=function(a){return this.RD3PropChg[a]};PValueSrv.prototype.RD3RenderDifferences=function(d,g){if((this.Parent.Flags&Glb.FLD_AUTOLOOKUP)!=0){if(this.Parent.QueryValueSource==null){for(var b=0;b<this.Parent.Parent.UQueries();b++){if(this.Parent.Parent.bQueries(b).FieldIndex==this.Parent.Index){this.Parent.QueryValueSource=this.Parent.Parent.bQueries(b);break}}}if(!g&&this.Parent.IsEnabled(this.Index)&&this.Parent.QueryValueSource!=null&&(this.Index==this.Parent.Parent.AttR||this.Parent.QueryValueSource.GetValueSource(this.Parent.Parent.MainFrm,this.Index,new IDVariant(""),false,true,true,null))){this.RD3Change(RD3Glb.VAL_VALUELIST)}if(g&&!this.Parent.IsEnabled(this.Index)&&this.Parent.QueryValueSource!=null&&this.Parent.QueryValueSource.LastPreparedQueryIndex==0){this.Parent.QueryValueSource.LastPreparedQueryIndex=-1}}var f=null;if(g){f=d.AddNewElement(this.GetRD3Name())}if(f==null&&this.RD3Changed){f=d.AddNewElement("chg")}if(f!=null){f.SetAttribute("id",this.GetRD3Ident())}var e=this.RD3Changed;if(g||this.RD3Changed){for(var c=0;c<this.RD3PropChg.length;c++){if(this.RD3PropChg[c]||g){this.SetRD3Property(c,f,g)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(g){}if(this.iCustomElement!=null){if(this.iCustomElement.RD3NewObj){this.iCustomElement.RD3RenderDifferences(f,true);this.iCustomElement.RD3NewObj=false}else{var a=(g?f:d);this.iCustomElement.RD3RenderDifferences(a,g)}}return e};PValueSrv.prototype.SetRD3Property=function(y,q,L){switch(y){case RD3Glb.VAL_TEXT:var u=this.Text;var J=null;if(this.Parent.DataType==Glb.DT_DOC_OLE){if(this.Uploading){q.SetAttribute("mim","upload");if((this.Parent.MaxUploadSize<1024)){u=this.Parent.MaxUploadSize+" byte"}else{if((this.Parent.MaxUploadSize<1048576)){u=(Math.floor(this.Parent.MaxUploadSize/1024))+" KB"}else{u=(Math.floor(this.Parent.MaxUploadSize/1048576))+" MB"}}u=IDL.FormatMessage(this.Parent.Parent.MainFrm.RTCObj.GetConst("BAA77E7E-38E7-44C5-A3DD-243896EA653E",new IDVariant("Scegli un documento da caricare (max dim. |1):"),true),new IDVariant(u),null,null,null,null,null).stringValue()}else{if(!(IDL.IsNull(this.Value))){J=this.Parent.Parent.bQueries(0).GetBlobData(this.Parent.Index,this.Value.intValue())}if(J!=null&&J.Size>16){var l=this.Parent.Parent.FrIndex.toString();if(l.length<2){l="0"+l}var I="";if(this.Parent.Parent.Parent.ParentSuf!=null||this.Parent.Parent.Parent.ParentBox!=null){I="form_"+this.Parent.Parent.Parent.FormIdx+":"}if(J.FileName.startsWith("blob:")){q.SetAttribute("url",J.FileName)}else{q.SetAttribute("url",this.Parent.Parent.MainFrm.UrlForEnc(Glb.ITEM_BLOB,I+l+J.BlobNum))}q.SetAttribute("mty",J.MimeType);if(J.ToDownload){if(J.isText()){q.SetAttribute("mim","text");this.Parent.Parent.bQueries(0).WriteTextBlob(J.BlobNum,null);u=J.FileName}else{if(J.FileName.length==0){this.Parent.Parent.bQueries(0).SaveBlobFile(J.BlobNum,this.Parent.Parent.MainFrm)}if(J.isImage()){q.SetAttribute("mim","image");u=J.FileName}else{q.SetAttribute("mim",J.MimeType);u=J.FileName}}}else{q.SetAttribute("mim","size");u="";if(J.Size<1024){u=J.Size+" byte"}else{if(J.Size<1048576){u=(Math.floor(J.Size/1024))+" KB"}else{u=(Math.floor(J.Size/1048576))+" MB"}}u=IDL.FormatMessage(this.Parent.Parent.MainFrm.RTCObj.GetConst("B1AC743E-369F-4F50-A80C-F0ABE2850DDF",new IDVariant("Click per aprire il documento (|1)"),true),new IDVariant(u),null,null,null,null,null).stringValue();u='<img style="border:none" src="images/blob.gif" alt=""> '+u}}else{q.SetAttribute("mim","empty");u=""}}}else{var n=this.VisualStyle==-1?this.Parent.VisualStyle:this.VisualStyle;var o=(this.Parent.Parent.MainFrm.BrowserInfo(false)==1&&this.Parent.Parent.MainFrm.BrowserInfo(true)<10)||(this.Parent.Parent.MainFrm.BrowserInfo(false)==3&&this.Parent.Parent.MainFrm.BrowserInfo(true)<6);if(this.Parent.Parent.Status()==Glb.PS_QBE&&u.length==0&&!o&&this.Parent.ValueList!=null&&this.Parent.ValueList.Count()>0&&this.Parent.Parent.VS.ControlType(n)==Glb.VISCTRL_CHECK){q.SetAttribute("txt","---");break}if(u.length==0&&L){break}if(((this.Parent.Flags&Glb.FLD_AUTOLOOKUP)!=0||(this.Parent.ValueList!=null&&this.Parent.ValueList.Count()>0))&&!(this.Parent.Parent.Status()==Glb.PS_QBE&&this.Parent.iMultiCriteria)){u=this.Value.toString();if(!this.Parent.Parent.MainFrm.UseDecimalDot()&&(this.Value.Type==IDVariant.DECIMAL||this.Value.Type==IDVariant.FLOAT)){u=u.replace(".",",")}}else{var f=(this.VisualStyle==-1)?this.Parent.VisualStyle:this.VisualStyle;var g=(this.Parent.Parent.VS.Flags(f)&Glb.FL_VIS_PASSWORD)!=0;if(g){if(u.length>0){u="********"}}else{var e=this.Parent.Parent.VS.Mask(f);var z=true;if(!this.DynMask.equals("")){e=this.DynMask;z=false}else{if(!this.Parent.Mask.equals("")){e=this.Parent.Mask;z=false}}if(!e.equals("=")&&this.Parent.EditorType!=1){var v=new IDVariant();var C=new IDVariant();var r=new IDVariant();this.Parent.GetClientMask(v,C,this.Value,e,this.Text,r,this.DynText,z);u=v.stringValue()}if(this.Parent.Parent.MainFrm!=null){var K=this.Parent.Parent.MainFrm.BrowserClass;if(K==Glb.BRWCLS_FIREFOX||K==Glb.BRWSCL_SAFARI){u=u.replace(/\r\n/g,"\n")}}}}}q.SetAttribute("txt",u);break;case RD3Glb.VAL_ERRORTEXT:if(this.ErrorText.length==0&&L){break}q.SetAttribute("err",this.ErrorText);break;case RD3Glb.VAL_ERRORTYPE:if(this.GetErrorType()==0&&L){break}q.SetAttribute("ety",this.GetErrorType().toString());break;case RD3Glb.VAL_ENABLED:if(this.Enabled==-1&&L){break}q.SetAttribute("ena",this.Enabled.toString());break;case RD3Glb.VAL_VISIBLE:if(this.Visible==-1&&L){break}q.SetAttribute("vis",this.Visible.toString());break;case RD3Glb.VAL_VISUALSTYLE:if(this.VisualStyle==-1&&L){break}q.SetAttribute("sty",(this.VisualStyle==-1?this.VisualStyle:this.Parent.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle)).toString());break;case RD3Glb.VAL_TOOLTIP:if(this.Tooltip.length==0&&L){break}q.SetAttribute("tip",this.Tooltip);break;case RD3Glb.VAL_INDEX:var m=this.Parent.Parent.bQueries(0).GetAttRecNumber();if(m==0||this.Parent.Parent.Status()==Glb.PS_QBE){m=1}q.SetAttribute("idx",(m+this.Index).toString());break;case RD3Glb.VAL_ROWSEL:if(this.Parent.Index!=0){break}var a=this.Parent.Parent.IsRowInError(this.Index)?this.Parent.Parent.CanAddErrMsg(this.Index,IDPanelSrv.EM_FIELD):false;var G=false;var M=false;if(!a){if(this.Parent.Parent.Status()==Glb.PS_UPDATE){G=this.Parent.Parent.IsRowModified(this.Index)}else{var F=this.Parent.Parent.GetDocument(this.Index);if(F!=null){G=F.IsModified()}}}if(this.Parent.Parent.Status()!=Glb.PS_UPDATE){var F=this.Parent.Parent.GetDocument(this.Index);if(F!=null){M=F.Inserted()}}var B=0;if(a){B=M?3:1}else{if(G){B=M?4:2}}q.SetAttribute("rse",B.toString());var H=this.Parent.Parent.Queries[0].IDColl;if(L&&H!=null&&H.UIMode()&&this.Parent.Parent.EnableMultipleSel()&&((this.Parent.Parent.Flags&Glb.PAN_HASLIST)!=0)){var F=this.Parent.Parent.GetDocument(this.Index);if(F!=null){var E=this.Parent.Parent.MainFrm.RD3AddEvent("mulsel",this.Parent.Parent.GetRD3Ident());E.SetAttribute("row",(this.Parent.Parent.Queries[0].GetAttRecNumber()+this.Index).toString());E.SetAttribute("value",F.Selected()?"1":"0");E.CanSendInFulltree=true}}break;case RD3Glb.VAL_VALUELIST:var k=null;var h=0;if(this.LkeRS!=null){k=this.LkeRS;h=1}if((this.Parent.Flags&Glb.FLD_AUTOLOOKUP)!=0){h=2}if(h==0&&!L){for(var A=0;A<this.Parent.Parent.UQueries();A++){if(this.Parent.Parent.bQueries(A).FieldIndex==this.Parent.Index){this.Parent.QueryValueSource=this.Parent.Parent.bQueries(A);h=3;break}}}if(h==0&&L){break}var D=q.AddNewElement("vls");D.SetAttribute("typ",h.toString());switch(h){case 1:this.Parent.Parent.bQueries(this.Parent.IdxPanel).GetLKEValues(this.Parent.Parent.MainFrm,this.Parent.CanActivate(this.Index),this,D);break;case 2:this.Parent.QueryValueSource.GetValueSource(this.Parent.Parent.MainFrm,this.Index,this.Value,Glb.ClassDT(this.Parent.DataType)==Glb.DTC_CHAR,this.Parent.IsEnabled(this.Index),false,D);break;case 3:this.Parent.QueryValueSource.GetValueSource(this.Parent.Parent.MainFrm,this.Index,this.Value,Glb.ClassDT(this.Parent.DataType)==Glb.DTC_CHAR,false,false,D);this.Parent.QueryValueSource=null;break}break;case RD3Glb.VAL_BACKCOLOR:if(this.BackColor==-2&&L){break}q.SetAttribute("bkc",(this.BackColor==-2?"":Glb.GetWebColor(this.BackColor)));break;case RD3Glb.VAL_FORECOLOR:if(this.ForeColor==-2&&L){break}q.SetAttribute("frc",(this.ForeColor==-2?"":Glb.GetWebColor(this.ForeColor)));break;case RD3Glb.VAL_MASK:if(this.DynMask.length==0&&L){break}q.SetAttribute("msk",this.DynMask);break;case RD3Glb.VAL_FONTMOD:if(this.FontMod.length==0&&L){break}q.SetAttribute("ftm",this.FontMod);break;case RD3Glb.VAL_ALIGN:if(this.Alignment==-1&&L){break}q.SetAttribute("aln",this.Alignment.toString());break;case RD3Glb.VAL_BADGE:if(this.Badge.length==0&&L){break}q.SetAttribute("bdg",this.Badge);break;case RD3Glb.VAL_CLASS:if(this.CSSClass.length==0&&L){break}q.SetAttribute("cln",this.CSSClass);break}};function PVLItemSrv(){this.Value;this.Name;this.Description;this.Image;this.iGuid;this.Parent;this.VisIdx=-1;this.OrigName=""}PVLItemSrv.prototype.RD3RenderDifference=function(c,e,a){var d=c.AddNewElement("vli");if(this.Name!=null&&this.Name.length>0){d.SetAttribute("txt",this.Name)}if(this.Value!=null&&this.Value.stringValue().length>0){var b=this.Value.stringValue();if(!a.UseDecimalDot()&&(this.Value.Type==IDVariant.DECIMAL||this.Value.Type==IDVariant.FLOAT)){b=b.replace(".",",")}d.SetAttribute("val",b)}if(this.Description!=null&&this.Description.length>0){d.SetAttribute("tip",this.Description)}if(this.Image!=null&&this.Image.length>0){d.SetAttribute("img",this.Image)}if(this.VisIdx!=-1){d.SetAttribute("sty",a.VisualStyleList.GetTrueIdx(this.VisIdx).toString())}return true};function RD3EventSrv(){this.Name;this.Ident;this.DontSend=false;this.CanSendInFulltree=false;this.Attributes=null}RD3EventSrv.prototype.SetAttribute=function(a,b){if(this.Attributes==null){this.Attributes=new HashTableSrv()}this.Attributes[a]=b};RD3EventSrv.prototype.Send=function(e,f){if(f==undefined){f=false}if((f&&!this.CanSendInFulltree)||this.DontSend){return null}var g=e.AddNewElement(this.Name);g.SetAttribute("id",this.Ident);if(this.Attributes!=null){var d=this.Attributes.keys();for(var c=0;c<d.length;c++){var b=d[c];var a=this.Attributes[b];g.SetAttribute(b,a)}}return g};function RD3Glb(){}RD3Glb.EVENT_CLIENTSIDE=1;RD3Glb.EVENT_SERVERSIDE=2;RD3Glb.EVENT_IMMEDIATE=4;RD3Glb.EVENT_BLOCKING=8;RD3Glb.EVENT_URGENT=15;RD3Glb.EVENT_ACTIVE=7;RD3Glb.EVENT_DEFERRED=3;RD3Glb.BORDER_NONE=1;RD3Glb.BORDER_THIN=2;RD3Glb.BORDER_THICK=3;RD3Glb.KEYS_ENTERESC=1;RD3Glb.KEYS_MOVEMENT=2;RD3Glb.KEYS_ALPHANUMERICAL=4;RD3Glb.WEP_CAPTION=0;RD3Glb.WEP_REFRESHINT=1;RD3Glb.WEP_WIDGETMODE=2;RD3Glb.WEP_ACTIVEFORM=3;RD3Glb.WEP_USEDECIMALDOT=4;RD3Glb.WEP_WELCOME=5;RD3Glb.WEP_DEBUGTYPE=6;RD3Glb.WEP_HELPFILE=7;RD3Glb.WEP_IMAGE=8;RD3Glb.WEP_CMDPROMPT=9;RD3Glb.WEP_PROGRESSFILE=10;RD3Glb.WEP_ENTRYPOINT=11;RD3Glb.WEP_ENABLEGFX=12;RD3Glb.WEP_MENUTYPE=13;RD3Glb.WEP_ENABLESND=14;RD3Glb.WEP_SHOWLOGOFF=15;RD3Glb.WEP_REFRESHLOC=16;RD3Glb.WEP_MENUWIDTH=17;RD3Glb.WEP_ACCENTCOLOR=18;RD3Glb.WEP_DEVICEMOTION=19;RD3Glb.WEP_VISPROP=20;RD3Glb.WEP_SECCOLOR=21;RD3Glb.WEP_DANGERCOLOR=22;RD3Glb.WEP_LIGHTCOLOR=23;RD3Glb.WEP_DARKCOLOR=24;RD3Glb.WEP_BRIGHTCOLOR=25;RD3Glb.WEP_VIBRANTCOLOR=26;RD3Glb.WEP_RTCRESET=27;RD3Glb.WEP_MAXPROP=28;RD3Glb.VIS_CONTROLTYPE=0;RD3Glb.VIS_MASK=1;RD3Glb.VIS_ROWOFFSET=2;RD3Glb.VIS_FLAGS=3;RD3Glb.VIS_LETTERSPACING=4;RD3Glb.VIS_WORDSPACING=5;RD3Glb.VIS_HORIZONTALSCALE=6;RD3Glb.VIS_DERIVED=7;RD3Glb.VIS_CURSOR=8;RD3Glb.VIS_HEADOFFSET=9;RD3Glb.VIS_CLASSNAME=10;RD3Glb.VIS_CLASSHEADER=11;RD3Glb.VIS_MAXPROP=12;RD3Glb.CMH_SUPPRMENU=0;RD3Glb.CMH_MAXPROP=1;RD3Glb.CMD_IDXFORM=0;RD3Glb.CMD_CAPTION=1;RD3Glb.CMD_TOOLTIP=2;RD3Glb.CMD_IDX=3;RD3Glb.CMD_EXPANDED=4;RD3Glb.CMD_LEVEL=5;RD3Glb.CMD_ISMENU=6;RD3Glb.CMD_ISTOOLBAR=7;RD3Glb.CMD_SHOWNAMES=8;RD3Glb.CMD_REQUIRECONFIRMATION=9;RD3Glb.CMD_TOOLNAME=10;RD3Glb.CMD_IMAGE=11;RD3Glb.CMD_CONFIRMTEXT=12;RD3Glb.CMD_ENABLED=13;RD3Glb.CMD_VISIBLE=14;RD3Glb.CMD_TOOLCONT=15;RD3Glb.CMD_FKNUM=16;RD3Glb.CMD_CMDCODE=17;RD3Glb.CMD_WIDTH=18;RD3Glb.CMD_TOOLHL=19;RD3Glb.CMD_ACCELL=20;RD3Glb.CMD_FORMLIST=21;RD3Glb.CMD_CANDRAG=22;RD3Glb.CMD_CANDROP=23;RD3Glb.CMD_BADGE=24;RD3Glb.CMD_CLASS=25;RD3Glb.CMD_MAXPROP=26;RD3Glb.IND_IDXFORM=0;RD3Glb.IND_WIDTH=1;RD3Glb.IND_TOOLTIP=2;RD3Glb.IND_STYLE=3;RD3Glb.IND_ENABLED=4;RD3Glb.IND_VISIBLE=5;RD3Glb.IND_TEXT=6;RD3Glb.IND_IMAGE=7;RD3Glb.IND_ALIGN=8;RD3Glb.IND_MAXPROP=9;RD3Glb.TIM_IDXFORM=0;RD3Glb.TIM_NUMTICKS=1;RD3Glb.TIM_INTERVAL=2;RD3Glb.TIM_ENABLED=3;RD3Glb.TIM_MAXPROP=4;RD3Glb.FRM_IDXFORM=0;RD3Glb.FRM_CAPTION=1;RD3Glb.FRM_MODAL=2;RD3Glb.FRM_DOCKED=3;RD3Glb.FRM_DOCKTYPE=4;RD3Glb.FRM_VISIBLE=5;RD3Glb.FRM_TOOLBARPOS=6;RD3Glb.FRM_WINSTATE=7;RD3Glb.FRM_FORMLEFT=8;RD3Glb.FRM_FORMTOP=9;RD3Glb.FRM_FORMWIDTH=10;RD3Glb.FRM_FORMHEIGHT=11;RD3Glb.FRM_RESMODEW=12;RD3Glb.FRM_RESMODEH=13;RD3Glb.FRM_PREVIEW=14;RD3Glb.FRM_BORDERTYPE=15;RD3Glb.FRM_VISPROP=16;RD3Glb.FRM_IMAGE=17;RD3Glb.FRM_WEBCAPTION=18;RD3Glb.FRM_BACKBUTTXT=19;RD3Glb.FRM_CLOSEONSEL=20;RD3Glb.FRM_CLASSNAME=21;RD3Glb.FRM_RELATEDTO=22;RD3Glb.FRM_RELATEPOS=23;RD3Glb.FRM_MAXPROP=24;RD3Glb.AFR_CAPTION=0;RD3Glb.AFR_VERTICAL=1;RD3Glb.AFR_WIDTH=2;RD3Glb.AFR_HEIGHT=3;RD3Glb.AFR_MINWIDTH=4;RD3Glb.AFR_MINHEIGHT=5;RD3Glb.AFR_MAXWIDTH=6;RD3Glb.AFR_MAXHEIGHT=7;RD3Glb.AFR_FRHIDDEN=8;RD3Glb.AFR_USESMALLICON=9;RD3Glb.AFR_CHILD1=10;RD3Glb.AFR_CHILD2=11;RD3Glb.AFR_FRBORDER=12;RD3Glb.AFR_ORGWIDTH=13;RD3Glb.AFR_ORGHEIGHT=14;RD3Glb.AFR_CLASSNAME=15;RD3Glb.AFR_MAXPROP=16;RD3Glb.WFR_VISIBLE=1;RD3Glb.WFR_COLLAPSED=2;RD3Glb.WFR_COLLAPSABLE=3;RD3Glb.WFR_LOCKED=4;RD3Glb.WFR_LOCKABLE=5;RD3Glb.WFR_IMAGE=6;RD3Glb.WFR_SHOWSCROLLBAR=7;RD3Glb.WFR_DRAG=8;RD3Glb.WFR_DROP=9;RD3Glb.WFR_MAXPROPS=10;RD3Glb.PAN_PANELMODE=0;RD3Glb.PAN_STATUS=1;RD3Glb.PAN_NUMROWS=2;RD3Glb.PAN_MAXHROW=3;RD3Glb.PAN_PANELPAGE=4;RD3Glb.PAN_HEADERSIZE=5;RD3Glb.PAN_SHOWROWSELECTOR=6;RD3Glb.PAN_SHOWMULTIPLESEL=7;RD3Glb.PAN_ENABLEMULTIPLESEL=8;RD3Glb.PAN_DYNAMICROWS=9;RD3Glb.PAN_DYNAMICHEIGHT=10;RD3Glb.PAN_HASSCROLLBAR=11;RD3Glb.PAN_HASLIST=12;RD3Glb.PAN_HASFORM=13;RD3Glb.PAN_CANUPDATE=14;RD3Glb.PAN_CANDELETE=15;RD3Glb.PAN_CANINSERT=16;RD3Glb.PAN_CANSEARCH=17;RD3Glb.PAN_CANSORT=18;RD3Glb.PAN_LISTLEFT=19;RD3Glb.PAN_LISTTOP=20;RD3Glb.PAN_LISTWIDTH=21;RD3Glb.PAN_LISTHEIGHT=22;RD3Glb.PAN_ACTUALROW=23;RD3Glb.PAN_VRESMODE=24;RD3Glb.PAN_HRESMODE=25;RD3Glb.PAN_VISUALSTYLE=26;RD3Glb.PAN_FIXEDCOLS=27;RD3Glb.PAN_QBETIP=28;RD3Glb.PAN_SHOWTOOLBAR=29;RD3Glb.PAN_SHOWSTATUSBAR=30;RD3Glb.PAN_ACTUALPOSITION=31;RD3Glb.PAN_TOTALROWS=32;RD3Glb.PAN_ENABLEDCOMMANDS=33;RD3Glb.PAN_HASBOOK=34;RD3Glb.PAN_MASTER=35;RD3Glb.PAN_ADVTAB=36;RD3Glb.PAN_ACTIVATERIGHTCLICK=37;RD3Glb.PAN_INFOMSG=38;RD3Glb.PAN_SINGLEDOC=39;RD3Glb.PAN_CONFIRMDEL=40;RD3Glb.PAN_CMDBLOCK=41;RD3Glb.PAN_REORDERCOLUMN=42;RD3Glb.PAN_RESIZECOLUMN=43;RD3Glb.PAN_SENDGROUPS=44;RD3Glb.PAN_GROUPING=45;RD3Glb.PAN_SHOWGROUPUI=46;RD3Glb.PAN_HLDELETE=47;RD3Glb.PAN_SELALLONLYVIS=48;RD3Glb.PAN_TIPONEACHROW=49;RD3Glb.PAN_ENABLEINSERTLOCKED=50;RD3Glb.PAN_HASDOCTEMPLATE=51;RD3Glb.PAN_VISPROP=52;RD3Glb.PAN_LOADPOL=53;RD3Glb.PAN_PULLREF=54;RD3Glb.PAN_EXTENABLEDCOMMANDS=55;RD3Glb.PAN_ENLISTQBE=56;RD3Glb.PAN_FLUIDPANEL=57;RD3Glb.PAN_ROWHEIGTHRES=58;RD3Glb.PAN_MAXPROPS=59;RD3Glb.FLD_INDEX=0;RD3Glb.FLD_VISIBLE=1;RD3Glb.FLD_ENABLED=2;RD3Glb.FLD_VISATTR=3;RD3Glb.FLD_LISTLIST=4;RD3Glb.FLD_CANACTIVATE=5;RD3Glb.FLD_OPTIONAL=6;RD3Glb.FLD_IMAGE=7;RD3Glb.FLD_HEADER=8;RD3Glb.FLD_TOOLTIP=9;RD3Glb.FLD_PAGE=10;RD3Glb.FLD_GROUP=11;RD3Glb.FLD_DATATYPE=12;RD3Glb.FLD_MAXLENGTH=13;RD3Glb.FLD_SORTMODE=14;RD3Glb.FLD_INLIST=15;RD3Glb.FLD_LISTHEADER=16;RD3Glb.FLD_HDRLIST=17;RD3Glb.FLD_HDRLISTABOVE=18;RD3Glb.FLD_LISTLEFT=19;RD3Glb.FLD_LISTTOP=20;RD3Glb.FLD_LISTWIDTH=21;RD3Glb.FLD_LISTHEIGHT=22;RD3Glb.FLD_LISTNUMROWS=23;RD3Glb.FLD_LISTHRESMODE=24;RD3Glb.FLD_LISTVRESMODE=25;RD3Glb.FLD_LISTHDRSIZE=26;RD3Glb.FLD_INFORM=27;RD3Glb.FLD_FORMHEADER=28;RD3Glb.FLD_HDRFORM=29;RD3Glb.FLD_HDRFORMABOVE=30;RD3Glb.FLD_FORMLEFT=31;RD3Glb.FLD_FORMTOP=32;RD3Glb.FLD_FORMWIDTH=33;RD3Glb.FLD_FORMHEIGHT=34;RD3Glb.FLD_FORMNUMROWS=35;RD3Glb.FLD_FORMHRESMODE=36;RD3Glb.FLD_FORMVRESMODE=37;RD3Glb.FLD_FORMHDRSIZE=38;RD3Glb.FLD_IDXPANEL=39;RD3Glb.FLD_SUBFRAME=40;RD3Glb.FLD_VALUELIST=41;RD3Glb.FLD_ACTWIDTH=42;RD3Glb.FLD_ACTIMAGE=43;RD3Glb.FLD_TABORDER=44;RD3Glb.FLD_QVS=45;RD3Glb.FLD_EDITORTYPE=46;RD3Glb.FLD_SCALE=47;RD3Glb.FLD_CMDIDX=48;RD3Glb.FLD_CAUSEVALIDATION=49;RD3Glb.FLD_ACTIVABLEDISABLED=50;RD3Glb.FLD_CANSORT=51;RD3Glb.FLD_LKE=52;RD3Glb.FLD_QBEENAB=53;RD3Glb.FLD_SUPERACTIVE=54;RD3Glb.FLD_USEHL=55;RD3Glb.FLD_VISPROP=56;RD3Glb.FLD_UNBOUND=57;RD3Glb.FLD_COMBOMULTISEL=58;RD3Glb.FLD_BACKCOLOR=59;RD3Glb.FLD_FORECOLOR=60;RD3Glb.FLD_FONTMOD=61;RD3Glb.FLD_MASK=62;RD3Glb.FLD_ALIGN=63;RD3Glb.FLD_USETEXTSELECTION=64;RD3Glb.FLD_WATERMARK=65;RD3Glb.FLD_IMGRESMODE=66;RD3Glb.FLD_OPENCOMBO=67;RD3Glb.FLD_BADGE=68;RD3Glb.FLD_EDCOLORS=69;RD3Glb.FLD_EDFONTS=70;RD3Glb.FLD_EDTOKENS=71;RD3Glb.FLD_EDTOOLBAR=72;RD3Glb.FLD_EDCOMMANDS=73;RD3Glb.FLD_DEFFORMAT=74;RD3Glb.FLD_CLASSNAME=75;RD3Glb.FLD_POSDIMPERC=76;RD3Glb.FLD_QBEFILTER=77;RD3Glb.FLD_QBESENDCOMBO=78;RD3Glb.FLD_OPENQBEFILTERPOPUP=79;RD3Glb.FLD_ROWBREAKBEFORE=80;RD3Glb.FLD_MAXPROPS=81;RD3Glb.VAL_TEXT=0;RD3Glb.VAL_ERRORTEXT=1;RD3Glb.VAL_ERRORTYPE=2;RD3Glb.VAL_ENABLED=3;RD3Glb.VAL_VISIBLE=4;RD3Glb.VAL_VISUALSTYLE=5;RD3Glb.VAL_TOOLTIP=6;RD3Glb.VAL_INDEX=7;RD3Glb.VAL_ROWSEL=8;RD3Glb.VAL_VALUELIST=9;RD3Glb.VAL_BACKCOLOR=10;RD3Glb.VAL_FORECOLOR=11;RD3Glb.VAL_FONTMOD=12;RD3Glb.VAL_MASK=13;RD3Glb.VAL_ALIGN=14;RD3Glb.VAL_BADGE=15;RD3Glb.VAL_CLASS=16;RD3Glb.VAL_MAXPROPS=17;RD3Glb.PPG_STYLE=0;RD3Glb.PPG_VISUALSTYLE=1;RD3Glb.PPG_FLAGS=2;RD3Glb.PPG_IMAGE=3;RD3Glb.PPG_HEADER=4;RD3Glb.PPG_TOOLTIP=5;RD3Glb.PPG_INDEX=6;RD3Glb.PPG_BADGE=7;RD3Glb.PPG_MAXPROPS=8;RD3Glb.PGR_PAGE=0;RD3Glb.PGR_VISUALSTYLE=1;RD3Glb.PGR_FLAGS=2;RD3Glb.PGR_IMAGE=3;RD3Glb.PGR_HEADER=4;RD3Glb.PGR_TOOLTIP=5;RD3Glb.PGR_LISTLEFT=6;RD3Glb.PGR_LISTTOP=7;RD3Glb.PGR_LISTWIDTH=8;RD3Glb.PGR_LISTHEIGTH=9;RD3Glb.PGR_FORMLEFT=10;RD3Glb.PGR_FORMTOP=11;RD3Glb.PGR_FORMWIDTH=12;RD3Glb.PGR_FORMHEIGHT=13;RD3Glb.PGR_FORMHDRPOS=14;RD3Glb.PGR_LISTHDERPOS=15;RD3Glb.PGR_HEADERHEIGHT=16;RD3Glb.PGR_HEADERWIDTH=17;RD3Glb.PGR_INLIST=18;RD3Glb.PGR_COLLAPSIBLE=19;RD3Glb.PGR_COLLAPSED=20;RD3Glb.PGR_CLASSNAME=21;RD3Glb.PGR_MAXPROPS=22;RD3Glb.MSG_CODE=0;RD3Glb.MSG_TEXT=1;RD3Glb.MSG_ICON=2;RD3Glb.MSG_TYPE=3;RD3Glb.MSG_TEMPORARY=4;RD3Glb.MSG_MAXPROPS=5;RD3Glb.TBV_SELECTEDTAB=0;RD3Glb.TBV_PLACEMENT=1;RD3Glb.TBV_HIDDENTABS=2;RD3Glb.TBV_AUTOSIZE=3;RD3Glb.TBV_MAXPROPS=4;RD3Glb.TAB_CONTENT=0;RD3Glb.TAB_IMAGE=1;RD3Glb.TAB_HEADER=2;RD3Glb.TAB_TOOLTIP=3;RD3Glb.TAB_STYLE=4;RD3Glb.TAB_BADGE=5;RD3Glb.TAB_MAXPROPS=6;RD3Glb.BBR_CMDSETIDX=0;RD3Glb.BBR_VERTICAL=1;RD3Glb.BBR_MAXPROPS=2;RD3Glb.TRE_SELECTEDNODE=0;RD3Glb.TRE_SELECTMULTI=1;RD3Glb.TRE_DRAGANDDROP=2;RD3Glb.TRE_ACTIVATEONEXPAND=3;RD3Glb.TRE_CTXMENUIDX=4;RD3Glb.TRE_ENABLED=5;RD3Glb.TRE_CHECKACTIVE=6;RD3Glb.TRE_MAXPROPS=7;RD3Glb.TRN_ALREADYEXPANDED=0;RD3Glb.TRN_EXPANDED=1;RD3Glb.TRN_CAPTION=2;RD3Glb.TRN_TOOLTIP=3;RD3Glb.TRN_IMAGE=4;RD3Glb.TRN_CANCHECK=5;RD3Glb.TRN_SELECTED=6;RD3Glb.TRN_BADGE=7;RD3Glb.TRN_CLASSNAME=8;RD3Glb.TRN_MAXPROPS=9;RD3Glb.BOK_SHOWTOOLBAR=0;RD3Glb.BOK_SHOWSTATUSBAR=1;RD3Glb.BOK_PAGENUM=2;RD3Glb.BOK_PAGETOTAL=3;RD3Glb.BOK_PAGECONFIRMED=4;RD3Glb.BOK_HIDEBORDER=5;RD3Glb.BOK_ENABLEDCOMMANDS=6;RD3Glb.BOK_CACHESIZE=7;RD3Glb.BOK_FIXEDWIDTH=8;RD3Glb.BOK_FIXEDHEIGHT=9;RD3Glb.BOK_SCROLLDIR=10;RD3Glb.BOK_FORCESNAP=11;RD3Glb.BOK_OPTIMIZEDOM=12;RD3Glb.BOK_MAXPROPS=13;RD3Glb.PAG_PAGENUM=0;RD3Glb.PAG_UM=1;RD3Glb.PAG_WIDTH=2;RD3Glb.PAG_HEIGHT=3;RD3Glb.PAG_FITMODE=4;RD3Glb.PAG_MAXPROPS=5;RD3Glb.BOX_XPOS=0;RD3Glb.BOX_YPOS=1;RD3Glb.BOX_WIDTH=2;RD3Glb.BOX_HEIGHT=3;RD3Glb.BOX_VISATTR=4;RD3Glb.BOX_IMAGE=5;RD3Glb.BOX_INTERLINE=6;RD3Glb.BOX_STRETCH=7;RD3Glb.BOX_VISIBLE=8;RD3Glb.BOX_CANDRAG=9;RD3Glb.BOX_CANDROP=10;RD3Glb.BOX_CANTRANSFORM=11;RD3Glb.BOX_CANSCROLL=12;RD3Glb.BOX_TOOLTIP=13;RD3Glb.BOX_GRAPHFILE=14;RD3Glb.BOX_GRAPHMAP=15;RD3Glb.BOX_CANCLICK=16;RD3Glb.BOX_VISPROP=17;RD3Glb.BOX_SUBFORM=18;RD3Glb.BOX_BACKCOLOR=19;RD3Glb.BOX_FORECOLOR=20;RD3Glb.BOX_ALIGN=21;RD3Glb.BOX_FONTMOD=22;RD3Glb.BOX_BADGE=23;RD3Glb.BOX_CLASSNAME=24;RD3Glb.BOX_VALIGN=25;RD3Glb.BOX_MAXPROPS=26;RD3Glb.SPN_TEXT=1;RD3Glb.SPN_VALUE=2;RD3Glb.SPN_VISATTR=3;RD3Glb.SPN_MAXLEN=4;RD3Glb.SPN_VISIBLE=5;RD3Glb.SPN_ENABLED=6;RD3Glb.SPN_STRETCH=7;RD3Glb.SPN_TOOLTIP=8;RD3Glb.SPN_MIME=9;RD3Glb.SPN_HASIMAGE=10;RD3Glb.SPN_VALUELIST=11;RD3Glb.SPN_DATATYPE=12;RD3Glb.SPN_SCALE=13;RD3Glb.SPN_BACKCOLOR=14;RD3Glb.SPN_FORECOLOR=15;RD3Glb.SPN_FONTMOD=16;RD3Glb.SPN_MASK=17;RD3Glb.SPN_WATERMARK=18;RD3Glb.SPN_CLASSNAME=19;RD3Glb.SPN_MAXPROPS=20;RD3Glb.SEC_XPOS=0;RD3Glb.SEC_YPOS=1;RD3Glb.SEC_WIDTH=2;RD3Glb.SEC_HEIGHT=3;RD3Glb.SEC_VISATTR=4;RD3Glb.SEC_VISIBLE=5;RD3Glb.SEC_NUMCOL=6;RD3Glb.SEC_COLSPACE=7;RD3Glb.SEC_MASTRO=8;RD3Glb.SEC_RECNUM=9;RD3Glb.SEC_OVERLAY=10;RD3Glb.SEC_CLASSNAME=11;RD3Glb.SEC_MAXPROPS=12;RD3Glb.GRA_LIBRARY=0;RD3Glb.GRA_FILE=1;RD3Glb.GRA_CODICE=2;RD3Glb.GRA_MAP=3;RD3Glb.GRA_SWF=4;RD3Glb.GRA_HEIGHT=5;RD3Glb.GRA_WIDTH=6;RD3Glb.GRA_ACTIVE=7;RD3Glb.GRA_ERRTXT=8;RD3Glb.GRA_EDITOR=9;RD3Glb.GRA_MAXPROPS=10;RD3Glb.SUF_HEIGHT=0;RD3Glb.SUF_WIDTH=1;RD3Glb.SUF_MAXPROPS=2;RD3Glb.VOICE_LISTENING=0;RD3Glb.VOICE_RESPONSE=1;RD3Glb.VOICE_SAY=2;RD3Glb.VOICE_MAXPROPS=3;RD3Glb.WEP_OBJ_SUPPRESSMENU=1;RD3Glb.WEP_OBJ_MAINCAPTION=2;RD3Glb.WEP_OBJ_HELPBUTTON=3;RD3Glb.WEP_OBJ_DEBUGBUTTON=4;RD3Glb.WEP_OBJ_CLOSEAPP=5;RD3Glb.WEP_OBJ_STARTBUTTON=6;RD3Glb.WEP_OBJ_CMDINPUT=7;RD3Glb.WEP_OBJ_FORMLIST=8;RD3Glb.WEP_OBJ_CLOSEALL=9;RD3Glb.SCZ_POSITION=0;RD3Glb.SCZ_TABVISIBILITY=1;RD3Glb.SCZ_SHOWPIN=2;RD3Glb.SCZ_ZONESTATE=3;RD3Glb.SCZ_SELECTEDFORM=4;RD3Glb.SCZ_ZONESIZE=5;RD3Glb.SCZ_VERTICALBEHAVIOUR=6;RD3Glb.SCZ_TABPOSITION=7;RD3Glb.SCZ_HASMENU=8;RD3Glb.SCZ_SWIPEMODE=9;RD3Glb.SCZ_MAXPROPS=10;function RolesSrv(a){this.iRoles;this.glbRole=new IDVariant();this.glbUser=new IDVariant();this.glbCompanyID="";this.glbDomainID="";this.glbAutLevel=0;this.glbLanguage=".";this.glbGroup=0;this.glbUserID=0;this.AlreadyInit;this.ActiveRoleCollection=new ArrayList();this.MainFrm=a}RolesSrv.prototype.InitRoles=function(){};RolesSrv.prototype.EnableRole=function(g,e,b){var j;var a;var h=false;for(var d=0;d<this.ActiveRoleCollection.Count();d++){a=this.ActiveRoleCollection[d];if(a.equals(g)){h=true;if(!e){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",115,"Roles.EnableRole","Removed role "+g.ToString())}this.ActiveRoleCollection.Remove(a)}break}}if(e&&!h){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",115,"Roles.EnableRole","Added role "+g.ToString())}this.ActiveRoleCollection.Add(g);if(this.glbRole.Type==IDVariant.NULL){this.glbRole.set(g)}}if(b){var k=new ArrayList(this.MainFrm.StackForm);for(var d=0;d<k.Count();d++){j=k[d];this.MainFrm.UnloadForm(j.FormIdx,false)}this.MainFrm.CmdObj.ResetRoles(this.MainFrm);this.ApplyRoles(0,null)}};RolesSrv.prototype.ApplyRoles=function(c,e){var g=new ArrayList();var k=new ArrayList();for(var b=0;b<this.ActiveRoleCollection.Count();b++){var l=this.ActiveRoleCollection[b];for(var d=0;d<this.iRoles.length;d++){if(this.iRoles[d]==null){continue}if(l.stringValue().equals(this.iRoles[d].Code.stringValue())){g.Add(this.iRoles[d]);var f=(this.MainFrm.RTCObj.Enabled&&c==0&&this.MainFrm.GetCompList().Count()>0);if(!f){break}}}}if(g.Count()==0){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",116,"Roles.ApplyRoles","None of the roles set by the user have been found in the defined roles list")}this.glbRole=new IDVariant();return}for(var d=0;d<g.Count();d++){var l=g[d];var a=l.Parent;while(a!=null){if(g.IndexOf(a)==-1&&k.IndexOf(a)==-1){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",109,"Roles.ApplyRoles","Adding parent role "+a.Code+" while applying role "+l.Code)}k.Add(a)}a=a.Parent}}g.AddRange(k);for(var j=g.Count()-1;j>=0;j--){var l=g[j];l.Apply(c,e,this.MainFrm)}if(c==0){for(var d=0;d<this.MainFrm.GetCompList().Count();d++){var h=this.MainFrm.GetCompList()[d];if(h.RolObj!=h.CompOwner.RolObj){h.RolObj.ApplyRoles(0,e)}}}};RolesSrv.prototype.CheckRole=function(){return this.glbRole.Type!=IDVariant.NULL};RolesSrv.prototype.ConfigureRoles=function(c,f){this.iRoles=new Array[c.RecordCount()];var d=0;try{while(!c.EOF()){this.iRoles[d]=new ARoleSrv();this.iRoles[d].Code=c.Get("RTC_Value");this.iRoles[d].iGuid=c.Get("RTC_Guid").stringValue();d++;c.MoveNext()}d=0;c.MoveFirst();while(!c.EOF()){var a=c.Get("RTC_Parent").stringValue();for(b=0;b<this.iRoles.length;b++){if(this.iRoles[b].iGuid.equals(a)){this.iRoles[d].Parent=iRoles[b];break}}d++;c.MoveNext()}var b=0;while(!f.EOF()){var a=f.Get("RTC_Parent").stringValue();if(b>=this.iRoles.length||!iRoles[b].iGuid.equals(a)){for(b=0;b<this.iRoles.length;b++){if(this.iRoles[b].iGuid.equals(a)){break}}}if(b<this.iRoles.length){var g=0;g|=(f.Get("RTC_Enabled").stringValue().equals("Y")?Glb.OBJ_ENABLED:0);g|=(f.Get("RTC_Visible").stringValue().equals("Y")?Glb.OBJ_VISIBLE:0);g|=(f.Get("RTC_CanUpdate").stringValue().equals("Y")?Glb.PAN_CANUPDATE:0);g|=(f.Get("RTC_CanInsert").stringValue().equals("Y")?Glb.PAN_CANINSERT:0);g|=(f.Get("RTC_CanDelete").stringValue().equals("Y")?Glb.PAN_CANDELETE:0);g|=(f.Get("RTC_CanSelect").stringValue().equals("Y")?Glb.PAN_CANSELECT:0);this.iRoles[b].AddRTCItem(f.Get("RTC_Object").stringValue(),f.Get("RTC_ObjForm").stringValue(),f.Get("RTC_ParentFrame").stringValue(),f.Get("RTC_ItemType").intValue(),g)}f.MoveNext()}}catch(h){this.MainFrm.DTTObj.AddException("","Rolws.ConfigureRoles","Exception while configuring roles",h)}};RolesSrv.prototype.Clear=function(){var c=new ArrayList(this.ActiveRoleCollection);for(var a=0;a<c.Count();a++){var b=c[a];this.EnableRole(b,false,false)}};function RTCData(b,a){this.RSPanels;this.RSPanelFields;this.RSPanelGroups;this.RSForm;this.RSTabbeds;this.RSGraphs;this.RSTrees;this.RSTreeItems;this.RSButtonBars;this.RSBooks;this.RSMastros;this.RSBoxes;this.RSSpans;this.RSReports;this.RSSections;this.RSSubForms;this.Parent=b;this.iGuid=a}RTCData.prototype.ConfigureFrame=function(d,a,k){try{if(a.Get("RTC_Name").Type!=IDVariant.NULL){d.set_Caption(a.Get("RTC_Name").stringValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){d.Description=a.Get("RTC_Description").stringValue()}var b=k?"RTC_FrameHiddenBorder":"RTC_HiddenBorder";if(a.findColumn(b)!=-1&&a.Get(b).Type!=IDVariant.NULL){d.FrHidden=a.Get(b).stringValue().equals("Y")}if(a.Get("RTC_FrameBorder").Type!=IDVariant.NULL){d.FrBorder=a.Get("RTC_FrameBorder").stringValue().equals("Y")}if(a.findColumn("RTC_UseSmallIcon")!=-1&&a.Get("RTC_UseSmallIcon").Type!=IDVariant.NULL){d.set_PUseSmallIcon(a.Get("RTC_UseSmallIcon").stringValue().equals("Y"))}if(a.Get("RTC_Height").intValue()>0){d.FixedHeight=a.Get("RTC_Height").intValue()}if(a.Get("RTC_FixedWidth").stringValue().equals("Y")){if(a.Get("RTC_Width").intValue()>0){d.FixedWidth=a.Get("RTC_Width").intValue()}}if(d.TabIdx!=0&&d.Parent!=null&&d.Parent.Frames!=null&&d.TabIdx<d.Parent.Frames.length){var h=d.Parent.Frames[d.TabIdx].Content;var j=h.FindFrame(d);if(j>0){var c=h.ItemList[j];c.Header=d.Caption;c.RD3Change(RD3Glb.TAB_HEADER);c.Tooltip=d.Description;c.RD3Change(RD3Glb.TAB_TOOLTIP)}}}catch(g){}};RTCData.prototype.Load=function(a){this.RSPanels=this.Parent.LoadRS("Panels",a);this.RSPanelFields=this.Parent.LoadRS("PanelFields",a);this.RSPanelGroups=this.Parent.LoadRS("PanelGroups",a);this.RSForm=this.Parent.LoadRS("Forms",a);this.RSTabbeds=this.Parent.LoadRS("Tabbeds",a);this.RSGraphs=this.Parent.LoadRS("Graphs",a);this.RSTrees=this.Parent.LoadRS("Trees",a);this.RSTreeItems=this.Parent.LoadRS("TreeItems",a);this.RSBooks=this.Parent.LoadRS("Books",a);this.RSMastros=this.Parent.LoadRS("TemplatePages",a);this.RSBoxes=this.Parent.LoadRS("RptBoxes",a);this.RSSpans=this.Parent.LoadRS("RptSpans",a);this.RSReports=this.Parent.LoadRS("Reports",a);this.RSSections=this.Parent.LoadRS("Sections",a);this.RSButtonBars=this.Parent.LoadRS("ButtonBars",a);this.RSSubForms=this.Parent.LoadRS("SubForm",a)};RTCData.prototype.Reset=function(){try{this.RSPanels.MoveFirst();this.RSPanelFields.MoveFirst();this.RSPanelGroups.MoveFirst();this.RSForm.MoveFirst();this.RSTabbeds.MoveFirst();this.RSGraphs.MoveFirst();this.RSTrees.MoveFirst();this.RSTreeItems.MoveFirst();this.RSBooks.MoveFirst();this.RSMastros.MoveFirst();this.RSBoxes.MoveFirst();this.RSSpans.MoveFirst();this.RSReports.MoveFirst();this.RSSections.MoveFirst();this.RSButtonBars.MoveFirst();this.RSSubForms.MoveFirst()}catch(a){}};RTCData.prototype.ConfigureBook=function(l,r,n){try{var a=this.RSBooks;if(this.Parent.SearchObject(a,r.BookObj.GetRTCGuid(0))){if(r.BookObj.FrIndex()!=-1){this.ConfigureFrame(l.Frames[r.BookObj.FrIndex()],this.RSBooks,true)}if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){r.Collapsed=a.Get("RTC_Collapsed").stringValue().equals("Y")}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){r.Visible=a.Get("RTC_Visible").stringValue().equals("Y")}if(a.Get("RTC_ShowStatusBar").stringValue().length>0){r.ShowStatusBar=a.Get("RTC_ShowStatusBar").stringValue().equals("Y")}if(a.Get("RTC_ShowToolBar").stringValue().length>0){r.ShowToolbar=a.Get("RTC_ShowToolBar").stringValue().equals("Y")}if(a.Get("RTC_Width").intValue()>0){r.Width=a.Get("RTC_Width").intValue()}if(a.Get("RTC_Height").intValue()>0){r.Height=a.Get("RTC_Height").intValue()}if(a.Get("RTC_PrecountPages").Type!=IDVariant.NULL){r.BookObj.SetFlags(0,(a.Get("RTC_PrecountPages").stringValue().equals("Y")?1048576:0),1048576)}if(a.Get("RTC_HiddenBorder").Type!=IDVariant.NULL){r.BookObj.set_HideBorder(a.Get("RTC_HiddenBorder").stringValue().equals("Y"))}if(a.Get("RTC_CanDrag").Type!=IDVariant.NULL){r.set_CanDrag(a.Get("RTC_CanDrag").stringValue().equals("Y"))}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){r.set_CanDrop(a.Get("RTC_CanDrop").stringValue().equals("Y"))}}var o;var v;for(var k=1;k<r.BookObj.GetNumObjects();k++){var g=r.BookObj.GetObjType(k);switch(g){case IDREGlb.OBJ_MASTRO:var u=this.RSMastros;if(this.Parent.SearchObject(u,r.BookObj.GetRTCGuid(k))){r.BookObj.UpdateMastro(k,u.Get("RTC_Dim1"),u.Get("RTC_Dim2"),u.Get("RTC_UM"),u.Get("RTC_Orientation"),u.Get("RTC_FitMode"))}break;case IDREGlb.OBJ_RPTBOX:var c=this.RSBoxes;if(this.Parent.SearchObject(c,r.BookObj.GetRTCGuid(k))){o=0;o|=(c.Get("RTC_Visible").stringValue().equals("Y")?65536:0);o|=(c.Get("RTC_ShowPreview").stringValue().equals("Y")?131072:0);o|=(c.Get("RTC_ShowPrint").stringValue().equals("Y")?262144:0);o|=(c.Get("RTC_KeepTogether").stringValue().equals("Y")?524288:0);o|=(c.Get("RTC_CloseBorder").stringValue().equals("Y")?1048576:0);o|=(c.Get("RTC_OmitZero").stringValue().equals("Y")?2097152:0);o|=(c.Get("RTC_OmitDupl").stringValue().equals("Y")?4194304:0);o|=(c.Get("RTC_CanDrag").stringValue().equals("Y")?8388608:0);o|=(c.Get("RTC_CanDrop").stringValue().equals("Y")?16777216:0);o|=(c.Get("RTC_CanTrans").stringValue().equals("Y")?33554432:0);o|=(c.Get("RTC_CanScroll").stringValue().equals("Y")?67108864:0);v=0;v|=(c.Get("RTC_Visible").Type!=IDVariant.NULL?65536:0);v|=(c.Get("RTC_ShowPreview").Type!=IDVariant.NULL?131072:0);v|=(c.Get("RTC_ShowPrint").Type!=IDVariant.NULL?262144:0);v|=(c.Get("RTC_KeepTogether").Type!=IDVariant.NULL?524288:0);v|=(c.Get("RTC_CloseBorder").Type!=IDVariant.NULL?1048576:0);v|=(c.Get("RTC_OmitZero").Type!=IDVariant.NULL?2097152:0);v|=(c.Get("RTC_OmitDupl").Type!=IDVariant.NULL?4194304:0);v|=(c.Get("RTC_CanDrag").Type!=IDVariant.NULL?8388608:0);v|=(c.Get("RTC_CanDrop").Type!=IDVariant.NULL?16777216:0);v|=(c.Get("RTC_CanTrans").Type!=IDVariant.NULL?33554432:0);v|=(c.Get("RTC_CanScroll").Type!=IDVariant.NULL?67108864:0);var t=r.BookObj.BoxVisProp(k);if(c.Get("RTC_ResW").Type!=IDVariant.NULL){if(c.Get("RTC_ResW").stringValue().equals("N")){t&=~1}else{t|=1}}if(c.Get("RTC_ResH").Type!=IDVariant.NULL){if(c.Get("RTC_ResH").stringValue().equals("N")){t&=~2}else{t|=2}}if(c.Get("RTC_MoveX").Type!=IDVariant.NULL){if(c.Get("RTC_MoveX").stringValue().equals("N")){t&=~4}else{t|=4}}if(c.Get("RTC_MoveY").Type!=IDVariant.NULL){if(c.Get("RTC_MoveY").stringValue().equals("N")){t&=~8}else{t|=8}}if(c.Get("RTC_CancelMove").Type!=IDVariant.NULL){if(c.Get("RTC_CancelMove").stringValue().equals("N")){t&=~16}else{t|=16}}var s=(c.Get("RTC_VisualStyle").Type!=IDVariant.NULL?n.VisualStyleList.GetVS(c.Get("RTC_VisualStyle").stringValue()):null);if(r.Parent.MainFrm.CompOwner!=null){s=r.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(r.Parent.MainFrm,s)}r.BookObj.UpdateRptBox(k,c.Get("RTC_Box1"),c.Get("RTC_Box2"),c.Get("RTC_Box3"),c.Get("RTC_Box4"),c.Get("RTC_Interline"),c.Get("RTC_HResMode"),c.Get("RTC_VResMode"),s,o,v,c.Get("RTC_Description"),c.Get("RTC_StretchMode"),t);if(c.Get("RTC_Icon").stringValue().length>0){r.BookObj.SetBoxImage(k,null,c.Get("RTC_Icon").stringValue())}if(c.Get("RTC_BackColor").Type!=IDVariant.NULL){r.BookObj.set_BoxBackgroundColor(k,c.Get("RTC_BackColor").intValue())}if(c.Get("RTC_ForeColor").Type!=IDVariant.NULL){r.BookObj.set_BoxForegroundColor(k,c.Get("RTC_ForeColor").intValue())}if(c.Get("RTC_Align").Type!=IDVariant.NULL){r.BookObj.set_BoxAlignment(k,c.Get("RTC_Align").intValue())}if(c.Get("RTC_VAlign").Type!=IDVariant.NULL){r.BookObj.set_BoxVAlignment(k,c.Get("RTC_VAlign").intValue())}if(c.Get("RTC_FontMod").Type!=IDVariant.NULL){r.BookObj.set_BoxFontModifiers(k,c.Get("RTC_FontMod").stringValue())}}break;case IDREGlb.OBJ_RPTSPAN:var h=this.RSSpans;if(this.Parent.SearchObject(h,r.BookObj.GetRTCGuid(k))){o=0;o|=(h.Get("RTC_Visible").stringValue().equals("Y")?268435456:0);o|=(h.Get("RTC_Enabled").stringValue().equals("Y")?536870912:0);o|=(h.Get("RTC_Active").stringValue().equals("Y")?1073741824:0);v=0;v|=(h.Get("RTC_Visible").Type!=IDVariant.NULL?268435456:0);v|=(h.Get("RTC_Enabled").Type!=IDVariant.NULL?536870912:0);v|=(h.Get("RTC_Active").Type!=IDVariant.NULL?1073741824:0);var s=(h.Get("RTC_VisualStyle").Type!=IDVariant.NULL?n.VisualStyleList.GetVS(h.Get("RTC_VisualStyle").stringValue()):null);if(r.Parent.MainFrm.CompOwner!=null){s=r.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(r.Parent.MainFrm,s)}r.BookObj.UpdateRptSpan(k,s,h.Get("RTC_DataType"),h.Get("RTC_Length"),h.Get("RTC_Scale"),o,v,h.Get("RTC_SpanTooltip"),h.Get("RTC_SpanValue"),h.Get("RTC_StretchMode"));if(h.Get("RTC_Mask").Type!=IDVariant.NULL){r.BookObj.set_SpanMask(k,h.Get("RTC_Mask").stringValue())}if(h.Get("RTC_Watermark").Type!=IDVariant.NULL){r.BookObj.set_SpanWatermark(k,h.Get("RTC_Watermark").stringValue())}if(h.Get("RTC_BackColor").stringValue().length>0){r.BookObj.set_SpanBackgroundColor(k,h.Get("RTC_BackColor").intValue())}if(h.Get("RTC_ForeColor").stringValue().length>0){r.BookObj.set_SpanForegroundColor(k,h.Get("RTC_ForeColor").intValue())}if(h.Get("RTC_FontMod").stringValue().length>0){r.BookObj.set_SpanFontModifiers(k,h.Get("RTC_FontMod").stringValue())}}break;case IDREGlb.OBJ_REPORT:var q=this.RSReports;if(this.Parent.SearchObject(q,r.BookObj.GetRTCGuid(k))){o=0;o|=(q.Get("RTC_HideIfEmpty").stringValue().equals("Y")?65536:0);o|=(q.Get("RTC_Visible").stringValue().equals("Y")?131072:0);o|=(q.Get("RTC_AnyPage").stringValue().equals("Y")?262144:0);v=0;v|=(q.Get("RTC_HideIfEmpty").Type!=IDVariant.NULL?65536:0);v|=(q.Get("RTC_Visible").Type!=IDVariant.NULL?131072:0);v|=(q.Get("RTC_AnyPage").Type!=IDVariant.NULL?262144:0);r.BookObj.UpdateReport(k,o,v)}break;case IDREGlb.OBJ_SECTION:var d=this.RSSections;if(this.Parent.SearchObject(d,r.BookObj.GetRTCGuid(k))){o=0;o|=(d.Get("RTC_Visible").stringValue().equals("Y")?65536:0);o|=(d.Get("RTC_NewPageAfter").stringValue().equals("Y")?131072:0);o|=(d.Get("RTC_NewPageBefore").stringValue().equals("Y")?262144:0);o|=(d.Get("RTC_KeepTogether").stringValue().equals("Y")?524288:0);o|=(d.Get("RTC_KeepWithNext").stringValue().equals("Y")?1048576:0);o|=(d.Get("RTC_HideIfEmpty").stringValue().equals("Y")?2097152:0);o|=(d.Get("RTC_VerticalColumns").stringValue().equals("Y")?4194304:0);o|=(d.Get("RTC_ShowChildren").stringValue().equals("Y")?8388608:0);o|=(d.Get("RTC_Overlay").stringValue().equals("Y")?16777216:0);o|=(d.Get("RTC_Showonnewpage").stringValue().equals("Y")?33554432:0);o|=(d.Get("RTC_Showatboxbottom").stringValue().equals("Y")?67108864:0);v=0;v|=(d.Get("RTC_Visible").Type!=IDVariant.NULL?65536:0);v|=(d.Get("RTC_NewPageAfter").Type!=IDVariant.NULL?131072:0);v|=(d.Get("RTC_NewPageBefore").Type!=IDVariant.NULL?262144:0);v|=(d.Get("RTC_KeepTogether").Type!=IDVariant.NULL?524288:0);v|=(d.Get("RTC_KeepWithNext").Type!=IDVariant.NULL?1048576:0);v|=(d.Get("RTC_HideIfEmpty").Type!=IDVariant.NULL?2097152:0);v|=(d.Get("RTC_VerticalColumns").Type!=IDVariant.NULL?4194304:0);v|=(d.Get("RTC_ShowChildren").Type!=IDVariant.NULL?8388608:0);v|=(d.Get("RTC_Overlay").Type!=IDVariant.NULL?16777216:0);v|=(d.Get("RTC_Showonnewpage").Type!=IDVariant.NULL?33554432:0);v|=(d.Get("RTC_Showatboxbottom").Type!=IDVariant.NULL?67108864:0);var s=(d.Get("RTC_VisualStyle").Type!=IDVariant.NULL?n.VisualStyleList.GetVS(d.Get("RTC_VisualStyle").stringValue()):null);if(r.Parent.MainFrm.CompOwner!=null){s=r.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(r.Parent.MainFrm,s)}r.BookObj.UpdateSection(k,d.Get("RTC_Height"),d.Get("RTC_NumCol"),d.Get("RTC_ColSpace"),s,o,v)}break}}}catch(m){}};RTCData.prototype.ConfigureButtonBar=function(b,g,d){try{var a=this.RSButtonBars;if(this.Parent.SearchObject(a,g.iGuid)){this.ConfigureFrame(b.Frames[g.FrIndex],a);if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){g.Collapsed=a.Get("RTC_Collapsed").stringValue().equals("Y")}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){g.Visible=a.Get("RTC_Visible").stringValue().equals("Y")}if(a.Get("RTC_Width").Type!=IDVariant.NULL){g.Vertical=a.Get("RTC_Width").intValue()<a.Get("RTC_Height").intValue()}}}catch(c){}};RTCData.prototype.ConfigureGraph=function(b,g,d){try{var a=this.RSGraphs;if(this.Parent.SearchObject(a,g.iGuid)){if(g.FrIndex!=-1){this.ConfigureFrame(b.Frames[g.FrIndex],a)}if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){g.Collapsed=a.Get("RTC_Collapsed").stringValue().equals("Y")}if(a.Get("RTC_NumColumns").Type!=IDVariant.NULL){g.set_NumSeries(a.Get("RTC_NumColumns").intValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){g.set_Title(a.Get("RTC_Description").stringValue())}if(a.Get("RTC_GraphType").Type!=IDVariant.NULL){g.set_ChartType(a.Get("RTC_GraphType").intValue())}if(a.Get("RTC_NameX").Type!=IDVariant.NULL){g.set_LabelAxisX(a.Get("RTC_NameX").stringValue())}if(a.Get("RTC_NameY").Type!=IDVariant.NULL){g.set_LabelAxisY(a.Get("RTC_NameY").stringValue())}if(a.Get("RTC_LegType").Type!=IDVariant.NULL){g.set_Legenda(a.Get("RTC_LegType").intValue())}if(a.Get("RTC_VStyle").stringValue().length>0){var h=d.VisualStyleList.GetVS(a.Get("RTC_VStyle").stringValue());if(g.Parent.MainFrm.CompOwner!=null){h=g.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(g.Parent.MainFrm,h)}if(h>0){g.set_VisualStyleChart(h)}}if(a.Get("RTC_XAxis").Type!=IDVariant.NULL){g.set_AxisXVisible(a.Get("RTC_XAxis").stringValue().equals("Y"))}if(a.Get("RTC_YAxis").Type!=IDVariant.NULL){g.set_AxisYVisible(a.Get("RTC_YAxis").stringValue().equals("Y"))}if(a.Get("RTC_XGrid").Type!=IDVariant.NULL){g.set_GridXVisible(a.Get("RTC_XGrid").stringValue().equals("Y"))}if(a.Get("RTC_YGrid").Type!=IDVariant.NULL){g.set_GridYVisible(a.Get("RTC_YGrid").stringValue().equals("Y"))}if(a.Get("RTC_Active").Type!=IDVariant.NULL){g.set_Hyperlink(a.Get("RTC_Active").stringValue().equals("Y"),true)}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){g.Visible=a.Get("RTC_Visible").stringValue().equals("Y")}}}catch(c){}};RTCData.prototype.ConfigureTree=function(d,j,h){try{var c=this.RSTrees;var b=this.RSTreeItems;if(this.Parent.SearchObject(c,j.iGuid)){this.ConfigureFrame(d.Frames[j.FrIndex],c);if(c.Get("RTC_Visible").Type!=IDVariant.NULL){j.Visible=c.Get("RTC_Visible").stringValue().equals("Y")}if(c.Get("RTC_Collapsed").Type!=IDVariant.NULL){j.Collapsed=c.Get("RTC_Collapsed").stringValue().equals("Y")}if(c.Get("RTC_Width").intValue()>0){j.Width=c.Get("RTC_Width").intValue()-Glb.PAN_OFFS_X}if(c.Get("RTC_Height").intValue()>0){j.Height=c.Get("RTC_Height").intValue()-Glb.PAN_OFFS_Y}if(c.Get("RTC_Active").Type!=IDVariant.NULL){j.set_IsActive(c.Get("RTC_Active").stringValue().equals("Y"))}if(c.Get("RTC_CanDrag").Type!=IDVariant.NULL){j.set_CanDrag(c.Get("RTC_CanDrag").stringValue().equals("Y"))}if(c.Get("RTC_CanDrop").Type!=IDVariant.NULL){j.set_CanDrop(c.Get("RTC_CanDrop").stringValue().equals("Y"))}}for(var a=1;a<j.ItemList.length;a++){if(this.Parent.SearchObject(b,j.GetItem(a).iGuid)){if(b.Get("RTC_Icon").Type!=IDVariant.NULL){j.GetItem(a).Image=b.Get("RTC_Icon").stringValue()}if(b.Get("RTC_Name").Type!=IDVariant.NULL){j.GetItem(a).Name=b.Get("RTC_Name").stringValue()}if(b.Get("RTC_Description").Type!=IDVariant.NULL){j.GetItem(a).Tooltip=b.Get("RTC_Description").stringValue()}if(b.Get("RTC_Tooltip").Type!=IDVariant.NULL){j.GetItem(a).HasTooltip=b.Get("RTC_Tooltip").stringValue().equals("Y")}}}}catch(g){}};RTCData.prototype.ConfigureTabbed=function(b,g,d){try{var a=this.RSTabbeds;if(this.Parent.SearchObject(a,g.iGuid)){this.ConfigureFrame(b.Frames[g.FrIndex],a);if(a.Get("RTC_Orientation").Type!=IDVariant.NULL){g.Placement=a.Get("RTC_Orientation").intValue()}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){g.Visible=a.Get("RTC_Visible").stringValue().equals("Y")}if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){g.Collapsed=a.Get("RTC_Collapsed").stringValue().equals("Y")}if(a.Get("RTC_AutoSize").Type!=IDVariant.NULL){g.AutoSize=a.Get("RTC_AutoSize").stringValue().equals("Y")}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){g.HiddenTabs=a.Get("RTC_HiddenTabs").stringValue().equals("Y")}if(a.Get("RTC_CanDrag").Type!=IDVariant.NULL){g.set_CanDrag(a.Get("RTC_CanDrag").stringValue().equals("Y"))}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){g.set_CanDrop(a.Get("RTC_CanDrop").stringValue().equals("Y"))}}}catch(c){}};RTCData.prototype.ConfigurePanel=function(G,z,k){try{var B=this.RSPanels;var A=this.RSPanelFields;var I=this.RSPanelGroups;if(this.Parent.SearchObject(B,z.GetRTCGuid(Glb.OBJ_PANEL,0))){if(z.FrIndex!=-1){this.ConfigureFrame(G.Frames[z.FrIndex],B)}if(B.Get("RTC_Width").intValue()>0){z.SetRect(Glb.OBJ_RECT,0,0,0,0,B.Get("RTC_Width").intValue()-Glb.PAN_OFFS_X,B.Get("RTC_Height").intValue()-Glb.PAN_OFFS_Y,0,0)}z.SetRect(Glb.OBJ_PANEL,0,0,B.Get("RTC_ListDim1"),B.Get("RTC_ListDim2"),B.Get("RTC_ListDim3"),B.Get("RTC_ListDim4"),B.Get("RTC_ListHResMode"),B.Get("RTC_ListVResMode"));if(B.Get("RTC_ListDim5").Type!=IDVariant.NULL){z.SetHeaderSize(Glb.OBJ_PANEL,0,0,B.Get("RTC_ListDim5").intValue())}if(B.Get("RTC_InitStatus").Type!=IDVariant.NULL){z.InitStatus=B.Get("RTC_InitStatus").intValue()}if(B.Get("RTC_Icon").stringValue().length>0){z.SetImage(Glb.OBJ_PANEL,0,0,B.Get("RTC_Icon").stringValue().trim());if(z.Parent!=null&&z.Parent.Frames[z.FrIndex].InTabbed&&z.Parent.Frames[z.Parent.Frames[z.FrIndex].TabIdx]!=null){var n=z.Parent.Frames[z.Parent.Frames[z.FrIndex].TabIdx].Content;var d=n.ItemList[z.Parent.Frames[z.FrIndex].TabIdx];d.Image=z.iImage;d.RD3Change(RD3Glb.TAB_IMAGE)}}if(B.Get("RTC_QBEForm").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_QBEForm").stringValue().equals("Y")?Glb.PAN_QBEFORM:0),Glb.PAN_QBEFORM)}if(B.Get("RTC_ScrollRecords").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_ScrollRecords").stringValue().equals("Y")?Glb.PAN_SCROLLREC:0),Glb.PAN_SCROLLREC)}if(B.Get("RTC_HasForm").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_HasForm").stringValue().equals("Y")?Glb.PAN_HASFORM:0),Glb.PAN_HASFORM)}if(B.Get("RTC_HasList").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_HasList").stringValue().equals("Y")?Glb.PAN_HASLIST:0),Glb.PAN_HASLIST)}if(B.Get("RTC_StartForm").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_StartForm").stringValue().equals("Y")?Glb.PAN_STARTFORM:0),Glb.PAN_STARTFORM)}if(B.Get("RTC_CanUpdate").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_CanUpdate").stringValue().equals("Y")?Glb.PAN_CANUPDATE:0),Glb.PAN_CANUPDATE)}if(B.Get("RTC_CanDelete").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_CanDelete").stringValue().equals("Y")?Glb.PAN_CANDELETE:0),Glb.PAN_CANDELETE)}if(B.Get("RTC_CanInsert").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_CanInsert").stringValue().equals("Y")?Glb.PAN_CANINSERT:0),Glb.PAN_CANINSERT)}if(B.Get("RTC_CanSelect").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_CanSelect").stringValue().equals("Y")?Glb.PAN_CANSELECT:0),Glb.PAN_CANSELECT)}if(B.Get("RTC_CanSort").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_CanSort").stringValue().equals("Y")?Glb.PAN_CANSORT:0),Glb.PAN_CANSORT)}if(B.Get("RTC_AutoSave").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PANEL,0,(B.Get("RTC_AutoSave").stringValue().equals("Y")?Glb.PAN_AUTOSAVE:0),Glb.PAN_AUTOSAVE)}if(B.Get("RTC_Lockable").stringValue().length>0){z.Lockable=B.Get("RTC_Lockable").stringValue().equals("Y")}if(B.Get("RTC_Locked").stringValue().length>0){z.iLocked=B.Get("RTC_Locked").stringValue().equals("Y")}if(B.Get("RTC_ShowInfoMessages").stringValue().length>0){z.ShowInfoMessages=B.Get("RTC_ShowInfoMessages").stringValue().equals("Y")}if(B.Get("RTC_ShowToolBar").Type!=IDVariant.NULL){z.ShowToolbar=B.Get("RTC_ShowToolBar").stringValue().equals("Y")}if(B.Get("RTC_ShowStatusBar").Type!=IDVariant.NULL){z.ShowStatusbar=B.Get("RTC_ShowStatusBar").stringValue().equals("Y")}if(B.Get("RTC_ShowRowSelector").Type!=IDVariant.NULL){z.ShowRowSelector=B.Get("RTC_ShowRowSelector").stringValue().equals("Y")}if(B.Get("RTC_DynamicRows").stringValue().length>0){z.SetDynRows(B.Get("RTC_DynamicRows").intValue(),B.Get("RTC_VariableHeight").stringValue().equals("Y"))}if(B.Get("RTC_Enabled").Type!=IDVariant.NULL){z.Enabled=B.Get("RTC_Enabled").stringValue().equals("Y")?1:0}if(B.Get("RTC_Visible").Type!=IDVariant.NULL){z.Visible=B.Get("RTC_Visible").stringValue().equals("Y")}if(B.Get("RTC_Collapsed").Type!=IDVariant.NULL){z.Collapsed=B.Get("RTC_Collapsed").stringValue().equals("Y")}z.SetFlags(Glb.OBJ_PANEL,0,(z.Visible)?Glb.OBJ_VISIBLE:0,Glb.OBJ_VISIBLE);if(B.Get("RTC_EnableMultiSel").stringValue().length>0){z.iEnableMultipleSel=B.Get("RTC_EnableMultiSel").stringValue().Equals("Y")}if(B.Get("RTC_ShowMultiSel").stringValue().length>0){z.iShowMultipleSel=B.Get("RTC_ShowMultiSel").stringValue().Equals("Y")}if(B.Get("RTC_ConfDelete").stringValue().length>0){z.ConfirmDelete=B.Get("RTC_ConfDelete").stringValue().Equals("Y")}if(B.Get("RTC_VStyle").stringValue().length>0){var C=k.VisualStyleList.GetVS(B.Get("RTC_VStyle").stringValue());if(z.Parent.MainFrm.CompOwner!=null){C=z.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(z.Parent.MainFrm,C)}if(C>0){z.set_VisualStyle(Glb.OBJ_PANEL,0,C)}}if(B.Get("RTC_ReorderCols").Type!=IDVariant.NULL){z.set_CanReorderColumn(B.Get("RTC_ReorderCols").stringValue().equals("Y"))}if(B.Get("RTC_ResizeCols").Type!=IDVariant.NULL){z.set_CanResizeColumn(B.Get("RTC_ResizeCols").stringValue().equals("Y"))}if(B.Get("RTC_CanDrag").Type!=IDVariant.NULL){z.set_CanDrag(B.Get("RTC_CanDrag").stringValue().equals("Y"))}if(B.Get("RTC_CanDrop").Type!=IDVariant.NULL){z.set_CanDrop(B.Get("RTC_CanDrop").stringValue().equals("Y"))}if(B.Get("RTC_CanGroup").Type!=IDVariant.NULL&&z.iEnabledGrouping!=B.Get("RTC_CanGroup").stringValue().equals("Y")){z.set_GroupingEnabled(B.Get("RTC_CanGroup").stringValue().equals("Y"))}if(B.Get("RTC_ShowGroups").Type!=IDVariant.NULL&&z.iShowGroups!=B.Get("RTC_ShowGroups").stringValue().equals("Y")){z.set_ShowGroups(B.Get("RTC_ShowGroups").stringValue().equals("Y"))}if(B.Get("RTC_ResOnlyVis").Type!=IDVariant.NULL){z.ResOnlyVisFlds=B.Get("RTC_ResOnlyVis").stringValue().equals("Y")}}for(var E=0;E<z.UFields();E++){if(this.Parent.SearchObject(A,z.GetRTCGuid(Glb.OBJ_FIELD,E))){if(z.bFields(E).IdxPanel==-1&&A.Get("RTC_StaticWithTitle").intValue()!=-1){if(A.Get("RTC_Description").Type!=IDVariant.NULL){z.set_Header(Glb.OBJ_FIELD,E,A.Get("RTC_Description").stringValue())}}else{if(A.Get("RTC_Name").Type!=IDVariant.NULL){z.set_Header(Glb.OBJ_FIELD,E,A.Get("RTC_Name").stringValue())}if(A.Get("RTC_Description").Type!=IDVariant.NULL){z.set_ToolTip(Glb.OBJ_FIELD,E,A.Get("RTC_Description").stringValue())}}if(A.Get("RTC_ListHeader").Type!=IDVariant.NULL){z.SetAbbrHeader(Glb.OBJ_FIELD,E,Glb.PANEL_LIST,A.Get("RTC_ListHeader").stringValue())}if(A.Get("RTC_FormHeader").Type!=IDVariant.NULL){z.SetAbbrHeader(Glb.OBJ_FIELD,E,Glb.PANEL_FORM,A.Get("RTC_FormHeader").stringValue())}if(A.Get("RTC_DataType").Type!=IDVariant.NULL){z.bFields(E).DataType=A.Get("RTC_DataType").intValue()}if(A.Get("RTC_Length").Type!=IDVariant.NULL){z.bFields(E).MaxLength=A.Get("RTC_Length").intValue()}if(A.Get("RTC_Scale").Type!=IDVariant.NULL){z.bFields(E).vScale=A.Get("RTC_Scale").intValue()}if(A.Get("RTC_Icon").Type!=IDVariant.NULL){z.SetImage(Glb.OBJ_FIELD,E,0,A.Get("RTC_Icon").stringValue(),z.bFields(E).UseHilight)}var r=(A.Get("RTC_Pos1").Type!=IDVariant.NULL?A.Get("RTC_Pos1").intValue():z.bFields(E).ListLeft);var o=(A.Get("RTC_Pos2").Type!=IDVariant.NULL?A.Get("RTC_Pos2").intValue():z.bFields(E).ListTop);var s=(A.Get("RTC_Dim1").Type!=IDVariant.NULL?A.Get("RTC_Dim1").intValue():z.bFields(E).ListWidth);var F=(A.Get("RTC_Dim2").Type!=IDVariant.NULL?A.Get("RTC_Dim2").intValue():z.bFields(E).ListHeight);var J;if((z.bFields(E).Flags&Glb.FLD_INLIST)!=0&&(z.bFields(E).Flags&Glb.FLD_LISTLIST)!=0){J=0}else{J=(A.Get("RTC_Dim3").Type!=IDVariant.NULL?A.Get("RTC_Dim3").intValue():z.bFields(E).HeaderSize[Glb.PANEL_LIST]);if(A.Get("RTC_HdrHL").stringValue().equals("Y")){if(A.Get("RTC_HdrVL").stringValue().equals("Y")){o=o+J+4;F=F-J-4}else{r=r+J+4;s=s-J-4}}}z.SetRect(Glb.OBJ_FIELD,E,Glb.PANEL_LIST,new IDVariant(r),new IDVariant(o),new IDVariant(s),new IDVariant(F),A.Get("RTC_HResMode1"),A.Get("RTC_VResMode1"));z.SetHeaderSize(Glb.OBJ_FIELD,E,Glb.PANEL_LIST,J);r=(A.Get("RTC_Pos3").Type!=IDVariant.NULL?A.Get("RTC_Pos3").intValue():z.bFields(E).FormLeft);o=(A.Get("RTC_Pos4").Type!=IDVariant.NULL?A.Get("RTC_Pos4").intValue():z.bFields(E).FormTop);s=(A.Get("RTC_Dim4").Type!=IDVariant.NULL?A.Get("RTC_Dim4").intValue():z.bFields(E).FormWidth);F=(A.Get("RTC_Dim5").Type!=IDVariant.NULL?A.Get("RTC_Dim5").intValue():z.bFields(E).FormHeight);J=(A.Get("RTC_Dim6").Type!=IDVariant.NULL?A.Get("RTC_Dim6").intValue():z.bFields(E).HeaderSize[Glb.PANEL_FORM]);if(A.Get("RTC_HdrHF").stringValue().equals("Y")){if(A.Get("RTC_HdrVF").stringValue().equals("Y")){o=o+J+4;F=F-J-4}else{r=r+J+4;s=s-J-4}}z.SetRect(Glb.OBJ_FIELD,E,Glb.PANEL_FORM,new IDVariant(r),new IDVariant(o),new IDVariant(s),new IDVariant(F),A.Get("RTC_HResMode2"),A.Get("RTC_VResMode2"));z.SetHeaderSize(Glb.OBJ_FIELD,E,Glb.PANEL_FORM,J);var v=(A.Get("RTC_Visible").Type!=IDVariant.NULL?A.Get("RTC_Visible").stringValue().equals("Y"):(z.bFields(E).Flags&Glb.OBJ_VISIBLE));if(v){var u=(A.Get("RTC_InForm").Type!=IDVariant.NULL?A.Get("RTC_InForm").stringValue().equals("Y"):(z.bFields(E).Flags&Glb.FLD_INFORM));var q=(u&&(z.Flags&Glb.PAN_HASFORM)!=0);var c=(A.Get("RTC_InList").Type!=IDVariant.NULL?(A.Get("RTC_InList").stringValue().equals("Y")||A.Get("RTC_InList").stringValue().equals("L")):(z.bFields(E).Flags&Glb.FLD_INLIST));var g=(c&&(z.Flags&Glb.PAN_HASLIST)!=0);if(!q&&!g){v=false}}z.SetFlags(Glb.OBJ_FIELD,E,(v?Glb.OBJ_VISIBLE:0),Glb.OBJ_VISIBLE);if(A.Get("RTC_Enabled").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_Enabled").stringValue().equals("Y")?Glb.OBJ_ENABLED:0),Glb.OBJ_ENABLED)}if(A.Get("RTC_Vertical").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_Vertical").stringValue().equals("Y")?Glb.OBJ_VERTICAL:0),Glb.OBJ_VERTICAL)}if(A.Get("RTC_InForm").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_InForm").stringValue().equals("Y")?Glb.FLD_INFORM:0),Glb.FLD_INFORM)}if(A.Get("RTC_InList").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_InList").stringValue().equals("Y")||A.Get("RTC_InList").stringValue().equals("L")?Glb.FLD_INLIST:0),Glb.FLD_INLIST)}if(A.Get("RTC_InList").stringValue().equals("L")){z.SetFlags(Glb.OBJ_FIELD,E,Glb.FLD_LISTLIST,Glb.FLD_LISTLIST)}if(A.Get("RTC_HdrVF").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_HdrVF").stringValue().equals("Y")?Glb.FLD_VERTHDRFORM:0),Glb.FLD_VERTHDRFORM)}if(A.Get("RTC_HdrVL").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_HdrVL").stringValue().equals("Y")?Glb.FLD_VERTHDRLIST:0),Glb.FLD_VERTHDRLIST)}if(A.Get("RTC_HdrHF").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_HdrHF").stringValue().equals("Y")?Glb.FLD_NOHDRFORM:0),Glb.FLD_NOHDRFORM)}if(A.Get("RTC_HdrHL").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_HdrHL").stringValue().equals("Y")?Glb.FLD_NOHDRLIST:0),Glb.FLD_NOHDRLIST)}if(A.Get("RTC_IsOptional").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_IsOptional").stringValue().equals("Y")?Glb.FLD_ISOPT:0),Glb.FLD_ISOPT)}if(A.Get("RTC_NoActDis").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_FIELD,E,(A.Get("RTC_NoActDis").stringValue().equals("Y")?Glb.FLD_NOACTD:0),Glb.FLD_NOACTD)}if((z.Fields[E].Flags&Glb.FLD_INLIST)==0&&(z.Fields[E].Flags&Glb.FLD_LISTLIST)!=0){z.SetFlags(Glb.OBJ_FIELD,E,0,Glb.FLD_LISTLIST)}if(A.Get("RTC_VStyle").stringValue().length>0){var C=k.VisualStyleList.GetVS(A.Get("RTC_VStyle").stringValue());if(z.Parent.MainFrm.CompOwner!=null){C=z.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(z.Parent.MainFrm,C)}if(C>0){z.set_VisualStyle(Glb.OBJ_FIELD,E,C)}}if(A.Get("RTC_IsActive").Type!=IDVariant.NULL){z.SetFieldActive(E,A.Get("RTC_IsActive").stringValue().equals("Y"))}if(z.Fields[E].DataType==Glb.DT_DOC_OLE){z.SetFieldBlobSize(E,A.Get("RTC_MaxAutoShow"),A.Get("RTC_MaxUpload"),true)}if(A.Get("RTC_TabOrder1").Type!=IDVariant.NULL&&A.Get("RTC_TabOrder2").Type!=IDVariant.NULL){if(A.Get("RTC_TabOrder1").intValue()!=-1||A.Get("RTC_TabOrder2").intValue()!=-1){if(!z.IsAdvTabOrderEnabled()){z.InitTabOrder()}if(E==0||(z.Fields[E].Flags&Glb.FLD_INFORM)!=0||(z.Fields[E].Flags&Glb.FLD_INLIST)!=0){var l=A.Get("RTC_TabOrder1").intValue();if(l>z.UFields()){l=z.UFields()}var m=A.Get("RTC_TabOrder2").intValue();if(m>z.UFields()){m=z.UFields()}z.SetTabOrder(E,l,Glb.PANEL_FORM);z.SetTabOrder(E,m,Glb.PANEL_LIST)}}}if(A.Get("RTC_CanSort").Type!=IDVariant.NULL){z.Fields[E].set_VisualFlag(Glb.FLDVISPROP_CANSORT,A.Get("RTC_CanSort").stringValue().equals("Y"))}if(A.Get("RTC_AutoGroup").Type!=IDVariant.NULL){z.Fields[E].set_VisualFlag(Glb.FLDVISPROP_AUTOCLUSTER,A.Get("RTC_AutoGroup").stringValue().equals("Y"))}if(A.Get("RTC_OnEachKey").Type!=IDVariant.NULL){z.Fields[E].set_VisualFlag(Glb.FLDVISPROP_ONEACHKEY,A.Get("RTC_OnEachKey").stringValue().equals("Y"))}if(A.Get("RTC_OnlyIcon").Type!=IDVariant.NULL){z.Fields[E].set_VisualFlag(Glb.FLDVISPROP_ONLYICON,A.Get("RTC_OnlyIcon").stringValue().equals("Y"))}if(A.Get("RTC_ShowAct").Type!=IDVariant.NULL){z.Fields[E].set_VisualFlag(Glb.FLDVISPROP_SHOWACT,A.Get("RTC_ShowAct").stringValue().equals("Y"))}if(A.Get("RTC_BackColor").Type!=IDVariant.NULL){z.Fields[E].BackColor=(A.Get("RTC_BackColor").intValue()==-1?-2:A.Get("RTC_BackColor").intValue())}if(A.Get("RTC_ForeColor").Type!=IDVariant.NULL){z.Fields[E].ForeColor=(A.Get("RTC_ForeColor").intValue()==-1?-2:A.Get("RTC_ForeColor").intValue())}if(A.Get("RTC_Align").Type!=IDVariant.NULL){z.Fields[E].Alignment=(A.Get("RTC_Align").intValue()==1?-1:A.Get("RTC_Align").intValue())}if(A.Get("RTC_Mask").Type!=IDVariant.NULL){z.Fields[E].Mask=A.Get("RTC_Mask").stringValue()}if(A.Get("RTC_FontMod").Type!=IDVariant.NULL){z.Fields[E].FontMod=A.Get("RTC_FontMod").stringValue()}if(A.Get("RTC_Watermark").Type!=IDVariant.NULL){z.Fields[E].iWaterMark=A.Get("RTC_Watermark").stringValue()}if(A.Get("RTC_ResImg").Type!=IDVariant.NULL){z.Fields[E].ImageResMode=A.Get("RTC_ResImg").intValue()}if(A.Get("RTC_Hidden").Type!=IDVariant.NULL){z.Fields[E].set_VisualFlag(Glb.PFLVISPROP_HIDEINLIST,A.Get("RTC_Hidden").stringValue().equals("Y"))}if(A.Get("RTC_CanHide").Type!=IDVariant.NULL){z.Fields[E].set_VisualFlag(Glb.PFLVISPROP_CANHDEINLST,A.Get("RTC_CanHide").stringValue().equals("Y"))}}}for(var E=0;E<z.UPages();E++){if(this.Parent.SearchObject(I,z.GetRTCGuid(Glb.OBJ_PAGE,E))){if(I.Get("RTC_Name").Type!=IDVariant.NULL){z.set_Header(Glb.OBJ_PAGE,E,I.Get("RTC_Name").stringValue())}if(I.Get("RTC_Description").Type!=IDVariant.NULL){z.set_ToolTip(Glb.OBJ_PAGE,E,I.Get("RTC_Description").stringValue())}if(I.Get("RTC_Icon").Type!=IDVariant.NULL){z.SetImage(Glb.OBJ_PAGE,E,0,I.Get("RTC_Icon").stringValue())}if(I.Get("RTC_Visible").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PAGE,E,(I.Get("RTC_Visible").stringValue().equals("Y")?Glb.OBJ_VISIBLE:0),Glb.OBJ_VISIBLE)}if(I.Get("RTC_Enabled").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PAGE,E,(I.Get("RTC_Enabled").stringValue().equals("Y")?Glb.OBJ_ENABLED:0),Glb.OBJ_ENABLED)}if(I.Get("RTC_Vertical").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_PAGE,E,(I.Get("RTC_Vertical").stringValue().equals("Y")?Glb.OBJ_VERTICAL:0),Glb.OBJ_VERTICAL)}if(I.Get("RTC_VStyle").stringValue().length>0){var C=k.VisualStyleList.GetVS(I.Get("RTC_VStyle").stringValue());if(z.Parent.MainFrm.CompOwner!=null){C=k.VisualStyleList.GetTrueIdxInverse(z.Parent.MainFrm,C)}if(C>0){z.set_VisualStyle(Glb.OBJ_PAGE,E,C)}}}}for(var E=0;E<z.UGroups();E++){if(this.Parent.SearchObject(I,z.GetRTCGuid(Glb.OBJ_GROUP,E))){if(I.Get("RTC_Name").Type!=IDVariant.NULL){z.set_Header(Glb.OBJ_GROUP,E,I.Get("RTC_Name").stringValue())}if(I.Get("RTC_Description").Type!=IDVariant.NULL){z.set_ToolTip(Glb.OBJ_GROUP,E,I.Get("RTC_Description").stringValue())}if(I.Get("RTC_Icon").Type!=IDVariant.NULL){z.SetImage(Glb.OBJ_GROUP,E,0,I.Get("RTC_Icon").stringValue())}if(I.Get("RTC_HdrPos1").Type!=IDVariant.NULL){z.SetHeaderPos(Glb.OBJ_GROUP,E,Glb.PANEL_LIST,I.Get("RTC_HdrPos1").intValue())}if(I.Get("RTC_HdrPos2").Type!=IDVariant.NULL){z.SetHeaderPos(Glb.OBJ_GROUP,E,Glb.PANEL_FORM,I.Get("RTC_HdrPos2").intValue())}if(I.Get("RTC_Visible").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_GROUP,E,(I.Get("RTC_Visible").stringValue().equals("Y")?Glb.OBJ_VISIBLE:0),Glb.OBJ_VISIBLE)}if(I.Get("RTC_Enabled").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_GROUP,E,(I.Get("RTC_Enabled").stringValue().equals("Y")?Glb.OBJ_ENABLED:0),Glb.OBJ_ENABLED)}if(I.Get("RTC_Vertical").Type!=IDVariant.NULL){z.SetFlags(Glb.OBJ_GROUP,E,(I.Get("RTC_Vertical").stringValue().equals("Y")?Glb.OBJ_VERTICAL:0),Glb.OBJ_VERTICAL)}if(I.Get("RTC_VStyle").stringValue().length>0){var C=k.VisualStyleList.GetVS(I.Get("RTC_VStyle").stringValue());if(z.Parent.MainFrm.CompOwner!=null){C=k.VisualStyleList.GetTrueIdxInverse(z.Parent.MainFrm,C)}if(C>0){z.set_VisualStyle(Glb.OBJ_GROUP,E,C)}}if(I.Get("RTC_CanCollapse").Type!=IDVariant.NULL){z.Groups[E].Collapsible=I.Get("RTC_CanCollapse").stringValue().equals("Y")}if(I.Get("RTC_Collapsed").Type!=IDVariant.NULL){z.Groups[E].Collapsed=I.Get("RTC_Collapsed").stringValue().equals("Y")}}}var t=0;for(var E=0;E<z.UFields();E++){var b=z.Fields[E];if(((b.Flags&Glb.FLD_INLIST)!=0)&&((b.Flags&Glb.FLD_LISTLIST)!=0)&&b.Page==-1){var v=true;if(b.Group!=-1){if((z.bGroups(b.Group).Flags&Glb.OBJ_VISIBLE)==0){v=false}}if(v&&(b.Flags&Glb.OBJ_VISIBLE)==0){v=false}if(v){t=t+b.ListWidth}}}if(z.IsAdvTabOrderEnabled()){z.VerifyTabOrder()}var j=0;for(var D=0;D<z.UPages();D++){var a=0;if((z.bPages(D).Flags&Glb.OBJ_VISIBLE)==0){continue}for(E=0;E<z.UFields();E++){var b=z.Fields[E];if(((b.Flags&Glb.FLD_INLIST)!=0)&&((b.Flags&Glb.FLD_LISTLIST)!=0)&&b.Page==D){var v=true;if(b.Group!=-1){if((z.bGroups(b.Group).Flags&Glb.OBJ_VISIBLE)==0){v=false}}if(v&&(b.Flags&Glb.OBJ_VISIBLE)==0){v=false}if(v){a=a+b.ListWidth}}}if(a>j){j=a}}t=t+j;z.ListWidth=t;z.RD3Change(RD3Glb.PAN_LISTWIDTH)}catch(H){}};RTCData.prototype.ConfigureSubForm=function(c,b,g){try{if(!this.iGuid.equals(b.Parent.RTCGuid)){this.Parent.SelectForm(b.Parent.RTCGuid);this.Parent.ConfigureSubForm(c,b);return}var a=this.RSSubForms;if(this.Parent.SearchObject(a,b.iGuid)){this.ConfigureFrame(c.Frames[b.FrIndex],a);if(a.Get("RTC_Visible").Type!=IDVariant.NULL){b.set_Visible(a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){b.set_Collapsed(a.Get("RTC_Collapsed").stringValue().equals("Y"))}if(b.pSubForm!=null){b.pSubForm.set_Caption(a.Get("RTC_Name"))}}}catch(d){}};RTCData.prototype.ConfigureForm=function(b,d){try{var a=this.RSForm;if(this.Parent.SearchObject(a,b.RTCGuid)){if(a.Get("RTC_Name").Type!=IDVariant.NULL){b.set_Caption(a.Get("RTC_Name"))}if(a.Get("RTC_Icon").stringValue().length>0){b.set_Image(a.Get("RTC_Icon").stringValue().trim())}if(a.Get("RTC_HelpFile").Type!=IDVariant.NULL){b.HelpFile=a.Get("RTC_HelpFile").stringValue()}if(a.Get("RTC_Docking").Type!=IDVariant.NULL){b.DockType=(a.Get("RTC_Docking").intValue()!=1?a.Get("RTC_Docking").intValue():0)}if(a.Get("RTC_Dim1").Type!=IDVariant.NULL){b.DesignWidth=a.Get("RTC_Dim1").intValue()}if(a.Get("RTC_Dim2").Type!=IDVariant.NULL){b.DesignHeight=a.Get("RTC_Dim2").intValue()}if(a.Get("RTC_ResMode1").Type!=IDVariant.NULL){b.ResModeW=a.Get("RTC_ResMode1").intValue()}if(a.Get("RTC_ResMode2").Type!=IDVariant.NULL){b.ResModeH=a.Get("RTC_ResMode2").intValue()}if(a.Get("RTC_Border").Type!=IDVariant.NULL&&a.Get("RTC_Border").intValue()!=1){b.iBorderType=a.Get("RTC_Border").intValue()-1}if(a.Get("RTC_ToolPos").Type!=IDVariant.NULL&&a.Get("RTC_ToolPos").intValue()!=1){b.ToolbarPosition=a.Get("RTC_ToolPos").intValue()-2}if(a.Get("RTC_HasCaption").Type!=IDVariant.NULL){if(a.Get("RTC_HasCaption").stringValue().equals("N")){b.iVisualFlags&=~1}else{b.iVisualFlags|=1}}if(a.Get("RTC_Resizable").Type!=IDVariant.NULL){if(a.Get("RTC_Resizable").stringValue().equals("N")){b.iVisualFlags&=~2}else{b.iVisualFlags|=2}}if(a.Get("RTC_Moveable").Type!=IDVariant.NULL){if(a.Get("RTC_Moveable").stringValue().equals("N")){b.iVisualFlags&=~4}else{b.iVisualFlags|=4}}if(a.Get("RTC_MinBtn").Type!=IDVariant.NULL){if(a.Get("RTC_MinBtn").stringValue().equals("N")){b.iVisualFlags&=~8}else{b.iVisualFlags|=8}}if(a.Get("RTC_MaxBtn").Type!=IDVariant.NULL){if(a.Get("RTC_MaxBtn").stringValue().equals("N")){b.iVisualFlags&=~16}else{b.iVisualFlags|=16}}if(a.Get("RTC_CloseBtn").Type!=IDVariant.NULL){if(a.Get("RTC_CloseBtn").stringValue().equals("N")){b.iVisualFlags&=~32}else{b.iVisualFlags|=32}}if(a.Get("RTC_ConfBtn").Type!=IDVariant.NULL){if(a.Get("RTC_ConfBtn").stringValue().equals("N")){b.iVisualFlags&=~64}else{b.iVisualFlags|=64}}if(a.Get("RTC_HelpBtn").Type!=IDVariant.NULL){if(a.Get("RTC_HelpBtn").stringValue().equals("N")){b.iVisualFlags&=~128}else{b.iVisualFlags|=128}}if(a.Get("RTC_DebugBtn").Type!=IDVariant.NULL){if(a.Get("RTC_DebugBtn").stringValue().equals("N")){b.iVisualFlags&=~256}else{b.iVisualFlags|=256}}if(a.Get("RTC_HasIcon").Type!=IDVariant.NULL){if(a.Get("RTC_HasIcon").stringValue().equals("N")){b.iVisualFlags&=~512}else{b.iVisualFlags|=512}}if(a.Get("RTC_ShowMessages").Type!=IDVariant.NULL){if(a.Get("RTC_ShowMessages").stringValue().equals("N")){b.iVisualFlags&=~1024}else{b.iVisualFlags|=1024}}}}catch(c){}};RTCData.prototype.ReloadFields=function(a){this.RSPanelFields=this.Parent.LoadRS("PanelFields",a)};function RTCEngine(a){this.DB;this.DBClass;this.AppGuid;this.PrjGuid;this.Enabled=false;this.MainFrm=a;this.DataCache=new ArrayList();this.AttData;this.ConstCache=new HashTableSrv();this.ValueListCache=new HashTableSrv();this.AlreadyInit=false;this.ConstLoaded=false;this.RTCHash=new IDVariant();this.RTCTimestamp=new IDVariant()}RTCEngine.MAX_QUEUE=100;RTCEngine.prototype.SelectForm=function(c){if(!this.Enabled){return}this.AttData=null;var a=-1;for(var b=0;b<this.DataCache.Count();b++){var e=this.DataCache[b];a++;if(c.equals(e.iGuid)){this.AttData=e;break}}if(this.AttData==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,125,"RTCEngine.SelectForm","RTC: Loading form RTC data");this.AttData=new RTCData(this,c);this.MainFrm.OpenConnection(this.DB);this.AttData.Load(this.GetWhereClause(c));this.DataCache.Add(this.AttData);if(this.DataCache.Count()>RTCEngine.MAX_QUEUE){this.DataCache.RemoveAt(0)}}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,125,"RTCEngine.SelectForm","RTC: Loading form RTC data from cache");this.DataCache.RemoveAt(a);this.DataCache.Add(this.AttData);this.AttData.Reset()}};RTCEngine.prototype.PanelValueList=function(f,j,b){if(!this.Enabled){return false}try{var h=this.GetValueList(b);if(h==null){return false}for(var a=0;a<h.Count();a++){var g=h[a];f.SetValueListItem(j,g.Value,g.Name,g.Description,g.Image,g.VisIdx)}return true}catch(d){return false}};RTCEngine.prototype.BookValueList=function(a,j,f){if(!this.Enabled){return false}try{var k=this.GetValueList(f);if(k==null){return false}for(var d=0;d<k.Count();d++){var h=k[d];a.SetSpanValueListItem(j,h.Name,h.Description,h.Value,null,h.Image,h.VisIdx)}return true}catch(g){return false}};RTCEngine.prototype.ConfigureBook=function(c,a){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.BookObj.GetRTCGuid(0),126,"RTCEngine.ConfigureBook","RTC: Configuring book "+c.Caption()+"."+a.BookObj.GetName());this.AttData.ConfigureBook(c,a,this.MainFrm)};RTCEngine.prototype.ConfigureButtonBar=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.iGuid,127,"RTCEngine.ConfigureButtonBar","RTC: Configuring button bar "+a.Caption()+"."+a.Frames[b.FrIndex].Caption);this.AttData.ConfigureButtonBar(a,b,this.MainFrm)};RTCEngine.prototype.ConfigureTree=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.iGuid,128,"RTCEngine.ConfigureTree","RTC: Configuring tree "+a.Caption()+"."+a.Frames[b.FrIndex].Caption);this.AttData.ConfigureTree(a,b,this.MainFrm)};RTCEngine.prototype.ConfigureGraph=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.iGuid,129,"RTCEngine.ConfigureGraph","RTC: Configuring graph "+a.Caption()+"."+(b.FrIndex!=-1?a.Frames[b.FrIndex].Caption:b.GraphCode));this.AttData.ConfigureGraph(a,b,this.MainFrm)};RTCEngine.prototype.ConfigureTabbed=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.iGuid,130,"RTCEngine.ConfigureTabbed","RTC: Configuring tabbed "+a.Caption()+"."+a.Frames[b.FrIndex].Caption);this.AttData.ConfigureTabbed(a,b,this.MainFrm)};RTCEngine.prototype.ConfigurePanel=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.GetRTCGuid(Glb.OBJ_PANEL,0),131,"RTCEngine.ConfigurePanel","RTC: Configuring panel "+a.Caption()+"."+b.GetDTTCaption());this.AttData.ConfigurePanel(a,b,this.MainFrm)};RTCEngine.prototype.ConfigureSubForm=function(b,a){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.iGuid,131,"RTCEngine.ConfigureSubForm","RTC: Configuring SubForm "+a.Code);this.AttData.ConfigureSubForm(b,a,this.MainFrm)};RTCEngine.prototype.ConfigureForm=function(a){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.RTCGuid,132,"RTCEngine.ConfigureForm","RTC: Configuring form "+a.Caption());this.AttData.ConfigureForm(a,this.MainFrm)};RTCEngine.prototype.GetConst=function(c,h,e){if(e==undefined){e=false}var a="IDVariant";if(!(h instanceof IDVariant)){a=typeof(h);h=new IDVariant(h)}var b=h;var f=this.GetConstItem(c);if(f!=null){b=f.Value}if(e){b=new IDVariant(Glb.HTMLEncode(h.stringValue(),true))}switch(a){case"string":b=b.stringValue();break;case"number":b=b.intValue();break;case"boolean":b=b.booleanValue();break}return b};RTCEngine.prototype.GetConstName=function(a,c){var b=this.GetConstItem(a);if(b!=null){return new IDVariant(b.Name)}return c};RTCEngine.prototype.GetConstItem=function(a){if(!this.Enabled&&!this.ConstLoaded){return null}return this.ConstCache[a.toUpperCase()]};RTCEngine.prototype.ConfigureMain=function(a){if(a==undefined){a=""}if(this.AlreadyInit||this.DBClass==0){return}if(a.length>0){this.AppGuid=a}if(this.Enabled){this.MainFrm.OpenConnection(this.DB);this.ConfigureApplication();this.ConfigureVStyles();this.ConfigureCmdSets("");this.ConfigureCommands("");this.ConfigureIndicators("");this.ConfigureTimers("");this.ConfigureConstants(this.AppGuid);this.ConfigureErrorMessages(this.AppGuid);this.ConfigureParameters(this.AppGuid)}this.AlreadyInit=true};RTCEngine.prototype.ConfigureApplication=function(){var c=this.MainFrm;c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.AppGuid,133,"RTCEngine.ConfigureApplication","RTC: Configuring application");try{var a=this.LoadRS("Applications",this.GetWhereClause(this.AppGuid));if(this.SearchObject(a,this.AppGuid)){if(a.Get("RTC_HelpFile").Type!=IDVariant.NULL){c.HelpFile=a.Get("RTC_HelpFile").stringValue()}if(a.Get("RTC_MenuType").Type!=IDVariant.NULL){c.MenuType=a.Get("RTC_MenuType").intValue()}}}catch(b){c.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.AppGuid,134,"RTCEngine.ConfigureApplication","RTC: Error while configuring application (Error = "+b.message+")")}};RTCEngine.prototype.ConfigureVStyles=function(){var h=this.MainFrm;h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.AppGuid,135,"RTCEngine.ConfigureVStyles","RTC: Configuring application visual styles");try{var b=this.LoadRS("VStyles",this.GetWhereClause(""));for(var c=1;c<h.VisualStyleList.iVisAttrObj.length;c++){var l=h.VisualStyleList.iVisAttrObj[c];if(this.SearchObject(b,l.iGuid,l.Index+"")){if(b.Get("RTC_Control").stringValue().length>0){l.set_ControlType(b.Get("RTC_Control").intValue())}if(b.Get("RTC_Offset1").stringValue().length>0){l.set_RowOffset(b.Get("RTC_Offset1").intValue())}if(b.Get("RTC_Offset2").stringValue().length>0){l.set_HeaderOffset(b.Get("RTC_Offset2").intValue())}if(b.Get("RTC_Cursor").stringValue().length>0){var k=null;switch(b.Get("RTC_Cursor").intValue()){case 1:break;case 2:k="default";break;case 3:k="pointer";break;case 4:k="progress";break;case 5:k="wait";break;case 6:k="help";break;case 7:k="crosshair";break;case 8:k="move";break;case 9:k="e-resize";break;case 10:k="n-resize";break;case 11:k="ne-resize";break;case 12:k="sw-resize";break;case 13:k="text";break}l.set_Cursor(k)}if(b.Get("RTC_Mask").stringValue().length>0){l.set_Mask(b.Get("RTC_Mask").stringValue())}if(b.Get("RTC_FontCar1").stringValue().length>0){l.set_LetterSpacing(b.Get("RTC_FontCar1").intValue())}if(b.Get("RTC_FontCar2").stringValue().length>0){l.set_WordSpacing(b.Get("RTC_FontCar2").intValue())}if(b.Get("RTC_FontCar3").stringValue().length>0){l.set_HorizontalScale(b.Get("RTC_FontCar3").intValue())}var f=l.iFlags;if(b.Get("RTC_Password").stringValue().length>0){f=f&(~Glb.FL_VIS_PASSWORD)|(b.Get("RTC_Password").stringValue().equals("Y")?Glb.FL_VIS_PASSWORD:0)}if(b.Get("RTC_ShowDescr").stringValue().length>0){f=f&(~Glb.FL_VIS_SHOWDESCR)|(b.Get("RTC_ShowDescr").stringValue().equals("Y")?Glb.FL_VIS_SHOWDESCR:0)}if(b.Get("RTC_ShowImage").stringValue().length>0){f=f&(~Glb.FL_VIS_SHOWIMAGE)|(b.Get("RTC_ShowImage").stringValue().equals("Y")?Glb.FL_VIS_SHOWIMAGE:0)}if(b.Get("RTC_ShowValue").stringValue().length>0){f=f&(~Glb.FL_VIS_SHOWVALUE)|(b.Get("RTC_ShowValue").stringValue().equals("Y")?Glb.FL_VIS_SHOWVALUE:0)}if(b.Get("RTC_HyperLink").stringValue().length>0){f=f&(~Glb.FL_VIS_HYPERLINK)|(b.Get("RTC_HyperLink").stringValue().equals("Y")?Glb.FL_VIS_HYPERLINK:0)}l.iFlags=f;for(var a=1;a<=VisAttrObjSrv.MAX_ALIGNMENTS;a++){if(b.Get("RTC_Align"+a).stringValue().length>0){l.set_Alignment(a,b.Get("RTC_Align"+a).intValue())}}for(var a=1;a<=VisAttrObjSrv.MAX_BORDERS;a++){if(b.Get("RTC_Border"+a).stringValue().length>0){l.set_BorderType(a,b.Get("RTC_Border"+a).intValue())}}for(var a=1;a<=VisAttrObjSrv.MAX_FONTS;a++){if(b.Get("RTC_Font"+a).stringValue().length>0){l.set_Font(a,b.Get("RTC_Font"+a).stringValue())}}for(var a=1;a<=VisAttrObjSrv.MAX_COLORS;a++){if(b.Get("RTC_Color"+a).stringValue().length>0){l.set_Color(a,b.Get("RTC_Color"+a).intValue())}if(b.Get("RTC_GradCol"+a).stringValue().length>0){l.set_GradCol(a,b.Get("RTC_GradCol"+a).intValue())}if(b.Get("RTC_GradDir"+a).stringValue().length>0){l.set_GradDir(a,b.Get("RTC_GradDir"+a).intValue())}if(b.Get("RTC_Opacity"+a).stringValue().length>0){l.set_Opacity(a,b.Get("RTC_Opacity"+a).intValue())}}for(var a=1;a<=VisAttrObjSrv.MAX_CUSTBORDERS;a++){if(b.Get("RTC_CBorCol"+a).stringValue().length>0){l.set_CBorColor(a,b.Get("RTC_CBorCol"+a).intValue())}if(b.Get("RTC_CBorWidth"+a).stringValue().length>0){l.set_CBorWidth(a,b.Get("RTC_CBorWidth"+a).intValue())}if(b.Get("RTC_CBorTyp"+a).stringValue().length>0){l.set_CBorType(a,b.Get("RTC_CBorTyp"+a).intValue())}if(b.Get("RTC_CBorPad"+a).stringValue().length>0){l.set_CBorPadding(a,b.Get("RTC_CBorPad"+a).intValue())}}}}}catch(g){h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.AppGuid,136,"RTCEngine.ConfigureVStyles","RTC: Error while configuring visual styles (Error = "+g.message+")")}};RTCEngine.prototype.ConfigureCmdSets=function(c){var h=this.MainFrm;h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,133,"RTCEngine.ConfigureCmdSets","RTC: Configuring application command sets");try{var a=this.LoadRS("CmdSets",this.GetWhereClause(c));var j=this.LoadRS("ButtonBars",this.GetWhereClause(""));for(var b=1;b<h.CmdObj.CmdSets.length;b++){if(h.CmdObj.CmdSets[b]==null){continue}if(this.SearchObject(a,h.CmdObj.CmdSets[b].iGuid,null,false)){if(a.Get("RTC_Name").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bCaption(a.Get("RTC_Name").stringValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bToolTip(a.Get("RTC_Description").stringValue())}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bEnabled(0,a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_Toolbar").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].IsToolbar=a.Get("RTC_Toolbar").stringValue().equals("Y")}if(a.Get("RTC_Menubar").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].IsMenu=a.Get("RTC_Menubar").stringValue().equals("Y")}if(a.Get("RTC_Toolnames").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].ShowNames=a.Get("RTC_Toolnames").stringValue().equals("Y")}if(a.Get("RTC_Expanded").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].Expanded=a.Get("RTC_Expanded").stringValue().equals("Y")}if(a.Get("RTC_Icon").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bImage(a.Get("RTC_Icon").stringValue())}if(a.Get("RTC_Accel").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].Accell=(h.MenuType==Glb.MENUTYPE_MENUBAR?a.Get("RTC_Accel").stringValue():null)}if(a.Get("RTC_CanDrag").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].CanDrag=a.Get("RTC_CanDrag").stringValue().equals("Y")}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].CanDrop=a.Get("RTC_CanDrop").stringValue().equals("Y")}}else{var f=false;j.MoveFirst();while(!j.EOF()){if(j.Get("RTC_Guid").stringValue().equals(h.CmdObj.CmdSets[b].iGuid)){f=true;break}j.MoveNext()}}}for(var b=1;b<h.CmdObj.CmdLin.length;b++){if(h.CmdObj.CmdLin[b]==null){continue}if(h.CmdObj.CmdLin[b].IsCmdSet){if(this.SearchObject(a,h.CmdObj.CmdLin[b].iGuid,h.CmdObj.CmdLin[b].Caption)){if(a.Get("RTC_Name").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bCaption(a.Get("RTC_Name").stringValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bToolTip(a.Get("RTC_Description").stringValue())}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bEnabled(0,a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_Toolbar").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].IsToolbar=a.Get("RTC_Toolbar").stringValue().equals("Y")}if(a.Get("RTC_Menubar").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].IsMenu=a.Get("RTC_Menubar").stringValue().equals("Y")}if(a.Get("RTC_Toolnames").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].ShowNames=a.Get("RTC_Toolnames").stringValue().equals("Y")}if(a.Get("RTC_Expanded").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].Expanded=a.Get("RTC_Expanded").stringValue().equals("Y")}if(a.Get("RTC_Icon").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bImage(a.Get("RTC_Icon").stringValue())}if(a.Get("RTC_Accel").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].Accell=(h.MenuType==Glb.MENUTYPE_MENUBAR?a.Get("RTC_Accel").stringValue():null)}if(a.Get("RTC_CanDrag").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].CanDrag=a.Get("RTC_CanDrag").stringValue().equals("Y")}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].CanDrop=a.Get("RTC_CanDrop").stringValue().equals("Y")}}}}}catch(d){h.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,c,134,"RTCEngine.ConfigureCmdSets","RTC: Error while configuring command sets (Error = "+d.message+")")}};RTCEngine.prototype.ConfigureCommands=function(c){var f=this.MainFrm;f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,135,"RTCEngine.ConfigureCommands","RTC: Configuring application commands");try{var a=this.LoadRS("Commands",this.GetWhereClause(c));for(var b=1;b<f.CmdObj.CmdLin.length;b++){if(f.CmdObj.CmdLin[b]==null){continue}if(!f.CmdObj.CmdLin[b].IsCmdSet){if(this.SearchObject(a,f.CmdObj.CmdLin[b].iGuid,f.CmdObj.CmdLin[b].Caption)){if(f.CmdObj.CmdLin[b].Caption.length==0){if(a.Get("RTC_Visible").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}}else{if(a.Get("RTC_Name").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bCaption(a.Get("RTC_Name").stringValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bToolTip(a.Get("RTC_Description").stringValue())}if(a.Get("RTC_Icon").stringValue().length>0){f.CmdObj.CmdLin[b].set_bImage(a.Get("RTC_Icon").stringValue().trim())}if(a.Get("RTC_ToolName").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bToolName(a.Get("RTC_ToolName").stringValue())}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bEnabled(0,a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_ReqConf").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].RequireConfirmation=a.Get("RTC_ReqConf").stringValue().equals("Y")}if(a.Get("RTC_Toolbar").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].IsToolbar=a.Get("RTC_Toolbar").stringValue().equals("Y")}if(a.Get("RTC_Menubar").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].IsMenu=a.Get("RTC_Menubar").stringValue().equals("Y")}if(a.Get("RTC_Checked").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bChecked(0,a.Get("RTC_Checked").stringValue().equals("Y"))}if(a.Get("RTC_Hilight").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].UseHilight=a.Get("RTC_Hilight").stringValue().equals("Y")}if(a.Get("RTC_Accel").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].Accell=(f.MenuType==Glb.MENUTYPE_MENUBAR?a.Get("RTC_Accel").stringValue():null)}if(a.Get("RTC_FKey").Type!=IDVariant.NULL&&a.Get("RTC_FKShift").Type!=IDVariant.NULL&&a.Get("RTC_FKCtrl").Type!=IDVariant.NULL){var h=(a.Get("RTC_FKShift").stringValue().equals("Y")?1:0)+(a.Get("RTC_FKCtrl").stringValue().equals("Y")?2:0);f.CmdObj.CmdLin[b].FKNum=a.Get("RTC_FKey").intValue()+h*Glb.FKMaxNum}if(a.Get("RTC_CmdCode").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].CmdCode=(a.Get("RTC_CmdCode").stringValue().length>0?a.Get("RTC_CmdCode").stringValue():null)}}}}}}catch(d){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,136,"RTCEngine.ConfigureCommands","RTC: Error while configuring commands (Error = "+d.message+")")}};RTCEngine.prototype.ConfigureIndicators=function(c){var f=this.MainFrm;f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,137,"RTCEngine.ConfigureIndicators","RTC: Configuring application indicators");try{var a=this.LoadRS("Indicators",this.GetWhereClause(c));for(var b=1;b<f.IndObj.Indicators.length;b++){if(f.IndObj.Indicators[b]==null){continue}if(this.SearchObject(a,f.IndObj.Indicators[b].iGuid,f.IndObj.Indicators[b].Code)){if(a.Get("RTC_Description").Type!=IDVariant.NULL){f.IndObj.Indicators[b].ToolTip=a.Get("RTC_Description").stringValue()}if(a.Get("RTC_Icon").Type!=IDVariant.NULL){f.IndObj.Indicators[b].set_bImage(0,a.Get("RTC_Icon").stringValue())}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){f.IndObj.Indicators[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){f.IndObj.Indicators[b].set_bEnabled(0,a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_Style").Type!=IDVariant.NULL){f.IndObj.Indicators[b].Style=a.Get("RTC_Style").intValue()}if(a.Get("RTC_Width").Type!=IDVariant.NULL){f.IndObj.Indicators[b].Width=a.Get("RTC_Width").intValue()}if(a.Get("RTC_Alignment").Type!=IDVariant.NULL){f.IndObj.Indicators[b].Alignment=a.Get("RTC_Alignment").intValue()}if(a.Get("RTC_WType").intValue()==1){f.IndObj.Indicators[b].Width=1}}}}catch(d){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,138,"RTCEngine.ConfigureIndicators","RTC: Error while configuring indicators (Error = "+d.message+")")}};RTCEngine.prototype.ConfigureTimers=function(c){var f=this.MainFrm;f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,139,"RTCEngine.ConfigureTimers","RTC: Configuring application timers");try{var a=this.LoadRS("Timers",this.GetWhereClause(c));for(var b=1;b<f.TimerObj.Timers.length;b++){if(f.TimerObj.Timers[b]==null){continue}if(this.SearchObject(a,f.TimerObj.Timers[b].iGuid,f.TimerObj.Timers[b].Code)){if(a.Get("RTC_UM").Type!=IDVariant.NULL){switch(a.Get("RTC_UM").intValue()){case 1:f.TimerObj.Timers[b].MilliSec=a.Get("RTC_Interval").intValue();f.TimerObj.Timers[b].Interval=0;break;case 2:f.TimerObj.Timers[b].Interval=a.Get("RTC_Interval").intValue();f.TimerObj.Timers[b].MilliSec=0;break;case 3:f.TimerObj.Timers[b].Interval=a.Get("RTC_Interval").intValue()*60;f.TimerObj.Timers[b].MilliSec=0;break;case 4:f.TimerObj.Timers[b].Interval=a.Get("RTC_Interval").intValue()*3600;f.TimerObj.Timers[b].MilliSec=0;break;case 5:f.TimerObj.Timers[b].Interval=a.Get("RTC_Interval").intValue()*86400;f.TimerObj.Timers[b].MilliSec=0;break}}if(a.Get("RTC_Ticks").Type!=IDVariant.NULL){f.TimerObj.Timers[b].NumTicks=a.Get("RTC_Ticks").intValue()}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){f.TimerObj.Timers[b].set_bEnabled(a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_Permanent").Type!=IDVariant.NULL){f.TimerObj.Timers[b].set_bPermanent(a.Get("RTC_Permanent").stringValue().equals("Y"))}}}}catch(d){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,140,"RTCEngine.ConfigureTimers","RTC: Error while configuring timers (Error = "+d.message+")")}};RTCEngine.prototype.ConfigureConstants=function(b){var f=this.MainFrm;f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,141,"RTCEngine.ConfigureConstants","RTC: Configuring application constants");this.ConstCache.clear();var j=this.LoadRS("Constants",this.GetWhereClause(b));try{while(!j.EOF()){var k;var d=new PVLItemSrv();if(j.Get("RTC_IsNull").Type!=IDVariant.NULL&&j.Get("RTC_IsNull").stringValue().equals("Y")){k=new IDVariant()}else{if(j.Get("RTC_Value").Type!=IDVariant.NULL){k=j.Get("RTC_Value");switch(j.Get("RTC_DataType").intValue()){case Glb.DT_NUM_CURRENCY:k.changeType(IDVariant.DECIMAL);break;case Glb.DT_NUM_FIXED:k.changeType(IDVariant.DECIMAL);break;case Glb.DT_NUM_FLOAT:k.changeType(IDVariant.FLOAT);break;case Glb.DT_NUM_INTEGER:k.changeType(IDVariant.INTEGER);break;case Glb.DT_DATE:case Glb.DT_DATETIME:case Glb.DT_TIME:k.changeType(IDVariant.DATETIME);break;case Glb.DT_BOOLEAN:k.changeType(IDVariant.INTEGER);break}}}if(k){d.Value=k}if(j.Get("RTC_Description").Type!=IDVariant.NULL){d.Description=j.Get("RTC_Description").stringValue()}if(j.Get("RTC_Icon").Type!=IDVariant.NULL){d.Image=j.Get("RTC_Icon").stringValue()}if(j.Get("RTC_Name").Type!=IDVariant.NULL){d.Name=j.Get("RTC_Name").stringValue()}d.OrigName=j.Get("RTC_Name2").stringValue();d.iGuid=j.Get("RTC_Guid").stringValue();d.Parent=j.Get("RTC_Parent").stringValue();if(j.Get("RTC_VStyle").stringValue().length>0){var l=f.VisualStyleList.GetVS(j.Get("RTC_VStyle").stringValue());if(l>0){d.VisIdx=l}}this.ConstCache.add(d.iGuid.toUpperCase(),d);if(j.Get("RTC_Parent").stringValue().length>0){if(!j.Get("RTC_Parent").stringValue().equals(a)){var a=j.Get("RTC_Parent").stringValue();var h=new ArrayList();this.ValueListCache[a]=h}h.Add(d)}j.MoveNext()}}catch(c){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,142,"RTCEngine.ConfigureConstants","RTC: Error while configuring constants (Error = "+c.message+")")}};RTCEngine.prototype.LoadRTCConst=function(){if(this.ConstCache.count()>0||this.ConstLoaded){return}try{var d=new XMLHttpRequest();d.open("GET","?WCI=RD3&WCE=GZ&FN=rtcconst.ini",false);d.setRequestHeader("Content-Type","text/plain");d.send();var a=d.responseText.split("\n");for(var b=0;b<a.length;b++){var c=a[b];if(c.length>=36&&c[0]!="/"){var g=new PVLItemSrv();g.iGuid=c.substr(0,36);if(c.length>37){g.Value=new IDVariant(c.substr(37))}else{g.Value=new IDVariant()}this.ConstCache.add(g.iGuid.toUpperCase(),g);this.ConstLoaded=true}}}catch(f){}};RTCEngine.prototype.ConfigureParameters=function(c){if(!this.Enabled&&!this.ConstLoaded){return}var a=this.ConstCache.values();for(var b=0;b<a.length;b++){var f=a[b];if(!f.Parent.equals(c)){continue}switch(f.OrigName){case"InfoMessages":this.MainFrm.ParamsObj().InfoMessages=f.Value.stringValue().equals("YES");break;case"_ICD_ActImgWidth":this.MainFrm.ParamsObj().ActImgWidth=f.Value.intValue();break;case"_ICD_AutoDynRows":this.MainFrm.ParamsObj().AutoDynRows=f.Value.intValue();break;case"UseIDTag":this.MainFrm.ParamsObj().UseIDTag=f.Value.stringValue().equals("YES");break;case"_ICD_DefaultCurrencyMask":this.MainFrm.ParamsObj().DefaultCurrencyMask=f.Value.stringValue();break;case"_ICD_DefaultFloatMask":this.MainFrm.ParamsObj().DefaultFloatMask=f.Value.stringValue();break;case"_ICD_DefaultDateMask":this.MainFrm.ParamsObj().DefaultDateMask=f.Value.stringValue();break;case"_ICD_DefaultTimeMask":this.MainFrm.ParamsObj().DefaultTimeMask=f.Value.stringValue();break;case"UseRD":this.MainFrm.ParamsObj().UseRD=f.Value.stringValue().equals("YES");break;case"PanelNewInsertMode":if(f.Value.stringValue().equals("YES")){this.MainFrm.GlbPanelFlags=this.MainFrm.GlbPanelFlags|Glb.PAN_NEWINSMODE}break;case"_ICD_HELPFEATURES":this.MainFrm.ParamsObj().HelpFeatures=f.Value.stringValue();break;case"UseDoubleClick":this.MainFrm.ParamsObj().UseDoubleClick=f.Value.stringValue().equals("YES");break;case"UseFK":this.MainFrm.ParamsObj().UseFK=f.Value.stringValue().equals("YES");break;case"PanelsUseTab":if(f.Value.stringValue().equals("YES")){this.MainFrm.GlbPanelFlags=this.MainFrm.GlbPanelFlags|Glb.PAN_USETAB}break;case"PanelsSortAlways":if(f.Value.stringValue().equals("YES")){this.MainFrm.GlbPanelFlags=this.MainFrm.GlbPanelFlags|Glb.PAN_SORTALWAYS}break;case"PanelsLikeSearch":this.MainFrm.ParamsObj().PanelsLikeSearch=f.Value.stringValue().equals("YES");break;case"EnablePanelMultiSelection":this.MainFrm.ParamsObj().EnablePanelMultiSelection=f.Value.stringValue().equals("YES");break;case"ActivePanelMultiSelection":this.MainFrm.ParamsObj().ActivePanelMultiSelection=f.Value.stringValue().equals("YES");break;case"ShowPanelMultiSelection":this.MainFrm.ParamsObj().ShowPanelMultiSelection=f.Value.stringValue().equals("YES");break;case"_ICD_MAINCAPTION":break;case"ShowDisabledFieldActivator":this.MainFrm.ParamsObj().ShowDisabledFieldActivator=f.Value.stringValue().equals("YES");break;case"ConvertNullToValue":IDVariant.ConvertNullToValue=f.Value.stringValue().equals("YES");break;case"HtmlConstraints":this.MainFrm.ParamsObj().HtmlConstraints=f.Value.stringValue().equals("NONE")?Glb.WEBVALID_NONE:Glb.WEBVALID_STRICT;break;case"UseCollapsableFrames":this.MainFrm.ParamsObj().UseCollapsableFrames=f.Value.stringValue().equals("YES");break;case"_ICD_PanelCommandMask":this.MainFrm.ParamsObj().PanelCommandMask=f.Value.intValue();break;case"_ICD_PanelExtendedCommandMask":this.MainFrm.ParamsObj().PanelExtendedCommandMask=f.Value.intValue();break;case"ShowRD":this.MainFrm.ParamsObj().ShowRD=f.Value.stringValue().equals("YES");break;case"AutoSaveType":this.MainFrm.ParamsObj().AutoSaveType=f.Value.stringValue();break;case"_ICD_LOGOFF_URL":this.MainFrm.set_LogoffURL(f.Value.stringValue());break;case"_ICD_WELCOME_URL":this.MainFrm.set_WelcomeUrl(f.Value.stringValue());break;case"ShowFieldImageInValue":this.MainFrm.ParamsObj().ShowFieldImageInValue=f.Value.stringValue().equals("YES");break;case"_ICD_PanelEditInsertErrorMode":this.MainFrm.ParamsObj().EditInsErrorMode=f.Value.intValue();break;case"_ICD_PanelEditUpdateErrorMode":this.MainFrm.ParamsObj().EditUpdErrorMode=f.Value.intValue();break;case"_ICD_PanelFinalInsertErrorMode":this.MainFrm.ParamsObj().FinalInsErrorMode=f.Value.intValue();break;case"_ICD_PanelFinalUpdateErrorMode":this.MainFrm.ParamsObj().FinalUpdErrorMode=f.Value.intValue();break;case"UseDecimalDot":this.MainFrm.ParamsObj().UseDecimalDot=f.Value.stringValue().equals("YES");break;case"UseFastRowSelector":this.MainFrm.ParamsObj().UseFastRowSelector=f.Value.stringValue().equals("YES");break;case"TruePopup":this.MainFrm.ParamsObj().TruePopup=f.Value.stringValue().equals("YES");break;case"_ICD_UseSmallIcon":this.MainFrm.ParamsObj().UseSmallIcon=f.Value.stringValue().equals("YES");break;case"UseClientMask":this.MainFrm.ParamsObj().UseClientMask=f.Value.stringValue().equals("YES");break;case"PanelQBEEmpty":this.MainFrm.ParamsObj().PanelQBEEmpty=f.Value.stringValue().equals("YES");break;case"PanelConfirmDelete":this.MainFrm.ParamsObj().PanelConfirmDelete=f.Value.stringValue().equals("YES");break;case"PanelFreezeWhenHidden":if(f.Value.stringValue().equals("YES")){this.MainFrm.GlbPanelFlags=this.MainFrm.GlbPanelFlags|Glb.PAN_FREEWHENHID}break;case"PanelIsLockable":this.MainFrm.ParamsObj().PanelIsLockable=f.Value.stringValue().equals("YES");break;case"ChangeRowDelay":this.MainFrm.ParamsObj().ChangeRowDelay=f.Value.intValue();break;case"SmartLookupIcon":this.MainFrm.ParamsObj().SmartLookupIcon=f.Value.stringValue();break;case"ShowDisabledIcons":this.MainFrm.ParamsObj().ShowDisabledIcons=f.Value.stringValue().equals("YES");break;case"RightAlignedIcons":this.MainFrm.ParamsObj().RightAlignedIcons=f.Value.stringValue().equals("YES");break;case"AllowMasterPanelNav":this.MainFrm.ParamsObj().AllowMasterPanelNav=f.Value.stringValue().equals("YES");break;case"NativeBlob":this.MainFrm.ParamsObj().NativeBlob=f.Value.stringValue().equals("YES");break;case"ToolbarPosition":if(f.Value.stringValue().equals("NONE")){this.MainFrm.ParamsObj().ToolbarPosition=Glb.FORMTOOL_NONE}if(f.Value.stringValue().equals("LEFT")){this.MainFrm.ParamsObj().ToolbarPosition=Glb.FORMTOOL_LEFT}if(f.Value.stringValue().equals("RIGHT")){this.MainFrm.ParamsObj().ToolbarPosition=Glb.FORMTOOL_RIGHT}if(f.Value.stringValue().equals("DISTRIBUTED")){this.MainFrm.ParamsObj().ToolbarPosition=Glb.FORMTOOL_DISTRUB}break;case"UseRD3":if(this.MainFrm.SessionName.length==0){this.MainFrm.ParamsObj().UseRD3=f.Value.stringValue().equals("YES")}break;case"BorderType":this.MainFrm.ParamsObj().BorderType=this.MainFrm.ParamsObj().Theme.equals("seattle")?Glb.BORDER_THICK:Glb.BORDER_THIN;if(f.Value.stringValue().equals("NONE")){this.MainFrm.ParamsObj().BorderType=Glb.BORDER_NONE}if(f.Value.stringValue().equals("THICK")){this.MainFrm.ParamsObj().BorderType=Glb.BORDER_THICK}if(f.Value.stringValue().equals("THIN")){this.MainFrm.ParamsObj().BorderType=Glb.BORDER_THIN}break;case"TooltipErrorMode":this.MainFrm.ParamsObj().TooltipErrorMode=f.Value.intValue();break;case"EnableGFX":this.MainFrm.ParamsObj().EnableGFX=f.Value.stringValue().equals("YES");break;case"EnableSound":this.MainFrm.ParamsObj().EnableSound=f.Value.stringValue().equals("YES");break;case"EnableRichTooltip":this.MainFrm.ParamsObj().EnableRichTooltip=f.Value.stringValue().equals("YES");break;case"MultiSelectionComboBox":this.MainFrm.ParamsObj().MultiSelectionComboBox=f.Value.stringValue().equals("YES");break;case"UseCollapsableGroups":this.MainFrm.ParamsObj().UseCollapsableGroups=f.Value.stringValue().equals("YES");break;case"PanelHighlightDelete":this.MainFrm.ParamsObj().PanelHighlightDelete=f.Value.stringValue().equals("YES");break;case"SelectAllOnlyVisible":this.MainFrm.ParamsObj().SelectAllOnlyVisible=f.Value.stringValue().equals("YES");break;case"TooltipOnEachRow":this.MainFrm.ParamsObj().TooltipOnEachRow=f.Value.stringValue().equals("YES");break;case"EnableFrameResize":this.MainFrm.ParamsObj().EnableFrameResize=f.Value.stringValue().equals("YES");break;case"QBETrueLessThan":this.MainFrm.ParamsObj().QBETrueLessThan=f.Value.stringValue().equals("YES");break;case"PanelEnableInsertWhenLocked":this.MainFrm.ParamsObj().PanelEnableInsertWhenLocked=f.Value.stringValue().equals("YES");break;case"LKEDOAllProperties":this.MainFrm.ParamsObj().LKEDOAllProperties=f.Value.stringValue().equals("YES");break;case"LoadingPolicy":if(f.Value.stringValue().equals("MANUAL")){this.MainFrm.ParamsObj().LoadingPolicy=0}if(f.Value.stringValue().equals("AUTO")){this.MainFrm.ParamsObj().LoadingPolicy=1}if(f.Value.stringValue().equals("CONTINUOUS")){this.MainFrm.ParamsObj().LoadingPolicy=2}break;case"PullToRefresh":this.MainFrm.ParamsObj().PullToRefresh=f.Value.stringValue().equals("YES");break;case"UseHTML5Upload":this.MainFrm.ParamsObj().UseHTML5Upload=f.Value.stringValue().equals("YES");break;case"CompletePanelBorders":this.MainFrm.ParamsObj().CompletePanelBorders=f.Value.stringValue().equals("YES");break;case"UseZones":this.MainFrm.ParamsObj().UseZones=f.Value.stringValue().equals("YES");break;case"EnableVoice":this.MainFrm.ParamsObj().EnableVoice=f.Value.stringValue().equals("YES");break;case"UseIDEditor":this.MainFrm.ParamsObj().UseIDEditor=f.Value.stringValue().equals("YES");break;case"EnterChangeFocus":this.MainFrm.ParamsObj().EnterChangeFocus=f.Value.stringValue().equals("YES");break;case"PanelsLikeMode":if(f.Value.stringValue().equals("STARTSWITH")){this.MainFrm.ParamsObj().PanelsLikeMode=Glb.PAN_LIKESTARTS}else{if(f.Value.stringValue().equals("CONTAINS")){this.MainFrm.ParamsObj().PanelsLikeMode=Glb.PAN_LIKECONTAINS}}break;case"PanelRefreshOnSort":this.MainFrm.ParamsObj().PanelRefreshOnSort=f.Value.stringValue().equals("YES");break;case"_ICD_ACCENT_COLOR":try{var h=parseInt(f.Value.stringValue(),16);if(!isNaN(h)){this.MainFrm.iAccentColor=((h&16711680)>>16)+(h&65280)+((h&255)<<16)}}catch(d){}break;case"_ICD_SECONDARY_COLOR":try{var h=parseInt(f.Value.stringValue(),16);if(!isNaN(h)){this.MainFrm.iSecondaryColor=((h&16711680)>>16)+(h&65280)+((h&255)<<16)}}catch(d){}break;case"_ICD_DANGER_COLOR":try{var h=parseInt(f.Value.stringValue(),16);if(!isNaN(h)){this.MainFrm.iDangerColor=((h&16711680)>>16)+(h&65280)+((h&255)<<16)}}catch(d){}break;case"_ICD_LIGHT_COLOR":try{var h=parseInt(f.Value.stringValue(),16);if(!isNaN(h)){this.MainFrm.iLightColor=((h&16711680)>>16)+(h&65280)+((h&255)<<16)}}catch(d){}break;case"_ICD_DARK_COLOR":try{var h=parseInt(f.Value.stringValue(),16);if(!isNaN(h)){this.MainFrm.iDarkColor=((h&16711680)>>16)+(h&65280)+((h&255)<<16)}}catch(d){}break;case"_ICD_BRIGHT_COLOR":try{var h=parseInt(f.Value.stringValue(),16);if(!isNaN(h)){this.MainFrm.iBrightColor=((h&16711680)>>16)+(h&65280)+((h&255)<<16)}}catch(d){}break;case"_ICD_VIBRANT_COLOR":try{var h=parseInt(f.Value.stringValue(),16);if(!isNaN(h)){this.MainFrm.iVibrantColor=((h&16711680)>>16)+(h&65280)+((h&255)<<16)}}catch(d){}break;case"GlobalToolbarPosition":if(f.Value.stringValue().equals("INSIDE")){this.MainFrm.ParamsObj().GlobalToolbarPosition=Glb.GLOBALTOOLBARPOSITION_INSIDE}if(f.Value.stringValue().equals("UNDER")){this.MainFrm.ParamsObj().GlobalToolbarPosition=Glb.GLOBALTOOLBARPOSITION_UNDER}break}}IDVariant.InitDefaultMasks(this.MainFrm.ParamsObj().DefaultDateMask,this.MainFrm.ParamsObj().DefaultTimeMask)};RTCEngine.prototype.ResetData=function(b){this.AttData=null;if(b.length>0){for(var a=0;a<this.DataCache.Count();a++){var c=this.DataCache[a];if(b.equals(c.iGuid)){this.DataCache.RemoveAt(a);break}}}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,143,"RTCEngine.ResetData","RTC: re-reading all RTC data");this.DataCache.Clear();this.AlreadyInit=false;this.ValueListCache.clear();this.MainFrm.QwlRoles.clear();this.ConfigureMain();this.ConfigureRoles();this.MainFrm.RTCReset()}};RTCEngine.prototype.LoadRS=function(o,n){var l=this.MainFrm;try{var q=new StringTokenizer();q.setString(new IDVariant(n),new IDVariant(","));var u=q.next();var d=q.next();var m=q.next();var s=q.next();var c=(u.stringValue().length!=0?u.stringValue():"NULL");var g=(d.stringValue().length!=0?d.stringValue():"NULL");var h=(m.stringValue().length!=0?m.stringValue():"NULL");var b=(s.stringValue().length!=0?s.stringValue():"NULL");var f="";f+="where (RTC_User = "+g+") ";f+="and   (RTC_Group = "+h+") ";f+="and   (RTC_Language = "+c+") ";if(o.equals("Constants")){f+="and (RTC_Form = "+b+" or "+b+" is NULL or RTC_Form is NULL) "}else{f+="and (RTC_Form = "+b+" or "+b+" is NULL) "}var j="select * from RTCU_"+o+" "+f;if(!o.equals("ErrorMessages")){j+=" order by RTC_Parent, RTC_Sequence"}var a=this.DB.OpenRS(j);if(!a.EOF()){a.MoveFirst()}return a}catch(k){l.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",122,"RTCEngine.LoadRS","RTC: Can't load data for "+o+" (Error = "+k.message+")");l.DTTObj.AddMsgToken("","SQL",new IDVariant(j));return new IDCachedRowSet()}};RTCEngine.prototype.SearchObject=function(b,d,a,h){try{var c=b.getRow();while(!b.EOF()){if(b.Get("RTC_Guid").stringValue().equals(d)){return true}b.MoveNext()}b.MoveFirst();while(b.getRow()<c){if(b.Get("RTC_Guid").stringValue().equals(d)){return true}b.MoveNext()}if(h){if(d!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,d,123,"RTCEngine.SearchObject","RTC: Object "+d+" not found")}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,d,123,"RTCEngine.SearchObject","RTC: Object "+a+" not found")}}}catch(f){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,d,124,"RTCEngine.SearchObject","RTC: Error while searching object "+(d!=null?d:a)+" (Error = "+f.message+")")}return false};RTCEngine.prototype.GetWhereClause=function(b){var a=" ";a+=IDL.CSql(new IDVariant(this.MainFrm.RolObj.glbLanguage),IDL.FMT_CHAR,this.DB)+",";a+=IDL.CSql(new IDVariant(this.MainFrm.RolObj.glbUserID),IDL.FMT_NUM,this.DB)+",";a+=IDL.CSql(new IDVariant(this.MainFrm.RolObj.glbGroup),IDL.FMT_NUM,this.DB)+",";if(b.length==0){a+="NULL"}else{a+=IDL.CSql(new IDVariant(b),IDL.FMT_CHAR,this.DB)}return a};RTCEngine.prototype.GetValueList=function(a){return this.ValueListCache[a]};RTCEngine.prototype.ConfigureErrorMessages=function(b){var d=this.MainFrm;d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,144,"RTCEngine.ConfigureErrorMessages","RTC: Configuring application error messages");try{var a=this.LoadRS("ErrorMessages",this.GetWhereClause(b));if(!a.EOF()){d.ErrObj.ConfigureErrorMessages(a)}}catch(c){d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,145,"RTCEngine.ConfigureErrorMessages","RTC: Error while configuring error messages (Error = "+c.message+")")}};RTCEngine.prototype.ConfigureRoles=function(){if(!this.AlreadyInit){return}if(this.Enabled){var d=this.MainFrm;d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",146,"RTCEngine.ConfigureRoles","RTC: Configuring application roles");try{var a=this.LoadRS("Roles",this.GetWhereClause(this.AppGuid));if(!a.EOF()){var b=this.LoadRS("RoleItems",this.GetWhereClause(this.AppGuid));d.RolObj.ConfigureRoles(a,b)}}catch(c){d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",147,"RTCEngine.ConfigureRoles","RTC: Error while configuring roles (Error = "+c.message+")")}}};RTCEngine.prototype.GetHash=function(b){if(this.RTCHash.Type==IDVariant.NULL||b){this.MainFrm.OpenConnection(this.DB);try{var c="select RTC_Hash from RTC_Parameters";c+=" where (RTC_Language = '"+this.MainFrm.RolObj.glbLanguage+"')";c+=" and   (RTC_User = "+this.MainFrm.RolObj.glbUserID+")";c+=" and   (RTC_Group = "+this.MainFrm.RolObj.glbGroup+")";var a=this.DB.OpenRSR(c);if(!a.EOF()){this.RTCHash=a.Get(1,IDVariant.STRING)}a.Close()}catch(d){}}return this.RTCHash};RTCEngine.prototype.GetTimestamp=function(b){if(this.RTCTimestamp.Type==IDVariant.NULL||b){this.MainFrm.OpenConnection(this.DB);try{var c="select RTC_Timestamp from RTC_Parameters";c+=" where (RTC_Language = '"+this.MainFrm.RolObj.glbLanguage+"')";c+=" and   (RTC_User = "+this.MainFrm.RolObj.glbUserID+")";c+=" and   (RTC_Group = "+this.MainFrm.RolObj.glbGroup+")";var a=this.DB.OpenRSR(c);if(!a.EOF()){this.RTCTimestamp=a.Get(1,IDVariant.DATETIME)}a.Close()}catch(d){}}return this.RTCTimestamp};RTCEngine.prototype.Sync=function(){var c=this.MainFrm.SyncObject;if(c.CheckSyncServer()){var g="";g+='<rtc username="'+Glb.HTMLEncode(c.ClientUsername)+'"';g+=' password="'+Glb.HTMLEncode(c.ClientPassword)+'"';g+=' lang="'+Glb.HTMLEncode(this.MainFrm.RolObj.glbLanguage)+'"';g+=' uid="'+Glb.HTMLEncode(this.MainFrm.RolObj.glbUserID)+'"';g+=' gid="'+Glb.HTMLEncode(this.MainFrm.RolObj.glbGroup)+'"';g+=' app="'+Glb.HTMLEncode(this.AppGuid)+'"';if(this.GetHash().stringValue()){g+=' hash="'+Glb.HTMLEncode(this.GetHash().stringValue())+'"'}g+="></rtc>";var b=XMLDoc.FT_JSON;var d=new IDMap();d.set_Value(new IDVariant("SYNCDATA"),new IDVariant(g));d.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));d.set_Value(new IDVariant("FTR"),new IDVariant(b));d.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));var a=IDL.HttpRequest(this.MainFrm,new IDVariant(c.ServerURL),d);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"RTCEngine.Sync","Received "+a.stringValue().length+" bytes from server");if(a.stringValue().length<50000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",a.stringValue())}if(b!=XMLDoc.FT_XML&&a.stringValue().startsWith("<")){b=XMLDoc.FT_XML}var e=new XMLDoc();if(!e.LoadFromString(a.stringValue(),b)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"RTCEngine.Sync","Parse XML failed")}var f=e.GetNextNode();if(f!=null&&f.Name()=="xml"){f=e.GetNextNode()}if(f!=null&&f.Name()=="rtc"&&f.HasNextNode()){if(!c.CheckResponse(f,"RTCEngine.Sync")){return}this.MainFrm.OpenConnection(this.DB);this.DB.BeginTrans();RTCEngine.prototype.SyncTR=function(){while(f.HasNextNode()){var j=f.GetNextNode();var t=j.Name();var q=new IDCachedRowSet();if(b==XMLDoc.FT_XML){q.LoadFromXML(Glb.HTMLDecode(j.GetAttribute("rs"),true),true)}else{q.LoadFromXMLNode(j)}this.MainFrm.DTTObj.AddQuery("RTCEngine.Sync","RTC Table "+t,"SyncService.Query",DTTEngine.STMT_QRY_SELECT,"select * from "+t);this.MainFrm.DTTObj.AddDBDataSource(q,"select * from "+t);this.MainFrm.DTTObj.EndQuery("RTCEngine.Sync");var v=null;try{v=this.DB.OpenRS("select * from "+t)}catch(m){}if(v&&v.RecordCount()==0){var s="drop table "+t;this.DB.Execute(s);v=null}var l;if(v){for(var o=1;o<=q.getMetaData().getColumnCount();o++){var r=q.getMetaData().getColumnName(o);if(v.findColumn(r)==-1){var u=q.getMetaData().getColumnType(o);var h;if(u==IDVariant.INTEGER){h="integer"}else{if(r.toUpperCase().indexOf("GUID")!=-1){h="varchar(36)"}else{h="varchar(2000)"}}l="alter table "+t+" add column "+r+" "+h;this.MainFrm.DTTObj.AddQuery("RTCEngine.Sync","Updating table "+t,"SyncService.Query",DTTEngine.STMT_QRY_SELECT,l);this.DB.Execute(l);this.MainFrm.DTTObj.EndQuery("RTCEngine.Sync")}}}else{l="create table "+t+"(";l+=" RTC_Guid variant(36) not null,";l+=" RTC_Parent variant(36),";l+=" RTC_Language variant(4) not null,";l+=" RTC_Group integer not null,";l+=" RTC_User integer not null,";l+=" RTC_Sequence integer,";l+=" RTC_Form variant(36)";var y=l.toLowerCase();for(var o=1;o<=q.getMetaData().getColumnCount();o++){var r=q.getMetaData().getColumnName(o);var u=q.getMetaData().getColumnType(o);if(y.indexOf(r.toLowerCase()+" ")!=-1){continue}var h;if(u==IDVariant.INTEGER){h="integer"}else{if(r.toUpperCase().indexOf("GUID")!=-1){h="varchar(36)"}else{h="varchar(2000)"}}l+=", "+r+" "+h}l+=")";this.MainFrm.DTTObj.AddQuery("RTCEngine.Sync","Creating table "+t,"SyncService.Query",DTTEngine.STMT_QRY_SELECT,l);this.DB.Execute(l);this.MainFrm.DTTObj.EndQuery("RTCEngine.Sync")}l="delete from "+t;l+=" where (RTC_Language = '"+this.MainFrm.RolObj.glbLanguage+"')";l+=" and   (RTC_User = "+this.MainFrm.RolObj.glbUserID+")";l+=" and   (RTC_Group = "+this.MainFrm.RolObj.glbGroup+")";this.DB.Execute(l);q.MoveFirst();var k="insert into "+t+"(";for(var o=1;o<=q.getMetaData().getColumnCount();o++){var r=q.getMetaData().getColumnName(o);k+=r;if(o!=q.getMetaData().getColumnCount()){k+=","}else{k+=")"}}k+=" values(";while(!q.EOF()){l=k;for(var o=1;o<=q.getMetaData().getColumnCount();o++){var r=q.getMetaData().getColumnName(o);var n=q.Get(r);if(n.Type==IDVariant.STRING){n=IDL.Quote(n)}else{if(n.Type==IDVariant.NULL){n="null"}}l+=(o==1?"":",")+n}l+=")";this.DB.Execute(l);q.MoveNext()}}var x=f.GetAttribute("hash");try{this.DB.OpenRS("select * from RTC_Parameters")}catch(m){l="create table RTC_Parameters(";l+=" RTC_Hash variant(36) not null,";l+=" RTC_Language variant(4) not null,";l+=" RTC_Group integer not null,";l+=" RTC_User integer not null,";l+=" RTC_Timestamp datetime not null)";this.DB.Execute(l)}l="update RTC_Parameters set ";l+=" RTC_Hash = '"+x+"',";l+=" RTC_Timestamp = datetime('now','localtime')";l+=" where (RTC_Language = '"+this.MainFrm.RolObj.glbLanguage+"')";l+=" and   (RTC_User = "+this.MainFrm.RolObj.glbUserID+")";l+=" and   (RTC_Group = "+this.MainFrm.RolObj.glbGroup+")";this.DB.Execute(l);if(this.DB.RecordsAffected()==0){l="insert into RTC_Parameters(RTC_Hash, RTC_Timestamp, RTC_Language, RTC_User, RTC_Group) values (";l+=" '"+x+"',";l+=" datetime('now','localtime'),";l+=" '"+this.MainFrm.RolObj.glbLanguage+"',";l+=this.MainFrm.RolObj.glbUserID+",";l+=this.MainFrm.RolObj.glbGroup+")";this.DB.Execute(l)}this.DB.CommitTrans();this.RTCHash=new IDVariant(x);this.RTCTimestamp=IDL.Now()};this.DB.ExecuteTrans(RTCEngine.prototype.SyncTR,this)}}};function ServerSessionManager(c){this.DBName="SSManager";if(c){if(Shell.UseShellForSS()){Shell.SendSSCmd("","StartSession")}else{var a=TryOpenDatabase(this.DBName,"",this.DBName,5*1024*1024);try{a.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS Sessions")});var b="CREATE TABLE Sessions\n";b+="(\n";b+="  SessionName     varchar(52) not null primary key,\n";b+="  QueryString     varchar(250),\n";b+="  FromSessionName varchar(52),\n";b+="  Result          varchar(9999999),\n";b+="  Phase           varchar(250),\n";b+="  Progress        double default -1,\n";b+="  Aborted         integer default 0\n";b+=")";a.transaction(function(e){e.executeSql(b)});b="INSERT INTO Sessions (SessionName) VALUES ('')";a.transaction(function(e){e.executeSql(b)})}catch(d){WriteToConsoleError("Error while creating the database of sessions")}finally{if(a&&a.close){a.close()}}}}}ServerSessionManager.prototype.StartSession=function(a,d,b){if(b==undefined){b=""}if(this.ExistsSession(d)){return false}if(Shell.UseShellForSS()){Shell.SendSSCmd(d,"StartSession")}else{var c="INSERT INTO Sessions (SessionName, QueryString) VALUES ("+IDL.Quote(d)+", "+IDL.Quote(b)+")";this.ExecuteQuery(c)}myPostMessage({type:"SSM",message:"Start",name:d,qs:b});return true};ServerSessionManager.prototype.EndSession=function(b,a){if(a==undefined){a=false}if(this.ExistsSession(b)){myPostMessage({type:"SSM",message:"End",name:b,kill:a});return true}return false};ServerSessionManager.prototype.Terminate=function(){var c=this.ServerSessions.keys();for(var a=0;a<c.length;a++){var b=c[a];this.EndSession(b,true)}};ServerSessionManager.prototype.RemoveSession=function(b){try{if(Shell.UseShellForSS()){Shell.SendSSCmd(b,"RemoveSession")}else{var a="DELETE FROM Sessions WHERE SessionName = "+IDL.Quote(b);this.ExecuteQuery(a)}myPostMessage({type:"SSM",message:"Remove",name:b})}catch(c){WriteToConsoleError("Error while removing session "+b)}};ServerSessionManager.prototype.ExistsSession=function(c){try{if(Shell.UseShellForSS()){return Shell.SendSSCmd(c,"ExistsSession")}else{var b="SELECT QueryString FROM Sessions WHERE SessionName = "+IDL.Quote(c)+"";var a=this.ExecuteQuery(b);return(a.rows.length==1)}}catch(d){WriteToConsoleError("Error while reading session '"+c+"'")}return false};ServerSessionManager.prototype.SendMessage=function(h,f,d,a){try{var c;if(Shell.UseShellForSS()){c=Shell.SendSSCmd(h,"SendMessage",{to:f})}else{var g="UPDATE Sessions SET";g+=" FromSessionName = "+IDL.Quote(h)+",";g+=" Result = '1;0'";g+=" WHERE SessionName = "+IDL.Quote(f);g+=" AND FromSessionName IS NULL";var b=this.ExecuteQuery(g,true);c=(b.rowsAffected==1)}if(!c){return false}}catch(j){WriteToConsoleError("Error while sending message '"+d+"' to '"+f+"'")}myPostMessage({type:"SSM",message:"Message",name:f,from:h,msg:d,args:a.GetNative()});return true};ServerSessionManager.prototype.GetProgress=function(f,c){if(c==undefined){c=false}var b=-1;try{if(Shell.UseShellForSS()){b=parseFloat(Shell.SendSSCmd(f,"GetProgress",{aborted:c}))}else{var d="SELECT Phase, Progress";d+=" FROM Sessions";d+=" WHERE SessionName = "+IDL.Quote(f);var a=this.ExecuteQuery(d);if(a.rows.length==1){b=(a.rows.item(0)["Progress"]+0)}}}catch(g){WriteToConsoleError("Error while reading progress of '"+f+"'")}if(c&&!Shell.UseShellForSS()){try{var d="UPDATE Sessions SET";d+=" Progress = -1,";d+=" Aborted = -1";d+=" WHERE SessionName = "+IDL.Quote(f);this.ExecuteQuery(d)}catch(g){WriteToConsoleError("Error while aborting progress of '"+f+"'")}}return b};ServerSessionManager.prototype.SetLowPriority=function(b,a){};ServerSessionManager.prototype.ExecuteQuery=function(d,c){var b=TryOpenDatabase(this.DBName,"",this.DBName,5*1024*1024);var a=null;try{b.transaction(function(e){a=e.executeSql(d)});if(c&&b.rowsAffected){a.rowsAffected=b.rowsAffected()}}catch(f){throw f}finally{if(b&&b.close){b.close()}}return a};function ServerSession(b,a,c){this.SessionName="";this.MainFrm;this.Unloading=false;this.iMessage;this.iArgs;this.iFromSessionName="";this.iResult=new IDVariant();this.SessionName=a;if(c!=null&&c.equals("§")){this.MainFrm=b}else{this.MainFrm=b.CreateWEP();this.MainFrm.SessionQueryString=c}this.MainFrm.SessionName=this.SessionName}ServerSession.prototype.Stop=function(a){this.Unloading=true;if(a){self.close()}};ServerSession.prototype.Init=function(){self.RD4_WebEntryPoint=this.MainFrm;if(self.RD4_PreInit){for(var i=0;i<self.RD4_PreInit.length;i++){eval(self.RD4_PreInit[i])}}try{this.MainFrm.HandleRequest(null,null);this.Tick()}catch(e){this.MainFrm.DTTObj.AddException("","ServerSession.Init","Exception during Init: ",e)}};ServerSession.prototype.Tick=function(){if(!this.Unloading){try{this.MainFrm.DTTObj.AddRequest(this.MainFrm);this.MainFrm.DTTObj.SetRequestName("Session Tick","Server Session Tick",DTTRequest.PRI_ITEM);this.MainFrm.TimerObj.Tick(this.MainFrm);this.HandleMessage();this.MainFrm.UpdateIMDBState();this.MainFrm.CloseAllDBConnections();if(this.MainFrm.DTTObj.IsEmptyRequest()){this.MainFrm.DTTObj.CancelRequest()}else{this.MainFrm.DTTObj.EndRequest()}self.setTimeout("self.RD4_ServerSession.Tick()",50)}catch(a){this.MainFrm.DTTObj.AddException("","ServerSession.Tick","Exception during handling Tick: ",a)}}else{this.MainFrm._WebEntryPoint()}};ServerSession.prototype.SendMessage=function(c,b,a){this.iMessage=b;this.iArgs=a;this.iFromSessionName=c;this.iResult.set(new IDVariant(0));return this.iResult};ServerSession.prototype.HandleMessage=function(){if(typeof this.iMessage=="undefined"){return}try{var g;if(Shell.UseShellForSS()){g=Shell.SendSSCmd(this.SessionName,"HandleMessage")}else{var h="UPDATE Sessions SET";h+=" Result = '1;-1'";h+=" WHERE SessionName = "+IDL.Quote(this.SessionName);h+=" AND Result = '1;0'";var c=WebEntryPointSrv.SSManager.ExecuteQuery(h,true);g=(c.rowsAffected==1)}if(g){this.iResult.set(new IDVariant(-1))}else{delete this.iMessage;return}}catch(j){this.MainFrm.DTTObj.AddException("","MainFrm.HandleMessage","Error while beginning to handle message '"+this.iMessage+"' of '"+this.iFromSessionName+"'",j)}var f=new IDVariant();this.MainFrm.DTTObj.SetRequestName("Session Message "+this.iMessage,"Handle Session Message "+this.iMessage,DTTRequest.PRI_CMD);try{if(this.iMessage.equals(Glb.ITEM_DTT)){var d=this.iArgs.GetNative();var a=new XMLDoc();var b=a.AddNewElement("debug");b.SetAttribute("par1",d[1].stringValue());b.SetAttribute("par2",d[2].stringValue());this.MainFrm.DTTObj.Render(this.MainFrm,d[0].stringValue(),b);a=new XMLDoc();b=a.AddNewElement("debug");b.SetAttribute("WIN",this.MainFrm.DebugWindow);b.SetAttribute("IL",this.MainFrm.DebugItemList);b.SetAttribute("CMD",this.MainFrm.DebugCmdForm);b.SetAttribute("DET",this.MainFrm.DebugDetail);b.SetAttribute("TOP",this.MainFrm.DebugReqTop);b.SetAttribute("REF",this.MainFrm.DebugReqRef);b.SetAttribute("PRC",this.MainFrm.DebugReqPrc);this.MainFrm.DebugWindow="";this.MainFrm.DebugItemList="";this.MainFrm.DebugCmdForm="";this.MainFrm.DebugDetail="";this.MainFrm.DebugReqTop="";this.MainFrm.DebugReqRef="";this.MainFrm.DebugReqPrc="";this.MainFrm.SendDebug=false;f=new IDVariant(a.SaveToString())}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",400,"MainFrm.OnSessionMessage","Firing OnSessionMessage event");this.MainFrm.DTTObj.AddParameter("","","SessionName",this.iFromSessionName);this.MainFrm.DTTObj.AddParameter("","","Message",this.iMessage);this.MainFrm.DTTObj.AddParameter("","","Parameters.Count",this.iArgs.Size());this.MainFrm.DTTObj.AddParameter("","","Result",f);this.MainFrm.OnSessionMessage(new IDVariant(this.iFromSessionName),new IDVariant(this.iMessage),this.iArgs,f);if(f.Type==IDVariant.NULL){f=new IDVariant(1)}}}catch(j){f=new IDVariant(2);this.MainFrm.DTTObj.AddException("","MainFrm.HandleMessage","Exception while handling message",j)}if(this.iResult.Equals(new IDVariant(-1))){this.iResult.set(f)}try{if(Shell.UseShellForSS()){Shell.SendSSCmd(this.SessionName,"SetResult",{result:f.Type+";"+f.stringValue()})}else{var h="UPDATE Sessions SET";h+=" Result = "+IDL.Quote(f.Type+";"+f.stringValue());h+=" WHERE SessionName = "+IDL.Quote(this.SessionName);h+=" AND Result = '1;-1'";WebEntryPointSrv.SSManager.ExecuteQuery(h)}}catch(j){this.MainFrm.DTTObj.AddException("","MainFrm.HandleMessage","Error while ending to handle message '"+this.iMessage+"' of '"+this.iFromSessionName+"'",j)}finally{delete this.iMessage}};function TimerHandlerSrv(a){this.Timers=new Array();this.MainFrm=a;if(a!=undefined){if(a.ParamsObj().MAX_TIMERS>0){this.Timers=new Array(a.ParamsObj().MAX_TIMERS+1)}}}TimerHandlerSrv.FilledTo=0;TimerHandlerSrv.prototype.AppendTo=function(a){};TimerHandlerSrv.prototype.set_Enabled=function(a,b){this.Timers[a].set_bEnabled(b)};TimerHandlerSrv.prototype.Enabled=function(a){return this.Timers[a].bEnabled()};TimerHandlerSrv.prototype.set_NumTicks=function(a,b){this.Timers[a].NumTicks=b;this.Timers[a].RD3Change(RD3Glb.TIM_NUMTICKS)};TimerHandlerSrv.prototype.NumTicks=function(a){return this.Timers[a].NumTicks};TimerHandlerSrv.prototype.set_Interval=function(a,b){this.Timers[a].Interval=b;this.Timers[a].MilliSec=0;this.Timers[a].RD3Change(RD3Glb.TIM_INTERVAL)};TimerHandlerSrv.prototype.Interval=function(a){return this.Timers[a].Interval};TimerHandlerSrv.prototype.ActivateTimers=function(c,a){for(var d=1;d<this.Timers.length;d++){if(this.Timers[d]==null){continue}if(this.Timers[d].IdxForm==c){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Timers[d].iGuid,35,"TimerHandler.ActivateTimer","Timer "+this.Timers[d].Code+(a?" activated":" deactivated"))}this.Timers[d].set_Active(a)}}if(c>65536&&!a){this.CloseMultipleForm(c)}};TimerHandlerSrv.prototype.Tick=function(a){if(a.ParamsObj().UseRD3){return}for(var b=1;b<this.Timers.length;b++){if(this.Timers[b]==null){continue}if(this.Timers[b].ServerSession!=this.MainFrm.IsServerSession()){continue}this.Timers[b].Tick(a)}};TimerHandlerSrv.prototype.OpenMultipleForm=function(e){var d=e&65535;var f=0;var a=0;for(var b=1;b<this.Timers.length;b++){if(this.Timers[b]!=null&&this.Timers[b].IdxForm==d){if(f==0){f=b}a++}}if(a==0){return 0}var c=Glb.GetObjects(this.Timers,a,TimerHandlerSrv.FilledTo);if(c==0){c=this.Timers.length;Array.resize(this.Timers,c+a)}for(var b=0;b<a;b++){this.Timers[c+b]=new ATimerSrv();this.Timers[c+b].CopyFrom(this.Timers[f+b]);this.Timers[c+b].IdxForm=e;this.Timers[c+b].Index=c+b}return c-f};TimerHandlerSrv.prototype.CloseMultipleForm=function(b){for(var a=1;a<this.Timers.length;a++){if(this.Timers[a]!=null&&this.Timers[a].IdxForm==b){this.Timers[a]=null}}};TimerHandlerSrv.prototype.GetRD3Name=function(){return"tmh"};TimerHandlerSrv.prototype.RD3RenderDifferences=function(d,g,a){if(this.Timers.length==0){return false}var f=null;if(g){f=d.AddNewElement(this.GetRD3Name())}else{for(var c=0;c<this.Timers.length;c++){if(this.Timers[c]!=null&&this.Timers[c].RD3NewObj){f=d.AddNewElement("ins");f.SetAttribute("parid",this.GetRD3Name());break}}}var e=false;var b=(g)?f:d;for(var c=1;c<this.Timers.length;c++){if(this.Timers[c]==null){continue}if(a>0&&this.Timers[c].IdxForm!=a){continue}if(this.Timers[c].ServerSession){continue}if(this.Timers[c].RD3NewObj){this.Timers[c].RD3RenderDifferences(f,true);this.Timers[c].RD3NewObj=false}else{e|=this.Timers[c].RD3RenderDifferences(b,g)}}return e};function ScreenZoneSrv(c,a,d,b){this.Index;this.iPosition;this.iTabVisibility=Glb.SCRZONE_AUTTAB;this.iShowPin=true;this.iZoneState=Glb.SCRZONE_PINNEDZONE;this.iSelectedForm=Glb.SCRZONE_SELECTEDNONE;this.iZoneSize=240;this.iVerticalBehaviour=Glb.SCRZONE_VERTICALCOLLAPSE;this.iTabPosition;this.iSwipeMode=Glb.SCRZONE_SWIPECOLLAPSABLE;this.iHasMobileMenu=false;this.WebEntryPoint;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.SCZ_MAXPROPS);if(c!=undefined){this.MainFrm=c;this.Index=a;this.set_Position(d);this.set_TabPosition(b);if(this.MainFrm.IsMobile()){this.iZoneSize=-10;if((this.MainFrm.MenuType==Glb.MENUTYPE_LEFTSB||this.MainFrm.MenuType==Glb.MENUTYPE_GROUPED)&&this.iPosition==Glb.FORMDOCK_LEFT){this.iHasMobileMenu=true}if((this.MainFrm.MenuType==Glb.MENUTYPE_RIGHTSB||this.MainFrm.MenuType==Glb.MENUTYPE_GROUPEDR)&&this.iPosition==Glb.FORMDOCK_RIGHT){this.iHasMobileMenu=true}if(this.iHasMobileMenu){this.iSelectedForm=Glb.SCRZONE_SELECTEDMENU;this.iVerticalBehaviour=Glb.SCRZONE_VERTICALHIDE}if(this.iPosition==Glb.FORMDOCK_TOP||this.iPosition==Glb.FORMDOCK_BOTTOM){this.iVerticalBehaviour=Glb.SCRZONE_VERTICALNOCHANGE}}}}ScreenZoneSrv.prototype.Position=function(){return this.iPosition};ScreenZoneSrv.prototype.set_Position=function(a){this.iPosition=a;this.RD3Change(RD3Glb.SCZ_POSITION)};ScreenZoneSrv.prototype.TabVisibility=function(){return this.iTabVisibility};ScreenZoneSrv.prototype.set_TabVisibility=function(a){this.iTabVisibility=a;this.RD3Change(RD3Glb.SCZ_TABVISIBILITY)};ScreenZoneSrv.prototype.ShowPin=function(){return this.iShowPin};ScreenZoneSrv.prototype.set_ShowPin=function(a){this.iShowPin=a;this.RD3Change(RD3Glb.SCZ_SHOWPIN)};ScreenZoneSrv.prototype.ZoneState=function(){return this.iZoneState};ScreenZoneSrv.prototype.set_ZoneState=function(a){this.iZoneState=a;this.RD3Change(RD3Glb.SCZ_ZONESTATE)};ScreenZoneSrv.prototype.SelectedForm=function(){return this.iSelectedForm};ScreenZoneSrv.prototype.set_SelectedForm=function(c){this.iSelectedForm=c;this.RD3Change(RD3Glb.SCZ_SELECTEDFORM);for(var a=0;a<this.MainFrm.StackForm.Count();a++){var b=this.MainFrm.StackForm.Get(a);if(b.FormIdx==c){b.Form_Activate();b.SubForm_Activate();break}}};ScreenZoneSrv.prototype.ZoneSize=function(){return this.iZoneSize};ScreenZoneSrv.prototype.set_ZoneSize=function(a){this.iZoneSize=a;this.RD3Change(RD3Glb.SCZ_ZONESIZE)};ScreenZoneSrv.prototype.VerticalBehaviour=function(){return this.iVerticalBehaviour};ScreenZoneSrv.prototype.set_VerticalBehaviour=function(a){this.iVerticalBehaviour=a;this.RD3Change(RD3Glb.SCZ_VERTICALBEHAVIOUR)};ScreenZoneSrv.prototype.TabPosition=function(){return this.iTabPosition};ScreenZoneSrv.prototype.set_TabPosition=function(a){this.iTabPosition=a;this.RD3Change(RD3Glb.SCZ_TABPOSITION)};ScreenZoneSrv.prototype.SwipeMode=function(){return this.iSwipeMode};ScreenZoneSrv.prototype.set_SwipeMode=function(a){this.iSwipeMode=a;this.RD3Change(RD3Glb.SCZ_SWIPEMODE)};ScreenZoneSrv.prototype.GetForms=function(){var c=new IDArray();var d=this.MainFrm.StackForm.Count();for(var a=0;a<d;a++){var b=this.MainFrm.StackForm.Get(a);if(b.Docked&&b.DockType==this.Position()){c.add_Object(b)}}return c};ScreenZoneSrv.prototype.ActivateNextForm=function(){var a=this.GetForms();if(a.Size()==0){if(this.iHasMobileMenu){this.set_SelectedForm(Glb.SCRZONE_SELECTEDMENU)}else{this.set_SelectedForm(Glb.SCRZONE_SELECTEDNONE)}}else{this.set_SelectedForm((a.get_Object(new IDVariant(0))).FormIdx)}};ScreenZoneSrv.prototype.AddForm=function(d){var f=this.MainFrm.StackForm.Count();for(var a=0;a<f;a++){var c=this.MainFrm.StackForm.Get(a);if(c.Docked&&c.DockType==this.Position()&&c.FormIdx==d.FormIdx){return}}if(d.Docked&&d.DockType!=this.Position()){var e=this.MainFrm.ScreenZone(d.DockType);var b=false;if(e.SelectedForm()==d.FormIdx){b=true}d.DockType=this.Position();d.RD3Change(RD3Glb.FRM_DOCKTYPE);if(b){e.ActivateNextForm()}}else{d.Docked=true;d.DockType=this.Position();d.RD3Change(RD3Glb.FRM_DOCKED);d.RD3Change(RD3Glb.FRM_DOCKTYPE);this.MainFrm.ActivateNextForm()}if(this.SelectedForm()==Glb.SCRZONE_SELECTEDNONE){this.set_SelectedForm(d.FormIdx)}};ScreenZoneSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};ScreenZoneSrv.prototype.GetRD3Name=function(){return"scz"};ScreenZoneSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ScreenZoneSrv.prototype.RD3RenderDifferences=function(c,f){var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}if(e==null&&this.RD3Changed){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||f){this.SetRD3Property(b,e,f)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(f){}var a=(f)?e:c;return d};ScreenZoneSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.SCZ_POSITION:c.SetAttribute("pos",this.iPosition.toString());break;case RD3Glb.SCZ_TABVISIBILITY:if(this.iTabVisibility==Glb.SCRZONE_AUTTAB&&b){break}c.SetAttribute("tvs",this.iTabVisibility.toString());break;case RD3Glb.SCZ_SHOWPIN:if(this.iShowPin==true&&b){break}c.SetAttribute("spn",this.iShowPin?"1":"0");break;case RD3Glb.SCZ_ZONESTATE:if(this.iZoneState==Glb.SCRZONE_PINNEDZONE&&b){break}c.SetAttribute("zst",this.iZoneState.toString());break;case RD3Glb.SCZ_SELECTEDFORM:c.SetAttribute("sel",this.iSelectedForm.toString());break;case RD3Glb.SCZ_ZONESIZE:if(this.iZoneSize==240&&b){break}c.SetAttribute("siz",this.iZoneSize.toString());break;case RD3Glb.SCZ_VERTICALBEHAVIOUR:if(this.iVerticalBehaviour==Glb.SCRZONE_VERTICALCOLLAPSE&&b){break}c.SetAttribute("vbh",this.iVerticalBehaviour.toString());break;case RD3Glb.SCZ_TABPOSITION:c.SetAttribute("tps",this.iTabPosition.toString());break;case RD3Glb.SCZ_HASMENU:if(this.iHasMobileMenu==false&&b){break}c.SetAttribute("hmm",this.iHasMobileMenu?"1":"0");break;case RD3Glb.SCZ_SWIPEMODE:if(this.iSwipeMode==Glb.SCRZONE_SWIPECOLLAPSABLE&&b){break}c.SetAttribute("swm",this.iSwipeMode.toString());break}};function VisAttrListSrv(){this.iVisAttrObj;this.iVisIdxMap=null;this.iVisIdxMapInv=null}VisAttrListSrv.prototype.Size=function(){return this.iVisAttrObj.length};VisAttrListSrv.prototype.set_Size=function(a){this.iVisAttrObj=new Array(a+1)};VisAttrListSrv.prototype.VisualAttribute=function(a){return this.iVisAttrObj[a]};VisAttrListSrv.prototype.set_VisualAttribute=function(a,b){this.iVisAttrObj[a]=b;b.Index=a};VisAttrListSrv.prototype.Derived=function(a){return this.iVisAttrObj[a].Derived()};VisAttrListSrv.prototype.set_Derived=function(a,b){this.iVisAttrObj[a].set_Derived(b)};VisAttrListSrv.prototype.Alignment=function(a,b){return this.iVisAttrObj[a].Alignment(b)};VisAttrListSrv.prototype.set_Alignment=function(a,c,b){this.iVisAttrObj[a].set_Alignment(c,b)};VisAttrListSrv.prototype.ControlType=function(a){return this.iVisAttrObj[a].ControlType()};VisAttrListSrv.prototype.set_ControlType=function(a,b){this.iVisAttrObj[a].set_ControlType(b)};VisAttrListSrv.prototype.Mask=function(a){return this.iVisAttrObj[a].Mask()};VisAttrListSrv.prototype.set_Mask=function(a,b){this.iVisAttrObj[a].set_Mask(b)};VisAttrListSrv.prototype.Cursor=function(a){return this.iVisAttrObj[a].Cursor()};VisAttrListSrv.prototype.set_Cursor=function(a,b){this.iVisAttrObj[a].set_Cursor(b)};VisAttrListSrv.prototype.RowOffset=function(a){return this.iVisAttrObj[a].RowOffset()};VisAttrListSrv.prototype.set_RowOffset=function(a,b){this.iVisAttrObj[a].set_RowOffset(b)};VisAttrListSrv.prototype.HeaderOffset=function(a){return this.iVisAttrObj[a].HeaderOffset()};VisAttrListSrv.prototype.set_HeaderOffset=function(a,b){this.iVisAttrObj[a].set_HeaderOffset(b)};VisAttrListSrv.prototype.BorderType=function(a,b){return this.iVisAttrObj[a].BorderType(b)};VisAttrListSrv.prototype.set_BorderType=function(a,c,b){this.iVisAttrObj[a].set_BorderType(c,b)};VisAttrListSrv.prototype.Color=function(a,b){return this.iVisAttrObj[a].Color(b)};VisAttrListSrv.prototype.set_Color=function(a,c,b){this.iVisAttrObj[a].set_Color(c,b)};VisAttrListSrv.prototype.Font=function(a,b){return this.iVisAttrObj[a].Font(b)};VisAttrListSrv.prototype.set_Font=function(a,c,b){this.iVisAttrObj[a].set_Font(c,b)};VisAttrListSrv.prototype.Flags=function(a){return this.iVisAttrObj[a].Flags()};VisAttrListSrv.prototype.set_Flags=function(a,b){this.iVisAttrObj[a].set_Flags(b)};VisAttrListSrv.prototype.CBorColor=function(a,b){return this.iVisAttrObj[a].CBorColor(b)};VisAttrListSrv.prototype.set_CBorColor=function(a,c,b){this.iVisAttrObj[a].set_CBorColor(c,b)};VisAttrListSrv.prototype.CBorWidth=function(a,b){return this.iVisAttrObj[a].CBorWidth(b)};VisAttrListSrv.prototype.set_CBorWidth=function(a,c,b){this.iVisAttrObj[a].set_CBorWidth(c,b)};VisAttrListSrv.prototype.CBorPadding=function(a,b){return this.iVisAttrObj[a].CBorPadding(b)};VisAttrListSrv.prototype.set_CBorPadding=function(a,c,b){this.iVisAttrObj[a].set_CBorPadding(c,b)};VisAttrListSrv.prototype.CBorType=function(a,b){return this.iVisAttrObj[a].CBorType(b)};VisAttrListSrv.prototype.set_CBorType=function(a,c,b){this.iVisAttrObj[a].set_CBorType(c,b)};VisAttrListSrv.prototype.GetVS=function(b){if(b.length==0){return 0}for(var a=1;a<this.iVisAttrObj.length;a++){if(b.equals(this.iVisAttrObj[a].iGuid)){return a}}return 0};VisAttrListSrv.prototype.AdaptWebRect=function(c,f,d,b,a,e){};VisAttrListSrv.prototype.GetWebRect=function(j,e,c,g,a,h,d,b,f){};VisAttrListSrv.prototype.GradCol=function(a,b){return this.iVisAttrObj[a].GradCol(b)};VisAttrListSrv.prototype.set_GradCol=function(a,c,b){this.iVisAttrObj[a].set_GradCol(c,b)};VisAttrListSrv.prototype.GradDir=function(a,b){return this.iVisAttrObj[a].GradDir(b)};VisAttrListSrv.prototype.set_GradDir=function(a,c,b){this.iVisAttrObj[a].set_GradDir(c,b)};VisAttrListSrv.prototype.Opacity=function(a,b){return this.iVisAttrObj[a].Opacity(b)};VisAttrListSrv.prototype.set_Opacity=function(a,c,b){this.iVisAttrObj[a].set_Opacity(c,b)};VisAttrListSrv.prototype.LetterSpacing=function(a){return this.iVisAttrObj[a].LetterSpacing()};VisAttrListSrv.prototype.set_LetterSpacing=function(a,b){this.iVisAttrObj[a].set_LetterSpacing(b)};VisAttrListSrv.prototype.WordSpacing=function(a){return this.iVisAttrObj[a].WordSpacing()};VisAttrListSrv.prototype.set_WordSpacing=function(a,b){this.iVisAttrObj[a].set_WordSpacing(b)};VisAttrListSrv.prototype.HorizontalScale=function(a){return this.iVisAttrObj[a].HorizontalScale()};VisAttrListSrv.prototype.set_HorizontalScale=function(a,b){this.iVisAttrObj[a].set_HorizontalScale(b)};VisAttrListSrv.prototype.GetRD3Name=function(){return"vsl"};VisAttrListSrv.prototype.RD3RenderDifferences=function(d,g){if(this.iVisAttrObj.length==0){return false}var f=null;if(g){f=d.AddNewElement(this.GetRD3Name())}else{for(var c=1;c<this.iVisAttrObj.length;c++){if(this.iVisAttrObj[c].RD3NewObj){f=d.AddNewElement("chg");d.GetNode().insertBefore(f.GetNode(),d.GetNode().childNodes[0]);break}}}if(f!=null){f.SetAttribute("id",this.GetRD3Name())}var e=false;for(var c=1;c<this.iVisAttrObj.length;c++){var b=this.iVisAttrObj[c];var a=(g||b.RD3NewObj)?f:d;e|=b.RD3RenderDifferences(a,g||b.RD3NewObj);b.RD3NewObj=false}return e};VisAttrListSrv.prototype.GetTrueIdx=function(a){return(this.iVisIdxMap==null?a:this.iVisIdxMap[a])};VisAttrListSrv.prototype.GetTrueIdxInverse=function(b,a){if(a==0){return a}if(this.iVisIdxMapInv==null&&b.VisualStyleList.iVisIdxMap==null){return a}if(this.iVisIdxMapInv==null){this.iVisIdxMapInv=new Array(b.GetVisualStyleList().iVisAttrObj.length);for(var c=0;c<b.VisualStyleList.iVisIdxMap.length;c++){this.iVisIdxMapInv[b.VisualStyleList.iVisIdxMap[c]]=c}}if(a>this.iVisIdxMapInv.length){return a}return this.iVisIdxMapInv[a]};VisAttrListSrv.prototype.SynchTo=function(a){this.iVisIdxMap=new Array(this.iVisAttrObj.length);var e=this.iVisAttrObj;this.iVisAttrObj=new Array(e.length);for(var b=1;b<e.length;b++){var d=a.GetVS(e[b].iGuid);if(d==0){d=a.iVisAttrObj.length;Array.resize(a.iVisAttrObj,d+1);a.iVisAttrObj[d]=e[b];a.iVisAttrObj[d].Index=d;a.iVisAttrObj[d].RD3NewObj=true;if(a.iVisAttrObj[d].Derived()!=null){var c=a.GetVS(a.iVisAttrObj[d].Derived().iGuid);a.iVisAttrObj[d].set_Derived(a.iVisAttrObj[c])}}this.iVisIdxMap[b]=d;this.iVisAttrObj[b]=a.iVisAttrObj[d]}};VisAttrObjSrv.MAX_FONTS=6;VisAttrObjSrv.MAX_COLORS=23;VisAttrObjSrv.MAX_BORDERS=6;VisAttrObjSrv.MAX_ALIGNMENTS=3;VisAttrObjSrv.MAX_CUSTBORDERS=4;function VisAttrObjSrv(){this.iAlignment=new Array(VisAttrObjSrv.MAX_ALIGNMENTS+1);for(var a=1;a<=VisAttrObjSrv.MAX_ALIGNMENTS;a++){this.iAlignment[a]=-1}this.iControlType=-1;this.iCursor;this.iMask;this.iMaskAssigned=false;this.iCursorAssigned=false;this.iRowOffset=-1;this.iHeaderOffset=-1;this.iBorderType=new Array(VisAttrObjSrv.MAX_BORDERS+1);for(var a=1;a<=VisAttrObjSrv.MAX_BORDERS;a++){this.iBorderType[a]=-1}this.iColor=new Array(VisAttrObjSrv.MAX_COLORS+1);for(var a=1;a<=VisAttrObjSrv.MAX_COLORS;a++){this.iColor[a]=-2}this.iFont=new Array(VisAttrObjSrv.MAX_FONTS+1);this.iFlags=-1;this.iGuid;this.Index;this.CustColor=new Array(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustWidth=new Array(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustType=new Array(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustPadding=new Array(VisAttrObjSrv.MAX_CUSTBORDERS+1);for(var a=1;a<=VisAttrObjSrv.MAX_CUSTBORDERS;a++){this.CustColor[a]=-2;this.CustWidth[a]=-1;this.CustType[a]=-1;this.CustPadding[a]=-1}this.iGradCol=new Array(VisAttrObjSrv.MAX_COLORS+1);this.iGradDir=new Array(VisAttrObjSrv.MAX_COLORS+1);this.iOpacity=new Array(VisAttrObjSrv.MAX_COLORS+1);for(var a=1;a<=VisAttrObjSrv.MAX_COLORS;a++){this.iGradCol[a]=-1;this.iGradDir[a]=-1;this.iOpacity[a]=-1}this.iLetterSpacing=-1;this.iWordSpacing=-1;this.iHorizontalScale=-1;this.iClassName;this.iClassHeader;this.iDerived;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.VIS_MAXPROP);this.RD3NewObj=false;this.AlignmentDiff=new BitArray(VisAttrObjSrv.MAX_ALIGNMENTS+1);this.BorderTypeDiff=new BitArray(VisAttrObjSrv.MAX_BORDERS+1);this.ColorDiff=new BitArray(VisAttrObjSrv.MAX_COLORS+1);this.FontDiff=new BitArray(VisAttrObjSrv.MAX_FONTS+1);this.CustColorDiff=new BitArray(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustWidthDiff=new BitArray(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustTypeDiff=new BitArray(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustPaddingDiff=new BitArray(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.GradColDiff=new BitArray(VisAttrObjSrv.MAX_COLORS+1);this.GradDirDiff=new BitArray(VisAttrObjSrv.MAX_COLORS+1);this.OpacityDiff=new BitArray(VisAttrObjSrv.MAX_COLORS+1)}VisAttrObjSrv.prototype.Derived=function(){return this.iDerived};VisAttrObjSrv.prototype.set_Derived=function(a){if(this.RD3NewObj){if(this.iControlType==-1&&(this.iDerived==null||this.iDerived.ControlType()!=a.ControlType())){this.iControlType=(this.iDerived!=null?this.iDerived.ControlType():a.ControlType())}if(!this.iMaskAssigned&&(this.iDerived==null||!this.iDerived.Mask().equals(a.Mask()))){this.iMaskAssigned=true;this.iMask=(this.iDerived!=null?this.iDerived.Mask():a.Mask())}if(!this.iCursorAssigned&&(this.iDerived==null||!this.iDerived.Cursor().equals(a.Cursor()))){this.iCursorAssigned=true;this.iCursor=(this.iDerived!=null?this.iDerived.Cursor():a.Cursor())}if(this.iRowOffset==-1&&(this.iDerived==null||this.iDerived.RowOffset()!=a.RowOffset())){this.iRowOffset=(this.iDerived!=null?this.iDerived.RowOffset():a.RowOffset())}if(this.iHeaderOffset==-1&&(this.iDerived==null||this.iDerived.HeaderOffset()!=a.HeaderOffset())){this.iHeaderOffset=(this.iDerived!=null?this.iDerived.HeaderOffset():a.HeaderOffset())}if(this.iFlags==-1&&(this.iDerived==null||this.iDerived.Flags()!=a.Flags())){this.iFlags=(this.iDerived!=null?this.iDerived.Flags():a.Flags())}for(var b=1;b<=VisAttrObjSrv.MAX_ALIGNMENTS;b++){if(this.iAlignment[b]==-1&&(this.iDerived==null||this.iDerived.Alignment(b)!=a.Alignment(b))){this.iAlignment[b]=(this.iDerived!=null?this.iDerived.Alignment(b):a.Alignment(b))}}for(var b=1;b<=VisAttrObjSrv.MAX_BORDERS;b++){if(this.iBorderType[b]==-1&&(this.iDerived==null||this.iDerived.BorderType(b)!=a.BorderType(b))){this.iBorderType[b]=(this.iDerived!=null?this.iDerived.BorderType(b):a.BorderType(b))}}for(var b=1;b<=VisAttrObjSrv.MAX_COLORS;b++){if(this.iColor[b]==-2&&(this.iDerived==null||this.iDerived.Color(b)!=a.Color(b))){this.iColor[b]=(this.iDerived!=null?this.iDerived.Color(b):a.Color(b))}}for(var b=1;b<=VisAttrObjSrv.MAX_CUSTBORDERS;b++){if(this.CustColor[b]==-2&&(this.iDerived==null||this.iDerived.CBorColor(b)!=a.CBorColor(b))){this.CustColor[b]=(this.iDerived!=null?this.iDerived.CBorColor(b):a.CBorColor(b))}if(this.CustWidth[b]==-1&&(this.iDerived==null||this.iDerived.CBorWidth(b)!=a.CBorWidth(b))){this.CustWidth[b]=(this.iDerived!=null?this.iDerived.CBorWidth(b):a.CBorWidth(b))}if(this.CustType[b]==-1&&(this.iDerived==null||this.iDerived.CBorType(b)!=a.CBorType(b))){this.CustType[b]=(this.iDerived!=null?this.iDerived.CBorType(b):a.CBorType(b))}if(this.CustPadding[b]==-1&&(this.iDerived==null||this.iDerived.CBorPadding(b)!=a.CBorPadding(b))){this.CustPadding[b]=(this.iDerived!=null?this.iDerived.CBorPadding(b):a.CBorPadding(b))}}for(var b=1;b<=VisAttrObjSrv.MAX_COLORS;b++){if(this.iGradCol[b]==-1&&(this.iDerived==null||this.iDerived.GradCol(b)!=a.GradCol(b))){this.iGradCol[b]=(this.iDerived!=null?this.iDerived.GradCol(b):a.GradCol(b))}if(this.iGradDir[b]==-1&&(this.iDerived==null||this.iDerived.GradDir(b)!=a.GradDir(b))){this.iGradDir[b]=(this.iDerived!=null?this.iDerived.GradDir(b):a.GradDir(b))}if(this.iOpacity[b]==-1&&(this.iDerived==null||this.iDerived.Opacity(b)!=a.Opacity(b))){this.iOpacity[b]=(this.iDerived!=null?this.iDerived.Opacity(b):a.Opacity(b))}}if(this.iLetterSpacing==-1&&(this.iDerived==null||this.iDerived.LetterSpacing()!=a.LetterSpacing())){this.iLetterSpacing=(this.iDerived!=null?this.iDerived.LetterSpacing():a.LetterSpacing())}if(this.iWordSpacing==-1&&(this.iDerived==null||this.iDerived.WordSpacing()!=a.WordSpacing())){this.iWordSpacing=(this.iDerived!=null?this.iDerived.WordSpacing():a.WordSpacing())}if(this.iHorizontalScale==-1&&(this.iDerived==null||this.iDerived.HorizontalScale()!=a.HorizontalScale())){this.iHorizontalScale=(this.iDerived!=null?this.iDerived.HorizontalScale():a.HorizontalScale())}if((this.iClassName==null||this.iClassName.length==0)&&(this.iDerived==null||!this.iDerived.ClassName().equals(a.ClassName()))){this.iClassName=(this.iDerived!=null?this.iDerived.ClassName():a.ClassName())}if((this.iClassHeader==null||this.iClassHeader.length==0)&&(this.iDerived==null||!this.iDerived.ClassHeader().equals(a.ClassHeader()))){this.iClassHeader=(this.iDerived!=null?this.iDerived.ClassHeader():a.ClassHeader())}for(var b=1;b<=VisAttrObjSrv.MAX_FONTS;b++){if((this.iFont[b]==null||this.iFont[b].length==0)&&(this.iDerived==null||!this.iDerived.Font(b).equals(a.Font(b)))){this.iFont[b]=(this.iDerived!=null?this.iDerived.Font(b):a.Font(b))}}}this.iDerived=a;this.RD3Change(RD3Glb.VIS_DERIVED)};VisAttrObjSrv.prototype.Alignment=function(a){if(this.iAlignment[a]==-1&&this.iDerived!=null){return this.iDerived.Alignment(a)}else{return this.iAlignment[a]}};VisAttrObjSrv.prototype.set_Alignment=function(b,a){this.iAlignment[b]=a;this.AlignmentDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.ControlType=function(){if(this.iControlType==-1&&this.iDerived!=null){return this.iDerived.ControlType()}else{return this.iControlType}};VisAttrObjSrv.prototype.set_ControlType=function(a){this.iControlType=a;this.RD3Change(RD3Glb.VIS_CONTROLTYPE)};VisAttrObjSrv.prototype.LetterSpacing=function(){if(this.iLetterSpacing==-1&&this.iDerived!=null){return this.iDerived.LetterSpacing()}else{return this.iLetterSpacing}};VisAttrObjSrv.prototype.set_LetterSpacing=function(a){this.iLetterSpacing=a;this.RD3Change(RD3Glb.VIS_LETTERSPACING)};VisAttrObjSrv.prototype.WordSpacing=function(){if(this.iWordSpacing==-1&&this.iDerived!=null){return this.iDerived.WordSpacing()}else{return this.iWordSpacing}};VisAttrObjSrv.prototype.set_WordSpacing=function(a){this.iWordSpacing=a;this.RD3Change(RD3Glb.VIS_WORDSPACING)};VisAttrObjSrv.prototype.HorizontalScale=function(){if(this.iHorizontalScale==-1&&this.iDerived!=null){return this.iDerived.HorizontalScale()}else{return this.iHorizontalScale}};VisAttrObjSrv.prototype.set_HorizontalScale=function(a){this.iHorizontalScale=a;this.RD3Change(RD3Glb.VIS_HORIZONTALSCALE)};VisAttrObjSrv.prototype.Mask=function(){if(!this.iMaskAssigned&&this.iDerived!=null){return this.iDerived.Mask()}else{return this.iMask}};VisAttrObjSrv.prototype.set_Mask=function(a){this.iMask=a;this.iMaskAssigned=true;this.RD3Change(RD3Glb.VIS_MASK)};VisAttrObjSrv.prototype.Cursor=function(){if(!this.iCursorAssigned&&this.iDerived!=null){return this.iDerived.Cursor()}else{return this.iCursor}};VisAttrObjSrv.prototype.set_Cursor=function(a){this.iCursor=a;this.iCursorAssigned=true;this.RD3Change(RD3Glb.VIS_CURSOR)};VisAttrObjSrv.prototype.RowOffset=function(){if(this.iRowOffset==-1&&this.iDerived!=null){return this.iDerived.RowOffset()}else{return this.iRowOffset}};VisAttrObjSrv.prototype.set_RowOffset=function(a){this.iRowOffset=a;this.RD3Change(RD3Glb.VIS_ROWOFFSET)};VisAttrObjSrv.prototype.HeaderOffset=function(){if(this.iHeaderOffset==-1&&this.iDerived!=null){return this.iDerived.HeaderOffset()}else{return this.iHeaderOffset}};VisAttrObjSrv.prototype.set_HeaderOffset=function(a){this.iHeaderOffset=a;this.RD3Change(RD3Glb.VIS_HEADOFFSET)};VisAttrObjSrv.prototype.BorderType=function(a){if(this.iBorderType[a]==-1&&this.iDerived!=null){return this.iDerived.BorderType(a)}else{return this.iBorderType[a]}};VisAttrObjSrv.prototype.set_BorderType=function(b,a){this.iBorderType[b]=a;this.BorderTypeDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.Color=function(a){if(this.iColor[a]==-2&&this.iDerived!=null){return this.iDerived.Color(a)}else{return this.iColor[a]}};VisAttrObjSrv.prototype.set_Color=function(b,a){this.iColor[b]=a;this.ColorDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.Font=function(a){if((this.iFont[a]==null||this.iFont[a].length==0)&&this.iDerived!=null){return this.iDerived.Font(a)}else{return this.iFont[a]}};VisAttrObjSrv.prototype.set_Font=function(b,a){this.iFont[b]=a;this.FontDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.Flags=function(){if(this.iFlags==-1&&this.iDerived!=null){return this.iDerived.Flags()}else{return this.iFlags}};VisAttrObjSrv.prototype.set_Flags=function(a){this.iFlags=a;this.RD3Change(RD3Glb.VIS_FLAGS)};VisAttrObjSrv.prototype.CBorColor=function(a){if(this.CustColor[a]==-2&&this.iDerived!=null){return this.iDerived.CBorColor(a)}else{return this.CustColor[a]}};VisAttrObjSrv.prototype.set_CBorColor=function(b,a){this.CustColor[b]=a;this.CustColorDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.CBorWidth=function(a){if(this.CustWidth[a]==-1&&this.iDerived!=null){return this.iDerived.CBorWidth(a)}else{return this.CustWidth[a]}};VisAttrObjSrv.prototype.set_CBorWidth=function(b,a){this.CustWidth[b]=a;this.CustWidthDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.CBorPadding=function(a){if(this.CustPadding[a]==-1&&this.iDerived!=null){return this.iDerived.CBorPadding(a)}else{return this.CustPadding[a]}};VisAttrObjSrv.prototype.set_CBorPadding=function(b,a){this.CustPadding[b]=a;this.CustPaddingDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.CBorType=function(a){if(this.CustType[a]==-1&&this.iDerived!=null){return this.iDerived.CBorType(a)}else{return this.CustType[a]}};VisAttrObjSrv.prototype.set_CBorType=function(b,a){this.CustType[b]=a;this.CustTypeDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.AdaptWebRect=function(g,e,c,b,f,a,d){};VisAttrObjSrv.prototype.GradCol=function(a){if(this.iGradCol[a]==-1&&this.iDerived!=null){return this.iDerived.GradCol(a)}else{return this.iGradCol[a]}};VisAttrObjSrv.prototype.set_GradCol=function(b,a){this.iGradCol[b]=a;this.GradColDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.GradDir=function(a){if(this.iGradDir[a]==-1&&this.iDerived!=null){return this.iDerived.GradDir(a)}else{return this.iGradDir[a]}};VisAttrObjSrv.prototype.set_GradDir=function(b,a){this.iGradDir[b]=a;this.GradDirDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.Opacity=function(a){if(this.iOpacity[a]==-1&&this.iDerived!=null){return this.iDerived.Opacity(a)}else{return this.iOpacity[a]}};VisAttrObjSrv.prototype.set_Opacity=function(b,a){this.iOpacity[b]=a;this.OpacityDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.ClassName=function(){if(this.iClassName==null&&this.iDerived!=null){return this.iDerived.ClassName()}else{return this.iClassName}};VisAttrObjSrv.prototype.set_ClassName=function(a){this.iClassName=a;this.iClassHeader=a;this.RD3Change(RD3Glb.VIS_CLASSNAME);this.RD3Change(RD3Glb.VIS_CLASSHEADER)};VisAttrObjSrv.prototype.ClassHeader=function(){if(this.iClassHeader==null&&this.iDerived!=null){return this.iDerived.ClassHeader()}else{return this.iClassHeader}};VisAttrObjSrv.prototype.set_ClassHeader=function(a){this.iClassHeader=a;this.RD3Change(RD3Glb.VIS_CLASSHEADER)};VisAttrObjSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};VisAttrObjSrv.prototype.GetRD3Name=function(){return"vis"};VisAttrObjSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};VisAttrObjSrv.prototype.RD3RenderDifferences=function(c,f){var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}if(e==null&&this.RD3Changed){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){var b=this.RD3PropChg.length;for(var a=0;a<b;a++){if(this.RD3PropChg[a]||f){this.SetRD3Property(a,e,f)}}this.SetRD3GroupProperties(e,f);this.RD3Changed=false;this.RD3PropChg.SetAll(false)}return d};VisAttrObjSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.VIS_CONTROLTYPE:if(this.iControlType==-1&&b){break}c.SetAttribute("con",this.iControlType.toString());break;case RD3Glb.VIS_MASK:if(!this.iMaskAssigned&&b){break}c.SetAttribute("msk",this.iMask);break;case RD3Glb.VIS_CURSOR:if(!this.iCursorAssigned&&b){break}c.SetAttribute("cur",this.iCursor);break;case RD3Glb.VIS_ROWOFFSET:if(this.iRowOffset==-1&&b){break}c.SetAttribute("off",this.iRowOffset.toString());break;case RD3Glb.VIS_HEADOFFSET:if(this.iHeaderOffset==-1&&b){break}c.SetAttribute("hof",this.iHeaderOffset.toString());break;case RD3Glb.VIS_FLAGS:if(this.iFlags==-1&&b){break}c.SetAttribute("fla",this.iFlags.toString());break;case RD3Glb.VIS_LETTERSPACING:if(this.iLetterSpacing==-1&&b){break}c.SetAttribute("les",this.iLetterSpacing.toString());break;case RD3Glb.VIS_WORDSPACING:if(this.iWordSpacing==-1&&b){break}c.SetAttribute("wos",this.iWordSpacing.toString());break;case RD3Glb.VIS_HORIZONTALSCALE:if(this.iHorizontalScale==-1&&b){break}c.SetAttribute("hor",this.iHorizontalScale.toString());break;case RD3Glb.VIS_DERIVED:if(this.iDerived!=null){c.SetAttribute("der",this.iDerived.Index.toString())}break;case RD3Glb.VIS_CLASSNAME:if((this.iClassName==null||this.iClassName.length==0)&&b){break}c.SetAttribute("cln",(this.iClassName==null)?"":this.iClassName);break;case RD3Glb.VIS_CLASSHEADER:if((this.iClassHeader==null||this.iClassHeader.length==0)&&b){break}c.SetAttribute("clh",(this.iClassHeader==null)?"":this.iClassHeader);break}};VisAttrObjSrv.prototype.SetRD3GroupProperties=function(c,b){var d=this.AlignmentDiff.length;for(var a=1;a<d;a++){if(b||this.AlignmentDiff[a]){if(this.iAlignment[a]==-1&&b){continue}c.SetAttribute("ali"+a,this.iAlignment[a].toString())}}this.AlignmentDiff.SetAll(false);d=this.BorderTypeDiff.length;for(var a=1;a<d;a++){if(b||this.BorderTypeDiff[a]){if(this.iBorderType[a]==-1&&b){continue}c.SetAttribute("bor"+a,this.iBorderType[a].toString())}}this.BorderTypeDiff.SetAll(false);d=this.ColorDiff.length;for(var a=1;a<d;a++){if(b||this.ColorDiff[a]){if(this.iColor[a]==-2&&b){continue}c.SetAttribute("col"+a,this.iColor[a]==-2?"-2":Glb.GetWebColor(this.iColor[a]))}}this.ColorDiff.SetAll(false);d=this.FontDiff.length;for(var a=1;a<d;a++){if(b||this.FontDiff[a]){if(b&&this.iFont[a]==null){continue}c.SetAttribute("fon"+a,(this.iFont[a]!=null)?this.iFont[a]:"")}}this.FontDiff.SetAll(false);d=this.CustColorDiff.length;for(var a=1;a<d;a++){if(b||this.CustColorDiff[a]){if((this.CustColor[a]==-2||(this.CustColor[a]==13684944&&this.iDerived==null))&&b){continue}c.SetAttribute("ccl"+a,this.CustColor[a]==-2?"-2":Glb.GetWebColor(this.CustColor[a]))}}this.CustColorDiff.SetAll(false);d=this.CustWidthDiff.length;for(var a=1;a<d;a++){if(b||this.CustWidthDiff[a]){if((this.CustWidth[a]==-1||(this.CustWidth[a]==1&&this.iDerived==null))&&b){continue}c.SetAttribute("cwd"+a,this.CustWidth[a].toString())}}this.CustWidthDiff.SetAll(false);d=this.CustTypeDiff.length;for(var a=1;a<d;a++){if(b||this.CustTypeDiff[a]){if((this.CustType[a]==-1||(this.CustType[a]==1&&this.iDerived==null))&&b){continue}c.SetAttribute("cty"+a,this.CustType[a].toString())}}this.CustTypeDiff.SetAll(false);d=this.CustPaddingDiff.length;for(var a=1;a<d;a++){if(b||this.CustPaddingDiff[a]){if((this.CustPadding[a]==-1||(this.CustPadding[a]==1&&this.iDerived==null))&&b){continue}c.SetAttribute("cpd"+a,this.CustPadding[a].toString())}}this.CustPaddingDiff.SetAll(false);d=this.GradColDiff.length;for(var a=1;a<d;a++){if(b||this.GradColDiff[a]){if((this.iGradCol[a]==-1||this.iGradDir[a]==Glb.VISGRADDIR_NONE)&&b){continue}c.SetAttribute("gco"+a,this.iGradCol[a]==-1?"-1":Glb.GetWebColor(this.iGradCol[a]))}}this.GradColDiff.SetAll(false);d=this.GradDirDiff.length;for(var a=1;a<d;a++){if(b||this.GradDirDiff[a]){if((this.iGradDir[a]==-1||(this.iGradDir[a]==1&&this.iDerived==null))&&b){continue}c.SetAttribute("gdi"+a,this.iGradDir[a].toString())}}this.GradDirDiff.SetAll(false);d=this.OpacityDiff.length;for(var a=1;a<d;a++){if(b||this.OpacityDiff[a]){if((this.iOpacity[a]==-1||(this.iOpacity[a]==100&&this.iDerived==null))&&b){continue}c.SetAttribute("opa"+a,this.iOpacity[a].toString())}}this.OpacityDiff.SetAll(false)};function VoiceHandler(a){this.MainFrm=a;this.iListening=false;this.Skip=false;this.iResponse="";this.iSay="";this.iCanSpeak=true;this.LanguageTokens=new ArrayList();this.Punct=new ArrayList();this.objMap=new HashTableSrv();this.ComRecList=new ArrayList();this.VoiceCommandExecuted=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.VOICE_MAXPROPS)}VoiceHandler.OT_FORM=2162688;VoiceHandler.OT_PANEL=2621440;VoiceHandler.OT_CMD=2293760;VoiceHandler.OT_CMDSET=2228224;VoiceHandler.OT_PROC=1245184;VoiceHandler.OT_FUNCTION=134217728;VoiceHandler.OT_PFIELD=2686976;VoiceHandler.OT_PAGES=2752512;VoiceHandler.OT_PARAM=1376256;VoiceHandler.OT_BOOK=1118208;function VoicePunctuation(){this.Description="";this.Symbol="";this.Type=-1}VoicePunctuation.SINGLE=0;VoicePunctuation.DOUBLE=1;VoicePunctuation.RIGHT=2;VoicePunctuation.LEFT=3;VoiceHandler.prototype.Init=function(){if(this.MainFrm.ParamsObj().EnableVoice){var c=new VoiceRecognizerNavigator();this.ComRecList.Add(c);var f=new VoiceRecognizerAction();this.ComRecList.Add(f);try{var d=this.MainFrm.GetAppLanguage().toLowerCase();this.ReadCommandXML(self._ShellURL+"?WCI=RD3&WCE=GZ&FN=voice_"+d+".xml");var a=new XMLHttpRequest();a.open("GET",self._ShellURL+"?WCI=RD3&WCE=GZ&FN=prjVoice.xml",false);a.setRequestHeader("Content-Type","text/plain");a.send();this.LoadXml(a.responseText)}catch(b){this.MainFrm.DTTObj.AddException("","VoiceHandler.Init","Exception while reading XML language file",b)}}};VoiceHandler.prototype.Listening=function(){return this.iListening};VoiceHandler.prototype.set_Listening=function(a){if(a!=this.iListening){this.iListening=a;this.RD3Change(RD3Glb.VOICE_LISTENING)}};VoiceHandler.prototype.CanSpeak=function(){return this.iCanSpeak};VoiceHandler.prototype.set_CanSpeak=function(a){this.iCanSpeak=a};VoiceHandler.prototype.SetResponse=function(a){this.iResponse=a;this.RD3Change(RD3Glb.VOICE_RESPONSE)};VoiceHandler.prototype.Say=function(a){if(this.iCanSpeak){this.iSay=a;this.RD3Change(RD3Glb.VOICE_SAY)}};VoiceHandler.prototype.HandleVoice=function(c){this.VoiceCommandExecuted=true;var b=c.GetAttribute("par1");var d=c.GetAttribute("par2");if(b=="lst"){this.iListening=d=="1"}else{if(b=="txt"){this.Skip=false;this.MainFrm.UrlParams.text=d;this.MainFrm.OnCommand(new IDVariant("VOICE"));if(!this.Skip){var a=this.Matching(d);if(a.length>0){this.SetResponse(a)}this.Say(a)}}}return true};VoiceHandler.prototype.ReadCommandXML=function(g){var m=new XMLHttpRequest();m.open("GET",g,false);m.setRequestHeader("Content-Type","text/plain");m.send();var k=m.responseText;var j=new XMLDoc();if(j.LoadFromString(k)){var d=j.GetRootNode();if(d!=null){while(d.HasNextNode()){var f=d.GetNextNode();if(f!=null&&f.Name()=="LanguageTokens"){var l=f.Value();var q=new StringTokenizer();q.setString(new IDVariant(l),new IDVariant(","));while(q.hasNext()){var a=q.next().stringValue();a=a.trim().toLowerCase();var o=new VoiceWord(a);o.LanguageToken=true;this.LanguageTokens.Add(o)}}else{if(f!=null&&f.Name()=="Punctuation"){while(f.HasNextNode()){var b=new VoicePunctuation();var h=f.GetNextNode();if(h.GetAttribute("type")=="single"){b.Type=VoicePunctuation.SINGLE}else{b.Type=VoicePunctuation.DOUBLE}while(h.HasNextNode()){var c=h.GetNextNode();if(c.Name()=="Desc"){b.Description=c.Value()}else{if(c.Name()=="Symbol"){b.Symbol=c.Value()}}}this.Punct.Add(b)}}else{if(f!=null&&f.Name()=="CommandRecognizer"){var r=0;while(f!=null){var e=this.ComRecList.Get(r);e.Init(f);r++;f=d.GetNextNode()}}}}}}}};VoiceHandler.prototype.LoadXml=function(h){var u=new XMLDoc();var e=null;u.LoadFromString(h);if(u.HasNextNode()){e=u.GetNextNode();if(e.Name()=="xml"){e=u.GetNextNode()}while(e.HasNextNode()){var c=new VoiceIndeObj();var o=e.GetNextNode();var b="";var q="";while(o.HasNextNode()){var d=o.GetNextNode();if(d.Name().toLowerCase()=="guid"){c.GUID=d.Value()}else{if(d.Name().toLowerCase()=="name"){c.Name=d.Value()}else{if(d.Name().toLowerCase()=="description"){b=d.Value()}else{if(d.Name().toLowerCase()=="title"){q=d.Value()}else{if(d.Name().toLowerCase()=="type"){c.Type=d.Value()}else{if(d.Name().toLowerCase()=="parentguid"){c.ParentGuid=d.Value()}else{if(d.Name().toLowerCase()=="customdata"){c.CustomData=d.Value()}}}}}}}}this.objMap[c.GUID]=c;var r=[c.Name,b,q];for(var m=0;m<r.length;m++){if(r[m]==null){continue}var t=new StringTokenizer();t.setString(new IDVariant(r[m]),new IDVariant(" "));while(t.hasNext()){var g=t.next().stringValue();g=g.replace("\\p{Punct}","");var f=null;for(var l=0;l<c.Words.Count();l++){var s=c.Words.Get(l);if(s.Word.toLowerCase()==g.toLowerCase()){f=s;break}}if(f==null){var a=new VoiceWord();a.Word=g;a.LanguageToken=this.IsLanguageToken(a);a.Occurrences=1;if(!a.LanguageToken){switch(m){case 0:if(q!=null){a.Weight=(q.length==0?1:0)}break;case 1:a.Weight=0;break;case 2:a.Weight=1;break}}c.Words.Add(a)}else{f.Occurrences+=1;if(!f.LanguageToken){switch(m){case 0:if(q.length==0){f.Weight=1}break;case 1:break;case 2:f.Weight=1;break}}}}}var k=this.objMap[c.ParentGuid];if(k!=null){k.Children.Add(c)}}}};VoiceHandler.prototype.Matching=function(g){VoiceCommandExecuted=true;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1000,"VoiceHandler.Matching",'User command is "'+g+'"');this.MainFrm.DTTObj.SetRequestName("Voice Command",g,DTTRequest.PRI_CMD);if(g.length<=0){return this.MainFrm.RTCObj.GetConst("B8F316D0-A8C1-408e-978A-B097F9D9DECA","Mi dispiace, non ho capito.",false)}var m=new ArrayList();g=g.replace("'"," ");var c=new HashTableSrv();for(var h=0;h<this.Punct.Count();h++){var e=this.Punct.Get(h);var n=g.indexOf(" "+e.Description+" ");while(n>-1){var l=e.Symbol;if((e.Type==VoicePunctuation.SINGLE&&e.Symbol!="@")){g=g.replace(" "+e.Description+" ",e.Symbol+" ");break}else{if(c.Get(e.Symbol)==null||c.Get(e.Symbol)==VoicePunctuation.LEFT){var k="";k+=g.substring(0,n+1);var b=g.indexOf(" ",n+1);k+=e.Symbol;k+=g.substring(b+1);g=k;c[e.Symbol]=VoicePunctuation.RIGHT}else{if(c.Get(e.Symbol)!=null&&c.Get(e.Symbol)==VoicePunctuation.RIGHT){var k="";k+=g.substring(0,n);var b=g.indexOf(" ",n+1);k+=e.Symbol;k+=g.substring(b);g=k;c[e.Symbol]=VoicePunctuation.LEFT}}}n=g.indexOf(" "+e.Description+" ",n)}}for(var h=0;h<g.length-3;h++){if(g.substring(h,h+1).match("\\d")){if(g.substring(h+1,h+2)==" "&&g.substring(h+2,h+3).match("\\d+")){g=g.substring(0,h+1)+g.substring(h+2)}}}var o=new StringTokenizer();o.setString(new IDVariant(g),new IDVariant(" "));while(o.hasNext()){var a=new VoiceWord();var t=o.next().stringValue();if(t.length>0){a.Word=t.replace("\\p{Punct}","");for(var h=0;h<this.LanguageTokens.Count();h++){var j=this.LanguageTokens.Get(h);if(j.Word.toLowerCase()==a.Word.toLowerCase()){this.MainFrm.DTTObj.AddParameter("","","language token",j.Word);a.LanguageToken=true;break}}m.Add(a)}}var r=0;var d=null;for(var h=0;h<this.ComRecList.Count();h++){var q=this.ComRecList.Get(h);var f=q.EvaluateCommand(this.MainFrm,m);if(f>r){r=f;d=q}}if(d!=null){if(r<0.4){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1001,"VoiceHandler.Matching","Score too low");this.MainFrm.DTTObj.AddParameter("","","Score: ",r);return this.MainFrm.RTCObj.GetConst("B8F316D0-A8C1-408e-978A-B097F9D9DECA","Mi dispiace, non ho capito.",false)}return d.ExecuteCommand(this.MainFrm)}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1002,"VoiceHandler.Matching","Command not recognized");return this.MainFrm.RTCObj.GetConst("B8F316D0-A8C1-408e-978A-B097F9D9DECA","Mi dispiace, non ho capito.",false)};VoiceHandler.prototype.FindIndeObjByGuid=function(b){var e=this.objMap.keys();for(var c=0;c<e.length;c++){var a=e[c];var d=this.objMap[a];if(d.GUID==b){return d}}return null};VoiceHandler.prototype.FindIndeObjByType=function(d){var f=new ArrayList();var e=this.objMap.keys();for(var b=0;b<e.length;b++){var a=e[b];var c=this.objMap[a];if(c.Type==d){f.Add(c)}}return f};VoiceHandler.prototype.FindOnScreen=function(e){var b=new ArrayList();var h=this.GetActiveForms(this.MainFrm);for(var a=0;a<h.Count();a++){var g=h.Get(a);for(var d=1;d<g.Frames.length;d++){var c=g.Frames[d].Content;if(c==null||!c.Visible||c.Collapsed||!c.Exposed()){continue}switch(e){case VoiceHandler.OT_PANEL:if(c instanceof IDPanelSrv){b.Add(c)}break;case VoiceHandler.OT_BOOK:if(c instanceof OBookSrv){b.Add(c)}break}}}return b};VoiceHandler.prototype.FindInCustomData=function(d){var f=new ArrayList();var e=this.objMap.keys();for(var b=0;b<e.length;b++){var a=e[b];var c=this.objMap[a];if(c.CustomData!=null&&c.CustomData==d){f.Add(c)}}return f};VoiceHandler.FindField=function(d,v,a){var x=-1;var z=0;var b=d.Fields;var m=d.ActualPosition();var h=d.AttR;if(d.IsShowingGrouping()){d.set_SelectedRow(0)}d.DisableNotification=true;for(var y=0;y<2;y++){var t=1;var n=d.Queries[0].RecordCount();for(var g=m+1;t<=n;t++,g=(g%n)+1){d.set_ActualPosition(g);var q=new ArrayList();for(var s=0;s<b.length;s++){var e=b[s];if(e.IdxPanel<0||e.DataType==Glb.DT_DOC_OLE||!e.IsVisible(d.AttR,false)){continue}if((d.VS.Flags(e.VisualStyle)&Glb.FL_VIS_PASSWORD)!=0){continue}if(y==0&&(e.Flags&Glb.FLD_ISDESCR)==0){continue}var l=this.TokenizeString(e.bValues(d.AttR).Value.stringValue().toLowerCase());q.AddRange(l)}usedValueWords=new HashTableSrv();this.MatchWordList(q,v,usedValueWords);var u=usedValueWords.count()/this.NotLanguageTokens(v);if(u>z){a.clear();var f=usedValueWords.keys();for(var o=0;o<f.length;o++){a[f[o]]=usedValueWords[f[o]]}z=u;x=g}}if(z==1){break}}d.set_ActualPosition(m-h);d.Parent.FocusPriority=0;d.set_ActualPosition(m);if(d.IsShowingGrouping()){d.set_SelectedRow(h)}d.DisableNotification=false;var c=new ArrayList();c.Add(x);c.Add(z);return c};VoiceHandler.FindFieldsForSelection=function(c,o,s){var v=new ArrayList();var n=c.Fields;var l=c.ActualPosition();var f=c.AttR;if(c.IsShowingGrouping()){c.set_SelectedRow(0)}c.DisableNotification=true;var m=1;var b=c.Queries[0].RecordCount();for(var a=l+1;m<=b;m++,a=(a%b)+1){c.set_ActualPosition(a);var t=new ArrayList();for(var h=0;h<n.length;h++){var e=n[h];if(e.IdxPanel<0||e.DataType==Glb.DT_DOC_OLE||!e.IsVisible(c.AttR,false)){continue}if((c.VS.Flags(e.VisualStyle)&Glb.FL_VIS_PASSWORD)!=0){continue}if((e.Flags&Glb.FLD_ISDESCR)==0){continue}var q=this.TokenizeString(e.bValues(c.AttR).Value.stringValue().toLowerCase());t.AddRange(q)}var d=new HashTableSrv();this.MatchWordList(t,o,d);if(d.count()>0){v.Add(a);var u=d.keys();for(var g=0;g<u.length;g++){s[u[g]]=d[u[g]]}}}c.set_ActualPosition(l-f);c.Parent.FocusPriority=0;c.set_ActualPosition(l);if(c.IsShowingGrouping()){c.set_SelectedRow(f)}c.DisableNotification=false;return v};VoiceHandler.prototype.FindIndeObjChildren=function(j,h,f){var d=new ArrayList();var l=this.objMap.keys();for(var e=0;e<l.length;e++){var c=l[e];var a=this.objMap[c];if(a.Type==f){var b=a.ParentGuid;var g=this.FindIndeObjByGuid(b);while(g!=null){if(g.Type==h&&b.equals(j)){d.Add(a);break}else{g=this.FindIndeObjByGuid(g.ParentGuid)}}}}return d};VoiceHandler.TokenizeString=function(c){var d=new ArrayList();var e=new StringTokenizer();e.setString(new IDVariant(c),new IDVariant(" "));while(e.hasNext()){var b=e.next().stringValue();b=b.replace("\\p{Punct}","");var a=new VoiceWord();a.Word=b;d.Add(a)}return d};VoiceHandler.NotLanguageTokens=function(b){var d=0;for(var a=0;a<b.length;a++){var c=b.Get(a);if(!c.LanguageToken){d++}}return d};VoiceHandler.prototype.IsLanguageToken=function(c){for(var b=0;b<this.LanguageTokens.Count();b++){var a=this.LanguageTokens.Get(b);if(a.isEqual(c)>0){return true}}return false};VoiceHandler.MatchWordList=function(g,b,a){var h=0;for(var e=0;e<g.length;e++){var f=g.Get(e);if(f.LanguageToken){continue}for(var d=0;d<b.length;d++){var c=b.Get(d);if(c.LanguageToken){continue}var k=f.isEqual(c);if(k>0){h=f.Weight;if(a!=null){a[c.Word]=h}}}}};VoiceHandler.MatchDeleteWordList=function(h,g){var k=0;for(var d=0;d<h.length;d++){var b=h.Get(d);if(b.LanguageToken){continue}var e=0;while(e<g.Count()){var a=g.Get(e);if(a.LanguageToken){e++;continue}var f=b.isEqual(a);if(f>0){g.remove(e);k++}else{e++}}}return k};VoiceHandler.TestInsert=function(l,F,q,e,n){var E=0;var B=new ArrayList();var u=new ArrayList();for(var y=0;y<q.Count();y++){var A=q.Get(y);var a=this.TokenizeString(A.Name);var G=this.TokenizeString(A.Description);for(var x=0;x<F.Count();x++){var D=F[x];if(e[D.Word]==null){if(D.isEqual(a.Get(0))>0.5){var z=1;var k=F.Count();while(z<a.Count()){if((x+z>=k)||a.Get(z).isEqual(F[x+z])==0||e[F.Get(x+z).Word]!=null){break}z++}if(z==a.Count()){B.Add(x);x+=z;u.Add(A);for(z=0;z<a.Count();z++){e[a.Get(z).Word.toLowerCase()]=1}E++;break}}else{var m=false;for(var z=0;z<G.Count();z++){if(D.isEqual(G.Get(z))==1){B.Add(x);x++;u.Add(A);e[G.Get(z).Word.toLowerCase()]=1;E++;m=true;break}}if(m){break}}}}}if(B.Count()>0){var o=0;var d=0;for(d=B.Count()-1;d>=0;d--){if(B.Get(d)>=o){o=B.Get(d);break}}if(d<0){d=0}var t=this.TokenizeString(u[d].Name.trim()).Count();if(F.Count()==o+t){var c=0;for(var y=0;y<B.Count();y++){var A=u.Get(y);var b=B.Get(y);var v=new ArrayList();for(var x=c;x<b;x++){v.Add(F[x])}if(v.Count()-1>=0&&A.Obj!=null&&v.Get(v.Count()-1).LanguageToken){v.RemoveAt(v.Count()-1)}var g=new ArrayList();g.Add(A);VoiceParameter.checkParametersText(l,v,g,e,n);var a=this.TokenizeString(A.Name);c=B.Get(y)+a.Count()}}else{for(var y=0;y<B.Count();y++){var A=u.Get(y);var a=this.TokenizeString(A.Name);var c=B.Get(y)+a.Count();var b=0;if(y+1>=B.Count()){b=F.Count()}else{b=B.Get(y+1)}var v=new ArrayList();for(var x=c;x<b;x++){v.Add(F[x])}if(A.Obj!=null&&v.Get(v.Count()-1).LanguageToken){v.RemoveAt(v.Count()-1)}var g=new ArrayList();g.Add(A);VoiceParameter.checkParametersText(l,v,g,e,n)}var s=0;var C=B.Get(0);if(C>0){var v=new ArrayList();for(var x=s;x<C;x++){v.Add(F.Get(x))}if(NotLanguageTokens(v)>0){for(var y=0;y<q.Count();y++){var A=q.Get(y);if(A.Descriptive&&A.text.Count()==0){g=new ArrayList();g.Add(A);var r=VoiceParameter.checkParametersText(l,v,g,e,n);s=r}}}}}}return E};VoiceHandler.CheckFieldsName=function(d,x,l,b,g){var v=0;var t=new ArrayList();var m=new ArrayList();for(var q=0;q<l.Count();q++){var s=l.Get(q);var a=this.TokenizeString(s.Name);var y=this.TokenizeString(s.Description);for(var o=0;o<x.Count();o++){var u=x.Get(o);if(b[u.Word]==null){if(u.isEqual(a.Get(0))>0.5){var r=1;var c=x.Count();while(r<a.Count()){if((o+r>=c)||a.Get(r).isEqual(x.Get(o+r))==0||b[x.Get(o+r).Word]!=null){break}r++}if(r==a.Count()){t.Add(q);m.Add(s);for(r=0;r<a.Count();r++){b[a.Get(r).Word.toLowerCase()]=1}v++;for(var n=0;n<r;n++){x.remove(o)}break}}else{var e=false;for(var r=0;r<y.Count();r++){if(u.isEqual(y.Get(r))==1){t.Add(o);m.Add(s);b[y.Get(r).Word.toLowerCase()]=1;v++;e=true;x.remove(o);break}}if(e){break}}}}}return m};VoiceHandler.prototype.GetActiveForms=function(l){var h=new ArrayList();var c=this.MainFrm.ActiveForm();if(c!=null){h.Add(c)}if(this.MainFrm.UseZones()){var b=this.MainFrm.screenZones;for(var d=0;d<b.Count();d++){var k=b.Get(d);var m=k.SelectedForm();var a=k.GetForms();for(var e=0;e<a.length;e++){var g=a.get_Object(new IDVariant(e));if(g.FormIdx==m&&g.Visible){h.Add(g);break}}}}else{for(var e=0;e<this.MainFrm.StackForm.length;e++){var g=this.MainFrm.StackForm[e];if(g.Docked){h.Add(g)}}}return h};VoiceHandler.prototype.GetRD3Ident=function(){return this.GetRD3Name()};VoiceHandler.prototype.GetRD3Name=function(){return"voice"};VoiceHandler.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};VoiceHandler.prototype.RD3RenderDifferences=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.MainFrm.ParamsObj().EnableVoice){d.SetAttribute("ena","1")}}return c};VoiceHandler.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.VOICE_LISTENING:if(this.iListening==false&&b){break}c.SetAttribute("lst",this.iListening?"1":"0");break;case RD3Glb.VOICE_RESPONSE:if(this.iResponse.length==0&&b){break}c.SetAttribute("rsp",this.iResponse);break;case RD3Glb.VOICE_SAY:if(this.iSay.length==0&&b){break}c.SetAttribute("say",this.iSay);break}};function VoiceCommand(){this.Index;this.Name="";this.Description="";this.Synonyms=new ArrayList();this.Param=null}VoiceCommand.prototype.Init=function(c){var a=c.GetNextNode();while(a!=null){var b=new VoiceCommandSyn();b.Init(a);this.Synonyms.Add(b);a=c.GetNextNode()}};VoiceCommand.prototype.Reset=function(){this.Param=null};VoiceCommand.prototype.Match=function(h,d,g){var k=0;var f=null;var a=null;for(var e=0;e<this.Synonyms.Count();e++){var b=this.Synonyms.Get(e);var j=new ArrayList();var c=b.Match(h,d,j);if(c>k){k=c;f=j}a=j}if(f!=null){g.Clear();g.AddRange(f)}else{if(a!=null){g.Clear();g.AddRange(a)}}return k};function VoiceCommandRecognizer(){this.CommandList=new ArrayList()}VoiceCommandRecognizer.prototype.EvaluateCommand=function(a,b){for(var d=0;d<this.CommandList.Count();d++){var c=this.CommandList.Get(d);c.Reset()}return 0};VoiceCommandRecognizer.prototype.ExecuteCommand=function(a){return""};VoiceCommandRecognizer.prototype.Init=function(c){var d=c.GetNextNode();var a=0;while(d!=null){var b=this.CommandList.Get(a);b.Name=d.GetAttribute("tag");b.Description=d.GetAttribute("text");b.Init(d);a++;d=c.GetNextNode()}};function VoiceCommandSyn(){this.WordsGroup=new ArrayList()}VoiceCommandSyn.prototype.Init=function(g){var h=g.GetNextNode();while(h!=null){var d=new StringTokenizer();d.setString(new IDVariant(h.Value()),new IDVariant(";"));while(d.hasNext()){var b=d.next().stringValue();b=b.replace("{","").replace("}","");var a=new VoiceWordList();var f=new StringTokenizer();f.setString(new IDVariant(b),new IDVariant(","));while(f.hasNext()){var c=f.next().stringValue().trim();if(c=="*"){a.optional=true}else{var e=new VoiceWord(c);a.WList.Add(e)}}this.WordsGroup.Add(a);h=g.GetNextNode()}}};VoiceCommandSyn.prototype.Match=function(m,c,a){var g=false;var b=0;var q=new Array(this.WordsGroup.Count());for(var e=0;e<c.Count();e++){var o=c.Get(e);if(o.LanguageToken){a.Add(o);continue}var r=false;for(var f=0;f<this.WordsGroup.Count();f++){if(!q[f]){var l=this.WordsGroup.Get(f);for(var d=0;d<l.WList.Count();d++){var n=l.WList.Get(d);if(o.isEqual(n)>0){if(!g&&f==0){g=true;a.Clear()}m.DTTObj.AddParameter("","",'"'+o.Word+'"',1);b+=1;q[f]=true;r=true;break}}if(q[f]){break}}}if(!r){m.DTTObj.AddParameter("","",'"'+o.Word+'"',0);a.Add(o)}}var h=this.WordsGroup.Count();for(var f=0;f<q.length;f++){if(!q[f]){if(!this.WordsGroup.Get(f).optional){b=0;break}else{h--}}}if(h>0){b=b/h}m.DTTObj.AddParameter("","","synonym score",b);return b};function VoiceIndeObj(){this.GUID="";this.Name="";this.Type=0;this.ParentGuid="";this.CustomData="";this.Children=new ArrayList();this.Words=new ArrayList()}function VoiceParameter(){this.Obj=null;this.Name="";this.Description="";this.Type=-1;this.Length=-1;this.Descriptive=false;this.text=new ArrayList()}VoiceParameter.checkFieldsText=function(h,g,t,F,n){var b=0;var o=new Array(t.Count());for(var z=0;z<t.Count();z++){var A=t.Get(z);var c=A.Length;while(b<g.Count()){var s=g.Get(b);if((A.Type==Glb.DT_DATE||A.Type==Glb.DT_DATETIME)){var E=new IDVariant();var u=new ArrayList(g.subList(b,g.size()));var d=u.size();if(A.Type==Glb.DT_DATETIME){E=this.CheckDateTime(h,u,true,n)}else{if(A.Type==Glb.DT_DATE){E=this.CheckDateTime(h,u,false,n)}}if(E.Type!=IDVariant.NULL){var r=d-u.Count();var l=new VoiceWord();l.Word=E.stringValue();A.text.Add(l);for(var x=0;x<r;x++){F[g.Get(b+x).Word]=1}o[z]=true;b+=r}break}if(A.Obj!=null){var C=A.Obj;if(C.ValueList.length>0){for(var y=0;y<C.ValueList.length;y++){var l=C.ValueList.get(y);if(l.Name.toLowerCase()==s.Word){var B=new VoiceWord();B.Word=l.Value.stringValue();A.text.Add(B);b++;F[s.Word]=1;o[z]=true;break}}}else{if((C.Flags&Glb.FLD_AUTOLOOKUP)!=0){if(C.QueryValueSource!=null&&C.QueryValueSource.RS!=null){try{var m=false;C.QueryValueSource.RS.MoveFirst();while(!C.QueryValueSource.RS.EOF()){var a=C.QueryValueSource.RS.Get(1);var q=C.QueryValueSource.RS.Get(C.QueryValueSource.DecodeColumn>0?C.QueryValueSource.DecodeColumn:C.QueryValueSource.RS.GetNumFields());if(q.stringValue().toLowerCase()==s.Word){var B=new VoiceWord();B.Word=a.stringValue();A.text.Add(B);b++;F[s.Word]=1;o[z]=true;m=true;break}C.QueryValueSource.RS.MoveNext()}if(m){break}}catch(D){}}}}}if((A.Type==Glb.DT_NUM_CURRENCY||A.Type==Glb.DT_NUM_FIXED||A.Type==Glb.DT_NUM_FLOAT||A.Type==Glb.DT_NUM_INTEGER)){if(s.Word.match("\\d+")){A.text.Add(s);b++;F[s.Word]=1;o[z]=true;break}break}c-=s.Word.length;if(A.Obj!=null&&c<0){break}A.text.Add(s);b++;F[s.Word]=1;o[z]=true}if(F.count()==g.Count()){break}}var G=0;for(var y=0;y<o.length;y++){if(o[y]){G++}}return G};VoiceParameter.checkParametersText=function(h,g,s,D,m){var n=0;var b=0;for(var x=0;x<s.Count();x++){var y=s.Get(x);var c=y.Length;while(b<g.Count()){var r=g.Get(b);if((y.Type==Glb.DT_DATE||y.Type==Glb.DT_DATETIME)){var C=new IDVariant();var t=new ArrayList(g.subList(b,g.Count()));var d=t.Count();if(y.Type==Glb.DT_DATETIME){C=CheckDateTime(h,t,true,m)}else{if(y.Type==Glb.DT_DATE){C=CheckDateTime(h,t,false,m)}}if(C.Type!=IDVariant.NULL){var q=d-t.Count();var j=new VoiceWord();j.Word=C.stringValue();y.text.Add(j);for(var u=0;u<q;u++){D[g.Get(b+u).Word]=1}n++;for(var u=0;u<q;u++){g.Remove(b)}}break}if(y.Obj!=null){var A=y.Obj;if(A.ValueList.length>0){var l=false;for(var u=0;u<A.ValueList.length;u++){var j=A.ValueList.get(u);if(j.Name.toLowerCase()==r.Word){var z=new VoiceWord();z.Word=j.Value.stringValue();y.text.Add(z);D[r.Word]=1;n++;g.Remove(b);l=true;break}}if(l){break}}else{if((A.Flags&Glb.FLD_AUTOLOOKUP)!=0){if(A.QueryValueSource!=null&&A.QueryValueSource.RS!=null){try{var l=false;A.QueryValueSource.RS.MoveFirst();while(!A.QueryValueSource.RS.EOF()){var a=A.QueryValueSource.RS.Get(1);var o=A.QueryValueSource.RS.Get(A.QueryValueSource.DecodeColumn>0?A.QueryValueSource.DecodeColumn:A.QueryValueSource.RS.GetNumFields());if(o.stringValue().toLowerCase()==r.Word){var z=new VoiceWord();z.Word=a.stringValue();y.text.Add(z);D[r.Word]=1;n++;g.Remove(b);l=true;break}A.QueryValueSource.RS.MoveNext()}if(l){break}}catch(B){}}}else{if(A.IdxPanel>0){y.text.Add(r);D[r.Word]=1;n++;g.Remove(b);break}}}}if((y.Type==Glb.DT_NUM_CURRENCY||y.Type==Glb.DT_NUM_FIXED||y.Type==Glb.DT_NUM_FLOAT||y.Type==Glb.DT_NUM_INTEGER)){if(r.Word.match("\\d+")){y.text.Add(r);D[r.Word]=1;n++;g.Remove(b);break}break}if(y.Obj!=null){c-=r.Word.length;if(c<0){break}}y.text.Add(r);D[r.Word]=1;n++;g.RemoveAt(b)}if(D.count()==g.Count()){break}}return n};VoiceParameter.CheckDateTime=function(u,l,C,z){var P=0;var N=new IDVariant();var K=0;var M="";var I=-1;var D=0;if(l.Count()>2){M=l.Get(0).Word+" "+l.Get(1).Word+" "+l.Get(2).Word}else{if(l.Count()>1){M=l.Get(0).Word+" "+l.Get(1).Word}else{M=l.Get(0).Word}}try{if(u!=null){var Q=new RegExp("^(\\d{1,2}) (\\d{1,2}) (\\d{4})$").exec(M);if(Q!=null){var O=Q[1];var J=Q[2];var A=Q[3];N=IDL.ToDate(new IDVariant(A),new IDVariant(J),new IDVariant(O));if(N.Type!=IDVariant.NULL){K=3}}if(N.Type==IDVariant.NULL){var q=u.RTCObj.GetConst("6C93863C-7064-4b28-B645-C9090C3F499F","gennaio;febbraio;marzo;aprile;maggio;giugno;luglio;agosto;settembre;ottobre;novembre;dicembre",false).split(";");Q=new RegExp("^(\\d{1,2}) ([a-zA-Z]{3,}) (\\d{4})$").exec(M);if(Q!=null){var O=Q[1];var o=Q[2];var A=Q[3];for(var H=0;H<q.length;H++){if(o.toLowerCase()==q[H].toLowerCase()){N=IDL.ToDate(new IDVariant(A),new IDVariant(H+1),new IDVariant(O));K=3;break}}}if(N.Type==IDVariant.NULL){if(M.toLowerCase()==u.RTCObj.GetConst("C0D8B22A-5086-46d7-883A-A42D82EB990C","Oggi a pranzo",false).toLowerCase()){N=IDL.Today();I=13}else{if(M.toLowerCase()==u.RTCObj.GetConst("077367FC-69A2-4472-859C-FD3F07466C6D","Domani a pranzo",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=13}else{if(M.toLowerCase()==u.RTCObj.GetConst("290B93C4-7283-408f-9660-072111AC9165","Ieri a pranzo",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=13}else{if(M.toLowerCase()==u.RTCObj.GetConst("9E621F0E-B5B7-4192-AB30-E8A28915DA43","Oggi a cena",false).toLowerCase()){N=IDL.Today();I=19}else{if(M.toLowerCase()==u.RTCObj.GetConst("66FCDFFC-C464-4f2f-978D-6D4C9B307A49","Domani a cena",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=19}else{if(M.toLowerCase()==u.RTCObj.GetConst("82DD9B5A-B5B7-4f6a-8B8A-5FABE0FE6E2B","Ieri a cena",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=19}}}}}}if(N.Type!=IDVariant.NULL){K=3}}}if(N.Type==IDVariant.NULL&&l.size()>1){M=l.Get(0).Word+" "+l.Get(1).Word;var q=u.RTCObj.GetConst("6C93863C-7064-4b28-B645-C9090C3F499F","gennaio;febbraio;marzo;aprile;maggio;giugno;luglio;agosto;settembre;ottobre;novembre;dicembre",false).split(";");Q=new RegExp("^(\\d{1,2}) ([a-zA-Z]{3,})$").exec(M);if(Q!=null){var O=Q[1];var o=Q[2];for(var H=0;H<q.length;H++){if(o.toLowerCase()==q[H].toLowerCase()){N=IDL.ToDate(IDL.Year(IDL.Today()),new IDVariant(H+1),new IDVariant(O));K=2}}}if(N.Type==IDVariant.NULL&&l.size()>1){if(M.toLowerCase()==u.RTCObj.GetConst("BAE43B12-D843-46f4-9F60-31FC7974347F","Domani mattina",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today());I=9}else{if(M.toLowerCase()==u.RTCObj.GetConst("BE25E89E-3F76-4cd4-9BC9-8D059C9945B3","Domani pomeriggio",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today());I=16}else{if(M.toLowerCase()==u.RTCObj.GetConst("0E538D26-6318-4dc5-869E-A5166C8B13B5","Domani sera",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today());I=20}else{if(M.toLowerCase()==u.RTCObj.GetConst("441631F4-4B94-48ca-8FE1-767CF43007EA","Ieri mattina",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=9}else{if(M.toLowerCase()==u.RTCObj.GetConst("E4914180-83F9-4895-BA68-B37CFA60976BYester","Ieri pomeriggio",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=16}else{if(M.toLowerCase()==u.RTCObj.GetConst("E394214C-EC9E-47cf-B143-9E67162A0A67","Ieri sera",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=20}else{if(M.toLowerCase()==u.RTCObj.GetConst("AAA0F015-FE06-44b1-9039-6C5658824BF0","Oggi pomeriggio",false).toLowerCase()){N=IDL.Today();I=16}}}}}}}if(N.Type!=IDVariant.NULL){K=2}}}if(N.Type==IDVariant.NULL&&z){Q=new RegExp("^([a-zA-Z]{3,}) (\\d{4})$").exec(M);if(Q!=null){var a=Q[1];var A=Q[2];var q=u.RTCObj.GetConst("6C93863C-7064-4b28-B645-C9090C3F499F","gennaio;febbraio;marzo;aprile;maggio;giugno;luglio;agosto;settembre;ottobre;novembre;dicembre",false).split(";");var f=u.RTCObj.GetConst("FC8AF728-7517-4b68-B213-80CAE61F3D90","gen;feb;mar;apr;mag;giu;lug;ago;set;ott;nov;dic",false).split(";");for(var H=0;H<q.length;H++){if(a.toLowerCase()==q[H].toLowerCase()){N=new IDVariant(f[H]+" "+A);for(var F=0;F<P;F++){if(l.Count()<=0){break}l.Remove(0)}return N}}}}if(N.Type==IDVariant.NULL){M=l.Get(0).Word;if(M.toLowerCase()==u.RTCObj.GetConst("982BE4E3-A288-4AD4-A4D6-426F4E62BEDB","Oggi",false).toLowerCase()){N=IDL.Today()}else{if(M.toLowerCase()==u.RTCObj.GetConst("A4E7F53D-043D-435F-8089-E1C6495A13B0","Domani",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today())}else{if(M.toLowerCase()==u.RTCObj.GetConst("8052BA86-1C6A-4268-BABA-28CA9E6F94E7","Ieri",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today())}else{if(M.toLowerCase()==u.RTCObj.GetConst("8F8B2466-F044-421a-936D-839548839BE8","Domattina",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=9}else{if(M.toLowerCase()==u.RTCObj.GetConst("C34E97EA-C397-4673-8C15-0156997D887C","Stasera",false).toLowerCase()){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());I=20}}}}}if(N.Type!=IDVariant.NULL){K=1}}if(N.Type==IDVariant.NULL){var g=u.RTCObj.GetConst("88A4709F-64ED-440f-A757-B24F3FD844B5","lunedì;martedì;mercoledì;giovedì;venerdì;sabato;domenica",false).split(";");for(var H=0;H<g.length;H++){if(M.toLowerCase()==g[H].toLowerCase()){var r=(H+1)%7+1;N=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today());while(IDL.WeekDay(N).intValue()!=r){N=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),N)}K=1}}}if(N.Type==IDVariant.NULL&&z){Q=new RegExp("^\\d{4}$").exec(M);if(Q!=null){N=new IDVariant(M)}for(var F=0;F<P;F++){if(l.Count()<=0){break}l.Remove(0)}return N}}}catch(L){}D=0;var G=K;if(N.Type!=IDVariant.NULL){P=K;if(C){var c=7;while(G<c&&l.Count()>G){var y=l.Get(G).Word;if(y.match("\\d+")){var B=Integer.parseInt(y);if(I==-1&&(B>0&&B<25)){I=B;if(c+3<7){c+=3}}else{if(I>-1){if(B>0&&B<60){D=Integer.parseInt(y)}break}}}else{if(I>-1){var E=u.RTCObj.GetConst("02E6E6DB-A8AC-4B61-BE3D-9BE0BF43F136","mezza;mezzo",false).split(";");if(y.toLowerCase()==E[0].toLowerCase()||y.toLowerCase()==E[1].toLowerCase()){D=30}else{if(y.toLowerCase()==u.RTCObj.GetConst("1915FE8C-5502-4E12-A4DA-3DD44671FE12","quarto",false).toLowerCase()){D=15}}}else{var b=u.RTCObj.GetConst("71F53B7F-A10B-4d0c-AE44-147652F0B521","mattina;mattino",false).split(";");if(b[0]=="."||y.toLowerCase()==b[0].toLowerCase()||y.toLowerCase()==b[1].toLowerCase()||y.toLowerCase()==u.RTCObj.GetConst("6B6CAD7E-F5C8-4dc5-8748-6D81663E3623","notte",false).toLowerCase()){I=9}else{if(y.toLowerCase()==u.RTCObj.GetConst("24C7769D-63BF-4745-99DA-3EDF71DD3492","Mezzogiorno",false).toLowerCase()){I=12}else{if(y.toLowerCase()==u.RTCObj.GetConst("E5CCDBF5-52F0-4FDD-AC2B-4CC7BDC94045","Mezzanotte",false).toLowerCase()){I=0}else{if(y.toLowerCase()==u.RTCObj.GetConst("0E263FC9-6C43-4908-A989-A00DCE0DD8CF","Pranzo",false).toLowerCase()){I=13}else{if(y.toLowerCase()==u.RTCObj.GetConst("5CC2D3D5-146D-47cd-9D3E-2DE5734F9926","Cena",false).toLowerCase()==0){I=19}}}}}}}G++}}}if(I>-1){if(I>=1&&I<=5){var v=false;for(var F=0;F<l.Count();F++){var E=u.RTCObj.GetConst("71F53B7F-A10B-4d0c-AE44-147652F0B521","mattina;mattino",false).split(";");var x=l.Get(F).Word;if(E[0]=="."||x.toLowerCase()==E[0].toLowerCase()||x.toLowerCase()==E[1].toLowerCase()||x.toLowerCase()==u.RTCObj.GetConst("6B6CAD7E-F5C8-4dc5-8748-6D81663E3623","notte",false).toLowerCase()){if(F>G){G=F}v=true;break}}if(!v){I+=12}}else{var v=false;for(var F=G+1;F<l.Count();F++){var x=l.Get(F).Word;if(x.toLowerCase()==u.RTCObj.GetConst("F638DEAE-25A4-4137-8085-77CD8D65D2DE","pomeriggio",false).toLowerCase()||x.toLowerCase()==u.RTCObj.GetConst("91C4A319-E729-42a3-AD77-D16C45515E3F","sera",false).toLowerCase()){if(F>G){G=F}v=true;break}}if(v){I+=12}}N=IDL.DateTimeEx(IDL.Year(N),IDL.Month(N),IDL.Day(N),new IDVariant(I),new IDVariant(D),new IDVariant(0));P+=G}for(var F=0;F<P;F++){if(l.Count()<=0){break}l.Remove(0)}return N};VoiceParameter.checkValueListFields=function(q,d,h,o){var a=0;var s=new ArrayList();s.AddRange(d);for(var g=0;g<h.Count();g++){var n=h.Get(g);var k=n.Obj;if(k.ValueList.length>0){for(var e=0;e<k.ValueList.length;e++){var t=false;var r=k.ValueList.get(e);var c=r.Name.toLowerCase();var g=0;while(g<s.Count()){var m=s.Get(g);var b=m.Word.toLowerCase();var l=2;while(b.length>3){if(c.contains(b)){n.text.Add(new VoiceWord(b));o[m.Word]=1;s.Remove(g);a++;t=true;break}b=b.substring(0,b.length-l);l++}if(t){break}g++}if(t){e=0}}}}return a};function VoiceRecognizerAction(){VoiceCommandRecognizer.call(this);this.bestCmd=null;for(var a=0;a<28;a++){var b=new VoiceCommand();b.Index=a;this.CommandList.Add(b)}}VoiceRecognizerAction.prototype=new VoiceCommandRecognizer();VoiceRecognizerAction.VRA_LOCK=0;VoiceRecognizerAction.VRA_UNLOCK=1;VoiceRecognizerAction.VRA_DUPLICATE=2;VoiceRecognizerAction.VRA_DELETE=3;VoiceRecognizerAction.VRA_SAVE=4;VoiceRecognizerAction.VRA_CANCEL=5;VoiceRecognizerAction.VRA_REFRESH=6;VoiceRecognizerAction.VRA_EXPORT=7;VoiceRecognizerAction.VRA_PRINT=8;VoiceRecognizerAction.VRA_CANCELSELECTION=9;VoiceRecognizerAction.VRA_SELECTALL=10;VoiceRecognizerAction.VRA_REVERTSELECTION=11;VoiceRecognizerAction.VRA_INSERT=12;VoiceRecognizerAction.VRA_WRITE=13;VoiceRecognizerAction.VRA_DUPLICATEROW=14;VoiceRecognizerAction.VRA_DELETEROW=15;VoiceRecognizerAction.VRA_SELECT=16;VoiceRecognizerAction.VRA_RUN=17;VoiceRecognizerAction.VRA_FIND=18;VoiceRecognizerAction.VRA_CLOSE=19;VoiceRecognizerAction.VRA_CLOSEALL=20;VoiceRecognizerAction.VRA_OPEN=21;VoiceRecognizerAction.VRA_STOP=22;VoiceRecognizerAction.VRA_FINDBOOK=23;VoiceRecognizerAction.VRA_READ=24;VoiceRecognizerAction.VRA_COUNT=25;VoiceRecognizerAction.VRA_READBOOK=26;VoiceRecognizerAction.VRA_DELETEFIELD=27;VoiceRecognizerAction.prototype.EvaluateCommand=function(a,d){VoiceCommandRecognizer.prototype.EvaluateCommand.call(this,a,d);var e=0;var f=0;var c=0;for(;c<12;c++){e=this.EvaluatePanelCommands(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}var b=c+2;for(;c<b;c++){e=this.EvaluateInsertCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}b=c+2;for(;c<b;c++){e=this.EvaluateRowCommands(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}e=this.EvaluateSelectCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateRunCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateFindCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;b=c+2;for(;c<b;c++){e=this.EvaluateCloseCommands(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}e=this.EvaluateOpenCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateStopCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateGoToSectionBookCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateReadCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateCountCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateReadBookCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateDeleteFieldCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}if(this.bestCmd!=null){a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1080,"VoiceRecognizerAction.EvaluateCommand",'VoiceRecognizerAction: the best command is "'+this.bestCmd.Name+'"');a.DTTObj.AddParameter("","","score",f)}return f};VoiceRecognizerAction.prototype.EvaluatePanelCommands=function(h,v,e){h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1081,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": evaluate command.");var y=new ArrayList();var t=e.Match(h,v,y);h.DTTObj.AddParameter("","","command score",t);if(t>0){var d=h.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1082,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": "+d.Count()+" panels found on screen.");for(var q=0;q<d.Count();q++){h.DTTObj.AddParameter("","","panel",(d.Get(q)).GetDTTCaption())}var s=0;while(s<d.Count()){var m=d.Get(s);var a=false;if(m.Queries[0]!=null&&m.Queries[0].IsDO){if(m.Queries[0].IDColl!=null){a=m.Queries[0].IDColl.IsModified()}else{var g=m.GetDocument();if(g!=null){a=g.IsModified()}}}var n=(m.Status()==Glb.PS_DATA)&&(m.AllowMasterPanelNav||!a);var o=false;if(e.Index!=VoiceRecognizerAction.VRA_CANCELSELECTION&&e.Index!=VoiceRecognizerAction.VRA_SELECTALL&&e.Index!=VoiceRecognizerAction.VRA_REVERTSELECTION&&!m.ShowToolbar){o=true}if(e.Index==VoiceRecognizerAction.VRA_LOCK&&(m.Locked()||!m.Lockable)){o=true}else{if(e.Index==VoiceRecognizerAction.VRA_UNLOCK&&(!m.Locked()||!m.Lockable||!m.CanBeUnlocked())){o=true}else{if(e.Index==VoiceRecognizerAction.VRA_DUPLICATE&&(!m.IsCommandEnabled(Glb.PCM_DUPLICATE)||m.Locked()||m.Status()!=Glb.PS_DATA||(m.Flags&Glb.PAN_CANINSERT)==0)){o=true}else{if(e.Index==VoiceRecognizerAction.VRA_DELETE&&(!m.IsCommandEnabled(Glb.PCM_DELETE)||m.Locked()||m.Status()!=Glb.PS_DATA||(m.Flags&Glb.PAN_CANDELETE)==0)){o=true}else{if(e.Index==VoiceRecognizerAction.VRA_SAVE&&(!m.IsCommandEnabled(Glb.PAN_CANUPDATE)||m.Status()!=Glb.PS_UPDATE)){o=true}else{if(e.Index==VoiceRecognizerAction.VRA_CANCEL&&(!m.IsCommandEnabled(Glb.PCM_CANCEL)||m.Status()==Glb.PS_DATA)){o=true}else{if(e.Index==VoiceRecognizerAction.VRA_REFRESH&&(!m.IsCommandEnabled(Glb.PCM_REQUERY)||(m.Status()!=Glb.PS_UPDATE&&m.Status()!=Glb.PS_DATA)||(m.Queries[0].IsDO&&m.Queries[0].DocTempl==null))){o=true}else{if(e.Index==VoiceRecognizerAction.VRA_EXPORT&&(!m.IsCommandEnabled(Glb.PCM_CSV)||!n||m.PanelMode!=Glb.PANEL_LIST)){o=true}else{if(e.Index==VoiceRecognizerAction.VRA_PRINT&&(!m.IsCommandEnabled(Glb.PCM_PRINT)||m.MyBook==null||!n)){o=true}else{if((e.Index==VoiceRecognizerAction.VRA_CANCELSELECTION||e.Index==VoiceRecognizerAction.VRA_REVERTSELECTION||e.Index==VoiceRecognizerAction.VRA_SELECTALL)&&(m.Status()!=Glb.PS_DATA||m.GetNumRows()<=0||!m.EnableMultipleSel())){o=true}}}}}}}}}}if(o){h.DTTObj.AddParameter("","","panel",(d.Get(s)).GetDTTCaption()+" (removed)");d.Remove(m)}else{h.DTTObj.AddParameter("","","panel",(d.Get(s)).GetDTTCaption());s++}}var c=null;var x=0;var l=false;for(s=0;s<d.Count();s++){var m=d.Get(s);if(VoiceHandler.NotLanguageTokens(y)==0){h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1083,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": no unknown words found.");if(m.HasFocus()){t=(t+1)/2;h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1084,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": "+m.GetDTTCaption()+" is the target panel");h.DTTObj.AddParameter("","","score",t);e.Param=m;return t}else{if(!l){c=m;l=true}else{c=null}}}else{h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1085,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": "+y.Count()+" unknown words found");for(var q=0;q<y.Count();q++){h.DTTObj.AddParameter("","","unknown word",y.Get(q).Word)}var u=h.VoiceObj.FindIndeObjByGuid(m.iGuid);var f=new HashTableSrv();VoiceHandler.MatchWordList(u.Words,y,f);var r=0;if(f.count()==0){if(d.Count()==1){r=1}else{if(m.HasFocus()){r=0.3}}}else{r=1}if(r==0){continue}var b=0;var k=f.keys();for(var q=0;q<k.length;q++){var z=k[q];b+=f[z]}b/=VoiceHandler.NotLanguageTokens(y);if(b>x){x=b;c=m}}}if(c!=null){t=(x+t)/2;h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1086,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+': the panel "'+c.GetDTTCaption()+'" is the target panel');h.DTTObj.AddParameter("","","score",t);e.Param=c;return t}h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1087,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": no target panel found")}h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1088,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+" is not the right command.");h.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateInsertCommand=function(o,K,d){o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1089,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": evaluate command.");var N=new ArrayList();var G=d.Match(o,K,N);o.DTTObj.AddParameter("","","command score",G);if(G>0||(G==0&&d.Index==VoiceRecognizerAction.VRA_WRITE)){var b=o.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1090,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": "+b.Count()+" panels found on screen.");for(var D=0;D<b.Count();D++){o.DTTObj.AddParameter("","","panel",(b.Get(D)).GetDTTCaption())}var F=0;while(F<b.Count()){var x=b.Get(F);var y=false;if(d.Index==VoiceRecognizerAction.VRA_INSERT&&(!x.IsCommandEnabled(Glb.PCM_INSERT)||(x.Locked()&&!x.EnableInsertWhenLocked()&&(!x.Queries[0].IsDO||x.Queries[0].Document!=null||x.Queries[0].IDColl!=null))||(x.Status()!=Glb.PS_QBE&&x.Status()!=Glb.PS_DATA)||(x.Flags&Glb.PAN_CANINSERT)==0)){y=true}if(d.Index==VoiceRecognizerAction.VRA_WRITE&&(!x.IsCommandEnabled(Glb.PCM_UPDATE)||(x.Locked()&&!x.EnableInsertWhenLocked()&&(!x.Queries[0].IsDO||x.Queries[0].Document!=null||x.Queries[0].IDColl!=null))||(x.Status()!=Glb.PS_UPDATE&&x.Status()!=Glb.PS_DATA)||(x.Flags&Glb.PAN_CANUPDATE)==0)&&(!x.Lockable||!x.CanBeUnlocked())){y=true}if(y){o.DTTObj.AddParameter("","","panel",(b.Get(F)).GetDTTCaption()+" (removed)");b.Remove(x)}else{o.DTTObj.AddParameter("","","panel",(b.Get(F)).GetDTTCaption());F++}}var a=null;var A=new ArrayList();var M=0;var t=false;for(F=0;F<b.Count();F++){var x=b.Get(F);if(d.Index==VoiceRecognizerAction.VRA_WRITE&&VoiceHandler.NotLanguageTokens(N)==0){o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1131,"VoiceRecognizerAction.EvaluateInsertCommand","No text found");o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1096,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+" is not the right command.");return 0}if(VoiceHandler.NotLanguageTokens(N)==0){o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1091,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": no unknown words found.");if(x.HasFocus()){G=(G+1)/2;o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1092,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": "+x.GetDTTCaption()+" is the target panel");o.DTTObj.AddParameter("","","score",G);var n=new ArrayList();n.add(0,x);d.Param=n;return G}else{if(!t){a=x;t=true}else{a=null}}}else{o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1093,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": "+N.Count()+" unknown words found");for(var D=0;D<N.Count();D++){o.DTTObj.AddParameter("","","unknown word",N.Get(D).Word)}var I=o.VoiceObj.FindIndeObjByGuid(x.iGuid);var m=new HashTableSrv();VoiceHandler.MatchWordList(I.Words,N,m);var E=0;if(m.count()==0){if(b.Count()==1||x.HasFocus()){E=1}}else{if(G==0){E=0}else{E=1}}if(E==0){continue}var u;if(d.Index==VoiceRecognizerAction.VRA_INSERT){u=this.GetFieldsArrayFromPanel(x,VoiceRecognizerAction.VRA_INSERT)}else{u=this.GetFieldsArrayFromPanel(x,VoiceRecognizerAction.VRA_WRITE)}var O=new HashTableSrv();var l=new ArrayList();l.AddRange(N);var L=0;while(L<l.Count()){var q=l.Get(L);if(m.containsKey(q.Word)){l.RemoveAt(L)}else{L++}}if(l.Count()>0&&l.Get(L-1).LanguageToken){l.removeAt(L-1)}var s=VoiceHandler.TestInsert(o,l,u,O,false);var C=new ArrayList();C.AddRange(N);if(s==0){E-=0.05;if(d.Index==VoiceRecognizerAction.VRA_INSERT){s=VoiceParameter.checkFieldsText(o,l,u,O,false)}else{if(d.Index==VoiceRecognizerAction.VRA_WRITE&&G>0){var e=new ArrayList();var h=new ArrayList();var g=x.FocusedColumn();for(var B=0;B<u.Count();B++){var H=u.Get(B);var J=H.Obj;if(g!=-1&&J==x.bFields(g)){e.Add(H)}if(H.Descriptive){h.Add(H)}}s=VoiceParameter.checkFieldsText(o,l,h,O,false);if(s==0){E-=0.05;s=VoiceParameter.checkFieldsText(o,l,e,O,false)}}}}var r=O.keys();for(var B=0;B<r.length;B++){m[r[B]]=O[r[B]]}var z=E*m.count()/VoiceHandler.NotLanguageTokens(N);if(z>M){M=z;a=x;A.Clear();A.AddRange(u)}}}if(a!=null){G=(M+G)/2;o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1094,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+': the panel "'+a.GetDTTCaption()+'" is the target panel');o.DTTObj.AddParameter("","","score",G);var P=new ArrayList();P.Add(a);P.Add(A);d.Param=P;return G}o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1095,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": no target panel found")}o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1096,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+" is not the right command.");o.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateRowCommands=function(f,t,d){var u=-1;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1097,"VoiceRecognizerAction.EvaluateRowCommands","Command "+d.Name+": evaluate command.");var x=new ArrayList();var s=d.Match(f,t,x);f.DTTObj.AddParameter("","","command score",s);if(s>0){if(VoiceHandler.NotLanguageTokens(x)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1098,"VoiceRecognizerAction.EvaluateRowCommands","Command "+d.Name+": no unknown words found.");f.DTTObj.AddParameter("","","score",0);return 0}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1099,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": "+x.Count()+" unknown words found.");for(var q=0;q<x.Count();q++){f.DTTObj.AddParameter("","","Unknown word",x.Get(q).Word)}for(var q=0;q<x.Count();q++){var k=x.Get(q);if(!k.LanguageToken&&k.Word.match("\\d+")){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1100,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": row number found: "+x.Get(q).Word);u=parseInt(k.Word);break}}if(u>0){var c=f.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1101,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": "+c.Count()+" panels found on screen.");var q=0;while(q<c.Count()){var h=c.Get(q);var l=false;if(h.Layout()==Glb.PANEL_FORM){l=true}else{if(h.Status()!=Glb.PS_DATA){l=true}else{if(h.GetNumRows()<u){l=true}else{if(d.Index==VoiceRecognizerAction.VRA_DUPLICATEROW&&(!h.IsCommandEnabled(Glb.PCM_DUPLICATE)||h.Locked()||h.Status()!=Glb.PS_DATA||(h.Flags&Glb.PAN_CANINSERT)==0)){l=true}else{if(d.Index==VoiceRecognizerAction.VRA_DELETEROW&&(!h.IsCommandEnabled(Glb.PCM_DELETE)||h.Locked()||h.Status()!=Glb.PS_DATA||(h.Flags&Glb.PAN_CANDELETE)==0)){l=true}}}}}if(l){f.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption()+" (removed)");c.Remove(h)}else{f.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption());q++}}var v=0;var b=null;for(q=0;q<c.Count();q++){var h=c.Get(q);var a=f.VoiceObj.FindIndeObjByGuid(h.iGuid);var e=new HashTableSrv();VoiceHandler.MatchWordList(a.Words,x,e);e.NumRow=1;var r=0;if(e.count()==0){if(c.Count()==1){r=1}else{if(h.HasFocus()){r=0.3}}}else{r=1}if(r==0){continue}var m=0;var g=e.keys();for(var o=0;o<g.length;o++){var y=g[o];m+=e[y]}m/=VoiceHandler.NotLanguageTokens(x);m*=r*e.count()/VoiceHandler.NotLanguageTokens(x);if(m>v){v=m;b=h}}if(b!=null){s=(s+v)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1102,"VoiceRecognizerNavigator.EvaluateGotoRow","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target panel.');f.DTTObj.AddParameter("","","score",s);var n=new ArrayList();n.Add(b);n.Add(u);d.Param=n;return s}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1103,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": no target panel found");f.DTTObj.AddParameter("","","score",0);return 0}}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1104,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",s);return 0};VoiceRecognizerAction.prototype.EvaluateSelectCommand=function(k,A,d){k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1105,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+": evaluate command.");var C=new ArrayList();var z=d.Match(k,A,C);if(VoiceHandler.NotLanguageTokens(C)==0){k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1106,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+": no unknown words found. This is not the right command.");k.DTTObj.AddParameter("","","command score",0);return 0}var c=k.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1107,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+": "+c.Count()+" panels found on screen.");var x=0;while(x<c.Count()){var o=c.Get(x);var q=false;if(o.Status()!=Glb.PS_DATA){q=true}else{if(o.GetNumRows()<=0){q=true}}if(q){k.DTTObj.AddParameter("","","panel",o.GetDTTCaption()+" (removed)");c.Remove(o)}else{k.DTTObj.AddParameter("","","panel",o.GetDTTCaption());x++}}var g=null;var b=null;var B=0;for(x=0;x<c.Count();x++){var o=c.Get(x);var a=k.VoiceObj.FindIndeObjByGuid(o.iGuid);var n=new HashTableSrv();VoiceHandler.MatchWordList(a.Words,C,n);var y=0;if(n.count()==0){if(c.Count()==1){y=1}else{if(o.HasFocus()){if(o.HasFocus()){y=0.3}}}}else{y=1}if(y==0){continue}var h=new ArrayList();var f=new ArrayList();f.AddRange(C);var u=0;while(u<f.Count()){var l=f.Get(u);if(n.containsKey(l.Word)){f.RemoveAt(u)}else{u++}}var m=VoiceHandler.NotLanguageTokens(f);var e=new HashTableSrv();h=VoiceHandler.FindFieldsForSelection(o,f,e);var r=0;if(h.Count()>0){if(h.Count()>1&&!o.EnableMultipleSel()){return 0}var t=e.count();r=t/m;r*=y*t/m}if(r>B){g=h;b=o;B=r}}if(g!=null){z=(z+B)/2;k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1108,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target page.');k.DTTObj.AddParameter("","","score",z);var s=new ArrayList();s.Add(b);s.Add(g);d.Param=s;return z}k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1109,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+" is not the right command.");k.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateRunCommand=function(q,G,d){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1110,"VoiceRecognizerAction.EvaluateRunCommand","Command "+d.Name+": evaluate command.");var I=new ArrayList();var D=d.Match(q,G,I);q.DTTObj.AddParameter("","","command score",D);if(VoiceHandler.NotLanguageTokens(I)==0){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1111,"VoiceRecognizerNavigator.EvaluateRunCommand","Command "+d.Name+": no unknown words found. This is not the right command.");q.DTTObj.AddParameter("","","command score",0);return 0}var g=null;var h=null;var c=new ArrayList();var H=0;var n=new ArrayList();var k=q.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);var m="";if(k.Count()>0){m=k.Get(0).Parent.RTCGuid}var x=q.VoiceObj.FindIndeObjByType(VoiceHandler.OT_PFIELD);x.AddRange(q.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD));for(var B=0;B<x.Count();B++){var F=x.Get(B);if(F.Type==VoiceHandler.OT_PFIELD){if(F.CustomData.length<=F.CustomData.lastIndexOf("|")+3){continue}n.Add(F.CustomData);var t=false;for(var C=0;C<k.Count();C++){if(F.ParentGuid==k.Get(C).iGuid){t=true;break}}if(!t){continue}}if(F.Type==VoiceHandler.OT_CMD){if(F.CustomData==null||F.CustomData.length==0){continue}var v=F.CustomData;var s=q.VoiceObj.FindIndeObjByGuid(v);if(s!=null&&s.Type!=VoiceHandler.OT_PROC){continue}n.Add(v);var J=F.ParentGuid;var e=q.VoiceObj.FindIndeObjByGuid(J);var E=e.ParentGuid;if(m.length>0&&!m==E){var t=false;var o=q.CmdObj.CmdSets;for(var C=0;C<o.length;C++){var b=o[C];if(b!=null&&b.IdxForm==0&&b.iGuid==J&&(b.IsMenu||b.IsToolbar)&&b.IsEnabled(0)){t=true;break}}if(!t){continue}}}var K=this.EvaluateProc(q,F,I);if(K!=null){var A=K.Get(0);var l=K.Get(1);var y=K.Get(2);if(A>H){H=A;g=l;c.AddRange(y);h=F}}}var r=q.RTCObj.AppGuid;var z=q.VoiceObj.FindIndeObjByType(VoiceHandler.OT_PROC);for(var C=0;C<z.Count();C++){var u=z.Get(C);if(n.Contains(u.GUID)){continue}var a=u.ParentGuid;if(!a==r){if(m.length<=0||!m==a){continue}}var K=this.EvaluateProc(q,u,I);if(K!=null){var A=K.Get(0);var l=K.Get(1);var y=K.Get(2);if(A>H){H=A;g=l;c.AddRange(y);h=null}}}if(g!=null){D=(H+D)/2;q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1112,"VoiceRecognizerAction.EvaluateRunCommand","Command "+d.Name+': the procedure "'+g.Name+'" is the target procedure');q.DTTObj.AddParameter("","","score",D);var K=new ArrayList();K.Add(g);K.Add(c);K.Add(h);d.Param=K;return D}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1113,"VoiceRecognizerAction.EvaluateRunCommand","Command "+d.Name+" is not the right command.");q.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateFindCommand=function(M,z,n){M.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1114,"VoiceRecognizerAction.EvaluateFindCommand","Command "+n.Name+": evaluate command.");var G=new ArrayList();var f=n.Match(M,z,G);M.DTTObj.AddParameter("","","command score",f);var C=0;var h=null;var e=null;var S=null;var u=new ArrayList();if(f>0){var J=M.VoiceObj.GetActiveForms(M);for(var R=0;R<J.Count();R++){var g=J.Get(R);var y=g.RTCGuid;var A=M.VoiceObj.FindIndeObjByGuid(y);var X=new HashTableSrv();VoiceHandler.MatchWordList(A.Words,G,X);if(X.count()>0||J.Count()==1){var x=new ArrayList();var D=X.keys();for(var Q=0;Q<D.length;Q++){var L=D[Q];x.Add(new VoiceWord(L))}var m=M.VoiceObj.FindIndeObjChildren(A.GUID,A.Type,VoiceHandler.OT_PANEL);for(var W=0;W<m.Count();W++){var r=m.Get(W);var B=new HashTableSrv();VoiceHandler.MatchWordList(r.Words,x,B);if(B.count()==x.Count()){var d=this.GetFieldsArrayFromVoiceObj(M,r);var E=new ArrayList();E.AddRange(G);var V=0;while(V<E.Count()){var N=E.Get(V);if(X[N.Word]!=null){E.RemoveAt(V)}else{if(E.Get(V).LanguageToken){E.RemoveAt(V)}else{V++}}}var H=new HashTableSrv();var t=VoiceHandler.TestInsert(M,E,d,H,true);if(t==0){var K=new ArrayList();for(var P=0;P<d.Count();P++){var o=d.Get(P);if(o.Descriptive){K.Add(o)}}t=VoiceParameter.checkFieldsText(M,E,K,H,true)}var U=1;var D=H.keys();for(var Q=0;Q<D.length;Q++){var O=D[Q];x.Add(new VoiceWord(O))}var F=U*x.Count()/VoiceHandler.NotLanguageTokens(G);if(F>C){C=F;h=null;e=A;S=r;u.Clear();u.AddRange(E)}}}}}var l=M.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD);for(var R=0;R<l.Count();R++){var T=l.Get(R);var a=new HashTableSrv();VoiceHandler.MatchWordList(T.Words,G,a);if(a.count()==0){continue}var x=new ArrayList();var D=a.keys();for(var Q=0;Q<D.length;Q++){L=D[Q];x.Add(new VoiceWord(L))}if(T.CustomData==null){continue}var I=M.VoiceObj.FindIndeObjByGuid(T.CustomData);var X=new HashTableSrv();VoiceHandler.MatchWordList(I.Words,x,X);if(X.count()!=x.Count()){continue}var m=M.VoiceObj.FindIndeObjChildren(I.GUID,I.Type,VoiceHandler.OT_PANEL);for(var W=0;W<m.Count();W++){var r=m.Get(W);var B=new HashTableSrv();VoiceHandler.MatchWordList(r.Words,x,B);if(B.count()==x.Count()){var d=this.GetFieldsArrayFromVoiceObj(M,r);var E=new ArrayList();E.AddRange(G);var V=0;while(V<E.Count()){var N=E.Get(V);if(X[N.Word]!=null){E.RemoveAt(V)}else{if(E.Get(V).LanguageToken){E.RemoveAt(V)}else{V++}}}var H=new HashTableSrv();var t=VoiceHandler.TestInsert(M,E,d,H,true);if(t==0){var K=new ArrayList();for(var P=0;P<d.Count();P++){var o=d.Get(P);if(o.Descriptive){K.Add(o)}}t=VoiceParameter.checkFieldsText(M,E,K,H,true)}var U=0.5;var D=H.keys();for(var Q=0;Q<D.length;Q++){var O=D[Q];x.Add(new VoiceWord(O))}var F=U*x.Count()/VoiceHandler.NotLanguageTokens(G);if(F>C){C=F;h=T;e=I;S=r;u.Clear();u.AddRange(E)}}}}if(S!=null){f=(f+C)/2;M.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1115,"VoiceRecognizerAction.EvaluateFindCommand","Command "+n.Name+': the panel "'+S.Name+'" in the form "'+e.Name+'" is the target page.');M.DTTObj.AddParameter("","","score",f);var q=new ArrayList();q.Add(h);q.Add(e);q.Add(S);q.Add(u);n.Param=q;return f}}return 0};VoiceRecognizerAction.prototype.EvaluateCloseCommands=function(q,l,d){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1116,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+": evaluate command.");var b=new ArrayList();var c=d.Match(q,l,b);q.DTTObj.AddParameter("","","command score",c);if(c>0){if(d.Index==VoiceRecognizerAction.VRA_CLOSEALL){if(VoiceHandler.NotLanguageTokens(b)>0){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1117,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+": no unknown words found.");q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1118,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+" is not the right command.");q.DTTObj.AddParameter("","","score",0);return 0}else{q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1119,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+": close all the forms");q.DTTObj.AddParameter("","","score",c);d.Param=null;return c}}var a=new ArrayList();a.AddRange(q.StackForm);if(VoiceHandler.NotLanguageTokens(b)==0&&q.VoiceObj.GetActiveForms(q).Count()==1){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1120,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+': close the form "'+a.Get(0).GetRD3Name()+'"');q.DTTObj.AddParameter("","","score",c);d.Param=a;return c}var o=new ArrayList();var u=0;for(var h=0;h<a.Count();h++){var k=a.Get(h);var m=k.RTCGuid;var s=q.VoiceObj.FindIndeObjByGuid(m);var n=new HashTableSrv();VoiceHandler.MatchWordList(s.Words,b,n);var g=0;var t=n.keys();for(var e=0;e<t.length;e++){var r=t[e];g+=n[r]}g/=VoiceHandler.NotLanguageTokens(b);if(g>u){o.Clear();o.Add(k);u=g}}if(o.Count()>0){c=(u+c)/2;q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1121,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+': the form "'+o.Get(0).GetRD3Name()+'" is the target form');q.DTTObj.AddParameter("","","score",c);d.Param=o;return c}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1122,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+": no target form found")}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1123,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+" is not the right command.");q.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateOpenCommand=function(l,u,b){l.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1127,"VoiceRecognizerAction.EvaluateOpenCommand","Command "+b.Name+": evaluate command.");var x=new ArrayList();var s=b.Match(l,u,x);l.DTTObj.AddParameter("","","command score",s);if(VoiceHandler.NotLanguageTokens(x)==0){l.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1128,"VoiceRecognizerNavigator.EvaluateOpenCommand","Command "+b.Name+": no unknown words found. This is not the right command.");l.DTTObj.AddParameter("","","command score",0);return 0}var f=null;var v=0;var g=l.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);var h="";if(g.Count()>0){h=(g.Get(0)).Parent.RTCGuid}var e=l.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD);for(var o=0;o<e.Count();o++){var q=e.Get(o);if(q.CustomData==null||q.CustomData.length==0){continue}var y=q.ParentGuid;var c=l.VoiceObj.FindIndeObjByGuid(y);var t=c.ParentGuid;if(h.length>0&&!h==t){var m=false;var k=l.CmdObj.CmdSets;for(var r=0;r<k.length;r++){var a=k[r];if(a!=null&&a.IdxForm==0&&a.iGuid==y){m=true;break}}if(!m){continue}}var d=new HashTableSrv();VoiceHandler.MatchWordList(q.Words,x,d);if(d.count()==0){continue}var n=d.count()/VoiceHandler.NotLanguageTokens(x);if(n>v){v=n;f=q}}if(f!=null){s=(v+s)/2;l.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1129,"VoiceRecognizerAction.EvaluateOpenCommand","Command "+f.Name+" is the target command.");l.DTTObj.AddParameter("","","score",s);var z=new ArrayList();z.Add(f);b.Param=z;return s}l.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1130,"VoiceRecognizerAction.EvaluateOpenCommand","Command "+b.Name+" is not the right command.");l.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateStopCommand=function(a,c,e){a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1130,"VoiceRecognizerAction.EvaluateStopCommand","Command "+e.Name+": evaluate command.");var b=new ArrayList();var d=e.Match(a,c,b);a.DTTObj.AddParameter("","","command score",d);if(d>0){if(b.Count()>0){a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1132,"VoiceRecognizerAction.EvaluateStopCommand","Unknown words found.");a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1133,"VoiceRecognizerAction.EvaluateStopCommand","Command "+e.Name+" is not the right command.");a.DTTObj.AddParameter("","","score",0);return 0}a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1134,"VoiceRecognizerAction.EvaluateStopCommand","Command "+e.Name+" is the target command.");a.DTTObj.AddParameter("","","score",d);return d}a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1135,"VoiceRecognizerAction.EvaluateStopCommand","Command "+e.Name+" is not the right command.");a.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateGoToSectionBookCommand=function(r,G,e){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1050,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+": evaluate command.");var J=new ArrayList();var F=e.Match(r,G,J);if(VoiceHandler.NotLanguageTokens(J)==0){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1051,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+": no unknown words found. This is not the right command.");r.DTTObj.AddParameter("","","command score",0);return 0}if(F>0){var o=r.VoiceObj.FindOnScreen(VoiceHandler.OT_BOOK);r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1052,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+": "+o.Count()+" book found on screen.");var n=null;var d=-1;var I=0;for(var E=0;E<o.Count();E++){var u=o.Get(E);var b=new HashTableSrv();var A=VoiceHandler.TokenizeString(u.BookObj.GetName());VoiceHandler.MatchWordList(A,J,b);var a=0;if(b.count()==0){if(o.Count()==1){a=1}}else{a=1}if(a==0){continue}var h=new ArrayList();h.AddRange(J);var H=0;while(H<h.Count()){var s=h.Get(H);if(b[s.Word]!=null){h.RemoveAt(H)}else{H++}}var D=0;var B=false;while(!B){var g=u.BookObj.Book.getPage(D);if(g!=null){var l=new ArrayList();g.GetBoxesList(l);var y="";for(var C=0;C<l.Count();C++){var q=l.Get(C);y+=q.GetInnerText();y+=" "}var m=new HashTableSrv();var x=VoiceHandler.TokenizeString(y.toString());VoiceHandler.MatchWordList(x,J,m);var f=a*m.count()/VoiceHandler.NotLanguageTokens(J);if(f>I){I=f;d=D+1;n=u}if(f==1){break}else{D++}}else{break}}D++}if(d>-1){F=(F+I)/2;r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1053,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+': the book "'+n.BookObj.GetName()+'" is the target book.');r.DTTObj.AddParameter("","","score",F);var z=new ArrayList();z.Add(n);z.Add(d);e.Param=z;return F}}r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1054,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+" is not the right command.");r.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateReadCommand=function(P,C,r){P.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1114,"VoiceRecognizerAction.EvaluateReadCommand","Command "+r.Name+": evaluate command.");var J=new ArrayList();var h=r.Match(P,C,J);P.DTTObj.AddParameter("","","command score",h);var F=0;var m=null;var g=null;var W=null;var e=null;var z=new ArrayList();if(h>0){var M=P.VoiceObj.GetActiveForms(P);for(var U=0;U<M.Count();U++){var l=M.Get(U);var B=l.RTCGuid;var D=P.VoiceObj.FindIndeObjByGuid(B);var ac=new HashTableSrv();VoiceHandler.MatchWordList(D.Words,J,ac);if(ac.count()>0||M.Count()==1){var A=new ArrayList();var G=ac.keys();for(var T=0;T<G.length;T++){var O=G[T];A.Add(new VoiceWord(O))}var q=P.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);for(var ab=0;ab<q.Count();ab++){var S=q.Get(ab);var x=P.VoiceObj.FindIndeObjByGuid(S.iGuid);var E=new HashTableSrv();VoiceHandler.MatchWordList(x.Words,A,E);if(E.count()>0||S.HasFocus()){var d=this.GetFieldsArrayFromVoiceObj(P,x);var H=new ArrayList();H.AddRange(J);var aa=0;while(aa<H.Count()){var Q=H.Get(aa);if(ac[Q.Word]!=null){H.RemoveAt(aa)}else{if(H.Get(aa).LanguageToken){H.RemoveAt(aa)}else{aa++}}}var K=new HashTableSrv();var n=VoiceHandler.CheckFieldsName(P,H,d,K,true);if(n.Count()>0){aa=0;while(aa<H.Count()){var Q=H.Get(aa);if(K[Q.Word]!=null){H.RemoveAt(aa)}else{if(H.Get(aa).LanguageToken){H.RemoveAt(aa)}else{aa++}}}var V=0;while(V<d.Count()){for(var T=0;T<n.Count();T++){var Y=n.Get(T);if(Y.Name==d.Get(V).Name){d.Remove(d.Get(V))}else{V++}}}}var y=VoiceHandler.TestInsert(P,H,d,K,true);if(y==0){var N=new ArrayList();for(var T=0;T<d.Count();T++){var t=d.Get(T);if(t.Descriptive){N.Add(t)}}y=VoiceParameter.checkFieldsText(P,H,N,K,true)}var Z=1;if(E.count()==0&&S.HasFocus()){Z=0.5}var G=K.keys();for(var T=0;T<G.length;T++){var R=G[T];A.Add(new VoiceWord(R))}var I=Z*A.Count()/VoiceHandler.NotLanguageTokens(J);if(I>F){F=I;m=null;g=D;W=x;e=n;z.Clear();z.AddRange(H)}}}}}var o=P.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD);for(var V=0;V<o.Count();V++){var X=o.Get(V);var a=new HashTableSrv();VoiceHandler.MatchWordList(X.Words,J,a);if(a.count()==0){continue}var A=new ArrayList();var G=a.keys();for(var T=0;T<G.length;T++){var O=G[T];A.Add(new VoiceWord(O))}if(X.CustomData==null){continue}var L=P.VoiceObj.FindIndeObjByGuid(X.CustomData);var ac=new HashTableSrv();VoiceHandler.MatchWordList(L.Words,A,ac);if(ac.count()!=A.Count()){continue}var q=P.VoiceObj.FindIndeObjChildren(L.GUID,L.Type,VoiceHandler.OT_PANEL);for(var ab=0;ab<q.Count();ab++){var x=q.Get(ab);var E=new HashTableSrv();VoiceHandler.MatchWordList(x.Words,A,E);if(E.count()==A.Count()){var d=this.GetFieldsArrayFromVoiceObj(P,x);var H=new ArrayList();H.AddRange(J);var aa=0;while(aa<H.Count()){var Q=H.Get(aa);if(ac[Q.Word]!=null){H.RemoveAt(aa)}else{if(H.Get(aa).LanguageToken){H.RemoveAt(aa)}else{aa++}}}var K=new HashTableSrv();var n=VoiceHandler.CheckFieldsName(P,H,d,K,true);if(n.Count()>0){aa=0;while(aa<H.Count()){var Q=H.Get(aa);if(K[Q.Word]!=null){H.RemoveAt(aa)}else{if(H.Get(aa).LanguageToken){H.RemoveAt(aa)}else{aa++}}}var U=0;while(U<d.Count()){for(var T=0;T<n.Count();T++){var Y=n.Get(T);if(Y.Name.toLowerCase()==d.Get(U).Name.toLowerCase()){d.Remove(d.Get(U))}else{U++}}}var y=VoiceHandler.TestInsert(P,H,d,K,true);if(y==0){var N=new ArrayList();for(var T=0;T<d.Count();T++){var t=d.Get(T);if(t.Descriptive){N.Add(t)}}y=VoiceParameter.checkFieldsText(P,H,N,K,true)}var Z=1;var G=K.keys();for(var T=0;T<G.length;T++){var R=G[T];A.Add(new VoiceWord(R))}var I=Z*A.Count()/VoiceHandler.NotLanguageTokens(J);if(I>F){F=I;m=X;g=L;W=x;e=n;z.Clear();z.AddRange(H)}}}}}if(W!=null){h=(h+F)/2;P.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1115,"VoiceRecognizerAction.EvaluateFindCommand","Command "+r.Name+': the panel "'+W.Name+'" in the form "'+g.Name+'" is the target page.');P.DTTObj.AddParameter("","","score",h);var u=new ArrayList();u.Add(m);u.Add(g);u.Add(W);u.Add(e);u.Add(z);r.Param=u;return h}}return 0};VoiceRecognizerAction.prototype.EvaluateReadBookCommand=function(q,D,e){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1055,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+": evaluate command.");var H=new ArrayList();var C=e.Match(q,D,H);if(VoiceHandler.NotLanguageTokens(H)==0){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1056,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+": no unknown words found. This is not the right command.");q.DTTObj.AddParameter("","","command score",0);return 0}if(C>0){var n=q.VoiceObj.FindOnScreen(VoiceHandler.OT_BOOK);q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1057,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+": "+n.Count()+" book found on screen.");var m=null;var a=null;var G=0;for(var B=0;B<n.Count();B++){var s=n.Get(B);var d=new HashTableSrv();var x=VoiceHandler.TokenizeString(s.BookObj.GetName());VoiceHandler.MatchWordList(x,H,d);var b=0;if(d.count()==0){if(n.Count()==1){b=1}}else{b=1}if(b==0){continue}var h=new ArrayList();h.AddRange(H);var E=0;while(E<h.Count()){var r=h.Get(E);if(d[r.Word]!=null){h.RemoveAt(E)}else{E++}}var A=0;var y=false;while(!y){var g=s.BookObj.Book.getPage(A);if(g!=null){var l=new ArrayList();g.GetBoxesList(l);for(var z=0;z<l.Count();z++){var o=l.Get(z);var F=new HashTableSrv();var f=VoiceHandler.TokenizeString(o.GetToolTip());VoiceHandler.MatchWordList(f,H,F);var t=b*F.count()/VoiceHandler.NotLanguageTokens(H);if(t>G){G=t;a=o;m=s}}}else{break}A++}}if(a!=null){C=(C+G)/2;q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1058,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+': the book "'+m.BookObj.GetName()+'" is the target book.');q.DTTObj.AddParameter("","","score",C);var u=new ArrayList();u.Add(a);e.Param=u;return C}}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1059,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+" is not the right command.");q.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateCountCommand=function(Q,D,t){Q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1060,"VoiceRecognizerAction.EvaluateCountCommand","Command "+t.Name+": evaluate command.");var K=new ArrayList();var l=t.Match(Q,D,K);Q.DTTObj.AddParameter("","","command score",l);var G=0;var n=null;var h=null;var W=null;var g=null;var A=new ArrayList();if(l>0){var N=Q.VoiceObj.GetActiveForms(Q);for(var U=0;U<N.Count();U++){var m=N.Get(U);var C=m.RTCGuid;var E=Q.VoiceObj.FindIndeObjByGuid(C);var ac=new HashTableSrv();VoiceHandler.MatchWordList(E.Words,K,ac);if(ac.count()>0||N.Count()==1){var B=new ArrayList();var H=ac.keys();for(var ab=0;ab<H.length;ab++){var P=H[ab];B.Add(new VoiceWord(P))}var r=Q.VoiceObj.FindIndeObjChildren(E.GUID,E.Type,VoiceHandler.OT_PANEL);for(var ab=0;ab<r.Count();ab++){var y=r.Get(ab);var F=new HashTableSrv();VoiceHandler.MatchWordList(y.Words,B,F);if(F.count()==B.Count()){var e=this.GetFieldsArrayFromVoiceObj(Q,y);var I=new ArrayList();I.AddRange(K);var aa=0;while(aa<I.Count()){var R=I.Get(aa);if(ac[R.Word]!=null){I.RemoveAt(aa)}else{if(I.Get(aa).LanguageToken){I.RemoveAt(aa)}else{aa++}}}var L=new HashTableSrv();var o=VoiceHandler.CheckFieldsName(Q,I,e,L,true);if(o.Count()>0){aa=0;while(aa<I.Count()){var R=I.Get(aa);if(L[R.Word]!=null){I.RemoveAt(aa)}else{if(I.Get(aa).LanguageToken){I.RemoveAt(aa)}else{aa++}}}var V=0;while(V<e.Count()){for(var T=0;T<o.Count();T++){var Y=o.Get(T);if(Y.Name.toLowerCase()==e.Get(V).Name.toLowerCase()){e.Remove(e.Get(V))}else{V++}}}}var z=VoiceHandler.TestInsert(Q,I,e,L,true);if(z==0){var O=new ArrayList();var a=new ArrayList();for(var T=0;T<e.Count();T++){var u=e.Get(T);if(u.Descriptive){O.Add(u)}if(u.Type==Glb.DT_DATE||u.Type==Glb.DT_DATETIME){a.Add(u)}}z=VoiceParameter.checkFieldsText(Q,I,a,L,true);if(I.Count()>0){z=VoiceParameter.checkFieldsText(Q,I,O,L,true)}}var Z=1;var H=L.keys();for(var T=0;T<H.length;T++){var S=H[T];B.Add(new VoiceWord(S))}var J=Z*B.Count()/VoiceHandler.NotLanguageTokens(K);if(J>G){G=J;n=null;h=E;W=y;g=o;A.Clear();A.AddRange(I)}}}}}var q=Q.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD);for(var V=0;V<q.Count();V++){var X=q.Get(V);var d=new HashTableSrv();VoiceHandler.MatchWordList(X.Words,K,d);if(d.count()==0){continue}var B=new ArrayList();var H=d.keys();for(var T=0;T<H.length;T++){var P=H[T];B.Add(new VoiceWord(P))}if(X.CustomData==null){continue}var M=Q.VoiceObj.FindIndeObjByGuid(X.CustomData);var ac=new HashTableSrv();VoiceHandler.MatchWordList(M.Words,B,ac);if(ac.count()!=B.Count()){continue}var r=Q.VoiceObj.FindIndeObjChildren(M.GUID,M.Type,VoiceHandler.OT_PANEL);for(var ab=0;ab<r.Count();ab++){var y=r.Get(ab);var F=new HashTableSrv();VoiceHandler.MatchWordList(y.Words,B,F);if(F.count()==B.Count()){var e=this.GetFieldsArrayFromVoiceObj(Q,y);var I=new ArrayList();I.AddRange(K);var aa=0;while(aa<I.Count()){var R=I.Get(aa);if(ac[R.Word]!=null){I.RemoveAt(aa)}else{if(I.Get(aa).LanguageToken){I.RemoveAt(aa)}else{aa++}}}var L=new HashTableSrv();var o=VoiceHandler.CheckFieldsName(Q,I,e,L,true);if(o.Count()>0){aa=0;while(aa<I.Count()){var R=I.Get(aa);if(L[R.Word]!=null){I.RemoveAt(aa)}else{if(I.Get(aa).LanguageToken){I.RemoveAt(aa)}else{aa++}}}var U=0;while(U<e.Count()){for(var T=0;T<o.Count();T++){var Y=o.Get(T);if(Y.Name.toLowerCase()==e.Get(U).Name.toLowerCase()){e.Remove(e.Get(U))}else{U++}}}var z=VoiceHandler.TestInsert(Q,I,e,L,true);if(z==0){var O=new ArrayList();for(var T=0;T<e.Count();T++){var u=e.Get(T);if(u.Descriptive){O.Add(u)}}z=VoiceParameter.checkFieldsText(Q,I,O,L,true)}var Z=1;var H=L.keys();for(var T=0;T<H.length;T++){var S=H[T];B.Add(new VoiceWord(S))}var J=Z*B.Count()/VoiceHandler.NotLanguageTokens(K);if(J>G){G=J;n=X;h=M;W=y;g=o;A.Clear();A.AddRange(I)}}}}}if(W!=null){l=(l+G)/2;Q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1161,"VoiceRecognizerAction.EvaluateCountCommand","Command "+t.Name+': the panel "'+W.Name+'" in the form "'+h.Name+'" is the target page.');Q.DTTObj.AddParameter("","","score",l);var x=new ArrayList();x.Add(n);x.Add(h);x.Add(W);x.Add(g);x.Add(A);t.Param=x;return l}}return 0};VoiceRecognizerAction.prototype.EvaluateDeleteFieldCommand=function(m,G,d){m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1089,"VoiceRecognizerAction.EvaluateDeleteFieldCommand","Command "+d.Name+": evaluate command.");var J=new ArrayList();var C=d.Match(m,G,J);m.DTTObj.AddParameter("","","command score",C);if(C>0){var b=m.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1090,"VoiceRecognizerAction.EvaluateDeleteFieldCommand","Command "+d.Name+": "+b.Count()+" panels found on screen.");for(var z=0;z<b.Count();z++){m.DTTObj.AddParameter("","","panel",b.Get(z).GetDTTCaption())}var B=0;while(B<b.Count()){var r=b.Get(B);if(r.Status()!=Glb.PS_UPDATE){m.DTTObj.AddParameter("","","panel",b.Get(B).GetDTTCaption()+" (removed)");b.Remove(r)}else{m.DTTObj.AddParameter("","","panel",b.Get(B).GetDTTCaption());B++}}var a=null;var y=null;var I=0;var q=false;for(B=0;B<b.Count();B++){var r=b.Get(B);if(VoiceHandler.NotLanguageTokens(J)==0){m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1091,"VoiceRecognizerAction.EvaluateDeleteFieldCommand","Command "+d.Name+": no unknown words found.");if(r.HasFocus()){var s;s=this.GetFieldsArrayFromPanel(r,VRA_INSERT);var K=new HashTableSrv();var e=r.FocusedColumn();for(var x=0;x<s.Count();x++){var E=s.Get(x);var F=E.Obj;if(e!=-1&&F==r.bFields(e)){C=(C+1)/2;m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1092,"VoiceRecognizerAction.EvaluateDeleteFieldCommand","Command "+d.Name+": "+r.GetDTTCaption()+" is the target panel");m.DTTObj.AddParameter("","","score",C);var l=new ArrayList();l.Add(r);l.Add(E);d.Param=l;return C}}}}else{m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1093,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": "+J.Count()+" unknown words found");for(var z=0;z<J.Count();z++){m.DTTObj.AddParameter("","","unknown word",J.Get(z).Word)}var D=m.VoiceObj.FindIndeObjByGuid(r.iGuid);var h=new HashTableSrv();VoiceHandler.MatchWordList(D.Words,J,h);var A=0;if(h.count()==0){if(b.Count()==1||r.HasFocus()){A=1}}else{if(C==0){A=0}else{A=1}}if(A==0){continue}var s;s=this.GetFieldsArrayFromPanel(r,VRA_INSERT);var K=new HashTableSrv();var g=new ArrayList();g.AddRange(J);var H=0;while(H<g.Count()){var n=g.Get(H);if(h.containsKey(n.Word)){g.RemoveAt(H)}else{H++}}if(g.Count()>0&&g.Get(H-1).LanguageToken){g.RemoveAt(H-1)}var u=new ArrayList();u.AddRange(J);var e=r.FocusedColumn();for(var x=0;x<s.Count();x++){var E=s.Get(x);var F=E.Obj;if(e!=-1&&F==r.bFields(e)){var o=K.keys();for(var z=0;z<o.length;z++){h[o[z]]=K[o[z]]}var t=A*h.count()/VoiceHandler.NotLanguageTokens(J);if(t>I){I=t;a=r;y=E}}}}}if(a!=null){C=(I+C)/2;m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1094,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+': the panel "'+a.GetDTTCaption()+'" is the target panel');m.DTTObj.AddParameter("","","score",C);var L=new ArrayList();L.Add(a);L.Add(y);d.Param=L;return C}m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1095,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": no target panel found")}m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1096,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+" is not the right command.");m.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.ExecuteCommand=function(e){if(this.bestCmd.Index==VoiceRecognizerAction.VRA_LOCK){this.ExecuteLockCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_UNLOCK){this.ExecuteUnlockCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DUPLICATE){var a=this.ExecuteDuplicateCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(a)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DELETE){this.ExecuteDeleteCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_SAVE){this.ExecuteSaveCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_CANCEL){this.ExecuteCancelCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_REFRESH){this.ExecuteRefreshCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_EXPORT){this.ExecuteExportCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_PRINT){this.ExecutePrintCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_CANCELSELECTION){this.ExecuteCancelSelectionCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_SELECTALL){this.ExecuteSelectAllCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_REVERTSELECTION){this.ExecuteRevertSelectionCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_INSERT){this.ExecuteInsertCommand(e);var c=this.bestCmd.Param;var o=c.Get(0);var x=new ArrayList();if(c.Count()>1){x=c.Get(1)}var l="";for(var v=0;v<x.Count();v++){var y=x.Get(v);var B=y.text;if(B.Count()>0){l+=y.Name;l+=" ";for(var t=0;t<B.Count();t++){if(t>3){l+="...";break}l+=B.Get(t).Word;l+=" "}}}return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(l),new IDVariant(o.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_WRITE){this.ExecuteWriteCommand();var o=this.bestCmd.Param.Get(0);var x=this.bestCmd.Param.Get(1);var l="";for(var v=0;v<x.Count();v++){var y=x.Get(v);var B=y.text;if(B.Count()>0){l+=y.Name;l+=" ";for(var t=0;t<B.Count();t++){if(t>3){l+="...";break}l+=B.Get(t).Word;l+=" "}}}return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(l),new IDVariant(o.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DUPLICATEROW){this.ExecuteDuplicateRowCommand();var o=this.bestCmd.Param.Get(0);var C=this.bestCmd.Param.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(String.valueOf(C)),new IDVariant(o.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DELETEROW){this.ExecuteDeleteRowCommand();var o=this.bestCmd.Param.Get(0);var C=this.bestCmd.Param.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(String.valueOf(C)),new IDVariant(o.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_SELECT){this.ExecuteSelectCommand();var o=this.bestCmd.Param.Get(0);var C=this.bestCmd.Param.Get(1);var l="";for(var v=0;v<C.Count();v++){l+=C.Get(v);l+=" "}return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(l),new IDVariant(o.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_RUN){this.ExecuteRunCommand(e);var c=this.bestCmd.Param;var u=c.Get(2);if(u==null){u=c.Get(0)}return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(u.Name)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_FIND){var q=this.ExecuteFindCommand(e);if(q>=0){return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(q)).stringValue()}else{return"???"}}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_CLOSE){this.ExecuteCloseCommand(e);var A=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(A.Get(0).Caption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_CLOSEALL){this.ExecuteCloseAllCommand(e);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_OPEN){this.ExecuteOpenCommand(e);var c=this.bestCmd.Param;var u=c.Get(0);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(u.Name)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_STOP){this.ExecuteStopCommand(e);return""}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_FINDBOOK){this.ExecuteGoToSectionBookCommand(e);return""}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_READ){var m=this.ExecuteReadCommand(e);if(m!=null){var g=m.Get(0);var b=m.Get(1);var n=m.Get(2);var d=g.Fields;if(b!=null&&b.Count()>0){var k="";for(var v=0;v<b.Count();v++){var A=b.Get(v);for(var t=0;t<d.length;t++){var h=d[t];if(A.Name==h.Header){k+=h.bValues(g.AttR).Value.stringValue()+" "}}}if(n){e.UnloadForm(g.Parent.FormIdx)}var z=this.bestCmd.Description.split(";");if(k.trim().length>0){return IDL.FormatMessage(new IDVariant(z[0]),new IDVariant(k)).stringValue()}if(z.length>0){return z[1]}return""}else{var r=g.FocusedColumn();var k=d[r].bValues(g.AttR).Value.stringValue()+" ";if(n){e.UnloadForm(g.Parent.FormIdx)}var z=this.bestCmd.Description.split(";");if(k.trim().length>0){return IDL.FormatMessage(new IDVariant(z[0]),new IDVariant(k)).stringValue()}if(z.length>0){return z[1]}return""}}}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_COUNT){var D=this.ExecuteCountCommand(e);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(D)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_READBOOK){var k=this.ExecuteReadBookCommand(e);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(k.trim())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DELETEFIELD){this.ExecuteDeleteFieldCommand();return this.bestCmd.Description}return""};VoiceRecognizerAction.prototype.ExecuteLockCommand=function(){this.bestCmd.Param.set_Locked(true)};VoiceRecognizerAction.prototype.ExecuteUnlockCommand=function(){this.bestCmd.Param.set_Locked(false)};VoiceRecognizerAction.prototype.ExecuteDuplicateCommand=function(){var b=this.bestCmd.Param;var a=b.ActualPosition();this.bestCmd.Param.PanelCommand(Glb.PCM_DUPLICATE,0,true);return a};VoiceRecognizerAction.prototype.ExecuteDeleteCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_DELETE,0,true)};VoiceRecognizerAction.prototype.ExecuteSaveCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_UPDATE,0,true)};VoiceRecognizerAction.prototype.ExecuteCancelCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_CANCEL,0,true)};VoiceRecognizerAction.prototype.ExecuteRefreshCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_REQUERY,0,true)};VoiceRecognizerAction.prototype.ExecuteExportCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_CSV,0,true)};VoiceRecognizerAction.prototype.ExecutePrintCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_PRINT,0,true)};VoiceRecognizerAction.prototype.ExecuteCancelSelectionCommand=function(){var a=this.bestCmd.Param;if(!a.ShowMultipleSel()){a.set_ShowMultipleSel(true,true)}a.ChangeSelection(0)};VoiceRecognizerAction.prototype.ExecuteSelectAllCommand=function(){var a=this.bestCmd.Param;if(!a.ShowMultipleSel()){a.set_ShowMultipleSel(true,true)}a.ChangeSelection(2)};VoiceRecognizerAction.prototype.ExecuteRevertSelectionCommand=function(){var a=this.bestCmd.Param;if(!a.ShowMultipleSel()){a.set_ShowMultipleSel(true,true)}a.ChangeSelection(1)};VoiceRecognizerAction.prototype.ExecuteCloseCommand=function(a){var b=this.bestCmd.Param;a.UnloadForm(b.Get(0).FormIdx)};VoiceRecognizerAction.prototype.ExecuteCloseAllCommand=function(a){a.HandleCloseAllEvent(null)};VoiceRecognizerAction.prototype.ExecuteInsertCommand=function(u){var o=this.bestCmd.Param;var B=o.Get(0);var I=new ArrayList();if(o.Count()>1){I=o.Get(1)}B.PanelCommand(Glb.PCM_INSERT,0,true);for(var H=0;H<I.Count();H++){var J=I.Get(H);var N=J.text;if(N.Count()>0){var L=I.Get(H).Obj;var A="";for(var F=0;F<N.Count();F++){A+=N.Get(F).Word;A+=" "}var z=A.trim();z=z.substring(0,1).toUpperCase()+z.substring(1);var y="";if((B.Layout()==Glb.PANEL_LIST&&L.ListNumRow>0)||(B.Layout()==Glb.PANEL_FORM&&L.FormNumRow>0)){y=L.bValues(B.SelectedRow()).LastRDText+" "}var O=L.Values[B.SelectedRow()].GetRD3Ident();B.RD3ValChange(O,y+z);if(L.IdxPanel>0){while(z.length>3){var g=-1;var t=0;B.UpdatePanel(u);var d=B.Queries[L.IdxPanel].RS.RecordCount();if(d==0){z=z.substring(0,z.length-1);B.RD3ValChange(O,z);continue}else{if(d>1){var r=B.Queries[L.IdxPanel].RS;var q=false;var a=0;try{r.MoveFirst();while(!r.EOF()){var n=false;for(var F=1;F<=r.GetNumFields();F++){var m=false;if(B.Queries[L.IdxPanel].VisibleColumns!=null){for(var b=0;b<B.Queries[L.IdxPanel].VisibleColumns.Count();b++){if(B.Queries[L.IdxPanel].VisibleColumns.get(b).toLowerCase()==r.GetName(F).toLowerCase()){m=true;break}}}if(!m){m=true;var h=B.Queries[L.IdxPanel].LKEParams.listIterator();while(h.hasNext()){var D=h.next();if(D.PropName.toLowerCase()==r.GetName(F).toLowerCase()){m=false;break}}}if(!m){continue}var C=r.Get(F).stringValue();var x=VoiceHandler.TokenizeString(C);var c=0;for(var E=0;E<x.Count();E++){var K=x[E];if(K.Word.contains(z)){c++}}if(c==x.Count()){n=true;break}else{if(c>0){var G=x.Count()/c;if(G>t){t=G;g=a}}}}if(n){q=true;B.RD3ValChange(O,"LKE"+(a+1));break}else{if(g>-1){q=true}}r.MoveNext();a++}}catch(M){}if(!q){B.RD3ValChange(O,"LKENULL")}else{if(g>-1){B.RD3ValChange(O,"LKE"+(g+1))}}}break}}}}}B.ReValidate()};VoiceRecognizerAction.prototype.ExecuteWriteCommand=function(){var l=this.bestCmd.Param.Get(0);var h=this.bestCmd.Param.Get(1);l.set_Locked(false);for(var d=0;d<h.Count();d++){var a=h.Get(d);var g=a.text;if(g.Count()>0){var e=h.Get(d).Obj;var n="";if((l.Layout()==Glb.PANEL_LIST&&e.ListNumRow>1)||(l.Layout()==Glb.PANEL_FORM&&e.FormNumRow>1)){n=e.bValues(0).Text}var o=n+" ";var b=0;if(g.Get(0).Word.toLowerCase()=="in"){b=1}for(var c=b;c<g.Count();c++){o+=g.Get(c).Word;o+=" "}var m=o.trim();m=m.substring(0,1).toUpperCase()+m.substring(1);var k=e.Values[l.SelectedRow()].GetRD3Ident();l.RD3ValChange(k,m);l.Parent.FocusPriority=0;l.set_ActualPosition(l.SelectedRow());if(l.IsShowingGrouping()){l.set_SelectedRow(0);l.ForceSendPosition=true}l.SetInput(-1,e.Index,2)}}l.ReValidate()};VoiceRecognizerAction.prototype.ExecuteDuplicateRowCommand=function(){var c=this.bestCmd.Param;var b=c.Get(0);var a=c.Get(1);b.Parent.FocusPriority=0;b.set_ActualPosition(a);if(b.IsShowingGrouping()){b.set_SelectedRow(0);b.ForceSendPosition=true}b.SetInput();b.PanelCommand(Glb.PCM_DUPLICATE,0,true)};VoiceRecognizerAction.prototype.ExecuteDeleteRowCommand=function(){var c=this.bestCmd.Param;var b=c.Get(0);var a=c.Get(1);b.Parent.FocusPriority=0;b.set_ActualPosition(a);if(b.IsShowingGrouping()){b.set_SelectedRow(0);b.ForceSendPosition=true}b.SetInput();b.PanelCommand(Glb.PCM_DELETE,0,true)};VoiceRecognizerAction.prototype.ExecuteSelectCommand=function(){var d=this.bestCmd.Param;var c=d.Get(0);var b=d.Get(1);if(!c.ShowMultipleSel()){c.set_ShowMultipleSel(true,true)}for(var a=0;a<b.Count();a++){c.SetRowSelected(true,b.Get(a))}c.Parent.FocusPriority=0;c.set_ActualPosition(b.Get(0));if(c.IsShowingGrouping()){c.set_SelectedRow(0);c.ForceSendPosition=true}c.SetInput()};VoiceRecognizerAction.prototype.ExecuteRunCommand=function(n){var c=null;var a=this.bestCmd.Param;var m=a.Get(0);var g=null;var f=n.VoiceObj.GetActiveForms(n);var k=m.Name.split(" ").join("");for(var b=0;b<f.Count()&&g==null;b++){c=f.Get(b);g=c[k]}if(g==null){c=n;g=c[k]}if(g!=null){try{var q=[];var l=a.Get(1);for(var d=0;d<l.Count();d++){var r=l.Get(d).text;var u="";for(varj=0;b<r.Count();b++){u+=r.Get(b).Word+" "}u=u.trim();var o=new IDVariant(u);o.changeType(IDL.DataType2IDVariantType(l.Get(d).Type));q.push(o)}g.apply(c,q)}catch(h){}}};VoiceRecognizerAction.prototype.ExecuteFindCommand=function(o){var G=this.bestCmd.Param.Get(0);var b=this.bestCmd.Param.Get(1);var q=this.bestCmd.Param.Get(2);var N=this.bestCmd.Param.Get(3);var a=new ArrayList();var z=null;if(G!=null){for(var H=0;H<o.CmdObj.CmdLin.length;H++){var g=o.CmdObj.CmdLin[H];if(g==null||g.IdxForm!=0){continue}if(g.iGuid.toLowerCase()==G.GUID.toLowerCase()&&g.bVisible(0)&&g.IsEnabled(0)){o.CmdClickCB(g.Index);break}}}var D=null;var h=o.VoiceObj.GetActiveForms(o);for(var H=0;H<h.Count();H++){var J=h.Get(H);if(J.RTCGuid.toLowerCase()==b.GUID.toLowerCase()){D=J;break}}if(D==null){o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1124,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: form "'+b.Name+'" not found');return -1}for(var H=0;H<D.Frames.length;H++){var J=D.Frames[H];if(J!=null&&J.Content!=null&&J.Content.iGuid.toLowerCase()==q.GUID.toLowerCase()){z=J.Content;break}}if(z==null){o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1125,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: panel "'+q.Name+'" not found');return -1}var M=0;while(M<N.Count()){if(N.Get(M).LanguageToken){N.RemoveAt(M)}else{M++}}var A=this.GetFieldsArrayFromPanel(z,VoiceRecognizerAction.VRA_FIND);var O=new HashTableSrv();var v=VoiceHandler.TestInsert(o,N,A,O,true);a.AddRange(A);if(v==0){v=VoiceParameter.checkValueListFields(o,N,A,O);if(v==0){var l=new ArrayList();for(var E=0;E<A.Count();E++){var I=A.Get(E);if(I.Descriptive){l.Add(I)}}v=VoiceParameter.checkFieldsText(o,N,l,O,false)}}var e=0;if(v>0){if(z.Status()!=Glb.PS_QBE){z.PanelCommand(Glb.PCM_SEARCH)}if(z.Status()!=Glb.PS_QBE){o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1126,"VoiceRecognizerAction.ExecuteFind","VoiceRecognizerAction: can't place the panel in QBE status");return -1}z.PanelCommand(Glb.PCM_CANCEL);var n=new HashTableSrv();for(var F=0;F<a.Count();F++){var x=a.Get(F);var J=x.Obj;var K=x.text;if(K.Count()>0){var u="";for(var E=0;E<K.Count();E++){u+=K.Get(E).Word;u+=" "}n[J.Index]=u.trim()}}var y=z.QBEEmpty;z.QBEEmpty=false;var d=1;while(e<=0){z.EnterQBE();var C=true;var B=false;var t=n.keys();for(var F=0;F<t.length;F++){var m=t[F];var r=n[m];if(r.length-d>3||d==0){r=r.substring(0,r.length-d);var J=z.Fields[m];if(r.length>0&&Glb.ClassDT(J.DataType)==Glb.DTC_CHAR&&J.QBELike&&J.IdxPanel==0&&J.ValueList.Count()==0){r="*"+r+"*"}var L=J.Values[z.SelectedRow()].GetRD3Ident();z.RD3ValChange(L,r);if(J.Values[z.SelectedRow()].Text.length==0){B=true;break}C=false}}d++;if(!B){if(C){z.QBEEmpty=y;return 0}z.PanelCommand(Glb.PCM_FIND);e=z.bQueries(0).RecordCount()}}z.QBEEmpty=y}return e};VoiceRecognizerAction.prototype.ExecuteOpenCommand=function(a){var e=this.bestCmd.Param;var c=e.Get(0);if(c!=null){for(var b=0;b<a.CmdObj.CmdLin.length;b++){var d=a.CmdObj.CmdLin[b];if(d==null||d.IdxForm!=0){continue}if(d.iGuid.toLowerCase()==c.GUID.toLowerCase()&&d.bVisible(0)&&d.IsEnabled(0)){a.CmdClickCB(d.Index);break}}}};VoiceRecognizerAction.prototype.ExecuteStopCommand=function(a){a.VoiceObj.set_Listening(false)};VoiceRecognizerAction.prototype.ExecuteGoToSectionBookCommand=function(a){var d=this.bestCmd.Param;var b=d.Get(0);var c=d.Get(1);b.BookCommand(IDREGlb.BCM_NAVIGATION,4,false,c)};VoiceRecognizerAction.prototype.ExecuteReadCommand=function(r){var I=this.bestCmd.Param.Get(0);var b=this.bestCmd.Param.Get(1);var t=this.bestCmd.Param.Get(2);var g=this.bestCmd.Param.Get(3);var P=this.bestCmd.Param.Get(4);var a=new ArrayList();var B=null;if(I!=null){for(var J=0;J<r.CmdObj.CmdLin.length;J++){var h=r.CmdObj.CmdLin[J];if(h==null||h.IdxForm!=0){continue}if(h.iGuid.toLowerCase()==I.GUID.toLowerCase()&&h.bVisible(0)&&h.IsEnabled(0)){r.CmdClickCB(h.Index);break}}}var F=null;var l=r.VoiceObj.GetActiveForms(r);for(var J=0;J<l.Count();J++){var L=l.Get(J);if(L.RTCGuid.toLowerCase()==b.GUID.toLowerCase()){F=L;break}}if(F==null){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1124,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: form "'+b.Name+'" not found');return null}for(var J=0;J<F.Frames.length;J++){var L=F.Frames[J];if(L!=null&&L.Content!=null&&L.Content.iGuid.toLowerCase()==t.GUID.toLowerCase()){B=L.Content;break}}if(B==null){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1125,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: panel "'+t.Name+'" not found');return null}var O=0;while(O<P.Count()){if(P.Get(O).LanguageToken){P.RemoveAt(O)}else{O++}}if(P.Count()>0){var C=this.GetFieldsArrayFromPanel(B,VoiceRecognizerAction.VRA_FIND);var Q=new HashTableSrv();if(g.Count()>0){var J=0;while(J<C.Count()){for(var H=0;H<g.Count();H++){var L=g.Get(H);if(L.Name.toLowerCase()==C.Get(J).Name.toLowerCase()){Q[C.Get(J).Name]=1;C.Remove(C.Get(J))}else{J++}}}}var y=VoiceHandler.TestInsert(r,P,C,Q,true);a.AddRange(C);if(y==0){y=VoiceParameter.checkValueListFields(r,P,C,Q);if(y==0){var m=new ArrayList();for(var G=0;G<C.Count();G++){var K=C.Get(G);if(K.Descriptive){m.Add(K)}}y=VoiceParameter.checkFieldsText(r,P,m,Q,false)}}var e=0;if(y>0){if(B.Status()!=Glb.PS_QBE){B.PanelCommand(Glb.PCM_SEARCH)}if(B.Status()!=Glb.PS_QBE){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1126,"VoiceRecognizerAction.ExecuteFind","VoiceRecognizerAction: can't place the panel in QBE status");return null}B.PanelCommand(Glb.PCM_CANCEL);var q=new HashTableSrv();for(var H=0;H<a.Count();H++){var z=a.Get(H);var L=z.Obj;var M=z.text;if(M.Count()>0){var x="";for(var G=0;G<M.Count();G++){x+=M.Get(G).Word;x+=" "}q[L.Index]=x.trim()}}var A=B.QBEEmpty;B.QBEEmpty=false;var d=0;while(e<=0){B.EnterQBE();var E=true;var D=false;var v=q.keys();for(var G=0;G<v.length;G++){var o=v[G];var u=q[o];if(u.length-d>3||d==0){u=u.substring(0,u.length-d);var L=B.Fields[o];if(u.length>0&&Glb.ClassDT(L.DataType)==Glb.DTC_CHAR&&L.QBELike&&L.IdxPanel==0&&L.ValueList.Count()==0){u="*"+u+"*"}var N=L.Values[B.SelectedRow()].GetRD3Ident();B.RD3ValChange(N,u);if(L.Values[B.SelectedRow()].Text.length==0){D=true;break}E=false}}d++;if(!D){if(E){B.QBEEmpty=A;return null}B.PanelCommand(Glb.PCM_FIND);e=B.bQueries(0).RecordCount()}}B.QBEEmpty=A;var n=new ArrayList();n.Add(B);n.Add(g);if(I!=null){n.Add(true)}else{n.Add(false)}return n}}else{var n=new ArrayList();n.Add(B);n.Add(g);if(I!=null){n.Add(true)}else{n.Add(false)}return n}return null};VoiceRecognizerAction.prototype.ExecuteCountCommand=function(q){var I=this.bestCmd.Param.Get(0);var b=this.bestCmd.Param.Get(1);var r=this.bestCmd.Param.Get(2);var g=this.bestCmd.Param.Get(3);var P=this.bestCmd.Param.Get(4);var a=new ArrayList();var A=null;if(I!=null){for(var J=0;J<q.CmdObj.CmdLin.length;J++){var h=q.CmdObj.CmdLin[J];if(h==null||h.IdxForm!=0){continue}if(h.iGuid.toLowerCase()==I.GUID.toLowerCase()&&h.bVisible(0)&&h.IsEnabled(0)){q.CmdClickCB(h.Index);break}}}var E=null;var l=q.VoiceObj.GetActiveForms(q);for(var J=0;J<l.Count();J++){var L=l.Get(J);if(L.RTCGuid.toLowerCase()==b.GUID.toLowerCase()){E=L;break}}if(E==null){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1124,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: form "'+b.Name+'" not found');return -1}for(var J=0;J<E.Frames.length;J++){var L=E.Frames[J];if(L!=null&&L.Content!=null&&L.Content.iGuid.toLowerCase()==r.GUID.toLowerCase()){A=L.Content;break}}if(A==null){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1125,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: panel "'+r.Name+'" not found');return -1}var O=0;while(O<P.Count()){if(P.Get(O).LanguageToken){P.RemoveAt(O)}else{O++}}if(P.Count()>0){var B=this.GetFieldsArrayFromPanel(A,VoiceRecognizerAction.VRA_FIND);var Q=new HashTableSrv();if(g.Count()>0){var J=0;while(J<B.Count()){for(var H=0;H<g.Count();H++){var L=g.Get(H);if(L.Name.toLowerCase()==B.Get(J).Name.toLowerCase()){Q[B.Get(J).Name]=1;B.Remove(B.Get(J))}else{J++}}}}var x=VoiceHandler.TestInsert(q,P,B,Q,true);a.AddRange(B);if(x==0){x=VoiceParameter.checkValueListFields(q,P,B,Q);if(P.Count()>Q.count()){if(x==0){var m=new ArrayList();var G=new ArrayList();for(var F=0;F<B.Count();F++){var K=B.Get(F);if(K.Descriptive){m.Add(K)}if(K.Type==Glb.DT_DATE||K.Type==Glb.DT_DATETIME){G.Add(K)}}x=VoiceParameter.checkFieldsText(q,P,G,Q,false);x=VoiceParameter.checkFieldsText(q,P,m,Q,false)}}}var e=0;if(x>0){if(A.Status()!=Glb.PS_QBE){A.PanelCommand(Glb.PCM_SEARCH)}if(A.Status()!=Glb.PS_QBE){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1126,"VoiceRecognizerAction.ExecuteFind","VoiceRecognizerAction: can't place the panel in QBE status");return -1}A.PanelCommand(Glb.PCM_CANCEL);var o=new HashTableSrv();for(var H=0;H<a.Count();H++){var y=a.Get(H);var L=y.Obj;var M=y.text;if(M.Count()>0){var v="";for(var F=0;F<M.Count();F++){v+=M.Get(F).Word;v+=" "}o[L.Index]=v.trim()}}var z=A.QBEEmpty;A.QBEEmpty=false;var d=0;while(e<=0){A.EnterQBE();var D=true;var C=false;var u=o.keys();for(var H=0;H<u.length;H++){var n=u[H];var t=o[n];if(t.length-d>3||d==0){t=t.substring(0,t.length-d);var L=A.Fields[n];if(t.length>0&&Glb.ClassDT(L.DataType)==Glb.DTC_CHAR&&L.QBELike&&L.IdxPanel==0&&L.ValueList.Count()==0){t="*"+t+"*"}var N=L.Values[A.SelectedRow()].GetRD3Ident();A.RD3ValChange(N,t);if(L.Values[A.SelectedRow()].Text.length==0){C=true;break}D=false}}d++;if(!C){if(D){A.QBEEmpty=z;return 0}A.PanelCommand(Glb.PCM_FIND);e=A.bQueries(0).RecordCount()}}A.QBEEmpty=z}return e}else{return A.bQueries(0).RecordCount()}};VoiceRecognizerAction.prototype.ExecuteReadBookCommand=function(a){var b=this.bestCmd.Param.Get(0);return b.GetInnerText()};VoiceRecognizerAction.prototype.ExecuteDeleteFieldCommand=function(){var d=this.bestCmd.Param.Get(0);var c=this.bestCmd.Param.Get(1);var b=c.Obj;var a=b.Values[d.SelectedRow()].GetRD3Ident();d.RD3ValChange(a,"");return""};VoiceRecognizerAction.prototype.EvaluateProc=function(j,t,u){var c=new HashTableSrv();VoiceHandler.MatchWordList(t.Words,u,c);if(c.count()==0){return null}var q=1;var h=null;if(t.Type==VoiceHandler.OT_PFIELD||t.Type==VoiceHandler.OT_CMD){var n="";if(t.Type==VoiceHandler.OT_PFIELD){var g=t.CustomData.lastIndexOf("|");n=t.CustomData.substring(g+1)}else{if(t.Type==VoiceHandler.OT_CMD){n=t.CustomData}}h=j.VoiceObj.FindIndeObjByGuid(n)}else{h=t}var o=this.GetParametersArray(j,h);var e=new ArrayList();e.AddRange(u);var r=0;while(r<e.Count()){var l=e.Get(r);if(c.containsKey(l.Word)){e.RemoveAt(r)}else{r++}}var d=1;if(e.Count()>0&&o.Count()>0){var b=new HashTableSrv();d=VoiceHandler.TestInsert(j,e,o,b,false);if(d==0){d=VoiceParameter.checkFieldsText(j,e,o,b,false);if(d==0){d=0.1}}var m=b.keys();for(r=0;r<m.length;r++){c[m[r]]=b[m[r]]}}var s=0;var a=o.Count();if(a!=0){s=d/a}else{s=d}s*=q*c.count()/VoiceHandler.NotLanguageTokens(u);var x=new ArrayList();x.Add(s);x.Add(h);x.Add(o);return x};VoiceRecognizerAction.prototype.GetFieldsArrayFromPanel=function(h,g){var c=new ArrayList();var d=h.Fields;for(var b=0;b<d.length;b++){var e=d[b];if(e.DataType==Glb.DT_DOC_OLE){continue}if(e.IdxPanel<0){continue}if(e.Page!=-1){if((e.Parent.bPages(e.Page).Flags&Glb.OBJ_VISIBLE)==0||(e.Parent.bPages(e.Page).Flags&Glb.OBJ_ENABLED)==0){continue}}if(e.Group!=-1){if((e.Parent.bGroups(e.Group).Flags&Glb.OBJ_VISIBLE)==0||(e.Parent.bGroups(e.Group).Flags&Glb.OBJ_ENABLED)==0){continue}}if((e.Flags&Glb.OBJ_VISIBLE)==0){continue}if(g==VoiceRecognizerAction.VRA_INSERT&&e.Unbound){continue}if((e.Flags&Glb.OBJ_ENABLED)==0){continue}if((e.Flags&Glb.FLD_INFORM)==0&&h.Layout()==Glb.PANEL_FORM){continue}if((e.Flags&Glb.FLD_INLIST)==0&&h.Layout()==Glb.PANEL_LIST){continue}var a=new VoiceParameter();a.Obj=e;a.Name=e.Header;a.Description=e.Tooltip;a.Type=e.DataType;a.Length=e.MaxLength;if((e.Flags&Glb.FLD_ISDESCR)>0){a.Descriptive=true}c.Add(a)}return c};VoiceRecognizerAction.prototype.GetFieldsArrayFromVoiceObj=function(n,l){var j=new ArrayList();var d=n.VoiceObj.FindIndeObjByType(VoiceHandler.OT_PFIELD);var o=l.GUID;for(var e=0;e<d.Count();e++){var b=d.Get(e);var m=n.VoiceObj.FindIndeObjByGuid(b.ParentGuid);while(m!=null&&m.Type!=VoiceHandler.OT_PANEL){m=n.VoiceObj.FindIndeObjByGuid(m.ParentGuid)}if(m!=null&&m.GUID.toLowerCase()==o.toLowerCase()){var g=b.CustomData.indexOf("|");var h=b.CustomData.indexOf("|",g+1);var k=b.CustomData.substring(0,g);var c=b.CustomData.substring(g+1,h);g=h;h=b.CustomData.indexOf("|",g+1);var f="";if(h!=-1){f=b.CustomData.substring(g+1,h)}else{f=b.CustomData.substring(g+1)}var a=new VoiceParameter();a.Name=b.Name;a.Type=parseInt(k);a.Length=parseInt(c);a.Descriptive=(f=="-1"?true:false);j.Add(a)}}return j};VoiceRecognizerAction.prototype.GetParametersArray=function(b,a){var f=new ArrayList();var e=b.VoiceObj.FindIndeObjByType(VoiceHandler.OT_PARAM);var g=a.GUID;for(var d=0;d<e.Count();d++){var h=e.Get(d);if(h.ParentGuid==g){var c=new VoiceParameter();c.Name=h.Name;c.Type=Integer.parseInt(h.CustomData);f.Add(c)}}return f};function VoiceRecognizerNavigator(){VoiceCommandRecognizer.call(this);this.bestCmd=null;for(var a=0;a<14;a++){var b=new VoiceCommand();b.Index=a;this.CommandList.Add(b)}}VoiceRecognizerNavigator.prototype=new VoiceCommandRecognizer();VoiceRecognizerNavigator.VRN_GOTOP=0;VoiceRecognizerNavigator.VRN_GOBOTTOM=1;VoiceRecognizerNavigator.VRN_GOUP=2;VoiceRecognizerNavigator.VRN_GODOWN=3;VoiceRecognizerNavigator.VRN_GOLIST=4;VoiceRecognizerNavigator.VRN_GODETAIL=5;VoiceRecognizerNavigator.VRN_GOTOPAGE=6;VoiceRecognizerNavigator.VRN_GOTOROW=7;VoiceRecognizerNavigator.VRN_GOTOFIELD=8;VoiceRecognizerNavigator.VRN_GONEXT=9;VoiceRecognizerNavigator.VRN_GOPREV=10;VoiceRecognizerNavigator.VRN_GOFIRST=11;VoiceRecognizerNavigator.VRN_GOLAST=12;VoiceRecognizerNavigator.VRN_GOTOPAGEBOOK=13;VoiceRecognizerNavigator.prototype.EvaluateCommand=function(a,d){VoiceCommandRecognizer.prototype.EvaluateCommand.call(this,a,d);var e=0;var f=0;for(var c=0;c<6;c++){var b=this.CommandList.Get(c);e=this.EvaluateGo(a,d,b);if(e>f){f=e;this.bestCmd=b}}e=this.EvaluateGotopageCommand(a,d);if(e>f){f=e;this.bestCmd=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOPAGE)}e=this.EvaluateGotoRowCommand(a,d);if(e>f){f=e;this.bestCmd=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOROW)}for(var c=9;c<13;c++){var b=this.CommandList.Get(c);e=this.EvaluateGoBookCommand(a,d,b);if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}e=this.EvaluateGoToPageBookCommand(a,d);if(e>f){f=e;this.bestCmd=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOPAGEBOOK)}if(f<1){e=this.EvaluateGotoFieldCommand(a,d);if(e>f){f=e;this.bestCmd=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOFIELD)}}if(this.bestCmd!=null){a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1003,"VoiceRecognizerNavigator.EvaluateCommand",'VoiceRecognizerNavigator: the best command is "'+this.bestCmd.Name+'"');a.DTTObj.AddParameter("","","score",f)}return f};VoiceRecognizerNavigator.prototype.EvaluateGo=function(e,t,d){e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1004,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": evaluate command.");var x=new ArrayList();var r=d.Match(e,t,x);e.DTTObj.AddParameter("","","command score",r);if(r>0){var u=-1;if(d.Index==VoiceRecognizerNavigator.VRN_GOLIST){u=Glb.PANEL_LIST}else{u=Glb.PANEL_FORM}var c=e.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1005,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": "+c.Count()+" panels found on screen.");var o=0;while(o<c.Count()){var h=c.Get(o);var l=false;if(h.Layout()==u){l=true}else{if(h.Status()!=Glb.PS_DATA){l=true}else{if(h.GetNumRows()==0){l=true}else{if(d.Index==VoiceRecognizerNavigator.VRN_GODETAIL&&u==Glb.PANEL_FORM&&(h.Flags&Glb.PAN_HASFORM)==0){l=true}else{if(d.Index==VoiceRecognizerNavigator.VRN_GOLIST&&u==Glb.PANEL_LIST&&(h.Flags&Glb.PAN_HASLIST)==0){l=true}}}}}if(l){e.DTTObj.AddParameter("","","panel",(c.Get(o)).GetDTTCaption()+" (removed)");c.remove(h)}else{e.DTTObj.AddParameter("","","panel",(c.Get(o)).GetDTTCaption());o++}}var b=null;var v=0;var g=false;for(o=0;o<c.Count();o++){var h=c.Get(o);if(VoiceHandler.NotLanguageTokens(x)==0){e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1006,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": no unknown words found.");if(h.HasFocus()){r=(r+1)/2;e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1007,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": "+h.GetDTTCaption()+" is the target panel");e.DTTObj.AddParameter("","","score",r);d.Param=h;return r}else{if(!g){b=h;g=true}else{b=null}}}else{e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1008,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": "+x.Count()+" unknown words found");for(var n=0;n<x.Count();n++){e.DTTObj.AddParameter("","","unknown word",x.Get(n).Word)}var s=e.VoiceObj.FindIndeObjByGuid(h.iGuid);usedWords=new HashTableSrv();VoiceHandler.MatchWordList(s.Words,x,usedWords);var q=0;if(usedWords.count()==0){if(c.Count()==1){q=1}else{if(h.HasFocus()){q=0.3}}}else{q=1}if(q==0){continue}var a=0;var f=usedWords.keys();for(var m=0;m<f.length;m++){var y=f[m];a+=usedWords[y]}a/=VoiceHandler.NotLanguageTokens(x);a*=q*usedWords.count()/VoiceHandler.NotLanguageTokens(x);if(a>v){v=a;b=h}}}if(b!=null){r=(v+r)/2;e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1009,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target panel');e.DTTObj.AddParameter("","","score",r);d.Param=b;return r}e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1010,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": no target panel found")}e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1011,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+" is not the right command.");e.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerNavigator.prototype.EvaluateGotopageCommand=function(f,t){var e=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOPAGE);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1012,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": evaluate command.");var x=new ArrayList();var s=e.Match(f,t,x);f.DTTObj.AddParameter("","","command score",s);if(s>0){if(VoiceHandler.NotLanguageTokens(x)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1013,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": no unknown words found. This is not the right command.");f.DTTObj.AddParameter("","","score",0);return 0}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1014,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": "+x.Count()+" unknown words found");for(var o=0;o<x.Count();o++){f.DTTObj.AddParameter("","","unknown word",x.Get(o).Word)}var d=f.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1015,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": "+d.Count()+" panels found on screen.");var q=0;while(q<d.Count()){var m=d.Get(q);if(m.Pages.length<=0){f.DTTObj.AddParameter("","","panel",(d.Get(q)).GetDTTCaption()+" (removed)");d.Remove(m)}else{f.DTTObj.AddParameter("","","panel",(d.Get(q)).GetDTTCaption());q++}}var v=0;var c=null;for(q=0;q<d.Count();q++){var m=d.Get(q);var b=f.VoiceObj.FindIndeObjByGuid(m.iGuid);var l=new HashTableSrv();VoiceHandler.MatchWordList(b.Words,x,l);var r=0;if(l.count()==0){if(d.Count()==1){r=1}else{if(m.HasFocus()){r=0.3}else{r=0.1}}}else{r=1}if(r==0){continue}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1016,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": found "+m.Pages.length+" pages of the panel "+m.GetDTTCaption()+".");f.DTTObj.AddParameter("","","panel factor",r);for(var o=0;o<m.Pages.length;o++){var u=new HashTableSrv();var g=f.VoiceObj.FindIndeObjByGuid(m.Pages[o].iGuid);VoiceHandler.MatchWordList(g.Words,x,u);var h=l.keys();for(var n=0;n<h.length;n++){u[h[n]]=l[h[n]]}var a=0;var h=u.keys();for(var n=0;n<h.length;n++){var y=h[n];a+=u[y]}a/=VoiceHandler.NotLanguageTokens(x);a*=r*u.count()/VoiceHandler.NotLanguageTokens(x);f.DTTObj.AddParameter("","",m.Pages[o].Header,a);if(a>v){v=a;c=m.Pages[o]}}}if(c!=null){s=(s+v)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1017,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+': the page "'+c.Header+'" is the target page.');f.DTTObj.AddParameter("","","score",s);e.Param=c;return s}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1018,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": no target panel found.");f.DTTObj.AddParameter("","","score",s)}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1019,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",s);return 0};VoiceRecognizerNavigator.prototype.EvaluateGotoRowCommand=function(f,t){var u=-1;var d=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOROW);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1020,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": evaluate command.");var x=new ArrayList();var s=d.Match(f,t,x);f.DTTObj.AddParameter("","","command score",s);if(s>0){if(VoiceHandler.NotLanguageTokens(x)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1021,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": no unknown words found.");f.DTTObj.AddParameter("","","score",0);return 0}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1022,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": "+x.Count()+" unknown words found.");for(var q=0;q<x.Count();q++){f.DTTObj.AddParameter("","","Unknown word",x.Get(q).Word)}for(var q=0;q<x.Count();q++){var k=x.Get(q);if(!k.LanguageToken&&k.Word.match("\\d+")){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1023,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": row number found: "+x.Get(q).Word);u=parseInt(k.Word);break}}if(u>0){var c=f.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1024,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": "+c.Count()+" panels found on screen.");var q=0;while(q<c.Count()){var h=c.Get(q);var l=false;if(h.Layout()==Glb.PANEL_FORM){l=true}else{if(h.Status()!=Glb.PS_DATA){l=true}else{if(h.GetNumRows()<u){l=true}}}if(l){f.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption()+" (removed)");c.remove(h)}else{f.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption());q++}}var v=0;var b=null;for(q=0;q<c.Count();q++){var h=c.Get(q);var a=f.VoiceObj.FindIndeObjByGuid(h.iGuid);var e=new HashTableSrv();VoiceHandler.MatchWordList(a.Words,x,e);var r=0;if(e.count()==0){if(c.Count()==1){r=1}else{if(h.HasFocus()){r=0.3}}}else{r=1}if(r==0){continue}e.NumRow=1;var m=0;var g=e.keys();for(var o=0;o<g.length;o++){var y=g[o];m+=e[y]}m/=VoiceHandler.NotLanguageTokens(x);m*=r*e.count()/VoiceHandler.NotLanguageTokens(x);if(m>v){v=m;b=h}}if(b!=null){s=(s+v)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1025,"VoiceRecognizerNavigator.EvaluateGotoRow","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target panel.');f.DTTObj.AddParameter("","","score",s);var n=new ArrayList();n.Add(b);n.Add(u);d.Param=n;return s}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1026,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": no target panel found");f.DTTObj.AddParameter("","","score",0);return 0}}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1027,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",s);return 0};VoiceRecognizerNavigator.prototype.EvaluateGotoFieldCommand=function(f,q){var d=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOFIELD);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1028,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+": evaluate command.");var g=null;var v=new ArrayList();var n=d.Match(f,q,v);if(VoiceHandler.NotLanguageTokens(v)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1029,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+": no unknown words found. This is not the right command.");f.DTTObj.AddParameter("","","command score",0);return 0}var c=f.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1030,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+": "+c.Count()+" panels found on screen.");var l=0;while(l<c.Count()){var j=c.Get(l);if(j.HasFocus()){g=j}var k=false;if(j.Status()!=Glb.PS_DATA){k=true}else{if(j.GetNumRows()<=0){k=true}}if(k){f.DTTObj.AddParameter("","","panel",j.GetDTTCaption()+" (removed)");c.remove(j)}else{f.DTTObj.AddParameter("","","panel",j.GetDTTCaption());l++}}var t=-1;var b=null;var u=0;for(l=0;l<c.Count();l++){var j=c.Get(l);var a=f.VoiceObj.FindIndeObjByGuid(j.iGuid);var h=new HashTableSrv();var m=0;if(a!=null){VoiceHandler.MatchWordList(a.Words,v,h);if(h.count()==0){if(c.Count()==1){m=1}else{if(j.HasFocus()){if(j.HasFocus()){m=0.3}}}}else{m=1}}if(m==0){continue}var o=new HashTableSrv();var x=VoiceHandler.FindField(j,v,o);var e=x.Get(0);if(e==-1){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1031,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+": no row found.");f.DTTObj.AddParameter("","","panel",j.GetDTTCaption());f.DTTObj.AddParameter("","","score",0);continue}var s=x.Get(1);s*=m*o.count()/VoiceHandler.NotLanguageTokens(v);if(s>u){t=e;b=j;u=s}}if(t!=-1){n=(n+u)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1032,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target page.');f.DTTObj.AddParameter("","","score",n);var r=new ArrayList();r.Add(b);r.Add(t);d.Param=r;if(g!=null){g.SetInput()}return n}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1033,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",0);if(g!=null){g.SetInput()}return 0};VoiceRecognizerNavigator.prototype.EvaluateGoBookCommand=function(n,k,e){n.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1034,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": evaluate command.");var b=new ArrayList();var c=e.Match(n,k,b);n.DTTObj.AddParameter("","","command score",c);if(c>0){var h=n.VoiceObj.FindOnScreen(VoiceHandler.OT_BOOK);n.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1035,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": "+h.Count()+" books found on screen.");var s=null;var t=0;for(var g=0;g<h.Count();g++){var d=h.Get(g);if(VoiceHandler.NotLanguageTokens(b)==0){n.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1036,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": no unknown words found.");if(h.Count()==1){c=(c+1)/2;n.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1037,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": "+d.BookObj.GetName()+" is the target panel");n.DTTObj.AddParameter("","","score",c);e.Param=d;return c}else{return 0}}else{n.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1038,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": "+b.Count()+" unknown words found");for(var f=0;f<b.Count();f++){n.DTTObj.AddParameter("","","unknown word",(b.Get(f)).Word)}var m=new HashTableSrv();var l=VoiceHandler.TokenizeString(d.BookObj.GetName());VoiceHandler.MatchWordList(l,b,m);var a=0;if(m.count()==0){if(h.Count()==1){a=1}}else{a=1}if(a==0){continue}var q=0;var r=m.keys();for(var f=0;f<r.length;f++){var o=r[f];q+=m[o]}q/=VoiceHandler.NotLanguageTokens(b);q*=a*m.count()/VoiceHandler.NotLanguageTokens(b);if(q>t){t=q;s=d}}}if(s!=null){c=(t+c)/2;n.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1039,"VoiceRecognizerNavigator.EvaluateGo","Command "+e.Name+': the book "'+s.BookObj.GetName()+'" is the target book');n.DTTObj.AddParameter("","","score",c);e.Param=s;return c}n.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1040,"VoiceRecognizerNavigator.EvaluateGo","Command "+e.Name+": no target book found")}n.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1041,"VoiceRecognizerNavigator.EvaluateGo","Command "+e.Name+" is not the right command.");n.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerNavigator.prototype.EvaluateGoToPageBookCommand=function(f,s){var t=-1;var b=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOPAGEBOOK);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1042,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": evaluate command.");var v=new ArrayList();var r=b.Match(f,s,v);f.DTTObj.AddParameter("","","command score",r);if(r>0){if(VoiceHandler.NotLanguageTokens(v)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1043,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": no unknown words found.");f.DTTObj.AddParameter("","","score",0);return 0}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1044,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": "+v.Count()+" unknown words found.");for(var q=0;q<v.Count();q++){f.DTTObj.AddParameter("","","Unknown word",(v.Get(q)).Word)}for(var q=0;q<v.Count();q++){var m=v.Get(q);if(!m.LanguageToken&&m.Word.match("\\d+")){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1045,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": page number found: "+(v.Get(q)).Word);t=parseInt(m.Word);break}}if(t>0){var e=f.VoiceObj.FindOnScreen(VoiceHandler.OT_BOOK);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1046,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": "+e.Count()+" books found on screen.");var u=0;var d=null;for(var q=0;q<e.Count();q++){var g=e.Get(q);var c=new HashTableSrv();var l=VoiceHandler.TokenizeString(g.BookObj.GetName());VoiceHandler.MatchWordList(l,v,c);var a=0;if(c.count()==0){if(e.Count()==1){a=1}}else{a=1}if(a==0){continue}c.PageNum=1;var k=0;var h=c.keys();for(var o=0;o<h.length;o++){var x=h[o];k+=c[x]}k/=VoiceHandler.NotLanguageTokens(v);k*=a*c.count()/VoiceHandler.NotLanguageTokens(v);if(k>u){u=k;d=g}}if(d!=null){r=(r+u)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1047,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+': the book "'+d.BookObj.GetName()+'" is the target book.');f.DTTObj.AddParameter("","","score",r);var n=new ArrayList();n.Add(d);n.Add(t);b.Param=n;return r}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1048,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": no target book found");f.DTTObj.AddParameter("","","score",0);return 0}}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1049,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",r);return 0};VoiceRecognizerNavigator.prototype.ExecuteCommand=function(a){if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOP){this.ExecuteGotopCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOBOTTOM){this.ExecuteGobottomCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOUP){this.ExecuteGoupCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GODOWN){this.ExecuteGodownCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOLIST){this.ExecuteGolistCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GODETAIL){this.ExecuteGodetailCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOPAGE){this.ExecuteGotopageCommand();var d=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(d.Header),new IDVariant(d.Parent.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOROW){this.ExecuteGotoRowCommand();var g=this.bestCmd.Param.Get(0);var f=this.bestCmd.Param.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(f+""),new IDVariant(g.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOFIELD){this.ExecuteGotoFieldCommand();var g=this.bestCmd.Param.Get(0);var f=this.bestCmd.Param.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(f+""),new IDVariant(g.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GONEXT){this.ExecuteGoNextCommand();var e=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(e.BookObj.GetName())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOPREV){this.ExecuteGoPrevCommand();var e=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(e.BookObj.GetName())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOFIRST){this.ExecuteGoFirstCommand();var e=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(e.BookObj.GetName())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOLAST){this.ExecuteGoLastCommand();var e=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(e.BookObj.GetName())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOPAGEBOOK){this.ExecuteGoToPageBookCommand();var e=this.bestCmd.Param;var b=e.Get(0);var c=e.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(c),new IDVariant(b.BookObj.GetName())).stringValue()}return""};VoiceRecognizerNavigator.prototype.ExecuteGotopCommand=function(){var b=this.bestCmd.Param;var a=b.Parent.FocusPriority;b.Parent.FocusPriority=0;b.PanelCommand(Glb.PCM_NAVIGATION,0,true);b.Parent.FocusPriority=a};VoiceRecognizerNavigator.prototype.ExecuteGobottomCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_NAVIGATION,1,true)};VoiceRecognizerNavigator.prototype.ExecuteGoupCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_NAVIGATION,3,true)};VoiceRecognizerNavigator.prototype.ExecuteGodownCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_NAVIGATION,2,true)};VoiceRecognizerNavigator.prototype.ExecuteGolistCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_FORMLIST,0,true)};VoiceRecognizerNavigator.prototype.ExecuteGodetailCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_FORMLIST,0,true)};VoiceRecognizerNavigator.prototype.ExecuteGotopageCommand=function(){var b=this.bestCmd.Param;var a=b.Parent;a.set_Page(b.Index)};VoiceRecognizerNavigator.prototype.ExecuteGotoRowCommand=function(){this.ExecuteGotoFieldCommand()};VoiceRecognizerNavigator.prototype.ExecuteGotoFieldCommand=function(){var c=this.bestCmd.Param;var a=c.Get(0);var b=c.Get(1);a.Parent.FocusPriority=0;a.set_ActualPosition(b);if(a.IsShowingGrouping()){a.set_SelectedRow(0);a.ForceSendPosition=true}a.SetInput()};VoiceRecognizerNavigator.prototype.ExecuteGoNextCommand=function(){var a=this.bestCmd.Param;a.BookCommand(IDREGlb.BCM_NAVIGATION,3)};VoiceRecognizerNavigator.prototype.ExecuteGoPrevCommand=function(){var a=this.bestCmd.Param;a.BookCommand(IDREGlb.BCM_NAVIGATION,2)};VoiceRecognizerNavigator.prototype.ExecuteGoFirstCommand=function(){var a=this.bestCmd.Param;a.BookCommand(IDREGlb.BCM_NAVIGATION,0)};VoiceRecognizerNavigator.prototype.ExecuteGoLastCommand=function(){var a=this.bestCmd.Param;a.BookCommand(IDREGlb.BCM_NAVIGATION,1)};VoiceRecognizerNavigator.prototype.ExecuteGoToPageBookCommand=function(){var c=this.bestCmd.Param;var a=c.Get(0);var b=c.Get(1);a.BookCommand(IDREGlb.BCM_NAVIGATION,4,false,b)};function VoiceWord(a){this.Word=(a==undefined?"":a);this.LanguageToken=false;this.Weight=1;this.Occurrences=0}VoiceWord.prototype.isEqual=function(c){if(c.Word.toLowerCase()==this.Word.toLowerCase()){return 1}var f=c.Word.toLowerCase();var d=this.Word.toLowerCase();var b;var e;if(f.length>d.length){b=d.length;e=f.length}else{b=f.length;e=d.length}var a=0;for(a=0;a<b;a++){if(f.charAt(a)!=(d.charAt(a))){break}}var g=a/e;if(a==0||g<=0.5){return 0}else{return g}};function VoiceWordList(){this.WList=new ArrayList();this.optional=false}WebApiHandler.INSTANCETAG="_ID_INSTANCE";function WebApiHandler(){this.MainFrm;this.IsWebApiRequest=false;this.ChildLevel=-1;this.Format=XMLDoc.FT_JSON;this.instance;this.MethodName="";this.Headers=new IDMap();this.Parameters=new IDMap();this.OutputCollection=new IDCollection();this.Content="";this.MaxRows=0}WebApiHandler.prototype.CheckUri=function(){return""};WebApiHandler.prototype.WriteResponse=function(a,b,c){};function WebEntryPointSrv(){this.AlreadyDestroyed=false;this.Request;this.Response;this.iParent;this.iWelcomeURL="";this.iLogoffURL="";this.AppPath="";this.AppName="";this.RealPath="";this.iTempPath="";this.CmdObj;this.IndObj;this.RolObj;this.RTCObj;this.DTTObj=new DTTEngine();this.TimerObj;this.ErrObj;this.VoiceObj;this.IwImdb;this.IMDB;this.VisualStyleList=new VisAttrListSrv();this.VBFile=new VBFiles();this.RevNum=0;this.IDVer="";this.AppVersion="";this.LastCheckIn=0;this.StartRequestTS;this.InitAppDone=false;this.iActiveForm=null;this.StackForm=new ArrayList();this.iDockedForm=null;this.QwlRoles=new HashTableSrv();this.iCaption=new IDVariant();this.iImage="";this.GlbPanelFlags=0;this.IntSesNumber=0;this.iRefreshInterval=new IDVariant(-1);this.iClickCounter=0;this.iVisualFlags=3839;this.TempFiles=new ArrayList();this.PDFPrints=new ArrayList();this.iRedirectTo=new IDVariant();this.iRedirectFeatures=new IDVariant();this.VoiceCommandExecuted=false;this.iAlertMessage=new IDVariant();this.iRefreshLocation=new IDVariant(0);this.iAccelMotionThreshold=new IDVariant(999);this.iRotMotionThreshold=new IDVariant(999);this.TrayletRefreshCommand="";this.WidgetMode=false;this.iRedirectNewWindow=false;this.LoginMessage="";this.ConfStack=new HashTableSrv();this.iAlertType=0;this.URLData="";this.UrlParams=new HashTableSrv();this.GlbRoleCmdSetEnabled=true;this.GlbRoleCmdLinEnabled=true;this.GlbRoleCommandEnabled=true;this.HelpFile="";this.iActiveHelpFile="";this.MenuType=1;this.IEVer=0;this.BrowserClass=Glb.BRWCLS_IENORMAL;this.BrowserSubClass=Glb.BRWSCL_NONE;this.iHostName="";this.BInfo_Type=-1;this.BInfo_Ver=-1;this.iShiftKey=false;this.iCtrlKey=false;this.iAltKey=false;this.MenuAutoCollapse=0;this.MimeMap=null;this.UseRD=false;this.RDStatus=0;this.RDExitURL="";this.RDToken=new HashTableSrv();this.GZipEnabled=0;this.DisableRender=false;this.PrelImgs=new ArrayList();this.LookupCache=new HashTableSrv();this.iRefreshUI=false;this.SchemaCache=new HashTableSrv();this.ActivedDocument=null;this.ActivedProperty=null;this.ActivedExtProperty=null;this.DocHelper=null;this.DOModifiedList=new ArrayList();this.SyncObject=new SyncService(this);this.ShellObject=new Shell(this);this.WebApiObject=new WebApiHandler(this);this.iScreenW;this.iScreenH;this.MenuW;this.WebServicesUrl=new HashTableSrv();this.ServiceConnectors=new HashTableSrv();this.RefreshLookups=new ArrayList();this.iParamsObj;this.ProgrBar=new ProgressBar(this);this.INDE_X=null;this.BaseTimerIdx=0;this.BaseCmdSetIdx=0;this.BaseCmdLinIdx=0;this.CompOwner=null;this.CompList=new ArrayList();this.CompAlreadyNotified=null;this.SharedInstance=true;this.CompNameSpace=null;this.InitComps=null;this.CompDispatchMethodsCache=new HashTableSrv();this.SessionName="";this.SessionQueryString="";this.CustomCommands=new Array(WebFrameSrv.MAX_CUSTOMCOMMANDS);this.DesktopRendered=false;this.RD3CreateFullTree=false;this.RD3CompressFiles=false;this.RD3PanRevalidate=false;this.RD3UseManifest=false;this.RD3Events=new ArrayList();this.LastRD3Reply=null;this.RD3LastRequest=0;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.WEP_MAXPROP);this.iSideMenuWidth=160;this.iIsMobile=-1;this.iAccentColor=12747008;this.iIsBootsrap=-1;this.iIsIonic=-1;this.iSecondaryColor=6609714;this.iDangerColor=4013557;this.iLightColor=16053492;this.iDarkColor=2236962;this.iBrightColor=2474495;this.iVibrantColor=10040166;this.CloseAllEvent=RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_IMMEDIATE;this.CloseAppEvent=RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_IMMEDIATE;this.iHasConfirm=false;this.confirmNodes=new ArrayList();this.RD3EntryPoint="";this.RD3CliExecute=new ArrayList();this.DeleteAfterDownload=false;this.FileToSend="";this.SaveAttachment=false;this.iMDITop=0;this.iMDILeft=0;this.iScreenHeight=0;this.iScreenWidth=0;this.screenZones=new ArrayList();this.StartAnimationDef=null;this.ExpandCmdSetAnimationDef=null;this.PopupMenuAnimationDef=null;this.ShowFormAnimationDef=null;this.OpenModalAnimationDef=null;this.MessageAnimationDef=null;this.LastMessageAnimationDef=null;this.CollapseFrameAnimationDef=null;this.ExpandTreeAnimationDef=null;this.ChangeLayoutAnimationDef=null;this.QBETipAnimationDef=null;this.ChangeTabPageAnimationDef=null;this.ShowGraphAnimationDef=null;this.ChangeBookPageAnimationDef=null;this.RedirectAnimationDef=null;this.PreviewAnimationDef=null;this.DockedAnimationDef=null;this.PopupResizeAnimationDef=null;this.TooltipAnimationDef=null;this.TaskbarAnimationDef=null;this.ComboAnimationDef=null;this.ShouldEatNextMessage=false;this.EatNextMessage=false;this.ComboNameSep="; ";this.ListenKeys=0;this.SessionSettings=new HashTableSrv();this.DebugWindow="";this.DebugItemList="";this.DebugCmdForm="";this.DebugDetail="";this.DebugReqTop="";this.DebugReqRef="";this.DebugReqPrc="";this.SendDebug=false;WebFrameSrv.InitTBZones()}WebEntryPointSrv.prototype.GetTempFiles=function(){return this.TempFiles};WebEntryPointSrv.prototype.GetWebServicesUrl=function(){return this.WebServicesUrl};WebEntryPointSrv.prototype.GetServiceConnectors=function(){return this.ServiceConnectors};WebEntryPointSrv.prototype.GetCompList=function(){return this.CompList};WebEntryPointSrv.prototype.GetCompAlreadyNotified=function(){return this.CompAlreadyNotified};WebEntryPointSrv.prototype.SetCompAlreadyNotified=function(a){this.CompAlreadyNotified=a};WebEntryPointSrv.SSManager;WebEntryPointSrv.cmpInited=0;WebEntryPointSrv.prototype.Parent=function(){return(this.CompOwner!=null?this.CompOwner.Parent():this.iParent)};WebEntryPointSrv.prototype.set_Parent=function(a){if(this.CompOwner!=null){this.CompOwner.set_Parent(a)}else{this.iParent=a}};WebEntryPointSrv.prototype.HostName=function(){return(this.CompOwner!=null?this.CompOwner.HostName():this.iHostName)};WebEntryPointSrv.prototype.GetVisualStyleList=function(){return(this.CompOwner!=null?this.CompOwner.GetVisualStyleList():this.VisualStyleList)};WebEntryPointSrv.prototype.ActiveForm=function(){return(this.CompOwner!=null?this.CompOwner.ActiveForm():this.iActiveForm)};WebEntryPointSrv.prototype.set_ActiveForm=function(a){if(this.CompOwner!=null){this.CompOwner.set_ActiveForm(a)}else{this.iActiveForm=a}};WebEntryPointSrv.prototype.ActiveFormIdx=function(){return(this.ActiveForm()!=null?this.ActiveForm().FormIdx:0)};WebEntryPointSrv.prototype.DockedForm=function(){return(this.CompOwner!=null?this.CompOwner.DockedForm():this.ParamsObj().UseRD3?null:this.iDockedForm)};WebEntryPointSrv.prototype.set_DockedForm=function(a){if(this.CompOwner!=null){this.CompOwner.set_DockedForm(a)}else{this.iDockedForm=a}};WebEntryPointSrv.prototype.RedirectTo=function(){return(this.CompOwner!=null?this.CompOwner.RedirectTo():this.iRedirectTo)};WebEntryPointSrv.prototype.set_RedirectTo=function(b){if(this.CompOwner!=null){this.CompOwner.set_RedirectTo(b)}else{this.iRedirectTo=b;if(this.RealPath.length>0){var a=this.iRedirectTo.stringValue();if(a.startsWith(this.RealPath)||(this.TempPath()&&a.startsWith(this.TempPath()))){a=Glb.ToRelativeUrl(this,this.iRedirectTo.stringValue());this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",225,"MainFrm.set_RedirectTo","The redirect url must be a relative path: changed to '"+a+"'");this.iRedirectTo=new IDVariant(a)}}}};WebEntryPointSrv.prototype.RedirectFeatures=function(){return(this.CompOwner!=null?this.CompOwner.RedirectFeatures():this.iRedirectFeatures)};WebEntryPointSrv.prototype.set_RedirectFeatures=function(a){if(this.CompOwner!=null){this.CompOwner.set_RedirectFeatures(a)}else{this.iRedirectFeatures=a}if(this.CompOwner!=null){this.CompOwner.set_RedirectFeatures(a)}else{this.SaveAttachment=false;if(a.CompareToIgnoreCase(new IDVariant("save"))==0){a=new IDVariant("");this.SaveAttachment=true}this.iRedirectFeatures=a}};WebEntryPointSrv.prototype.AlertMessage=function(){return(this.CompOwner!=null?this.CompOwner.AlertMessage():this.iAlertMessage)};WebEntryPointSrv.prototype.set_AlertMessage=function(a){if(this.CompOwner!=null){this.CompOwner.set_AlertMessage(a)}else{this.iAlertMessage=a}this.VoiceCommandExecuted=this.VoiceObj.VoiceCommandExecuted};WebEntryPointSrv.prototype.RefreshLocation=function(){return(this.CompOwner!=null?this.CompOwner.RefreshLocation():this.iRefreshLocation)};WebEntryPointSrv.prototype.set_RefreshLocation=function(a){if(this.CompOwner!=null){this.CompOwner.set_RefreshLocation(a)}else{this.iRefreshLocation=a;this.RD3Change(RD3Glb.WEP_REFRESHLOC)}};WebEntryPointSrv.prototype.VisualFlag=function(a){return(this.CompOwner!=null?this.CompOwner.VisualFlag(a):this.iVisualFlags&a)};WebEntryPointSrv.prototype.set_VisualFlag=function(b,a){if(this.CompOwner!=null){this.CompOwner.set_VisualFlag(b,a)}else{this.iVisualFlags=(this.iVisualFlags&(~a))|b;this.RD3Change(RD3Glb.WEP_VISPROP)}};WebEntryPointSrv.prototype.SetMotionThreshold=function(b,a){if(this.CompOwner!=null){this.CompOwner.SetMotionThreshold(b,a)}else{if(!this.iAccelMotionThreshold.equals(b)||!this.iRotMotionThreshold.equals(a)){this.iAccelMotionThreshold=b;this.iRotMotionThreshold=a;this.RD3Change(RD3Glb.WEP_DEVICEMOTION)}}};WebEntryPointSrv.prototype.RedirectNewWindow=function(){return(this.CompOwner!=null?this.CompOwner.RedirectNewWindow():this.iRedirectNewWindow)};WebEntryPointSrv.prototype.set_RedirectNewWindow=function(a){if(this.CompOwner!=null){this.CompOwner.set_RedirectNewWindow(a)}else{this.iRedirectNewWindow=a}};WebEntryPointSrv.prototype.LoginMsg=function(){return(this.CompOwner!=null?this.CompOwner.LoginMsg():this.LoginMessage)};WebEntryPointSrv.prototype.set_LoginMsg=function(a){if(this.CompOwner!=null){this.CompOwner.set_LoginMsg(a)}else{this.LoginMessage=a}};WebEntryPointSrv.prototype.AlertType=function(){return(this.CompOwner!=null?this.CompOwner.AlertType():this.iAlertType)};WebEntryPointSrv.prototype.set_AlertType=function(a){if(this.CompOwner!=null){this.CompOwner.set_AlertType(a)}else{this.iAlertType=a}};WebEntryPointSrv.prototype.ActiveHelpFile=function(){return(this.CompOwner!=null?this.CompOwner.ActiveHelpFile():this.iActiveHelpFile)};WebEntryPointSrv.prototype.ShiftKey=function(){return(this.CompOwner!=null?this.CompOwner.ShiftKey():this.iShiftKey)};WebEntryPointSrv.prototype.set_ShiftKey=function(a){if(this.CompOwner!=null){this.CompOwner.set_ShiftKey(a)}else{this.iShiftKey=a}};WebEntryPointSrv.prototype.CtrlKey=function(){return(this.CompOwner!=null?this.CompOwner.CtrlKey():this.iCtrlKey)};WebEntryPointSrv.prototype.set_CtrlKey=function(a){if(this.CompOwner!=null){this.CompOwner.set_CtrlKey(a)}else{this.iCtrlKey=a}};WebEntryPointSrv.prototype.AltKey=function(){return(this.CompOwner!=null?this.CompOwner.AltKey():this.iAltKey)};WebEntryPointSrv.prototype.set_AltKey=function(a){if(this.CompOwner!=null){this.CompOwner.set_AltKey(a)}else{this.iAltKey=a}};WebEntryPointSrv.prototype.ScreenW=function(){return(this.CompOwner!=null?this.CompOwner.ScreenW():this.iScreenW)};WebEntryPointSrv.prototype.set_ScreenW=function(a){if(this.CompOwner!=null){this.CompOwner.set_ScreenW(a)}else{this.iScreenW=a}};WebEntryPointSrv.prototype.ScreenH=function(){return(this.CompOwner!=null?this.CompOwner.ScreenH():this.iScreenH)};WebEntryPointSrv.prototype.set_ScreenH=function(a){if(this.CompOwner!=null){this.CompOwner.set_ScreenH(a)}else{this.iScreenH=a}};WebEntryPointSrv.prototype.hasConfirm=function(){return(this.CompOwner!=null?this.CompOwner.hasConfirm():this.iHasConfirm)};WebEntryPointSrv.prototype.set_hasConfirm=function(a){if(this.CompOwner!=null){this.CompOwner.set_hasConfirm(a)}else{this.iHasConfirm=a}};WebEntryPointSrv.prototype.MDITop=function(){return(this.CompOwner!=null?this.CompOwner.MDITop():this.iMDITop)};WebEntryPointSrv.prototype.set_MDITop=function(a){if(this.CompOwner!=null){this.CompOwner.set_MDITop(a)}else{this.iMDITop=a}};WebEntryPointSrv.prototype.MDILeft=function(){return(this.CompOwner!=null?this.CompOwner.MDILeft():this.iMDILeft)};WebEntryPointSrv.prototype.set_MDILeft=function(a){if(this.CompOwner!=null){this.CompOwner.set_MDILeft(a)}else{this.iMDILeft=a}};WebEntryPointSrv.prototype.ScreenHeight=function(){return(this.CompOwner!=null?this.CompOwner.ScreenHeight():this.iScreenHeight)};WebEntryPointSrv.prototype.set_ScreenHeight=function(a){if(this.CompOwner!=null){this.CompOwner.set_ScreenHeight(a)}else{this.iScreenHeight=a}};WebEntryPointSrv.prototype.ScreenWidth=function(){return(this.CompOwner!=null?this.CompOwner.ScreenWidth():this.iScreenWidth)};WebEntryPointSrv.prototype.set_ScreenWidth=function(a){if(this.CompOwner!=null){this.CompOwner.set_ScreenWidth(a)}else{this.iScreenWidth=a}};WebEntryPointSrv.prototype.ClickCounter=function(){return(this.CompOwner!=null?this.CompOwner.ClickCounter():this.iClickCounter)};WebEntryPointSrv.prototype.set_ClickCounter=function(a){if(this.CompOwner!=null){this.CompOwner.set_ClickCounter(a)}else{this.iClickCounter=a}};WebEntryPointSrv.prototype.ShiftFrmConst=function(){return false};WebEntryPointSrv.prototype.IMDBOffset=function(){return 0};WebEntryPointSrv.prototype.CreateDocument=function(c,b,a){return false};WebEntryPointSrv.prototype.GetFromDNA=function(d,b,a,e,c){return null};WebEntryPointSrv.prototype.AttachCompTo=function(a){var b=a.GetCompList();b.Add(this);if(this.SharedInstance&&this.CompOwner!=null){return}if(this.SharedInstance){a=a.GetApplication()}this.CompOwner=a;this.CreateComponents()};WebEntryPointSrv.prototype.GetCompFromNameSpace=function(d,a){if(this.CompNameSpace&&this.CompNameSpace.equals(d)){return this}if(a==null){a=new ArrayList()}var f=null;for(var c=0;c<this.CompList.Count();c++){var e=this.CompList[c];if(e.SharedInstance&&a.IndexOf(e.CompNameSpace)!=-1){continue}a.Add(e.CompNameSpace);var b=e.GetCompFromNameSpace(d,a);if(b!=null){f=b;break}}return f};WebEntryPointSrv.prototype.CreateComponents=function(){};WebEntryPointSrv.prototype.InitComponents=function(){if(this.CompOwner==null&&this.CompList.Count()==0){this.CreateComponents()}if(this.CompOwner==null&&this.InitComps==null){this.InitComps=new ArrayList()}for(var a=0;a<this.CompList.Count();a++){this.CompList[a].SetOwner(this)}if(this.CompOwner==null&&WebEntryPointSrv.cmpInited==1){WebEntryPointSrv.cmpInited=2}};WebEntryPointSrv.prototype.SetOwner=function(a){if(this.CompOwner==null){this.CompOwner=a}this.DTTObj=this.CompOwner.DTTObj;this.ErrObj=this.CompOwner.ErrObj;this.RTCObj=this.CompOwner.RTCObj;this.StackForm=this.CompOwner.StackForm;this.ConfStack=this.CompOwner.ConfStack;this.confirmNodes=this.CompOwner.confirmNodes;this.UrlParams=this.CompOwner.UrlParams;this.RDToken=this.CompOwner.RDToken;this.PrelImgs=this.CompOwner.PrelImgs;this.TempFiles=this.CompOwner.GetTempFiles();this.PDFPrints=this.CompOwner.PDFPrints;this.RD3Events=this.CompOwner.RD3Events;this.ParamsObj().UseRD3=this.CompOwner.ParamsObj().UseRD3;this.ParamsObj().DefaultDateMask=this.CompOwner.ParamsObj().DefaultDateMask;this.ParamsObj().DefaultTimeMask=this.CompOwner.ParamsObj().DefaultTimeMask;this.ParamsObj().UseDecimalDot=this.CompOwner.ParamsObj().UseDecimalDot;this.ParamsObj().AutoDynRows=this.CompOwner.ParamsObj().AutoDynRows;this.ParamsObj().UseFluid=this.CompOwner.ParamsObj().UseFluid;this.UseRD=this.CompOwner.UseRD;this.RD3CliExecute=this.CompOwner.RD3CliExecute;this.ProgrBar=this.CompOwner.ProgrBar;this.SessionName=this.CompOwner.SessionName;this.SessionQueryString=this.CompOwner.SessionQueryString;this.LookupCache=this.CompOwner.LookupCache;this.DOModifiedList=this.CompOwner.DOModifiedList;if(this.CompOwner.GetWebServicesUrl()!=this.WebServicesUrl){for(var b in this.WebServicesUrl){this.CompOwner.GetWebServicesUrl()[b]=this.WebServicesUrl[b]}this.WebServicesUrl=this.CompOwner.GetWebServicesUrl()}this.SchemaCache=this.CompOwner.SchemaCache;this.SessionSettings=this.CompOwner.SessionSettings;this.ShellObject=this.CompOwner.ShellObject;this.VoiceObj=this.CompOwner.VoiceObj;this.WebApiObject=this.CompOwner.WebApiObject;this.CustomCommands=this.CompOwner.CustomCommands;if(this.CompOwner.ParamsObj().DemoMode!=0){this.ParamsObj().DemoMode=this.CompOwner.ParamsObj().DemoMode}this.InitComps=this.CompOwner.InitComps;var d=(this.InitComps.IndexOf(this.CompNameSpace+".MyWebEntryPoint")!=-1);var c=false;if(!d){c=this.ShiftFrmConst()}if(!d){this.CmdObj.AppendTo(this.CompOwner.CmdObj)}this.CmdObj=this.CompOwner.CmdObj;if(!d){this.TimerObj.AppendTo(this.CompOwner.TimerObj)}this.TimerObj=this.CompOwner.TimerObj;if(!d){this.IndObj.AppendTo(this.CompOwner.IndObj)}this.IndObj=this.CompOwner.IndObj;if(!d){this.IwImdb.AppendTo(this.CompOwner.IwImdb)}else{this.IwImdb.IMDB=this.CompOwner.IwImdb.IMDB}this.IMDB=this.IwImdb.IMDB;this.VisualStyleList.SynchTo(this.CompOwner.GetVisualStyleList());if(!d){this.SyncObject.AppendTo(this.CompOwner.SyncObject)}this.SyncObject=this.CompOwner.SyncObject;this.VBFile=this.CompOwner.VBFile;if(c){Glb.FilledTo+=this.ParamsObj().MAX_FORMS}if(!d){this.InitComps.Add(this.CompNameSpace+".MyWebEntryPoint")}if(!d){this.InitComponents()}};WebEntryPointSrv.prototype.BeginCompRequest=function(a){if(a==null){a=new ArrayList()}for(var b=0;b<this.CompList.Count();b++){var c=this.CompList[b];if(c.SharedInstance&&a.IndexOf(c.CompNameSpace)!=-1){continue}a.Add(c.CompNameSpace);if(this.RealPath.length>0&&c.RealPath.length==0){c.AppPath=this.AppPath;c.AppName=this.AppName;c.RealPath=this.RealPath}c.Request=this.Request;c.Response=this.Response;c.Out=this.Out;c.OutStr=this.OutStr;c.RevNum=this.RevNum;c.IDVer=this.IDVer;c.AppVersion=this.AppVersion;if(this.RolObj!=null&&c.RolObj==null){c.CreateCompRoles()}c.BeginCompRequest(a)}};WebEntryPointSrv.prototype.EndCompRequest=function(a){if(a==null){a=new ArrayList()}for(var b=0;b<this.CompList.Count();b++){var c=this.CompList[b];if(c.SharedInstance&&a.IndexOf(c.CompNameSpace)!=-1){continue}a.Add(c.CompNameSpace);c.Request=null;c.Response=null;c.EndCompRequest(a)}};WebEntryPointSrv.prototype.CreateCompRoles=function(){var c=true;if(this.RolObj.iRoles!=null){for(var a=0;a<this.RolObj.iRoles.length&&c;a++){var b=this.RolObj.iRoles[a];if(b!=null&&b.Items.length>0){c=false}}}if((c||this.RTCObj.Enabled)&&this.CompOwner!=null){this.RolObj=this.CompOwner.RolObj;this.QwlRoles=this.CompOwner.QwlRoles}};WebEntryPointSrv.prototype.GetLoader=function(g){if(g==""){return(this.CompNameSpace==null?"self":this.CompNameSpace)}else{g=Glb.ToRelativeUrl(this,g);var f=new XMLHttpRequest();f.open("GET",g,false);f.setRequestHeader("Content-Type","text/plain");f.send();var h=f.responseText;var e=h.split("\n");var b=e.findIndex(function(j){return(j.length===1)});h=e[b-1];h=h.substring(5);var a=h.substring(0,h.indexOf(" "));for(var c=0;c<this.CompList.length;c++){var d=this.CompList[c];if(d.CompNameSpace==a){return a}}importScripts(g);return a}};WebEntryPointSrv.prototype.CreateObjFromLibrary=function(LibName,ClsName){var cloader=this.GetLoader(LibName);var pMain=null;if(LibName!=""){for(var i=0;i<this.CompList.length;i++){var cmp=this.CompList[i];if(cmp.CompNameSpace==cloader){pMain=cmp;break}}var ns=cloader;if(pMain==null){pMain=this.GetApplication().GetCompFromNameSpace(ns);if(pMain!=null&&!pMain.SharedInstance){pMain=null}}if(pMain==null){pMain=eval("new "+cloader+".MyWebEntryPoint()");if(pMain.ParamsObj().DemoMode==1){DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",200,"MainFrm.CreateObjFromLibrary","You can't create objects from a DEMO library");return null}pMain.CompNameSpace=ns;pMain.AttachCompTo(this);pMain.FlagAllUIAsNew();pMain.SetOwner(this);pMain.TimerObj.ActivateTimers(0,true);this.BeginCompRequest();pMain.InitApp()}}else{pMain=this}var fullName=(pMain.CompNameSpace!=null?pMain.CompNameSpace+".":"")+ClsName;var obj=eval("new "+fullName+"()");var basecls=eval(fullName+".getConstructorName()");if(basecls=="WebFormSrv"){obj.InitMainFrm(pMain)}else{if(basecls=="IDDocument"){obj.SetMainFrm(pMain,pMain.IMDB);obj.AssemblyName=LibName}}return obj};WebEntryPointSrv.prototype.GetLibraryObjList=function(LibName,flDocs){var cloader=this.GetLoader(LibName);var arr=new IDArray();var searchType=(flDocs?"IDDocument":"WebFormSrv");var Types=Object.keys(eval(cloader));for(var i=0;i<Types.length;i++){var t=Types[i];var obj=eval(cloader+"."+t);if(!obj||!obj.prototype){continue}if(t=="MyWebForm"||t=="WebFormSrv"||t=="IDDocument"){continue}if(obj.getConstructorName()==searchType){arr.add_Value(new IDVariant(t))}}return arr};WebEntryPointSrv.prototype.FlagAllUIAsNew=function(){for(var a=0;a<this.CmdObj.CmdSets.length;a++){if(this.CmdObj.CmdSets[a]!=null){this.CmdObj.CmdSets[a].RD3NewObj=true}}for(var a=0;a<this.CmdObj.CmdLin.length;a++){if(this.CmdObj.CmdLin[a]!=null){this.CmdObj.CmdLin[a].RD3NewObj=true}}for(var a=0;a<this.TimerObj.Timers.length;a++){if(this.TimerObj.Timers[a]!=null){this.TimerObj.Timers[a].RD3NewObj=true}}for(var a=0;a<this.IndObj.Indicators.length;a++){if(this.IndObj.Indicators[a]!=null){this.IndObj.Indicators[a].RD3NewObj=true}}};WebEntryPointSrv.prototype.CreateLogFile=function(a){};function WebEntryPointSrvDestructor(){}WebEntryPointSrv.prototype._WebEntryPoint=function(){this.TimerObj.ActivateTimers(0,false);this.DTTObj.SetRequestName("End Request","End Request",DTTRequest.PRI_CMD);this.DTTObj.AddTestItem("",DTTEngine.TST_TERM,"Main terminate","");var e=new ArrayList(this.StackForm);for(var b=0;b<e.Count();b++){var d=e[b];this.UnloadForm(d.FormIdx,false);d.ReleaseLock()}if(this.DockedForm()!=null){this.DockedForm().ReleaseLock();this.UnloadForm(this.DockedForm().FormIdx,false)}this.DTTObj.EndRequest();this.DTTObj.EndSession(this);this.INDE_X=null;if(this.IsServerSession()){var a=WebEntryPointSrv.SSManager.GetSessionByName(this.SessionName);if(a!=null){WebEntryPointSrv.SSManager.RemoveSession(this.SessionName)}}};WebEntryPointSrv.prototype.HandleRequest=function(c,f){this.StartRequestTS=new Date();if(this.IEVer==0){try{var b=new IDVariant(this.RealPath+"/temp");VBFiles.RmDir(b);VBFiles.MkDir(b)}catch(d){}if(this.ShellObject.IsInsideShell()){this.SaveAppSetting(new IDVariant("APPNAME"),new IDVariant(this.AppName))}this.RD3CompressFiles=(this.DTTObj.Level==0||this.DTTObj.TraceEnabled);if(this.IsMobile()||this.IsBootstrap(false)){this.iSideMenuWidth=0}if(String.compare(this.ParamsObj().Theme.substring(0,4),"vela",true)==0){iSideMenuWidth=260}if(c!=null){this.Request=c;this.BrowserInfo();var a=this.Request.Headers["User-Agent"];if(a!=null&&a.indexOf("Shell/")==-1){this.RD3UseManifest=(a.indexOf("iPhone")!=-1||a.indexOf("iPad")!=-1||a.indexOf("Android")!=-1)}}else{if(this.IsServerSession()){this.UseRD=false;this.ParamsObj().UseRD3=false}}this.InitComponents()}};WebEntryPointSrv.prototype.ExtractUrlParams=function(){try{this.UrlParams.clear();if(this.Request.QueryString.CMD!=null){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",1,"MainFrm.ExtractUrlParams","Query string command detected");var d=new ArrayList();d.AddRange(this.Request.QueryString.keys());for(var b=0;b<d.Count();b++){var a=d[b];if(!a.startsWith("WC")){var f=this.Request.QueryString[a];this.UrlParams[a]=f;this.DTTObj.AddParameter("","",a,new IDVariant(f))}}}}catch(c){if(this.Request==null){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",2,"MainFrm.ExtractUrlParams","Request = NULL!")}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",2,"MainFrm.ExtractUrlParams","Exception while parsing the URL string",c)}}};WebEntryPointSrv.prototype.ExtractUrlParams2=function(b){if(b==null||b.length==0){return}try{this.UrlParams.clear();if(b.indexOf("CMD=")!=-1){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",1,"MainFrm.ExtractUrlParams2","Query string command detected");while(!b.equals("")){var h;var f=b.indexOf("&");if(f!=-1){h=b.substr(0,f).trim();b=b.substr(f+1)}else{h=b.trim();b=""}f=h.indexOf("=");if(f!=-1){if(!h.startsWith("WC")){var a=h.substr(0,f);var g=Glb.URLDecode(h.substr(f+1));this.UrlParams[a]=g;this.DTTObj.AddParameter("","",a,new IDVariant(g))}}}}}catch(d){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",2,"MainFrm.ExtractUrlParams2","Exception while parsing the URL string",d)}};WebEntryPointSrv.prototype.GetUrlParam=function(b){if(b==undefined){b=new IDVariant("CMD")}var a=this.UrlParams[b.stringValue()];if(a==null){a=""}return new IDVariant(a)};WebEntryPointSrv.prototype.GetRequestParams=function(){var a=new IDMap();var c=Object.keys(this.Request.QueryString);for(var b=0;b<c.length;b++){a.set_Value(new IDVariant(c[b]),new IDVariant(this.Request.QueryString[c[b]]))}return a};WebEntryPointSrv.prototype.InitPanelGlbFlags=function(){};WebEntryPointSrv.prototype.IWDTT_UserEvent=function(g,f){var e=this.RDStatus;this.RDStatus=Glb.RD_DISABLED;this.DTTObj.CancelRequest();if(this.Request.SESSNAME!=null){var d=f.GetAttribute("par1");var b=f.GetAttribute("par2");var k=new IDArray();k.add_Value(new IDVariant(g?g:""));k.add_Value(new IDVariant(d?d:""));k.add_Value(new IDVariant(b?b:""));var j=this.SendSessionMessage(this.Request.SESSNAME,Glb.ITEM_DTT,0,k);var h=new XMLDoc();h.LoadFromString(j.stringValue());if(h.HasNextNode()){h.GetNextNode();var a=h.GetNextNode();this.WriteStrDbgMain(a.GetAttribute("WIN"));this.WriteStrDbgItemList(a.GetAttribute("IL"));this.WriteStrDbgCmdForm(a.GetAttribute("CMD"));this.WriteStrDbgDetail(a.GetAttribute("DET"));this.WriteStrDbgReqTop(a.GetAttribute("TOP"));this.WriteStrDbgReqRef(a.GetAttribute("REF"));this.WriteStrDbgReqPrc(a.GetAttribute("PRC"))}}else{if(this.DTTObj.DTT2File){var c;if(this.ShellObject.IsInsideShell()){c=Glb.ToRelativeUrl(this,this.DTTObj.DTTFileName)}else{c="filesystem:"+self.location.protocol+"//"+self.location.hostname;if(self.location.port.length>0){c+=":"+self.location.port}c+="/temporary/"+this.DTTObj.DTTFileName.substring(this.DTTObj.DTTFileName.lastIndexOf("/")+1)}this.set_RedirectTo(new IDVariant(c));this.set_RedirectNewWindow(true)}else{this.DTTObj.Render(this,g,f)}}this.RDStatus=e};WebEntryPointSrv.prototype.IWHelp_UserEvent=function(a){var c=this.RDStatus;this.RDStatus=Glb.RD_DISABLED;this.DTTObj.CancelRequest();try{this.DTTObj.RenderHelp(this,a)}catch(b){this.DTTObj.AddException("","MainFrm.IWHelp_UserEvent","Exception while rendering HELP",b)}this.RDStatus=c};WebEntryPointSrv.prototype.IWLogin_UserEvent=function(a){};WebEntryPointSrv.prototype.IWBlob_UserEvent=function(a){if(this.RolObj.CheckRole()){var g=this.ActiveForm();var d=this.Request.WCU;if(d!=null&&d.indexOf("dock")>-1){g=this.DockedForm()}if(a.indexOf("form_")!=-1){try{var c=parseInt(a.substring(5,a.indexOf(":")));a=a.substring(a.indexOf(":")+1);var b=this.GetFormByIndex(c,this.GetLiveForms());if(b!=null){g=b}}catch(h){}}if(g!=null){this.DTTObj.SetRequestName("Download","Download BLOB",DTTRequest.PRI_ITEM);if(g.DownloadBlob(a)){}else{}}}};WebEntryPointSrv.prototype.SessionAbandon=function(){};WebEntryPointSrv.prototype.IWLogoff_UserEvent=function(a){};WebEntryPointSrv.prototype.IWTest_UserEvent=function(a){};WebEntryPointSrv.prototype.TreeDropHelper=function(c,m,g,a,j){var l=null;var b=null;var h="";var e="";if(c!=null){h=c.HashKey;b=c.TreeObj}if(m!=null){e=m.HashKey;l=m.TreeObj}if(l!=null){this.DTTObj.SetRequestName("Tree Drop","Node Tree dropped",DTTRequest.PRI_ITEM);var d=false;if(l.IsDO&&b.IsDO){d=true;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,l.iGuid,182,"MainFrm.TreeDrop","Tree "+l.Code+": dropped node "+c.Doc.GetName()+(l==b?"":" (from tree "+b.Code)+" onto node "+m.Doc.GetName());var n=new IDVariant(0);l.FireOnDropDoc(c.Doc,m.Doc,g,a,j,n);if(b.SelectMulti()){for(var f=0;f<b.Nodes.Count();f++){var k=b.Nodes[f];if(k!=c&&k.Doc!=null){if(k.Doc.Selected()){l.FireOnDropDoc(k.Doc,m.Doc,g,a,j,n)}}}}}if(!l.IsDO&&!b.IsDO){d=true;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,l.iGuid,182,"MainFrm.TreeDrop","Tree "+l.Code+": dropped node "+c.Key+" (Hash Code = "+c.HashKey+(l==b?"":" from tree "+b.Code)+") onto node "+m.Key+" (Hash Code = "+m.HashKey+")");l.FireOnDrop(h,b.FrIndex,e,g,a,j);if(b.SelectMulti()){for(var f=0;f<b.Nodes.Count();f++){var k=b.Nodes[f];if(k!=c&&k.Selected()){l.FireOnDrop(k.HashKey,b.FrIndex,e,g,a,j)}}}}if(!d){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,l.iGuid,183,"MainFrm.TreeDrop","Tree "+b.Code+" and Tree "+l.Code+" are of different type")}}};WebEntryPointSrv.prototype.IW3C_UserEvent=function(a){};WebEntryPointSrv.prototype.FatalErrorResponse=function(a){this.TraceError(a)};WebEntryPointSrv.prototype.BeginRequest=function(){if(this.Request!=null){if(this.IEVer==0){var b=this.Request.Headers["User-Agent"];if(b!=null){var j=b.indexOf("MSIE");var g=b.indexOf(";",j+1);if(j>-1&&g>-1){this.IEVer=9*100;if(b.indexOf("Shell")!=-1){this.IEVer=1000}if(this.IEVer>=600&&this.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT){this.BrowserClass=Glb.BRWCLS_IESTRICT}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected IE Version "+this.IEVer+" (User Agent = "+b+", Host = "+this.HostName()+")")}else{if(b.indexOf("Trident/7.0")!=-1||b.indexOf("Trident/8.0")!=-1){this.IEVer=1100;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected IE Version "+this.IEVer+" (User Agent = "+b+", Host = "+this.HostName()+")")}else{if(b.indexOf("Instant Developer")!=-1){this.IEVer=700;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected Instant Developer Wizard")}else{this.IEVer=-1;if(b.indexOf("Firefox")!=-1||b.indexOf("SymbianOS")!=-1||b.indexOf("Safari")!=-1||b.indexOf("iPhone")!=-1||b.indexOf("iPad")!=-1||b.indexOf("Opera")!=-1||b.indexOf("Android")!=-1){this.BrowserClass=Glb.BRWCLS_FIREFOX;if(b.indexOf("Firefox")!=-1){j=b.indexOf("Firefox/");g=b.indexOf(".",j);var a=0;try{a=parseInt(b.substr(j+8,g-j-8),10)}catch(f){}if(a>=2){this.IEVer=600}if(a>=3){this.IEVer=700}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected FFX Version "+a+" (User Agent = "+b+", Host = "+this.HostName()+")")}else{if(b.indexOf("SymbianOS")!=-1){this.BrowserSubClass=Glb.BRWSCL_SYMBIAN;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected SymbianOS (User Agent = "+b+", Host = "+this.HostName()+")")}else{if(b.indexOf("Safari")!=-1||b.indexOf("iPhone")!=-1||b.indexOf("iPad")!=-1||b.indexOf("Android")!=-1){this.BrowserSubClass=Glb.BRWSCL_SAFARI;j=b.indexOf("Version/");if(b.indexOf("iPhone")!=-1||b.indexOf("iPad")!=-1||b.indexOf("Android")!=-1){this.IEVer=700;this.ParamsObj().TruePopup=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected iPhone/iPad/Android safari browser (User Agent = "+b+", Host = "+this.HostName()+")")}else{if(j==-1&&b.indexOf("Chrome")!=-1){this.IEVer=700;this.ParamsObj().TruePopup=false;if(b.indexOf("Edge/")!=-1){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected Microsoft Edge (User Agent = "+b+", Host = "+this.HostName()+")")}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected Google Chrome (User Agent = "+b+", Host = "+this.HostName()+")")}}else{g=b.indexOf(".",j);var a=0;try{a=parseInt(b.substr(j+8,g-j-8),10)}catch(f){}if(a>=3){if(a==4&&this.ParamsObj().UseRD&&!this.ParamsObj().UseRD3){this.ParamsObj().UseIDTag=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",160,"MainFrm.BeginRequest","IDTag disabled due to a Safari4 limitation")}this.IEVer=700;this.ParamsObj().TruePopup=false}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected Safari Version "+a+" (User Agent = "+b+", Host = "+this.HostName()+")")}}}else{if(b.indexOf("Opera")!=-1){j=b.indexOf("Version");var h=0;try{h=parseFloat(b.substr(j+8))}catch(f){}if(h>=10){this.IEVer=700}this.ParamsObj().UseIDTag=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",160,"MainFrm.BeginRequest","IDTag disabled due to a Opera10 limitation");this.ParamsObj().TruePopup=false;this.BrowserSubClass=Glb.BRWSCL_OPERA}}}}this.ParamsObj().HtmlConstraints=Glb.WEBVALID_STRICT}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",160,"MainFrm.BeginRequest","Browser not recognized (User Agent = "+b+", Host = "+this.HostName()+")")}}}}}this.DumpVersions(false);this.iHostName=(this.Request.UserHostName!=null?this.Request.UserHostName:this.Request.UserHostAddress);if(this.ParamsObj().UseRD3&&this.IEVer<700){var c=true;if(this.BrowserClass!=Glb.BRWCLS_FIREFOX&&this.IEVer>=600){c=false}if(c){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",161,"MainFrm.BeginRequest","RD3 disabled: this browser doesn't support it");this.ParamsObj().UseRD3=false}}if(this.UseRD&&this.IEVer<600){this.UseRD=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",161,"MainFrm.BeginRequest","RD has been disabled because your browser cannot support it")}if(this.ParamsObj().UseFluid&&(this.IEVer<700||this.BrowserInfo()==1)){this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",161,"MainFrm.HandleRequest","FLUID has been disabled because your browser cannot support it");this.DTTObj.AddParameter("","","BrowserInfo",new IDVariant(this.BrowserInfo()));this.ParamsObj().UseFluid=false}}}else{this.IEVer=-1;this.DumpVersions(false);if(!Glb.IsJSharpAvailable()){this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",166,"MainFrm.BeginRequest","Framework J# not available. You should consider installing the J# framework for better performances in creating PDF documents.")}}this.ErrObj.ClearError()};WebEntryPointSrv.prototype.EndRequest=function(){if(this.CompOwner==null){myPostMessage({type:"progress",message:null});this.DTTObj.EndRequest()}this.DispatchToComp("EndRequest",new Array())};WebEntryPointSrv.prototype.CloseAllDBConnections=function(){};WebEntryPointSrv.prototype.IWApp_Respond=function(){this.IWApp_UserEvent("")};WebEntryPointSrv.prototype.IWApp_UserEvent=function(a){if(this.DTTObj!=null&&a.length>3&&a.substr(0,3).equals("SID")){this.DTTObj.RecordRunning=true;a=a.substr(3);if(a.indexOf("-H")!=-1){if(this.DTTObj.HelpGeneration){this.DTTObj.HelpGenerationActive=true;this.DTTObj.CreateNewHelpItem()}a=IDL.Replace(new IDVariant(a),new IDVariant("-H"),new IDVariant("")).stringValue()}if(this.DTTObj.SessionID!=0&&(new IDVariant(a)).intValue()!=this.DTTObj.SessionID){return}this.DTTObj.SessionID=(new IDVariant(a)).intValue()}if(this.ParamsObj().UseRD3&&a==""&&this.Request.WCI==null){this.RD3Reset()}this.RenderPage()};WebEntryPointSrv.prototype.GetPageTitle=function(){var a=this.Caption().stringValue();if(this.ActiveForm()!=null){a=a+" - "+this.ActiveForm().Caption()}return Glb.HTMLEncode(a,false,true)};WebEntryPointSrv.prototype.RenderPage=function(){};WebEntryPointSrv.prototype.IWMenu_UserEvent=function(a){if(a.equals(".")){}else{if(a.equals("EXP")){this.CmdObj.set_SuppressMenu(false);this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",3,"MainFrm.MenuHandler","Expand command detected");this.DTTObj.SetRequestName("Expand Menu","Expand menu",DTTRequest.PRI_CMD);this.DTTObj.AddTestItem("EXP",DTTEngine.TST_MENU,"Main expand menu","","");this.DTTObj.AddHelpItem(0,0,0,0,"Mostra il menu principale");this.OnExpandMenu()}else{if(a.equals("CON")){this.CmdObj.set_SuppressMenu(true);this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",4,"MainFrm.MenuHandler","Collapse command detected");this.DTTObj.SetRequestName("Collapse Menu","Collapse menu",DTTRequest.PRI_CMD);this.DTTObj.AddTestItem("CON",DTTEngine.TST_MENU,"Main collapse menu","","");this.DTTObj.AddHelpItem(0,0,0,0,"Nascondi il menu principale");this.OnExpandMenu()}else{if(this.RolObj.CheckRole()){this.CmdObj.UserEvent(a)}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",5,"MainFrm.MenuHandler","Unhandled menu command: undefined session role")}}}}if(!this.ParamsObj().UseRD3){this.RenderPage()}};WebEntryPointSrv.prototype.IWSbInd_UserEvent=function(a){};WebEntryPointSrv.prototype.UrlFor=function(b,c,a){if(c==undefined){c=""}if(a==undefined){a=false}var d=this.AppName+"?WCI="+this.WebItem+"&amp;WCE="+c;if(this.URLData.length>0&&!a){d+=("&amp;WCU="+this.URLData)}if(this.WebItem.equals(Glb.ITEM_DTT)&&this.Request!=null&&this.Request.SESSNAME!=null){d+="&amp;SESSNAME="+this.Request.SESSNAME}return d};WebEntryPointSrv.prototype.UrlForDTT=function(a,c,g,f,d,b){if(c==undefined){c=""}if(g==undefined){g=""}if(f==undefined){f=""}if(d==undefined){d=""}if(b==undefined){b=true}var e='sendToApplication("'+a+'","'+c+'","'+g+'",'+(b?'"':"")+f+(b?'"':"")+',"'+d+'");';return e};WebEntryPointSrv.prototype.UrlForEnc=function(a,b){var c=this.AppName+"?WCI="+a;if(b.length>0){c+=("&amp;WCE="+b)}if(this.URLData.length>0){c+=("&amp;WCU="+this.URLData)}return c};WebEntryPointSrv.prototype.UserRole=function(){return this.RolObj.glbRole};WebEntryPointSrv.prototype.set_UserRole=function(a){this.RolObj.glbRole=a;this.RolObj.Clear();this.RolObj.EnableRole(a,true,false)};WebEntryPointSrv.prototype.UserName=function(){return this.RolObj.glbUser};WebEntryPointSrv.prototype.set_UserName=function(a){this.RolObj.glbUser=a;this.DTTObj.UserID=(parseInt(a.stringValue(),10));if(!isNaN(this.DTTObj.UserID)){this.DTTObj.Name=a.stringValue()}this.DTTObj.HelpName=a.stringValue()};WebEntryPointSrv.prototype.Caption=function(){return(this.CompOwner!=null?this.CompOwner.Caption():new IDVariant(this.iCaption))};WebEntryPointSrv.prototype.set_Caption=function(a){if(this.CompOwner!=null){this.CompOwner.set_Caption(a)}else{if(!a.equals(this.iCaption)){this.iCaption.set(a);this.RD3Change(RD3Glb.WEP_CAPTION)}}};WebEntryPointSrv.prototype.Image=function(){return(this.CompOwner!=null?this.CompOwner.Image():this.iImage)};WebEntryPointSrv.prototype.set_Image=function(a){if(this.CompOwner!=null){this.CompOwner.set_Image(a)}else{if(a!=this.iImage){this.iImage=a;this.RD3Change(RD3Glb.WEP_IMAGE)}}};WebEntryPointSrv.prototype.GetFormByIndex=function(a,e){if(e==undefined){e=null}if(this.DockedForm()!=null&&this.DockedForm().FormIdx==a){return this.DockedForm()}if(this.ActiveForm()!=null&&this.ActiveForm().FormIdx==a){return this.ActiveForm()}var d=(e!=null?e:this.StackForm);for(var b=0;b<d.Count();b++){var c=d[b];if(c.FormIdx==a){return c}}return null};WebEntryPointSrv.prototype.CreateFormByIndex=function(a){return null};WebEntryPointSrv.prototype.BringToFront=function(a){if(a==-1){var c=new IDVariant();if(this.ActiveForm()!=null){var b=this.ActiveForm();b.Form_Deactivate(c);b.SubForm_Deactivate(c)}this.set_ActiveForm(null);this.SetHelpFile(this.HelpFile);this.RD3Change(RD3Glb.WEP_ACTIVEFORM)}var d=this.GetFormByIndex(a);if(d!=null){if(d.Visible){var c=new IDVariant();if(this.ActiveForm()!=null){var b=this.ActiveForm();b.Form_Deactivate(c);b.SubForm_Deactivate(c);if(this.ActiveForm()!=null&&!this.ActiveForm().Visible){c=IDVariant.FALSE}}if(c.isFalse()){if(this.ActiveForm()!=d||this.IsMobile()){this.RD3Change(RD3Glb.WEP_ACTIVEFORM)}this.set_ActiveForm(d);this.SetHelpFile(this.ActiveForm().HelpFile);var b=this.ActiveForm();b.Form_Activate();b.SubForm_Activate();if(this.ParamsObj().Theme.equals("classic")){this.StackForm.Remove(d);this.StackForm.Insert(0,d)}}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",13,"MainFrm.BringToFront","Form "+this.ActiveForm().Caption()+" refuses to deactivate (cancel := true)");this.RD3Change(RD3Glb.WEP_ACTIVEFORM)}}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",172,"MainFrm.BringToFront","Form "+d.Caption()+" is not visible and I cannot bring it to front")}}};WebEntryPointSrv.prototype.GetFormToFocus=function(){var c=null;for(var a=0;a<this.StackForm.Count();a++){var b=this.StackForm[a];if(b.Visible&&!b.Docked&&b.WindowState()!=Glb.WS_MINIMIZE&&(c==null||b.ActivedTick>c.ActivedTick)){c=b}}return c};WebEntryPointSrv.prototype.UnloadForm=function(j,a){if(a==undefined){a=false}var g=this.GetFormByIndex(j);if(this.DockedForm()!=null&&this.DockedForm().FormIdx==j){g=this.DockedForm()}if(g!=null){var m=new IDVariant();g.UnloadForm(m,a);if(m.intValue()!=0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",153,"MainFrm.UnloadForm","Form "+g.Caption()+" refuses to close (cancel := true)");return}if(this.ActiveForm()==g){this.set_ActiveForm(null)}this.TimerObj.ActivateTimers(j,false);if(g.IsMultiple()){this.CmdObj.CloseMultipleForm(j)}var b=new ArrayList();g.GetSubForm(b);for(var d=0;d<b.Count();d++){var h=b[d];this.CmdObj.CloseMultipleForm(h.FormIdx)}if(this.DockedForm()==g){this.set_DockedForm(null);if(g.DockType==Glb.FORMDOCK_LEFT||g.DockType==Glb.FORMDOCK_RIGHT){this.ResizeClient(this.ScreenW()+g.OrgWidth-g.GetPadding(false)-1,this.ScreenH(),false)}else{this.ResizeClient(this.ScreenW(),this.ScreenH()+g.OrgHeight-g.GetPadding(true)-1,false)}}else{this.StackForm.Remove(g)}var c=this.RD3AddEvent("close",g.GetRD3Ident());for(var d=this.RD3Events.Count()-2;d>=0;d--){var k=this.RD3Events[d];if(k.Name.equals("open")){this.RD3Events.Remove(c);this.RD3Events.Insert(d,c);break}}if(this.UseZones()&&g.Docked&&this.ScreenZone(g.DockType)!=null){if(this.ScreenZone(g.DockType).SelectedForm()==g.FormIdx){this.ScreenZone(g.DockType).ActivateNextForm()}}var l=this.GetFormByIndex(g.Owner,this.GetLiveForms());if(l!=null){if(this.ActiveForm()==null||g.OpenAs==Glb.OPEN_MDI){this.BringToFront(l.FormIdx)}l.EndModal(j,a)}if(this.ActiveForm()==null){this.ActivateNextForm()}if(this.WidgetMode&&this.StackForm.Count()==0){this.ExitApp("")}}else{g=this.GetFormByIndex(j,this.GetLiveForms());if(g!=null){g.UnloadForm(new IDVariant(),false)}}};WebEntryPointSrv.prototype.ActivateNextForm=function(){if(this.ActiveForm()!=null){var a=new IDVariant();this.ActiveForm().Form_Deactivate(a);this.ActiveForm().SubForm_Deactivate(a);if(a.isTrue()){return}}this.set_ActiveForm(this.GetFormToFocus());if(this.ActiveForm()!=null){this.ActiveForm().Form_Activate();this.ActiveForm().SubForm_Activate()}this.RD3Change(RD3Glb.WEP_ACTIVEFORM);if(this.ActiveForm()!=null){this.SetHelpFile(this.ActiveForm().HelpFile)}else{this.SetHelpFile(this.HelpFile)}};WebEntryPointSrv.prototype.GetForm=function(a,c,e,d){if(c==undefined){c=false}if(e==undefined){e=true}var b=this.GetFormByIndex(a);if(b==null&&e){this.Show(a,c,d)}return this.GetFormByIndex(a)};WebEntryPointSrv.prototype.FormIsActive=function(a){return(this.ActiveForm()!=null)&&(this.ActiveForm().FormIdx==a)};WebEntryPointSrv.prototype.Show=function(a,c,b){if(typeOf(a)=="string"){return false}};WebEntryPointSrv.prototype.IWForm_UserEvent=function(a){if(this.RolObj.CheckRole()){var d=this.ActiveForm();if(this.URLData.indexOf("dock")>-1){d=this.DockedForm()}if(d!=null){var c=parseInt(this.Request.IntSesNumber,10);if(c==this.IntSesNumber||this.IntSesNumber==0||this.RDStatus==Glb.RD_ACTIVE||this.ParamsObj().UseRD3){var b=this.GetParameter("ACE");if(b!=null&&b.length>0){d.ActiveElement=b}d.FocusPriority=0;d.ProcessRequest(true);this.UpdateIMDBState();if(d!=null&&!a.equals(".")){d.ProcessRequest(false)}}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",154,"MainFrm.FormEvent","Form event handling failed (session numbers do not match)")}}}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",24,"MainFrm.FormEvent","Form event handling failed (undefined session role)")}if(!a.equals(".")){this.RenderPage()}};WebEntryPointSrv.prototype.IWUpload_UserEvent=function(a){if(this.RolObj.CheckRole()){var e=this.ActiveForm();var d=this.Request.WCU;if(d!=null&&d.indexOf("dock")>-1){e=this.DockedForm()}if(this.ParamsObj().UseRD3){var h=0;if(a.indexOf("fld:")>-1){h=a.lastIndexOf(":")}var b=parseInt(a.substr(h+1),10);if(e==null||(!isNaN(b)&&e.FormIdx!=b)){e=this.GetFormByIndex(b,this.GetLiveForms())}}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",155,"MainFrm.IWUpload","Upload BLOB request detected");this.DTTObj.SetRequestName("Upload","Upload BLOB",DTTRequest.PRI_ITEM);if(e!=null){var g=this.Request.QueryString.WCE;var c=null;if(g!=null){c=this.RD3FindField(g)}if(c==null){e.ProcessRequest(true)}else{c.Parent.UploadBlob(e)}}}};WebEntryPointSrv.prototype.IWFiles_UserEvent=function(d){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",155,"MainFrm.IWFiles","Upload Files request detected");this.DTTObj.SetRequestName("Upload Files","Upload Files",DTTRequest.PRI_ITEM);var g=null;var l=null;var j=new IDVariant();var a=d;if(d!=null&&d.length>0){if(d.startsWith("frm:")){g=this.FindWebForm(d)}else{if(d.startsWith("fld:")){var h=this.RD3FindField(d);if(h!=null){j=new IDVariant(h.Index);l=h.Parent;g=l.Parent}}}if(g!=null){a=""}}var m="";if(this.Request.Files.length>0){for(var h=0;h<this.Request.Files.length;h++){var n=this.Request.Files[h];try{var b=n.FileName.lastIndexOf(".");var h=new IDVariant(n.Content);if(b>-1){Extension=n.FileName.substr(b+1)}var c=new IDVariant(n.Content);this.OnFileUploaded(new IDVariant(a),new IDVariant(n.FileName),new IDVariant(n.ContentLength,1),new IDVariant(n.ContentType),c,g,l,j);if(n.ContentLength>0&&this.ShellObject.IsInsideShell()){var o=c.stringValue();if(o.length>0){if(!this.RolObj.CheckRole()){VBFiles.Delete(h);continue}if(o.indexOf("/")==-1&&o.indexOf("\\")==-1||o.charAt(0)!="/"){o=this.RealPath+"/"+o}VBFiles.Rename(h,new IDVariant(o));if(g!=null){if(o.equals(n.Content)){this.TempFiles.Add(o)}}else{}}else{VBFiles.Delete(h)}}}catch(k){this.DTTObj.AddException("","MainFrm.IWFiles_UserEvent","Exception while handling files",k)}}}else{this.OnFileUploaded(new IDVariant(a),new IDVariant(),new IDVariant(-1),new IDVariant(),new IDVariant(),g,l,j)}if(g==null&&!this.DisableRender){if(a.indexOf("EditIMG")>-1){this.SendHtml(m)}else{this.SendHtml("ok")}}this.RenderPage()};WebEntryPointSrv.prototype.OnFileUploaded=function(b,a,g,e,h,d,f,c){this.DispatchToComp("OnFileUploaded",new Array(b,a,g,e,h,d,f,c))};WebEntryPointSrv.prototype.OpenConnection=function(a){};WebEntryPointSrv.prototype.CmdClickCB=function(a){this.DispatchToComp("CmdClickCB",new Array([a]))};WebEntryPointSrv.prototype.TimerTickCB=function(a){this.DispatchToComp("TimerTickCB",new Array([a]))};WebEntryPointSrv.prototype.UpdateIMDBState=function(){for(var a=0;a<this.DOModifiedList.Count();a++){var d=this.DOModifiedList[a];d.ProcessChange(false)}this.DOModifiedList.Clear();if(this.IwImdb.IMDB.IsModified(Glb.GlbRefModIdx)||this.RefreshUI()){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",7,"MainFrm.UpdateIMDBState","IMDB is changed: Updating Controls");this.UpdateControls()}var b=this.GetLiveForms();for(var a=0;a<b.Count();a++){var c=b[a];if(this.IwImdb.IMDB.IsModified(Glb.GlbRefModIdx)||this.RefreshUI()||(c.IsMultiple()&&c.IMDB.IsModified(Glb.GlbRefModIdx))){c.UpdateControls()}}if(this.IwImdb.IMDB.IsModified(Glb.GlbRefModIdx)||this.RefreshUI()){if(this.DockedForm()!=null){this.DockedForm().UpdateControls()}this.IwImdb.IMDB.ResetModified(Glb.GlbRefModIdx);this.set_RefreshUI(false)}};WebEntryPointSrv.prototype.ExitApp=function(a){if(this.CompOwner!=null){this.CompOwner.ExitApp(a)}else{if(a.length==0){if(this.ShellObject.IsInsideShell()){this.ShellObject.SendCmd("EXIT");return}a="about:blank"}if(a.equals("???")){if(this.UseRD){if(this.ParamsObj().UseRD3){a=this.GetAppUrl()}else{a=this.UrlFor(Glb.ITEM_FRAMES)}}else{a=this.UrlFor(Glb.ITEM_APP)}}this.SessionAbandon();if(!this.DisableRender){if(this.RDStatus==Glb.RD_ACTIVE||(this.ParamsObj().UseRD3&&this.DesktopRendered)){this.RDExitURL=a}}}};WebEntryPointSrv.prototype.Redirect=function(a){if(this.RDStatus==Glb.RD_ACTIVE||(this.ParamsObj().UseRD3&&this.DesktopRendered)){this.RDExitURL=a}};WebEntryPointSrv.prototype.LogoffButton=function(){return null};WebEntryPointSrv.prototype.log=function(a){WriteToConsoleOutput(a)};WebEntryPointSrv.prototype.GetMimeType=function(a){var b=IDL.GetMimeType(a);if(b.length>0){return b}b=this.GetMimeFromExtension(a);if(b.length==0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",400,"MainFrm.GetMimeType","Unknown MIME-TYPE for extension "+a)}return b};WebEntryPointSrv.prototype.GetSetting=function(b,a){if(b.stringValue().equals("FORM")){return IDVariant.convertObject(this.GetParameter(a.stringValue()))}if(b.stringValue().equals("SES")){if(this.IsServerSession()){return new IDVariant()}else{return this.SessionSettings[a.stringValue()]}}if(b.stringValue().equals("APP")){return this.GetAppSetting(a)}if(!this.IsServerSession()){var c=b.stringValue()+a.stringValue();return new IDVariant(IDL.GetCookie(c))}return new IDVariant()};WebEntryPointSrv.prototype.GetAppSetting=function(a){return new IDVariant()};WebEntryPointSrv.prototype.SaveSetting=function(c,a,b){if(c.stringValue().equals("SES")){if(!this.IsServerSession()){if(b.stringValue().Length==0){this.SessionSettings.remove(a.stringValue())}else{this.SessionSettings.add(a.stringValue(),b)}}return}if(c.stringValue().equals("APP")){this.SaveAppSetting(a,b);return}if(!this.IsServerSession()){var d=c.stringValue()+a.stringValue();IDL.SetCookie(d,b.stringValue(),2000000000)}};WebEntryPointSrv.prototype.SaveAppSetting=function(a,b){};WebEntryPointSrv.prototype.OpenResponse=function(a){};WebEntryPointSrv.prototype.ShowLogin=function(){};WebEntryPointSrv.prototype.UpdateControls=function(){this.DispatchToComp("UpdateControls",new Array())};WebEntryPointSrv.prototype.RefreshAllLookups=function(g,m,c){if(g==undefined){g=null}if(m==undefined){m=null}if(c==undefined){Doc=true}if(this.CompOwner!=null){this.CompOwner.RefreshAllLookups(g,m,c);return}if(g==null&&m==null){this.RefreshLookups.Clear();if(c){this.LookupCache.clear()}}else{var e=(g!=null?g:"")+"|"+(m!=null?m:"");this.RefreshLookups.Remove(e);if(c){var l=this.LookupCache.keys();for(var b=0;b<l.length;b++){var h=l[b];var k=h.split("|");if(g!=null&&String.compare(k[0],g,true)==0){this.LookupCache.remove(h);break}else{if(m!=null&&String.compare(k[1],m,true)==0){this.LookupCache.remove(h)}}}}}for(var b=0;b<this.StackForm.Count();b++){var d=this.StackForm[b];for(var a=0;a<d.Frames.length;a++){if(d.Frames[a]!=null&&d.Frames[a].Content instanceof IDPanelSrv){d.Frames[a].Content.RefreshLookup(g,m)}}}};WebEntryPointSrv.prototype.GetNewGuid=function(){var a=new GUID();return new IDVariant(a.ToString())};WebEntryPointSrv.prototype.OnCommand=function(a){this.DispatchToComp("OnCommand",new Array(a))};WebEntryPointSrv.prototype.OnWepResize=function(){this.DispatchToComp("OnWepResize",new Array())};WebEntryPointSrv.prototype.OnChangeLocation=function(a){this.DispatchToComp("OnChangeLocation",new Array(a))};WebEntryPointSrv.prototype.OnDeviceMotion=function(a){this.DispatchToComp("OnDeviceMotion",new Array(a))};WebEntryPointSrv.prototype.SetHelpFile=function(a){if(this.CompOwner!=null){this.CompOwner.SetHelpFile(a)}else{if(a!=null&&!a.equals(this.iActiveHelpFile)){this.iActiveHelpFile=a;this.RD3Change(RD3Glb.WEP_HELPFILE)}}};WebEntryPointSrv.prototype.DTTTrace=function(){if(this.DTTObj.AddTraceItem("",DTTEngine.TRC_ITMAIN,"MainFrm.Render","")){this.DTTObj.AddTraceToken(this.RTCObj.AppGuid,DTTEngine.TRC_MAINCAPTION,"Caption",this.Caption(),"");for(var a=1;a<this.IndObj.Indicators.length;a++){if(this.IndObj.Indicators[a]==null){continue}if(this.IndObj.Indicators[a].IdxForm==0&&this.IndObj.Indicators[a].bVisible(0)){this.DTTObj.AddTraceToken(this.IndObj.Indicators[a].iGuid,DTTEngine.TRC_MAININDIC,"Indicator "+this.IndObj.Indicators[a].Code,this.IndObj.Indicators[a].bText(0),"")}if(this.ActiveForm()!=null&&IndObj.Indicators[a].IdxForm==this.ActiveForm().FormIdx&&this.IndObj.Indicators[a].bVisible(this.IndObj.Indicators[a].IdxForm)){this.DTTObj.AddTraceToken(this.IndObj.Indicators[a].iGuid,DTTEngine.TRC_FORMINDIC,"Indicator "+this.IndObj.Indicators[a].Code,this.IndObj.Indicators[a].bText(this.ActiveForm().FormIdx),"")}}if(this.ActiveForm()!=null){for(var c=0;c<this.ActiveForm().Messages.Count();c++){var b=this.ActiveForm().Messages[c];this.DTTObj.AddTraceToken(this.ActiveForm().RTCGuid,DTTEngine.TRC_FORMMESSAGE,"Message",b.Text,"")}}}};WebEntryPointSrv.prototype.OpenDebugWindow=function(g,a,d){if(g==undefined){g=0}if(a==undefined){a=""}if(d==undefined){d=""}if(typeof(g)=="string"){a=g;g=0}try{var c=false;if(g!=0&&this.DTTObj.DB!=null){var b=new IDCachedRowSet();this.OpenConnection(this.DTTObj.DB);b.setCommand("select SessSnapshot from DTTSessions where SessID = "+g);b.execute(new ArrayList(),this.DTTObj.DB);if(!b.EOF()){b.MoveFirst()}if(b.Get(1).Type==IDVariant.NULL){a="";this.DTTObj.LoadFromDB(g)}else{a=Glb.SaveBlob(this,b.Get(1)).stringValue();c=true}this.DTTObj.RefDTTObj=null}if(!a.equals("")){this.DTTObj.LoadSnapshot(a);if(c){File.Delete(a)}}this.DTTObj.SnapshotLoaded=true;if(!d.equals("")){this.Request.SESSNAME=d}this.IWDTT_UserEvent("",null)}catch(f){this.DTTObj.AddException("","MainFrm.OpenDebugWindow","Can't open debug window",f)}};WebEntryPointSrv.prototype.CheckDTTDiff=function(a,b){this.set_RedirectTo(new IDVariant(this.UrlFor(Glb.ITEM_TEST,"TS"+IDL.FormatMessage(new IDVariant("|1-|2"),new IDVariant(a),new IDVariant(b)).stringValue())));this.set_RedirectNewWindow(true)};WebEntryPointSrv.prototype.SetUrlData=function(a){this.URLData="";if(this.ParamsObj().IWCacheControl.equals("URL")){this.URLData=Math.floor(Math.random()*2147483647).toString()}this.URLData=this.URLData+a};WebEntryPointSrv.prototype.WriteStr=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStr(a);return}this.Response.responseText+=a};WebEntryPointSrv.prototype.WriteStrDbgMain=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgMain(a);return}this.DebugWindow=this.DebugWindow+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgItemList=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgItemList(a);return}this.DebugItemList=this.DebugItemList+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgCmdForm=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgCmdForm(a);return}this.DebugCmdForm=this.DebugCmdForm+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgDetail=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgDetail(a);return}this.DebugDetail=this.DebugDetail+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgReqTop=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgReqTop(a);return}this.DebugReqTop=this.DebugReqTop+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgReqRef=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgReqRef(a);return}this.DebugReqRef=this.DebugReqRef+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgReqPrc=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgReqPrc(a);return}this.DebugReqPrc=this.DebugReqPrc+a;this.SendDebug=true};WebEntryPointSrv.prototype.RenderDifferences=function(a){};WebEntryPointSrv.prototype.IWRD_Respond=function(){this.IWRD_UserEvent("")};WebEntryPointSrv.prototype.IWRD_UserEvent=function(a){};WebEntryPointSrv.prototype.GetToken=function(b,a){var d=b.indexOf(a+"=");if(d!=-1){var c=b.substr(d).indexOf("&");if(c==-1){c=b.length}else{c+=d}return Value=b.substr(d+a.length+1,c-(d+a.length+1))}return""};WebEntryPointSrv.prototype.GetAllTokens=function(c){this.RDToken.clear();var e=0;c=Glb.HTMLDecode(c);if(this.BrowserClass==Glb.BRWCLS_FIREFOX){c=c.replace(/\r\n/g,"\n")}if(c.length<1){return}while(e!=-1){e=c.indexOf(":");if(e!=-1){var d=c.substr(e+1).indexOf(":")+e+1;if(d>0){var f=(new IDVariant(c.substr(e+1,d-(e+1)))).intValue();var b=c.substr(0,e);var a=c.substr(d+1,f);if(this.BrowserClass==Glb.BRWCLS_FIREFOX){a=a.replace(/\n/g,"\r\n")}this.RDToken[b]=a;e=d+f+1;c=c.substr(e)}else{c=""}}}};WebEntryPointSrv.prototype.GetParameter=function(a){if(this.RDToken.count()>0){return this.RDToken[a]}else{return this.Request[a]}};WebEntryPointSrv.prototype.CanUseIDTag=function(){if(this.ParamsObj().UseIDTag){if(this.RDStatus==Glb.RD_ACTIVE&&this.IEVer>550){return true}}return false};WebEntryPointSrv.prototype.AddMultipleForm=function(e,g){var d=65536;var j;var a=null;var k;var c=this.GetLiveForms();k=e.FormIdx;while(true){j=k+d;a=this.GetFormByIndex(j,c);d=d+65536;if(a==null){break}}e.FormIdx=j;e.ActivedTick=this.ClickCounter()+1;if(!g){this.StackForm.Insert(0,e)}e.BaseTimerIdx=this.TimerObj.OpenMultipleForm(j);var b=new ArrayList();e.BaseCmdSetIdx=this.CmdObj.OpenMultipleFormCS(j,b);e.BaseCmdLinIdx=this.CmdObj.OpenMultipleFormCL(j,b);if(!g){var h=this.RD3AddEvent("open","frm:"+e.FormIdx)}};WebEntryPointSrv.prototype.ShowMultipleForm=function(g,h,e){if(e==undefined){e=null}if(g.IMDB==null){g.SetMainFrm(g.MainFrm,this.IMDB)}var d=0;if(h==Glb.OPEN_POPUP&&this.RDLevel()<3){h=Glb.OPEN_MDI}var a=null;if(h!=Glb.OPEN_MDI||this.IsMobile()){a=(h!=Glb.OPEN_MDI?this.ActiveForm():null);if(e!=null&&e instanceof WebFormSrv){a=e}if(a!=null&&a.Docked&&h==Glb.OPEN_MDI&&!this.IsSmartPhone()){a=null}if(a!=null){d=a.FormIdx}else{if(h!=Glb.OPEN_MDI){d=32767}}}if(h!=Glb.OPEN_MDI){for(var b=0;b<this.RD3Events.Count();b++){var c=this.RD3Events[b];if(c.Name.equals("open")&&c.Ident.equals(g.GetRD3Ident())){c.SetAttribute("openas",h.toString())}}}g.OpenAs=h;g.Owner=d;g.Visible=true;if(a!=null&&a.OpenAs==Glb.OPEN_MDI&&h==Glb.OPEN_MDI&&!g.Docked&&!a.Docked){g.set_BackButTxt(a.Caption().stringValue())}if(h==Glb.OPEN_MDI&&g.Docked&&this.UseZones()&&this.ScreenZone(g.DockType)!=null){this.ScreenZone(g.DockType).set_SelectedForm(g.FormIdx)}this.BringToFront(g.FormIdx)};WebEntryPointSrv.prototype.OnSendHelpMail=function(a,c,b){this.DispatchToComp("OnSendHelpMail",new Array(a,c,b))};WebEntryPointSrv.prototype.AfterHelpSession=function(d,b,e,a,c){this.DispatchToComp("AfterHelpSession",new Array(d,b,e,a,c))};WebEntryPointSrv.prototype.OnExpandMenu=function(){this.DispatchToComp("OnExpandMenu",new Array())};WebEntryPointSrv.prototype.OnOpenPopup=function(a,c,b){this.DispatchToComp("OnOpenPopup",new Array(a,c,b))};WebEntryPointSrv.prototype.OnCmdSetCommand=function(a,d,c,b){this.DispatchToComp("OnCmdSetCommand",new Array(a,d,c,b))};WebEntryPointSrv.prototype.GlobalCmdSetCommand=function(c,b,a){this.DispatchToComp("GlobalCmdSetCommand",new Array(c,b,a))};WebEntryPointSrv.prototype.OnGetDBByName=function(a){};WebEntryPointSrv.prototype.GetDBByName=function(a){var b=this.GetDBObjByName(a);return(b!=null?b.GetDB():null)};WebEntryPointSrv.prototype.GetDBObjByName=function(a){return null};WebEntryPointSrv.prototype.OnCmdSetChangeExpand=function(b,a,c){this.DispatchToComp("OnCmdSetChangeExpand",new Array(b,a,c))};WebEntryPointSrv.prototype.OnKeyPress=function(a,b){this.DispatchToComp("OnKeyPress",new Array(a,b))};WebEntryPointSrv.prototype.OnCmdSetGeneralDrag=function(a,d,c,b){this.DispatchToComp("OnCmdSetGeneralDrag",new Array(a,d,c,b))};WebEntryPointSrv.prototype.OnCmdSetGeneralDrop=function(a,d,c,b){this.DispatchToComp("OnCmdSetGeneralDrop",new Array(a,d,c,b))};WebEntryPointSrv.prototype.OnSynchronize=function(a,c,e,d,b){this.DispatchToComp("OnSynchronize",new Array(a,c,e,d,b))};WebEntryPointSrv.prototype.OnSyncQuery=function(a,b,c,d){this.DispatchToComp("OnSyncQuery",new Array(a,b,c,d))};WebEntryPointSrv.prototype.OnSyncFilter=function(b,a){this.DispatchToComp("OnSyncFilter",new Array(b,a))};WebEntryPointSrv.prototype.OnEndSynchronization=function(b,a,c){this.DispatchToComp("OnEndSynchronization",new Array(b,a,c))};WebEntryPointSrv.prototype.TableSubst=function(b,f,k,g,e){if(this.LateDBTableSubstitution()&&this.InitializingQueries){return"$$("+b+","+f+","+k+","+g+")$$"}var c=new IDVariant(b);var j=new IDVariant(f);var a=new IDVariant(k);var d=new IDVariant(g);var h=new IDVariant(e);this.GetApplication().OnTableSubstitution(c,j,a,d,h);if(g==0){return a.stringValue()}else{return j.stringValue()}};WebEntryPointSrv.prototype.LateDBTableSubstitution=function(){return(this.CompOwner!=null?this.CompOwner.LateDBTableSubstitution():this.iLateDBTableSubstitution)};WebEntryPointSrv.prototype.set_LateDBTableSubstitution=function(a){if(this.CompOwner!=null){this.CompOwner.set_LateDBTableSubstitution(a)}else{this.iLateDBTableSubstitution=a}};WebEntryPointSrv.prototype.HandleTableSubst=function(f,c){if(!this.LateDBTableSubstitution()){return f}var j=f.indexOf("$$(");var h=(j!=-1?f.indexOf(")$$",j):-1);while(j!=-1&&h!=-1){var m=f.substring(j,h+1);m=m.substring(3,m.length-1);var a=m.split(",");var b=a[0];var e=a[1];var k=a[2];var g=parseInt(a[3]);var l=this.InitializingQueries;this.InitializingQueries=false;var d=this.TableSubst(b,e,k,g,c);this.InitializingQueries=l;f=f.substring(0,j)+d+f.substring(h+3);j=f.indexOf("$$(",j);h=(j!=-1?f.indexOf(")$$",j):-1)}return f};WebEntryPointSrv.prototype.OnTableSubstitution=function(a,d,c,b,e){this.DispatchToComp("OnTableSubstitution",new Array(a,d,c,b,e))};WebEntryPointSrv.prototype.NewAssistance=function(g,d,b,j,a,h,f){if(a==undefined){a=""}if(h==undefined){h=""}if(f==undefined){f=""}var c="";var e="";if(this.ActiveForm()!=null){e=this.ActiveForm().Caption().stringValue();if(!this.ActiveForm().RTCGuid.equals("")){e+=(" - "+this.ActiveForm().RTCGuid)}}c="http://"+g;c=c+"?CMD=TeamWorks";c=c+"&Panel=Segnalazione";c=c+"&PrjGUID="+this.RTCObj.PrjGuid;c=c+"&Modulo="+e;c=c+"&Versione="+this.RevNum;c=c+"&NomeCognome="+h;c=c+"&Telefono="+f;c=c+"&TestoSegnalazione="+d;c=c+"&MotivazioneUrgenza="+a;c=c+"&PrSegnalazione="+b;c=c+"&TipoSegnalazione="+j;this.set_RedirectTo(new IDVariant(c));this.set_RedirectNewWindow(true)};WebEntryPointSrv.prototype.ParamsObj=function(){return this.iParamsObj};WebEntryPointSrv.prototype.SendHtml=function(c,a,b){if(a==undefined){a=-1}if(b==undefined){b=""}this.DisableRender=true};WebEntryPointSrv.prototype.FireAfterLogin=function(){};WebEntryPointSrv.prototype.MessageConfirm=function(a){return this.MessageConfirmEx(a).booleanValue()};WebEntryPointSrv.prototype.MessageConfirmEx=function(e,b){if(b==undefined){b=new IDVariant()}var g=e.ToString();g=g.replace(/\r\n/g,"\n");g=g.replace(/\r/g,"\n");var a=this.ConfStack[g];if(a!=null){if(a=="Y"){return new IDVariant(true)}else{if(a=="N"){return new IDVariant(false)}else{return new IDVariant(a)}}}else{this.set_AlertMessage(new IDVariant(g));this.set_AlertType(1);if(this.ParamsObj().UseRD3){this.set_hasConfirm(true);var f=false;for(var c=0;c<this.RD3Events.Count()&&!f;c++){var d=this.RD3Events[c];if(d.Name.equals("msgbox")&&d.Ident.equals(this.AlertMessage().stringValue())){f=true}}if(!f){var d=this.RD3AddEvent("msgbox",this.AlertMessage().stringValue());d.CanSendInFulltree=true;d.SetAttribute("type","1");if(this.VoiceCommandExecuted){d.SetAttribute("voice","1")}if(b!=null&&b.Type!=IDVariant.NULL){d.SetAttribute("opts",b.stringValue())}}this.set_AlertMessage(new IDVariant())}return new IDVariant()}};WebEntryPointSrv.prototype.InputBox=function(c,d){if(d==undefined){d=new IDVariant()}var e=c.ToString();e=e.replace(/\r\n/g,"\n");e=e.replace(/\r/g,"\n");var a=this.ConfStack[e];if(a!=null){return new IDVariant(a)}else{this.set_AlertMessage(new IDVariant(e));this.set_AlertType(2);if(this.ParamsObj().UseRD3){this.set_hasConfirm(true);var b=this.RD3AddEvent("msgbox",this.AlertMessage().stringValue());b.CanSendInFulltree=true;b.SetAttribute("type","2");if(d.stringValue().length>0){b.SetAttribute("opts",d.stringValue())}if(this.VoiceCommandExecuted){b.SetAttribute("voice","1")}this.set_AlertMessage(new IDVariant())}return new IDVariant()}};WebEntryPointSrv.prototype.DumpVersions=function(c){var d="24.5.9400";var b=this.IDVer.equals(d);var e=(b?"OK - ":"WARNING - ")+"ID Version: "+this.IDVer+", IJLIB Version: "+d;this.DTTObj.AddMsg((b?DTTEngine.DTTMSG_INFO:DTTEngine.DTTMSG_WARN),"",220,"MainFrm.DumpVersions",e);WriteToConsoleOutput(e);var a=new IDVariant(e);if(c){this.set_AlertMessage(a)}return a};WebEntryPointSrv.prototype.ResizeClient=function(c,b,a){};WebEntryPointSrv.prototype.PrintReport=function(d,h,b,f,e,k){if(h==undefined){h=""}if(b==undefined){b=""}if(f==undefined){f=""}if(e==undefined){e=""}if(k==undefined){k=true}if(d.toUpperCase().endsWith(".XML")){var j=new WebFormSrv();j.MainFrm=this;var a=new OBookSrv(j);var c=new CIDREObj(a);a.BookObj=c;c.InitHTML();var g=XMLuiSrv.LoadFromXML(c,this,d,true);if(g==0){if(!h.equals("")){c.SetReportWhereClause(-1,h)}c.set_PrintDestination(IDREGlb.PRN_PDF);c.PrintBook(1,-1);this.set_RedirectTo(new IDVariant(c.GetWebFileName()));this.set_RedirectNewWindow(k);return new IDVariant(c.OutputFileName())}else{return new IDVariant(g,IDVariant.STRING)}}return new IDVariant()};WebEntryPointSrv.prototype.AddPDFPrint=function(h,b,g,c,f,e,a){var d=new PDFPrintSrv();this.PDFPrints.Add(d);d.PDFFile=h;d.MsgText=b;d.FromPage=g;d.ToPage=c;d.FitToPaper=f;d.AutoDelete=e;d.PrintDlg=a};WebEntryPointSrv.prototype.RTCReset=function(){this.CmdObj.RDAll=true;this.RolObj.ApplyRoles(0,null);for(var a=0;a<this.StackForm.Count();a++){var b=this.StackForm[a];b.RTCReset()}if(this.DockedForm()!=null){this.DockedForm().RTCReset()}this.RD3Change(RD3Glb.WEP_RTCRESET)};WebEntryPointSrv.prototype.UseDecimalDot=function(){return this.ParamsObj().UseDecimalDot};WebEntryPointSrv.prototype.set_UseDecimalDot=function(a){if(this.ParamsObj().UseDecimalDot!=a){this.ParamsObj().UseDecimalDot=a;this.CmdObj.RDAll=true;this.RD3Change(RD3Glb.WEP_USEDECIMALDOT)}};WebEntryPointSrv.prototype.NativeBlob=function(){return this.ParamsObj().NativeBlob};WebEntryPointSrv.prototype.RefreshTraylet=function(a){this.TrayletRefreshCommand=a};WebEntryPointSrv.prototype.RenderTrayletCommand=function(){};WebEntryPointSrv.prototype.SetGlobalMenuStatus=function(c,b,a){this.GlbRoleCmdSetEnabled=c;this.GlbRoleCmdLinEnabled=b;this.GlbRoleCommandEnabled=a};WebEntryPointSrv.prototype.ConnectToInde=function(){};WebEntryPointSrv.prototype.x_OnDisconnect=function(){};WebEntryPointSrv.prototype.x_OnCBTEvent=function(d,c,g,f,b,a,h,e){};WebEntryPointSrv.prototype.OnCBTEvent=function(d,c,g,f,b,a,h,e){};WebEntryPointSrv.prototype.StartPhase=function(a,c,b){this.ProgrBar.StartPhase(a,c,b)};WebEntryPointSrv.prototype.TrackPhase=function(b,a){return this.ProgrBar.TrackPhase(b,a)};WebEntryPointSrv.prototype.getIMDB=function(){return this.IMDB};WebEntryPointSrv.prototype.getDTTObj=function(){return this.DTTObj};WebEntryPointSrv.prototype.getRTCObj=function(){return this.RTCObj};WebEntryPointSrv.prototype.getRolObj=function(){return this.RolObj};WebEntryPointSrv.prototype.getRealPath=function(){return this.RealPath};WebEntryPointSrv.prototype.TempPath=function(){if(this.CompOwner!=null){return this.CompOwner.TempPath()}else{return this.iTempPath}};WebEntryPointSrv.prototype.set_TempPath=function(a){if(this.CompOwner!=null){this.CompOwner.set_TempPath(a)}else{this.iTempPath=a}};WebEntryPointSrv.prototype.GetRD3Ident=function(a){if(a==undefined){a=-1}switch(a){case -1:return"wep";case RD3Glb.WEP_OBJ_SUPPRESSMENU:return"header-suppress-menu";case RD3Glb.WEP_OBJ_MAINCAPTION:return"header-main-caption";case RD3Glb.WEP_OBJ_HELPBUTTON:return"header-help-button";case RD3Glb.WEP_OBJ_DEBUGBUTTON:return"header-debug-image";case RD3Glb.WEP_OBJ_CLOSEAPP:return"header-close-app";case RD3Glb.WEP_OBJ_STARTBUTTON:return"taskbar-start-cell";case RD3Glb.WEP_OBJ_CMDINPUT:return"header-command-input";case RD3Glb.WEP_OBJ_FORMLIST:return"form-list-header";case RD3Glb.WEP_OBJ_CLOSEALL:return"form-list-close-all-box"}return""};WebEntryPointSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}if(this.CompOwner!=null){this.CompOwner.RD3Change(a,b);return}this.RD3PropChg[a]=b;this.RD3Changed=true};WebEntryPointSrv.prototype.RD3RenderDifferences=function(R,I){var z=null;for(var K=0;K<this.RD3CliExecute.Count();K++){var M=this.RD3CliExecute[K];if(M.length==0||M.charAt(0)!="!"){continue}var a=R.AddNewElement("exe");a.SetAttribute("cmd",M.substr(1))}if(this.TrayletRefreshCommand.length>0){this.RD3AddEvent("traylet",this.TrayletRefreshCommand);this.TrayletRefreshCommand=""}if(this.RedirectTo().stringValue().length>0){if(this.DeleteAfterDownload||this.SaveAttachment){}var D=this.RD3AddEvent((this.RedirectNewWindow()?"opendoc":"redirect"),this.RedirectTo().stringValue());D.CanSendInFulltree=true;D.SetAttribute("fea",this.RedirectFeatures().toString());this.set_RedirectTo(new IDVariant())}if(this.RDExitURL.length>0){var D=this.RD3AddEvent("redirect",this.RDExitURL);this.RDExitURL=""}for(var K=0;K<this.PDFPrints.Count();K++){var E=this.PDFPrints[K];if(!E.Rendered){var D=this.RD3AddEvent("printpdf",E.PDFFile);D.SetAttribute("msg",E.MsgText);D.SetAttribute("from",E.FromPage.toString());D.SetAttribute("to",E.ToPage.toString());D.SetAttribute("fit",E.FitToPaper?"1":"0");D.SetAttribute("dlg",E.PrintDlg?"1":"0");E.Rendered=true}}this.RD3Tooltips=new ArrayList();while(this.RD3Events.Count()>0){var o=new ArrayList();o.AddRange(this.RD3Events);this.RD3Events.Clear();for(var K=0;K<o.Count();K++){var D=o[K];if(D.Name.equals("error")){z=D}else{if(D.Name.equals("tooltip")){this.RD3Tooltips.Add(D)}else{if(D.Name.equals("searchval")){this.RD3Tooltips.Add(D)}else{if(D.Name.equals("msgbox")&&I&&D.CanSendInFulltree){this.RD3Tooltips.Add(D)}else{var H=D.Send(R,I);if(H!=null){if(D.Name.equals("open")){var G=null;for(var J=0;J<this.StackForm.Count();J++){var N=this.StackForm[J];if(N.GetRD3Ident()==D.Ident){N.RD3RenderDifferences(H,true);G=N}}if(G!=null){for(var J=0;J<o.Count();J++){var S=o[J];if(S.Name.equals("rcache")||S.Name.equals("rstgrp")){var E=S.Ident.lastIndexOf(":");var y=parseInt(S.Ident.substr(E+1),10);if(!isNaN(y)){if(y==G.FormIdx){S.DontSend=true}else{var u=new ArrayList();G.GetSubForm(u);for(var m=0;m<u.Count();m++){var N=u[m];if(N.FormIdx==y){S.DontSend=true;break}}}}}}}}}}}}}}}this.RD3Events.Clear();var B=null;if(I){var v=R.AddNewElement("start");B=v.AddNewElement(this.GetRD3Ident())}if(B==null&&this.RD3Changed){B=R.AddNewElement("chg")}if(B!=null){B.SetAttribute("id",this.GetRD3Ident())}if(I||this.RD3Changed){for(var K=0;K<this.RD3PropChg.length;K++){if(this.RD3PropChg[K]||I){this.SetRD3Property(K,B,I)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(I){B.SetAttribute("lan",this.GetAppLanguage());if(this.CloseAllEvent!=(RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_IMMEDIATE)){B.SetAttribute("clo",this.CloseAllEvent.toString())}if(this.CloseAppEvent!=(RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_IMMEDIATE)){B.SetAttribute("cla",this.CloseAppEvent.toString())}if(this.StartAnimationDef!=null){B.SetAttribute("sta",this.StartAnimationDef)}if(this.ExpandCmdSetAnimationDef!=null){B.SetAttribute("eca",this.ExpandCmdSetAnimationDef)}if(this.PopupMenuAnimationDef!=null){B.SetAttribute("pma",this.PopupMenuAnimationDef)}if(this.ShowFormAnimationDef!=null){B.SetAttribute("sfa",this.ShowFormAnimationDef)}if(this.OpenModalAnimationDef!=null){B.SetAttribute("oma",this.OpenModalAnimationDef)}if(this.MessageAnimationDef!=null){B.SetAttribute("msa",this.MessageAnimationDef)}if(this.LastMessageAnimationDef!=null){B.SetAttribute("lma",this.LastMessageAnimationDef)}if(this.CollapseFrameAnimationDef!=null){B.SetAttribute("cfa",this.CollapseFrameAnimationDef)}if(this.ExpandTreeAnimationDef!=null){B.SetAttribute("eta",this.ExpandTreeAnimationDef)}if(this.ChangeLayoutAnimationDef!=null){B.SetAttribute("cya",this.ChangeLayoutAnimationDef)}if(this.QBETipAnimationDef!=null){B.SetAttribute("qta",this.QBETipAnimationDef)}if(this.ChangeTabPageAnimationDef!=null){B.SetAttribute("cta",this.ChangeTabPageAnimationDef)}if(this.ShowGraphAnimationDef!=null){B.SetAttribute("sga",this.ShowGraphAnimationDef)}if(this.ChangeBookPageAnimationDef!=null){B.SetAttribute("cba",this.ChangeBookPageAnimationDef)}if(this.RedirectAnimationDef!=null){B.SetAttribute("rda",this.RedirectAnimationDef)}if(this.PreviewAnimationDef!=null){B.SetAttribute("pra",this.PreviewAnimationDef)}if(this.DockedAnimationDef!=null){B.SetAttribute("dka",this.DockedAnimationDef)}if(this.PopupResizeAnimationDef!=null){B.SetAttribute("ppr",this.PopupResizeAnimationDef)}if(this.TooltipAnimationDef!=null){B.SetAttribute("ttp",this.TooltipAnimationDef)}if(this.TaskbarAnimationDef!=null){B.SetAttribute("tsk",this.TaskbarAnimationDef)}if(this.ComboAnimationDef!=null){B.SetAttribute("cmb",this.ComboAnimationDef)}if(!this.ParamsObj().EnableRichTooltip){B.SetAttribute("tme",this.ParamsObj().EnableRichTooltip?"1":"0")}if(this.ComboNameSep!="; "){B.SetAttribute("cns",this.ComboNameSep)}if(this.ParamsObj().IonicDarkMode!=Glb.DARKMODE_AUTO){B.SetAttribute("dmt",this.ParamsObj().IonicDarkMode)}if(this.ListenKeys!=0){B.SetAttribute("hks",this.ListenKeys.toString())}}var s=(I)?B:R;this.CmdObj.RD3RenderDifferences(s,I,0);this.VisualStyleList.RD3RenderDifferences(s,I);this.IndObj.RD3RenderDifferences(s,I);this.TimerObj.RD3RenderDifferences(s,I,0);this.VoiceObj.RD3RenderDifferences(s,I);if(I){WebFrameSrv.RenderCustomCommands(this,s)}if(this.UseZones()){for(var t=0;t<this.screenZones.Count();t++){var h=this.screenZones.Get(t);h.RD3RenderDifferences(s,I)}}for(var K=this.StackForm.Count()-1;K>=0;K--){var N=this.StackForm[K];N.RD3RenderDifferences(s,I)}if(I){this.RD3ServerParams(s)}var q=new ArrayList();if(this.ActiveForm()!=null){q.Add(this.ActiveForm())}for(var K=0;K<this.StackForm.Count();K++){var N=this.StackForm[K];if(N.Docked){q.Add(N)}}var k=false;for(var K=0;K<q.Count();K++){var N=q[K];if(N.FocusPriority==0){k=true}}var C=null;if(k){var l=new ArrayList();for(var K=0;K<q.Count();K++){var N=q[K];N.GetSubForm(l)}for(var K=0;K<l.Count();K++){var c=l[K];if(c.FocusPriority>0){C=c;break}}}var r=false;for(var K=0;K<q.Count();K++){var N=q[K];if(N.FocusPriority>0){r=true}}if(r||I||C!=null){var N=null;if(this.ActiveForm()!=null&&this.ActiveForm().FocusPriority>0){N=this.ActiveForm()}else{for(var K=0;K<q.Count();K++){var A=q[K];if(A.Docked&&A.FocusPriority>0){N=A;break}}}if(I&&N==null){if(this.ActiveForm()!=null){N=this.ActiveForm()}else{for(var K=0;K<q.Count();K++){var A=q[K];if(A.Docked){N=A;break}}}}if((N!=null&&N.FocusPriority==0)||C!=null){N=C}if(N!=null&&N.ActiveElement.length>5&&N.ActiveElement.startsWith("F")){var Q=N.ActiveElement.indexOf("C");var O=N.ActiveElement.indexOf("R");try{var F=parseInt(N.ActiveElement.substr(1,Q-1),10);var b=parseInt(N.ActiveElement.substr(Q+1,O-Q-1),10);var x=parseInt(N.ActiveElement.substr(O+1),10);var E=N.Frames[F].Content;var L=E.bFields(b);var D=this.RD3AddEvent("focus",L.GetRD3Ident());D.SetAttribute("row",x.toString());D.CanSendInFulltree=true;if(L.sendSelection){D.SetAttribute("sels",L.SelStart().toString());D.SetAttribute("sele",L.SelEnd().toString());L.sendSelection=false}if(E.IsShowingGrouping()&&E.GroupRoot!=null){D.SetAttribute("absrow",E.ActualPosition().toString())}}catch(P){}}}if(this.AlertMessage().stringValue().length>0){var D=this.RD3AddEvent("msgbox",this.AlertMessage().stringValue());D.SetAttribute("type","0");if(this.VoiceCommandExecuted){D.SetAttribute("voice","1")}D.CanSendInFulltree=true;this.set_AlertMessage(new IDVariant())}if(z!=null){this.RD3Events.Add(z)}for(var K=0;K<this.RD3Events.Count();K++){var D=this.RD3Events[K];var H=D.Send(R,I);if(D.Name.equals("error")&&H!=null){this.ErrObj.Render3(H)}}for(var K=0;K<this.RD3Tooltips.Count();K++){var g=this.RD3Tooltips[K];g.Send(R,I)}for(var K=0;K<this.RD3CliExecute.Count();K++){var M=this.RD3CliExecute[K];if(M.length==0||M.charAt(0)=="!"){continue}var a=R.AddNewElement("exe");a.SetAttribute("cmd",M)}if(this.SendDebug){var d=R.AddNewElement("dbg");if(this.DebugWindow!=""){d.SetAttribute("main",this.DebugWindow)}if(this.DebugItemList!=""){d.SetAttribute("ItemList",this.DebugItemList)}if(this.DebugCmdForm!=""){d.SetAttribute("CmdForm",this.DebugCmdForm)}if(this.DebugDetail!=""){d.SetAttribute("Detail",this.DebugDetail)}if(this.DebugReqTop!=""){d.SetAttribute("ReqTop",this.DebugReqTop)}if(this.DebugReqRef!=""){d.SetAttribute("ReqRef",this.DebugReqRef)}if(this.DebugReqPrc!=""){d.SetAttribute("ReqPrc",this.DebugReqPrc)}if(this.Request.SESSNAME!=null){d.SetAttribute("SESS",this.Request.SESSNAME)}this.DebugWindow="";this.DebugItemList="";this.DebugCmdForm="";this.DebugDetail="";this.DebugReqTop="";this.DebugReqRef="";this.DebugReqPrc="";this.SendDebug=false}this.RD3CliExecute.Clear();this.VoiceCommandExecuted=false;this.VoiceObj.VoiceCommandExecuted=false};WebEntryPointSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.WEP_CAPTION:c.SetAttribute("cap",this.iCaption.stringValue());break;case RD3Glb.WEP_WELCOME:c.SetAttribute("wel",this.iWelcomeURL);break;case RD3Glb.WEP_MENUTYPE:c.SetAttribute("met",this.MenuType.toString());break;case RD3Glb.WEP_REFRESHINT:var d=this.RefreshInterval().intValue();switch(d){case -1:d=0;break;case 0:d=20;break;default:d=d*1000;break}c.SetAttribute("rfi",d+"");break;case RD3Glb.WEP_REFRESHLOC:c.SetAttribute("rlo",this.RefreshLocation().stringValue());break;case RD3Glb.WEP_DEVICEMOTION:c.SetAttribute("mth",this.iAccelMotionThreshold.stringValue()+"|"+this.iRotMotionThreshold.stringValue());break;case RD3Glb.WEP_WIDGETMODE:if(!this.WidgetMode&&b){break}c.SetAttribute("wid",this.WidgetMode?"1":"0");break;case RD3Glb.WEP_ACTIVEFORM:if(this.ActiveForm()==null&&b){break}c.SetAttribute("act",(this.ActiveForm()!=null)?this.ActiveForm().GetRD3Ident():"");break;case RD3Glb.WEP_USEDECIMALDOT:if(!this.ParamsObj().UseDecimalDot&&b){break}c.SetAttribute("dec",this.ParamsObj().UseDecimalDot?"1":"0");break;case RD3Glb.WEP_DEBUGTYPE:var e=0;if(this.DTTObj.Level>0&&!this.DTTObj.TraceEnabled){e=1}if(this.DTTObj.HelpEnabled&&!this.DTTObj.TraceEnabled&&this.DTTObj.CanSendHelpMail(false)){e=2}if(e==0&&b){break}c.SetAttribute("dbi",e.toString());break;case RD3Glb.WEP_HELPFILE:if(this.ActiveHelpFile().length==0&&b){break}c.SetAttribute("hlp",this.ActiveHelpFile());break;case RD3Glb.WEP_IMAGE:if(this.iImage.length==0&&b){break}c.SetAttribute("img",this.iImage);break;case RD3Glb.WEP_CMDPROMPT:break;case RD3Glb.WEP_ENTRYPOINT:c.SetAttribute("ent",this.RD3EntryPoint);break;case RD3Glb.WEP_ENABLEGFX:if(this.ParamsObj().EnableGFX&&b){break}c.SetAttribute("ena",this.ParamsObj().EnableGFX?"1":"0");break;case RD3Glb.WEP_ENABLESND:if(this.ParamsObj().EnableSound&&b){break}c.SetAttribute("snd",this.ParamsObj().EnableSound?"1":"0");break;case RD3Glb.WEP_SHOWLOGOFF:if(!this.iLogoffURL.equals("")&&b){break}c.SetAttribute("shl",this.iLogoffURL.equals("")?"0":"1");break;case RD3Glb.WEP_MENUWIDTH:if(this.iSideMenuWidth==160&&b){break}c.SetAttribute("smw",this.iSideMenuWidth.toString());break;case RD3Glb.WEP_ACCENTCOLOR:if(this.iAccentColor==12747008&&b){break}c.SetAttribute("acc","rgb("+(this.iAccentColor&255)+", "+((this.iAccentColor&65280)>>8)+", "+((this.iAccentColor&16711680)>>16)+")");break;case RD3Glb.WEP_VISPROP:if(this.iVisualFlags==3839&&b){break}c.SetAttribute("vfl",this.iVisualFlags.toString());break;case RD3Glb.WEP_SECCOLOR:if(this.iSecondaryColor==6609714&&b){break}c.SetAttribute("scl","rgb("+(this.iSecondaryColor&255)+", "+((this.iSecondaryColor&65280)>>8)+", "+((this.iSecondaryColor&16711680)>>16)+")");break;case RD3Glb.WEP_DANGERCOLOR:if(this.iDangerColor==4013557&&b){break}c.SetAttribute("dcl","rgb("+(this.iDangerColor&255)+", "+((this.iDangerColor&65280)>>8)+", "+((this.iDangerColor&16711680)>>16)+")");break;case RD3Glb.WEP_LIGHTCOLOR:if(this.iLightColor==16053492&&b){break}c.SetAttribute("lcl","rgb("+(this.iLightColor&255)+", "+((this.iLightColor&65280)>>8)+", "+((this.iLightColor&16711680)>>16)+")");break;case RD3Glb.WEP_DARKCOLOR:if(this.iDarkColor==2236962&&b){break}c.SetAttribute("dcd","rgb("+(this.iDarkColor&255)+", "+((this.iDarkColor&65280)>>8)+", "+((this.iDarkColor&16711680)>>16)+")");break;case RD3Glb.WEP_BRIGHTCOLOR:if(this.iBrightColor==2474495&&b){break}c.SetAttribute("bcl","rgb("+(this.iBrightColor&255)+", "+((this.iBrightColor&65280)>>8)+", "+((this.iBrightColor&16711680)>>16)+")");break;case RD3Glb.WEP_VIBRANTCOLOR:if(this.iVibrantColor==10040166&&b){break}c.SetAttribute("vcl","rgb("+(this.iVibrantColor&255)+", "+((this.iVibrantColor&65280)>>8)+", "+((this.iVibrantColor&16711680)>>16)+")");break;case RD3Glb.WEP_RTCRESET:if(b){break}c.SetAttribute("lan",this.GetAppLanguage());c.SetAttribute("par","1");this.RD3ServerParams(c);break}};WebEntryPointSrv.prototype.ShowDesktop=function(){};WebEntryPointSrv.prototype.OnBrowserMessage=function(c,b,a){this.DispatchToComp("OnBrowserMessage",new Array(c,b,a))};WebEntryPointSrv.prototype.OnException=function(g,c,f,a,e,d,b){this.DispatchToComp("OnException",new Array(g,c,f,a,e,d,b))};WebEntryPointSrv.prototype.IWRD3_UserEvent=function(a){if(a.length>0&&a.toUpperCase().equals("SW")){return}if(a.length>0&&a.toUpperCase().equals("GZ")){return}if(a.length>0&&a.toUpperCase().equals("IMG")){this.RenderAllImages(false);return}if(!this.RolObj.CheckRole()){this.RD3Reset();this.RenderPage();return}var r=this.GetRequestBody();if(this.BrowserSubClass==Glb.BRWSCL_OPERA){}for(var L=0;L<r.length;L++){var x=r.charCodeAt(L);if(!(x==9||x==10||x==13||(x>=32&x<=55295)||(x>=57344&&x<=65533))){r=r.remove(L,1)}}var B=new XMLDoc();B.LoadFromString(r);var s=B.GetNextNode();if(s!=null&&s.Name().equals("xml")){if(B.HasNextNode()){s=B.GetNextNode()}else{s=null}}if(s==null){this.RD3Reset();this.RenderPage();return}var g=parseInt(s.GetAttribute("num"),10);if(!isNaN(g)){if(g<this.RD3LastRequest){var t=s.GetNode();var F=t.getOwnerDocument();var J=null;var P=F.getElementsByTagName("start");if(P.length>0){J=P[0]}if(J==null){this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",200,"MainFrm.IWRD3_UserEvent","Request number "+g+" is arrived after request number "+this.RD3LastRequest+" : Skipping request");this.RenderPage();return}}else{if(this.RD3LastRequest==0&&g>1){this.RD3Reset();this.RenderPage();return}}this.RD3LastRequest=g}else{if(s.GetAttribute("num")!="owa"){this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",100,"MainFrm.IWRD3_UserEvent","Request number not found");this.RD3Reset();this.RenderPage();return}}var d=s.GetNode();var E=d.getOwnerDocument().getElementsByTagName("keypress");if(E.length>0){var I=d.getOwnerDocument().getElementsByTagName("chg");if(I.length>0){var D=I[I.length-1];var G=D;for(var L=0;L<E.length;L++){d.insertAfter(E[L],G);G=E[L]}s.Reset()}}var e=new ArrayList();if(this.ActiveForm()!=null){e.Add(this.ActiveForm());this.ActiveForm().GetSubForm(e)}for(var L=0;L<this.StackForm.Count();L++){var M=this.StackForm[L];if(M.Docked){e.Add(M);M.GetSubForm(e)}}for(var L=0;L<e.Count();L++){var M=e[L];M.FocusPriority=0}this.RD3StartRequest();if(this.hasConfirm()){var t=s.GetNode();var F=t.getOwnerDocument();var J=null;var P=F.getElementsByTagName("msgcfr");if(P.length>0){J=P[0]}if(J==null){P=F.getElementsByTagName("start");if(P.length>0){J=P[0]}}if(J!=null){if(t.getFirstChild()!=J){t.insertBefore(J,t.getFirstChild())}var k=J;for(var L=0;L<this.confirmNodes.Count();L++){var c=this.confirmNodes[L].GetNode();t.insertAfter(c,k);k=c}s.Reset();this.set_hasConfirm(false);this.confirmNodes.Clear()}else{var t=s.GetNode();var F=t.getOwnerDocument();var J=null;var P=F.getElementsByTagName("refresh");if(P.length>0){J=P[0]}if(J!=null){this.set_hasConfirm(false);this.confirmNodes.Clear()}}}this.RD3PanRevalidate=false;var O=true;while(s.HasNextNode()){var q=s.GetNextNode();var A=true;if(this.hasConfirm()){this.confirmNodes.Add(q);continue}this.set_ShiftKey(q.GetAttribute("shp")=="-1");this.set_CtrlKey(q.GetAttribute("ctp")=="-1");this.set_AltKey(q.GetAttribute("atp")=="-1");var o=q.GetAttribute("ace");if(o!=null&&o.length>0){var m=this.RD3FindField(o);if(m!=null){var M=m.Parent.Parent;if(M.FocusPriority==0){M.ActiveElement="F"+m.Parent.FrIndex+"C"+m.Index+"R0"}}else{var u=this.FindWebFrame(o);if(u!=null&&(u instanceof IDPanelSrv)){var M=u.Parent;M.ActiveElement="F"+u.FrIndex+"C0R0"}}}if(this.RD3PanRevalidate&&!q.Name().equals("chg")){var l=new ArrayList();var v=true;while(v){v=false;var C=this.GetLiveForms();for(var y=0;y<C.Count();y++){var M=C[y];if(l.Contains(M)){continue}l.Add(M);v=true;for(var L=0;L<M.Frames.length;L++){var H=(M.Frames[L]!=null?M.Frames[L].Content:null);if(H!=null&&H instanceof IDPanelSrv){H.RD3EndRequest()}}}}this.RD3PanRevalidate=false}var b=q.Name();var h=new IDVariant();this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",400,"MainFrm.OnBrowserMessage","Firing OnBrowserMessage event");this.DTTObj.AddParameter("","","Message",new IDVariant(b));this.DTTObj.AddParameter("","","Node",q);this.OnBrowserMessage(new IDVariant(b),q,h);if(h.isTrue()){continue}switch(b){case"start":A=this.HandleStartEvent();break;case"refresh":A=this.HandleRefreshEvent();break;case"chg":A=this.HandleChgEvent(q);break;case"clk":A=this.HandleClkEvent(q);break;case"close":A=this.HandleFormCloseEvent(q);break;case"confirm":A=this.HandleFormConfirmEvent(q);break;case"timer":A=this.HandleTimerEvent(q);break;case"trnexp":A=this.HandleExpansionEvent(q);break;case"flclk":A=this.HandleFlClkEvent(q);break;case"claclk":A=this.HandleCloseAllEvent(q);break;case"col":A=this.HandleCollapseEvent(q);break;case"btb":A=this.HandleButtonBarEvent(q);break;case"panscr":A=this.HandlePanelScrollEvent(q);break;case"graclk":A=this.HandleGraphClick(q);break;case"pdfprint":A=this.HandlePdfPrint(q);break;case"tab":A=this.HandleTabClick(q);break;case"drp":A=this.HandleDrop(q);break;case"trasf":A=this.HandleTransform(q);break;case"rclk":A=this.HandleTreeRightClkEvent(q);break;case"booktb":A=this.HandleBookToolbarEvent(q);break;case"pantb":A=this.HandlePanelToolbarEvent(q);break;case"srcbox":A=this.HandleSearchBox(q);break;case"more":A=this.HandlePanelMoreRows(q);break;case"panpg":A=this.HandlePageClick(q);break;case"panrs":A=this.HandlePanelRowSelector(q);break;case"panms":A=this.HandlePanelMultiSel(q);break;case"chgrow":A=this.HandlePanelChangeRow(q);break;case"msgcfr":A=this.HandleMessageConfirm(q);break;case"resize":A=this.HandleResize(q);break;case"cmd":A=this.HandleCommand(q);break;case"repos":A=this.HandleRepositioning(q);break;case"chgwst":A=this.HandleChangeWindowState(q);break;case"rawclk":A=this.HandleRawClick(q);break;case"sound":A=this.HandleSound(q);break;case"rdcol":A=this.HandleReorderColumn(q);break;case"rescol":A=this.HandleResizeColumn(q);break;case"gdd":A=this.HandleGenericDragDrop(q);break;case"grlexp":A=this.HandleExpandListGroup(q);break;case"grpcol":A=this.HandleGroupCollapseEvent(q);break;case"txtsel":A=this.HandleTextSelection(q);break;case"fev":A=this.HandleClientFocus(q);break;case"keypress":A=this.HandleKeyPress(q);break;case"chgloc":A=this.HandleChangeLocation(q);break;case"chgmot":A=this.HandleDeviceMotion(q);break;case"menures":A=this.HandleSideMenuResize(q);break;case"IWDTT":A=this.HandleDTT(q);break;case"IWUpload":A=this.HandleIWUpload(q);break;case"IWBlob":A=this.HandleIWBlob(q);break;case"IWFiles":A=this.HandleIWFiles(q);break;case"SYNC":A=this.HandleSYNC(q);break;case"voice":A=this.HandleVoice(q);break;case"sczsel":A=this.HandleScreenZoneSel(q);break;case"graopt":A=this.HandleGraphOptions(q);break;case"qbeset":A=this.HandleListQBE(q);break;case"qbecombo":A=this.HandleListQBECombo(q);break;case"qbeclall":A=this.HandleClearAllListQBE(q);break;case"moev":A=this.HandleClientMouseOver(q);break;case"fldlistvis":A=this.HandleFieldListShow(q);break;case"cseev":A=this.HandleCustomElementEvent(q);break;case"rfi":continue}O&=A;this.EatNextMessage=false;if(this.ShouldEatNextMessage){this.EatNextMessage=true;this.ShouldEatNextMessage=false}this.UpdateIMDBState();if(this.hasConfirm()){this.confirmNodes.Add(q)}}while(this.RefreshLookups.Count()>0){var z=this.RefreshLookups[0];var N=z.split("|");var j=N[0].length>0?N[0]:null;var K=N[1].length>0?N[1]:null;this.RefreshAllLookups(j,K,false)}this.RD3EndRequest();if(O){this.RenderPage()}else{this.IWRD_UserEvent("")}};WebEntryPointSrv.prototype.RenderDifferences3=function(){var b=new XMLDoc();var a=b.AddNewElement("rd3");this.RD3RenderDifferences(a,this.RD3CreateFullTree);this.Response.responseXML=b.SaveToString();if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){WriteToConsoleOutput("RD3response = "+this.Response.responseXML)}this.RD3CreateFullTree=false;this.RD3Events.Clear();if(this.BrowserInfo()==2){this.LastRD3Reply=b.SaveToString()}};WebEntryPointSrv.prototype.HandleStartEvent=function(){this.RD3CreateFullTree=true;return true};WebEntryPointSrv.prototype.HandleRefreshEvent=function(){return true};WebEntryPointSrv.prototype.HandleChgEvent=function(k){var c=k.GetAttribute("oid");var g=k.GetAttribute("par1");var m=0,j=0;while(m!=-1){m=g.indexOf("&#",j);j=(m!=-1?g.indexOf(";",m):-1);if(m!=-1&&j!=-1){var a=g.substring(m+2,j);var d=a.indexOf("-");if(d!=-1){var l=parseInt(a.substring(0,d));var f=parseInt(a.substring(d+1));if(l>=55296){g=g.substring(0,m)+String.fromCharCode(l,f)+g.substring(j+1);j=m+1}}}}if(c.startsWith("spn")){var b=this.RD3FindSpan(c);if(b!=null){b.ProcessRequest(new IDVariant(g))}}if(c.startsWith("trn")){var m=c.indexOf(":");var j=c.indexOf(":",m+1);if(m>-1&&j>-1){var h=c.substr(m+1,j-m-1);var n=this.FindWebFrame(c.substr(j));if(n!=null){n.RD3SelectNode(h,g=="on")}}}if(c.startsWith("val")){var m=c.indexOf(":");var j=c.indexOf(":",m+1);var e=c.indexOf(":",j+1);if(m>-1&&j>-1&&e>-1){var d=this.FindWebFrame(c.substr(e));if(d!=null){d.RD3ValChange(c,g);this.RD3PanRevalidate=true}}}return true};WebEntryPointSrv.prototype.HandleGenericDragDrop=function(e){var b=e.GetAttribute("oid");var d=e.GetAttribute("obn");var f=this.FindWebFrame(d);if(f==null){f=this.RD3FindCommand(d)}var g=this.FindWebFrame(b);if(g==null){g=this.RD3FindCommand(b)}if(f!=null&&g!=null){if(f instanceof ACommandSrv){this.CmdObj.GenericDrag(e,f,g)}if(f instanceof WebFrameSrv){var c=f;if(d.startsWith("tab")&&c.Parent!=null&&c.FrIndex>-1&&c.Parent.Frames[c.FrIndex].InTabbed&&c.Parent.Frames[c.Parent.Frames[c.FrIndex].TabIdx]!=null){var a=c.Parent.Frames[c.Parent.Frames[c.FrIndex].TabIdx].Content;a.GenericDrag(e,g)}else{c.GenericDrag(e,g)}}}return true};WebEntryPointSrv.prototype.HandleClkEvent=function(j){if(this.EatNextMessage){return true}var r=j.GetAttribute("oid");var g=j.GetAttribute("obn");var m=j.GetAttribute("par1");var q=j.GetAttribute("xck");var t=j.GetAttribute("yck");if(r.startsWith("fld")&&m.equals("cap")){var e=r.indexOf(":");var b=r.indexOf(":",e+1);var o=r.substr(e+1,b-e-1);var n=parseInt(o,10);var s=this.FindWebFrame(r.substr(b));if(s!=null){var v=parseInt(t,10);s.RD3Sort(n,v)}return true}else{if(r.startsWith("box:")){var k=this.RD3FindBox(r);if(k!=null){k.RD3Activate()}return true}else{if(r.equals("cloapp")){this.IWLogoff_UserEvent("");return true}else{if(r.equals("cmh.con")){this.IWMenu_UserEvent("CON");return true}else{if(r.equals("cmh.exp")){this.IWMenu_UserEvent("EXP");return true}else{if(r.startsWith("cmd:")){for(var u=0;u<this.CmdObj.CmdLin.length;u++){var y=this.CmdObj.CmdLin[u];if(y==null){continue}if(r.equals(y.GetRD3Ident())){this.IWMenu_UserEvent("M"+y.Index);return true}}}else{if(r.startsWith("cms:")){for(var u=0;u<this.CmdObj.CmdSets.length;u++){var y=this.CmdObj.CmdSets[u];if(y==null){continue}if(r.equals(y.GetRD3Ident())){if(this.MenuType==Glb.MENUTYPE_MENUBAR){this.CmdObj.FireOnOpenPopup(y.Index,0,new IDVariant(1),new IDVariant())}else{this.IWMenu_UserEvent("S"+y.Index)}return true}}}else{if(r.startsWith("ind:")){for(var u=1;u<this.IndObj.Indicators.length;u++){if(this.IndObj.Indicators[u]==null){continue}if(r.equals(this.IndObj.Indicators[u].GetRD3Ident())){this.IWSbInd_UserEvent(this.IndObj.Indicators[u].Code);return true}}}else{if(r.startsWith("trn:")){var h=this.RD3FindNode(r);if(h!=null){var d=h.TreeObj;var x=d.Parent;var e=r.indexOf(":");var b=r.indexOf(":",e+1);var l=r.substr(e+1,b-e-1);x.TreeClick(this,IDL.Format(new IDVariant(d.FrIndex),new IDVariant("00"),this).stringValue()+l)}return true}else{if(r.startsWith("val:")){var e=r.indexOf(":");var b=r.indexOf(":",e+1);var a=r.indexOf(":",b+1);if(e>-1&&b>-1&&a>-1){var s=this.FindWebFrame(r.substr(a));if(s!=null){s.RD3ValClick(r)}}return true}}}}}}}}}}this.set_AlertMessage(new IDVariant("Click &lt;"+r+"&gt; non riconosciuto"));return true};WebEntryPointSrv.prototype.HandleRawClick=function(d){var a=d.GetAttribute("oid");var k=d.GetAttribute("obn")!="0"&&d.GetAttribute("obn").toLowerCase()!="false";var c=parseInt(d.GetAttribute("par1"),10);var b=d.GetAttribute("par2").indexOf("-");var l=parseInt(d.GetAttribute("par2").substr(0,b),10);var g=parseInt(d.GetAttribute("par2").substr(b+1),10);b=d.GetAttribute("par3").indexOf("-");var j=parseInt(d.GetAttribute("par3").substr(0,b),10);var h=parseInt(d.GetAttribute("par3").substr(b+1),10);var e=this.FindWebFrame(a);if(e!=null){this.ShouldEatNextMessage=e.RD3RawClick(c,j,h,l,g,k,d)}return true};WebEntryPointSrv.prototype.HandleSound=function(c){var a=c.GetAttribute("oid");var d=c.GetAttribute("obn");if(d.equals("finish")){this.DTTObj.SetRequestName("Media Finish","Media Finish",DTTRequest.PRI_ITEM);this.OnMediaFinish(new IDVariant(a))}if(d.equals("progress")){this.DTTObj.SetRequestName("Media Progress","Media Progress",DTTRequest.PRI_ITEM);var e=parseInt(c.GetAttribute("par1"),10);var b=parseInt(c.GetAttribute("par2"),10);this.OnMediaProgress(new IDVariant(a),new IDVariant(e),new IDVariant(b))}return true};WebEntryPointSrv.prototype.OnMediaFinish=function(a){this.DispatchToComp("OnMediaFinish",new Array(a))};WebEntryPointSrv.prototype.OnMediaProgress=function(a,c,b){this.DispatchToComp("OnMediaProgress",new Array(a,c,b))};WebEntryPointSrv.prototype.HandleReorderColumn=function(c){var e=c.GetAttribute("oid");var b=c.GetAttribute("par1");var a=c.GetAttribute("par2");var d=this.FindWebFrame(e);if(d!=null){d.RD3ReorderColumn(b,a)}return true};WebEntryPointSrv.prototype.HandleResizeColumn=function(a){var d=a.GetAttribute("oid");var c=parseInt(a.GetAttribute("par1"),10);var b=this.RD3FindField(d);if(b!=null){b.Parent.RD3ResizeColumn(b.Index,c)}return true};WebEntryPointSrv.prototype.HandleChangeLocation=function(c){var a=c.GetAttribute("obn");var b=c.GetAttribute("par1");var d=new IDLocation();d.init(a,b);this.OnChangeLocation(d);return true};WebEntryPointSrv.prototype.HandleDeviceMotion=function(b){var a=b.GetAttribute("par1");var c=new IDDeviceMotion();c.init(a);this.OnDeviceMotion(c);return true};WebEntryPointSrv.prototype.HandleSideMenuResize=function(a){var b=parseInt(a.GetAttribute("obn"),10);if(!isNaN(b)){iSideMenuWidth=b}return true};WebEntryPointSrv.prototype.HandleDTT=function(c){var a=c.GetAttribute("oid");var b=c.GetAttribute("obn");if(b!=""&&b!=undefined){this.Request.SESSNAME=b}this.IWDTT_UserEvent(a,c);return true};WebEntryPointSrv.prototype.HandleExpansionEvent=function(g){var b=g.GetAttribute("oid");var k=b.indexOf(":");var j=b.indexOf(":",k+1);var c=b.substr(k+1,j-k-1);k=j;j=b.indexOf(":",k+1);var a=b.substr(k+1,j-k-1);if(a.length==1){a="0"+a}var d=b.substr(j+1);var h=a+c;var e=this.FindWebForm("frm:"+d);if(e!=null){e.TreeExpand(this,h)}return true};WebEntryPointSrv.prototype.HandleFlClkEvent=function(b){var c=b.GetAttribute("oid");var a=this.FindWebForm(c);if(a!=null){this.DTTObj.AddTestItem(a.RTCGuid,DTTEngine.TST_FRMSELECT,"Select form","","sel");this.DTTObj.AddHelpItem(0,0,0,0,"Attiva la videata "+a.Caption());this.BringToFront(a.FormIdx)}return true};WebEntryPointSrv.prototype.HandleFormCloseEvent=function(a){var c=a.GetAttribute("oid");var b=this.FindWebForm(c);if(b!=null){b.RD3Close(false)}return true};WebEntryPointSrv.prototype.HandleFormConfirmEvent=function(a){var c=a.GetAttribute("oid");var b=this.FindWebForm(c);if(b!=null){b.RD3Close(true)}return true};WebEntryPointSrv.prototype.HandleCloseAllEvent=function(g){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",151,"MainFrm.IWFormList","Close All command detected");this.DTTObj.SetRequestName("Close All","Close All",DTTRequest.PRI_CMD);this.DTTObj.AddTestItem("XX",DTTEngine.TST_CLOSEALL,"Main close all","");this.DTTObj.AddHelpItem(0,0,0,0,"Chiudi tutte le videate");var j=new ArrayList(this.StackForm);for(var d=0;d<j.Count();d++){var h=j[d];if(!h.Docked){this.UnloadForm(h.FormIdx,false)}var b=false;for(var a=0;a<this.RD3Events.length&&!b;a++){var e=this.RD3Events[a];if(e.Name=="msgbox"&&e.Ident==IDL.FormatMessage(new IDVariant(this.RTCObj.GetConst("46C4490C-6369-4da4-ACE1-2AFDF7D9A877","Salvare le modifiche alla videata <b>|1</b>?")),h.Caption()).stringValue()){b=true}}if(b){break}}return true};WebEntryPointSrv.prototype.HandlePanelScrollEvent=function(b){var a=parseInt(b.GetAttribute("par1"),10);if(!isNaN(a)){var c=this.FindWebFrame(b.GetAttribute("oid"));if(c!=null){c.RD3Scroll(a)}}return true};WebEntryPointSrv.prototype.HandleTimerEvent=function(c){var e=c.GetAttribute("oid");var d=e.lastIndexOf(":");var a=parseInt(e.substr(d+1),10);if(a<this.TimerObj.Timers.length){var b=this.TimerObj.Timers[a];if(b!=null){b.RD3Tick(this)}}return true};WebEntryPointSrv.prototype.HandleCollapseEvent=function(d){var e=d.GetAttribute("oid");var a=d.GetAttribute("obn");var c=this.FindWebFrame(e);if(c!=null){var b=c.Collapsed;c.set_Collapsed(a.equals("col"));if(c.Collapsed==b&&c.CollapseClickEventDef==RD3Glb.EVENT_ACTIVE){c.RD3FrameChange(RD3Glb.WFR_COLLAPSED)}}return true};WebEntryPointSrv.prototype.HandleButtonBarEvent=function(b){var c=b.GetAttribute("obn");var d=c.indexOf(":");var a=parseInt(c.substr(4),10);if(a>0){this.CmdObj.CmdClick(a)}return true};WebEntryPointSrv.prototype.HandlePdfPrint=function(c){var d=c.GetAttribute("oid");for(var a=0;a<this.PDFPrints.Count();a++){var b=this.PDFPrints[a];if(b.PDFFile==d){b.Printed=true;if(b.AutoDelete){}this.PDFPrints.Remove(b);break}}return true};WebEntryPointSrv.prototype.HandleGraphClick=function(e){if(this.EatNextMessage){return true}var j=e.GetAttribute("oid");var a=e.GetAttribute("obn");if(j.startsWith("box")){var d=this.RD3FindBox(j);if(d!=null){d.RD3GraphClick(a)}}else{var c=this.FindWebFrame(j);if(c!=null){var b=c.FrIndex.toString();if(b.length==1){b="0"+b}b+=a;var h=c.Parent;h.GraphClick(this,b)}}return true};WebEntryPointSrv.prototype.HandleGraphOptions=function(h){var k=h.GetAttribute("oid");var a=h.GetAttribute("obn");var c=h.GetAttribute("par1");var e=this.FindWebFrame(k);if(e!=null){e.set_GraphOptions(a,true);var d=e.getChartTypeCode(c);if(d!=-1){e.set_ChartType(d,true)}var b=new IDVariant(a);var j=e.Parent;j.OnGraphOptions(e,b)}return true};WebEntryPointSrv.prototype.HandleListQBE=function(c){var e=c.GetAttribute("oid");var b=c.GetAttribute("obn");var a=c.GetAttribute("par1");var d=this.RD3FindField(e);if(d!=null){d.Parent.RD3ListQBE(d.Index,a)}return true};WebEntryPointSrv.prototype.HandleClearAllListQBE=function(b){var d=b.GetAttribute("oid");var a=b.GetAttribute("obn");var c=this.FindWebFrame(d);if(c!=null){c.RD3ClearAllListQBE()}return true};WebEntryPointSrv.prototype.HandleListQBECombo=function(b){var e=b.GetAttribute("oid");var d=b.GetAttribute("obn");var a=b.GetAttribute("par1");var c=this.RD3FindField(e);if(c!=null){c.ExecuteLISTQBECombo(a,d)}return true};WebEntryPointSrv.prototype.HandleTabClick=function(c){if(this.EatNextMessage){return true}var a=c.GetAttribute("obn");var d=c.GetAttribute("oid");var b=this.FindWebFrame(a);if(b!=null){b.RD3SelectTab(d)}return true};WebEntryPointSrv.prototype.HandleDrop=function(b){var g=b.GetAttribute("oid");var e=b.GetAttribute("obn");if(g.startsWith("trn:")){var a=this.RD3FindNode(e);var c=this.RD3FindNode(g);this.TreeDropHelper(a,c,this.ShiftKey(),this.AltKey(),this.CtrlKey())}else{if(g.startsWith("box:")){var d=this.RD3FindBox(e);var f=this.RD3FindBox(g);if(d!=null&&f!=null){this.DTTObj.SetRequestName("Box Drop","Box Drop",DTTRequest.PRI_CMD);f.RD3Drop(d)}}}return true};WebEntryPointSrv.prototype.HandleTransform=function(a){var k=a.GetAttribute("oid");var b=a.GetAttribute("par1");var o=a.GetAttribute("par2");var g=a.GetAttribute("par3");var n=a.GetAttribute("par4");try{var l=parseFloat(b);var j=parseFloat(o);var m=parseFloat(g);var d=parseFloat(n);var c=this.RD3FindBox(k);if(c!=null){this.DTTObj.SetRequestName("Box Transform","Box Transform",DTTRequest.PRI_CMD);c.RD3Transform(l,j,m,d)}}catch(f){}return true};WebEntryPointSrv.prototype.HandleTreeRightClkEvent=function(c){if(this.EatNextMessage){return true}var b=c.GetAttribute("oid");var d=c.GetAttribute("par1");var k=0;var n=b.indexOf(":");var l=b.indexOf(":",n+1);var a=b.substr(n+1,l-n-1);var m=this.RD3FindNode(b);var j=m.TreeObj;var g=j.Parent;for(var e=0;e<this.CmdObj.CmdSets.length;e++){var h=this.CmdObj.CmdSets[e];if(h!=null&&h.GetRD3Ident()==d){k=h.Index;break}}g.TreeClick(this,IDL.Format(new IDVariant(j.FrIndex),new IDVariant("00"),this).stringValue()+a);if(k>0){this.CmdObj.ShowPopup(k,b,g.FormIdx,1)}return true};WebEntryPointSrv.prototype.HandleBookToolbarEvent=function(d){var f=d.GetAttribute("oid");var e=d.GetAttribute("obn");var c=parseInt(d.GetAttribute("par1"));var a=this.FindWebFrame(f);if(a!=null){a.RD3ToolbarHandler(e,c)}return true};WebEntryPointSrv.prototype.HandlePanelToolbarEvent=function(a){var d=a.GetAttribute("oid");var b=a.GetAttribute("obn");var c=this.FindWebFrame(d);if(c!=null){c.RD3PanelCommand(b)}return true};WebEntryPointSrv.prototype.HandleSearchBox=function(b){var d=b.GetAttribute("oid");var a=b.GetAttribute("obn");var c=this.FindWebFrame(d);if(c!=null){c.OnSearchBox(a)}return true};WebEntryPointSrv.prototype.HandlePanelMoreRows=function(a){var c=a.GetAttribute("oid");var b=this.FindWebFrame(c);if(b!=null){b.RD3MoreRows()}return true};WebEntryPointSrv.prototype.HandlePanelRowSelector=function(b){if(this.EatNextMessage){return true}var e=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("obn"),10);var a=parseInt(b.GetAttribute("par1"),10);var c=this.FindWebFrame(e);if(c!=null){c.RD3RowSel(d,a)}return true};WebEntryPointSrv.prototype.HandlePanelMultiSel=function(b){var e=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("obn"),10);var a=b.GetAttribute("par1")=="-1";var c=this.FindWebFrame(e);if(c!=null){c.RD3MultiSel(d,a)}return true};WebEntryPointSrv.prototype.HandleFieldListShow=function(a){var c=a.GetAttribute("oid");var e=a.GetAttribute("par1")=="-1";var b=this.RD3FindField(c);var d=null;if(b!=null){d=b.Parent}if(d!=null){d.RD3FldChangedShowList(b,e)}return true};WebEntryPointSrv.prototype.HandlePanelChangeRow=function(b){var e=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("par1"),10);var a=parseInt(b.GetAttribute("par2"),10);var c=this.FindWebFrame(e);if(c!=null){c.RD3ChangeRow(d,a)}return true};WebEntryPointSrv.prototype.HandlePageClick=function(b){var a=b.GetAttribute("obn");var d=b.GetAttribute("oid");var c=this.FindWebFrame(a);if(c!=null){c.RD3SelectPage(d)}return true};WebEntryPointSrv.prototype.HandleMessageConfirm=function(b){var c=b.GetAttribute("obn");c=c.replace(/\r\n/g,"\n");c=c.replace(/\r/g,"\n");var a=b.GetAttribute("par1");this.DTTObj.SetRequestName("User Response ("+(a.length>6?a.substr(6)+"...":a)+")","User has answered "+a,DTTRequest.PRI_CMD);this.ConfStack[c]=a;this.set_AlertType(0);return true};WebEntryPointSrv.prototype.HandleResize=function(c){var a=c.GetAttribute("oid");var q=c.GetAttribute("obn");var n=parseInt(c.GetAttribute("par1"),10);var g=parseInt(c.GetAttribute("par2"),10);if(a.equals("wep")){try{var b=parseInt(c.GetAttribute("par3"),10);var m=parseInt(c.GetAttribute("par4"),10);var o=parseInt(c.GetAttribute("par5"),10);var d=parseInt(c.GetAttribute("par6"),10);this.set_ScreenHeight(d);this.set_ScreenWidth(o);this.set_MDILeft(b);this.set_MDITop(m)}catch(l){}this.set_ScreenW(n);this.set_ScreenH(g);this.OnWepResize();return true}if(a.startsWith("frm")){var k=this.FindWebForm(a);if(k!=null){k.RD3Resize(new IDVariant(n),new IDVariant(g),false)}return true}if(a.startsWith("fld")){var k=this.RD3FindField(a);if(k!=null){k.RD3Resize(c)}return true}var j=this.FindWebFrame(a);if(j!=null){j.RD3Resize(n,g,q);return true}return true};WebEntryPointSrv.prototype.HandleRepositioning=function(c){var e=c.GetAttribute("oid");var a=parseInt(c.GetAttribute("par1"),10);var b=parseInt(c.GetAttribute("par2"),10);if(e.startsWith("frm")){var d=this.FindWebForm(e);if(d!=null){d.RD3Reposition(new IDVariant(a),new IDVariant(b),false)}return true}return true};WebEntryPointSrv.prototype.HandleChangeWindowState=function(b){var d=b.GetAttribute("oid");var a=parseInt(b.GetAttribute("par1"),10);if(d.startsWith("frm")){var c=this.FindWebForm(d);if(c!=null){c.RD3ChangeWindowState(new IDVariant(a))}return true}return true};WebEntryPointSrv.prototype.HandleCommand=function(c){var d=c;if(c instanceof XMLNode){d=c.GetAttribute("obn");if(d.startsWith("OAUTH")){this.HandleIWOAuth(c);return true}this.ExtractUrlParams2("CMD="+d.replace(/\+/g,"%2b"));d=this.GetUrlParam().stringValue();this.HandleCommand(d);return true}this.DTTObj.SetRequestName("Command "+d,"Query String Command Detected",DTTRequest.PRI_DATA);var b=this.RolObj.CheckRole();var a=false;if(b){a=this.CmdObj.ExecCmdCode(d)}if(!b||!a){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",152,"MainFrm.BeginRequest","Fire OnCommand("+d+") event");this.OnCommand(new IDVariant(d));if(!b&&this.RolObj.CheckRole()){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",114,"OnCommand","Bypass login (Session Role set while handling a command)");this.FireAfterLogin()}}switch(d){case"?IDVER":this.DumpVersions(true);break;case"?DEBUG":this.OpenDebugWindow();break;case"?DTTOK":this.DTTObj.DTTStarted=true;this.set_AlertMessage(new IDVariant("DTT Started"));break;case"?DTTKO":this.DTTObj.DTTStarted=false;this.set_AlertMessage(new IDVariant("DTT Stopped"));break;case"FLUID+":this.ParamsObj().UseFluid=true;this.DesktopRendered=false;break;case"FLUID-":this.ParamsObj().UseFluid=false;this.DesktopRendered=false;break}this.IntSesNumber=0;return true};WebEntryPointSrv.prototype.HandleExpandListGroup=function(c){var a=c.GetAttribute("oid");var n=c.GetAttribute("obn");var f=c.GetAttribute("par1");var e=parseInt(c.GetAttribute("par2"),10);if(!a.startsWith("grl:")){return true}var m=-1;var l=a.indexOf(":",m+1);var k=a.indexOf(":",l+1);var j=a.indexOf(":",k+1);if(l==-1||k==-1||j==-1){return true}var d=a.substr(0,j);var g=this.FindWebFrame(d);if(g!=null&&g instanceof IDPanelSrv){var h=g;var b=parseInt(f,10);if(h.GroupRoot!=null){h.GroupRoot.RD3Expand(a,n.equals("1"),b,true,e)}}return true};WebEntryPointSrv.prototype.HandleGroupCollapseEvent=function(c){var b=c.GetAttribute("oid");var j=c.GetAttribute("obn");if(!b.startsWith("grp")){return true}var h=b.indexOf(":");var g=b.indexOf(":",h+1);var f=b.indexOf(":",g+1);if(h==-1||g==-1||f==-1){return true}var d=this.FindWebFrame(b.substr(g));if(d!=null&&d instanceof IDPanelSrv){var e=d;var a=parseInt(b.substr(h+1,g-h-1),10);e.bGroups(a).set_Collapsed(j.equals("col"),true)}return true};WebEntryPointSrv.prototype.HandleTextSelection=function(b){var e=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("par1"),10);var a=parseInt(b.GetAttribute("par2"),10);var c=this.RD3FindField(e);if(c!=null&&c.Parent!=null){c.Parent.FieldTextSelectionChanged(c.Index,d,a)}return true};WebEntryPointSrv.prototype.HandleClientFocus=function(b){var f=b.GetAttribute("oid");var c=parseInt(b.GetAttribute("obn"),10);var e=b.GetAttribute("par1").equals("1");var a=this.FindWebFrame(f);if(a!=null&&a instanceof IDPanelSrv){var d=a;d.OnRD3ClientFocus(c,e)}return true};WebEntryPointSrv.prototype.HandleClientMouseOver=function(b){try{var h=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("obn"),10);var g=parseInt(b.GetAttribute("par1"),10);var a=this.FindWebFrame(h);if(a!=null&&a instanceof IDPanelSrv){var f=a;f.OnRD3ClientMouseOver(d,g)}}catch(c){}return true};WebEntryPointSrv.prototype.HandleKeyPress=function(d){try{var k=parseInt(d.GetAttribute("obn"),10);var j=parseInt(d.GetAttribute("par1"),10);var a=d.GetAttribute("oid");var f=d.GetAttribute("ace");var b=null;var g=null;if(a!=null&&!a.equals("")){if(a.startsWith("frm:")){b=this.FindWebForm(a)}else{g=this.FindWebFrame(a);if(g!=null){b=g.Parent}}}var c=new IDVariant(false);if(g!=null){g.FireKeyPress(j,k,c)}if(b!=null&&c.isFalse()){b.FireKeyPress(g!=null?g.FrIndex:-1,j,k,c)}if(c.isFalse()){this.FireKeyPress(j,k)}}catch(h){}return true};WebEntryPointSrv.prototype.HandleVoice=function(a){try{this.VoiceObj.HandleVoice(a)}catch(b){}return true};WebEntryPointSrv.prototype.HandleScreenZoneSel=function(e){try{var a=e.GetAttribute("oid");var d=parseInt(e.GetAttribute("obn"),10);for(var b=0;b<this.screenZones.Count();b++){var f=this.screenZones.Get(b);if(f.GetRD3Ident()==a){f.set_SelectedForm(d);break}}}catch(c){}return true};WebEntryPointSrv.prototype.HandleIWUpload=function(b){this.WebEvent=b.GetAttribute("par1");this.Request.WCE=this.WebEvent;this.Request.QueryString.WCE=this.WebEvent;var a={FileName:b.GetAttribute("par2"),ContentType:b.GetAttribute("par3"),Content:b.GetAttribute("par4"),ContentLength:parseInt(b.GetAttribute("par5"))};this.Request.Files=[a];this.IWUpload_UserEvent(this.WebEvent);return true};WebEntryPointSrv.prototype.HandleIWBlob=function(a){this.WebEvent=a.GetAttribute("par1");this.Request.WCE=this.WebEvent;this.Request.QueryString.WCE=this.WebEvent;this.IWBlob_UserEvent(this.WebEvent);return true};WebEntryPointSrv.prototype.HandleIWFiles=function(b){this.WebEvent=b.GetAttribute("par1");this.Request.WCE=this.WebEvent;this.Request.QueryString.WCE=this.WebEvent;var a={FileName:b.GetAttribute("par2"),ContentType:b.GetAttribute("par3"),Content:b.GetAttribute("par4"),ContentLength:parseInt(b.GetAttribute("par5"))};this.Request.Files=[a];this.IWFiles_UserEvent(this.WebEvent);return true};WebEntryPointSrv.prototype.HandleIWOAuth=function(d){var a=d.GetAttribute("obn");while(a){var g;var e=a.indexOf("&");if(e!=-1){g=a.substr(0,e).trim();a=a.substr(e+1)}else{g=a.trim();a=""}e=g.indexOf("=");if(e!=-1){var b=g.substr(0,e);var f=Glb.URLDecode(g.substr(e+1));this.Request.QueryString[b]=f}}this.IWOAuth_UserEvent();return true};WebEntryPointSrv.prototype.HandleSYNC=function(b){this.DTTObj.SetRequestName("End Synchronization","End Synchronization",DTTRequest.PRI_ITEM);var c=(b.GetAttribute("par1")=="1");var d=(b.GetAttribute("par2")=="1");var h=new IDArray();if(b.GetAttribute("par3")!=""){var f=b.GetAttribute("par3").split(",");for(var e=0;e<f.length;e++){h.add_Value(new IDVariant(f[e]))}}var g=(b.GetAttribute("par4").length>0?parseInt(b.GetAttribute("par4")):-1);var j=(b.GetAttribute("par5").length>0?parseInt(b.GetAttribute("par5")):-1);var a=b.GetAttribute("par6");this.SyncObject.EndSynchronization(c,d,h,g,j,a);return true};WebEntryPointSrv.prototype.HandleCustomElementEvent=function(a){var c=a.GetAttribute("oid");var b=this.FindCustomElement(c);if(b!=null){b.HandleRD3Event(a)}return true};WebEntryPointSrv.prototype.RD3AddEvent=function(a,b){var c=new RD3EventSrv();c.Name=a;c.Ident=b;if(this.ParamsObj().UseRD3){this.RD3Events.Add(c)}return c};WebEntryPointSrv.prototype.GetLiveForms=function(){var b=new ArrayList();for(var a=0;a<this.StackForm.Count();a++){var c=this.StackForm[a];b.Add(c);c.GetSubForm(b)}return b};WebEntryPointSrv.prototype.FindWebForm=function(a){var h=a.indexOf(":");var g=a.indexOf(":",h+1);if(h==-1){return null}var e;var c=(g==-1)?a.substr(h+1):a.substr(h+1,g-h-1);e=parseInt(c,10);if(isNaN(e)){return null}var d=null;if(this.ActiveForm()!=null&&this.ActiveForm().FormIdx==e){d=this.ActiveForm()}if(d==null){var k=this.GetLiveForms();for(var b=0;b<k.Count();b++){var j=k[b];if(j.FormIdx==e){d=j;break}}}return d};WebEntryPointSrv.prototype.FindWebFrame=function(c){var g=-1;if(c.startsWith("fld:")||c.startsWith("trn:")||c.startsWith("box:")||c.startsWith("ppg:")||c.startsWith("grp:")){g=c.indexOf(":")}var e=c.indexOf(":",g+1);var d=c.indexOf(":",e+1);if(e==-1||d==-1){return null}var a=parseInt(c.substr(e+1,d-e-1),10);if(isNaN(a)){return null}var b=this.FindWebForm(c.substr(d));if(b==null){return null}if(a==-1){return b.PreviewBook}else{return b.Frames[a].Content}};WebEntryPointSrv.prototype.RD3FindSpan=function(c){var e=c.indexOf(":");var d=c.indexOf(":",e+1);var a=this.FindWebFrame("book"+c.substr(d));if(a!=null){return a.BookObj.RD3FindSpan(c)}return null};WebEntryPointSrv.prototype.RD3FindBox=function(c){var e=c.indexOf(":");var d=c.indexOf(":",e+1);var a=this.FindWebFrame("book"+c.substr(d));if(a!=null){return a.BookObj.RD3FindBox(c)}return null};WebEntryPointSrv.prototype.RD3FindField=function(d){if(!d.startsWith("fld")){return null}var f=d.indexOf(":");var c=d.indexOf(":",f+1);if(f>0&&c>0){var a=d.substr(f+1,c-f-1);var b=this.FindWebFrame("pan"+d.substr(c));if(b!=null){var e=parseInt(a,10);if(!isNaN(e)&&e<b.Fields.length){return b.Fields[e]}}}return null};WebEntryPointSrv.prototype.RD3FindNode=function(b){var d=b.indexOf(":");var c=b.indexOf(":",d+1);var e=b.substr(d+1,c-d-1);var a=this.FindWebFrame(b.substr(c));if(a!=null){return a.GetNode(e)}return null};WebEntryPointSrv.prototype.RD3FindCommand=function(b){var d=b.indexOf(":");var c=b.indexOf(":",d+1);if(c==-1){c=b.length}var a=parseInt(b.substr(d+1,c-d-1),10);if(isNaN(a)){return null}if(this.CmdObj.CmdLin.length<=a){return null}return this.CmdObj.CmdLin[a]};WebEntryPointSrv.prototype.FindCustomElement=function(d){var j=d.split(":");var h=this.FindWebForm("frm:"+j[j.length-1]);if(h==null){return null}var c=parseInt(j[j.length-2],10);if(isNaN(c)){return null}var e=h.Frames[c].Content;if(j.length==3){return e.GetCustomElem()}var b=parseInt(j[j.length-3],10);if(isNaN(b)){return null}var a=e.Fields[b];var g=parseInt(j[j.length-4],10);if(isNaN(g)){return null}return a.Values[g-e.bQueries(0).GetAttRecNumber()].iCustomElement};WebEntryPointSrv.prototype.RD3Reset=function(){this.DesktopRendered=false;for(var a=0;a<this.StackForm.Count();a++){this.StackForm[a].RD3Reset()}};WebEntryPointSrv.prototype.RD3StartRequest=function(){for(var c=0;c<this.StackForm.Count();c++){var b=this.StackForm[c];for(var a=0;a<b.Frames.length;a++){if(b.Frames[a]!=null&&b.Frames[a].Content!=null){b.Frames[a].Content.RD3StartRequest()}}}};WebEntryPointSrv.prototype.RD3EndRequest=function(){var a=this.StackForm.Clone();for(var d=0;d<a.Count();d++){var c=a[d];for(var b=0;b<c.Frames.length;b++){if(c.Frames[b]!=null&&c.Frames[b].Content!=null){if((c==this.ActiveForm()||c.Docked)&&c.Frames[b].Content instanceof IDPanelSrv){c.Frames[b].Content.RD3Validate=true}c.Frames[b].Content.RD3EndRequest()}}}if(this.AlertType()==0){this.ConfStack.clear()}};WebEntryPointSrv.prototype.WelcomeUrl=function(){return(this.CompOwner!=null?this.CompOwner.WelcomeUrl():this.iWelcomeURL)};WebEntryPointSrv.prototype.set_WelcomeUrl=function(a){if(this.CompOwner!=null){this.CompOwner.set_WelcomeUrl(a)}else{this.iWelcomeURL=a;this.RD3Change(RD3Glb.WEP_WELCOME)}};WebEntryPointSrv.prototype.Widget=function(){return(this.CompOwner!=null?this.CompOwner.Widget():this.WidgetMode)};WebEntryPointSrv.prototype.set_Widget=function(a){if(this.CompOwner!=null){this.CompOwner.set_Widget(a)}else{this.WidgetMode=a;this.RD3Change(RD3Glb.WEP_WIDGETMODE)}};WebEntryPointSrv.prototype.AutoCollapseMenu=function(){return(this.CompOwner!=null?this.CompOwner.AutoCollapseMenu():this.MenuAutoCollapse)};WebEntryPointSrv.prototype.set_AutoCollapseMenu=function(a){if(this.CompOwner!=null){this.CompOwner.set_AutoCollapseMenu(a)}else{if(a!=this.MenuAutoCollapse){this.MenuAutoCollapse=a;if(this.MenuAutoCollapse>0){for(var b=1;b<this.CmdObj.CmdSets.length;b++){if(!this.CmdObj.CmdSets[b]){continue}this.CmdObj.CmdSets[b].PrepareForAutocollapse(this.MenuAutoCollapse)}}}}};WebEntryPointSrv.prototype.LogoffURL=function(){return(this.CompOwner!=null?this.CompOwner.LogoffURL():this.iLogoffURL)};WebEntryPointSrv.prototype.set_LogoffURL=function(a){if(this.CompOwner!=null){this.CompOwner.set_LogoffURL(a)}else{this.iLogoffURL=a;this.RD3Change(RD3Glb.WEP_SHOWLOGOFF)}};WebEntryPointSrv.prototype.SideMenuWidth=function(){return(this.CompOwner!=null?this.CompOwner.SideMenuWidth():this.iSideMenuWidth)};WebEntryPointSrv.prototype.set_SideMenuWidth=function(a){if(this.CompOwner!=null){this.CompOwner.set_SideMenuWidth(a)}else{this.iSideMenuWidth=a;this.RD3Change(RD3Glb.WEP_MENUWIDTH)}};WebEntryPointSrv.prototype.AccentColor=function(){return(this.CompOwner!=null?this.CompOwner.AccentColor():this.iAccentColor)};WebEntryPointSrv.prototype.set_AccentColor=function(a){if(this.CompOwner!=null){this.CompOwner.set_AccentColor(a)}else{this.iAccentColor=a;this.RD3Change(RD3Glb.WEP_ACCENTCOLOR)}};WebEntryPointSrv.prototype.SecondaryColor=function(){return(this.CompOwner!=null?this.CompOwner.SecondaryColor():this.iSecondaryColor)};WebEntryPointSrv.prototype.set_SecondaryColor=function(a){if(this.CompOwner!=null){this.CompOwner.set_SecondaryColor(a)}else{this.iSecondaryColor=a;this.RD3Change(RD3Glb.WEP_SECCOLOR)}};WebEntryPointSrv.prototype.DangerColor=function(){return(this.CompOwner!=null?this.CompOwner.DangerColor():this.iDangerColor)};WebEntryPointSrv.prototype.set_DangerColor=function(a){if(this.CompOwner!=null){this.CompOwner.set_DangerColor(a)}else{this.iDangerColor=a;this.RD3Change(RD3Glb.WEP_DANGERCOLOR)}};WebEntryPointSrv.prototype.LightColor=function(){return(this.CompOwner!=null?this.CompOwner.LightColor():this.iLightColor)};WebEntryPointSrv.prototype.set_LightColorColor=function(a){if(this.CompOwner!=null){this.CompOwner.set_LightColorColor(a)}else{this.iLightColor=a;this.RD3Change(RD3Glb.WEP_LIGHTCOLOR)}};WebEntryPointSrv.prototype.DarkColor=function(){return(this.CompOwner!=null?this.CompOwner.DarkColor():this.iDarkColor)};WebEntryPointSrv.prototype.set_DarkColor=function(a){if(this.CompOwner!=null){this.CompOwner.set_DarkColor(a)}else{this.iDarkColor=a;this.RD3Change(RD3Glb.WEP_DARKCOLOR)}};WebEntryPointSrv.prototype.BrightColor=function(){return(this.CompOwner!=null?this.CompOwner.BrightColor():this.iBrightColor)};WebEntryPointSrv.prototype.set_BrightColor=function(a){if(this.CompOwner!=null){this.CompOwner.set_BrightColor(a)}else{this.iBrightColor=a;this.RD3Change(RD3Glb.WEP_BRIGHTCOLOR)}};WebEntryPointSrv.prototype.VibrantColor=function(){return(this.CompOwner!=null?this.CompOwner.VibrantColor():this.iVibrantColor)};WebEntryPointSrv.prototype.set_VibrantColor=function(a){if(this.CompOwner!=null){this.CompOwner.set_VibrantColor(a)}else{this.iVibrantColor=a;this.RD3Change(RD3Glb.WEP_VIBRANTCOLOR)}};WebEntryPointSrv.prototype.RefreshInterval=function(){return(this.CompOwner!=null?this.CompOwner.RefreshInterval():this.iRefreshInterval)};WebEntryPointSrv.prototype.set_RefreshInterval=function(a){if(this.CompOwner!=null){this.CompOwner.set_RefreshInterval(a)}else{this.iRefreshInterval=a;this.RD3Change(RD3Glb.WEP_REFRESHINT)}};WebEntryPointSrv.prototype.RefreshUI=function(){return(this.CompOwner!=null?this.CompOwner.RefreshUI():this.iRefreshUI)};WebEntryPointSrv.prototype.set_RefreshUI=function(a){if(this.CompOwner!=null){this.CompOwner.set_RefreshUI(a)}else{this.iRefreshUI=a}};WebEntryPointSrv.prototype.RD3ServerParams=function(a){var b=a.AddNewElement("par");b.SetAttribute("thm",this.ParamsObj().Theme);b.SetAttribute("sli",this.ParamsObj().SmartLookupIcon);b.SetAttribute("shd",this.ParamsObj().ShowDisabledIcons?"1":"0");b.SetAttribute("rai",this.ParamsObj().RightAlignedIcons?"1":"0");b.SetAttribute("sfi",this.ParamsObj().ShowFieldImageInValue?"1":"0");b.SetAttribute("sda",this.ParamsObj().ShowDisabledFieldActivator?"1":"0");b.SetAttribute("tem",this.ParamsObj().TooltipErrorMode.toString());b.SetAttribute("frs",this.ParamsObj().EnableFrameResize?"1":"0");b.SetAttribute("jsu",this.ParamsObj().UseHTML5Upload?"1":"0");b.SetAttribute("cpb",this.ParamsObj().CompletePanelBorders?"1":"0");b.SetAttribute("uzn",this.ParamsObj().UseZones?"1":"0");b.SetAttribute("brt",this.ParamsObj().BorderType.toString());b.SetAttribute("ued",this.ParamsObj().UseIDEditor?"1":"0");b.SetAttribute("ent",this.ParamsObj().EnterChangeFocus?"1":"0");b.SetAttribute("ars",this.ParamsObj().PanelFixActiveRowWhenScrolled?"1":"0");b.SetAttribute("pls",this.ParamsObj().PanelsLikeSearch?"1":"0");b.SetAttribute("plm",this.ParamsObj().PanelsLikeMode.toString());b.SetAttribute("gtp",this.ParamsObj().GlobalToolbarPosition.toString());b.SetAttribute("cmk",""+this.ParamsObj().DefaultCurrencyMask);b.SetAttribute("dmk",""+this.ParamsObj().DefaultDateMask);b.SetAttribute("tmk",""+this.ParamsObj().DefaultTimeMask);b.SetAttribute("fmk",""+this.ParamsObj().DefaultFloatMask);b.SetAttribute("M001",this.RTCObj.GetConst("9320F18C-116E-4788-9D72-408754B7414D","Aggiorna la visualizzazione",false));b.SetAttribute("M002",this.RTCObj.GetConst("B9659CF1-1CF2-43f1-A8B8-BC093C796877","I criteri di ricerca sono stati azzerati",false));b.SetAttribute("M003",this.RTCObj.GetConst("40309EDE-81DD-407F-8F25-B9C39B01055F","Torna all'applicazione",false));b.SetAttribute("M004",this.RTCObj.GetConst("A61E8784-7812-44E2-9001-937ED881302F","E' necessario inserire un valore",false));b.SetAttribute("M005",this.RTCObj.GetConst("E98B1F3C-C3D2-4202-8AE6-539A2CF24551","Cancella Documento",false));b.SetAttribute("M006",this.RTCObj.GetConst("169C7BE9-A5B4-40E7-AE1B-92B4FE344A5A","Carica Documento",false));b.SetAttribute("M007",this.RTCObj.GetConst("78F371EA-E7F4-4F30-A3F0-6F7E6924F157","Chiude la videata",false));b.SetAttribute("M008",this.RTCObj.GetConst("2E8B0CC4-B9E8-4579-906D-8A4E9109CF32","Chiude la videata",false));b.SetAttribute("M009",this.RTCObj.GetConst("38ABB688-409C-43A8-BA9F-1ECACD08D957","Chiude l'applicazione",false));b.SetAttribute("M010",this.RTCObj.GetConst("22771A06-0BFD-49B4-B853-FB17DD9E85D7","Chiudi Tutto",false));b.SetAttribute("M011",this.RTCObj.GetConst("677C7F88-80DD-4483-9003-1268B5852F5C","Gestisci Allegati",false));b.SetAttribute("M012",this.RTCObj.GetConst("ADCA4013-3CA1-4D6A-AB95-FEFE161F1CA2","Gestisci Commenti",false));b.SetAttribute("M013",this.RTCObj.GetConst("8B4A3A38-94D6-4FB0-AC8C-E954025FFE75","Confermi la cancellazione?",false));b.SetAttribute("M014",this.RTCObj.GetConst("CD813F50-12CE-4DDF-AFC1-30B5EB8D85A7","Conferma la scelta",false));b.SetAttribute("M015",this.RTCObj.GetConst("F4DD1CE8-BF24-43AF-9753-1302DFDFE68E","Crea un file PDF per la stampa",false));b.SetAttribute("M016",this.RTCObj.GetConst("58BF840D-5DA5-4667-B34C-403F3BE24CA0","Confermi?",false));b.SetAttribute("M017",this.RTCObj.GetConst("AAE29D7E-7545-4115-9945-5CD74D125325","Stampa il report",false));b.SetAttribute("M018",this.RTCObj.GetConst("B1AC743E-369F-4F50-A80C-F0ABE2850DDF","Click per aprire il documento (|1)",false));b.SetAttribute("M019",this.RTCObj.GetConst("BAA77E7E-38E7-44C5-A3DD-243896EA653E","Scegli un documento da caricare (max dim. |1):",false));b.SetAttribute("M020",this.RTCObj.GetConst("EDBD7ED0-0DA7-4877-968F-04F500C68009","Mostra il menù",false));b.SetAttribute("M021",this.RTCObj.GetConst("07F7A1CE-D5F3-415C-B18B-221D2A53B11B","Mostra il riquadro",false));b.SetAttribute("M022",this.RTCObj.GetConst("673FEFC1-2B3E-4FAA-A203-2AE4A0BFF4EA","Nasconde il menù",false));b.SetAttribute("M023",this.RTCObj.GetConst("F947D8CD-BBBB-408A-8BCD-F8FE88172649","Nasconde il riquadro",false));b.SetAttribute("M024",this.RTCObj.GetConst("44F06A32-2D4F-41F5-805A-151C0C38BF1E","Pagina |1 di |2",false));b.SetAttribute("M025",this.RTCObj.GetConst("6980AD68-ED7B-4072-AA7B-0D6E0601E0D3","Pagina precedente",false));b.SetAttribute("M026",this.RTCObj.GetConst("3948B6AB-6CC2-487B-BFC7-43E3703F8409","Pagina precedente",false));b.SetAttribute("M027",this.RTCObj.GetConst("1E96B37D-935E-490B-9D33-BB8644B53528","Pagina successiva",false));b.SetAttribute("M028",this.RTCObj.GetConst("3B623495-689F-4581-B23B-EA5DE94FDC90","Pagina successiva",false));b.SetAttribute("M029",this.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB","Riga |1",false));b.SetAttribute("M030",this.RTCObj.GetConst("A681B53C-BE95-4FEC-8BBE-99A4C3C27576","Riga |1 di |2",false));b.SetAttribute("M031",this.RTCObj.GetConst("6ABFFB5D-2E2C-40EF-AD39-9FADA6B96563","Nuova Riga",false));b.SetAttribute("M032",this.RTCObj.GetConst("B04012F8-21CC-45C3-9879-B32D52AF4061","Inserisci criteri di ricerca",false));b.SetAttribute("M033",this.RTCObj.GetConst("C3123089-8533-472D-91BC-F394F71B4FEF","DATI MODIFICATI",false));b.SetAttribute("M034",this.RTCObj.GetConst("198FC43B-3EFC-4326-9E28-3077DD5C4107","Annulla le modifiche",false));b.SetAttribute("M035",this.RTCObj.GetConst("27745E44-6434-4FD9-97FD-8A38D1B51D57","Cerca i dati tramite i criteri di ricerca",false));b.SetAttribute("M036",this.RTCObj.GetConst("3C3FA079-82BB-4F79-8352-A38E00BE0E4C","Cancella la riga selezionata",false));b.SetAttribute("M037",this.RTCObj.GetConst("7A5319D1-4527-4248-8274-938516E162A0","Deseleziona tutte le righe",false));b.SetAttribute("M038",this.RTCObj.GetConst("CABC5476-EF69-4F9D-AC4A-11B26625A963","Duplica la riga",false));b.SetAttribute("M039",this.RTCObj.GetConst("2652029A-73A8-4CB0-BF89-3D0820FEF165","Visualizza la lista o il dettaglio",false));b.SetAttribute("M040",this.RTCObj.GetConst("894F3A97-E470-4524-AC63-6761FF30FEC8","Vai ad una riga vuota per inserire un nuovo dato",false));b.SetAttribute("M041",this.RTCObj.GetConst("47E3DDC3-8074-42FD-9388-5227AF374A5D","Blocca i dati",false));b.SetAttribute("M042",this.RTCObj.GetConst("25B0C66D-51F0-44BB-9B3E-B5C4604D4D0A","Mostra i checkbox per la selezione multipla delle righe",false));b.SetAttribute("M043",this.RTCObj.GetConst("0396E047-4630-4059-B451-DE792393929F","Mostra i bottoni per la selezione delle righe",false));b.SetAttribute("M044",this.RTCObj.GetConst("BF8E9457-11AB-4EAA-889E-9477F2380097","Ricarica i dati dal database",false));b.SetAttribute("M045",this.RTCObj.GetConst("59DD9DD1-1E4E-47DF-B2B2-61A28E85D98F","Seleziona tutte le righe",false));b.SetAttribute("M046",this.RTCObj.GetConst("B5D47A63-66DA-49F6-BF37-0D5762173EDE","Trova i dati nel database",false));b.SetAttribute("M047",this.RTCObj.GetConst("CC63539D-2E1F-46CB-AEF9-F1DD14EEFDBA","Permetti di modificare i dati",false));b.SetAttribute("M048",this.RTCObj.GetConst("2769ADE5-2860-4F74-907C-57F84D893EAE","Registra le modifiche",false));b.SetAttribute("M049",this.RTCObj.GetConst("E86FAD7D-D471-4BAB-A551-B7D348CF8F20","Vai alla fine",false));b.SetAttribute("M050",this.RTCObj.GetConst("45ED1144-48EE-4B32-852C-91FCCDF88930","Vai alla fine",false));b.SetAttribute("M051",this.RTCObj.GetConst("E94579CB-4078-4A7d-803F-55E270FCACCD","Vai all'inizio",false));b.SetAttribute("M052",this.RTCObj.GetConst("146D7307-76B5-4252-A762-B9CBF88F7C57","Vai all'inizio",false));b.SetAttribute("M053",this.RTCObj.GetConst("BCEBD1D9-23E1-4087-9AE0-1FBE3143E84C","Videate Aperte",false));b.SetAttribute("M054",this.RTCObj.GetConst("FAD9E562-D3CF-41C4-A548-F06997EC3C4A","Visualizza Documento",false));b.SetAttribute("M055",this.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB","Riga |1",false));b.SetAttribute("M056",this.RTCObj.GetConst("A681B53C-BE95-4FEC-8BBE-99A4C3C27576","Riga |1 di |2",false));b.SetAttribute("M057",this.RTCObj.GetConst("58C9F7B6-E6E6-4BAB-B184-2D0C18569BF8","Esporta i dati in Excel",false));b.SetAttribute("M058",this.RTCObj.GetConst("0D21AD28-8DEB-47F5-B216-CF09387064EE","Errore:",false));b.SetAttribute("M059",this.RTCObj.GetConst("664A0C65-7966-4B99-9A34-197D66E43498","Effetti:",false));b.SetAttribute("M060",this.RTCObj.GetConst("6DB549C8-7FD6-4079-B725-96F50670CA0D","Cosa fare:",false));b.SetAttribute("M061",this.RTCObj.GetConst("81CAF4C5-9473-4217-A80D-3A65F53692D7","Causa:",false));b.SetAttribute("M062",this.RTCObj.GetConst("40309EDE-81DD-407F-8F25-B9C39B01055F","Torna all'applicazione",false));b.SetAttribute("M063",this.RTCObj.GetConst("43A079DF-1B3F-4A4C-A5EB-C82B52ABD31A","Attendere prego...",false));b.SetAttribute("M064",this.RTCObj.GetConst("25FDAC1D-F960-45F2-883E-2076D96D2715","Mostra/Nasconde i raggruppamenti",false));b.SetAttribute("M065",this.RTCObj.GetConst("8D797BA1-E282-44a2-BD8B-586378B96186","Mostra i comandi per la selezione delle righe",false))};WebEntryPointSrv.prototype.RenderAllImages=function(a){};WebEntryPointSrv.prototype.AddToPreload=function(b,a){};WebEntryPointSrv.prototype.StreamFile=function(a){};WebEntryPointSrv.prototype.IWStream_UserEvent=function(a){};WebEntryPointSrv.prototype.RDLevel=function(){if(!this.UseRD){return 0}else{if(!this.ParamsObj().UseRD3){return 2}else{return 3}}};WebEntryPointSrv.prototype.BrowserInfo=function(h){if(h==undefined){h=false}if(this.BInfo_Type!=-1){return(h?this.BInfo_Ver:this.BInfo_Type)}if(this.Request==null){return -1}var c=new Array("MSIE ","Chrome/","Safari/","Firefox/","iPhone","iPad","Android","Android");var d=this.Request.Headers["User-Agent"];if(d!=null){this.BInfo_Type=0;for(var b=1;b<=c.length;b++){var a=c[b-1];var j=d.indexOf(a);if(j!=-1){if(a.equals("Safari/")){if(d.indexOf("iPhone")>=0||d.indexOf("iPad")>=0||d.indexOf("Android")>=0||d.indexOf("IEMobile")>=0){continue}}if(a.equals("Chrome/")&&d.indexOf("Android")>=0){continue}if((a.equals("iPhone")||a.equals("Android"))&&d.indexOf("IEMobile")>=0){continue}this.BInfo_Type=b;if(a.equals("Chrome/")&&d.indexOf("Edge/")>=0){this.BInfo_Type=(d.indexOf("Windows Phone")>=0?10:11);j=d.indexOf("Edge/")}if(a.equals("Android")&&d.indexOf("Mobile")!=-1){this.BInfo_Type=8}if(a.equals("Safari/")){a="Version/";j=d.indexOf(a);if(j==-1){break}}if(a.equals("iPhone")||a.equals("iPad")||a.equals("Android")){this.BInfo_Ver=3;break}if(a.equals("MSIE ")&&d.indexOf(" ARM")!=-1){this.BInfo_Type=9}var f=d.indexOf(".",j);if(f!=-1){try{j+=a.length;this.BInfo_Ver=parseInt(d.substr(j,f-j),10)}catch(g){}}break}}if(this.BInfo_Type==0&&(d.indexOf("Trident/7.0")!=-1||d.indexOf("Trident/8.0")!=-1)){if(d.indexOf(" ARM")!=-1){if(d.indexOf("Phone ")!=-1){BInfo_Type=10}else{BInfo_Type=9}}else{this.BInfo_Type=1}this.BInfo_Ver=11}}return(h?this.BInfo_Ver:this.BInfo_Type)};WebEntryPointSrv.prototype.set_EnableGFX=function(a){if(this.ParamsObj().EnableGFX!=a){this.ParamsObj().EnableGFX=a;this.RD3Change(RD3Glb.WEP_ENABLEGFX)}};WebEntryPointSrv.prototype.EnableSound=function(){return this.ParamsObj().EnableSound};WebEntryPointSrv.prototype.set_EnableSound=function(a){if(ParamsObj().EnableSound!=a){this.ParamsObj().EnableSound=a;this.RD3Change(RD3Glb.WEP_ENABLESND)}};WebEntryPointSrv.prototype.GetAppLanguage=function(){return null};WebEntryPointSrv.prototype.GetAppUrl=function(b,a){return null};WebEntryPointSrv.prototype.GetApplication=function(){return(this.CompOwner==null?this:this.CompOwner.GetApplication())};WebEntryPointSrv.prototype.UserAgent=function(){return(this.Request!=null?this.Request.Headers["User-Agent"]:"")};WebEntryPointSrv.prototype.GetWebServiceURL=function(a){return this.WebServicesUrl[a]};WebEntryPointSrv.prototype.SetWebServiceURL=function(a,b){this.WebServicesUrl[a]=b};WebEntryPointSrv.prototype.AddTempFile=function(a){this.TempFiles.Add(a)};WebEntryPointSrv.prototype.ExecuteOnClient=function(a){this.RD3CliExecute.Add(a)};WebEntryPointSrv.prototype.OpenFormsCount=function(){return this.StackForm.Count()};WebEntryPointSrv.prototype.GetOpenForm=function(a){return this.StackForm[a]};WebEntryPointSrv.prototype.SoundAction=function(c,a,d,f,e,j,b,h){if(d==undefined){d=-1}if(f==undefined){f=-1}if(e==undefined){e=-1}if(j==undefined){j=false}if(b==undefined){b=false}if(h==undefined){h=null}var g=this.RD3AddEvent("sound",a);g.SetAttribute("action",c);if(d!=-1){g.SetAttribute("volume",d.toString())}if(f!=-1){g.SetAttribute("t1",f.toString())}if(e!=-1){g.SetAttribute("t2",e.toString())}if(j){g.SetAttribute("notify","1")}if(b){g.SetAttribute("progress","1")}if(h!=null&&h.length>0){g.SetAttribute("video",h)}};WebEntryPointSrv.prototype.ShowTooltip=function(f,j,e,q,o,d,g,l,h,n,c,m,a,b){if(b==undefined){b=null}var k=this.RD3AddEvent("tooltip",e);k.CanSendInFulltree=true;k.SetAttribute("title",j);k.SetAttribute("text",f);if(q!=-1){k.SetAttribute("anchorx",q.toString())}if(o!=-1){k.SetAttribute("anchory",o.toString())}if(d!=0){k.SetAttribute("position",d.toString())}if(g!=750){k.SetAttribute("showdelay",g.toString())}if(l!=4000){k.SetAttribute("hidedelay",l.toString())}if(h){k.SetAttribute("showoninactivity","1")}if(n!=-1){k.SetAttribute("width",n.toString())}if(c!=-1){k.SetAttribute("height",c.toString())}if(m!="info"){k.SetAttribute("style",m)}if(!a){k.SetAttribute("haswhisker","0")}if(b!=null){k.SetAttribute("image",b)}};WebEntryPointSrv.prototype.DispatchToComp=function(k,h){if(this.CompList.Count()==0){return}if(k.equals("OnGetDBByName")){return}var n=false;var a=null;var e=this.GetApplication();a=e.GetCompAlreadyNotified();if(a==null){a=new ArrayList();e.SetCompAlreadyNotified(a);n=true}for(var g=0;g<this.CompList.Count();g++){var l=this.CompList[g];if(l.SharedInstance&&a.IndexOf(l.CompNameSpace)!=-1){continue}if(e.SkipDispatch){var d=e.SkipDispatch.get_Object(new IDVariant(k));if(d&&d.indexOf(l.CompNameSpace)!==-1){for(var f=0;f<l.CompList.Count();f++){l.CompList[f].DispatchToComp(k,h)}continue}}var c=l.CompNameSpace+"."+k;var b=this.CompDispatchMethodsCache[c];if(b==null){b=l[k];if(b!=null){this.CompDispatchMethodsCache[c]=b}}if(b!=null){a.Add(l.CompNameSpace);if(k=="InitApp"){if(l.InitAppDone){continue}l.InitAppDone=true}b.apply(l,h)}}if(n){e.SetCompAlreadyNotified(null)}};WebEntryPointSrv.prototype.DispatchToOwner=function(c,e){if(this.CompOwner==null){return}var b=this.GetApplication();var f=null;var g=false;f=b.SkipDispatch;if(f==null){f=new IDMap();b.SkipDispatch=f;g=true}var d=f.get_Object(new IDVariant(c));if(!d){d=new ArrayList();f.set_Object(new IDVariant(c),d)}d.Add(this.CompNameSpace);var a=this.CompOwner[c];if(a!=null){a.apply(this.CompOwner,e)}if(g){b.SkipDispatch=null}};WebEntryPointSrv.prototype.SendAppMessage=function(a,b){if(this.CompOwner!=null){this.CompOwner.SendAppMessage(a,b)}else{this.FireOnAppMessage(a,b,new ArrayList())}};WebEntryPointSrv.prototype.FireOnAppMessage=function(d,e,a){if(this.SharedInstance&&a.IndexOf(this.CompNameSpace)!=-1){return}a.Add(this.CompNameSpace);this.OnAppMessage(d,e);for(var b=0;b<this.CompList.Count();b++){var c=this.CompList[b];c.FireOnAppMessage(d,e,a)}};WebEntryPointSrv.prototype.OnAppMessage=function(a,b){};WebEntryPointSrv.prototype.KeyHandle=function(){return(this.CompOwner!=null?this.CompOwner.KeyHandle():this.ListenKeys)};WebEntryPointSrv.prototype.set_KeyHandle=function(a){if(this.CompOwner!=null){this.CompOwner.set_KeyHandle(a)}else{this.ListenKeys=a}};WebEntryPointSrv.prototype.ScreenZone=function(a){for(var b=0;b<this.screenZones.Count();b++){var c=this.screenZones.Get(b);if(c.Position()==a){return c}}return null};WebEntryPointSrv.prototype.FireKeyPress=function(a,b){if((this.KeyHandle()&a)==0){return}this.OnKeyPress(new IDVariant(a),new IDVariant(b))};WebEntryPointSrv.prototype.IsMobile=function(){if(this.iIsMobile==-1){this.iIsMobile=0;if(String.compare(this.ParamsObj().Theme.substring(0,6),"mobile",true)==0){this.iIsMobile=1}else{if(String.compare(this.ParamsObj().Theme.substring(0,6),"quadro",true)==0){this.iIsMobile=1}else{if(String.compare(this.ParamsObj().Theme.substring(0,5),"ionic",true)==0){this.iIsMobile=1}}}}return this.iIsMobile==1};WebEntryPointSrv.prototype.IsBootstrap=function(a){if(a==undefined){a=true}if(a&&this.ParamsObj().UseFluid){return false}if(this.iIsBootsrap==-1){this.iIsBootsrap=0;if(this.CompOwner){this.iIsBootsrap=this.CompOwner.IsBootstrap()?1:0}else{if(this.ParamsObj().Theme.length>=9&&String.compare(this.ParamsObj().Theme.substring(0,9),"bootstrap",true)==0){this.iIsBootsrap=1}}}return this.iIsBootsrap==1};WebEntryPointSrv.prototype.IsIonic=function(){if(this.iIsIonic==-1){this.iIsIonic=0;if(this.CompOwner){this.iIsIonic=this.CompOwner.IsIonic()?1:0}else{if(this.ParamsObj().Theme.length>=5&&String.compare(this.ParamsObj().Theme.substring(0,5),"ionic",true)==0){this.iIsIonic=1}}}return this.iIsIonic==1};WebEntryPointSrv.prototype.UseZones=function(){return this.ParamsObj().UseZones&&!this.IsSmartPhone()};WebEntryPointSrv.prototype.IsSmartPhone=function(){if(!this.IsMobile()){return false}if(this.ScreenHeight()==0||this.ScreenWidth()==0){return(this.BrowserInfo()==5||this.BrowserInfo()==8||this.BrowserInfo()==10)}else{return this.ScreenHeight()<=930&&this.ScreenWidth()<=930}};WebEntryPointSrv.prototype.IsTablet=function(){return !this.IsSmartPhone()};WebEntryPointSrv.prototype.AddCustomToManifest=function(a){};WebEntryPointSrv.prototype.AddCaseInsensitive=function(b,a){};WebEntryPointSrv.prototype.GetManifestFileList=function(){};WebEntryPointSrv.prototype.CreateServiceWorker=function(){};WebEntryPointSrv.prototype.GetMimeFromExtension=function(a){if(this.CompOwner!=null){return this.CompOwner.GetMimeFromExtension(a)}if(this.MimeMap==null){this.FillMimeMap()}return this.MimeMap.get_Value(new IDVariant(a.toLowerCase())).stringValue()};WebEntryPointSrv.prototype.GetExtensionFromMime=function(d){if(this.CompOwner!=null){return this.CompOwner.GetExtensionFromMime(d)}if(this.MimeMap==null){this.FillMimeMap()}var c=this.MimeMap.GetKeys();for(var b=0;b<c.Size();b++){var a=c.get_Value(new IDVariant(b)).stringValue();if(this.MimeMap.get_Value(new IDVariant(a)).stringValue().equals(d)){return a}}return""};WebEntryPointSrv.prototype.FillMimeMap=function(){this.MimeMap=new IDMap();this.MimeMap.set_Value(new IDVariant("txt"),new IDVariant("text/plain"));this.MimeMap.set_Value(new IDVariant("htm"),new IDVariant("text/html"));this.MimeMap.set_Value(new IDVariant("html"),new IDVariant("text/html"));this.MimeMap.set_Value(new IDVariant("css"),new IDVariant("text/css"));this.MimeMap.set_Value(new IDVariant("bmp"),new IDVariant("image/bmp"));this.MimeMap.set_Value(new IDVariant("png"),new IDVariant("image/png"));this.MimeMap.set_Value(new IDVariant("gif"),new IDVariant("image/gif"));this.MimeMap.set_Value(new IDVariant("jpe"),new IDVariant("image/jpeg"));this.MimeMap.set_Value(new IDVariant("jpg"),new IDVariant("image/jpeg"));this.MimeMap.set_Value(new IDVariant("jpeg"),new IDVariant("image/jpeg"));this.MimeMap.set_Value(new IDVariant("tif"),new IDVariant("image/tiff"));this.MimeMap.set_Value(new IDVariant("tiff"),new IDVariant("image/tiff"));this.MimeMap.set_Value(new IDVariant("mp3"),new IDVariant("audio/mpeg"));this.MimeMap.set_Value(new IDVariant("wav"),new IDVariant("audio/wav"));this.MimeMap.set_Value(new IDVariant("avi"),new IDVariant("video/avi"));this.MimeMap.set_Value(new IDVariant("mpeg"),new IDVariant("video/mpeg"));this.MimeMap.set_Value(new IDVariant("asf"),new IDVariant("video/x-ms-asf"));this.MimeMap.set_Value(new IDVariant("qt"),new IDVariant("video/quicktime"));this.MimeMap.set_Value(new IDVariant("csv"),new IDVariant("text/csv"));this.MimeMap.set_Value(new IDVariant("xls"),new IDVariant("application/vnd.ms-excel"));this.MimeMap.set_Value(new IDVariant("doc"),new IDVariant("application/msword"));this.MimeMap.set_Value(new IDVariant("rtf"),new IDVariant("application/msword"));this.MimeMap.set_Value(new IDVariant("pps"),new IDVariant("application/vnd.ms-powerpoint"));this.MimeMap.set_Value(new IDVariant("ppt"),new IDVariant("application/vnd.ms-powerpoint"));this.MimeMap.set_Value(new IDVariant("gz"),new IDVariant("application/x-gzip"));this.MimeMap.set_Value(new IDVariant("gzip"),new IDVariant("application/x-gzip"));this.MimeMap.set_Value(new IDVariant("js"),new IDVariant("application/x-javascript"));this.MimeMap.set_Value(new IDVariant("swf"),new IDVariant("application/x-shockwave-flash"));this.MimeMap.set_Value(new IDVariant("zip"),new IDVariant("application/x-zip-compressed"));this.MimeMap.set_Value(new IDVariant("pdf"),new IDVariant("application/pdf"));this.MimeMap.set_Value(new IDVariant("xlsx"),new IDVariant("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"));this.MimeMap.set_Value(new IDVariant("ppsx"),new IDVariant("application/vnd.openxmlformats-officedocument.presentationml.slideshow"));this.MimeMap.set_Value(new IDVariant("pptx"),new IDVariant("application/vnd.openxmlformats-officedocument.presentationml.presentation"));this.MimeMap.set_Value(new IDVariant("docx"),new IDVariant("application/vnd.openxmlformats-officedocument.wordprocessingml.document"));this.MimeMap.set_Value(new IDVariant("dotx"),new IDVariant("application/vnd.openxmlformats-officedocument.wordprocessingml.template"))};WebEntryPointSrv.prototype.TraceEvent=function(a,c,b){};WebEntryPointSrv.prototype.TraceError=function(a){};WebEntryPointSrv.prototype.IWSync_UserEvent=function(a){var c=parseInt(GetParameter("FTR"),10);var d=new XMLDoc();d.LoadFromString(this.GetParameter("SYNCDATA"));var b=this.SyncObject.SyncToLocal(d,c);this.Response.responseXML=d.SaveToString(c)};WebEntryPointSrv.prototype.OnOwaMessage=function(b,c,a){};WebEntryPointSrv.prototype.IWOwa_UserEvent=function(a){};WebEntryPointSrv.prototype.IWOAuth_UserEvent=function(a){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",100,"MainFrm.OAuth_UserEvent","OAuth request detected");this.DTTObj.SetRequestName("OAuth","OAuth",DTTRequest.PRI_ITEM);var c=this.Request.QueryString.state;if(c==null||c.length==0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"MainFrm.OAuth_UserEvent","State parameter not found")}else{try{var f=IDL.Base64Decode(c);var b=IOTConnector.ServiceConnector(this,f);if(b==null){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"MainFrm.OAuth_UserEvent","Connector not found")}else{b.RequestAccessToken()}}catch(d){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"MainFrm.OAuth_UserEvent","Unable to decode state parameter")}}this.RenderPage()};WebEntryPointSrv.prototype.GetFontsList=function(a){};WebEntryPointSrv.prototype.AddFontsFileList=function(a){};WebEntryPointSrv.prototype.SupportsHTML5Upload=function(){var c=false;if(this.ParamsObj().UseHTML5Upload==true){var a=this.BrowserInfo(false);var b=this.BrowserInfo(true);if(a==2||a==11){c=true}if(a==3&&b>=6){c=true}if(a==4&&b>=4){c=true}if(a==1&&b>=10){c=true}}return c};WebEntryPointSrv.prototype.GetRequestHeaders=function(){var a=new IDMap();return a};WebEntryPointSrv.prototype.GetRequestBody=function(){if(this.CompOwner!=null){return this.CompOwner.GetRequestBody()}return this.Request.InputStream};WebEntryPointSrv.Sessions=new HashTableSrv();WebEntryPointSrv.ShutDownTime=new Date(0);WebEntryPointSrv.prototype.ShutDownMessage=0;WebEntryPointSrv.iComPassword="";WebEntryPointSrv.ComPassword=function(){};WebEntryPointSrv.set_ComPassword=function(a){};WebEntryPointSrv.HandleComRequest=function(a){};WebEntryPointSrv.prototype.CheckRestartWarning=function(){};WebEntryPointSrv.prototype.CreateWEP=function(){return null};WebEntryPointSrv.prototype.OnSessionMessage=function(c,b,a,d){this.DispatchToComp("OnSessionMessage",new Array(c,b,a,d))};WebEntryPointSrv.prototype.IsServerSession=function(){return(!this.SessionName.equals(""))};WebEntryPointSrv.prototype.SendSessionMessage=function(b,c,h,s){if(h==undefined){h=5000}if(s==undefined){s=new IDArray()}var g=(new Date()).getTime()+(h<=0?30000:h);for(var j=0;j<s.Size();j++){var q=s.GetNative()[j];if(!(q==null||q instanceof IDVariant)){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",400,"MainFrm.SendSessionMessage","You can't pass an object as an argument of a message; the message was not sent");return new IDVariant()}}var t=new IDVariant();var f=false;while((new Date()).getTime()<g){f=WebEntryPointSrv.SSManager.SendMessage(this.SessionName,b,c,s);if(f){break}else{IDL.Sleep(50)}}if(!f){return new IDVariant()}if(h==0){g+=24*60*60*1000}while((new Date()).getTime()<g){try{var m;if(Shell.UseShellForSS()){m=Shell.SendSSCmd(b,"GetResult",{from:this.SessionName})}else{var k="SELECT Result";k+=" FROM Sessions";k+=" WHERE FromSessionName = "+IDL.Quote(this.SessionName);k+=" AND SessionName = "+IDL.Quote(b);var d=WebEntryPointSrv.SSManager.ExecuteQuery(k);if(d.rows.length==1){m=d.rows.item(0).Result}}if(m){var n=parseInt(m.substr(0,1),10);var o=m.substr(2);t=new IDVariant(o,n)}}catch(l){this.DTTObj.AddException("","MainFrm.SendSessionMessage","Error while reading result of message '"+this.iMessage+"' of '"+this.iFromSessionName+"'",l)}if(h==-1&&t.Type==IDVariant.INTEGER&&t.intValue()==-1){this.ResetSessionMessage(b);return new IDVariant(0)}if(t.Type!=IDVariant.INTEGER||t.intValue()>0){var a=(t.Type==IDVariant.INTEGER?new IDVariant():new IDVariant(t));this.ResetSessionMessage(b);return a}IDL.Sleep(50)}this.ResetSessionMessage(b);this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",225,"MainFrm.SendSessionMessage","Message delivery failed within "+h+" ms");return new IDVariant()};WebEntryPointSrv.prototype.ResetSessionMessage=function(a){try{if(Shell.UseShellForSS()){Shell.SendSSCmd(a,"ResetResult",{from:this.SessionName})}else{var b="UPDATE Sessions SET";b+=" FromSessionName = NULL,";b+=" Result = NULL";b+=" WHERE FromSessionName = "+IDL.Quote(this.SessionName);b+=" AND SessionName = "+IDL.Quote(a);WebEntryPointSrv.SSManager.ExecuteQuery(b)}}catch(c){this.DTTObj.AddException("","MainFrm.SendSessionMessage","Error while cleaning message '"+this.iMessage+"' of '"+this.iFromSessionName+"'",c)}};function ProgressBar(a){this.m_Present=0;this.m_Total=1;this.m_Message="";this.MainFrm=a;this.Abortable=false;this.Aborted=false}ProgressBar.prototype.StartPhase=function(a,c,b){if(a!=0){this.m_Total=a}this.m_Present=0;this.m_Message=c;this.Abortable=b;this.Aborted=false;try{if(Shell.UseShellForSS()){Shell.SendSSCmd(this.MainFrm.SessionName,"SetProgress",{phase:this.m_Message,progress:0,aborted:false})}else{var d="UPDATE Sessions SET";d+=" Phase = "+IDL.Quote(this.m_Message)+",";d+=" Progress = 0,";d+=" Aborted = 0";d+=" WHERE SessionName = "+IDL.Quote(this.MainFrm.SessionName);WebEntryPointSrv.SSManager.ExecuteQuery(d)}}catch(g){this.DTTObj.AddException("","ProgressBar.StartPhase","Error while writing phase of '"+this.MainFrm.SessionName+"'",g)}if(!this.MainFrm.IsServerSession()){var f=new Object();f.present=this.m_Present;f.total=this.m_Total;f.canAbort=this.Abortable;f.message=this.m_Message;myPostMessage({type:"progress",message:f})}};ProgressBar.prototype.TrackPhase=function(h,a){if(h==-1){this.m_Present++}else{this.m_Present=h}if(a!=-1){this.m_Total=a}if(this.m_Present>this.m_Total){this.m_Present=this.m_Total}try{var c=((this.m_Present+0)/(this.m_Total>0?this.m_Total:1));if(Shell.UseShellForSS()){this.Aborted=Shell.SendSSCmd(this.MainFrm.SessionName,"SetProgress",{progress:c})}else{var d="UPDATE Sessions SET";d+=" Progress = "+c;d+=" WHERE SessionName = "+IDL.Quote(this.MainFrm.SessionName);d+=" AND Aborted = 0";var b=WebEntryPointSrv.SSManager.ExecuteQuery(d,true);this.Aborted=(b.rowsAffected!=1)}}catch(g){this.DTTObj.AddException("","ProgressBar.TrackPhase","Error while writing progress of '"+this.MainFrm.SessionName+"'",g)}if(this.Aborted){return false}else{if(!this.MainFrm.IsServerSession()){var f=new Object();f.present=this.m_Present;f.total=this.m_Total;f.canAbort=this.Abortable;f.message=this.m_Message;myPostMessage({type:"progress",message:f})}return true}return false};function WebFormSrv(){this.FormIdx=0;this.BaseTimerIdx=0;this.BaseCmdSetIdx=0;this.BaseCmdLinIdx=0;this.HasCaptionToolbar=-1;this.iCaption=new IDVariant();this.iWebCaption=new IDVariant();this.Owner=0;this.OpenAs=0;this.ActivedTick;this.Frames;this.MainFrm;this.IMDB;this.IndObj;this.JustLoaded;this.ActiveElement="";this.FocusPriority;this.Docked=false;this.DockType=0;this.Visible=true;this.ParentSuf=null;this.ParentBox=null;this.IdxPanelActived;this.IdxFieldActived;this.ActivedDocument=null;this.ActivedProperty=null;this.ActivedExtProperty=null;this.ToolbarPosition;this.iBorderType;this.iVisualFlags=-1;this.iImage="";this.iBackButTxt="";this.Messages=new ArrayList();this.RTCGuid="";this.HelpFile="";this.UploadingPanel;this.TruePopup=0;this.DownloadingBlob;this.DownloadingFrame;this.iDocAttached=null;this.OrgCaption=null;this.PreviewBook=null;this.CloseOnSelection=false;this.AutoSaveType="NONE";this.FormLeft;this.FormTop;this.FormWidth;this.FormHeight;this.ResModeW;this.ResModeH;this.OrgWidth;this.OrgHeight;this.DesignWidth;this.DesignHeight;this.iWindowState=Glb.WS_NORMAL;this.iClassName;this.TagMap=null;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.FRM_MAXPROP);this.FreezePos=false;this.iRelatedTo;this.iRelatedPlacement=0;this.ToolbarEventDef=RD3Glb.EVENT_ACTIVE;this.FormListEventDef=RD3Glb.EVENT_ACTIVE;this.ResizeEventDef=RD3Glb.EVENT_ACTIVE;this.ShowAnimationDef=null;this.ModalAnimationDef=null;this.MessageAnimationDef=null;this.LastMessageAnimationDef=null;this.PreviewAnimationDef=null;this.DockedAnimationDef=null;this.PopupResizeAnimationDef=null;this.ListenKeys=0}WebFormSrv.prototype.SetMainFrm=function(a,b){this.Visible=false;this.Init(a,true,false)};WebFormSrv.prototype.SetSubMainFrm=function(a,b){this.Init(a,true,true)};WebFormSrv.prototype.InitMainFrm=function(a){this.MainFrm=a};WebFormSrv.NewInstance=function(w,imdb,ClassName,OpenAs,AttachTo){if(AttachTo==undefined){AttachTo=null}var wf=eval("new "+(w.CompNameSpace!=null&&!ClassName.startsWith(w.CompNameSpace+".")?w.CompNameSpace+".":"")+ClassName+"()");if(wf==null){for(var i=0;i<w.GetCompList().length;i++){var cmp=w.GetCompList()[i];wf=eval("new "+(!ClassName.startsWith(cmp.CompNameSpace+".")?cmp.CompNameSpace+".":"")+ClassName+"()");if(wf!=null){w=cmp;imdb=cmp.IMDB;break}}}if(wf==null){return null}if(AttachTo!=null){wf.iDocAttached=AttachTo}if(OpenAs==-3){wf.SetSubMainFrm(w,imdb)}else{wf.SetMainFrm(w,imdb)}if(AttachTo!=null){if(wf.iDocAttached==AttachTo){wf.iDocAttached=null;wf.set_Document(AttachTo)}for(var i=1;i<wf.Frames.length;i++){if(wf.Frames[i].Content!=null&&wf.Frames[i].Content instanceof IDPanelSrv){var p=wf.Frames[i].Content;if(p.IsDO()&&AttachTo.TypeName()==p.bQueries(0).MstTableName&&p.Status()!=Glb.PS_DATA&&(p.Flags&Glb.PAN_HASFORM)!=0&&p.MasterPanelCode==null&&p.MasterPanelIdx==0){p.SetQueryDocument(0,AttachTo,AttachTo.Parent()==null);break}}}}if(OpenAs!=-2&&OpenAs!=-3){w.ShowMultipleForm(wf,OpenAs)}return wf};WebFormSrv.prototype.IsMultiple=function(){return this.FormIdx>65536};WebFormSrv.prototype.Init=function(b,c,a){this.MainFrm=b;if(this.IMDB==null){this.IMDB=this.MainFrm.IwImdb.IMDB}this.IndObj=this.MainFrm.IndObj;this.AutoSaveType=this.MainFrm.ParamsObj().AutoSaveType;this.ToolbarPosition=this.MainFrm.ParamsObj().ToolbarPosition;this.iBorderType=this.MainFrm.ParamsObj().BorderType;if(this.OpenAs!=Glb.OPEN_MDI){this.ActivedDocument=b.ActivedDocument;this.ActivedProperty=b.ActivedProperty;this.ActivedExtProperty=b.ActivedExtProperty;b.ActivedExtProperty=null;b.ActivedProperty=null;b.ActivedDocument=null}this.FormLeft=-1;this.FormTop=-1;this.FormWidth=-1;this.FormHeight=-1};WebFormSrv.prototype.set_Document=function(b){var a=this.iDocAttached;if(this.iDocAttached!=b){this.iDocAttached=b;this.OnChangeDocument(a);this.DOSetCaption()}};WebFormSrv.prototype.Document=function(){return this.iDocAttached};WebFormSrv.prototype.DOSetCaption=function(){if(this.iDocAttached!=null){if(this.OrgCaption==null){this.OrgCaption=this.Caption()}if(this.iDocAttached.Deleted()||this.iDocAttached.Hidden()){this.set_Document(null)}else{this.set_Caption(new IDVariant(this.iDocAttached.GetName(1)+(this.iDocAttached.IsModified()?"*":"")));this.set_WebCaption(new IDVariant(this.iDocAttached.GetName(2)+(this.iDocAttached.IsModified()?"*":"")))}}else{if(this.OrgCaption!=null){this.set_Caption(this.OrgCaption);this.OrgCaption=null}}};WebFormSrv.prototype.set_Visible=function(a){if(a!=this.Visible){this.Visible=a;if(!this.Visible&&this.MainFrm.ActiveForm()==this){var b=this.MainFrm.GetFormToFocus();if(b!=null){this.MainFrm.BringToFront(b.FormIdx)}else{this.MainFrm.BringToFront(-1)}}if(this.MainFrm.ParamsObj().UseRD3&&this.Visible&&this.MainFrm.ActiveForm()==null){this.MainFrm.BringToFront(this.FormIdx)}if(this.MainFrm.DockedForm()==this){this.MainFrm.RDDockForm=true}this.RD3Change(RD3Glb.FRM_VISIBLE)}};WebFormSrv.prototype.ProcessRequest=function(c){if(this.UploadingPanel!=null){this.UploadingPanel.UploadBlob(this);this.UploadingPanel=null;return}if(this.PreviewBook!=null){this.PreviewBook.ProcessRequest(this,c)}else{for(var d=1;d<this.Frames.length;d++){if(!this.Frames[d].InTabbed&&!this.Frames[d].IsSubFrame){this.Frames[d].ProcessRequest(c)}}}if(!c){if(this.MainFrm.GetParameter("closex.x")!=null||this.MainFrm.GetParameter("mno.x")!=null){this.RD3Close(false)}if(this.MainFrm.GetParameter("myes.x")!=null){this.RD3Close(true)}if(this.HasCaptionToolbar==1){this.MainFrm.CmdObj.ProcessCaptionRequest(0,this,this.MainFrm)}for(var d=0;d<this.Messages.Count();d++){var b=this.Messages[d];if(!b.AutoDelete){if(this.MainFrm.GetParameter("clmsg"+b.RIndex+".x")!=null){this.Messages.Remove(b);d--}}}}};WebFormSrv.prototype.RD3Close=function(a){var b="closex";if(this.MainFrm.GetParameter("mno.x")!=null){b="mno"}if(this.MainFrm.GetParameter("myes.x")!=null){b="myes"}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,25,"Form.ProcessRequest","Form "+this.Caption()+" closed");this.MainFrm.DTTObj.SetRequestName("Close Form","Form "+this.Caption()+" closed",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.RTCGuid,DTTEngine.TST_FRMCLOSE,"Form "+this.Caption()+" close","",b);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Chiudi la videata "+this.Caption());this.MainFrm.UnloadForm(this.FormIdx,a)};WebFormSrv.prototype.HasMessages=function(){return this.Messages.Count()>0};WebFormSrv.prototype.ClearMessages=function(e,c,f){for(var d=0;d<this.Messages.Count();d++){var b=this.Messages[d];if(b.Source==e&&(f==-1||f==b.NumRow)&&(c==null||b.Code.equals(c))){this.Messages.Remove(b);this.RD3Changed=true;d--;if(b.SrcErr!=null){b.SrcErr.Shown=false}}}};WebFormSrv.prototype.HasOtherMessages=function(d){for(var c=0;c<this.Messages.Count();c++){var b=this.Messages[c];if(b.Source!=d){return true}}return false};WebFormSrv.prototype.SetMessage=function(h,b,g,d,m,l,j,e){if(e==undefined){e=null}var f=null;var o=false;for(var k=0;k<this.Messages.Count();k++){var n=this.Messages[k];if(n.Source==h&&n.NumRow==l&&n.Code.equals(m)){var c=g.equals("")&&n.AutoDelete;if(c){this.Messages.Remove(n);k--;this.RD3Changed=true}else{f=n;o=true}break}}if(!g.equals("")||o){if(f==null){f=new AMessageSrv();f.Parent=this;this.Messages.Add(f);f.RIndex=this.Messages.Count()}f.Source=h;f.Code=m;f.NumRow=l;f.Type=b;f.Text=g;f.Icon=d;f.SrcErr=e;f.AutoDelete=!j||g.equals("");f.RD3Change(RD3Glb.MSG_TEXT);f.RD3Change(RD3Glb.MSG_CODE);f.RD3Change(RD3Glb.MSG_ICON);f.RD3Change(RD3Glb.MSG_TYPE);f.RD3Change(RD3Glb.MSG_TEMPORARY)}};WebFormSrv.prototype.FormHasErrors=function(){return Glb.IsFormInError(this.Frames)};WebFormSrv.prototype.FormIsUpdated=function(){return Glb.IsFormUpdated(this.Frames)};WebFormSrv.prototype.SearchBook=function(a){return null};WebFormSrv.prototype.SearchPanel=function(a){for(var b=0;b<this.Frames.length;b++){if(this.Frames[b]!=null&&this.Frames[b].Content!=null){if(this.Frames[b].Content instanceof IDPanelSrv){var c=this.Frames[b].Content;if(c.Code.equals(a)){return c}}}}return null};WebFormSrv.prototype.Form_Activate=function(){};WebFormSrv.prototype.Form_Deactivate=function(a){};WebFormSrv.prototype.OnResize=function(c,a,b){};WebFormSrv.prototype.OnMove=function(c,a,b){};WebFormSrv.prototype.OnChangeState=function(b,a){};WebFormSrv.prototype.IntFormUnload=function(a,b){};WebFormSrv.prototype.IntFormAfterUnload=function(a){};WebFormSrv.prototype.OnChangeDocument=function(a){};WebFormSrv.prototype.UnloadForm=function(b,g){if(this.ActivedDocument!=null&&this.ActivedProperty!=null&&this.ActivedExtProperty!=null&&this.ActivedExtProperty.LinkedDoc!=null&&g){var d=false;for(var c=0;c<this.Frames.length&&!d;c++){if(this.Frames[c]!=null&&this.Frames[c].Content!=null&&this.Frames[c].Content instanceof IDPanelSrv){var f=this.Frames[c].Content.GetDocument();if(f!=null&&this.ActivedExtProperty.LinkedDoc.GetDocumentClass()==f.TypeName()){d=true;var e=f.GetMD();for(var a=1;a<=e.GetNumProp();a++){if(e.GetProp(a).PK){this.ActivedDocument.SetPropByIndex(this.ActivedProperty.Index,f.GetPropByIndex(a));break}}}}}}for(var c=0;c<this.Frames.length;c++){if(this.Frames[c]!=null&&this.Frames[c].Content!=null&&this.Frames[c].Content instanceof IDPanelSrv){this.Frames[c].Content.RD3EndRequest()}}};WebFormSrv.prototype.UpdateControls=function(){if(this.IsMultiple()){for(var a=0;a<this.IMDB.DBSize();a++){if(!this.IMDB.IsMasterTable(a)){this.IMDB.TblResetModified(a,Glb.GlbRefModIdx)}}this.IMDB.ResetModified(Glb.GlbRefModIdx,false)}for(var a=0;a<this.Frames.length;a++){if(this.Frames[a]!=null&&this.Frames[a].Content!=null&&this.Frames[a].Content instanceof ASubFormSrv&&this.Frames[a].Content.pSubForm!=null){this.Frames[a].Content.pSubForm.UpdateControls()}}};WebFormSrv.prototype.CmdClickCB=function(a){};WebFormSrv.prototype.TimerTickCB=function(a){};WebFormSrv.prototype.EndModal=function(a,b){};WebFormSrv.prototype.TreeExpand=function(b,a){var e=parseInt(a.substr(0,2),10);var d=this.Frames[e].Content;var f=d.GetNode(a.substr(2));if(f!=null){b.DTTObj.SetRequestName("Tree "+(f.Expanded?"Collapse":"Expand"),"Form "+this.Caption()+": tree item "+f.Name+(f.Expanded?" collapsed":" expanded"),DTTRequest.PRI_CMD);var c=new IDVariant();if(d.IsDO){d.FireOnChangeExpandDoc(f.Doc,!f.Expanded,c)}else{d.FireOnChangeExpandNode(f.HashKey,!f.Expanded,c)}if(c.isFalse()){f.ToggleExpansion(this.MainFrm,true)}f.RD3Change(RD3Glb.TRN_EXPANDED)}};WebFormSrv.prototype.TreeClick=function(b,a){var d=parseInt(a.substr(0,2),10);var c=this.Frames[d].Content;var e=c.GetNode(a.substr(2));if(e!=null){b.DTTObj.SetRequestName("Tree Click","Form "+this.Caption()+": tree item "+e.Name+" clicked",DTTRequest.PRI_CMD);c.FireNodeClick(e,b)}};WebFormSrv.prototype.GraphClick=function(b,a){var d=parseInt(a.substr(0,2),10);var c=this.Frames[d].Content;b.DTTObj.SetRequestName("Graph Click","Form "+this.Caption()+": graph point "+a.substr(2)+" clicked",DTTRequest.PRI_CMD);c.FireGraphClick(a.substr(2),b)};WebFormSrv.prototype.OnSendMessage=function(e,d,c,b,a,g,f){};WebFormSrv.prototype.SendMessage=function(f,e,d,c,b,h,g){if(d==undefined){d=null}if(c==undefined){c=new IDVariant()}if(b==undefined){b=new IDVariant()}if(h==undefined){h=new IDVariant()}if(g==undefined){g=new IDVariant()}var a=null;if(e!=null&&e instanceof WebFormSrv){a=e}this.OnSendMessage(f,a,d,c,b,h,g)};WebFormSrv.prototype.GetParent=function(){if(this.ParentSuf!=null){return this.ParentSuf.Parent}else{if(this.ParentBox!=null){return this.ParentBox.GetParentBook().Parent.Parent.Parent}}return null};WebFormSrv.prototype.SubForm_Activate=function(){for(var a=0;a<this.Frames.length;a++){if(this.Frames[a]!=null&&this.Frames[a].Content!=null&&this.Frames[a].Content instanceof ASubFormSrv&&this.Frames[a].Content.pSubForm!=null){this.Frames[a].Content.pSubForm.Form_Activate();this.Frames[a].Content.pSubForm.SubForm_Activate()}}};WebFormSrv.prototype.SubForm_Deactivate=function(a){for(var b=0;b<this.Frames.length;b++){if(this.Frames[b]!=null&&this.Frames[b].Content!=null&&this.Frames[b].Content instanceof ASubFormSrv&&this.Frames[b].Content.pSubForm!=null){this.Frames[b].Content.pSubForm.Form_Deactivate(a);this.Frames[b].Content.pSubForm.SubForm_Deactivate(a)}}};WebFormSrv.prototype.SubIntFormUnload=function(a,c){for(var b=0;b<this.Frames.length;b++){if(this.Frames[b]!=null&&this.Frames[b].Content!=null&&this.Frames[b].Content instanceof ASubFormSrv&&this.Frames[b].Content.pSubForm!=null){this.Frames[b].Content.pSubForm.IntFormUnload(a,c);this.Frames[b].Content.pSubForm.SubIntFormUnload(a,c)}}};WebFormSrv.prototype.SubIntFormAfterUnload=function(a,c){for(var b=0;b<this.Frames.length;b++){if(this.Frames[b]!=null&&this.Frames[b].Content!=null&&this.Frames[b].Content instanceof ASubFormSrv&&this.Frames[b].Content.pSubForm!=null){this.Frames[b].Content.pSubForm.IntFormAfterUnload(a,c);this.Frames[b].Content.pSubForm.SubIntAfterFormUnload(a,c)}}};WebFormSrv.prototype.DownloadBlob=function(a){var d=parseInt(a.substr(0,2),10);var c=parseInt(a.substr(2),10);if(d<0||d>=this.Frames.length){return false}try{this.DownloadingFrame=d;this.DownloadingBlob=c;return this.Frames[d].Content.DownloadBlob(c,this.MainFrm)}catch(b){return false}};WebFormSrv.prototype.set_Caption=function(a){if(!this.iCaption.equals(a)){this.iCaption.set(a);this.iWebCaption=new IDVariant(Glb.HTMLEncode(a.stringValue()));this.RD3Change(RD3Glb.FRM_CAPTION);this.RD3Change(RD3Glb.FRM_WEBCAPTION)}};WebFormSrv.prototype.Caption=function(){return new IDVariant(this.iCaption)};WebFormSrv.prototype.WebCaption=function(){return new IDVariant(this.iWebCaption)};WebFormSrv.prototype.set_WebCaption=function(a){if(!this.iWebCaption.equals(a)){this.iWebCaption.set(a);this.RD3Change(RD3Glb.FRM_WEBCAPTION)}};WebFormSrv.prototype.DockingType=function(){return this.DockType};WebFormSrv.prototype.set_DockingType=function(a){if(this.DockType!=a){if(this.MainFrm.UseZones()){var b=this.MainFrm.ScreenZone(a);if(b!=null){b.AddForm(this)}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,RTCGuid,280,"Form.DockType","Form "+Caption()+": Unable to find zone "+a+", docking not changed")}}else{this.DockType=a}}};WebFormSrv.prototype.ClassName=function(){return this.iClassName};WebFormSrv.prototype.set_ClassName=function(a){this.iClassName=a;this.RD3Change(RD3Glb.FRM_CLASSNAME)};WebFormSrv.prototype.DTTTrace=function(a){if(a.DTTObj.AddTraceItem(this.RTCGuid,DTTEngine.TRC_ITFORM,"ActiveForm.Render","")){a.DTTObj.AddTraceToken(this.RTCGuid,DTTEngine.TRC_FORMCAPTION,"Form.Caption",this.Caption(),"")}};WebFormSrv.prototype.toString=function(){return this.Caption().stringValue()};WebFormSrv.prototype.Resize=function(b,a){};WebFormSrv.prototype.GetPadding=function(a){if(a){if(this.Caption().stringValue().length>0){return 64}else{return 16}}else{return 16}};WebFormSrv.prototype.ReleaseLock=function(){Glb.ReleaseForm(this.Frames)};WebFormSrv.prototype.DBError=function(c,b,a,e,d){var f=this.Caption()+" - "+this.Frames[c.FrIndex].Caption;this.MainFrm.ErrObj.PanelError(c,b,a.intValue(),e.intValue(),f,d)};WebFormSrv.prototype.RTCReset=function(){this.MainFrm.RTCObj.SelectForm(this.RTCGuid);this.MainFrm.RTCObj.ConfigureForm(this);for(var a=1;a<this.Frames.length;a++){var b=this.Frames[a];if(b==null){continue}if(b.Content instanceof OBookSrv){this.MainFrm.RTCObj.ConfigureBook(this,b.Content)}else{if(b.Content instanceof OButBarSrv){this.MainFrm.RTCObj.ConfigureButtonBar(this,b.Content)}else{if(b.Content instanceof ATreeSrv){this.MainFrm.RTCObj.ConfigureTree(this,b.Content)}else{if(b.Content instanceof AGraphSrv){this.MainFrm.RTCObj.ConfigureGraph(this,b.Content)}else{if(b.Content instanceof OTabViewSrv){this.MainFrm.RTCObj.ConfigureTabbed(this,b.Content)}else{if(b.Content instanceof IDPanelSrv){this.MainFrm.RTCObj.ConfigurePanel(this,b.Content);b.Content.CalcLayout()}}}}}}}this.MainFrm.RolObj.ApplyRoles(this.FormIdx,this)};WebFormSrv.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};WebFormSrv.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}return new IDVariant()};WebFormSrv.prototype.SetObjTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};WebFormSrv.prototype.GetObjTag=function(a){if(this.TagMap!=null){return this.TagMap[a.stringValue()]}return null};WebFormSrv.prototype.GetPanelsCount=function(){var b=0;for(var a=1;a<this.Frames.length;a++){if(this.Frames[a].Content!=null&&this.Frames[a].Content instanceof IDPanelSrv){b++}}return new IDVariant(b)};WebFormSrv.prototype.GetPanel=function(c){var b=0;for(var a=1;a<this.Frames.length;a++){if(this.Frames[a].Content!=null&&this.Frames[a].Content instanceof IDPanelSrv&&b++==c.intValue()){return this.Frames[a].Content}}return null};WebFormSrv.prototype.GetBooksCount=function(){var b=0;var a=Object.keys(this);for(var d=0;d<a.length;d++){var c=a[d];if(this[c] instanceof OBookSrv){b++}}return new IDVariant(b)};WebFormSrv.prototype.GetBook=function(e){var b=0;var a=Object.keys(this);for(var d=0;d<a.length;d++){var c=a[d];if(this[c] instanceof OBookSrv&&b++==e.intValue()){return this[c].BookObj}}return null};WebFormSrv.prototype.ResetUpload=function(){if(this.UploadingPanel!=null){for(var a=0;a<this.UploadingPanel.UFields();a++){if(this.UploadingPanel.bFields(a).bValues(this.UploadingPanel.AttR).Uploading){this.UploadingPanel.bFields(a).bValues(this.UploadingPanel.AttR).Uploading=false;this.UploadingPanel.bFields(a).bValues(this.UploadingPanel.AttR).RD3Change(RD3Glb.VAL_TEXT)}}this.UploadingPanel=null}};WebFormSrv.prototype.ValidateCell=function(a,e,d,b,c,g,f){};WebFormSrv.prototype.ValidateRow=function(a,b){};WebFormSrv.prototype.DynamicProperties=function(a){};WebFormSrv.prototype.CellActivated=function(a,c,b){};WebFormSrv.prototype.OnChangePage=function(a,c,b){};WebFormSrv.prototype.OnChangeLayout=function(a,c,b){};WebFormSrv.prototype.OnChangeLocking=function(a,c,b){};WebFormSrv.prototype.OnChangeRow=function(a){};WebFormSrv.prototype.OnChangeStatus=function(b,a){};WebFormSrv.prototype.OnPanelCommand=function(a,d,c,b){};WebFormSrv.prototype.BeforeFind=function(a,b){};WebFormSrv.prototype.BeforeInsert=function(a,b){};WebFormSrv.prototype.BeforeUpdate=function(a,b){};WebFormSrv.prototype.BeforeBlobUpdate=function(c,d,b,a,f,e){};WebFormSrv.prototype.OnDownloadBlob=function(d,e,c,b,h,f,a,g){};WebFormSrv.prototype.BeforeDelete=function(a,b){};WebFormSrv.prototype.AfterInsert=function(a){};WebFormSrv.prototype.AfterUpdate=function(a){};WebFormSrv.prototype.AfterFind=function(a,b){};WebFormSrv.prototype.OnSelectingRow=function(a){};WebFormSrv.prototype.OnSorting=function(a,c,b){};WebFormSrv.prototype.OnChangeSelection=function(b,a,d,c){};WebFormSrv.prototype.AfterBlobUpdate=function(c,b,a,d){};WebFormSrv.prototype.AfterDelete=function(a){};WebFormSrv.prototype.BeforeCommit=function(a,b){};WebFormSrv.prototype.AfterCommit=function(c,b,a){};WebFormSrv.prototype.OnDBError=function(a,e,d,h,c,g,b,f){};WebFormSrv.prototype.TabClick=function(b,a,c){};WebFormSrv.prototype.NodeClick=function(a,b){};WebFormSrv.prototype.OnTreeDropNode=function(b,c,e,g,f,d,a){};WebFormSrv.prototype.OnTreeExpandNode=function(a,c,b){};WebFormSrv.prototype.OnTreeActivateNode=function(a,c,b){};WebFormSrv.prototype.OnTreeChangeSelNode=function(a,d,e,c,b){};WebFormSrv.prototype.OnTreeDropDoc=function(b,f,g,e,d,a,c){};WebFormSrv.prototype.OnTreeExpandDoc=function(a,c,b){};WebFormSrv.prototype.OnTreeActivateDoc=function(a,c,b){};WebFormSrv.prototype.OnTreeChangeSelDoc=function(a,d,e,c,b){};WebFormSrv.prototype.OnFormattingPage=function(b,a){};WebFormSrv.prototype.OnAfterFormattingPage=function(b,a){};WebFormSrv.prototype.OnFormattingSection=function(a,b){};WebFormSrv.prototype.OnAfterFormattingSection=function(a,b){};WebFormSrv.prototype.OnChangingSpan=function(c,e,a,b,d){};WebFormSrv.prototype.OnBoxDrop=function(b,c,a){};WebFormSrv.prototype.OnBoxTransform=function(b,e,f,d,g,a,c){};WebFormSrv.prototype.OnConnecting=function(b,a){};WebFormSrv.prototype.Activated=function(a,c,b){};WebFormSrv.prototype.OnIMDBUpdate=function(a,b){};WebFormSrv.prototype.OnPreview=function(a){};WebFormSrv.prototype.OnPrint=function(c,d,a,b){};WebFormSrv.prototype.CreateDocument=function(a,c,b){};WebFormSrv.prototype.OnOpenPopup=function(a,c,b){};WebFormSrv.prototype.OnCmdSetCommand=function(a,d,c,b){};WebFormSrv.prototype.OnCmdSetGeneralDrag=function(a,d,c,b){};WebFormSrv.prototype.OnCmdSetGeneralDrop=function(a,d,c,b){};WebFormSrv.prototype.OnChangeCollapse=function(a,c,b){};WebFormSrv.prototype.OnGraphClick=function(a,c,b){};WebFormSrv.prototype.OnGraphOptions=function(b,a){};WebFormSrv.prototype.OnRenderToolbar=function(a,c,b){};WebFormSrv.prototype.OnBookCommand=function(a,d,c,b){};WebFormSrv.prototype.OnCmdSetChangeExpand=function(b,a,c){};WebFormSrv.prototype.OnTreeChangeExpandNode=function(a,d,c,b){};WebFormSrv.prototype.OnTreeChangeExpandDoc=function(a,d,c,b){};WebFormSrv.prototype.OnMouseClick=function(d,b,h,g,k,e,f,a,j){};WebFormSrv.prototype.OnMouseDoubleClick=function(d,b,h,g,k,e,f,a,j){};WebFormSrv.prototype.OnMouseClick=function(c,d,b,h,g,a,e,f){};WebFormSrv.prototype.OnMouseDoubleClick=function(c,d,b,h,g,a,e,f){};WebFormSrv.prototype.OnMouseClick=function(b,a,f,d,j,c,e,g,h){};WebFormSrv.prototype.OnMouseDoubleClick=function(b,a,f,d,j,c,e,g,h){};WebFormSrv.prototype.OnMouseClick=function(c,b,g,e,j,d,f,a,h){};WebFormSrv.prototype.OnMouseDoubleClick=function(c,b,g,e,j,d,f,a,h){};WebFormSrv.prototype.OnMouseClick=function(d,e,b,h,g,a,c,f){};WebFormSrv.prototype.OnMouseDoubleClick=function(d,e,b,h,g,a,c,f){};WebFormSrv.prototype.OnReorderColum=function(b,c,a){};WebFormSrv.prototype.OnResizeColum=function(a,c,b){};WebFormSrv.prototype.OnGenericDrag=function(b,a,d,c){};WebFormSrv.prototype.OnGenericDrop=function(a,j,k,c,g,f,l,d,b,e,h){};WebFormSrv.prototype.OnGenericDrag=function(b,a,c,d){};WebFormSrv.prototype.OnGenericDrop=function(a,g,j,b,e,d,k,c,h,f){};WebFormSrv.prototype.OnGenericDrag=function(b,a,c,d){};WebFormSrv.prototype.OnGenericDrop=function(a,g,h,b,f,e,j,c,d){};WebFormSrv.prototype.OnGenericDrag=function(b,a,c,d){};WebFormSrv.prototype.OnGenericDrop=function(a,g,h,c,f,e,j,d,b){};WebFormSrv.prototype.OnExpandingGroup=function(b,a,c){};WebFormSrv.prototype.OnChangeGroupCollapse=function(a,b){};WebFormSrv.prototype.OnShowMultipleSelection=function(a,d,b,c){};WebFormSrv.prototype.OnChangeTextSelection=function(b,c,a,d){};WebFormSrv.prototype.OnFocus=function(a,b,c){};WebFormSrv.prototype.OnFrameKeyPress=function(b,a,d,c){};WebFormSrv.prototype.OnFormKeyPress=function(d,a,c,b){};WebFormSrv.prototype.OnGetLKE=function(b,c,d,g,a,f,e){};WebFormSrv.prototype.OnMouseOver=function(a,b,c){};WebFormSrv.prototype.OnFieldListVisibilityChanged=function(a,d,c,b){};WebFormSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.FormIdx};WebFormSrv.prototype.GetRD3Name=function(){return"frm"};WebFormSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};WebFormSrv.prototype.RD3RenderDifferences=function(h,m){if(this.MainFrm.ActiveForm()!=null&&this.MainFrm.ActiveForm()==this){this.ActivedTick=this.MainFrm.ClickCounter()}this.DTTTrace(this.MainFrm);var b=null;if(m){b=h.AddNewElement(this.GetRD3Name())}if(!m&&!this.RD3Changed){for(var g=1;g<this.Frames.length;g++){if(this.Frames[g].RD3NewObj||this.Frames[g].RD3DelObj){this.RD3Changed=true;break}}}for(var g=0;g<this.Messages.Count();g++){var d=this.Messages[g];if(!d.RD3Rendered){this.RD3Changed=true;break}}if(b==null&&this.RD3Changed){b=h.AddNewElement("chg")}if(b!=null){b.SetAttribute("id",this.GetRD3Ident())}var l=this.RD3Changed;if(m||this.RD3Changed){for(var g=0;g<this.RD3PropChg.length;g++){if(this.RD3PropChg[g]||m){this.SetRD3Property(g,b,m)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(m){if(this.FormListEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("flc",this.FormListEventDef.toString())}if(this.ToolbarEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("clk",this.ToolbarEventDef.toString())}if(this.ResizeEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("res",this.ResizeEventDef.toString())}if(this.ShowAnimationDef!=null){b.SetAttribute("sha",this.ShowAnimationDef)}if(this.ModalAnimationDef!=null){b.SetAttribute("mda",this.ModalAnimationDef)}if(this.MessageAnimationDef!=null){b.SetAttribute("mga",this.MessageAnimationDef)}if(this.LastMessageAnimationDef!=null){b.SetAttribute("lma",this.LastMessageAnimationDef)}if(this.PreviewAnimationDef!=null){b.SetAttribute("pra",this.PreviewAnimationDef)}if(this.DockedAnimationDef!=null){b.SetAttribute("dka",this.DockedAnimationDef)}if(this.PopupResizeAnimationDef!=null){b.SetAttribute("ppr",this.PopupResizeAnimationDef)}if(this.ListenKeys!=0){b.SetAttribute("hks",this.ListenKeys.toString())}if(this.Owner!=0){var j=this.MainFrm.GetFormByIndex(this.Owner);if(j!=null){b.SetAttribute("own",j.GetRD3Ident())}}}var e=(m)?b:h;for(var g=1;g<this.Frames.length;g++){if(this.Frames[g].RD3NewObj){this.Frames[g].RD3RenderDifferences(b,true);this.Frames[g].RD3NewObj=false}else{if(this.Frames[g].RD3DelObj&&this.Frames[g].Content!=null){if(!m){var c=h.AddNewElement("chg");c.SetAttribute("id",this.Frames[g].GetRD3Ident());c.SetAttribute("dcl","1")}this.Frames[g]=new AFrameSrv(g);this.Frames[g].RD3DelObj=true}else{l|=this.Frames[g].RD3RenderDifferences(e,m)}}}if(this.PreviewBook!=null){var f=null;if(m){f=e.AddNewElement(this.PreviewBook.GetRD3Name());f.SetAttribute("id",this.PreviewBook.GetRD3Ident());f.SetAttribute("cap",this.PreviewBook.BookObj.GetName())}l|=(this.PreviewBook.RD3RenderDifferences(f,e,m)!=null)}for(var g=0;g<this.Messages.Count();g++){var d=this.Messages[g];if(!d.RD3Rendered){l|=d.RD3RenderDifferences(b,true)}else{l|=d.RD3RenderDifferences(e,m)}}for(var g=0;g<this.Messages.Count();g++){var k=this.Messages[g];if(!k.AutoDelete){continue}if(k.Type!=AMessageSrv.MSG_INFO&&(k.Source instanceof IDPanelSrv||k.Source instanceof PFieldSrv||k.Source instanceof IDDocument||k.Source instanceof DOMDProp)){k.RD3Rendered=false;continue}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,28,"Form.RenderMessages","Form "+this.Caption()+": remove temporary message "+k.Text);this.Messages.Remove(k);g--;this.RD3Changed=true}if(m&&this.BaseTimerIdx>0){this.MainFrm.TimerObj.RD3RenderDifferences(b,true,this.FormIdx)}if(m&&this.BaseCmdSetIdx>0){this.MainFrm.CmdObj.RD3RenderDifferences(b,true,this.FormIdx)}return l};WebFormSrv.prototype.SetRD3Property=function(b,d,c){switch(b){case RD3Glb.FRM_IDXFORM:d.SetAttribute("idx",this.FormIdx.toString());break;case RD3Glb.FRM_CAPTION:var a=this.Caption().stringValue();d.SetAttribute("cap",a);break;case RD3Glb.FRM_WEBCAPTION:var a=this.WebCaption().stringValue();if(this.MainFrm.ParamsObj().DemoMode==1){a+="&nbsp;(DEMO)"}d.SetAttribute("wcp",a);break;case RD3Glb.FRM_IMAGE:if(this.iImage.length==0&&c){break}d.SetAttribute("img",this.iImage);break;case RD3Glb.FRM_MODAL:if(this.OpenAs==Glb.OPEN_MDI&&c){break}d.SetAttribute("mod",this.OpenAs.toString());break;case RD3Glb.FRM_DOCKED:if(!this.Docked&&c){break}d.SetAttribute("doc",this.Docked?"1":"0");break;case RD3Glb.FRM_DOCKTYPE:if(this.DockType==0&&c){break}d.SetAttribute("dot",this.DockType.toString());break;case RD3Glb.FRM_VISIBLE:if(this.Visible&&c){break}d.SetAttribute("vis",this.Visible?"1":"0");break;case RD3Glb.FRM_TOOLBARPOS:if(this.ToolbarPosition==Glb.FORMTOOL_LEFT&&c){break}d.SetAttribute("tbp",this.ToolbarPosition.toString());break;case RD3Glb.FRM_BORDERTYPE:if(this.iBorderType==Glb.BORDER_THICK&&c){break}d.SetAttribute("bdt",this.iBorderType.toString());break;case RD3Glb.FRM_VISPROP:if(this.iVisualFlags==-1&&c){break}d.SetAttribute("vfl",this.iVisualFlags.toString());break;case RD3Glb.FRM_FORMLEFT:if(this.FormLeft==-1&&c){break}d.SetAttribute("lef",this.FormLeft.toString());break;case RD3Glb.FRM_FORMTOP:if(this.FormTop==-1&&c){break}d.SetAttribute("top",this.FormTop.toString());break;case RD3Glb.FRM_FORMWIDTH:var g=this.FormWidth;if(c&&this.OpenAs==Glb.OPEN_MDI&&this.MainFrm.ParamsObj().UseFluid){g=-1}if((this.Docked)&&g==-1){var e=this.Frames[1].GetTotalSize();g=e.Width}if(g==-1&&c){break}d.SetAttribute("wid",g.toString());break;case RD3Glb.FRM_FORMHEIGHT:var g=this.FormHeight;if(c&&this.OpenAs==Glb.OPEN_MDI&&this.MainFrm.ParamsObj().UseFluid){g=-1}if((this.Docked)&&g==-1){var e=this.Frames[1].GetTotalSize();g=e.Height}if(g==-1&&c){break}d.SetAttribute("hei",g.toString());break;case RD3Glb.FRM_RESMODEW:if(this.ResModeW==0&&c){break}d.SetAttribute("rew",this.ResModeW.toString());break;case RD3Glb.FRM_RESMODEH:if(this.ResModeH==0&&c){break}d.SetAttribute("reh",this.ResModeH.toString());break;case RD3Glb.FRM_PREVIEW:if(this.PreviewBook==null&&c){break}d.SetAttribute("pre",(this.PreviewBook==null)?"":this.PreviewBook.GetRD3Ident());if(this.PreviewBook!=null&&!c){var f=d.AddNewElement(this.PreviewBook.GetRD3Name());f.SetAttribute("id",this.PreviewBook.GetRD3Ident());f.SetAttribute("cap",this.PreviewBook.BookObj.GetName());this.PreviewBook.RD3RenderDifferences(f,d,true)}break;case RD3Glb.FRM_WINSTATE:if(this.iWindowState==0&&c){break}d.SetAttribute("wst",this.iWindowState.toString());break;case RD3Glb.FRM_BACKBUTTXT:if(this.iBackButTxt.length==0&&c){break}d.SetAttribute("bbt",this.iBackButTxt);break;case RD3Glb.FRM_CLOSEONSEL:if(c&&!this.CloseOnSelection){break}d.SetAttribute("cls",this.CloseOnSelection?"1":"0");break;case RD3Glb.FRM_CLASSNAME:if((this.iClassName==null||this.iClassName.length==0)&&c){break}d.SetAttribute("cln",(this.iClassName==null)?"":this.iClassName);break;case RD3Glb.FRM_RELATEDTO:if((this.iRelatedTo==null||this.iRelatedTo.length==0)&&c){break}d.SetAttribute("rlt",(this.iRelatedTo==null)?"":this.iRelatedTo);break;case RD3Glb.FRM_RELATEPOS:if(this.iRelatedPlacement==0&&c){break}d.SetAttribute("rlp",this.iRelatedPlacement.toString());break}};WebFormSrv.prototype.RD3Reset=function(){for(var a=0;a<this.Frames.length;a++){if(this.Frames[a]==null||this.Frames[a].Content==null){continue}if(this.Frames[a].Content instanceof IDPanelSrv){this.Frames[a].Content.ResetRD3Cache()}if(this.Frames[a].Content instanceof OBookSrv){this.Frames[a].Content.RD3ResetPageCache(true)}if(this.Frames[a].Content instanceof ASubFormSrv&&this.Frames[a].Content.GetIntForm()!=null){this.Frames[a].Content.GetIntForm().RD3Reset()}}if(this.PreviewBook!=null){this.PreviewBook.RD3ResetPageCache(true)}};WebFormSrv.prototype.FormLeftPosition=function(){if(this.MainFrm.ParamsObj().UseRD3&&(this.iBorderType==RD3Glb.BORDER_THICK)){return this.FormLeft-this.GetModalBorderWidth()}return this.FormLeft};WebFormSrv.prototype.set_FormLeftPosition=function(c){if(!this.FreezePos){var a=new IDVariant(c);var b=new IDVariant(this.FormTopPosition());this.RD3Reposition(a,b,true)}else{this.FormLeft=c}this.RD3Change(RD3Glb.FRM_FORMLEFT)};WebFormSrv.prototype.FormTopPosition=function(){if(this.MainFrm.ParamsObj().UseRD3&&(this.iBorderType==RD3Glb.BORDER_THICK)){return this.FormTop-this.GetModalBorderWidth()}return this.FormTop};WebFormSrv.prototype.set_FormTopPosition=function(c){if(!this.FreezePos){var a=new IDVariant(this.FormLeftPosition());var b=new IDVariant(c);this.RD3Reposition(a,b,true)}else{this.FormTop=c}this.RD3Change(RD3Glb.FRM_FORMTOP)};WebFormSrv.prototype.FormWidthSize=function(){return(this.FormWidth==-1?this.DesignWidth:this.FormWidth)+(this.MainFrm.ParamsObj().UseRD3&&this.OpenAs!=Glb.OPEN_MDI?2*this.GetModalBorderWidth():0)};WebFormSrv.prototype.set_FormWidthSize=function(c){if(!this.FreezePos){var a=new IDVariant(c);var b=new IDVariant(this.FormHeightSize());this.RD3Resize(a,b,true)}else{this.FormWidth=c}this.RD3Change(RD3Glb.FRM_FORMWIDTH)};WebFormSrv.prototype.FormHeightSize=function(){return(this.FormHeight==-1?this.DesignHeight:this.FormHeight)+(this.MainFrm.ParamsObj().UseRD3&&this.OpenAs!=Glb.OPEN_MDI?2*this.GetModalBorderWidth():0)};WebFormSrv.prototype.set_FormHeightSize=function(a){if(!this.FreezePos){var b=new IDVariant(this.FormWidthSize());var c=new IDVariant(a);this.RD3Resize(b,c,true)}else{this.FormHeight=a}this.RD3Change(RD3Glb.FRM_FORMHEIGHT)};WebFormSrv.prototype.ToolPosition=function(){return this.ToolbarPosition};WebFormSrv.prototype.set_ToolPosition=function(a){this.ToolbarPosition=a;this.RD3Change(RD3Glb.FRM_TOOLBARPOS)};WebFormSrv.prototype.BorderType=function(){return this.iBorderType};WebFormSrv.prototype.set_BorderType=function(a){this.iBorderType=a;this.RD3Change(RD3Glb.FRM_BORDERTYPE)};WebFormSrv.prototype.VisualFlag=function(a){return this.iVisualFlags&a};WebFormSrv.prototype.set_VisualFlag=function(b,a){this.iVisualFlags=(this.iVisualFlags&(~a))|b;this.RD3Change(RD3Glb.FRM_VISPROP)};WebFormSrv.prototype.bVisualFlag=function(a){return(this.VisualFlag(a))!=0};WebFormSrv.prototype.set_bVisualFlag=function(a,b){this.set_VisualFlag((b?a:0),a)};WebFormSrv.prototype.Image=function(){return this.iImage};WebFormSrv.prototype.set_Image=function(a){this.iImage=a;this.RD3Change(RD3Glb.FRM_IMAGE)};WebFormSrv.prototype.WindowState=function(){return this.iWindowState};WebFormSrv.prototype.set_WindowState=function(a){this.RD3ChangeWindowState(new IDVariant(a))};WebFormSrv.prototype.BackButTxt=function(){return this.iBackButTxt};WebFormSrv.prototype.set_BackButTxt=function(a){this.iBackButTxt=a;this.RD3Change(RD3Glb.FRM_BACKBUTTXT)};WebFormSrv.prototype.GetSubForm=function(c){if(this.Frames==null){return}for(var a=0;a<this.Frames.length;a++){if(this.Frames[a]!=null&&this.Frames[a].Content!=null&&this.Frames[a].Content instanceof ASubFormSrv){var b=this.Frames[a].Content;if(b.pSubForm!=null&&!c.Contains(b.pSubForm)){c.Add(b.pSubForm);b.pSubForm.GetSubForm(c)}}else{if(this.Frames[a]!=null&&this.Frames[a].Content!=null&&this.Frames[a].Content instanceof OBookSrv){this.Frames[a].Content.BookObj.Book.GetSubForm(c)}}}};WebFormSrv.prototype.RD3Resize=function(c,f,g){this.FreezePos=true;try{var j=c.intValue();var b=f.intValue();var d=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,195,this.GetClass().GetClassName()+".FireOnResize","Form "+this.GetClass().GetClassName()+": Fire On Resize Event (w="+(c.intValue())+", h="+(f.intValue())+")")}this.OnResize(c,f,d);if(d.isFalse()){var e=c.intValue();var a=f.intValue();if(this.OpenAs!=Glb.OPEN_MDI&&this.MainFrm.ParamsObj().UseRD3&&g){e-=2*this.GetModalBorderWidth();a-=2*this.GetModalBorderWidth()}this.FormWidth=e;this.FormHeight=a;if(this.FormWidth!=j){this.RD3Change(RD3Glb.FRM_FORMWIDTH)}if(this.FormHeight!=b){this.RD3Change(RD3Glb.FRM_FORMHEIGHT)}}else{this.RD3Change(RD3Glb.FRM_FORMWIDTH);this.RD3Change(RD3Glb.FRM_FORMHEIGHT)}}finally{this.FreezePos=false}};WebFormSrv.prototype.RD3Reposition=function(b,c,e){this.FreezePos=true;try{var a=c.intValue();var h=b.intValue();var d=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,195,this.GetClass().GetClassName()+".FireOnMove","Form "+this.GetClass().GetClassName()+": Fire On Move Event (t="+(c.intValue())+", l="+(b.intValue())+")")}this.OnMove(b,c,d);if(d.isFalse()){var g=b.intValue();var f=c.intValue();if(this.MainFrm.ParamsObj().UseRD3&&e&&this.iBorderType==RD3Glb.BORDER_THICK){g+=this.GetModalBorderWidth();f+=this.GetModalBorderWidth()}this.FormLeft=g;this.FormTop=f;if(this.FormLeft!=h){this.RD3Change(RD3Glb.FRM_FORMLEFT)}if(this.FormTop!=a){this.RD3Change(RD3Glb.FRM_FORMTOP)}}else{this.RD3Change(RD3Glb.FRM_FORMLEFT);this.RD3Change(RD3Glb.FRM_FORMTOP)}}finally{this.FreezePos=false}};WebFormSrv.prototype.RD3ChangeWindowState=function(a){var d=this.iWindowState;if(a.intValue()!=d){try{var b=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,195,this.GetClass().GetClassName()+".FireOnChangeState","Form "+this.GetClass().GetClassName()+": Fire OnChangeState (v="+(a.intValue())+")")}this.OnChangeState(a,b);if(b.isFalse()){this.iWindowState=a.intValue();if(this.iWindowState!=d){this.RD3Change(RD3Glb.FRM_WINSTATE)}if(this.iWindowState==Glb.WS_MINIMIZE&&this.MainFrm.ActiveForm()==this){this.MainFrm.ActivateNextForm()}}else{this.RD3Change(RD3Glb.FRM_WINSTATE)}}catch(c){}}};WebFormSrv.prototype.GetModalBorderWidth=function(){if(this.iBorderType==RD3Glb.BORDER_THICK){return 8}if(this.iBorderType==RD3Glb.BORDER_THIN){return 2}if(this.iBorderType==RD3Glb.BORDER_NONE){return 0}return 0};WebFormSrv.prototype.ResetTooltip=function(){var a=this.MainFrm.RD3AddEvent("restip",this.GetRD3Ident());a.CanSendInFulltree=true};WebFormSrv.prototype.KeyHandle=function(){return this.ListenKeys};WebFormSrv.prototype.set_KeyHandle=function(a){this.ListenKeys=a};WebFormSrv.prototype.FireKeyPress=function(c,a,d,b){if((this.KeyHandle()&a)==0){return}this.OnFormKeyPress(new IDVariant(c),new IDVariant(a),new IDVariant(d),b)};WebFormSrv.prototype.RemovePanelTempMsg=function(b){for(var a=0;a<this.Messages.Count();a++){var e=this.Messages[a];if(!e.AutoDelete){continue}var f=false;if(e.Source==b){f=true}else{if(e.Source instanceof PFieldSrv&&e.Source.Parent==b){f=true}else{if(e.Source instanceof IDDocument||e.Source instanceof DOMDProp){if(b.Queries[0]==null){continue}if(b.Queries[0].Document!=null){f=this.CheckMessageForDoc(e,b.Queries[0].Document)}else{if(b.Queries[0].IDColl!=null){b.Queries[0].IDColl.MoveFirst();while(!b.Queries[0].IDColl.IsEof()){if(this.CheckMessageForDoc(e,b.Queries[0].IDColl.GetAt())){f=true;break}b.Queries[0].IDColl.MoveNext()}}}}}}if(f){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,28,"Form.RenderMessages","Form "+this.Caption()+": remove temporary message "+e.Text);this.Messages.Remove(e);a--;this.RD3Changed=true}}if(b.Queries[0].IsDO){for(var c=0;c<this.Frames.length;c++){if(this.Frames[c]!=null&&this.Frames[c].Content!=null&&this.Frames[c].Content!=b&&this.Frames[c].Content instanceof IDPanelSrv){var d=this.Frames[c].Content;if(d.MasterPanelIdx!=0&&d.MasterPanelIdx==b.FrIndex){this.RemovePanelTempMsg(d)}}}}};WebFormSrv.prototype.CheckMessageForDoc=function(h,g){var f=g.GetMD();if(h.Source instanceof IDDocument){if(h.Source==g){return true}}else{if(h.Source instanceof DOMDProp){for(var e=1;e<=f.GetNumProp();e++){if(h.Source==f.GetProp(e)){return true}}}}for(var b=1;b<=f.GetNumColl();b++){var k=g.GetCollByIndex(b);var d=k.GetCollection();for(var a=0;a<d.length;a++){if(this.CheckMessageForDoc(h,d[a])){return true}}}return false};WebFormSrv.prototype.RelateTo=function(a,b){if(!b){b=0}this.iRelatedTo=a;this.iRelatedPlacement=b;this.RD3Change(RD3Glb.FRM_RELATEDTO);this.RD3Change(RD3Glb.FRM_RELATEPOS)};WebFormSrv.IsMyInstance=function(a){return(a instanceof WebFormSrv)};WebFormSrv.GetClassName=function(a){return(a?"com.progamma.ids.":"")+"WebFormSrv"};WebFormSrv.prototype.GetClass=function(){return WebFormSrv};WebFormSrv.prototype.GetType=function(){return{Name:"WebFormSrv"}};function TBZone(){this.Prefix="";this.Suffix='&nbsp;<img align=absmiddle src="images/sep.gif" alt="">';this.CmdSep=""}WebFrameSrv.MAX_CUSTOMCOMMANDS=16;WebFrameSrv.FIRST_CUSTOMCOMMANDS=18;WebFrameSrv.MAX_TBZONES=10;WebFrameSrv.CommandZones=new Array(48);WebFrameSrv.CZ_COLLAPSE=32;WebFrameSrv.CZ_LOCK=33;WebFrameSrv.CZ_STATUSBAR=34;WebFrameSrv.CZ_CMDSET=35;WebFrameSrv.CZ_QBETIP=36;WebFrameSrv.TBZones=new Array(WebFrameSrv.MAX_TBZONES+1);function WebFrameSrv(a){this.iGuid="";this.Visible=true;this.Collapsed=false;this.Collapsable=true;this.iExposed=true;this.Enabled=true;this.iLocked=(a?a.MainFrm.ParamsObj().PanelIsLockable:false);this.Lockable=(a?a.MainFrm.ParamsObj().PanelIsLockable:false);this.ShowInfoMessages=(a?a.MainFrm.ParamsObj().InfoMessages:false);this.iImage="";this.Parent=a;this.Code="";this.MainFrm=(a?a.MainFrm:null);this.Width=0;this.Height=0;this.FrIndex=-1;this.iCanDrag=false;this.iCanDrop=false;this.ShowScrollbar=Glb.FORMSCROLL_BOTH;this.TagMap=null;this.RD3FrameChanged=false;this.RD3FramePropChg=new BitArray(RD3Glb.WFR_MAXPROPS);this.CollapseClickEventDef=RD3Glb.EVENT_ACTIVE;this.MouseClickEventDef=RD3Glb.EVENT_CLIENTSIDE;this.MouseDoubleClickEventDef=RD3Glb.EVENT_CLIENTSIDE;this.CollapseAnimationDef=null;this.ListenKeys=0}WebFrameSrv.prototype.CanBeUnlocked=function(){for(var a=1;a<this.Parent.Frames.length;a++){if(this.Parent.Frames[a]!=null&&this.Parent.Frames[a].Content!=null&&this.Parent.Frames[a].Content instanceof IDPanelSrv&&this.Parent.Frames[a].Content!=this&&this.Parent.Frames[a].Content.Lockable){if(this.Parent.Frames[a].Content.Status()==Glb.PS_UPDATE){return false}}}return true};WebFrameSrv.prototype.Locked=function(){return this.iLocked};WebFrameSrv.prototype.set_Locked=function(a){if(a==false){if(!this.CanBeUnlocked()){return}for(var b=1;b<this.Parent.Frames.length;b++){if(this.Parent.Frames[b]!=null&&this.Parent.Frames[b].Content!=null&&this.Parent.Frames[b].Content!=this&&this.Parent.Frames[b].Content.Lockable){this.Parent.Frames[b].Content.set_Locked(true)}}}this.iLocked=a;this.RD3FrameChange(RD3Glb.WFR_LOCKED)};WebFrameSrv.prototype.Exposed=function(){return this.iExposed};WebFrameSrv.prototype.set_Exposed=function(a){this.iExposed=a;if(!a&&this.Parent!=null){this.Parent.SetMessage(this,0,"","","INFO",0,false)}};WebFrameSrv.prototype.set_Visible=function(a){if(this.Visible!=a){this.Visible=a;this.RD3FrameChange(RD3Glb.WFR_VISIBLE);if(this.Parent!=null&&this.FrIndex>-1&&this.Parent.Frames[this.FrIndex].InTabbed&&this.Parent.Frames[this.Parent.Frames[this.FrIndex].TabIdx]!=null){this.Parent.Frames[this.Parent.Frames[this.FrIndex].TabIdx].Content.ChangeItemVisibility(this.FrIndex,this.MainFrm)}}};WebFrameSrv.prototype.set_Collapsed=function(d){if(this.Collapsed!=d){var b=new IDVariant();var a="";if(this.FrIndex>0&&this.Parent!=null){a=this.Parent.Frames[this.FrIndex].Caption}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",30,"WebFrame.SetCollapsed","Frame "+a+": Firing OnChangeCollapse event");if(this.Parent!=null){this.Parent.OnChangeCollapse(this,new IDVariant(d),b)}if(b.isFalse()){if(this.Parent.PreviewBook==this){this.Parent.PreviewBook.RD3ResetPageCache(true);this.Parent.PreviewBook=null;this.Parent.RD3Change(RD3Glb.FRM_PREVIEW)}else{this.RD3FrameChange(RD3Glb.WFR_COLLAPSED);this.Collapsed=d}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",30,"WebFrame.SetCollapsed","Frame "+a+(d?" collapsed":" expanded"));this.MainFrm.DTTObj.SetRequestName((d?"Collapse":"Expand")+" Frame","Frame "+a+(d?" collapsed":" expanded"),DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_FRMMENU,"Frame "+a+(d?" collapsed":" expanded"),"","exp");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Apri il riquadro "+a)}}};WebFrameSrv.prototype.set_Collapsable=function(a){if(this.Collapsable!=a){this.Collapsable=a;this.RD3FrameChange(RD3Glb.WFR_COLLAPSABLE)}};WebFrameSrv.prototype.CanDrag=function(){return this.iCanDrag};WebFrameSrv.prototype.set_CanDrag=function(a){this.iCanDrag=a;this.RD3FrameChange(RD3Glb.WFR_DRAG)};WebFrameSrv.prototype.CanDrop=function(){return this.iCanDrop};WebFrameSrv.prototype.set_CanDrop=function(a){this.iCanDrop=a;this.RD3FrameChange(RD3Glb.WFR_DROP)};WebFrameSrv.prototype.Image=function(){return this.iImage};WebFrameSrv.prototype.set_Image=function(a){this.iImage=a;this.RD3FrameChange(RD3Glb.WFR_IMAGE)};WebFrameSrv.prototype.ProcessRequest=function(b,a){};WebFrameSrv.prototype.DownloadBlob=function(a,b){return false};WebFrameSrv.prototype.GetCaption=function(b,a){return Glb.HTMLEncode(b,false,true)};WebFrameSrv.prototype.HasCaptionCommands=function(){return false};WebFrameSrv.prototype.SearchObject=function(a){return null};WebFrameSrv.prototype.GetContentSize=function(){return null};WebFrameSrv.prototype.Resize=function(b,a){this.Width=b-4;this.Height=a};WebFrameSrv.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};WebFrameSrv.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}return new IDVariant()};WebFrameSrv.prototype.SetObjTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};WebFrameSrv.prototype.GetObjTag=function(a){if(this.TagMap!=null){return this.TagMap[a.stringValue()]}return null};WebFrameSrv.InitCustomCommand=function(e,g,a,c,d,f){var b=0;if(g<0){b=WebFrameSrv.log2(Math.abs(g))+8}else{b=WebFrameSrv.log2(g);b-=WebFrameSrv.FIRST_CUSTOMCOMMANDS}if(b>=0&&b<WebFrameSrv.MAX_CUSTOMCOMMANDS){if(e.CustomCommands[b]==null){e.CustomCommands[b]=new ACommandSrv();e.CustomCommands[b].Caption=a;e.CustomCommands[b].ToolTip=d;e.CustomCommands[b].Image=c;e.CustomCommands[b].FKNum=f}}};WebFrameSrv.InitTBZones=function(){if(WebFrameSrv.TBZones[0]!=null){return}for(var a=0;a<=WebFrameSrv.MAX_TBZONES;a++){WebFrameSrv.TBZones[a]=new TBZone()}WebFrameSrv.TBZones[0].Prefix="";WebFrameSrv.TBZones[0].Suffix="";WebFrameSrv.CommandZones[WebFrameSrv.CZ_COLLAPSE]=1;WebFrameSrv.CommandZones[WebFrameSrv.CZ_LOCK]=1;WebFrameSrv.CommandZones[WebFrameSrv.CZ_STATUSBAR]=2;WebFrameSrv.CommandZones[WebFrameSrv.CZ_QBETIP]=2;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_NAVIGATION)]=3;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_FORMLIST)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_SEARCH)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_FIND)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CANCEL)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_REQUERY)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_DELETE)]=5;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_INSERT)]=6;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_UPDATE)]=6;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_DUPLICATE)]=6;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_PRINT)]=7;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CSV)]=7;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_ATTACH)]=7;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_GROUP)]=7;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM1)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM2)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM3)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM4)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM5)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM6)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM7)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM8)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(Glb.PCM_CUSTOM9))+WebFrameSrv.CZ_QBETIP+1]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(Glb.PCM_CUSTOM10))+WebFrameSrv.CZ_QBETIP+1]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(Glb.PCM_CUSTOM11))+WebFrameSrv.CZ_QBETIP+1]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(Glb.PCM_CUSTOM12))+WebFrameSrv.CZ_QBETIP+1]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(Glb.PCM_CUSTOM13))+WebFrameSrv.CZ_QBETIP+1]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(Glb.PCM_CUSTOM14))+WebFrameSrv.CZ_QBETIP+1]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(Glb.PCM_CUSTOM15))+WebFrameSrv.CZ_QBETIP+1]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(Glb.PCM_CUSTOM16))+WebFrameSrv.CZ_QBETIP+1]=8;WebFrameSrv.CommandZones[WebFrameSrv.CZ_CMDSET]=9};WebFrameSrv.InitTBZone=function(d,b,c,a){if(d>=0&&d<=WebFrameSrv.MAX_TBZONES){WebFrameSrv.TBZones[d].Prefix=b;WebFrameSrv.TBZones[d].Suffix=c;WebFrameSrv.TBZones[d].CmdSep=a}};WebFrameSrv.InitCommandZone=function(b,a,c){if(c<0||c>WebFrameSrv.MAX_TBZONES){return}if(a!=0){WebFrameSrv.CommandZones[a]=c}else{if(b>0){WebFrameSrv.CommandZones[WebFrameSrv.log2(b)]=c}else{WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.abs(b))+WebFrameSrv.CZ_QBETIP+1]=c}}};WebFrameSrv.prototype.GetCommandZones=function(a){if(a>0){return WebFrameSrv.CommandZones[WebFrameSrv.log2(a)]}else{return WebFrameSrv.CommandZones[WebFrameSrv.log2(Math.Abs(a))+WebFrameSrv.CZ_QBETIP+1]}};WebFrameSrv.log2=function(b){var a=0;while(b!=0){a++;b>>=1}a--;return a};WebFrameSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.FrIndex+":"+this.Parent.FormIdx};WebFrameSrv.prototype.GetRD3Name=function(){return"wfr"};WebFrameSrv.prototype.RD3FrameChange=function(a,b){if(b==undefined){b=true}this.RD3FramePropChg[a]=b;this.RD3FrameChanged=true};WebFrameSrv.prototype.RD3RenderDifferences=function(e,c,d){var a=null;if(e==null&&this.RD3FrameChanged){e=c.AddNewElement("chg");e.SetAttribute("id",this.GetRD3Ident());a=e}if(d||this.RD3FrameChanged){for(var b=0;b<this.RD3FramePropChg.length;b++){if(this.RD3FramePropChg[b]||d){WebFrameSrv.prototype.SetRD3Property.call(this,b,e,d)}}this.RD3FrameChanged=false;this.RD3FramePropChg.SetAll(false)}if(d){if(this.CollapseClickEventDef!=RD3Glb.EVENT_ACTIVE){e.SetAttribute("clc",this.CollapseClickEventDef.toString())}if(this.MouseClickEventDef!=RD3Glb.EVENT_CLIENTSIDE){e.SetAttribute("mck",this.MouseClickEventDef.toString())}if(this.MouseDoubleClickEventDef!=RD3Glb.EVENT_CLIENTSIDE){e.SetAttribute("mdk",this.MouseDoubleClickEventDef.toString())}if(this.CollapseAnimationDef!=null){e.SetAttribute("cla",this.CollapseAnimationDef)}if(this.ListenKeys!=0){e.SetAttribute("hks",this.ListenKeys.toString())}}return a};WebFrameSrv.prototype.SetRD3Property=function(a,d,c){switch(a){case RD3Glb.WFR_VISIBLE:if(this.Visible&&c){break}d.SetAttribute("vis",this.Visible?"1":"0");break;case RD3Glb.WFR_COLLAPSED:if(!this.Collapsed&&c){break}d.SetAttribute("col",this.Collapsed?"1":"0");break;case RD3Glb.WFR_COLLAPSABLE:if(this.Collapsable&&c){break}d.SetAttribute("clp",this.Collapsable?"1":"0");break;case RD3Glb.WFR_LOCKED:if(!this.iLocked&&c){break}d.SetAttribute("lok",this.iLocked?"1":"0");break;case RD3Glb.WFR_LOCKABLE:var b=this.Lockable&this instanceof IDPanelSrv;if(!b&&c){break}d.SetAttribute("lkb",b?"1":"0");break;case RD3Glb.WFR_IMAGE:if(this.iImage.length==0&&c){break}d.SetAttribute("img",this.iImage);break;case RD3Glb.WFR_SHOWSCROLLBAR:if(this.ShowScrollbar==Glb.FORMSCROLL_BOTH&&c){break}d.SetAttribute("scr",this.ShowScrollbar.toString());break;case RD3Glb.WFR_DRAG:if(!this.iCanDrag&&c){break}d.SetAttribute("dra",this.iCanDrag?"1":"0");break;case RD3Glb.WFR_DROP:if(!this.iCanDrop&&c){break}d.SetAttribute("dro",this.iCanDrop?"1":"0");break}};WebFrameSrv.prototype.RD3StartRequest=function(){};WebFrameSrv.prototype.RD3EndRequest=function(){};WebFrameSrv.RenderCustomCommands=function(c,b){for(var a=0;a<48;a++){if(WebFrameSrv.CommandZones[a]>0){b.SetAttribute("cz"+a,WebFrameSrv.CommandZones[a].toString())}}var d;for(var a=0;a<WebFrameSrv.MAX_CUSTOMCOMMANDS;a++){if(c.CustomCommands[a]!=null){d=b.AddNewElement("ccm");d.SetAttribute("idx",a.toString());d.SetAttribute("cap",c.CustomCommands[a].Caption);d.SetAttribute("tip",c.CustomCommands[a].ToolTip);d.SetAttribute("img",c.CustomCommands[a].Image);d.SetAttribute("fkn",c.CustomCommands[a].FKNum.toString())}}};WebFrameSrv.prototype.iLockable=function(){return this.Lockable};WebFrameSrv.prototype.set_iLockable=function(a){this.Lockable=a;this.RD3FrameChange(RD3Glb.WFR_LOCKABLE)};WebFrameSrv.prototype.Scrollbar=function(){return this.ShowScrollbar};WebFrameSrv.prototype.set_Scrollbar=function(a){this.ShowScrollbar=a;this.RD3FrameChange(RD3Glb.WFR_SHOWSCROLLBAR)};WebFrameSrv.prototype.set_Width=function(a){if(this.Width!=a){this.Parent.Frames[this.FrIndex].Width=a;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_WIDTH);this.Width=a}};WebFrameSrv.prototype.set_Height=function(a){if(this.Height!=a){this.Parent.Frames[this.FrIndex].Height=a;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT);this.Height=a}};WebFrameSrv.prototype.set_FrameWidth=function(a){if(this.Width!=a){this.Parent.Frames[this.FrIndex].Width=a;this.Parent.Frames[this.FrIndex].OriginalWidth=a;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_WIDTH);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_ORGWIDTH);this.Width=a}};WebFrameSrv.prototype.set_FrameHeight=function(b,a){if(this.Height!=b){this.Parent.Frames[this.FrIndex].Height=b;this.Parent.Frames[this.FrIndex].OriginalHeight=b;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_ORGHEIGHT);if(a){this.Parent.Frames[this.FrIndex].MinHeight=b;this.Parent.Frames[this.FrIndex].MaxHeight=b;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_MINHEIGHT);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_MAXHEIGHT)}this.Height=b}};WebFrameSrv.prototype.RD3Resize=function(a,c,b){if(b==""){this.Width=a;this.Height=c;this.Parent.Frames[this.FrIndex].Width=a;this.Parent.Frames[this.FrIndex].Height=c}};WebFrameSrv.prototype.RD3RawClick=function(c,b,g,f,a,e,d){return false};WebFrameSrv.prototype.GenericDrag=function(b,a){};WebFrameSrv.prototype.GenericDrop=function(b,a){};WebFrameSrv.prototype.OnSearchBox=function(a){};WebFrameSrv.prototype.KeyHandle=function(){return this.ListenKeys};WebFrameSrv.prototype.set_KeyHandle=function(a){this.ListenKeys=a};WebFrameSrv.prototype.FireKeyPress=function(a,c,b){if((this.KeyHandle()&a)==0){return}this.Parent.OnFrameKeyPress(this,new IDVariant(a),new IDVariant(c),b)};function DOError(){this.ErrType=0;this.Text="";this.Ack=false;this.Shown=false;this.PropIdx=0}function DOMDColl(){this.Index;this.ChildrenName;this.Name;this.PKColl=new ArrayList();this.FKColl=new ArrayList();this.Transient=false;this.Visible=false;this.IOTData="";this.IOTCode="";this.IOTMultiplicityNM=false}function DOMDLinkedDoc(a,b){this.DocumentClass=a;this.Name="";this.SrcProp=new Array(b);this.DstProp=new Array(b)}DOMDLinkedDoc.prototype.SetLinkedProp=function(a,b,c){this.SrcProp[a]=b;this.DstProp[a]=c};DOMDLinkedDoc.prototype.SetName=function(a){this.Name=a};DOMDLinkedDoc.prototype.GetDocumentClass=function(){return this.DocumentClass};DOMDLinkedDoc.prototype.GetName=function(){return this.Name};DOMDLinkedDoc.prototype.GetNumProp=function(){return this.SrcProp.length};DOMDLinkedDoc.prototype.GetSrcProp=function(a){return this.SrcProp[a]};DOMDLinkedDoc.prototype.GetDstProp=function(a){return this.DstProp[a]};function DOMDObj(){this.ObjTag;this.ObjGUID;this.ObjIcon;this.DBCode;this.SequenceCode;this.RemoteType;this.UIName;this.FormName;this.Concept;this.Services=0;this.BaseProps=0;this.BaseOtherProps=0;this.BaseColls=0;this.BaseMD=null;this.DocIDIdx=0;this.NotifyOnChange=false;this.FastResync=false;this.TableSubst=false;this.TagMap=null;this.FieldMap=null;this.DBObj;this.DBType=0;this.DBSchema;this.PropList;this.OtherPropList;this.CollList;this.QueryList=new ArrayList();this.WebApiMethods="";this.ServiceEndpoint=null;this.IOTCode="";this.IOTMethods="";this.ODataEntitySet="";this.ODataNamespace="";this.ODataWithEtag=false}DOMDObj.prototype.SetNumProp=function(a){this.PropList=new Array(a)};DOMDObj.prototype.SetNumOtherProp=function(a){this.OtherPropList=new Array(a)};DOMDObj.prototype.GetNumProp=function(){return this.PropList.length+this.BaseProps};DOMDObj.prototype.GetNumOtherProp=function(){return this.OtherPropList.length+this.BaseOtherProps};DOMDObj.prototype.SetProp=function(b,a){this.PropList[b-1]=a};DOMDObj.prototype.SetOtherProp=function(b,a){this.OtherPropList[b-1]=a};DOMDObj.prototype.GetProp=function(a){if(this.BaseMD!=null&&a-this.BaseProps<1){return this.BaseMD.GetProp(a)}a-=this.BaseProps;if(a<1||a>this.PropList.length){return null}return this.PropList[a-1]};DOMDObj.prototype.GetOtherProp=function(a){if(this.BaseMD!=null&&a-this.BaseOtherProps<1){return this.BaseMD.GetOtherProp(a)}a-=this.BaseOtherProps;if(a<1||a>this.OtherPropList.length){return null}return this.OtherPropList[a-1]};DOMDObj.prototype.GetPropIndex=function(b){for(var a=0;a<this.PropList.length;a++){if(this.PropList[a].ObjTag!=null&&this.PropList[a].ObjTag.equals(b)){return a+1+this.BaseProps}}if(this.BaseMD!=null){return this.BaseMD.GetPropIndex(b)}return -1};DOMDObj.prototype.GetDBCodeIndex=function(a){for(var b=0;b<this.PropList.length;b++){if(this.PropList[b].DBCode!=null&&this.PropList[b].DBCode.equals(a)){return b+1+this.BaseProps}}if(this.BaseMD!=null){return this.BaseMD.GetDBCodeIndex(a)}return -1};DOMDObj.prototype.GetIOTCodeIndex=function(b){for(var a=0;a<this.PropList.length;a++){if(this.PropList[a].IOTCode!=null&&this.PropList[a].IOTCode.equals(b)){return a+1+this.BaseProps}}if(this.BaseMD!=null){return this.BaseMD.GetIOTCodeIndex(b)}return -1};DOMDObj.prototype.SetNumColl=function(a){this.CollList=new Array(a)};DOMDObj.prototype.GetNumColl=function(){return this.CollList.length+this.BaseColls};DOMDObj.prototype.SetColl=function(b,a){this.CollList[b-1]=a};DOMDObj.prototype.GetColl=function(a){if(this.BaseMD!=null&&a-this.BaseColls<1){return this.BaseMD.GetColl(a)}a-=this.BaseColls;if(a<1||a>this.CollList.length){return null}return this.CollList[a-1]};DOMDObj.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};DOMDObj.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}return new IDVariant()};DOMDObj.prototype.GetDBType=function(){if(this.DBType>0){return this.DBType}if(this.BaseMD!=null){return this.BaseMD.GetDBType()}return 0};DOMDObj.prototype.AddQuery=function(a,e,b,c,f){var d=new DOMDQuery();d.ID=a;d.Tag=e;d.Query=b;d.MsgText=c;d.QryType=f;d.Init();this.QueryList.Add(d)};DOMDObj.prototype.GetNumQueries=function(){return this.QueryList.Count()};DOMDObj.prototype.GetQuery=function(a){if(a>=1&&a<=this.QueryList.Count()){return this.QueryList[a-1]}else{return null}};DOMDObj.prototype.AddFieldConversion=function(a,b){if(this.FieldMap==null){this.FieldMap=new HashTableSrv()}this.FieldMap[a]=b};DOMDObj.prototype.GetFieldConversion=function(a){if(this.FieldMap==null){return null}return this.FieldMap[a]};function DOMDProp(){this.Index=0;this.ObjTag;this.DBCode="";this.RemoteIndex=0;this.PK=false;this.FK=false;this.LinkedDoc=null;this.Nullable=true;this.Counter=false;this.DescribeRow=false;this.Transient=false;this.Visible=false;this.ReadOnly=false;this.HasDefault=false;this.Private=false;this.IsUnicode=0;this.DataType=0;this.DataTypeName;this.ChildrenName;this.MaxLength=0;this.vScale=0;this.Name;this.UIName;this.Description;this.GUID;this.Concept;this.ExtPropIdx=0;this.Mask;this.IDList;this.Lookup;this.DTString;this.Domain;this.Group;this.Transformation=0;this.TrFormat=null;this.TrOffset=0;this.RecordIdxProp=0;this.TagMap=null;this.IOTData="";this.IOTCode="";this.ODataType=""}DOMDProp.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};DOMDProp.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}return new IDVariant()};function DOMDQuery(){this.ID;this.Tag;this.Query;this.MsgText;this.QryType;this.NeedRecord;this.DocDipName;this.OrgEx}DOMDQuery.prototype.Init=function(){switch(this.QryType){case 1:this.NeedRecord=false;break;case 2:this.NeedRecord=false;break;case 3:this.NeedRecord=true;break;case 4:this.NeedRecord=false;break}var a=this.MsgText.indexOf("§");if(a>0){this.DocDipName=this.MsgText.substr(0,a);this.MsgText=this.MsgText.substr(a+1)}else{this.DocDipName=""}};DOMDQuery.prototype.CanByApplied=function(a,b){switch(this.QryType){case 1:return b==1;case 2:return b==2||b==1;case 3:return b==2||b==1;case 4:return b==3}return false};DOMDQuery.prototype.GetSQL=function(f,b){var h=this.Query;var a=f.GetMD();var j=false;while(true){var g=h.indexOf("~~");var e=h.indexOf("~~",g+1);if(g==-1||e==-1){break}var c=f.GetPropertyIndex(h.substr(g+2,e-g-2));if(c==0){break}var d=f.GetPropByIndex(c);if(d.Type==IDVariant.NULL){if(Glb.ClassDB(b.DBType)==Glb.DBC_SQLSRV&&a.GetProp(c).FK){return""}h=h.substr(0,g-1)+" is NULL "+h.substr(e+2)}else{j=true;h=h.substr(0,g)+Glb.ToSql(d,a.GetDBType(),b)+h.substr(e+2)}}return(j?h:"")};DOMDQuery.prototype.ApplyTo=function(d,x,u){var j=this.MsgText;var h=-1;var r=d.GetMD();var n=null;try{n=d.GetMainFrm().getRTCObj()}catch(t){}var y="";switch(this.QryType){case 1:case 2:y="Impossibile salvare il documento perchè ne esiste già un altro con gli stessi dati identificativi (|1)";break;case 3:y="Impossibile salvare il documento perchè esso si riferisce ad un altro documento |2 non presente nel database (|1)";break;case 4:y="Impossibile cancellare il documento perchè ci sono altri documenti |2 che si riferiscono ad esso";break}if(n!=null){switch(this.QryType){case 1:case 2:y=n.GetConst("9B598652-135D-4680-9968-BD32EA55636B",y);break;case 3:y=n.GetConst("D06AED6A-84E2-4474-B0DC-AEF9B4A7F572",y);break;case 4:y=n.GetConst("0B41D50A-1EAD-484B-B1B7-97F4FE484017",y);break}}while(true){var c=j.indexOf("~~");var b=j.indexOf("~~",c+1);if(c==-1||b==-1){break}var o=j.substr(c+2,b-c-2);var l=false;if(o.substr(0,1)=="!"){l=true;o=o.slice(1)}var k=d.GetPropertyIndex(o);if(k==0){break}if(!l&&this.QryType!=4){if(h==-1){h=k}else{h=-2}}var g;if(l){var a=r.GetProp(k);g=a.UIName}else{g=d.GetPropByIndex(k).ToString()}j=j.substr(0,c)+g+j.substr(b+2)}var f=IDL.FormatMessage(new IDVariant(y),new IDVariant(j),new IDVariant(this.DocDipName)).ToString();if(h>0){d.SetPropError(h,f)}else{d.AddDocError(f)}var m=new DOMDQuery();m.Query=this.SQL;m.Tag=this.Tag;m.ID=this.ID;m.NeedRecord=this.NeedRecord;m.MsgText=f;m.QryType=this.QryType;m.DocDipName=this.DocDipName;m.OrgEx=x;d.LastFailedCheck=m};function IDCollection(){this.iColl=new ArrayList();this.UILookup=null;this.UIPos=0;this.iPos=0;this.iCur=0;this.ShowDel=false;this.ShowHid=true;this.iCount=0;this.iUIMode=false;this.UILastUpd=-1;this.SortCriteria=new Array(16);for(var a=0;a<16;a++){this.SortCriteria[a]=0}this.iParent=null;this.iMainFrm=null;this.iIMDB=null;this.iUIBound=false;this.iUpdCount=0;this.iLoaded=false;this.iVisible=false;this.bUpdateSort=false;this.bSemMod=false;this.Index=0;this.MaxRows=0;this.HasMoreElements=false;this.LiveSort=false;this.DocumentProvider=null;this.ODataLoadInfo=null}IDCollection.prototype.SetSize=function(b,a){if(b!=-1){while(this.Size()<b){this.iColl.Add(null);if(this.UILookup!=null){this.UILookup.Add(null);this.iCount++}}}if(a!=null){this.DocumentProvider=a}};IDCollection.prototype.GetMissingDoc=function(a){if(this.DocumentProvider!=null){this.DocumentProvider.OnMissingDocument(new IDVariant(a),this);if(this.iColl[a-1]==null&&this.DocumentProvider.GetServiceConnector()!=null){this.DocumentProvider.GetServiceConnector().GetMissingDoc(this.DocumentProvider,this,a-1)}}};IDCollection.prototype.GetDirect=function(a){if(this.UIMode()){if(a>=1&&a<=this.UILookup.Count()){return this.UILookup[a-1]}}else{if(a>=1&&a<=this.iColl.Count()){return this.iColl[a-1]}}return null};IDCollection.prototype.SetDirect=function(d,c){if(this.UIMode()){if(d>=1&&d<=this.UILookup.Count()){this.UILookup[d-1]=c;var a=d;if(this.UILookup.Count()!=this.iColl.Count()){a=d;for(var b=0;b<this.iColl.Count();b++){if(this.DocVisible(this.iColl[b])){a--;if(a==0){a=b;break}}}}this.iColl[a-1]=c;this.iUpdCount++;this.UILastUpd++}}else{if(d>=1&&d<=this.iColl.Count()){this.iColl[d-1]=c}this.iUpdCount++}if(c.ParentCollection()==null){c.set_ParentCollection(this)}};IDCollection.prototype.UpdateCount=function(){return this.iUpdCount};IDCollection.prototype.UIBound=function(){return this.iUIBound};IDCollection.prototype.set_UIBound=function(a){if(a!=this.iUIBound){this.iUIBound=a;for(var c=0;c<this.iColl.Count();c++){var e=this.iColl[c];if(e!=null){e.set_UIBound(a)}}this.UILookup=new ArrayList(this.iColl.Count())}};IDCollection.prototype.set_UIMode=function(d){this.iUIMode=d;if(d&&this.UILastUpd!=this.iUpdCount){this.UILastUpd=this.iUpdCount;var c=this.ShowDel;this.ShowDel=false;var a=this.ShowHid;this.ShowHid=false;this.UILookup.Clear();for(var e=0;e<this.iColl.Count();e++){if(this.DocVisible(this.iColl[e])){this.UILookup.Add(this.iColl[e])}}this.ShowDel=c;this.ShowHid=a}};IDCollection.prototype.UIMode=function(){return this.iUIMode};IDCollection.prototype.Loaded=function(){return this.iLoaded};IDCollection.prototype.set_Loaded=function(a){this.iLoaded=a};IDCollection.prototype.Visible=function(){return this.iVisible};IDCollection.prototype.set_Visible=function(a){if(this.iVisible!=a){this.iVisible=a;this.UISetModified()}};IDCollection.prototype.Parent=function(){return this.iParent};IDCollection.prototype.set_Parent=function(a){this.iParent=a};IDCollection.prototype.MainFrm=function(){return this.iMainFrm};IDCollection.prototype.set_MainFrm=function(a){this.iMainFrm=a};IDCollection.prototype.IMDB=function(){return this.iIMDB};IDCollection.prototype.set_imdb=function(a){this.iIMDB=a};IDCollection.prototype.GetCollection=function(){if(this.DocumentProvider!=null){var b=new ArrayList(this.iColl.Count());for(var a=0;a<this.iColl.Count();a++){if(this.iColl[a]!=null){b.Add(this.iColl[a])}}return b}else{var b=new ArrayList(this.iColl);return b}};IDCollection.prototype.GetLoopCollection=function(){var d=new ArrayList();var c=this.iPos;var b=this.iCur;var a=this.UIPos;this.MoveFirst();while(!this.IsEof()){d.Add(this.GetAt());this.MoveNext()}this.iPos=c;this.iCur=b;this.UIPos=a;return d};IDCollection.prototype.Add=function(a,d,c,b){if(d==undefined){d=null}if(c==undefined){c=true}if(b==undefined){b=true}if(b&&a.ParentCollection()==this){b=false;if(a.ParentCollection().Find(a)){if(a.Parent()!=null){a.Parent().StopEvents()}a.ParentCollection().RemoveAt();a.set_ParentCollection(this);if(a.Parent()!=null){a.Parent().StartEvents()}}}if(b&&this.Parent()!=null&&!this.Parent().FreezeEvents()){var e=new IDVariant();if(!this.Parent().GetLock(9999,"",e)){throw new Error("ERR "+MDOInit.DOERR_NOLOCK+" [ "+this.Parent().toString()+"] "+e.toString())}}if(d!=null){var f=this.iColl.IndexOf(d);if(f==-1){this.iColl.Add(a)}else{if(c){this.iColl.Insert(f+1,a)}else{this.iColl.Insert(f,a)}}if(this.UIMode()&&this.DocVisible(a)){f=this.UILookup.IndexOf(d);if(f==-1){this.UILookup.Add(a)}else{if(c){this.UILookup.Insert(f+1,a)}else{this.UILookup.Insert(f,a)}}}}else{if(c){this.iColl.Add(a)}else{this.iColl.Insert(0,a)}if(this.UIMode()&&this.DocVisible(a)){if(c){this.UILookup.Add(a)}else{this.UILookup.Insert(0,a)}}}if(this.iMainFrm!=null){a.SetMainFrm(this.iMainFrm,this.iIMDB)}if(this.UIBound()){a.set_UIBound(true)}if(this.DocVisible(a)){this.iCount++;this.bUpdateSort=true;this.UISetModified()}if(b){if(a.ParentCollection()!=null){if(a.ParentCollection().Find(a)){a.ParentCollection().RemoveAt()}}a.set_ParentCollection(this);if(this.iParent!=null){a.set_Parent(this.iParent);if(!this.iParent.FreezeEvents()){this.iParent.OnAddChild(this,a)}a.ChangingParent()}if(a.OldParent()==null){a.set_OldParentCollection(null)}a.MarkAsChanged()}};IDCollection.prototype.AddAll=function(e,c){if(c==undefined){c=false}var a=e.GetLoopCollection();for(var b=0;b<a.Count();b++){var d=a[b];this.Add(d,null,true,c)}};IDCollection.prototype.RemoveLast=function(){if(this.iColl.Count()>0){this.RemoveAt(this.iColl.Count())}};IDCollection.prototype.RemoveAt=function(b){if(b==undefined){b=this.iCur}if(b>0&&b<=this.iColl.Count()){var a=this.iColl[b-1];if(this.DocVisible(a)){this.iCount--;this.UISetModified()}this.iColl.RemoveAt(b-1);if(this.iCur==b&&b<=this.iColl.Count()){if(!this.DocVisible(this.iColl[b-1])){this.SkipFiltered(1)}}if(a.ParentCollection()==this){a.set_ParentCollection(null)}if(a.Parent()!=null&&!a.Parent().FreezeEvents()&&this.Parent()==a.Parent()){a.Parent().OnRemoveChild(this,a);a.Parent().MarkAsChanged()}}};IDCollection.prototype.Remove=function(c){var a=this.iCur;var b=false;for(this.iCur=1;this.iCur<=this.iColl.Count();this.iCur++){var e=this.iColl[this.iCur-1];if(e==c){this.RemoveAt();b=true;break}}this.iCur=a;return b};IDCollection.prototype.Clear=function(){this.iColl.Clear();this.iCount=0;this.iPos=0;this.UIPos=0;this.iLoaded=false;this.UISetModified()};IDCollection.prototype.Count=function(){if(this.iUIMode){return this.UILookup.Count()}else{return this.iCount}};IDCollection.prototype.Size=function(){return this.iColl.Count()};IDCollection.prototype.MoveFirst=function(){if(this.iUIMode){this.UIPos=1}else{this.iPos=1;this.iCur=1;this.UIPos=1;this.SkipFiltered(1)}};IDCollection.prototype.MoveNext=function(){if(this.iUIMode){this.UIPos++}else{this.iPos++;this.iCur++;this.SkipFiltered(1)}};IDCollection.prototype.MovePrev=function(){if(this.iUIMode){this.UIPos--}else{this.iPos--;this.iCur--;this.SkipFiltered(-1)}};IDCollection.prototype.MoveLast=function(){if(this.iUIMode){this.UIPos=this.UILookup.Count()}else{this.iPos=this.iCount;this.iCur=this.iColl.Count();this.SkipFiltered(-1)}};IDCollection.prototype.IsEof=function(){if(this.iUIMode){return this.UIPos>this.UILookup.Count()}else{return(this.iPos>this.iCount||this.iCur>this.iColl.Count())}};IDCollection.prototype.AbsolutePosition=function(){if(this.iUIMode){return this.UIPos}else{return this.iPos}};IDCollection.prototype.set_AbsolutePosition=function(a){if(this.iUIMode){this.UIPos=a}else{this.MoveFirst();while(this.iPos<a&&!this.IsEof()){this.MoveNext()}}};IDCollection.prototype.GetAt=function(){if(this.iUIMode){if(this.UIPos<1||this.UIPos>this.UILookup.Count()){return null}else{var a=this.UILookup[this.UIPos-1];if(a==null){this.GetMissingDoc(this.UIPos)}a=this.UILookup[this.UIPos-1];return a}}else{if(this.iCur<1||this.iCur>this.iColl.Count()){return null}else{var a=this.iColl[this.iCur-1];if(a==null||a==undefined){this.GetMissingDoc(this.iCur)}a=this.iColl[this.iCur-1];if(!this.DocVisible(a)){return null}else{return a}}}};IDCollection.prototype.SetAt=function(a){if(this.iCur>=1&&this.iCur<=this.iColl.Count()){this.iColl[this.iCur-1]=a;if(this.UIBound()){a.set_UIBound(true)}if(a.ParentCollection()==null){a.set_ParentCollection(this)}if(a.Parent()==null&&this.iParent!=null){a.set_Parent(this.iParent);a.ChangingParent()}if(this.DocVisible(a)){if(this.UIMode()){this.UILookup.Insert(this.iCur-1,a)}this.bUpdateSort=true;this.UISetModified()}}};IDCollection.prototype.DeleteAt=function(){var c=this.GetAt();if(c!=null){if(!c.Deleted()){var a=this.DocVisible(c);c.set_Deleted(true);if(a&&!this.DocVisible(c)){this.UISetModified();this.SkipFiltered(1)}}}};IDCollection.prototype.ShowHidden=function(){return this.ShowHid};IDCollection.prototype.ShowDeleted=function(){return this.ShowDel};IDCollection.prototype.set_ShowDeleted=function(a){if(this.ShowDel!=a){this.ShowDel=a;if(this.Recount()){this.UISetModified()}}};IDCollection.prototype.set_ShowHidden=function(a){if(this.ShowHid!=a){this.ShowHid=a;if(this.Recount()){this.UISetModified()}}};IDCollection.prototype.SkipFiltered=function(b){if(this.ShowDel&&this.ShowHid){return}for(;b>0?this.iCur<=this.iColl.Count():this.iCur>=1;this.iCur+=b){var a=this.GetAt();if(this.DocVisible(a)){break}}};IDCollection.prototype.PurgeDeleted=function(){var f=new ArrayList(this.iColl.Count());var a=false;for(var b=0;b<this.iColl.Count();b++){var e=this.iColl[b];if(e==null||!e.Deleted()){f.Add(e)}else{if(e.ParentCollection()==this){e.set_ParentCollection(null)}if(e.Parent()!=null&&!e.Parent().FreezeEvents()&&this.Parent()==e.Parent()){e.Parent().OnRemoveChild(this,e)}a=true}}this.iColl=f;this.iCount=this.iColl.Count();if(a){this.UISetModified()}};IDCollection.prototype.ClearSort=function(){for(var a=0;a<this.SortCriteria.length;a++){this.SortCriteria[a]=0}};IDCollection.prototype.SortBy=function(a){for(var b=0;b<this.SortCriteria.length;b++){if(this.SortCriteria[b]==0){this.SortCriteria[b]=a;break}}};IDCollection.prototype.GetSortCriteria=function(a){if(a>0&&a<=this.SortCriteria.length){return this.SortCriteria[a-1]}else{return 0}};IDCollection.prototype.EnableSort=function(){if(this.SortCriteria[0]!=0){var b=this;var c=this.iColl.Count();var d=new Array(c);for(var a=0;a<c;a++){d[a]=this.iColl[a]}d.sort(function(h,g){var k;var j;var e=0;if(h==null&&g==null){return 0}if(h==null){return 1}if(g==null){return -1}for(var f=0;f<b.SortCriteria.length;f++){if(b.SortCriteria[f]==0){break}k=h.GetPropByIndex(Math.abs(b.SortCriteria[f]));j=g.GetPropByIndex(Math.abs(b.SortCriteria[f]));e=k.CompareToIgnoreCase(j);if(b.SortCriteria[f]<0){e=-e}if(e!=0){break}}return e});for(var a=0;a<c;a++){this.iColl[a]=d[a]}this.bUpdateSort=false;this.UISetModified()}};IDCollection.prototype.IsModified=function(){for(var a=0;a<this.iColl.Count();a++){var b=this.iColl[a];if(b!=null&&b.IsModified()){return true}}return false};IDCollection.prototype.SetOriginal=function(){for(var a=0;a<this.iColl.Count();a++){var b=this.iColl[a];if(b!=null){b.SetOriginal()}}};IDCollection.prototype.LoadChildren=function(c,e,a){for(var b=0;b<this.iColl.Count();b++){var f=this.iColl[b];if(f!=null){f.LoadChildren(c,e,a)}}};IDCollection.prototype.RestoreOriginal=function(){for(var a=0;a<this.iColl.Count();a++){var b=this.iColl[a];if(b!=null){if(b.Inserted()){b.set_Deleted(true)}else{b.set_Deleted(false)}b.RestoreOriginal()}}this.bUpdateSort=true;this.PurgeDeleted()};IDCollection.prototype.ClearErrors=function(a,b){if(a==undefined){a=false}if(b==undefined){b=0}for(var c=0;c<this.iColl.Count();c++){var e=this.iColl[c];if(e!=null){e.ClearErrors(a,b)}}};IDCollection.prototype.Validate=function(e){if(e==undefined){e=0}var b=true;for(var a=0;a<this.iColl.Count();a++){var f=this.iColl[a];if(f!=null&&f.IsModified()){f.ReconnectChildren(9999);var c=f.Validate(e,9999,true);b&=c}}return b};IDCollection.prototype.SaveToDB=function(a,f){if(a==undefined){a=9999}if(f==undefined){f=true}var c=true;for(var b=0;b<this.iColl.Count();b++){var g=this.iColl[b];if(g!=null&&g.IsModified()){var e=g.SaveToDB(a,f);c&=e}}return c};IDCollection.prototype.SaveToXML=function(g,c,a,b,e,f,d){if(c==undefined){c=true}if(a==undefined){a=""}if(b==undefined){b=9999}if(e==undefined){e=XMLDoc.FT_XML}if(f==undefined){f=false}if(d==undefined){d=false}if(this.MainFrm()==null){this.set_MainFrm(g);this.set_imdb(g.getIMDB())}return MDOInit.SaveCollectionToXML(null,this,c,a,b,e,f,d)};IDCollection.prototype.LoadFromXML=function(e,d,c,a,b){if(c==undefined){c=true}if(a==undefined){a=XMLDoc.FT_XML}if(b==undefined){b=false}if(this.MainFrm()==null){this.set_MainFrm(e);this.set_imdb(e.getIMDB())}return MDOInit.LoadCollectionFromXML(e,this,d,c,a,b)};IDCollection.prototype.Find=function(a){this.MoveFirst();while(!this.IsEof()){var b=this.GetAt();if(b==a){return true}this.MoveNext()}return false};IDCollection.prototype.FindIndex=function(b){var a=1;this.MoveFirst();while(!this.IsEof()){var c=this.GetAt();if(c==b){return a}this.MoveNext();a++}return 0};IDCollection.prototype.UISetModified=function(){if(this.iUIBound){if(this.LiveSort&&this.SortCriteria[0]!=0&&this.bUpdateSort){this.bSemMod=true;try{this.EnableSort()}catch(a){}this.bSemMod=false}this.iUpdCount++;if(this.iParent!=null){this.iParent.RefreshUI()}else{if(this.iMainFrm!=null){this.iMainFrm.set_RefreshUI(true)}}}};IDCollection.prototype.Recount=function(){var f=0;var a=0;var e=this.iColl.Count();for(var a=0;a<e;a++){var b=this.iColl[a];if(this.DocVisible(b)){f++}if(a<this.iCur){this.iPos=f}}if(f!=this.iCount){this.iCount=f;return true}return false};IDCollection.prototype.ChangeStatus=function(a){if(!this.ShowDeleted()||!this.ShowHidden()){if(this.Recount()){this.UISetModified()}}};IDCollection.prototype.ChangeDoc=function(c,a){for(var b=0;b<this.SortCriteria.length;b++){if(this.SortCriteria[b]==0){break}if(Math.abs(this.SortCriteria[b])==a){this.bUpdateSort=true;this.UISetModified();break}}};IDCollection.prototype.DocVisible=function(a,b){if(b==undefined){b=false}if(a==null){return(this.DocumentProvider!=null)}if(b){return(this.ShowDel||!a.Deleted())&&((this.ShowHid&&!this.UIBound())||!a.Hidden())}else{return(this.ShowDel||!a.Deleted())&&(this.ShowHid||!a.Hidden())}};IDCollection.prototype.ChangeCount=function(a){if(a!=0){this.iCount+=a;this.bUpdateSort=true;this.UISetModified()}};IDCollection.prototype.GetFailedDoc=function(){for(var b=0;b<this.iColl.Count();b++){var c=this.iColl[b];if(c!=null){var a=c.GetFailedDoc();if(a!=null){return a}}}return null};IDCollection.prototype.getDebugInfo=function(b,a){var f="<idcollection size='"+this.Size()+"' count='"+this.Count()+"' >";if(b==1){for(var c=0;c<this.iColl.Count();c++){var e=this.iColl[c];if(e!=null){f+=e.getDebugInfo(0,"")}}}f+="</idcollection>";return f};IDCollection.prototype.getDebugObject=function(a){try{return this.iColl[a-1]}catch(b){return null}};IDCollection.prototype.FindDocs=function(a){var e=new IDCollection();this.MoveFirst();while(!this.IsEof()){var b=this.GetAt();if(b!=null&&b.Matchs(a)){e.Add(b,null,true,false)}this.MoveNext()}return e};IDCollection.prototype.FindDoc=function(b){var a=1;this.MoveFirst();while(!this.IsEof()){var c=this.GetAt();if(c!=null&&c.Matchs(b)){return a}this.MoveNext();a++}return 0};IDCollection.prototype.FilterDocs=function(e,a){var b=e.IsEmpty();for(var c=0;c<this.iColl.Count();c++){var f=this.iColl[c];if(f!=null){if(b){f.set_Hidden(false)}else{f.set_Hidden(!f.Matchs(e,a))}}}};IDCollection.prototype.WebApi_LoadFromXML=function(b,a){if(this.MainFrm()==null){this.set_MainFrm(b);this.set_imdb(b.getIMDB())}return MDOInit.LoadCollXMLNode(this.MainFrm(),this,a.GetNode(),true)};IDCollection.prototype.WebApi_SaveToXML=function(c,b,a){if(this.MainFrm()==null){this.set_MainFrm(c);this.set_imdb(c.getIMDB())}return MDOInit.SaveCollectionToXML(null,this,false,"",a,b,true)};function IDDocHelper(){}IDDocHelper.prototype.SetMainFrm=function(a,b){};IDDocHelper.prototype.OpenAttachmentForm=function(a){};IDDocHelper.prototype.ShowAttachment=function(c,b,a){};IDDocHelper.prototype.GetAttachment=function(c,b,a){};IDDocHelper.prototype.SetAttachment=function(f,e,c,g,b,a){};IDDocHelper.prototype.DeleteAttachments=function(a){};IDDocHelper.prototype.GetComment=function(f,c,e,a,b){};IDDocHelper.prototype.SetComment=function(g,a,f,e,c,b){};IDDocHelper.prototype.DeleteComments=function(a){};IDDocHelper.prototype.GetLock=function(c,a,b,e){};IDDocHelper.prototype.ReleaseLock=function(a){};IDDocHelper.prototype.OnChangingProperty=function(c,a,b){};IDDocHelper.prototype.OnChangingProperty=function(a){};IDDocHelper.prototype.OnDeleting=function(a){};IDDocHelper.prototype.OnUpdating=function(a){};IDDocHelper.prototype.OnSelecting=function(a){};IDDocHelper.prototype.OnAddChild=function(c,b,a){};IDDocHelper.prototype.OnRemoveChild=function(c,a,b){};IDDocHelper.prototype.OnBeginTrans=function(a){};IDDocHelper.prototype.OnEndTrans=function(a){};IDDocHelper.prototype.BeforeLoad=function(b,a){};IDDocHelper.prototype.AfterLoad=function(b,c,a){};IDDocHelper.prototype.BeforeLoadCollection=function(e,c,a,b){};IDDocHelper.prototype.OnValidate=function(e,c,a,b){};IDDocHelper.prototype.BeforeSave=function(e,c,a,b){};IDDocHelper.prototype.AfterSave=function(b,a){};IDDocHelper.prototype.OnSQLQuery=function(c,a,e,b){};IDDocHelper.prototype.AfterSQLQuery=function(e,b,f,a,c){};IDDocHelper.prototype.OnSaveXMLProp=function(e,c,b,a,f){};IDDocHelper.prototype.OnSaveXMLObj=function(b,c,a){};IDDocHelper.prototype.OnLoadXMLProp=function(f,e,c,a,g,b){};IDDocHelper.prototype.OnLoadXMLObj=function(c,e,a,b){};IDDocHelper.prototype.OnGetName=function(g,a,f,e,c,b){};IDDocHelper.prototype.OnGetIcon=function(g,b,a,f,e,c){};IDDocHelper.prototype.OnGetTooltip=function(g,e,f,c,b,a){};IDDocHelper.prototype.OnClick=function(a){};IDDocHelper.prototype.OnExpand=function(a){};IDDocHelper.prototype.OnMayHaveChildren=function(b,a){};IDDocHelper.prototype.BeforeLookup=function(c,b,a){};IDDocHelper.prototype.AfterLookup=function(a){};IDDocHelper.prototype.OnGetValueSource=function(c,a,b){};IDDocHelper.prototype.OnGetLKE=function(h,b,c,f,g,e,a){};IDDocHelper.prototype.OnDrop=function(g,a,b,f,c,e){};IDDocHelper.prototype.OnInit=function(a){};IDDocHelper.prototype.OnClear=function(a){};IDDocHelper.prototype.OnGetNamedPropertyDefinition=function(c,a,b){};IDDocHelper.prototype.OnGetNamedPropertyValue=function(c,a,b){};IDDocHelper.prototype.OnSetNamedPropertyValue=function(c,a,b){};IDDocHelper.prototype.OnDuplicate=function(b,a){};IDDocHelper.prototype.OnMissingDocument=function(b,a,e){};IDDocHelper.prototype.OnGetDNA=function(a){};IDDocHelper.prototype.OnShow=function(b,a){};IDDocHelper.prototype.OnResyncClient=function(g,c,f,b,e,a){};IDDocHelper.prototype.OnChange=function(a){};IDDocHelper.prototype.OnWebAPI=function(b,a){};IDDocHelper.prototype.OnWebAPIResponse=function(c,a,b,e){};IDDocHelper.prototype.GetSchemaName=function(b,a){};function IDDocument(){this.IsDeleted=false;this.IsUpdated=false;this.IsInserted=false;this.IsSelected=false;this.IsLocked=false;this.IsValid=true;this.iUpdCount=0;this.LastFailedCheck=null;this.iRemote=null;this.iUIBound=false;this.iParent=null;this.oParent=null;this.iParentCollection=null;this.oParentCollection=null;this.iFreezeEvents=true;this.iStopEvents=0;this.iLoaded=false;this.iHidden=false;this.iInTrans=false;this.ChgProp=null;this.PropErrors=null;this.DocErrors=null;this.aVars=null;this.oVars=null;this.iSuspendSync=false;this.TagMap=null}IDDocument.ERR_NONE=0;IDDocument.ERR_ERROR=1;IDDocument.ERR_WARNACK=2;IDDocument.ERR_WARNING=3;IDDocument.prototype.GetDBObj=function(a){return null};IDDocument.prototype.GetRemote=function(){return null};IDDocument.prototype.GetDTTObj=function(){var a=this.GetMainFrm();return(a!=null?a.getDTTObj():null)};IDDocument.prototype.GetServiceConnector=function(){return IOTConnector.ServiceConnector(this.GetMainFrm(),this.GetMD().ServiceEndpoint)};IDDocument.prototype.OnMissingDocument=function(a,b){};IDDocument.prototype.Parent=function(){return this.iParent};IDDocument.prototype.OldParent=function(){return this.oParent};IDDocument.prototype.set_Parent=function(a){this.iParent=a};IDDocument.prototype.set_OldParent=function(a){this.oParent=a};IDDocument.prototype.ParentCollection=function(){return this.iParentCollection};IDDocument.prototype.OldParentCollection=function(){return this.oParentCollection};IDDocument.prototype.set_ParentCollection=function(a){this.iParentCollection=a};IDDocument.prototype.set_OldParentCollection=function(a){this.oParentCollection=a};IDDocument.prototype.ChangingParent=function(){this.set_Updated(true)};IDDocument.prototype.SetMainFrm=function(a,b){};IDDocument.prototype.GetMainFrm=function(){return null};IDDocument.prototype.GetDocHelper=function(){return null};IDDocument.prototype.GetIMDB=function(){return null};IDDocument.prototype.IsChildOf=function(a){var b=this;while(b!=null){b=b.Parent();if(b==a){return true}}return false};IDDocument.prototype.GetPropertyIndex=function(d,c,b,a,e,f){if(c==undefined){c=true}if(b==undefined){b=true}if(a==undefined){a=false}if(e==undefined){e=false}if(f==undefined){f=false}return MDOInit.GetPropertyIndex(this,d,c,b,a,e,f)};IDDocument.prototype.GetExtProp=function(a){return MDOInit.GetExtProp(this,a)};IDDocument.prototype.GetExtSchema=function(){return MDOInit.GetExtSchema(this)};IDDocument.prototype.GetSchemaName=function(a){};IDDocument.prototype.GetMD=function(a){return null};IDDocument.prototype.CreateDocument=function(a){return null};IDDocument.prototype.UIBound=function(){return this.iUIBound};IDDocument.prototype.set_UIBound=function(a){if(a){this.set_FreezeEvents(false)}this.iUIBound=a};IDDocument.prototype.GetName=function(d,c,b,a){if(d==undefined){d=0}if(c==undefined){c=null}if(b==undefined){b=0}if(a==undefined){a=0}return MDOInit.GetName(this,d,c,b,a)};IDDocument.prototype.GetIcon=function(a,d,c,b){if(a==undefined){a=0}if(d==undefined){d=null}if(c==undefined){c=0}if(b==undefined){b=0}return MDOInit.GetIcon(this,a,d,c,b)};IDDocument.prototype.GetTooltip=function(d,c,b,a){if(d==undefined){d=0}if(c==undefined){c=null}if(b==undefined){b=0}if(a==undefined){a=0}return MDOInit.GetTooltip(this,d,c,b,a)};IDDocument.prototype.MayHaveChildren=function(){return MDOInit.MayHaveChildren(this)};IDDocument.prototype.DocID=function(){return MDOInit.GetDocID(this)};IDDocument.prototype.GetPropIndex=function(a){return this.GetMD().GetPropIndex(a)};IDDocument.prototype.Deleted=function(){return this.IsDeleted};IDDocument.prototype.DocIsDeleted=function(){return MDOInit.DocIsDeleted(this)};IDDocument.prototype.Updated=function(){return this.IsUpdated};IDDocument.prototype.Inserted=function(){return this.IsInserted};IDDocument.prototype.Selected=function(){return this.IsSelected};IDDocument.prototype.Loaded=function(){return this.iLoaded};IDDocument.prototype.Hidden=function(){return this.iHidden};IDDocument.prototype.Valid=function(){return this.IsValid};IDDocument.prototype.FreezeEvents=function(){return this.iFreezeEvents||(this.iStopEvents>0)};IDDocument.prototype.set_FreezeEvents=function(a){this.iFreezeEvents=a};IDDocument.prototype.StopEvents=function(){this.iStopEvents++};IDDocument.prototype.StartEvents=function(){this.iStopEvents--};IDDocument.prototype.SetUIModified=function(){this.iUpdCount++;if(this.UIBound()){this.RefreshUI()}};IDDocument.prototype.OnChangingProperty=function(a,b){};IDDocument.prototype.OnInserting=function(){};IDDocument.prototype.OnDeleting=function(){};IDDocument.prototype.OnUpdating=function(){};IDDocument.prototype.OnSelecting=function(){};IDDocument.prototype.OnAddChild=function(b,a){};IDDocument.prototype.OnRemoveChild=function(a,b){};IDDocument.prototype.SetOriginal=function(a){if(a==undefined){a=9999}MDOInit.SetOriginal(this,a)};IDDocument.prototype.RefreshUI=function(){};IDDocument.prototype.GetLookupCache=function(){if(this.GetMainFrm()==null){return null}var b=this.GetClass().GetClassName(true)+"|"+(this.GetMD().DBCode==null?"":this.GetMD().DBCode);var a=this.GetMainFrm().LookupCache;if(!a.containsKey(b)){a[b]=new HashTableSrv()}return a[b]};IDDocument.prototype.GetModifiedList=function(){return null};IDDocument.prototype.GetSchemaCache=function(){return null};IDDocument.prototype.RestoreOriginal=function(a){if(a==undefined){a=9999}MDOInit.RestoreOriginal(this,a)};IDDocument.prototype.Clear=function(){MDOInit.Clear(this)};IDDocument.prototype.InitDefaults=function(){};IDDocument.prototype.Init=function(){this.InitDefaults();MDOInit.Init(this)};IDDocument.prototype.set_Deleted=function(a){if(this.IsDeleted!=a){if(!this.FreezeEvents()&&!this.GetLock()){return}this.SetUIModified();var d=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this):false;this.IsDeleted=a;var c=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this):false;if(this.ParentCollection()!=null){if(d&&!c){this.ParentCollection().ChangeCount(-1)}if(!d&&c){this.ParentCollection().ChangeCount(1)}}if(!this.FreezeEvents()){this.OnDeleting()}this.MarkAsChanged()}};IDDocument.prototype.set_Inserted=function(a){if(this.IsInserted!=a){this.IsInserted=a;this.SetUIModified();if(!this.FreezeEvents()){this.OnInserting()}this.MarkAsChanged()}};IDDocument.prototype.set_Updated=function(a){if(this.IsUpdated!=a){this.IsUpdated=a;this.SetUIModified();if(!this.FreezeEvents()){this.OnUpdating()}this.MarkAsChanged()}};IDDocument.prototype.set_Selected=function(a){if(this.IsSelected!=a){this.SetUIModified();this.IsSelected=a;if(!this.FreezeEvents()){this.OnSelecting()}}};IDDocument.prototype.ChangingProperty=function(a){var b=new IDVariant();if(!this.FreezeEvents()){this.OnChangingProperty(new IDVariant(a),b);if(b.isFalse()&&!this.GetLock()){b.set(IDVariant.TRUE)}}if(b.isFalse()){if(!this.Updated()){this.set_Updated(true)}else{this.SetUIModified()}if(this.iInTrans){if(this.ChgProp==null){this.ChgProp=new ArrayList()}if(!this.ChgProp.Contains(a)){this.ChgProp.Add(a)}}if(this.iParentCollection!=null){this.iParentCollection.ChangeDoc(this,a)}return true}return false};IDDocument.prototype.set_Valid=function(a){this.IsValid=a};IDDocument.prototype.set_Loaded=function(a){this.iLoaded=a};IDDocument.prototype.set_Hidden=function(a){if(this.iHidden!=a){var d=false;var c=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this,true):false;var g=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this,false):false;this.iHidden=a;var f=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this,false):false;var e=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this,true):false;if(this.ParentCollection()!=null){if(g&&!f){this.ParentCollection().ChangeCount(-1);d=true}if(!g&&f){this.ParentCollection().ChangeCount(1);d=true}if(!d&&c!=e){this.ParentCollection().UISetModified()}}}};IDDocument.prototype.LoadChildren=function(b,c,a){if(c==undefined){c=""}if(a==undefined){a=9999}MDOInit.LoadChildren(this,b,c,a)};IDDocument.prototype.SetLoaded=function(b,a){MDOInit.SetLoaded(this,b,a)};IDDocument.prototype.SetInserted=function(b,a){MDOInit.SetInserted(this,b,a)};IDDocument.prototype.BeginTrans=function(){this.iInTrans=true;this.OnBeginTrans()};IDDocument.prototype.EndTrans=function(){this.iInTrans=false;if(this.ChgProp!=null){for(var a=0;a<this.ChgProp.length;a++){var b=this.GetPropDOError(this.ChgProp[a]);if(b!=null&&b.Ack){this.PropErrors.remove(b.PropIdx)}}}this.OnEndTrans();if(this.ChgProp!=null){this.MarkAsChanged()}this.ChgProp=null};IDDocument.prototype.WasModified=function(a){return(this.ChgProp==null)?false:this.ChgProp.Contains(a)};IDDocument.prototype.OnBeginTrans=function(){};IDDocument.prototype.OnEndTrans=function(){};IDDocument.prototype.InTrans=function(){return this.iInTrans};IDDocument.prototype.GetPropByIndex=function(a){if(this.aVars[a-1]==null){return new IDVariant()}else{return new IDVariant(this.aVars[a-1])}};IDDocument.prototype.GetPropOrigValue=function(a){if(this.oVars==null||this.oVars[a-1]==null){return this.GetPropByIndex(a)}else{return new IDVariant(this.oVars[a-1])}};IDDocument.prototype.SetPropByIndex=function(a,b){if(this.GetDTTObj()!=null){this.GetDTTObj().AddMsg(DTTEngine.DTTMSG_WARN,"",200,"IDDocument.SetPropByIndex",this.GetName(1)+": Property "+a+" not found")}};IDDocument.prototype.SetPropDirect=function(a,b){this.aVars[a-1]=new IDVariant(b)};IDDocument.prototype.GetPropDirect=function(a){return new IDVariant(this.aVars[a-1])};IDDocument.prototype.SetPropOrigValue=function(a,b){if(this.oVars==null){this.oVars=new Array(this.aVars.length)}this.oVars[a-1]=new IDVariant(b)};IDDocument.prototype.GetCollByIndex=function(a){if(this.GetDTTObj()!=null){this.GetDTTObj().AddMsg(DTTEngine.DTTMSG_WARN,"",200,"IDDocument.GetCollByIndex",this.GetName(1)+": Collection "+a+" not found")}return null};IDDocument.prototype.LoadFromDB=function(a,b){if(a==undefined){a=9999}if(b==undefined){b=false}MDOInit.LoadFromDB(this,a,b)};IDDocument.prototype.GetMasterQuery=function(b,c,a){};IDDocument.prototype.GetValueSource=function(d,b,a,c){};IDDocument.prototype.GetDBExpr=function(a){return""};IDDocument.prototype.LoadChildrenFromDB=function(a){return MDOInit.LoadChildrenFromDB(this,a)};IDDocument.prototype.LoadCollectionFromDB=function(b,a){MDOInit.LoadCollectionFromDB(this,b,a)};IDDocument.prototype.LoadCollectionDirect=function(d,b,a){if(b==undefined){b=9999}MDOInit.LoadCollectionDirect(this,d,b,a)};IDDocument.prototype.LoadCollectionBE=function(a,f,b,e,d){if(typeof(a)=="string"){var c=a;a=new IDCollection();this.LoadCollectionFromXML(a,c,false);this.LoadCollectionBE(a,f,b,e);return this.SaveCollectionToXML(a,false,"",b)}if(f==undefined){f=false}if(b==undefined){b=0}if(e==undefined){e=null}if(d==undefined){d=false}return MDOInit.LoadCollectionBE(this,a,f,b,e,d)};IDDocument.prototype.GetQBEClauses=function(a,e,c,b,d){MDOInit.GetQBEClauses(this,a,e,c,b,d)};IDDocument.prototype.LoadCollectionRS=function(a,c,b){if(b==undefined){b=0}MDOInit.LoadCollectionRS(this,a,c,b)};IDDocument.prototype.GetLinkedDocument=function(c,f,e,d,b,a){if(e==undefined){e=null}if(d==undefined){d=null}if(b==undefined){b=null}if(a==undefined){a=null}return MDOInit.GetLinkedDocument(this,c,f,e,d,b,a)};IDDocument.prototype.IsModified=function(a){if(a==undefined){a=9999}return MDOInit.IsModified(this,a)};IDDocument.prototype.Validate=function(c,a,b){if(c==undefined){c=0}if(a==undefined){a=9999}if(b==undefined){b=false}return MDOInit.Validate(this,c,a,b)};IDDocument.prototype.InternalValidate=function(b,a){MDOInit.InternalValidate(this,b,a)};IDDocument.prototype.Duplicate=function(b,e,a,d,c){if(b==undefined){b=9999}if(e==undefined){e=null}if(a==undefined){a=false}if(d==undefined){d=false}if(c==undefined){c=false}return MDOInit.Duplicate(this,b,e,true,a,d,c)};IDDocument.prototype.OnDuplicate=function(a){};IDDocument.prototype.SaveToDB=function(a,b){if(a==undefined){a=9999}if(b==undefined){b=true}return MDOInit.SaveToDB(this,a,b)};IDDocument.prototype.SaveToXML=function(c,a,b,e,f,d){if(c==undefined){c=true}if(a==undefined){a=""}if(b==undefined){b=9999}if(e==undefined){e=XMLDoc.FT_XML}if(f==undefined){f=false}if(d==undefined){d=false}return MDOInit.SaveToXML(this,c,a,b,null,null,false,e,f,d)};IDDocument.prototype.SaveCollectionToXML=function(b,d,a,c){return MDOInit.SaveCollectionToXML(this,b,d,a,c)};IDDocument.prototype.LoadFromXML=function(d,c,a,b){if(c==undefined){c=true}if(a==undefined){a=XMLDoc.FT_XML}if(b==undefined){b=false}return MDOInit.LoadFromXML(this,d,c,a,b)};IDDocument.prototype.LoadCollectionFromXML=function(a,c,b){return MDOInit.LoadCollectionFromXML(this.GetMainFrm(),a,c,b)};IDDocument.prototype.ReconnectChildren=function(a){MDOInit.ReconnectFK(this,a)};IDDocument.prototype.toString=function(){return this.ToString()};IDDocument.prototype.ToString=function(){return MDOInit.ToString(this)};IDDocument.prototype.TypeName=function(){return this.GetMD().ObjTag};IDDocument.GetClassName=function(a){return(a?"com.progamma.doc.":"")+"IDDocument"};IDDocument.prototype.GetClass=function(){return IDDocument};IDDocument.prototype.UpdateCount=function(){return this.iUpdCount};IDDocument.prototype.LoadLookupValues=function(a){if(a==undefined){a=false}MDOInit.LoadLookupValues(this,a)};IDDocument.prototype.LoadValueSource=function(b,e){if(typeof(b)=="string"){var a=b;b=new IDCachedRowSet();var d=null;if(a.length>0){var f=a.split("|");d=new ArrayList();for(var c=0;c<f.length;c++){d.Add(f[c])}}MDOInit.LoadValueSource(this,b,d);return b.SaveToXML()}MDOInit.LoadValueSource(this,b,e)};IDDocument.prototype.GetAutoLookupCode=function(){return MDOInit.GetAutoLookupCode(this)};IDDocument.prototype.GetAutoLookupDescription=function(){return MDOInit.GetAutoLookupDescription(this)};IDDocument.prototype.GetLKE=function(j,g,c,f){if(typeof(j)=="string"){var a=j;c=new ArrayList();while(a.length>0){var d=parseInt(a.substr(0,a.indexOf(",")));c.Add(d);a=a.substr(a.indexOf(",")+1)}j=new IDCachedRowSet();var g=new IDVariant();var h=MDOInit.GetLKE(this,j,g,c,null);var b=j.SaveToXML();var e=new Array();e[0]=h;e[1]=g.GetSOAPobj();e[2]=b;return e}return MDOInit.GetLKE(this,j,g,c,f)};IDDocument.prototype.CopyFrom=function(d,a,c,b){if(a!==undefined&&c!==undefined&&b==undefined){b=c;c=a;a=9999}if(a==undefined){a=9999}if(c==undefined){c=false}if(b==undefined){b=false}MDOInit.CopyFrom(this,d,a,c,b)};IDDocument.prototype.GetCopy=function(){return MDOInit.GetCopy(this)};IDDocument.prototype.ClearErrors=function(a,b){if(a==undefined){a=false}if(b==undefined){b=0}this.DocErrors=null;if(!a||this.PropErrors==null){this.PropErrors=null}else{var h=new HashTableSrv();var f=this.PropErrors.values();for(var e=0;e<f.length;e++){var d=f[e];if(d.Ack){h[d.PropIdx]=d;d.ErrType=IDDocument.ERR_NONE;d.Text="";d.Shown=false}}this.PropErrors=h}if(b>0){var g=this.GetMD();for(var e=1;e<=g.GetNumColl();e++){this.GetCollByIndex(e).ClearErrors(a,b-1)}}};IDDocument.prototype.HasErrors=function(k,h){if(k==undefined){k=false}if(h==undefined){h=0}if(this.DocErrors!=null&&this.DocErrors.Count()>0){return true}if(this.PropErrors==null){return false}var g=this.PropErrors.values();for(var e=0;e<g.length;e++){var c=g[e];if(c.ErrType==IDDocument.ERR_ERROR||(c.ErrType==IDDocument.ERR_WARNACK&&!c.Ack)||(k&&c.ErrType==IDDocument.ERR_WARNING)){return true}}if(h>0){var b=this.GetMD();for(var e=1;e<=b.GetNumColl();e++){var f=this.GetCollByIndex(e);var a=f.GetCollection();for(var d=0;d<a.length;d++){if(a[d].HasErrors(k,h-1)){return true}}}}return false};IDDocument.prototype.GetPropError=function(a){var b=this.GetPropDOError(a);if(b==null){return null}else{return b.Text}};IDDocument.prototype.GetPropDOError=function(a){if(this.PropErrors==null){return null}else{return this.PropErrors[a]}};IDDocument.prototype.GetDocErrors=function(a){if(a!=null&&this.DocErrors!=null){a.Clear();a.AddRange(this.DocErrors)}};IDDocument.prototype.GetFailedDoc=function(){if(this.LastFailedCheck!=null){return this}var d=this.GetMD();for(var b=1;b<=d.GetNumColl();b++){var e=this.GetCollByIndex(b);var a=e.GetFailedDoc();if(a!=null){return a}}return null};IDDocument.prototype.SetPropError=function(b,d,a){if(a==undefined){a=IDDocument.ERR_ERROR}if(d!=null&&d.length>0){if(this.PropErrors==null){this.PropErrors=new HashTableSrv()}var c=this.GetPropDOError(b);if(c==null){c=new DOError();this.PropErrors[b]=c}c.Text=d;c.ErrType=a;c.PropIdx=b}else{if(this.PropErrors!=null){this.PropErrors.remove(b)}}};IDDocument.prototype.AddDocError=function(a){if(a!=null&&a.length>0){if(this.DocErrors==null){this.DocErrors=new ArrayList()}this.DocErrors.Add(a)}};IDDocument.prototype.SetPropErrorAck=function(a,c){var b=this.GetPropDOError(a);if(b!=null){b.Ack=c}};IDDocument.prototype.BeforeLoad=function(a){};IDDocument.prototype.AfterLoad=function(b,a){};IDDocument.prototype.BeforeLoadCollection=function(c,a,b){};IDDocument.prototype.OnValidate=function(b,a,c){};IDDocument.prototype.BeforeSave=function(c,a,b){};IDDocument.prototype.AfterSave=function(a){};IDDocument.prototype.OnSQLQuery=function(a,c,b){};IDDocument.prototype.AfterSQLQuery=function(b,d,a,c){};IDDocument.prototype.OnSaveXMLProp=function(c,b,a,d){};IDDocument.prototype.OnSaveXMLObj=function(b,a){};IDDocument.prototype.OnLoadXMLProp=function(d,c,a,e,b){};IDDocument.prototype.OnLoadXMLObj=function(c,a,b){};IDDocument.prototype.OnGetName=function(a,e,d,c,b){};IDDocument.prototype.OnGetIcon=function(b,a,e,d,c){};IDDocument.prototype.OnGetTooltip=function(d,e,c,b,a){};IDDocument.prototype.OnClick=function(){};IDDocument.prototype.OnExpand=function(){};IDDocument.prototype.OnMayHaveChildren=function(a){};IDDocument.prototype.BeforeLookup=function(b,a){};IDDocument.prototype.AfterLookup=function(){};IDDocument.prototype.OnGetValueSource=function(a,b){};IDDocument.prototype.OnGetLKE=function(b,c,e,f,d,a){};IDDocument.prototype.OnDrop=function(a,b,e,c,d){};IDDocument.prototype.OnInit=function(){};IDDocument.prototype.OnClear=function(){};IDDocument.prototype.OnResyncClient=function(a,e,d,b,c){};IDDocument.prototype.OnWebAPI=function(a){};IDDocument.prototype.OnWebAPIResponse=function(a,b,c){};IDDocument.prototype.EditAttachments=function(){MDOInit.EditAttachments(this)};IDDocument.prototype.ShowAttachment=function(a){return MDOInit.ShowAttachment(this,a)};IDDocument.prototype.GetAttachment=function(a){return MDOInit.GetAttachment(this,a)};IDDocument.prototype.SetAttachment=function(c,b,d,a){return MDOInit.SetAttachment(this,c,b,d,a)};IDDocument.prototype.GetComment=function(b,c,a){return MDOInit.GetComment(this,b,c,a)};IDDocument.prototype.SetComment=function(a,d,c,b){return MDOInit.SetComment(this,a,d,c,b)};IDDocument.prototype.GetNamedPropertyDefinition=function(a){var b=new DOMDProp();this.OnGetNamedPropertyDefinition(new IDVariant(a),b);return b};IDDocument.prototype.GetNamedPropertyValue=function(a){var b=new IDVariant();this.OnGetNamedPropertyValue(new IDVariant(a),b);return b};IDDocument.prototype.SetNamedPropertyValue=function(a,b){this.OnSetNamedPropertyValue(new IDVariant(a),b)};IDDocument.prototype.OnGetNamedPropertyDefinition=function(a,b){};IDDocument.prototype.OnGetNamedPropertyValue=function(a,b){};IDDocument.prototype.OnSetNamedPropertyValue=function(a,b){};IDDocument.prototype.GetLock=function(b,a,d){if(b==undefined){b=9999}if(a==undefined){a=""}if(d==undefined){d=new IDVariant()}if(typeof(d)=="string"){d=new IDVariant(d)}try{return MDOInit.GetLock(this,b,a,d)}catch(c){if(this.GetDTTObj()!=null){this.GetDTTObj().AddException("","IDDocument.GetLock",this.GetName(1)+": Exception while getting lock",c)}return false}};IDDocument.prototype.ReleaseLock=function(a){if(a==undefined){a=9999}try{return MDOInit.ReleaseLock(this,a)}catch(b){if(this.GetDTTObj()!=null){this.GetDTTObj().AddException("","IDDocument.ReleaseLock",this.GetName(1)+": Exception while releasing lock",b)}return false}};IDDocument.prototype.Locked=function(){return this.IsLocked};IDDocument.prototype.set_Locked=function(a){this.IsLocked=a};IDDocument.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};IDDocument.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}var c=this.GetMD();while(c!=null){var b=c.GetTag(a);if(b!=null){return b}c=c.BaseMD}return null};IDDocument.prototype.SetObjTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};IDDocument.prototype.GetObjTag=function(a){if(this.TagMap!=null){return this.TagMap[a.stringValue()]}return null};IDDocument.prototype.getDebugInfo=function(b,a){};IDDocument.prototype.getPropDebugInfo=function(b,a,c){};IDDocument.prototype.setPropDebug=function(b,a,c){};IDDocument.prototype.Matchs=function(h,g){if(g==undefined){g=false}var c=this.GetMD();var j=g;for(var e=1;e<=c.GetNumProp();e++){var l=this.GetPropByIndex(e);var f=h.GetPropByIndex(e);if(f.Value==null){continue}if(g&&f.stringValue().length==0){continue}var b=g;var m=new IDVariant(";");var a=false;if(b&&"DO_ID".equals(c.GetProp(e).Concept)){m=new IDVariant(" ");a=true;if(f.stringValue().indexOf(m.stringValue())==-1){b=false;if(f.stringValue().charAt(0)=="§"){f=new IDVariant(f.stringValue().substr(1))}}}var k=(h.GetMainFrm() instanceof WebEntryPointSrv?h.GetMainFrm():null);if(b?!IDL.QbeMatch(l,f,k,m,a):!f.equals(l)){return false}else{j=true}}return j};IDDocument.prototype.Show=function(a){return null};IDDocument.prototype.OnShow=function(a){};IDDocument.prototype.GetDNA=function(){var d=this.GetMD();var b=new StringTokenizer();if(this.AssemblyName){b.addToken(new IDVariant(this.AssemblyName+"|"+this.TypeName()))}else{if(this.GetMainFrm().CompNameSpace){b.addToken(new IDVariant(this.GetMainFrm().CompNameSpace+"$"+this.TypeName()))}else{b.addToken(new IDVariant(this.TypeName()))}}for(var c=1;c<=d.GetNumProp();c++){var a=d.GetProp(c);if(a.PK){b.addToken(this.GetPropByIndex(c))}}return b.getString()};IDDocument.GetFromDNA=function(s,d,b,j,x,m){if(m==undefined){m=false}if(j!=null&&j instanceof WebEntryPointSrv){j.ErrObj.ErrorDescription="";if(j==j.GetApplication()&&j.DocHelper!=null){j.DocHelper.OnGetDNA(s)}}var h=(j!=null?j.getDTTObj():null);var n=new StringTokenizer();n.setString(s);if(!n.hasNext()){if(h!=null){h.AddMsg(DTTEngine.DTTMSG_WARN,"",201,"IDDocument.GetFromDNA","DNA is empty")}if(j instanceof WebEntryPointSrv){j.ErrObj.ErrorDescription="DNA is empty"}return null}var f=true;var g=n.next().ToString();var z=null;try{if(g.indexOf("|")!=-1&&j!=null&&j instanceof WebEntryPointSrv){var o=g.substring(0,g.indexOf("|"));var c=g.substring(g.indexOf("|")+1);z=j.GetApplication().CreateObjFromLibrary(o,c);if(z==null){if(h!=null){h.AddMsg(DTTEngine.DTTMSG_WARN,"",201,"IDDocument.GetFromDNA","Can't find class "+g+" inside the assembly "+o)}if(j instanceof WebEntryPointSrv){j.ErrObj.ErrorDescription="Can't find class "+g+" inside the assembly "+o}}}else{if(g.indexOf("$")!=-1&&j!=null&&j instanceof WebEntryPointSrv){var u=g.substring(0,g.indexOf("$"));var c=g.substring(g.indexOf("$")+1);var l=j.GetApplication().GetCompFromNameSpace(u);if(l!=null){z=l.CreateDocument(c);f=false;if(z==null){if(h!=null){h.AddMsg(DTTEngine.DTTMSG_WARN,"",201,"IDDocument.GetFromDNA","Can't find class "+g+" inside the component "+u)}if(j instanceof WebEntryPointSrv){j.ErrObj.ErrorDescription="Can't find class "+g+" inside the component "+u}}}else{if(h!=null){h.AddMsg(DTTEngine.DTTMSG_WARN,"",201,"IDDocument.GetFromDNA","Can't find component "+u)}if(j instanceof WebEntryPointSrv){j.ErrObj.ErrorDescription="Can't find component "+u}}}else{if(j instanceof WebEntryPointSrv){z=j.CreateDocument(g);f=false}if(z==null){if(h!=null){h.AddMsg(DTTEngine.DTTMSG_WARN,"",201,"IDDocument.GetFromDNA","Can't find class "+g)}if(j instanceof WebEntryPointSrv){j.ErrObj.ErrorDescription="Can't find class "+g}}}}}catch(t){if(h!=null){h.AddException(s.stringValue(),"IDDocument.GetFromDNA","Can't find class "+g,t)}if(j instanceof WebEntryPointSrv){j.ErrObj.ErrorDescription="Can't find class "+g+": "+t}}if(z!=null){if(f&&j!=null&&g.indexOf("|")==-1){z.SetMainFrm(j,x)}var y=true;var r=z.GetMD();for(var q=1;q<=r.GetNumProp();q++){var a=r.GetProp(q);if(a.PK){if(n.hasNext()){var k=n.next();MDOInit.ConvertVariant(k,a);z.SetPropByIndex(q,k)}else{y=false}}}if(y&&!m){if(d){z.LoadLookupValues()}if(!d||b>0){try{z.LoadFromDB(b)}catch(t){}}}}return z};IDDocument.prototype.OnChange=function(){};IDDocument.prototype.IsChanged=function(){return this.iChanged};IDDocument.prototype.MarkAsChanged=function(){if(this.GetMD().NotifyOnChange){if(this.GetModifiedList()!=null){if(!this.IsChanged()){this.GetModifiedList().Add(this);this.iChanged=true}}else{this.OnChange()}}if(this.Parent()!=null){this.Parent().MarkAsChanged()}};IDDocument.prototype.ProcessChange=function(a){this.OnChange();this.iChanged=undefined;if(a&&this.GetModifiedList()!=null){this.GetModifiedList().Remove(this)}};IDDocument.prototype.IsEmpty=function(){for(var a=0;a<this.aVars.length;a++){if(this.aVars[a]!=null){return false}}return true};IDDocument.prototype.ResetOrigValues=function(){this.oVars=null};IDDocument.prototype.ChangePropDirect=function(b,f,e){if(!f.equals(this.aVars[b-1])){var d=this.aVars[b-1];this.aVars[b-1]=new IDVariant(f);var a=false;if(this.oVars==null){this.oVars=new Array(this.aVars.length);a=true}var c=false;if(this.oVars[b-1]==null){this.oVars[b-1]=d;c=true}if(!e&&!this.ChangingProperty(b)){this.aVars[b-1]=d;if(a){this.oVars=null}else{if(c){this.oVars[b-1]=null}}}if(e){this.SetUIModified()}}};IDDocument.prototype.GetOtherPropByIndex=function(a){return null};IDDocument.prototype.SetOtherPropByIndex=function(a,b){};IDDocument.prototype.AcknowledgeWarnings=function(a){if(a==undefined){a=0}var e=this.GetMD();for(var d=1;d<=e.GetNumProp();d++){this.SetPropErrorAck(d,true)}if(a>0){for(var d=1;d<=e.GetNumColl();d++){var f=this.GetCollByIndex(d);var c=f.GetCollection();for(var b=0;b<c.length;b++){c[b].AcknowledgeWarnings(a-1)}}}};IDDocument.prototype.equals=function(a){return a==this};IDDocument.IsMyInstance=function(a){return(a instanceof IDDocument)};IDDocument.prototype.SuspendSync=function(){return this.iSuspendSync};IDDocument.prototype.set_SuspendSync=function(a){if(a){this.iSuspendSync=true}else{if(MDOInit.ResumeDocSync(this)){this.iSuspendSync=false}}};IDDocument.prototype.WebApi_LoadFromXML=function(d,c){if(this.GetMainFrm()==null){var a=d;var b=this.GetClass().GetClassName(true);if(b.indexOf(".")!=-1){a=d.GetCompFromNameSpace(b.substring(0,b.lastIndexOf(".")))}this.SetMainFrm(a,a.getIMDB())}return MDOInit.LoadXMLNode(this,c.GetNode(),true,true)};IDDocument.prototype.WebApi_SaveToXML=function(e,d,b){if(this.GetMainFrm()==null){var a=e;var c=this.GetClass().GetClassName(true);if(c.indexOf(".")!=-1){a=e.GetCompFromNameSpace(c.substring(0,c.lastIndexOf(".")))}this.SetMainFrm(a,a.getIMDB())}return MDOInit.SaveToXML(this,false,"",b,null,null,false,d,true)};function IDObject(){}IDObject.prototype.SetMainFrm=function(a,b){};function IOTConnector(a){this.MainFrm=a;this.ServiceEndpoint="";this.ServiceType=IOTConnector.SERTYPE_OTHER;this.ServiceFormat=XMLDoc.FT_JSON;this.AuthorizationEndpoint="";this.TokenEndpoint="";this.RedirectUri="";this.ClientID="";this.ClientSecret="";this.Scope="";this.AccessToken="";this.RefreshToken="";this.AccessTokenLifetime=null;this.Username="";this.Password="";this.SalesforceSessionTimeout=120;this.ODataVersion=-1}IOTConnector.SERTYPE_OTHER=0;IOTConnector.SERTYPE_SALESFORCE=1;IOTConnector.SERTYPE_ODATA=2;IOTConnector.IOT_TAG="ID_IOTDATA";IOTConnector.DocMDMap=new IDMap();IOTConnector.prototype.SetMainFrm=function(a,b){this.MainFrm=a};IOTConnector.set_ServiceConnector=function(b,c,a){var e=b.GetApplication();var d=e.GetServiceConnectors();d[c]=a;a.ServiceEndpoint=c;if(a.MainFrm==null){a.SetMainFrm(e,e.getIMDB())}if(a.RedirectUri.length==0){a.RedirectUri=e.GetAppUrl(true,false)}switch(a.ServiceType){case IOTConnector.SERTYPE_SALESFORCE:a.AuthorizationEndpoint="https://login.salesforce.com/services/oauth2/authorize";a.TokenEndpoint="https://login.salesforce.com/services/oauth2/token";break}};IOTConnector.ServiceConnector=function(a,b){if(b==null||b.length==0){return null}var e=a.GetApplication();var d=e.GetServiceConnectors();var f=d[b];if(f==null){f=new IOTConnector();IOTConnector.set_ServiceConnector(a,b,f)}return f};IOTConnector.InitMetadata=function(n,y){var g=null;var t=null;if(y.ServiceEndpoint==null||(y.ServiceEndpoint.length>0&&IOTConnector.ServiceConnector(n,y.ServiceEndpoint).ODataVersion==-1)){var D=y.GetTag(new IDVariant(IOTConnector.IOT_TAG)).stringValue();if(D.length==0&&y.ServiceEndpoint==null){y.ServiceEndpoint="";return}try{var z=new XMLDoc();z.LoadFromString(D);t=z.GetRootNode();g=IOTConnector.ServiceConnector(n,t.GetAttribute("Endpoint"));if(t.GetAttribute("Type").length>0){g.ServiceType=parseInt(t.GetAttribute("Type"))}if(t.GetAttribute("Format").length>0){g.ServiceFormat=parseInt(t.GetAttribute("Format"))}if(t.GetAttribute("ODataVersion").length>0){g.ODataVersion=parseInt(t.GetAttribute("ODataVersion"))}else{g.ODataVersion=0}}catch(A){WriteToConsoleError(A)}}if(y.ServiceEndpoint==null&&t!=null){try{y.ServiceEndpoint=t.GetAttribute("Endpoint");y.IOTCode=t.GetAttribute("Code");if(t.GetAttribute("ODataEntitySet").length>0){y.ODataEntitySet=t.GetAttribute("ODataEntitySet")}if(t.GetAttribute("ODataNamespace").length>0){y.ODataNamespace=t.GetAttribute("ODataNamespace")}if(t.GetAttribute("ODataWithEtag").length>0){y.ODataWithEtag=true}IOTConnector.SetDocMDMap(y);if(t.GetAttribute("Methods").length>0){y.IOTMethods=t.GetAttribute("Methods")}for(var x=1;x<=y.GetNumProp();x++){var C=y.GetProp(x);if(C.IOTData==null||C.IOTData.length==0){continue}var z=new XMLDoc();z.LoadFromString(C.IOTData);t=z.GetRootNode();C.IOTCode=t.GetAttribute("Code");C.ODataType=t.GetAttribute("ODataType");C.Counter=(t.GetAttribute("Counter")=="-1");if(t.GetAttribute("FK").length>0){var l=t.GetAttribute("FK").split(",");for(var v=0;v<l.length;v++){var m=l[v];var r=m.indexOf(".");var c=m.substr(0,r);var q=m.substr(r+1);var o=IOTConnector.CreateIOTDocument(g,n,c);if(o!=null){var b=new DOMDLinkedDoc(o.TypeName(),1);b.SetLinkedProp(0,o.GetPropertyIndex(q,false,false,false,false,true),C.Index);C.LinkedDoc=b}}}while(t.HasNextNode()){var h=t.GetNextNode();if(!h.Name().equals("LinkedDocs")){continue}var c=h.GetAttribute("Type");var o=IOTConnector.CreateIOTDocument(g,n,c);if(o!=null){var a=h.GetAttribute("SrcProp").split(",");var d=h.GetAttribute("DstProp").split(",");var b=new DOMDLinkedDoc(o.TypeName(),a.length);b.SetName(h.GetAttribute("Name"));C.LinkedDoc=b;for(var v=0;v<a.length;v++){b.SetLinkedProp(v,o.GetPropertyIndex(d[v],false,false,false,false,true),y.GetIOTCodeIndex(a[v]))}}}}for(var x=1;x<=y.GetNumColl();x++){var f=y.GetColl(x);if(f.IOTData.length==0){continue}var z=new XMLDoc();z.LoadFromString(f.IOTData);t=z.GetRootNode();f.IOTCode=t.GetAttribute("Code");if(t.GetAttribute("NM").length>0){f.IOTMultiplicityNM=true}if(t.GetAttribute("PKs").length>0){var s=n.CreateDocument(f.ChildrenName).GetMD();var B=t.GetAttribute("PKs").split(",");var l=t.GetAttribute("FKs").split(",");for(var v=0;v<B.length;v++){for(var u=1;u<=y.GetNumProp();u++){var C=y.GetProp(u);if(C.IOTCode.equals(B[v])){f.PKColl.Add(C.ObjTag);break}}for(var u=1;u<=s.GetNumProp();u++){var C=s.GetProp(u);if(C.IOTCode.equals(l[v])){f.FKColl.Add(C.ObjTag);break}}}}}}catch(A){WriteToConsoleError(A)}}};IOTConnector.prototype.Authenticate=function(){if(this.IsAuthenticated()){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.Authenticate","Authentication already done");return}if(!this.CheckAuthenticationParameters()){return}var d=new IDMap();d.set_Value(new IDVariant("response_type"),new IDVariant("code"));d.set_Value(new IDVariant("client_id"),new IDVariant(this.ClientID));d.set_Value(new IDVariant("redirect_uri"),new IDVariant(this.RedirectUri+"?WCI="+Glb.ITEM_OAUTH));if(this.Scope.length>0){d.set_Value(new IDVariant("scope"),new IDVariant(this.Scope))}d.set_Value(new IDVariant("state"),new IDVariant(IDL.Base64Encode(this.ServiceEndpoint)));var f=new IDVariant();this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.Authenticate","Service "+this.ServiceEndpoint+": Fire BeforeOAuthRequestCode Event");this.BeforeOAuthRequestCode(d,f);if(f.isFalse()){var a=this.AuthorizationEndpoint;var j=d.GetKeys();for(var c=0;c<j.Size();c++){var g=j.get_Value(new IDVariant(c));var h=g.stringValue();var b=d.get_Value(g).stringValue();a+=(c==0?"?":"&")+h+"="+Glb.URLEncode(b)}var e=this.MainFrm;e.set_RedirectTo(new IDVariant(a));e.set_RedirectNewWindow(e.ParamsObj().UseRD4&&e.ShellObject.IsInsideShell())}};IOTConnector.prototype.RequestAccessToken=function(){var j=this.MainFrm.GetRequestParams();var k=j.get_Value(new IDVariant("error"));var b=j.get_Value(new IDVariant("code"));if(k.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RequestAccessToken","OAuth request code error");this.MainFrm.getDTTObj().AddMsgToken("","error",k);this.MainFrm.getDTTObj().AddMsgToken("","error_description",j.get_Value(new IDVariant("error_description")))}else{if(b.stringValue().length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RequestAccessToken","Code not found")}else{this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","Code obtained");this.MainFrm.getDTTObj().AddMsgToken("","code",b.stringValue())}}var m=new IDVariant();this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","Service "+this.ServiceEndpoint+": Fire AfterOAuthRequestCode Event");this.AfterOAuthRequestCode(j,m);if(m.isTrue()||k.stringValue().length>0||b.stringValue().length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","Service "+this.ServiceEndpoint+": access token request interrupted");return}j.Clear();j.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));j.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));j.set_Value(new IDVariant("code"),new IDVariant(b));j.set_Value(new IDVariant("grant_type"),new IDVariant("authorization_code"));j.set_Value(new IDVariant("client_id"),new IDVariant(this.ClientID));j.set_Value(new IDVariant("client_secret"),new IDVariant(this.ClientSecret));j.set_Value(new IDVariant("redirect_uri"),new IDVariant(this.RedirectUri+"?WCI="+Glb.ITEM_OAUTH));m=new IDVariant();this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.BeforeOAuthRequestToken","Service "+this.ServiceEndpoint+": Fire BeforeOAuthRequestToken Event");this.BeforeOAuthRequestToken(j,m);if(m.isTrue()){return}var h=new IDVariant();try{h=IDL.HttpRequest(this.MainFrm,new IDVariant(this.TokenEndpoint),j);var f=new XMLDoc();f.LoadFromString(h.stringValue(),this.ServiceFormat);var l=f.GetRootNode();if(l.GetAttribute("error").length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RequestAccessToken","OAuth request access token error");this.MainFrm.getDTTObj().AddMsgToken("","error",l.GetAttribute("error"));this.MainFrm.getDTTObj().AddMsgToken("","error_description",l.GetAttribute("error_description"))}else{this.AccessToken=l.GetAttribute("access_token");this.RefreshToken=l.GetAttribute("refresh_token");if(l.GetAttribute("expire_in").length>0){this.AccessTokenLifetime=IDL.DateAdd(new IDVariant("s"),new IDVariant(l.GetAttribute("expire_in")),IDL.Now()).dateValue()}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){this.AccessTokenLifetime=IDL.DateAdd(new IDVariant("n"),new IDVariant(this.SalesforceSessionTimeout),IDL.Now()).dateValue()}else{this.AccessTokenLifetime=null}}if(this.AccessToken.length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","AccessToken obtained");this.MainFrm.getDTTObj().AddMsgToken("","access_token",this.AccessToken);if(this.RefreshToken.length>0){this.MainFrm.getDTTObj().AddMsgToken("","refresh_token",this.RefreshToken)}}}}catch(g){WriteToConsoleError(g);this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RequestAccessToken","OAuth request access token error: "+g)}this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.AfterOAuthRequestToken","Service "+this.ServiceEndpoint+": Fire AfterOAuthRequestToken Event");var c=j.get_Object(new IDVariant("ID_HEADERS"));var n=new IDMap();for(var d=0;d<c.Size();d++){var a=c.get_Value(new IDVariant(d)).stringValue().split(":");n.set_Value(new IDVariant(a[0]),new IDVariant(a[1]))}this.AfterOAuthRequestToken(h,j.get_Value(new IDVariant("ID_RESPONSECODE")),n)};IOTConnector.prototype.IsAuthenticated=function(){if(this.AccessToken.length>0&&this.AccessTokenLifetime!=null&&this.AccessTokenLifetime<IDL.Now().dateValue()&&this.RefreshToken.length>0){this.RefreshAccessToken()}return(this.AccessToken.length>0)};IOTConnector.prototype.RefreshAccessToken=function(){this.AccessToken="";this.AccessTokenLifetime=null;var h=new IDMap();h.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));h.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));h.set_Value(new IDVariant("grant_type"),new IDVariant("refresh_token"));h.set_Value(new IDVariant("client_id"),new IDVariant(this.ClientID));h.set_Value(new IDVariant("client_secret"),new IDVariant(this.ClientSecret));h.set_Value(new IDVariant("refresh_token"),new IDVariant(this.RefreshToken));if(this.Scope.length>0){h.set_Value(new IDVariant("scope"),new IDVariant(this.Scope))}var k=new IDVariant();this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.BeforeOAuthRequestToken","Service "+this.ServiceEndpoint+": Fire BeforeOAuthRequestToken Event");this.BeforeOAuthRequestToken(h,k);if(k.isTrue()){return}var g=new IDVariant();try{g=IDL.HttpRequest(this.MainFrm,new IDVariant(this.TokenEndpoint),h);var d=new XMLDoc();d.LoadFromString(g.stringValue(),this.ServiceFormat);var j=d.GetRootNode();if(j.GetAttribute("error").length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RefreshAccessToken","OAuth refresh access token error");this.MainFrm.getDTTObj().AddMsgToken("","error",j.GetAttribute("error"));this.MainFrm.getDTTObj().AddMsgToken("","error_description",j.GetAttribute("error_description"))}else{this.AccessToken=j.GetAttribute("access_token");if(j.GetAttribute("expire_in").length>0){this.AccessTokenLifetime=IDL.DateAdd(new IDVariant("s"),new IDVariant(j.GetAttribute("expire_in")),IDL.Now()).dateValue()}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){this.AccessTokenLifetime=IDL.DateAdd(new IDVariant("n"),new IDVariant(this.SalesforceSessionTimeout),IDL.Now()).dateValue()}else{this.AccessTokenLifetime=null}}if(this.AccessToken.length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","AccessToken obtained");this.MainFrm.getDTTObj().AddMsgToken("","access_token",this.AccessToken)}}}catch(f){WriteToConsoleError(f);this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RefreshAccessToken","OAuth refresh access token error: "+f)}this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.AfterOAuthRequestToken","Service "+this.ServiceEndpoint+": Fire AfterOAuthRequestToken Event");var b=h.get_Object(new IDVariant("ID_HEADERS"));var l=new IDMap();for(var c=0;c<b.Size();c++){var a=(b.get_Value(new IDVariant(c))).stringValue().split(":");l.set_Value(new IDVariant(a[0]),new IDVariant(a[1]))}this.AfterOAuthRequestToken(g,h.get_Value(new IDVariant("ID_RESPONSECODE")),l)};IOTConnector.prototype.CheckAuthenticationParameters=function(){if(this.ClientID.length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.CheckAuthenticationParameters","Missing ClientID required for authentication");return false}if(this.ClientSecret.length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.CheckAuthenticationParameters","Missing ClientSecret required for authentication");return false}return true};IOTConnector.prototype.AuthenticationRequired=function(){return(this.AuthorizationEndpoint.length>0&&this.TokenEndpoint.length>0)};IOTConnector.prototype.LoadCollectionBE=function(h,D,d,E){var A=h.GetMD();var g="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g+="SELECT ";var y=0;for(var z=1;z<=A.GetNumProp();z++){var G=A.GetProp(z);if(G.IOTCode.length==0){continue}if(y>0){g+=","}y++;g+=G.IOTCode}g+=" FROM "+A.IOTCode}var u="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){u=" WHERE "}for(var z=1;z<=A.GetNumProp();z++){var G=A.GetProp(z);var m=h.GetPropByIndex(z);if(d){var x="";if("DO_ID".equals(G.Concept)){}else{x=this.GetQBEFilter(m.stringValue(),G)}if(x.length>0){g+=u+"("+x+")";u=" and "}}else{if(m.Type!=IDVariant.NULL){g+=u+"("+G.IOTCode+"="+this.ToSOQL(m,G)+")";u=" and "}}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g="/query?q="+Glb.URLEncode(g)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(A.ODataEntitySet.length>0){var o="/"+A.ODataEntitySet;if(this.ODataVersion==4){o+="?$count=true"}else{o+="?$inlinecount=allpages"}var a=this.GetODataExpand(h);if(a.length>0){o+="&"+a}if(A.BaseMD!=null){if(g.length>0){g+=" and "}g+="isof('"+A.ODataNamespace+"."+A.IOTCode+"')"}if(D.MaxRows>0){o+="&$top="+D.MaxRows}var n="";for(var z=1;z<=16;z++){var b=D.GetSortCriteria(z);if(b==0){break}if(n.length>0){n+=","}n+=A.GetProp(Math.abs(b)).IOTCode;if(b<0){n+=" desc"}}if(n.length>0){o+="&$orderby="+Glb.URLEncode(n)}if(g.length>0){g=o+"&$filter="+Glb.URLEncode(g)}else{g=o}}}}var f=new IDMap();f.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));f.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var c=new IDArray();c.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));f.set_Object(new IDVariant("ID_HEADERS"),c);if(!this.AddAuthorizationHeader(c)){return 0}var r=new IDVariant();var F=new IDVariant(g);this.BeforeLoadCollection(h,null,D,r,F,f);if(r.isTrue()){return D.Count()}var t=new IDVariant();var H=this.DoHttpRequest("LoadCollectionBE",F.stringValue(),f,t);if(t.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadCollectionBE",h.TypeName()+": error while loading collection: "+t);throw new Error(t.stringValue())}if(H!=null){try{var s=H.GetRootNode();var l=this.LoadCollectionFromJSON(h,D,s,E);if(l==-1){l=this.GetCollectionCount("LoadCollectionBE",F.stringValue(),c,f,t);if(t.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadCollectionBE",h.TypeName()+": error while get collection count: "+t);throw new Error(t.stringValue())}}var B=(D.MaxRows==0?l:Math.min(D.MaxRows,l));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&B>D.Count()){f.set_Object(new IDVariant("ID_HEADERS"),c);D.ODataLoadInfo=new IDMap();D.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(F));D.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("LoadCollectionBE"));D.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(D.Count()));D.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(E));D.ODataLoadInfo.set_Object(new IDVariant("args"),f);D.SetSize(B,h)}}catch(C){WriteToConsoleError(C);throw C}}return D.Count()};IOTConnector.prototype.LoadCollectionFromDB=function(h,D,q){var C=h.GetCollByIndex(q);var u=h.GetMD();var n=u.GetColl(q);var s=h.GetMD(n.ChildrenName);var m=h.CreateDocument(n.ChildrenName);var g="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g+="SELECT ";var z=0;for(var A=1;A<=s.GetNumProp();A++){var F=s.GetProp(A);if(F.IOTCode.length==0){continue}if(z>0){g+=", "}z++;g+=F.IOTCode}g+=" FROM "+s.IOTCode;var y=" WHERE ";for(var A=1;A<=n.PKColl.Count();A++){var d=u.GetPropIndex(n.PKColl[A-1]);var b=s.GetPropIndex(n.FKColl[A-1]);var F=s.GetProp(b);var o=h.GetPropByIndex(d);if(o.Type==IDVariant.NULL){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+u.IOTCode+" PK not defined")}g+=y+"("+F.IOTCode+"="+this.ToSOQL(o,F)+")";y=" and "}g="/query?q="+Glb.URLEncode(g)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){g="/"+this.GetResourcePath(h)+"/"+n.IOTCode;if(this.ODataVersion==4){g+="?$count=true"}else{g+="?$inlinecount=allpages"}var a=this.GetODataExpand(m);if(a.length>0){g+="&"+a}}}var f=new IDMap();f.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));f.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var e=new IDArray();e.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));f.set_Object(new IDVariant("ID_HEADERS"),e);if(!this.AddAuthorizationHeader(e)){return}var r=new IDVariant();var E=new IDVariant(g);this.BeforeLoadCollection(m,h,C,r,E,f);if(r.isTrue()){return}var x=new IDVariant();var G=this.DoHttpRequest("LoadCollectionFromDB",E.stringValue(),f,x);if(x.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadCollectionFromDB",h.TypeName()+": error while loading "+n.ChildrenName+": "+x.stringValue());throw new Error(x.stringValue())}if(C.Parent()!=null){C.Parent().StopEvents()}if(G!=null){var t=G.GetRootNode();var l=this.LoadCollectionFromJSON(m,C,t,D);if(l==-1){l=this.GetCollectionCount("LoadCollectionFromDB",E.stringValue(),e,f,x);if(x.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadCollectionFromDB",h.TypeName()+": error while get collection count: "+x);throw new Error(x.stringValue())}}var B=(C.MaxRows==0?l:Math.min(C.MaxRows,l));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&B>C.Count()){f.set_Object(new IDVariant("ID_HEADERS"),e);C.ODataLoadInfo=new IDMap();C.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(E));C.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("LoadCollectionFromDB"));C.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(C.Count()));C.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(D));C.ODataLoadInfo.set_Object(new IDVariant("args"),f);C.SetSize(B,h)}if(C.Parent()!=null){C.Parent().StartEvents()}}};IOTConnector.prototype.SaveDocToDB=function(h,m,n){if(n==undefined){n=-1}var x=h.GetMD();var d=new IDMap();d.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));d.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var c=new IDArray();c.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));d.set_Object(new IDVariant("ID_HEADERS"),c);if(!this.AddAuthorizationHeader(c)){return false}if(h.Deleted()){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("DELETE"))}else{if(m==1||m==2){d.set_Value(new IDVariant("ID_BODYTYPE"),new IDVariant(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml; charset:utf-8"));d.set_Value(new IDVariant("ID_BODY"),new IDVariant(h.SaveToXML(false,"",0,this.ServiceFormat)));if(h.Inserted()){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("POST"))}else{if(h.Updated()){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("PUT"))}}}else{if(m==4){d.set_Value(new IDVariant("ID_BODYTYPE"),new IDVariant("application/json"));var a=false;var o;if(n>0){var k=x.GetProp(n).LinkedDoc;var b=h.CreateDocument(k.GetDocumentClass());for(var u=0;u<k.GetNumProp();u++){b.SetPropByIndex(k.GetSrcProp(u),h.GetPropByIndex(k.GetDstProp(u)));if(h.GetPropByIndex(k.GetDstProp(u)).Type==IDVariant.NULL){a=true}}o=this.GetResourcePath(b)}else{o=this.GetResourcePath(h);a=h.IsDeleted}if(a){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("DELETE"))}else{if(n>0){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("PUT"))}else{d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("POST"))}var E=new XMLDoc();var r=E.AddNewElement(XMLDoc.ROOT_JSON);if(this.ODataVersion<=2){r.SetAttribute("uri",o)}else{if(this.ODataVersion==3){r.SetAttribute("url",o)}else{if(this.ODataVersion==4){r.SetAttribute("@odata.id",o)}}}d.set_Value(new IDVariant("ID_BODY"),new IDVariant(E.SaveToString(XMLDoc.FT_JSON)))}}}}if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&(m==2||m==3)&&x.ODataWithEtag){c.add_Value(new IDVariant("If-Match: *"))}var g="/";if(m==4){if(n>0){g+=this.GetResourcePath(h);var k=x.GetProp(n).LinkedDoc;if(this.ODataVersion<4){g+="/$links/"+k.GetName()}else{g+="/"+k.GetName()+"/$ref"}}else{g+=this.GetResourcePath(h.Parent());if(this.ODataVersion<4){if(h.Deleted()){g+="/$links/"+this.GetResourcePath(h)}else{g+="/$links/"+h.Parent().GetMD().GetColl(h.ParentCollection().Index).IOTCode}}else{if(h.Deleted()){g+="/"+this.GetResourcePath(h)+"/$ref"}else{g+="/"+h.Parent().GetMD().GetColl(h.ParentCollection().Index).IOTCode+"/$ref"}}}}else{g+=this.GetResourcePath(h,!h.Inserted())}if(!h.Inserted()&&h.Updated()){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("POST"));g+="?_HttpMethod=PATCH"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("POST"));if(this.ODataVersion<=2){c.add_Value(new IDVariant("X-HTTP-Method: MERGE"))}else{c.add_Value(new IDVariant("X-HTTP-Method: PATCH"))}}}}var q=new IDVariant();var f=new IDVariant();var C=new IDVariant(g);if(!((h.Updated()||h.Inserted()||h.Deleted())&&!(h.Deleted()&&h.Inserted()))){q=new IDVariant(-1)}if(!((m==1&&h.Inserted()&&!h.Deleted())||(m==2&&!h.Deleted()&&!h.Inserted())||(m==3&&h.Deleted()&&!h.Inserted()))){q=new IDVariant(-1)}var A=(h.ParentCollection()!=null&&h.Parent()!=null&&h.Parent().GetMD().GetColl(h.ParentCollection().Index).IOTMultiplicityNM);if(m==1&&A){q=new IDVariant(-1)}if(m==4){q=new IDVariant(0)}try{this.BeforeSave(h,q,f,new IDVariant(m),C,d,new IDVariant(n))}catch(y){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.SaveDocToDB",h.GetName(1)+": exception in Before Save event: "+y);h.AddDocError(y.toString());return false}if(f.isTrue()){return false}if(q.isTrue()){return true}q=new IDVariant(0);if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(m==2){q=new IDVariant(-1);if(!A){for(var u=1;u<=x.GetNumProp();u++){var B=x.GetProp(u);if(!B.ODataType.equals("link")&&!h.GetPropOrigValue(u).equals(h.GetPropByIndex(u))){q=new IDVariant(0);break}}}}else{if(m==3){q=new IDVariant(A)}}}if(q.isFalse()){var s=new IDVariant();var D=this.DoHttpRequest("SaveDocToDB",C.stringValue(),d,s);if(s.stringValue().length>0){h.AddDocError(s.stringValue());return false}if(D!=null){var r=D.GetRootNode();if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){h.SetPropByIndex(h.GetPropertyIndex("Id",false,false,false,false,true),new IDVariant(r.GetAttribute("id")))}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){for(var u=1;u<=x.GetNumProp();u++){var B=x.GetProp(u);var l=this.StringToVariant(r.GetAttribute(B.IOTCode),B);if(l.Type!=IDVariant.NULL){h.SetPropByIndex(u,l)}}}}h.ReconnectChildren(9999)}}if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(A&&(m==2||m==3)){if(!this.SaveDocToDB(h,4,0)){return false}}else{if(!A&&(m==1||m==2)){for(var u=1;u<=x.GetNumProp();u++){var B=x.GetProp(u);if(B.ODataType.equals("link")&&B.LinkedDoc!=null&&!h.GetPropOrigValue(u).equals(h.GetPropByIndex(u))){var z=false;for(var t=0;t<B.LinkedDoc.GetNumProp();t++){if(B.LinkedDoc.GetDstProp(t)<u){z=true;break}}if(!z&&!this.SaveDocToDB(h,4,u)){return false}}}}}}return true};IOTConnector.prototype.LoadValueSource=function(g,d,l){var C=g.GetMD();d.PrepareForValueSource();var f="";var n="";var m=new ArrayList();if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f+="SELECT "}var z="";for(var B=1;B<=C.GetNumProp();B++){var I=C.GetProp(B);if(I.PK){f+=z;f+=I.IOTCode;z=",";m.Add(B)}}for(var B=1;B<=C.GetNumProp();B++){var I=C.GetProp(B);var r=false;if(l!=null){for(var A=0;A<l.Count();A++){var u=l[A];if(String.compare(I.ObjTag,u,true)==0){r=true;break}}}else{r=I.DescribeRow}if(r){f+=",";f+=I.IOTCode;m.Add(B);if(I.DescribeRow&&l==null){break}}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f+=" FROM "+C.IOTCode;z=" WHERE "}else{z=""}for(var B=1;B<=C.GetNumProp();B++){var I=C.GetProp(B);var o=g.GetPropByIndex(B);if(o.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f+=z+I.IOTCode+" = "+this.ToSOQL(o,I)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){n+=z+I.IOTCode+" eq "+this.ToSOQL(o,I)}}z=" and "}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f="/query?q="+Glb.URLEncode(f)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var s="/"+C.ODataEntitySet;if(this.ODataVersion==4){s+="?$count=true"}else{s+="?$inlinecount=allpages"}var a=this.GetODataExpand(g);if(a.length>0){s+="&"+a}s+="&$select="+Glb.URLEncode(f);if(C.BaseMD!=null){if(n.length>0){n+=" and "}n+="isof('"+C.ODataNamespace+"."+C.IOTCode+"')"}if(n.length>0){f=s+"&$filter="+Glb.URLEncode(n)}else{f=s}}}var c=new IDMap();c.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));c.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var b=new IDArray();b.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));c.set_Object(new IDVariant("ID_HEADERS"),b);if(!this.AddAuthorizationHeader(b)){return}var t=new IDVariant();var H=new IDVariant(f);this.OnGetValueSource(g,d,t,H,c);if(t.isTrue()){if(!d.EOF()){d.MoveFirst()}return}var y=new IDVariant();var K=this.DoHttpRequest("LoadValueSource",H.stringValue(),c,y);if(y.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadValueSource",g.TypeName()+": error while loading value source: "+y.stringValue());return}if(K!=null){try{var x=K.GetRootNode();var F=new IDCollection();var h=this.LoadCollectionFromJSON(g,F,x,0);if(h==-1){h=this.GetCollectionCount("LoadValueSource",H.stringValue(),b,c,y);if(y.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadValueSource",g.TypeName()+": error while get collection count: "+y);return}}var D=(F.MaxRows==0?h:Math.min(F.MaxRows,h));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&D>F.Count()){c.set_Object(new IDVariant("ID_HEADERS"),b);F.ODataLoadInfo=new IDMap();F.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(H));F.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("LoadValueSource"));F.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(F.Count()));F.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(0));F.ODataLoadInfo.set_Object(new IDVariant("args"),c);F.SetSize(D,g)}var J=new IDCachedRowSet();var G=new IDCachedRowSetMetaData();G.setColumnCount(m.Count());for(var B=0;B<m.Count();B++){var I=C.GetProp(m[B]);G.setColumnName(B+1,I.ObjTag);G.setColumnType(B+1,IDCachedRowSetMetaData.GetCSharpType(I.DataType))}J.setMetaData(G);this.LoadRSFromCollection(J,F);if(!J.EOF()){J.MoveFirst()}d.CopyFrom(J)}catch(E){WriteToConsoleError(E)}}};IOTConnector.prototype.GetLKE=function(k,d,l,j,a){var x=k.GetMD();var r=new IDVariant();var z=-1;var n=null;do{z++;if(d.IsOpen()){d.Close()}var t=(d.pQuery==null||d.pQuery.Parent.MainFrm.ParamsObj().LKEDOAllProperties?null:d.pQuery.HeaderColumns);var h=this.GetLKEQbe(k,z,l,j,d.pQuery);var c=new IDMap();c.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));c.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var b=new IDArray();b.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));c.set_Object(new IDVariant("ID_HEADERS"),b);if(!this.AddAuthorizationHeader(b)){break}var f=new IDVariant();var F=new IDVariant(h);this.OnGetLKE(k,d,new IDVariant(z),l,r,f,a,F,c);if(d.pQuery!=null){if(this.MainFrm instanceof WebEntryPointSrv){d.pQuery.LkeRSLimitedBySystem=this.MainFrm.ParamsObj().PanelLimitOnGetSmartLookup}else{d.pQuery.LkeRSLimitedBySystem=false}}if(f.isTrue()||d.RecordCount()>0){break}if(r.isTrue()){break}if(l.isFalse()&&!h.equals(n)&&h.length>0){n=h;var u=new IDVariant();var I=this.DoHttpRequest("GetLKE",F.stringValue(),c,u);if(u.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.GetLKE",k.TypeName()+": error while loading LKE data: "+u.stringValue());break}if(I!=null){try{var s=I.GetRootNode();if(d.IsOpen()){d.Close()}if(d.pQuery!=null){d.pQuery.LkeRSLimitedBySystem=true}var B=new IDCollection();var m=this.LoadCollectionFromJSON(k,B,s,0);if(m==-1){m=this.GetCollectionCount("GetLKE",F.stringValue(),b,c,u);if(u.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.GetLKE",k.TypeName()+": error while get collection count: "+u)}}var y=(B.MaxRows==0?m:Math.min(B.MaxRows,m));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&y>B.Count()){c.set_Object(new IDVariant("ID_HEADERS"),b);B.ODataLoadInfo=new IDMap();B.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(F));B.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("GetLKE"));B.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(B.Count()));B.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(0));B.ODataLoadInfo.set_Object(new IDVariant("args"),c);B.SetSize(y,k)}var H=new IDCachedRowSet();var o=new ArrayList();for(var v=1;v<=x.GetNumProp();v++){var E=x.GetProp(v);if(E.IOTCode.length>0&&E.DataType!=Glb.DT_DOC_OLE){var D=false;if(t!=null&&!E.PK&&!"DO_CODE".equals(E.Concept)){D=true;var q=t.keys();for(var g=0;g<q.length;g++){var G=q[g];if(String.compare(G,E.ObjTag,true)==0){D=false;break}}}if(D){continue}o.Add(v)}}var C=new IDCachedRowSetMetaData();C.setColumnCount(o.Count());for(var v=0;v<o.Count();v++){var E=x.GetProp(o[v]);C.setColumnName(v+1,E.ObjTag);C.setColumnType(v+1,IDCachedRowSetMetaData.GetCSharpType(E.DataType))}H.setMetaData(C);this.LoadRSFromCollection(H,B);d.CopyFrom(H)}catch(A){WriteToConsoleError(A)}}if(d.RecordCount()>0){break}}if(z>100){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",169,"IOTConnector.GetLKE",k.GetName(1)+": Too many Smart Lookup tries. Did you forget to set Cancel to TRUE?");break}}while((z<5||r.isTrue())&&l.isFalse());return z};IOTConnector.prototype.GetLKEQbe=function(h,F,l,f,c){var z=(c==null||c.Parent.MainFrm.ParamsObj().LKEDOAllProperties?null:c.HeaderColumns);var G=(c==null?null:c.VisibleColumns);var E=h.GetMD();var e="";var C=0;if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){e+="SELECT "}for(var D=1;D<=E.GetNumProp();D++){var I=E.GetProp(D);if(I.IOTCode.length>0&&I.DataType!=Glb.DT_DOC_OLE){var H=false;if(z!=null&&!I.PK&&!"DO_CODE".equals(I.Concept)){H=true;var u=z.keys();for(var d=0;d<u.length;d++){var J=u[d];if(String.compare(J,I.ObjTag,true)==0){H=false;break}}}if(H){continue}if(C>0){e+=","}C++;e+=I.IOTCode}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){e+=" FROM "+E.IOTCode+" WHERE "}l.set(IDVariant.TRUE);var B="";if(f!=null){for(var t=0;t<f.Count();t++){var y=f[t];var I=E.GetProp(y);var r=h.GetPropByIndex(y).stringValue();if(r.length>0){var n=this.ToSOQL(new IDVariant(r),I);if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){n=I.IOTCode+" = "+n}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){n=I.IOTCode+" eq "+n}}if(B.length>0){B+=" and "}B+=n}}if(B.length>0){e+="("+B+") and ";B=""}}for(var D=1;D<=E.GetNumProp();D++){var r=h.GetPropByIndex(D).stringValue();var I=E.GetProp(D);var H=false;if(z!=null){H=true;var u=z.keys();for(var d=0;d<u.length;d++){var J=u[d];if(String.compare(J,I.ObjTag,true)==0){H=false;break}}}if(H){continue}for(var t=0;t<f.Count();t++){var y=f[t];if(y==D){r="";break}}if(I.IOTCode.length==0&&r.length>0){r="";l.set(IDVariant.FALSE)}if(r.length>0){var g=false;l.set(IDVariant.FALSE);r=r.replace(/\%/g,"*");if(r[0]!="*"&&r[r.length-1]!="*"){if(F==0){g=true}else{if(F==1){r+="*"}else{r="*"+r+"*"}}}var n="";if(g){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){n=I.IOTCode+" = "+this.ToSOQL(new IDVariant(r),I)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){n=I.IOTCode+" eq "+this.ToSOQL(new IDVariant(r),I)}}}else{r=r.replace(/\*/g,"%");if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){n=I.IOTCode+" like "+this.ToSOQL(new IDVariant(r),I)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var m=r.indexOf("%");var o=r.lastIndexOf("%");if(m==o&&r.length==1){n=I.IOTCode+" ne null"}else{if(m==o&&m==0){n="endswith(tolower("+I.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(r.substr(1)),I)+"))"}else{if(m==o&&m==r.length-1){n="startswith(tolower("+I.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(r.substr(0,r.length-1)),I)+"))"}else{if(m==0&&o==r.length-1){n="indexof(tolower("+I.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(r.substr(1,r.length-2)),I)+")) gt -1"}else{n="tolower("+I.IOTCode+") eq tolower("+this.ToSOQL(new IDVariant(r),I)+")"}}}}}}}if(B.length>0){if(F>2){B+=" or "}else{B+=" and "}}B+=n}}if(F>3){for(C=1;C<=E.GetNumProp();C++){var I=E.GetProp(C);var s=false;if(G!=null){for(var A=0;A<G.Count();A++){if(String.compare(G[A],I.ObjTag,true)==0){s=true;break}}}if(!s&&c!=null&&c.VisibilityColumnsMode==Glb.QRY_VISDEF){s=true;for(var t=0;t<f.Count();t++){if(f[t]==C){s=false;break}}if(s){if(z!=null){s=false;var u=z.keys();for(var d=0;d<u.length;d++){var J=u[d];if(String.compare(J,I.ObjTag,true)==0){s=true;break}}}else{s=(Glb.ClassDT(I.DataType)==Glb.DTC_CHAR&&I.MaxLength>4&&!I.PK&&!I.FK)}}}if(s&&h.GetPropByIndex(C).stringValue().length>0){s=false}if(s&&I.IOTCode.length==0){s=false}if(s){for(var D=1;D<=E.GetNumProp();D++){var r=h.GetPropByIndex(D).stringValue();for(var t=0;t<f.Count();t++){if(f[t]==D){r="";break}}if(r.length>0){l.set(IDVariant.FALSE);r=r.replace(/\%/g,"*");if(r[0]!="*"&&r[r.length-1]!="*"){r="*"+r+"*"}var n="";r=r.replace(/\*/g,"%");if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){n=I.IOTCode+" like "+this.ToSOQL(new IDVariant(r),I)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(!r.equals("%")){var m=r.indexOf("%");var o=r.lastIndexOf("%");if(m==o&&r.length==1){n=I.IOTCode+" ne null"}else{if(m==o&&m==0){n="endswith(tolower("+I.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(r.substr(1)),I)+"))"}else{if(m==o&&m==r.length-1){n="startswith(tolower("+I.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(r.substr(0,r.length-1)),I)+"))"}else{if(m==0&&o==r.length-1){n="indexof(tolower("+I.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(r.substr(1,r.length-2)),I)+")) gt -1"}else{n="tolower("+I.IOTCode+") eq tolower("+this.ToSOQL(new IDVariant(r),I)+")"}}}}}}}if(B.length>0){if(F>2){B+=" or "}else{B+=" and "}}B+=n}}}}}if(B.length==0){return""}var b=30;if(this.MainFrm instanceof WebEntryPointSrv){b=this.MainFrm.ParamsObj().MaxLookupRows}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){e+="("+B+") LIMIT "+(b+1);e="/query?q="+Glb.URLEncode(e)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(E.ODataEntitySet.length>0){var x="/"+E.ODataEntitySet;if(this.ODataVersion==4){x+="?$count=true"}else{x+="?$inlinecount=allpages"}var a=this.GetODataExpand(h);if(a.length>0){x+="&"+a}e=x+"&$select="+Glb.URLEncode(e);if(E.BaseMD!=null){if(B.length>0){B+=" and "}B+="isof('"+E.ODataNamespace+"."+E.IOTCode+"')"}if(B.length>0){e+="&$filter="+Glb.URLEncode(B)}e+="&$top="+(b+1)}}}return e};IOTConnector.prototype.LoadFromDB=function(h,C){var A=h.GetMD();if(!h.Loaded()){var n=true;var f=false;for(var z=1;z<=A.GetNumProp();z++){var E=A.GetProp(z);if(E.PK){var m=h.GetPropByIndex(z);if(m.Type==IDVariant.NULL){n=false;break}}}var g="";if(n){g+="/"+this.GetResourcePath(h);if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var a=this.GetODataExpand(h);if(a.length>0){g+="?"+a}}}else{var x="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g+="SELECT ";var y=0;for(var z=1;z<=A.GetNumProp();z++){var E=A.GetProp(z);if(E.IOTCode.length==0){continue}if(y>0){g+=", "}y++;g+=E.IOTCode}g+=" FROM "+A.IOTCode;x=" WHERE "}for(var z=1;z<=A.GetNumProp();z++){var E=A.GetProp(z);if(E.IOTCode.length==0){continue}var m=h.GetPropByIndex(z);if(m.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g+=x+"("+E.IOTCode+"="+this.ToSOQL(m,E)+")"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){g+=x+"("+E.IOTCode+" eq "+this.ToSOQL(m,E)+")"}}x=" and ";f=true}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g="/query?q="+Glb.URLEncode(g)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var r="/"+A.ODataEntitySet;if(this.ODataVersion==4){r+="?$count=true"}else{r+="?$inlinecount=allpages"}var a=this.GetODataExpand(h);if(a.length>0){r+="&"+a}if(A.BaseMD!=null){g+=" and isof('"+A.ODataNamespace+"."+A.IOTCode+"')"}g=r+"&$filter="+Glb.URLEncode(g)}}}if(!n&&!f){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+A.IOTCode+" No fields filled in")}var c=new IDMap();c.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));c.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var b=new IDArray();b.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));c.set_Object(new IDVariant("ID_HEADERS"),b);if(!this.AddAuthorizationHeader(b)){return}var s=new IDVariant();var D=new IDVariant(g);this.BeforeLoad(h,s,D,c);if(s.isTrue()){return}var u=new IDVariant();var F=this.DoHttpRequest("LoadFromDB",D.stringValue(),c,u);if(u.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadFromDB",h.TypeName()+": error while loading document: "+u.stringValue());throw new Error(u.stringValue())}var l=0;var t=F.GetRootNode();if(F!=null){if(n){l=1}else{l=this.GetCountFromResult(t)}}if(l==0){throw new Error("ERR "+MDOInit.DOERR_OBJNOTFOUND+": "+A.IOTCode+" Object not found")}if(l>1){throw new Error("ERR "+MDOInit.DOERR_OBJMULDEF+": "+A.IOTCode+" Can not identify the object")}h.StopEvents();try{var d=null;if(n){d=t}else{d=t.GetNextNode()}d.SetAttribute(XMLDoc.JSON_IGNORENAME,"1");MDOInit.LoadXMLNode(h,d.GetNode(),true)}catch(B){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadFromDB",h.GetName(1)+": error while loading document: "+B);throw B}h.SetOriginal()}var o=h.LoadChildrenFromDB(C);if(!h.Loaded()){h.set_Loaded(true);h.MarkAsChanged();h.StartEvents()}else{if(o){h.MarkAsChanged()}}};IOTConnector.prototype.LoadRSFromCollection=function(c,a){a.MoveFirst();while(!a.IsEof()){var f=a.GetAt();var b=new ArrayList();for(var e=1;e<=c.GetNumFields();e++){b.Add(f.GetPropDirect(f.GetPropIndex(c.GetName(e))))}c.AddRow(b);a.MoveNext()}};IOTConnector.prototype.ToSOQL=function(a,b){if(IDL.IsNull(a)){return"null"}switch(b.DataType){case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:case Glb.DT_DOC_TEXT:return IDL.Quote(a);case Glb.DT_NUM_INTEGER:case Glb.DT_NUM_FLOAT:case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:if(a.Type==IDVariant.DECIMAL||a.Type==IDVariant.FLOAT||a.Type==IDVariant.INTEGER){return a.stringValue()}else{return new IDVariant(a.dblValue()).stringValue()}case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&this.ODataVersion<=3){return"datetime'"+IOTConnector.FormatDate(a.dateValue(),b.DataType).Replace("Z","")+"'"}else{return IOTConnector.FormatDate(a.dateValue(),b.DataType)}case Glb.DT_BOOLEAN:if(a.booleanValue()){return"true"}else{return"false"}}return""};IOTConnector.FixTime=function(a){if(a<10){a="0"+a}return a};IOTConnector.FormatDate=function(b,d){var f=IOTConnector.FixTime(b.getMonth()+1);var a=IOTConnector.FixTime(b.getDate());var c=b.toUTCString();var e=c.substring(c.indexOf(":")-2,c.indexOf(":")+6)+"Z";switch(d){case Glb.DT_DATE:return b.getFullYear()+"-"+f+"-"+a;case Glb.DT_TIME:return e;case Glb.DT_DATETIME:return b.getFullYear()+"-"+f+"-"+a+"T"+e}};IOTConnector.prototype.GetQBEFilter=function(x,D){var o="";var r;var e=-1,c=-1;var h=true;if(x.length>0&&x.charAt(0)=="§"){x=x.substr(1);h=false}if(x.length==0){return""}var z=this.MainFrm.ParamsObj().QBETrueLessThan;var B=this.MainFrm.ParamsObj().PanelsLikeMode;do{if(x.charAt(0)!="="){e=x.indexOf(";",e+1)}if(e>=0){r=x.substr(c+1,(e)-(c+1))}else{r=x.substr(c+1)}var k="";var n=new Array();n[0]="";n[1]="";if(r.length>0){if(r.length>1&&r.charAt(0)==">"){if(z){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" > ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" gt ?"}}}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ?"}}}n[0]=r.substr(1);if(D.DataType==Glb.DT_DATETIME||D.DataType==Glb.DT_DATE){var A=IDL.ParsePartialDate(this.MainFrm,n[0],(z?1:0));if(A.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ?"}}n[0]=A.stringValue()}}}if(r.length>1&&r.charAt(0)=="<"){if(z){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" lt ?"}}}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" le ?"}}}n[0]=r.substr(1);if(D.DataType==Glb.DT_DATETIME||D.DataType==Glb.DT_DATE){var A=IDL.ParsePartialDate(this.MainFrm,n[0],(z?0:1));if(A.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" lt ?"}}n[0]=A.stringValue()}}}if(r.length==1&&r.charAt(0)=="."){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" != null"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ne null"}}}if(r.length==1&&r.charAt(0)=="!"){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" = null"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" eq null"}}}if(r.length>1&&r.charAt(0)=="#"){r=r.substr(1);if(h&&Glb.ClassDT(D.DataType)==Glb.DTC_CHAR){r=r.replace(/\%/g,"*");if(r.indexOf("*")==-1){r=(B==Glb.PAN_LIKECONTAINS?"*":"")+r+"*"}r=r.replace(/\*/g,"%");if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k+=" not "+D.IOTCode+" like ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var l=r.indexOf("%");var m=r.lastIndexOf("%");if(l==m&&l==0){k+="not endswith(tolower("+D.IOTCode+"), tolower(?))";r=r.substr(1)}else{if(l==m&&l==r.length-1){k+="not startswith(tolower("+D.IOTCode+"), tolower(?))";r=r.substr(0,r.length-1)}else{if(l==0&&m==r.length-1){k+="indexof(tolower("+D.IOTCode+"), tolower(?)) eq -1";r=r.substr(1,r.length-2)}else{k="tolower("+D.IOTCode+") ne tolower(?)"}}}}}n[0]=r}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" != ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ne ?"}}n[0]=r;if(D.DataType==Glb.DT_DATETIME||D.DataType==Glb.DT_DATE){var u=IDL.ParsePartialDate(this.MainFrm,n[0],0);var t=IDL.ParsePartialDate(this.MainFrm,n[0],1);if(u.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" < ? or "+D.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" lt ? or "+D.IOTCode+" ge ?"}}n[0]=this.ToSOQL(u,D);n[1]=this.ToSOQL(t,D)}}}}if(r.length>1&&r.charAt(0)=="="){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" = ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" eq ?"}}n[0]=r.substr(1)}else{if(k.length==0){var q=r.indexOf(":");if(q>=0){var C=false;if(Glb.ClassDT(D.DataType)==Glb.DTC_DATE){C=true;var u=IDL.ParsePartialDate(this.MainFrm,r.substr(0,q),0);var t=IDL.ParsePartialDate(this.MainFrm,r.substr(q+1),1);var j=(u.Type!=IDVariant.NULL||t.Type!=IDVariant.NULL);if(r.indexOf("/")!=-1||r.indexOf("-")!=-1||j){var a;for(a=q+1;a<r.length;a++){if(r.charAt(a)==":"){q=a}else{if(r.charAt(a)=="/"||r.charAt(a)=="-"){break}}}if(a<=r.length){var g=r.substr(0,q);var f=r.substr(q+1);if(g.length>0&&f.length>0){if(u.Type==IDVariant.NULL&&t.Type==IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ? and "+D.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ? and "+D.IOTCode+" lt ?"}}n[0]=g;n[1]=f}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ?"}}if(u.Type==IDVariant.NULL){n[0]=g}else{n[0]=u.stringValue()}if(t.Type==IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k+=" and "+D.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k+=" and "+D.IOTCode+" le ?"}}n[1]=f}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k+=" and "+D.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k+=" and "+D.IOTCode+" lt ?"}}n[1]=t.stringValue()}}}else{if(g.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ?"}}if(u.Type==IDVariant.NULL){n[0]=g}else{n[0]=u.stringValue()}}else{if(f.length>0){if(t.Type==IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" le ?"}}n[0]=f}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" lt ?"}}n[0]=t.stringValue()}}}}}}else{var s=new ArrayList();for(var a=0;a<r.length;a++){if(r.charAt(a)==":"){s.Add(a)}}if(s.Count()>2&&(s.Count()%2)==1){q=Math.floor(s[(s.Count()-1)/2]);var g=r.substr(0,q);var f=r.substr(q+1);if(g.length>0&&f.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ? and "+D.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ? and "+D.IOTCode+" lt ?"}}n[0]=g;n[1]=f}else{if(g.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ?"}}n[0]=g}else{if(f.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" le ?"}}n[0]=f}}}}}}if(!C){var g=r.substr(0,q);var f=r.substr(q+1);if(g.length>0&&f.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ? and "+D.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ? and "+D.IOTCode+" lt ?"}}n[0]=g;n[1]=f}else{if(g.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ?"}}n[0]=g}else{if(f.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" le ?"}}n[0]=f}}}}}}if(k.length==0){var y=r.indexOf(" ")>=0&&(r.indexOf(":")>=0||r.indexOf(".")>=0);var u=IDL.ParsePartialDate(this.MainFrm,r,0);var t=IDL.ParsePartialDate(this.MainFrm,r,1);if((D.DataType==Glb.DT_DATETIME||D.DataType==Glb.DT_DATE)&&u.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ? and "+D.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ? and "+D.IOTCode+" lt ?"}}n[0]=u.stringValue();n[1]=t.stringValue()}else{if(D.DataType==Glb.DT_DATETIME&&!y){u=new IDVariant(r,IDVariant.DATETIME);if(u.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" >= ? and "+D.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" ge ? and "+D.IOTCode+" lt ?"}}n[0]=r;n[1]=r+" 23:59:59"}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" = ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" eq ?"}}n[0]=r}}else{if(h&&Glb.ClassDT(D.DataType)==Glb.DTC_CHAR){r=r.replace(/\%/g,"*");if(r.indexOf("*")==-1){r=(B==Glb.PAN_LIKECONTAINS?"*":"")+r+"*"}r=r.replace(/\*/g,"%");if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" like ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var l=r.indexOf("%");var m=r.lastIndexOf("%");if(l==m&&l==0){k+="endswith(tolower("+D.IOTCode+"), tolower(?))";r=r.substr(1)}else{if(l==m&&l==r.length-1){k+="startswith(tolower("+D.IOTCode+"), tolower(?))";r=r.substr(0,r.length-1)}else{if(l==0&&m==r.length-1){k+="indexof(tolower("+D.IOTCode+"), tolower(?)) gt -1";r=r.substr(1,r.length-2)}else{k="tolower("+D.IOTCode+") eq tolower(?)"}}}}}n[0]=r}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=D.IOTCode+" = ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=D.IOTCode+" eq ?"}}n[0]=r}}}}}var v=0;for(var b=0;b<n.length;b++){v=k.indexOf("?",0);if(v>=0){n[b]=this.ToSOQL(new IDVariant(n[b]),D);k=k.substr(0,v)+n[b]+k.substr(v+1)}else{break}}if(k.length>0){if(o.length>0){o+=" or "}o+="("+k+")"}}c=e}while(e>=0);return o};IOTConnector.prototype.StringToVariant=function(a,d){if(a.length==0){return new IDVariant()}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&d.Domain!=null&&d.DataType!=Glb.DT_BOOLEAN){var c=new StringTokenizer();c.setString(new IDVariant(d.Domain));while(c.hasNext()){var b=c.next();var e=c.next();if(a==b.stringValue()){return e}}}else{if(d.DataType==Glb.DT_DOC_OLE){if(!a.startsWith("data:")){a="data:application/octet-stream;base64,"+a}return new IDVariant(Glb.LoadBlob(this.MainFrm,a))}else{if(Glb.ClassDT(d.DataType)==Glb.DTC_DATE){if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(this.ODataVersion<=2&&a.startsWith("/Date(")){return new IDVariant(XMLDoc.DeserializeJsonDate(a))}else{if(this.ODataVersion==3&&(d.DataType==Glb.DT_DATETIME||d.DataType==Glb.DT_TIME)&&!a.endsWith("Z")){a+="Z"}}}return new IDVariant(new Date(a))}}}}return new IDVariant(a)};IOTConnector.prototype.VariantToString=function(c,f){if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&f.Domain!=null&&f.DataType!=Glb.DT_BOOLEAN){var e=new StringTokenizer();e.setString(new IDVariant(f.Domain));while(e.hasNext()){var d=e.next().stringValue();var g=e.next().stringValue();if(c.stringValue()==g){return d}}}switch(c.Type){case IDVariant.NULL:if(this.ServiceFormat==XMLDoc.FT_JSON){return XMLDoc.NULL_VALUE}break;case IDVariant.DATETIME:return IOTConnector.FormatDate(c.dateValue(),f.DataType);case IDVariant.INTEGER:if(f.DataType==Glb.DT_BOOLEAN&&this.ServiceFormat==XMLDoc.FT_JSON){return(c.intValue()==0?XMLDoc.FALSE_VALUE:XMLDoc.TRUE_VALUE)}break;case IDVariant.DECIMAL:if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&this.ODataVersion<=2){return"0"+c.stringValue()}break;case IDVariant.BLOB:var a=Glb.SaveBlob(this.MainFrm,c,new IDVariant(),new IDVariant(),true).stringValue();return a.substr(a.indexOf(",")+1)}return c.stringValue()};IOTConnector.GetHeader=function(c,a){for(var b=0;b<c.Size();b++){var d=c.get_Value(new IDVariant(b)).stringValue();if(d.toLowerCase().startsWith(a.toLowerCase()+":")){return d.substr(a.length+1).trim()}}return""};IOTConnector.prototype.DoHttpRequest=function(d,b,o,h){var k=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServiceEndpoint+b),o);var m="";if(o.get_Object(new IDVariant("ID_HEADERS")) instanceof IDArray){m=IOTConnector.GetHeader(o.get_Object(new IDVariant("ID_HEADERS")),"content-type")}var f=o.get_Value(new IDVariant("ID_RESPONSECODE")).intValue();if(this.MainFrm.getDTTObj().MsgLevel>=DTTEngine.DTTMSG_VERB){var a="";if(o.get_Object(new IDVariant("ID_HEADERS")) instanceof IDArray){a=IOTConnector.GetHeader(o.get_Object(new IDVariant("ID_HEADERS")),"content-length")}this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_VERB,"",100,"IOTConnector."+d,"Service "+this.ServiceEndpoint+" http request: "+b);this.MainFrm.getDTTObj().AddParameter("","","Method",o.get_Value(new IDVariant("ID_TYPE")));this.MainFrm.getDTTObj().AddParameter("","","Response content-type",m);this.MainFrm.getDTTObj().AddParameter("","","Response content-length",a);this.MainFrm.getDTTObj().AddParameter("","","Response content",(k.stringValue().length>1000?k.stringValue().substr(0,1000)+" ...":k.stringValue()))}var g=null;if(m.toLowerCase().startsWith("application/json")){try{g=new XMLDoc();if(!g.LoadFromString(k.stringValue(),XMLDoc.FT_JSON)){throw new h("Unknown error")}}catch(j){g=null;WriteToConsoleError(j);h.set(new IDVariant("Error while parsing JSON response: "+j.toString()))}}else{o.set_Value(new IDVariant("ID_RESPONSE"),k)}if(f<200||f>=400){if(g!=null){var l=g.GetRootNode();switch(this.ServiceType){case IOTConnector.SERTYPE_SALESFORCE:h.set(new IDVariant(l.GetAttribute("message")));break;case IOTConnector.SERTYPE_ODATA:if(l.GetAttribute("message").length>0){h.set(new IDVariant(l.GetAttribute("message")))}else{while(l.HasNextNode()){var c=l.GetNextNode();if(c.Name().equals("message")){h.set(new IDVariant(c.GetAttribute("value")))}break}}break}}else{if(m.toLowerCase().startsWith("text/plain")){h.set(new IDVariant(k.stringValue()))}else{h.set(new IDVariant("Unknown error"))}}}return g};IOTConnector.prototype.GetODataExpand=function(c){var d="";var e=c.GetMD();for(var b=1;b<=e.GetNumProp();b++){var a=e.GetProp(b);if(a.ODataType.equals("link")&&a.LinkedDoc!=null){d+=(d.length>0?",":"")+a.LinkedDoc.GetName()}}if(d.length>0){return"$expand="+d}else{return""}};IOTConnector.prototype.LoadCollectionFromJSON=function(l,d,c,j,g){if(g==undefined){g=-1}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE&&!c.GetAttribute("done").equals("-1")){return -1}var h=0;while(c.HasNextNode()){h++;if(d.MaxRows>0&&h>d.MaxRows){d.HasMoreElements=true;break}var e=c.GetNextNode();if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE&&!e.Name().equals("records")){continue}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(this.ODataVersion<=2&&!e.Name().equals("results")){continue}if(this.ODataVersion>2&&!e.Name().equals("value")){continue}}}var m=null;if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var a="";if(this.ODataVersion<=2){while(e.HasNextNode()){var b=e.GetNextNode();if(b.Name().equals("__metadata")){a=b.GetAttribute("type");break}}e.Reset()}if(this.ODataVersion==3&&e.GetAttribute("odata.type").length>0){a=e.GetAttribute("odata.type")}if(this.ODataVersion==4&&e.GetAttribute("@odata.type").length>0){a=e.GetAttribute("@odata.type")}if(a.indexOf(".")>0){a=a.substr(a.lastIndexOf(".")+1)}if(a.length>0){m=IOTConnector.CreateIOTDocument(l.GetServiceConnector(),l.GetMainFrm(),a)}}if(m==null){m=l.CreateDocument(l.TypeName())}if(g>0){d.SetDirect(g+h,m)}else{d.Add(m)}e.SetAttribute(XMLDoc.JSON_IGNORENAME,"1");MDOInit.LoadXMLNode(m,e.GetNode(),true);m.SetOriginal();m.LoadChildrenFromDB(j-1);m.set_Loaded(true);m.MarkAsChanged();m.StartEvents()}d.set_Loaded(true);if(g==-1){var f=this.GetCountFromResult(c);var k="";if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(this.ODataVersion<=2&&c.GetAttribute("__next").length>0){k=c.GetAttribute("__next")}else{if(this.ODataVersion==3&&c.GetAttribute("odata.nextLink").length>0){k=c.GetAttribute("odata.nextLink")}else{if(this.ODataVersion==4&&c.GetAttribute("@odata.nextLink").length>0){k=c.GetAttribute("@odata.nextLink")}}}if(f==-1&&k.length==0){f=d.Count()}}return f}return -1};IOTConnector.prototype.GetMissingDoc=function(n,f,m){if(this.ServiceType!=IOTConnector.SERTYPE_ODATA){return}try{var a=f.ODataLoadInfo.get_Value(new IDVariant("url")).stringValue();var c=f.ODataLoadInfo.get_Value(new IDVariant("action")).stringValue();var l=f.ODataLoadInfo.get_Value(new IDVariant("pageSize")).intValue();var o=f.ODataLoadInfo.get_Value(new IDVariant("childLevel")).intValue();var j=f.ODataLoadInfo.get_Object(new IDVariant("args"));var b=j.get_Object(new IDVariant("ID_HEADERS"));var d=m-(m%l);if(this.ODataVersion==4){a=a.Replace("$count=true","$skip="+d)}else{a=a.Replace("$inlinecount=allpages","$skip="+d)}var k=new IDVariant();var h=this.DoHttpRequest(c,a,j,k);if(k.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector."+c,n.TypeName()+": error while loading collection from "+d+" to "+(d+l)+": "+k);return}this.LoadCollectionFromJSON(n,f,h.GetRootNode(),o,d);j.set_Object(new IDVariant("ID_HEADERS"),b)}catch(g){}};IOTConnector.prototype.GetCountFromResult=function(a){var b=-1;if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){if(a.GetAttribute("done").equals("-1")&&a.GetAttribute("totalSize").length>0){b=parseInt(a.GetAttribute("totalSize"))}}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(this.ODataVersion<=2&&a.GetAttribute("__count").length>0){b=parseInt(a.GetAttribute("__count"))}else{if(this.ODataVersion==3&&a.GetAttribute("odata.count").length>0){b=parseInt(a.GetAttribute("odata.count"))}else{if(this.ODataVersion==4&&a.GetAttribute("@odata.count").length>0){b=parseInt(a.GetAttribute("@odata.count"))}}}}}return b};IOTConnector.prototype.GetCollectionCount=function(c,g,d,a,f){var e=g;if(this.ODataVersion==4){e=e.Replace("?$count=true","/$count?")}else{e=e.Replace("?$inlinecount=allpages","/$count?")}for(var b=0;b<d.Size();b++){if(d.get_Value(new IDVariant(b)).stringValue().startsWith("Accept: ")){d.Remove(new IDVariant(b))}}d.add_Value(new IDVariant("Accept: text/plain, application/json"));a.set_Object(new IDVariant("ID_HEADERS"),d);this.DoHttpRequest("LoadCollectionBE",e,a,f);if(f.stringValue().length==0){return a.get_Value(new IDVariant("ID_RESPONSE")).intValue()}else{return -1}};IOTConnector.SetDocMDMap=function(a){if(a.IOTCode.length==0){return}IOTConnector.DocMDMap.set_Value(new IDVariant(a.ServiceEndpoint+"|"+a.IOTCode),new IDVariant(a.ObjTag))};IOTConnector.CreateIOTDocument=function(b,a,j){var e=IOTConnector.DocMDMap.get_Value(new IDVariant(b.ServiceEndpoint+"|"+j)).stringValue();if(e.length>0){return a.CreateDocument(e)}var h=a.GetLibraryObjList("",true);for(var c=0;c<h.Size();c++){var g=a.CreateDocument(h.get_Value(new IDVariant(c)).stringValue());IOTConnector.SetDocMDMap(g.GetMD());if(g.GetMD().IOTCode.equals(j)){return g}}var f=a.GetCompList();for(var c=0;c<f.Count();c++){var g=IOTConnector.CreateIOTDocument(b,f[c],j);if(g!=null){return g}}return null};IOTConnector.prototype.GetResourcePath=function(e,g){if(g==undefined){g=true}var f=e.GetMD();var b="";if(g){for(var d=1;d<=f.GetNumProp();d++){var c=f.GetProp(d);if(c.PK){var a=e.GetPropByIndex(d);if(this.ServiceType==IOTConnector.SERTYPE_ODATA){b+=(b.length>0?",":"")+c.IOTCode+"="+this.ToSOQL(a,c)}else{b+=(b.length>0?"/":"")+a}}}if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&b.indexOf(",")==-1){b=b.substr(b.indexOf("=")+1)}}switch(this.ServiceType){case IOTConnector.SERTYPE_SALESFORCE:return"sobjects/"+f.IOTCode+(g?"/"+b:"");case IOTConnector.SERTYPE_ODATA:return f.ODataEntitySet+(g?"("+b+")":"");default:return f.IOTCode+(g?"/"+b:"")}};IOTConnector.CallAction=function(c,a,f,e){var b=c;if(c.indexOf(".")!=-1){b=c.substr(0,c.indexOf("."))+"$"+c.substr(c.indexOf(".")+1)}var d=IDDocument.GetFromDNA(new IDVariant(b),false,0,e,e.getIMDB(),true);return d.GetServiceConnector().CallAction(d,a,f)};IOTConnector.prototype.CallAction=function(J,s,t){var b=J.GetMD();var y=b.IOTMethods.split(";");var l="";for(var M=0;M<y.length;M++){var f=y[M].substr(0,y[M].indexOf("("));f=f.substr(f.lastIndexOf(" ")+1);if(f.startsWith("-")){f=f.substr(1)}if(f.equals(s)){l=y[M];break}}if(l.length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.CallAction","Missing metadata of method "+s+" of class "+J.TypeName());throw new Error("Missing metadata of method "+s+" of class "+J.TypeName())}var A=(l.indexOf("-")!=-1);var j=false;var N=false;var B=null;var e=l.substr(0,l.indexOf("(")).split(" ");var D=e[0];if(D.endsWith("f")){D=D.substr(0,D.length-1);j=true}var z=(e.length==3?e[1]:"");if(z.startsWith("+")){N=true;z=z.substr(1)}if(z.length>2){B=IOTConnector.CreateIOTDocument(this,J.GetMainFrm(),z)}var O="/";if(!A){O+=this.GetResourcePath(J,!A)+"/";if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&this.ODataVersion==4){O+=b.ODataNamespace+"."}}O+=s;if(j){O+="("}var K="?";if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(N){if(this.ODataVersion==4){O+=K+"$count=true"}else{O+=K+"$inlinecount=allpages"}K="&"}if(z.length>2){var a=this.GetODataExpand(B);if(a.length>0){O+=K+a}K="&"}}var H=new XMLDoc();var q=H.AddNewElement(XMLDoc.ROOT_JSON);var L=l.substr(l.indexOf("(")+1);L=L.substr(0,L.length-1);if(L.length>0){var g=L.split(",");for(var M=0;M<g.length;M++){var I=g[M].split(" ");var c=g[M].substr(0,g[M].indexOf(" "));var r=g[M].substr(g[M].indexOf(" ")+1);var h=t.get_Object(new IDVariant(M));if(h instanceof IDVariant){var v=new DOMDProp();v.DataType=parseInt(c);if(j){O+=(M==0?"":",")+r+"="+this.ToSOQL(h,v)}else{if(D.equals("GET")||D.equals("DELETE")){O+=K+r+"="+this.ToSOQL(h,v)}else{q.SetAttribute(r,this.VariantToString(h,v))}}}else{if(h==null){q.SetAttribute(r,XMLDoc.NULL_VALUE)}else{if(h instanceof IDDocument){MDOInit.SaveToXML(h,false,"",999,H.GetDocument(),q.GetNode(),false,XMLDoc.FT_JSON)}else{if(h instanceof IDCollection){}}}}}}if(j){O+=")"}var F=new IDMap();F.set_Value(new IDVariant("ID_TYPE"),new IDVariant(D));F.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));if(!(j||D.equals("GET")||D.equals("DELETE"))){F.set_Value(new IDVariant("ID_BODYTYPE"),new IDVariant("application/json"));F.set_Value(new IDVariant("ID_BODY"),new IDVariant(H.SaveToString(XMLDoc.FT_JSON)))}var E=new IDArray();E.add_Value(new IDVariant("Accept: application/json"));F.set_Object(new IDVariant("ID_HEADERS"),E);if(!this.AddAuthorizationHeader(E)){return 0}var m=new IDVariant();var d=new IDVariant(O);var u=new IDVariant();var x=this.DoHttpRequest("CallAction",d.stringValue(),F,u);if(u.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.CallAction",J.TypeName()+": error while calling action: "+u);throw new Error(u.stringValue())}if(z.length==0){return 0}else{q=x.GetRootNode();if(z.length<=2){var C="";if(this.ServiceType==IOTConnector.SERTYPE_ODATA){C=q.GetAttribute("value")}var v=new DOMDProp();v.DataType=parseInt(z);return this.StringToVariant(C,v)}else{if(N){var o=new IDCollection();var G=this.LoadCollectionFromJSON(B,o,q,0);if(G==-1){G=this.GetCollectionCount("CallAction",d.stringValue(),E,F,u);if(u.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.CallAction",B.TypeName()+": error while get collection count: "+u);throw new Error(u.stringValue())}}var n=(o.MaxRows==0?G:Math.min(o.MaxRows,G));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&n>o.Count()){F.set_Object(new IDVariant("ID_HEADERS"),E);o.ODataLoadInfo=new IDMap();o.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(d));o.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("CallAction"));o.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(o.Count()));o.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(0));o.ODataLoadInfo.set_Object(new IDVariant("args"),F);o.SetSize(n,B)}return o}else{q.SetAttribute(XMLDoc.JSON_IGNORENAME,"1");MDOInit.LoadXMLNode(B,q.GetNode(),true);return B}}}};IOTConnector.prototype.AddAuthorizationHeader=function(a){if(this.AuthenticationRequired()){if(!this.IsAuthenticated()){return false}a.add_Value(new IDVariant("Authorization: Bearer "+this.AccessToken))}else{if(this.Username.length>0){a.add_Value(new IDVariant("Authorization: Basic "+IDL.Base64Encode(this.Username+":"+this.Password)))}}return true};IOTConnector.prototype.BeforeOAuthRequestCode=function(a,b){};IOTConnector.prototype.AfterOAuthRequestCode=function(a,b){};IOTConnector.prototype.BeforeOAuthRequestToken=function(a,b){};IOTConnector.prototype.AfterOAuthRequestToken=function(b,a,c){};IOTConnector.prototype.BeforeLoad=function(c,b,a,d){};IOTConnector.prototype.BeforeLoadCollection=function(f,e,b,d,a,c){};IOTConnector.prototype.BeforeSave=function(f,e,d,g,a,b,c){};IOTConnector.prototype.OnGetValueSource=function(d,c,e,a,b){};IOTConnector.prototype.OnGetLKE=function(e,f,h,b,a,g,c,j,d){};function MDOInit(){}MDOInit.DOERR_PROPNOTFOUND=-100000;MDOInit.DOERR_COLLNOTFOUND=-100001;MDOInit.DOERR_NODBCONN=-100002;MDOInit.DOERR_OBJNOTDEF=-100003;MDOInit.DOERR_OBJNOTFOUND=-100004;MDOInit.DOERR_OBJMULDEF=-100005;MDOInit.DOERR_NOCLASS=-100006;MDOInit.DOERR_NOSERV=-100100;MDOInit.DOERR_NOFRM=-100101;MDOInit.DOERR_NOHLP=-100102;MDOInit.DOERR_BADDOM=-100103;MDOInit.DOERR_NOLOCK=-100201;MDOInit.SERV_DOCID=1;MDOInit.SERV_EXTSCHEMA=2;MDOInit.SERV_ATTACH=4;MDOInit.SERV_COMMENT=8;MDOInit.SERV_DOMAIN=16;MDOInit.SERV_USERINFO=32;MDOInit.SERV_LOCKING=64;MDOInit.SERV_LDELETE=128;MDOInit.SERV_FACTORY=256;MDOInit.SERV_SYNC=512;MDOInit.SERV_WEBAPI=1024;MDOInit.QRY_LOADFROMDB=1;MDOInit.QRY_LOADCOLLECTION=2;MDOInit.QRY_LOADCOLLECTIONBE=3;MDOInit.QRY_INSERT=4;MDOInit.QRY_UPDATE=5;MDOInit.QRY_DELETE=6;MDOInit.QRY_LOADVALUESOURCE=7;MDOInit.QRY_LOADSMARTLOOKUP=8;MDOInit.QRY_LOADVALUELIST=9;MDOInit.GetDTT=function(b){var a=b.GetMainFrm();if(a!=null&&a instanceof WebEntryPointSrv){return a.getDTTObj()}return null};MDOInit.GetRTC=function(b){var a=b.GetMainFrm();if(a!=null&&a instanceof WebEntryPointSrv){return a.getRTCObj()}return null};MDOInit.GetSyncObj=function(b){var a=b.GetMainFrm();if(a!=null&&a instanceof WebEntryPointSrv){return a.SyncObject}return null};MDOInit.SetOriginal=function(f,a){var g=f.GetMD();f.ResetOrigValues();f.set_OldParent(f.Parent());f.set_OldParentCollection(f.ParentCollection());f.set_Updated(false);f.set_Inserted(false);if(a>0){for(var e=1;e<=g.GetNumColl();e++){var k=f.GetCollByIndex(e);var c=k.GetCollection();for(var b=0;b<c.length;b++){var h=c[b];h.SetOriginal(a-1)}f.GetCollByIndex(e).PurgeDeleted()}}};MDOInit.RestoreOriginal=function(f,b){f.StopEvents();var j=f.GetMD();for(var c=1;c<=j.GetNumProp();c++){if(!f.GetPropOrigValue(c).equals(f.GetPropByIndex(c))){f.SetUIModified();f.SetPropDirect(c,f.GetPropOrigValue(c))}}f.ResetOrigValues();if(f.OldParentCollection()!=null&&f.OldParentCollection()!=f.ParentCollection()){try{f.OldParentCollection().Add(f)}catch(h){}}f.set_Updated(false);if(f.Inserted()){f.set_Deleted(true)}else{f.set_Deleted(false)}f.set_Inserted(false);if(b>0){for(var c=1;c<=j.GetNumColl();c++){var a=new ArrayList(f.GetCollByIndex(c).GetCollection());for(var g=0;g<a.Count();g++){var k=a[g];k.RestoreOriginal(b-1)}f.GetCollByIndex(c).PurgeDeleted()}}f.ClearErrors();f.StartEvents()};MDOInit.LoadFromDB=function(l,N,q){if(q==undefined){q=false}if(l.Inserted()){if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddMsg(DTTEngine.DTTMSG_WARN,"",208,"DO.LoadFromDB",l.GetName(1)+": cannot load an inserted document")}return}var H=l.GetMD();var n=l.GetRemote();if(n!=null){}var d=l.GetServiceConnector();if(d!=null){d.LoadFromDB(l,N);return}var C=new IDVariant();l.BeforeLoad(C);if(C.isTrue()){return}if(!l.Loaded()){var b=MDOInit.GetDOBase(H);var B=H.DBObj;if(B==null){B=l.GetDBObj()}var I=new ArrayList();var L="";var o=new IDVariant();var g=new Array(Glb.SQL_MAXQUERIES);var m="";for(var G=0;G<Glb.SQL_MAXQUERIES;G++){g[G]=""}l.GetMasterQuery(g,o,I);if(o.stringValue().length>0){L=o.stringValue()+"."}var E="";var y=true;var D=0;for(var G=1;G<=H.GetNumProp();G++){var O=H.GetProp(G);if(O.PK){D++;var t=l.GetPropByIndex(G);if(t.Type==IDVariant.NULL){y=false;break}var r=MDOInit.GetPropExpr(O,l,b);m+=E+"("+r+"="+Glb.ToSql(t,H.GetDBType(),B,O.IsUnicode)+")";E=" and "}}if(D==0){y=false}if(!y){m="";E="";for(var G=1;G<=H.GetNumProp();G++){var O=H.GetProp(G);if(O.DBCode!=null&&O.DBCode.length>0){var t=l.GetPropByIndex(G);if(t.Type!=IDVariant.NULL){var r=MDOInit.GetPropExpr(O,l,b);m+=E+"("+r+"="+Glb.ToSql(t,H.GetDBType(),B,O.IsUnicode)+")";E=" and ";y=true}}}}if(B!=null&&!y){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+H.ObjTag+" No fields filled in")}var M;var s=false;var f="";if(g[0].length>0){M="";for(var G=0;G<Glb.SQL_MAXQUERIES;G++){if(G!=Glb.SQL_ORDERBY){M+=g[G]}if(G==Glb.SQL_ORDERBY&&f.length==0){f=g[G]}if(G==Glb.SQL_WHERE){if(m.length>0){if(g[G].length==0){M+=" where "}else{M+=" and "}M+=m}if(g[G].length>0||m.length>0){s=true}}}}else{M="select ";var F=0;for(var G=1;G<=H.GetNumProp();G++){var O=H.GetProp(G);if(O.DBCode!=null&&O.DBCode.length>0&&!MDOInit.UseRecord(O)){if(F>0){M+=", "}F++;M+=MDOInit.GetPropExpr(O,l,b,false)}}var J=new IDVariant(M);var P=MDOInit.GetFromList(l.GetMainFrm(),b,J,(q?1:0));M=J.stringValue();if(P.length>0){if(m.length==0){m+=P}else{P+=" and ";m=P+m}}E=MDOInit.HandleServiceFilters(l);if(E.length>0){if(m.length==0){m+=E}else{m="("+m;m+=") and "+E}}if(m.length>0){M+=" where "+m;s=true}}var x=new IDVariant();l.OnSQLQuery(new IDVariant(M),new IDVariant(MDOInit.QRY_LOADFROMDB),x);if(x.stringValue().length>0){if(!s){M+=" where "}else{M+=" and "}M+=x;M+=" "}if(M.indexOf("order by")==-1){if(f.length>0){M+=f}}if(B!=null){if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddQuery("DO.LoadFromDB",l.GetName(1)+": loading","DO.LoadFromDB",DTTEngine.STMT_QRY_SELECT,M)}var h;try{h=B.OpenRS(M);if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddDBDataSource(h,M)}if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).EndQuery("DO.LoadFromDB")}l.AfterSQLQuery(new IDVariant(M),new IDVariant(MDOInit.QRY_LOADFROMDB),h,new IDVariant())}catch(K){l.AfterSQLQuery(new IDVariant(M),new IDVariant(MDOInit.QRY_LOADFROMDB),null,new IDVariant(K.toString()));if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.LoadFromDB",l.GetName(1)+": DB error while loading document: "+K)}throw K}if(!h.EOF()){h.MoveFirst()}if(h.RecordCount()<=0){var u=false;if(l.GetMainFrm() instanceof WebEntryPointSrv){u=l.GetMainFrm().SyncObject.IsSynchronizing}if(u){return}else{throw new Error("ERR "+MDOInit.DOERR_OBJNOTFOUND+": "+H.ObjTag+" Object not found")}}if(h.RecordCount()>1){throw new Error("ERR "+MDOInit.DOERR_OBJMULDEF+": "+H.ObjTag+" Can not identify the object")}l.StopEvents();MDOInit.LoadDocProp(l,I,h)}else{if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddMsg(DTTEngine.DTTMSG_INFO,"",210,"DO.LoadFromDB",l.GetName(1)+" ("+H.ObjTag+"): not loaded because the class is not linked to a DB table")}}l.SetOriginal()}var a=new Array(H.GetNumColl()+1);for(var G=1;G<=H.GetNumColl();G++){a[G]=l.GetCollByIndex(G).Loaded()}var A=l.LoadChildrenFromDB(N);if(!l.Loaded()){l.set_Loaded(true);l.AfterLoad(IDVariant.FALSE);l.MarkAsChanged();l.StartEvents()}else{if(A){var c=new IDArray();for(var G=1;G<=H.GetNumColl();G++){if(!a[G]&&l.GetCollByIndex(G).Loaded()){c.add_Object(l.GetCollByIndex(G))}}l.AfterLoad(IDVariant.TRUE,c);l.MarkAsChanged()}}};MDOInit.LoadChildrenFromDB=function(d,b){var e=d.GetMD();var a=false;if(b>0){for(var c=1;c<=e.GetNumColl();c++){if(!e.GetColl(c).Transient){if(!d.GetCollByIndex(c).Loaded()){a=true}d.LoadCollectionFromDB(b,c)}}}return a};MDOInit.LoadCollectionFromDB=function(J,h,S){var T=J.GetCollByIndex(S);if(T.Parent()!=null&&T.Parent().Inserted()){if(MDOInit.GetDTT(T.Parent())!=null){MDOInit.GetDTT(T.Parent()).AddMsg(DTTEngine.DTTMSG_WARN,"",208,"DO.LoadCollectionFromDB",T.Parent().GetName(1)+": cannot load a collection belonging to an inserted document")}return}if(!T.Loaded()){T.Clear();var s=J.GetMD();var g=s.GetColl(S);var C=J.CreateDocument(g.ChildrenName);if(C==null){C=J.GetMainFrm().GetApplication().CreateDocument(g.ChildrenName)}var q=C.GetMD();var m=q.DBObj;var a=J.GetServiceConnector();if(a!=null){a.LoadCollectionFromDB(J,h,S);return}if(m==null){m=C.GetDBObj()}var t=new IDVariant();C.BeforeLoadCollection(J,T,t);if(t.isTrue()){return}var F=MDOInit.GetDOBase(q);var n=new ArrayList();var z="";var x=new IDVariant();var D=new Array(Glb.SQL_MAXQUERIES);var y="";var I=new IDVariant();J.GetValueSource(I,n,T,C);var f=I.stringValue();var b=false;if(I.stringValue().length==0){for(var M=0;M<Glb.SQL_MAXQUERIES;M++){D[M]=""}C.GetMasterQuery(D,x,n);if(x.stringValue().length>0){z=x.stringValue()+"."}var G=MDOInit.GetCollSort(C,T,q.GetDBType(),q,z);var K="";for(var M=1;M<=g.PKColl.Count();M++){var Q=s.GetPropIndex(g.PKColl[M-1]);var O=q.GetPropIndex(g.FKColl[M-1]);var A=q.GetProp(O);var H=J.GetPropByIndex(Q);if(H.Type==IDVariant.NULL){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+s.ObjTag+" PK not defined")}y+=K+"("+MDOInit.GetPropExpr(A,C,F)+"="+Glb.ToSql(H,q.GetDBType(),m,A.IsUnicode)+")";K=" and "}if(D[0].length>0){f="";for(var M=0;M<Glb.SQL_MAXQUERIES;M++){if(M!=Glb.SQL_ORDERBY){f+=D[M]}if(M==Glb.SQL_ORDERBY&&G.length==0){G=D[M]}if(M==Glb.SQL_WHERE){if(y.length>0){if(D[M].length==0){f+=" where "}else{f+=" and "}f+=y}if(y.length>0||D[M].length>0){b=true}}}}else{f="select ";var L=0;for(var M=1;M<=q.GetNumProp();M++){var A=q.GetProp(M);if(A.DBCode!=null&&A.DBCode.length>0&&!MDOInit.UseRecord(A)){if(L>0){f+=", "}L++;f+=MDOInit.GetPropExpr(A,C,F,false)}}var l=new IDVariant(f);var o=MDOInit.GetFromList(J.GetMainFrm(),F,l,0);f=l.stringValue();if(o.length>0){if(y.length==0){y+=o}else{o+=" and ";y=o+y}}K=MDOInit.HandleServiceFilters(C);if(K.length>0){if(y.length==0){y+=K}else{y="("+y+") and "+K}}if(y.length>0){f+=" where "+y;b=true}}var B=new IDVariant();C.OnSQLQuery(new IDVariant(f),new IDVariant(MDOInit.QRY_LOADCOLLECTION),B);if(B.stringValue().length>0){if(!b){f+=" where "}else{f+=" and "}f+=B;f+=" "}else{if(!b){if(MDOInit.GetDTT(J)!=null){MDOInit.GetDTT(J).AddMsg(DTTEngine.DTTMSG_WARN,"",208,"DO.LoadCollectionFromDB",J.TypeName()+": cannot load a "+g.ChildrenName+" collection because the WhereClause is empty and I would load ALL records (is it related to a database FK?)")}return}}if(f.indexOf("order by")==-1){if(G.length>0){f+=G}else{f+=MDOInit.GetNaturalSort(C,z)}}}if(m!=null){if(T.MaxRows>0){m.MaxRows=T.MaxRows+1}if(MDOInit.GetDTT(J)!=null){MDOInit.GetDTT(J).AddQuery("DODB",J.TypeName()+": loading "+g.ChildrenName,"DO.LoadCollectionFromDB",DTTEngine.STMT_QRY_SELECT,f)}var r;try{r=m.OpenRS(f);if(MDOInit.GetDTT(J)!=null){MDOInit.GetDTT(J).AddDBDataSource(r,f)}if(MDOInit.GetDTT(J)!=null){MDOInit.GetDTT(J).EndQuery("DODB")}C.AfterSQLQuery(new IDVariant(f),new IDVariant(MDOInit.QRY_LOADCOLLECTION),r,new IDVariant())}catch(P){C.AfterSQLQuery(new IDVariant(f),new IDVariant(MDOInit.QRY_LOADCOLLECTION),null,new IDVariant(P.toString()));if(MDOInit.GetDTT(J)!=null){MDOInit.GetDTT(J).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.LoadCollectionFromDB",J.TypeName()+": DB error while loading "+g.ChildrenName+": "+P)}throw P}var N=0;if(T.Parent()!=null){T.Parent().StopEvents()}if(!r.EOF()){r.MoveFirst()}while(!r.EOF()){var R=J.CreateDocument(g.ChildrenName);T.Add(R);R.StopEvents();MDOInit.LoadDocProp(R,n,r);R.SetOriginal();if(h>0){R.LoadChildrenFromDB(h-1)}R.set_Loaded(true);R.AfterLoad(IDVariant.FALSE);R.MarkAsChanged();R.StartEvents();r.MoveNext();N++;if(N==T.MaxRows){break}}T.set_Loaded(true);T.HasMoreElements=(r.RecordCount()>T.MaxRows)&&(T.MaxRows>0);if(T.Parent()!=null){T.Parent().StartEvents()}}else{T.set_Loaded(true);T.HasMoreElements=false}}else{if(h>0){var u=T.GetCollection();for(var E=0;E<u.Count();E++){var R=u[E];if(!R.Inserted()){R.LoadFromDB(h-1)}}}}};MDOInit.GetCollSort=function(k,g,m,e,d){var b="";var l=MDOInit.GetDOBase(e);for(var h=1;h<=16;h++){var f=g.GetSortCriteria(h);if(f!=0){var a=e.GetProp(Math.abs(f));var c=MDOInit.GetPropExpr(a,k,l);if(c.length>0){if(b.length==0){b=" order by "}else{b+=", "}b+=c;if(f<0){b+=" desc"}}}}return b};MDOInit.LoadCollectionDirect=function(g,j,e,d){var h=g.GetMD();for(var f=1;f<=h.GetNumColl();f++){if(g.GetCollByIndex(f)==j){if(!d||!h.GetColl(f).Transient){var b=j.Loaded();MDOInit.LoadCollectionFromDB(g,e,f);if(j.Loaded()&&!b&&j.Parent()!=null&&!j.Parent().FreezeEvents()){var a=new IDArray();a.add_Object(j);j.Parent().AfterLoad(IDVariant.TRUE,a);j.Parent().MarkAsChanged()}}break}}};MDOInit.LoadCollectionRS=function(e,a,c,b){a.set_MainFrm(e.GetMainFrm());a.set_imdb(e.GetIMDB());if(!c.EOF()){c.MoveFirst()}try{while(!c.EOF()){var g=e.CreateDocument(e.TypeName());g.StopEvents();a.Add(g);MDOInit.LoadDocProp(g,null,c);g.SetOriginal();g.LoadChildrenFromDB(b-1);g.set_Loaded(true);g.AfterLoad(IDVariant.FALSE);g.MarkAsChanged();g.StartEvents();c.MoveNext()}a.set_Loaded(true)}catch(f){if(this.GetDTT(e)!=null){this.GetDTT(e).AddException("","DO.LoadCollectionRS",e.TypeName()+": Can't load collection from RS",f)}}};MDOInit.LoadCollectionBE=function(N,q,g,f,T,m){var d=N.GetMD();var a=N.GetServiceConnector();if(a!=null){return a.LoadCollectionBE(N,q,g,f)}q.set_MainFrm(N.GetMainFrm());q.set_imdb(N.GetIMDB());var x=new IDVariant();N.BeforeLoadCollection(null,q,x);if(x.isTrue()){return q.Count()}var l=d.DBObj;if(l==null){l=N.GetDBObj()}var G=MDOInit.GetDOBase(d);var n=new ArrayList();var A="";var y=new IDVariant();var E=new Array(Glb.SQL_MAXQUERIES);var z="";for(var R=0;R<Glb.SQL_MAXQUERIES;R++){E[R]=""}N.GetMasterQuery(E,y,n);if(y.stringValue().length>0){A=y.stringValue()+"."}var H=MDOInit.GetCollSort(N,q,d.GetDBType(),d,A);var O="";for(var R=1;R<=d.GetNumProp();R++){var B=d.GetProp(R);var I=MDOInit.GetPropExpr(B,N,G);if(I.length>0){var K=N.GetPropByIndex(R);if(g){var P="";if("DO_ID".equals(B.Concept)){if(K.stringValue().length>0){var o=K.stringValue();if(o.length>0&&o.charAt(0)=="§"){o=o.substr(1)}if(o.equals(".")){P="(not "+I+" is null)"}else{if(o.equals("!")){P="("+I+" is null)"}else{if(o.charAt(0)=="#"&&o.length==21){P="("+I+" <> "+Glb.ToSql(new IDVariant(o.substr(1)),d.GetDBType(),l,B.IsUnicode)+")"}else{if(o.charAt(0)==">"&&o.length==21){P="("+I+" > "+Glb.ToSql(new IDVariant(o.substr(1)),d.GetDBType(),l,B.IsUnicode)+")"}else{if(o.charAt(0)==":"&&o.length==21){P="("+I+" >= "+Glb.ToSql(new IDVariant(o.substr(1)),d.GetDBType(),l,B.IsUnicode)+")"}else{if(o.indexOf(" ")==-1){P="("+I+"="+Glb.ToSql(new IDVariant(o),d.GetDBType(),l,B.IsUnicode)+")"}else{var D=o.split(" ");P="("+I+" IN (";for(var F=0;F<D.length;F++){P+=(F>0?",":"")+Glb.ToSql(new IDVariant(D[F]),d.GetDBType(),l,B.IsUnicode)}P+="))"}}}}}}}}else{var J=(N.GetMainFrm() instanceof WebEntryPointSrv?N.GetMainFrm():null);P=MDOInit.GetQBEFilter(I,B.DataType,B.MaxLength,d.GetDBType(),K.stringValue(),B.Mask,B.IsUnicode,l,J)}if(P.length>0){z+=O+"("+P+")";O=" and "}}else{if(K.Type!=IDVariant.NULL){z+=O+"("+I+"="+Glb.ToSql(K,d.GetDBType(),l,B.IsUnicode)+")";O=" and "}}}}var c;var b=false;if(E[0].length>0){c="";for(var R=0;R<Glb.SQL_MAXQUERIES;R++){if(m&&R==Glb.SQL_SELECT){c+="select count(*) "}else{if(R!=Glb.SQL_ORDERBY){c+=E[R]}}if(R==Glb.SQL_ORDERBY&&H.length==0&&!m){H=E[R]}if(R==Glb.SQL_WHERE){if(z.length>0){if(E[R].length==0){c+=" where "}else{c+=" and "}c+=z}if(z.length>0||E[R].length>0){b=true}}}}else{c="select ";if(m){c+="count(*) "}else{var Q=0;for(var R=1;R<=d.GetNumProp();R++){var B=d.GetProp(R);if(B.DBCode!=null&&B.DBCode.length>0&&!MDOInit.UseRecord(B)){if(Q>0){c+=", "}Q++;c+=MDOInit.GetPropExpr(B,N,G,false)}}}var h=new IDVariant(c);var t=MDOInit.GetFromList(N.GetMainFrm(),G,h,0);c=h.stringValue();if(t.length>0){if(z.length==0){z+=t}else{t+=" and ";z.insert(0,t)}}O=MDOInit.HandleServiceFilters(N);if(O.length>0){if(z.length==0){z+=O}else{z="("+z+") and "+O}}if(z.length>0){c+=" where "+z;b=true}}if(T!=null&&T.length>0){if(!b){T=" where "+T+" "}else{T=" and "+T+" "}var M=c.indexOf("group by");if(M!=-1){c=c.insert(M,T)}else{c+=T}c+=" ";b=true}var C=new IDVariant();N.OnSQLQuery(new IDVariant(c),new IDVariant(MDOInit.QRY_LOADCOLLECTIONBE),C);if(C.stringValue().length>0){if(!b){c+=" where "}else{c+=" and "}var M=c.indexOf("group by");if(M!=-1){c=c.insert(M,C+" ")}else{c+=C+" "}}if(c.indexOf("order by")==-1&&!m){if(H.length==0){c+=MDOInit.GetNaturalSort(N,A)}else{c+=H}}if(l!=null){if(q.MaxRows>0){l.MaxRows=q.MaxRows+1}if(MDOInit.GetDTT(N)!=null){MDOInit.GetDTT(N).AddQuery("DODB",N.TypeName()+": Loading Collection By Example ","DO.LoadCollectionBE",DTTEngine.STMT_QRY_SELECT,c)}var u;try{u=l.OpenRS(c);if(MDOInit.GetDTT(N)!=null){MDOInit.GetDTT(N).AddDBDataSource(u,c)}if(MDOInit.GetDTT(N)!=null){MDOInit.GetDTT(N).EndQuery("DODB")}N.AfterSQLQuery(new IDVariant(c),new IDVariant(MDOInit.QRY_LOADCOLLECTIONBE),u,new IDVariant())}catch(U){N.AfterSQLQuery(new IDVariant(c),new IDVariant(MDOInit.QRY_LOADCOLLECTIONBE),null,new IDVariant(U.toString()));if(MDOInit.GetDTT(N)!=null){MDOInit.GetDTT(N).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.LoadCollectionBE",N.TypeName()+": DB error while loading collection: "+U)}throw U}if(m){if(!u.EOF()){u.MoveFirst();return u.Get(1).intValue()}else{return 0}}if(!u.EOF()){u.MoveFirst()}try{var S=0;while(!u.EOF()){var r=N.CreateDocument(N.TypeName());r.StopEvents();q.Add(r);MDOInit.LoadDocProp(r,n,u);r.SetOriginal();r.LoadChildrenFromDB(f-1);r.set_Loaded(true);r.AfterLoad(IDVariant.FALSE);r.MarkAsChanged();r.StartEvents();u.MoveNext();S++;if(S==q.MaxRows){break}}q.set_Loaded(true);q.HasMoreElements=(u.RecordCount()>q.MaxRows)&&(q.MaxRows>0)}catch(L){if(this.GetDTT(N)!=null){this.GetDTT(N).AddException("","DO.LoadCollectionBE",N.TypeName()+": Exception while loading a collection BE",L)}throw L}}else{if(MDOInit.GetDTT(N)!=null){MDOInit.GetDTT(N).AddMsg(DTTEngine.DTTMSG_INFO,"",210,"DO.LoadCollectionBE",N.GetName(1)+" ("+d.ObjTag+"): collection not loaded because the class is not linked to a DB table")}q.set_Loaded(true);q.HasMoreElements=false}return q.Count()};MDOInit.GetQBEClauses=function(f,A,d,e,l,o){var b="";var g="";var B=o.stringValue();var y=f.GetMD();var q=y.DBObj;if(q==null){q=f.GetDBObj(false)}var a=MDOInit.GetDOBase(y);var z=new ArrayList();var h=new IDVariant();var c=new Array(Glb.SQL_MAXQUERIES);for(var x=0;x<Glb.SQL_MAXQUERIES;x++){c[x]=""}f.GetMasterQuery(c,h,z);if(h.stringValue().length>0){B=h.stringValue()+"."}if(A!=null){b=MDOInit.GetCollSort(f,A,y.GetDBType(),y,B)}var t="";for(var x=1;x<=y.GetNumProp();x++){var C=y.GetProp(x);var u=MDOInit.GetPropExpr(C,f,a);if(u.length>0){var m=f.GetPropByIndex(x);if(d){var s="";if("DO_ID".equals(C.Concept)){if(m.stringValue().length>0){var r=m.stringValue();if(r.length>0&&r.charAt(0)=="§"){r=r.substr(1)}if(r.equals(".")){s="(not "+u+" is null)"}else{if(r.equals("!")){s="("+u+" is null)"}else{if(r.charAt(0)=="#"&&r.length==21){s="("+u+" <> "+Glb.ToSql(new IDVariant(r.substr(1)),y.GetDBType(),q,C.IsUnicode)+")"}else{if(r.indexOf(" ")==-1){s="("+u+"="+Glb.ToSql(new IDVariant(r),y.GetDBType(),q,C.IsUnicode)+")"}else{var D=r.split(" ");s="("+u+" IN (";for(var n=0;n<D.length;n++){s+=(n>0?",":"")+Glb.ToSql(new IDVariant(D[n]),y.GetDBType(),q,C.IsUnicode)}s+="))"}}}}}}else{var j=(f.GetMainFrm() instanceof WebEntryPointSrv?f.GetMainFrm():null);s=MDOInit.GetQBEFilter(u,C.DataType,C.MaxLength,y.GetDBType(),m.stringValue(),C.Mask,C.IsUnicode,q,j)}if(s.length>0){g+=t+"("+s+")";t=" and "}}else{if(m.Type!=IDVariant.NULL){g+=t+"("+u+"="+Glb.ToSql(m,y.GetDBType(),q,C.IsUnicode)+")";t=" and "}}}}if(c[Glb.SQL_WHERE].length>0){if(g.length>0){g+=" and "}g+=c[Glb.SQL_WHERE].substr(6)}e.set(new IDVariant(g));if(c[Glb.SQL_ORDERBY].length>0){b=c[Glb.SQL_ORDERBY]}else{if(b.length==0){b=MDOInit.GetNaturalSort(f,B)}}l.set(new IDVariant(b));o.set(new IDVariant(B))};MDOInit.GetQBEFilter=function(j,A,m,E,B,L,H,n,o){var r="";var t;var e=-1,c=-1;var h=true;if(B.length>0&&B.charAt(0)=="§"){B=B.substr(1);h=false}if(B.length==0){return""}var F=(o!=null&&o.ParamsObj().QBETrueLessThan);var I=(o!=null?o.ParamsObj().PanelsLikeMode:Glb.PAN_LIKESTARTS);do{if(B.charAt(0)!="="){e=B.indexOf(";",e+1)}if(e>=0){t=B.substr(c+1,(e)-(c+1))}else{t=B.substr(c+1)}var l="";var q=new Array(2);q[0]="";q[1]="";if(t.length>0){if(t.length>1&&t.charAt(0)==">"){if(F){l=j+" > ?"}else{l=j+" >= ?"}q[0]=t.substr(1);if(A==Glb.DT_DATETIME||A==Glb.DT_DATE){var G=IDL.ParsePartialDate(o,q[0],(F?1:0));if(G.Type!=IDVariant.NULL){l=j+" >= ?";q[0]=G.stringValue()}}}if(t.length>1&&t.charAt(0)=="<"){if(F){l=j+" < ?"}else{l=j+" <= ?"}q[0]=t.substr(1);if(A==Glb.DT_DATETIME||A==Glb.DT_DATE){var G=IDL.ParsePartialDate(o,q[0],(F?0:1));if(G.Type!=IDVariant.NULL){l=j+" < ?";q[0]=G.stringValue()}}}if(t.length==1&&t.charAt(0)=="."){l=j+" is not null"}if(t.length==1&&t.charAt(0)=="!"){l=j+" is null"}if(t.length>1&&t.charAt(0)=="#"){t=t.substr(1);if(h&&Glb.ClassDT(A)==Glb.DTC_CHAR){t=t.replace(/\%/g,"*");if(t.indexOf("*")==-1){t=(I==Glb.PAN_LIKECONTAINS?"*":"")+t+"*"}var K=0;if(L!=null&&L.equals(">")){l="(";q[0]=t.toUpperCase()}else{if(L!=null&&L.equals("<")){l="(";q[0]=t.toLowerCase()}else{switch(Glb.ClassDB(E)){case Glb.DBC_ACCESS:l="lcase(";q[0]=t.toLowerCase();break;case Glb.DBC_DB2:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:case Glb.DBC_POSTGRES:case Glb.DBC_SQLSRV:l="lower(";q[0]=t.toLowerCase();K=(n.Unicode?4000:8000);break;case Glb.DBC_ORACLE:l="lower(";q[0]=t.toLowerCase();K=2000;break;default:l="(";q[0]=t;break}if(K>0&&m>K){l="(";q[0]=t}}}var C=new IDVariant(q[0]);var y=new IDVariant();IDL.LikeEscape(E,C,y);q[0]=C.stringValue().replace(/\*/g,"%");l+=j+") not like ?"+y.stringValue()}else{l=j+" <> ?";q[0]=t;if(A==Glb.DT_DATETIME||A==Glb.DT_DATE){var x=IDL.ParsePartialDate(o,q[0],0);var v=IDL.ParsePartialDate(o,q[0],1);if(x.Type!=IDVariant.NULL){l=j+" < ? or "+j+" >= ?";q[0]=x.stringValue();q[1]=v.stringValue()}}}}if(t.length>1&&t.charAt(0)=="="){l=j+" = ?";q[0]=t.substr(1)}else{if(Glb.ClassDT(A)==Glb.DTC_CHAR&&t.length>1&&t.charAt(t.length-1)=="&"){if(Glb.ClassDB(E)!=Glb.DBC_ACCESS&&Glb.ClassDB(E)!=Glb.DBC_ODBC&&Glb.ClassDB(E)!=Glb.DBC_POSTGRES){l="soundex("+j+") = soundex(?)";q[0]=t.substr(0,(t.length-1))}else{t=t.substr(0,(t.length-1))+"*"}}if(l.length==0){var s=t.indexOf(":");if(s>=0){var J=false;if(Glb.ClassDT(A)==Glb.DTC_DATE){J=true;var x=IDL.ParsePartialDate(o,t.substr(0,s),0);var v=IDL.ParsePartialDate(o,t.substr(s+1),1);var k=(x.Type!=IDVariant.NULL||v.Type!=IDVariant.NULL);if(t.indexOf("/")!=-1||t.indexOf("-")!=-1||k){var a;for(a=s+1;a<t.length;a++){if(t.charAt(a)==":"){s=a}else{if(t.charAt(a)=="/"||t.charAt(a)=="-"){break}}}if(a<=t.length){var g=t.substr(0,s);var f=t.substr(s+1);if(g.length>0&&f.length>0){if(x.Type==IDVariant.NULL&&v.Type==IDVariant.NULL){l=j+" between ? and ?";q[0]=g;q[1]=f}else{l=j+" >= ?";if(x.Type==IDVariant.NULL){q[0]=g}else{q[0]=x.stringValue()}if(v.Type==IDVariant.NULL){l+=" and "+j+" <= ?";q[1]=f}else{l+=" and "+j+" < ?";q[1]=v.stringValue()}}}else{if(g.length>0){l=j+" >= ?";if(x.Type==IDVariant.NULL){q[0]=g}else{q[0]=x.stringValue()}}else{if(f.length>0){if(v.Type==IDVariant.NULL){l=j+" <= ?";q[0]=f}else{l=j+" < ?";q[0]=v.stringValue()}}}}}}else{var u=new ArrayList();for(var a=0;a<t.length;a++){if(t.charAt(a)==":"){u.Add(a)}}if(u.Count()>2&&(u.Count()%2)==1){s=Math.floor(u[(u.Count()-1)/2]);var g=t.substr(0,s);var f=t.substr(s+1);if(g.length>0&&f.length>0){l=j+" between ? and ?";q[0]=g;q[1]=f}else{if(g.length>0){l=j+" >= ?";q[0]=g}else{if(f.length>0){l=j+" <= ?";q[0]=f}}}}}}if(!J){var g=t.substr(0,s);var f=t.substr(s+1);if(g.length>0&&f.length>0){l=j+" between ? and ?";q[0]=g;q[1]=f}else{if(g.length>0){l=j+" >= ?";q[0]=g}else{if(f.length>0){l=j+" <= ?";q[0]=f}}}}}}if(l.length==0){var D=t.indexOf(" ")>=0&&(t.indexOf(":")>=0||t.indexOf(".")>=0);var x=IDL.ParsePartialDate(o,t,0);var v=IDL.ParsePartialDate(o,t,1);if((A==Glb.DT_DATETIME||A==Glb.DT_DATE)&&x.Type!=IDVariant.NULL){l=j+" >= ? and "+j+" < ?";q[0]=x.stringValue();q[1]=v.stringValue()}else{if(((A==Glb.DT_DATETIME&&!D)||(Glb.ClassDB(E)==Glb.DBC_SQLITE&&A==Glb.DT_DATE))){x=new IDVariant(t,IDVariant.DATETIME);if(x.Type!=IDVariant.NULL){l=j+" between ? and ?";q[0]=t;q[1]=t+" 23:59:59"}else{l=j+" = ?";q[0]=t}}else{if(h&&Glb.ClassDT(A)==Glb.DTC_CHAR){t=t.replace(/\%/g,"*");if(t.indexOf("*")==-1){t=(I==Glb.PAN_LIKECONTAINS?"*":"")+t+"*"}var K=0;if(L!=null&&L.equals(">")){l="(";q[0]=t.toUpperCase()}else{if(L!=null&&L.equals("<")){l="(";q[0]=t.toLowerCase()}else{switch(Glb.ClassDB(E)){case Glb.DBC_ACCESS:l="lcase(";q[0]=t.toLowerCase();break;case Glb.DBC_DB2:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:case Glb.DBC_POSTGRES:case Glb.DBC_SQLSRV:l="lower(";q[0]=t.toLowerCase();K=(n.Unicode?4000:8000);break;case Glb.DBC_ORACLE:l="lower(";q[0]=t.toLowerCase();K=2000;break;default:l="(";q[0]=t;break}if(K>0&&m>K){l="(";q[0]=t}}}var C=new IDVariant(q[0]);var y=new IDVariant();IDL.LikeEscape(E,C,y);q[0]=C.stringValue().replace(/\*/g,"%");l+=j+") like ?"+y.stringValue()}else{l=j+" = ?";q[0]=t}}}}}var z=0;for(var b=0;b<q.length;b++){switch(Glb.ClassDT(A)){case Glb.DTC_CHAR:q[b]=IDL.CSql(new IDVariant(q[b]),IDL.FMT_CHAR,n,H);break;case Glb.DTC_NUMBER:q[b]=IDL.CSql(new IDVariant(q[b]),IDL.FMT_NUM,n,H);break;case Glb.DTC_DATE:switch(Glb.ClassDB(E)){case Glb.DBC_ACCESS:q[b]=IDL.CSql(new IDVariant(q[b]),IDL.FMT_DAT1,n,H);break;case Glb.DBC_ORACLE:case Glb.DBC_POSTGRES:q[b]=IDL.CSql(new IDVariant(q[b]),IDL.FMT_DAT3,n,H);break;case Glb.DBC_SQLITE:q[b]=IDL.CSql(new IDVariant(q[b]),IDL.FMT_DAT4,n,H);break;case Glb.DBC_DB2:if(E==Glb.DBT_DB2400&&n.UseAS400Date){q[b]=IDL.CSql(new IDVariant(q[b]),(A==Glb.DT_DATETIME?IDL.FMT_DAT6:IDL.FMT_DAT5),n,H)}else{q[b]=IDL.CSql(new IDVariant(q[b]),IDL.FMT_DAT2,n,H)}break;default:q[b]=IDL.CSql(new IDVariant(q[b]),IDL.FMT_DAT2,n,H);break}break}z=l.indexOf("?",z);if(z>=0){l=l.substr(0,z)+q[b]+l.substr(z+1);z+=q[b].length}else{break}}if(l.length>0){if(r.length>0){r+=" or "}r+="("+l+")"}}c=e}while(e>=0);return r};MDOInit.IsModified=function(e,a){if(e.Updated()||e.Inserted()||e.Deleted()){return true}var g=e.GetMD();if(a>0){for(var b=1;b<=g.GetNumColl();b++){var j=e.GetCollByIndex(b).GetCollection();for(var f=0;f<j.Count();f++){var h=j[f];if(h.IsModified(a-1)){return true}}}}return false};MDOInit.DocIsDeleted=function(a){if(a.Deleted()){return true}else{if(a.Parent()!=null){return a.Parent().DocIsDeleted()}}return false};MDOInit.Clear=function(b){var c=b.GetMD();for(var a=1;a<=c.GetNumProp();a++){b.SetPropDirect(a,new IDVariant())}for(var a=1;a<=c.GetNumColl();a++){b.GetCollByIndex(a).Clear()}b.SetOriginal();b.set_Loaded(false);b.set_Inserted(false);b.set_Deleted(false);b.set_Updated(false);b.ClearErrors();b.OnClear()};MDOInit.Validate=function(n,k,l,e){n.ProcessChange(true);n.ClearErrors(true);n.LastFailedCheck=null;var o=new IDVariant();var m=new IDVariant();var a=new IDVariant(k);n.OnValidate(a,o,m);if(o.isTrue()){if(MDOInit.GetDTT(n)!=null){MDOInit.GetDTT(n).AddMsg(DTTEngine.DTTMSG_WARN,"",204,"DO.Validate",n.GetName(1)+": invalidated by custom event")}if(MDOInit.GetDTT(n)!=null){MDOInit.GetDTT(n).AddMsgToken("","ERR",MDOInit.GetDocErrors(n))}return false}if(m.isFalse()){if(!n.Deleted()){n.InternalValidate(k,o)}if(o.isTrue()){if(MDOInit.GetDTT(n)!=null){MDOInit.GetDTT(n).AddMsg(DTTEngine.DTTMSG_WARN,"",205,"DO.Validate",n.GetName(1)+": internally invalidated")}if(MDOInit.GetDTT(n)!=null){MDOInit.GetDTT(n).AddMsgToken("","ERR",MDOInit.GetDocErrors(n))}return false}if(n.HasErrors()){if(MDOInit.GetDTT(n)!=null){MDOInit.GetDTT(n).AddMsg(DTTEngine.DTTMSG_WARN,"",205,"DO.Validate",n.GetName(1)+": document has errors")}if(MDOInit.GetDTT(n)!=null){MDOInit.GetDTT(n).AddMsgToken("","ERR",MDOInit.GetDocErrors(n))}return false}}var b=n.GetMD();if(l>0){for(var g=1;g<=b.GetNumColl();g++){var j=n.GetCollByIndex(g).GetCollection();for(var f=0;f<j.Count();f++){var h=j[f];if(!h.Validate(k,l-1,false)){return false}}}}return true};MDOInit.LoadDocToSave=function(l,k,a,g){var h=l.Inserted()&&l.Deleted();k.Add(l);if(g>0){var b=l.GetMD();for(var e=1;e<=b.GetNumColl();e++){var n=l.GetCollByIndex(e);var c=n.GetCollection();for(var j=0;j<c.Count();j++){var f=c[j];var m=f.ParentCollection()!=n;if(m){a.Add(f)}else{if(h&&f.Inserted()){f.set_Deleted(true)}MDOInit.LoadDocToSave(f,k,a,g-1)}}}}};MDOInit.SaveToDB=function(d,a,f){var g=d.GetMD();var c=true;var b=false;MDOInit.ReconnectFK(d,a);if(f){if(!d.Validate(0,a)){if(MDOInit.GetDTT(d)!=null){MDOInit.GetDTT(d).AddMsg(DTTEngine.DTTMSG_WARN,"",202,"DO.SaveToDB",d.GetName(1)+": error while validating document")}if(MDOInit.GetDTT(d)!=null){MDOInit.GetDTT(d).AddMsgToken("","ERR",MDOInit.GetDocErrors(d))}return false}}var e=g.DBObj;if(e==null){e=d.GetDBObj()}if(e!=null&&e.TransCount==0){e.BeginTrans();b=true}MDOInit.SaveToDBTR=function(){var k=new ArrayList();var j=new ArrayList();MDOInit.LoadDocToSave(d,k,j,a);for(var h=0;h<j.Count();h++){var l=j[h];if(l.IsModified()){if(MDOInit.GetDTT(d)!=null){MDOInit.GetDTT(d).AddMsg(DTTEngine.DTTMSG_WARN,"",207,"DO.SaveToDB",l.GetName(1)+"</b> is a referenced document and won't be saved")}}}if(c){for(var h=0;h<k.Count();h++){var l=k[h];if(!MDOInit.SaveDocToDB(l,0,e)){c=false;break}}}k=new ArrayList();j=new ArrayList();MDOInit.LoadDocToSave(d,k,j,a);if(c){for(var h=0;h<k.Count();h++){var l=k[h];if(!MDOInit.SaveDocToDB(l,1,e)){c=false;break}}}if(c){for(var h=0;h<k.Count();h++){var l=k[h];if(!MDOInit.SaveDocToDB(l,2,e)){c=false;break}}}if(c){for(var h=k.Count()-1;h>=0;h--){var l=k[h];if(!MDOInit.SaveDocToDB(l,3,e)){c=false;break}}}if(c){c=MDOInit.AfterSaveDoc(d,a)}if(c){MDOInit.AfterSaveReset(d,a)}if(b){if(c){e.CommitTrans()}else{e.RollbackTrans()}}};if(e){e.ExecuteTrans(MDOInit.SaveToDBTR,self)}else{MDOInit.SaveToDBTR()}return c};MDOInit.AfterSaveDoc=function(m,l){var b=m.GetServiceConnector();if(b!=null){return true}try{var a=m.GetMD();if((a.Services&MDOInit.SERV_SYNC)!=0){var q=MDOInit.GetSyncObj(m);if(q!=null){q.AddVariation(m,false)}}var o=new IDVariant();m.AfterSave(o);if(o.isTrue()){return false}if(l>0){for(var g=1;g<=a.GetNumColl();g++){var n=m.GetCollByIndex(g);var k=n.GetCollection();for(var f=0;f<k.Count();f++){var j=k[f];if(j.ParentCollection()==n){if(!MDOInit.AfterSaveDoc(j,l-1)){return false}}}}}return true}catch(h){if(MDOInit.GetDTT(m)!=null){MDOInit.GetDTT(m).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.SaveToDB",m.GetName(1)+": DB error after saving document: "+h)}m.AddDocError(h.toString());return false}};MDOInit.AfterSaveReset=function(m,h){var a=m.GetMD();if(h>0){for(var e=1;e<=a.GetNumColl();e++){var n=m.GetCollByIndex(e);var g=n.GetCollection();for(var b=0;b<g.Count();b++){var f=g[b];if(f.ParentCollection()==n){MDOInit.AfterSaveReset(f,h-1)}}}}m.ClearErrors();if(m.Inserted()){m.set_Loaded(true);for(var e=1;e<=a.GetNumColl();e++){m.GetCollByIndex(e).set_Loaded(true)}}if(h>0){for(var e=1;e<=a.GetNumColl();e++){m.GetCollByIndex(e).PurgeDeleted()}}m.SetOriginal(0);m.set_Inserted(false);m.GetLookupCache().remove(m.GetDNA().stringValue());var l=m.GetClass().GetClassName(true);var o=m.GetMD().DBCode;var k=l+"|"+(o!=null?o:"");var j=m.GetMainFrm();if(!j.RefreshLookups.Contains(k)){j.RefreshLookups.Add(k)}};MDOInit.SaveDocToDB=function(U,ac,q){var c=U.GetServiceConnector();if(c!=null){return c.SaveDocToDB(U,ac)}var x=new IDVariant();var H=new IDVariant();var u=new IDVariant(ac);try{U.BeforeSave(x,H,u)}catch(aa){if(MDOInit.GetDTT(U)!=null){MDOInit.GetDTT(U).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.SaveToDB",U.GetName(1)+": exception in Before Save event: "+aa)}U.AddDocError(aa.toString());return false}if(H.isTrue()){return false}var K=MDOInit.GetDOBase(U.GetMD(),!U.Deleted());var b=false;if(U.GetMainFrm() instanceof WebEntryPointSrv){b=U.GetMainFrm().SyncObject.IsSynchronizing}var y=new IDVariant();for(var Z=0;Z<K.Count();Z++){var l=K[Z];var A="";var T=0;var m=l.DBCode;if(U.GetDBObj()!=q){m=l.DBSchema+m}var g=Glb.ClassDB(l.GetDBType())==Glb.DBC_ORACLE||l.GetDBType()==Glb.DBT_DB2400;var W=false;var M=false;var n=false;var ab=false;if((U.Updated()||U.Inserted()||U.Deleted())&&!(U.Deleted()&&U.Inserted())){if(x.isFalse()&&((ac==1&&U.Inserted()&&!U.Deleted())||(ac==2&&!U.Deleted()&&!U.Inserted())||(ac==3&&U.Deleted()&&!U.Inserted()))){if(U.GetMainFrm() instanceof WebEntryPointSrv){var N=U.GetMainFrm();if((l.Services&MDOInit.SERV_USERINFO)!=0&&!b){if(U.Inserted()){var Y=U.GetPropertyIndex("DO_CREAUSER",false,true);var o=U.GetPropertyIndex("DO_CREATIME",false,true);var E=U.GetPropertyIndex("DO_AUTLEVEL",false,true);if(Y>0){U.SetPropDirect(Y,N.UserName())}if(o>0){U.SetPropDirect(o,IDL.Now())}if(E>0){U.SetPropDirect(E,new IDVariant(N.getRolObj().glbAutLevel))}}var R=U.GetPropertyIndex("DO_LASTUSER",false,true);var f=U.GetPropertyIndex("DO_LASTTIME",false,true);if(R>0){U.ChangePropDirect(R,N.UserName(),true)}if(f>0){U.ChangePropDirect(f,IDL.Now(),true)}}}for(var X=1;X<=l.GetNumProp();X++){var F=l.GetProp(X);if(MDOInit.UseRecord(F)){if(F.RecordIdxProp==0){F.RecordIdxProp=U.GetPropertyIndex(F.TrFormat,false,false,true,false)}if(F.RecordIdxProp>0){U.ChangePropDirect(F.RecordIdxProp,Glb.GetTI(U.GetPropByIndex(F.RecordIdxProp),U.GetPropByIndex(X),F.Transformation,F.TrFormat,F.TrOffset,F.MaxLength),true)}}}var j="";if(U.Deleted()){j+="delete from "+m}else{if(U.Inserted()){j+="insert into "+m;var V=" (";for(var X=1;X<=l.GetNumProp();X++){var F=l.GetProp(X);if(F.DBCode!=null&&F.DBCode.length>0&&!MDOInit.UseRecord(F)){if(F.Counter&&X>l.BaseProps){if(IDL.IsNull(U.GetPropByIndex(X))||!b){ab=true}if(Glb.ClassDB(l.GetDBType())==Glb.DBC_SQLSRV&&!ab){n=true}T=X}if(X!=T||!ab||g){var L;if(X>l.BaseProps){L=F.DBCode}else{L=l.GetFieldConversion(X)}if(L!=null){if(F.DataType==Glb.DT_DOC_OLE){M|=(U.GetPropByIndex(X).Type!=IDVariant.NULL)}else{if((X!=T||!ab)&&U.GetPropByIndex(X).Type==IDVariant.NULL&&F.Nullable&&!F.HasDefault){continue}j+=V+L;V=", "}}}else{if(X<=l.BaseProps){if(F.PK){j+=V+l.GetFieldConversion(X);V=", "}}}}}j+=") values";V=" (";for(var X=1;X<=l.GetNumProp();X++){var J=X>l.BaseProps;if(!J){J=l.GetFieldConversion(X)!=null}if(J){var F=l.GetProp(X);if(F.DBCode!=null&&F.DBCode.length>0&&!MDOInit.UseRecord(F)){if(F.DataType!=Glb.DT_DOC_OLE){if(X!=T||!ab){if(U.GetPropByIndex(X).Type==IDVariant.NULL&&F.Nullable&&!F.HasDefault){continue}var B=Glb.GetTI(new IDVariant(),U.GetPropByIndex(X),F.Transformation,F.TrFormat,F.MaxLength,F.TrOffset);if(B.Type!=IDVariant.NULL&&(F.DataType==Glb.DT_NUM_FIXED||F.DataType==Glb.DT_NUM_CURRENCY)){B=IDL.Round(B,new IDVariant(F.vScale))}if(F.ExtPropIdx>0&&B.Type!=IDVariant.NULL){B.changeType(IDVariant.STRING)}j+=V+Glb.ToSql(B,l.GetDBType(),q,F.IsUnicode);V=", "}else{if(g){if(Glb.ClassDB(l.GetDBType())==Glb.DBC_ORACLE){j+=V+l.SequenceCode+".nextval"}if(l.GetDBType()==Glb.DBT_DB2400){j+=V+"ZZ_NEXT('"+m.toUpperCase()+"')"}V=", "}else{if(X<=l.BaseProps){if(F.PK){j+=V+Glb.ToSql(y,l.GetDBType(),q,F.IsUnicode);V=", "}}}}}}}}j+=")"}else{if(U.Updated()){j+="update "+m;var V=" set ";W=true;for(var X=l.BaseProps+1;X<=l.GetNumProp();X++){var F=l.GetProp(X);if(F.DBCode!=null&&F.DBCode.length>0&&!MDOInit.UseRecord(F)){var B=U.GetPropByIndex(X);var r=U.GetPropOrigValue(X);if(B.Type!=IDVariant.NULL&&(F.DataType==Glb.DT_NUM_FIXED||F.DataType==Glb.DT_NUM_CURRENCY)){B=IDL.Round(B,new IDVariant(F.vScale))}if(!B.equals(r)){var L;if(X>l.BaseProps){L=F.DBCode}else{L=l.GetFieldConversion(X)}if(L!=null){if(F.DataType==Glb.DT_DOC_OLE){M=true}else{B=Glb.GetTI(new IDVariant(),B,F.Transformation,F.TrFormat,F.MaxLength,F.TrOffset);if(F.ExtPropIdx>0&&B.Type!=IDVariant.NULL){B.changeType(IDVariant.STRING)}j+=V+L+"="+Glb.ToSql(B,l.GetDBType(),q,F.IsUnicode);V=", ";W=false}}}}}}}}if((U.Deleted()||U.Updated())&&!U.Inserted()){var V=" where ";for(var X=1;X<=l.GetNumProp();X++){var F=l.GetProp(X);if(F.PK&&F.DBCode!=null&&F.DBCode.length>0&&!MDOInit.UseRecord(F)){var L;if(X>l.BaseProps){L=MDOInit.GetTIExpr("",F,true,l.GetDBType())}else{L=l.GetFieldConversion(X)}if(L!=null){var r=U.GetPropOrigValue(X);if(r.Type==IDVariant.NULL){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+l.ObjTag+" PK not defined")}A+=V+L+"="+Glb.ToSql(r,l.GetDBType(),q,F.IsUnicode);V=" and "}}}j+=A}if(q!=null&&l.DBCode!=null){if(!W){var Q=0;switch(ac){case 1:Q=MDOInit.QRY_INSERT;break;case 2:Q=MDOInit.QRY_UPDATE;break;case 3:Q=MDOInit.QRY_DELETE;break}try{try{U.OnSQLQuery(new IDVariant(j),new IDVariant(Q),new IDVariant());if(MDOInit.GetDTT(U)!=null){MDOInit.GetDTT(U).AddQuery("DO.SaveToDB",U.GetName(1)+": "+(ac==1?"Inserting":(ac==2?"Updating":"Deleting")),"DO.SaveToDB",DTTEngine.STMT_QRY_UPDATE,j)}if(n){q.Execute("set identity_insert "+m+" on")}q.Execute(j);U.AfterSQLQuery(new IDVariant(j),new IDVariant(Q),null,new IDVariant())}catch(S){if((l.Services&MDOInit.SERV_LDELETE)!=0&&U.Deleted()){U.AfterSQLQuery(new IDVariant(j),new IDVariant(Q),null,new IDVariant(S.toString()));var O=U.GetPropertyIndex("DO_LDELETE",false,true);if(O>0){var a=l.GetProp(O).DBCode;j="update "+m+" set "+a+" = 'S' "+A;if(MDOInit.GetDTT(U)!=null){MDOInit.GetDTT(U).AddMsg(DTTEngine.DTTMSG_INFO,"",203,"DO.SaveToDB",U.GetName(1)+": logically deleting")}if(MDOInit.GetDTT(U)!=null){MDOInit.GetDTT(U).AddMsgToken("","SQL",j)}U.OnSQLQuery(new IDVariant(j),new IDVariant(MDOInit.QRY_DELETE),new IDVariant());q.Execute(j);U.AfterSQLQuery(new IDVariant(j),new IDVariant(MDOInit.QRY_DELETE),null,new IDVariant())}}else{throw S}}if(MDOInit.GetDTT(U)!=null){MDOInit.GetDTT(U).EndQuery("DO.SaveToDB")}if(T>l.BaseProps){var ae;var P="";if(Glb.ClassDB(l.GetDBType())==Glb.DBC_ORACLE){ae=l.SequenceCode}else{ae=m;P=l.GetProp(T).DBCode}if(ab){y=Glb.GetLIV(q,l.GetDBType(),ae,P);U.SetPropByIndex(T,y);U.ReconnectChildren(9999)}else{if(Glb.ClassDB(l.GetDBType())==Glb.DBC_ORACLE){q.Execute("drop sequence "+l.SequenceCode);q.Execute("create sequence "+l.SequenceCode+" start with "+(U.GetPropByIndex(T).intValue()+1)+" nocache")}else{if(l.GetDBType()==Glb.DBT_DB2400){y=Glb.GetLIV(q,l.GetDBType(),m,l.GetProp(T).DBCode);if(!y.equals(U.GetPropByIndex(T))){q.Execute("update ZZ_SEQUENCE set ZZ_VAL = "+U.GetPropByIndex(T).intValue()+" where ZZ_SEQ = '"+m+"'")}}else{if(l.GetDBType()==Glb.DBT_DB2UDB){q.Execute("alter table "+m+" alter column "+l.GetProp(T).DBCode+" restart with "+(U.GetPropByIndex(T).intValue()+1))}else{if(Glb.ClassDB(l.GetDBType())==Glb.DBC_POSTGRES){q.Execute("alter sequence "+l.SequenceCode+" restart with "+(U.GetPropByIndex(T).intValue()+1))}}}}}}if(U.Deleted()&&(l.Services&MDOInit.SERV_ATTACH)!=0&&ac==3){MDOInit.DeleteAttachments(U,9999)}if(U.Deleted()&&(l.Services&MDOInit.SERV_COMMENT)!=0&&ac==3){MDOInit.DeleteComments(U,9999)}}catch(aa){U.AfterSQLQuery(new IDVariant(j),new IDVariant(Q),null,new IDVariant(aa.toString()));if(MDOInit.GetDTT(U)!=null){MDOInit.GetDTT(U).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.SaveToDB",U.GetName(1)+": DB error while saving document: "+aa)}if(!b){MDOInit.HandleSaveException(U,ac,aa,q)}else{U.AddDocError(aa.ToString())}return false}finally{if(n){q.Execute("set identity_insert "+m+" off")}}}if(M){var I="";var h=new HashTableSrv();A="";for(var X=1;X<=l.GetNumProp();X++){var F=l.GetProp(X);if(F.DBCode!=null&&F.DBCode.length>0&&!MDOInit.UseRecord(F)){var L;if(X>l.BaseProps){L=MDOInit.GetTIExpr("",F,true,l.GetDBType())}else{L=l.GetFieldConversion(X)}if(L!=null){if(F.PK||F.DataType==Glb.DT_DOC_OLE){I+=I.length==0?"select ":", ";I+=L;if(F.PK){var D;if(U.Inserted()){D=U.GetPropByIndex(X)}else{D=U.GetPropOrigValue(X)}if(D.Type==IDVariant.NULL){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+l.ObjTag+" PK not defined")}A+=A.length==0?" where ":" and ";A+=L+"="+Glb.ToSql(D,l.GetDBType(),q,F.IsUnicode)}else{h[X]=L}}}}}try{var v=q.OpenRS(I+" from "+m+A);v.setUpdatable();v.MoveFirst();var C=h.keys();for(var ad=0;ad<C.length;ad++){var G=C[ad];var d=h[G];if(d.substring(0,1)=='"'){d=d.substring(1,d.length-1)}if(U.GetPropByIndex(G).Type==IDVariant.NULL){v.Set(d,U.GetPropByIndex(G))}else{v.updateBinaryStream(v.findColumn(d),U.GetPropByIndex(G))}}v.setTableName(q.ApplySubstitutions(m));v.updateRow();v.acceptChanges(q)}catch(aa){throw aa}}}else{if(this.GetDTT(U)!=null){this.GetDTT(U).AddMsg(DTTEngine.DTTMSG_INFO,"",210,"DO.SaveToDB",U.GetName(1)+" ("+l.ObjTag+"): not saved because the class is not linked to a DB table")}}}}}return true};MDOInit.HandleSaveException=function(m,h,k,c){var b=m.GetMD();while(b!=null){for(var j=0;j<b.QueryList.Count();j++){var a=b.QueryList[j];if(!a.CanByApplied(m,h)){continue}var d=a.GetSQL(m,c);if(d==""){continue}if(MDOInit.GetDTT(m)!=null){MDOInit.GetDTT(m).AddQuery("DO.HandleSaveException",m.GetName(1)+": handling save exception","DO.LoadFromDB",DTTEngine.STMT_QRY_SELECT,d)}try{var l=c.OpenRS(d);if(MDOInit.GetDTT(m)!=null){MDOInit.GetDTT(m).AddDBDataSource(l,d)}if(MDOInit.GetDTT(m)!=null){MDOInit.GetDTT(m).EndQuery("DO.HandleSaveException")}if((l.EOF()&&a.NeedRecord)||(!l.EOF()&&!a.NeedRecord)){a.ApplyTo(m,k,d);return}}catch(g){if(MDOInit.GetDTT(m)!=null){MDOInit.GetDTT(m).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.HandleSaveException",m.GetName(1)+": DB error while checking document: "+g)}}}b=b.BaseMD}var f=new DOMDQuery();f.OrgEx=k;m.LastFailedCheck=f;m.AddDocError(k.toString())};MDOInit.SaveToXML=function(U,B,ad,u,P,f,Y,b,M,n){if(Y==undefined){Y=false}if(b==undefined){b=XMLDoc.FT_XML}if(M==undefined){M=false}if(n==undefined){n=false}var l;var S;var A=false;if(P==null){A=true;P=new ProXMLDocument();MDOInit.ReconnectFK(U,9999)}var r=U.GetMD();var h=U.GetServiceConnector();var D=new IDVariant(h==null?r.ObjTag:r.IOTCode);if(Y&&r.RemoteType!=null&&r.RemoteType.indexOf(".")!=-1){D=new IDVariant(r.RemoteType.substr(r.RemoteType.indexOf(".")+1))}var G=new IDVariant(D);U.OnSaveXMLObj(D,G);if(G.stringValue().length>0){if(b==XMLDoc.FT_JSON&&A){l=P.createElement(XMLDoc.ROOT_JSON)}else{l=P.createElement(G.stringValue())}if(A){P.appendChild(l)}else{f.appendChild(l)}if(h==null){var K={};K.do_updated=U.Updated();K.do_inserted=U.Inserted();K.do_deleted=U.Deleted();K.do_loaded=U.Loaded();var I=Object.keys(K);for(var X=0;X<I.length;X++){var V=I[X];D=new IDVariant(V);G=new IDVariant(D);var O=new IDVariant();var Q=new IDVariant(M?(K[V]?"-1":"0"):K[V]+"");U.OnSaveXMLProp(D,G,Q,O);if(G.stringValue().length>0){l.setAttribute(G.stringValue(),Q.stringValue())}}}else{if(h.ServiceType==IOTConnector.SERTYPE_ODATA){if(h.ODataVersion<=2){var q=P.createElement("__metadata");q.setAttribute("type",r.ODataNamespace+"."+r.IOTCode);l.appendChild(q)}else{if(h.ODataVersion==3){l.setAttribute("odata.type",r.ODataNamespace+"."+r.IOTCode)}else{if(h.ODataVersion==4){l.setAttribute("@odata.type",r.ODataNamespace+"."+r.IOTCode)}}}}}var H=true;var E=new HashTableSrv();for(var X=1;X<=r.GetNumProp();X++){var J=r.GetProp(X);var Q=new IDVariant(U.GetPropByIndex(X));if(Q.Type!=IDVariant.NULL||n||h!=null){if(h!=null&&(h.ServiceType==IOTConnector.SERTYPE_SALESFORCE||h.ServiceType==IOTConnector.SERTYPE_ODATA)&&U.Updated()&&U.GetPropOrigValue(X).Equals(U.GetPropDirect(X))){continue}D=new IDVariant(h==null?J.ObjTag:J.IOTCode);G=new IDVariant(D);var O=new IDVariant();U.OnSaveXMLProp(D,G,Q,O);if(G.stringValue().length>0){if(M){Q=new IDVariant(MDOInit.VariantToString(U.GetMainFrm(),Q,J))}else{if(h!=null){Q=new IDVariant(h.VariantToString(Q,J))}}if(O.isTrue()){S=P.createElement(G.stringValue());S.appendChild(P.createTextNode(Q.stringValue()));l.appendChild(S)}else{if(h!=null&&h.ServiceType==IOTConnector.SERTYPE_ODATA&&J.IOTCode.indexOf("/")!=-1){if(J.ODataType.equals("GeographyPoint")){if(J.IOTCode.endsWith("/Longitude")){var m=U.GetPropByIndex(r.GetIOTCodeIndex(J.IOTCode.Replace("/Longitude","/Latitude")));var y=P.createElement("Location");l.appendChild(y);if(Q.Type!=IDVariant.NULL&&m.Type!=IDVariant.NULL){y.setAttribute("type","Point");var g=P.createElement("coordinates");y.appendChild(g);var ab=P.createTextNode(Q.stringValue());g.appendChild(ab);ab=P.createTextNode(U.GetPropByIndex(r.GetIOTCodeIndex(J.IOTCode.Replace("/Longitude","/Latitude"))).stringValue());g.appendChild(ab);var o=P.createElement("crs");y.appendChild(o);o.setAttribute("type","name");var a=P.createElement("properties");o.appendChild(a);a.setAttribute("name","EPSG:4326")}}}else{if(!J.ODataType.equals("link")){var z=J.IOTCode.split("/");var T=l;for(var W=0;W<z.length-1;W++){var ae="";for(var V=0;V<=W;V++){ae+=(V==0?"":"/")+z[V]}var C=E[ae];if(C==null){C=P.createElement(z[W]);E[ae]=C;T.appendChild(C)}T=C}T.setAttribute(z[z.length-1],Q.stringValue())}}}else{if(b==XMLDoc.FT_JSON&&Glb.ClassDT(J.DataType)==Glb.DTC_CHAR&&ProXMLDocument.isJSONnumber(Q.stringValue())){Q=new IDVariant("$asString$"+Q.stringValue())}l.setAttribute(G.stringValue(),Q.stringValue())}}if(Y&&H){var t=new IDVariant(Q);MDOInit.ConvertVariant(t,J);if(!t.equals(Q)){H=false}}}}if(h==null){Q=new IDVariant(U.GetPropOrigValue(X));if(!Q.equals(U.GetPropDirect(X))){D=new IDVariant(J.ObjTag+"_O");G=new IDVariant(D);var O=new IDVariant();U.OnSaveXMLProp(D,G,Q,O);if(G.stringValue().length>0){if(M){Q=new IDVariant(MDOInit.VariantToString(U.GetMainFrm(),Q,J))}if(O.isTrue()){S=P.createElement(G.stringValue());S.appendChild(P.createTextNode(Q.stringValue()));l.appendChild(S)}else{if(b==XMLDoc.FT_JSON&&Glb.ClassDT(J.DataType)==Glb.DTC_CHAR&&ProXMLDocument.isJSONnumber(Q.stringValue())){Q=new IDVariant("$asString$"+Q.stringValue())}l.setAttribute(G.stringValue(),Q.stringValue())}}}}}if(!H){l.SetAttribute("do_conv","0")}var ac;var N=new ArrayList();do{ac=false;D=new IDVariant();G=new IDVariant();var O=new IDVariant();var Q=new IDVariant();U.OnSaveXMLProp(D,G,Q,O);if(G.stringValue().length>0){ac=true;for(var F=0;F<N.Count();F++){var R=N[F];if(R.equals(G.stringValue())){ac=false;break}}if(ac){N.Add(G.stringValue());if(O.isTrue()){S=P.createElement(G.stringValue());S.appendChild(P.createTextNode(Q.stringValue()));l.appendChild(S)}else{l.setAttribute(G.stringValue(),Q.stringValue())}}}}while(ac);if(U.HasErrors()){var Z=new ArrayList();U.GetDocErrors(Z);if(Z.Count()>0){S=P.createElement("Doc_Errors");l.appendChild(S);for(var X=0;X<Z.Count();X++){S.setAttribute("Err"+(X+1).toString(),Z[X])}}S=null;for(var X=1;X<=r.GetNumProp();X++){var J=r.GetProp(X);var L=U.GetPropError(J.Index);if(L!=null){if(S==null){S=P.createElement("Prop_Errors");l.appendChild(S)}S.setAttribute("Err"+X.toString(),L)}}}if(u>0){for(var X=1;X<=r.GetNumColl();X++){var ab=U.GetCollByIndex(X).GetCollection();for(var F=0;F<ab.Count();F++){var aa=ab[F];MDOInit.SaveToXML(aa,B,ad,u-1,P,l,Y,b,M,n);if(b==XMLDoc.FT_JSON&&l.childNodes.length>0){l.childNodes[l.childNodes.length-1].setAttribute(XMLDoc.JSON_ISARRAYCHILD,"1")}}if(ab.Count()==0&&n&&b==XMLDoc.FT_JSON){l.setAttribute(r.GetColl(X).ChildrenName,XMLDoc.EMPTY_ARRAY)}}}}if(A){if(B){var x=U.GetMainFrm();if((!ad||ad.length==0)&&x&&x instanceof WebEntryPointSrv){while(true){ad=x.TempPath()+"/"+r.ObjTag+"_"+Math.floor(Math.random()*2147483647)+(b==XMLDoc.FT_XML?".xml":".json");if(!VBFiles.FileExists(new IDVariant(ad))){break}}}P.Save(ad,b);return ad}else{return P.saveToString(b)}}return null};MDOInit.SaveCollectionToXML=function(n,f,e,b,k,l,g,c){if(l==undefined){l=XMLDoc.FT_XML}if(g==undefined){g=false}if(c==undefined){c=false}var m=new ProXMLDocument();var a;if(l==XMLDoc.FT_JSON){a=m.createElement(XMLDoc.ROOT_JSON)}else{a=m.createElement("IDCollection")}a.setAttribute("do_loaded",(g?(f.Loaded()?"-1":"0"):f.Loaded()+""));m.appendChild(a);f.MoveFirst();while(!f.IsEof()){var j=f.GetAt();MDOInit.SaveToXML(j,false,"",k,m,a,false,l,g,c);if(l==XMLDoc.FT_JSON&&a.childNodes.length>0){a.childNodes[a.childNodes.length-1].setAttribute(XMLDoc.JSON_ISARRAYCHILD,"1")}f.MoveNext()}if(e){var h=(n&&n.GetMainFrm()?n.GetMainFrm():f.MainFrm());if((!b||b.length==0)&&h&&h instanceof WebEntryPointSrv){while(true){b=h.TempPath()+"/IDCollection_"+Math.floor(Math.random()*2147483647)+(l==XMLDoc.FT_XML?".xml":".json");if(!VBFiles.FileExists(new IDVariant(b))){break}}}m.Save(b,l);return b}else{return m.saveToString(l)}};MDOInit.LoadFromXML=function(j,l,k,g,c){if(g==undefined){g=XMLDoc.FT_XML}if(c==undefined){c=false}try{var h=new ProXMLDocument();j.StopEvents();j.Clear();if(k){h.Load(l,g)}else{h.loadFromString(l,g)}var f=true;if(h.childNodes.length>0){for(var b=0;b<h.childNodes.length;b++){var a=h.childNodes[b];if(a instanceof ProXMLNode){break}}f=MDOInit.LoadXMLNode(j,a,true,c)}return f}catch(d){return false}finally{j.StartEvents()}};MDOInit.LoadXMLNode=function(l,k,J,G,g){if(G==undefined){G=false}if(g==undefined){g=""}var E=l.GetMD();var b=l.GetServiceConnector();var N=(b==null?E.ObjTag:E.IOTCode);var a=k.nodeName;if(a.equals(XMLDoc.ROOT_JSON)){a=N}else{if(k.getAttribute(XMLDoc.JSON_IGNORENAME)){k.removeAttribute(XMLDoc.JSON_IGNORENAME);a=N}else{if(g.length>0){a=N}}}var t=new IDVariant(a);var u;if(N.equals(a)&&J){u=new IDVariant(t)}else{u=new IDVariant()}if(u.stringValue().length==0){for(var D=1;D<=E.GetNumColl();D++){if(E.GetColl(D).ChildrenName.equals(a)){u=new IDVariant(t);break}}}var y=new IDVariant();if(g.length==0){l.OnLoadXMLObj(u,t,y);if(y.isTrue()){return false}}var s=true;var q=u.stringValue();if(q.length>0){if(q.equals(N)&&J){if(b==null){var A=k.getAttribute("do_updated");if(A!=""){l.set_Updated(G?A=="-1":A.toLowerCase()=="true")}var f=k.getAttribute("do_inserted");if(f!=""){l.set_Inserted(G?f=="-1":f.toLowerCase()=="true")}var n=k.getAttribute("do_deleted");if(n!=""){l.set_Deleted(G?n=="-1":n.toLowerCase()=="true")}var m=k.getAttribute("do_loaded");if(m!=""){l.set_Loaded(G?m=="-1":m.toLowerCase()=="true")}var d=k.getAttribute("do_conv");if(d!=""&&d=="0"){s=false}}for(var D=0;D<k.attributes.length;D++){var h=k.attributes[D];a=h.nodeName;q="";if(g.length>0){a=g+"/"+a}if(h.nodeName.endsWith("_O")){a=a.substr(0,a.length-2)}for(var B=1;B<=E.GetNumProp();B++){var M=E.GetProp(B);if((b==null?M.ObjTag:M.IOTCode).equals(a)){q=a;break}}var o=new IDVariant(h.nodeValue);y=new IDVariant();u=new IDVariant(q);t=new IDVariant(a);l.OnLoadXMLProp(u,t,o,new IDVariant(),y);if(y.isTrue()){return false}q=u.stringValue();for(var B=1;B<=E.GetNumProp();B++){var M=E.GetProp(B);if((b==null?M.ObjTag:M.IOTCode).equals(q)){if(G){o=MDOInit.StringToVariant(l.GetMainFrm(),o.stringValue(),M)}else{if(b!=null){o=b.StringToVariant(o.stringValue(),M)}}if(s){MDOInit.ConvertVariant(o,M)}if(o.Type==IDVariant.NULL){if(!h.nodeName.endsWith("_O")&&k.attributes[q+"_O"]==null){l.SetPropOrigValue(B,new IDVariant(""))}}if(h.nodeName.endsWith("_O")){l.SetPropOrigValue(B,o)}else{l.SetPropDirect(B,o)}break}}}if(b!=null&&b.ServiceType==IOTConnector.SERTYPE_ODATA&&g.length>0){if(k.getAttribute("type").equals("Point")){for(var D=1;D<=E.GetNumProp();D++){var M=E.GetProp(D);if(M.ODataType.equals("GeographyPoint")){var C=new ArrayList();for(var B=0;B<k.childNodes.length;B++){var I=k.childNodes[B];if(I.nodeName.equals("coordinates")){C.Add(I.childNodes[0].data)}}var o=null;if(M.IOTCode.equals(g+"/Longitude")){o=new IDVariant(C[0])}else{if(M.IOTCode.equals(g+"/Latitude")){o=new IDVariant(C[1])}}l.SetPropDirect(D,o)}}return true}}for(var D=0;D<k.childNodes.length;D++){var x=false;var z=k.childNodes[D];if(z.childNodes.length>0){if(z.childNodes[0].nodeType==3||z.childNodes[0].nodeType==4){x=true;a=z.nodeName;q="";for(var B=1;B<=E.GetNumProp();B++){var M=E.GetProp(B);if((b==null?M.ObjTag:M.IOTCode).equals(a)){q=a;break}}var o=new IDVariant(z.childNodes[0].data);y=new IDVariant();u=new IDVariant(q);t=new IDVariant(a);l.OnLoadXMLProp(u,t,o,new IDVariant(),y);if(y.isTrue()){return false}q=u.stringValue();for(var B=1;B<=E.GetNumProp();B++){var M=E.GetProp(B);if((b==null?M.ObjTag:M.IOTCode).equals(q)){if(G){o=MDOInit.StringToVariant(l.GetMainFrm(),o.stringValue(),M);if(o.Type==IDVariant.NULL){l.SetPropOrigValue(B,new IDVariant(""))}}else{if(b!=null){o=b.StringToVariant(o.stringValue(),M)}}if(s){MDOInit.ConvertVariant(o,M)}l.SetPropDirect(B,o);break}}}}if(!x){var L=false;if(z.nodeName=="Doc_Errors"){for(var F=0;F<z.attributes.length;F++){l.AddDocError(z.attributes[F].nodeValue)}L=true}if(!L&&z.nodeName=="Prop_Errors"){for(var F=0;F<z.attributes.length;F++){l.SetPropError(parseInt(Attr.nodeName.substr(3),10),z.attributes[F].nodeValue)}L=true}if(!L&&b!=null&&b.ServiceType==IOTConnector.SERTYPE_ODATA){L=MDOInit.LoadXMLNode(l,z,J,G,(g.length>0?g+"/":"")+z.nodeName)}if(!L){var r=MDOInit.LoadXMLNode(l,z,false,G);if(!r){return false}}}}for(var D=1;D<=E.GetNumColl();D++){l.GetCollByIndex(D).EnableSort()}}else{for(var D=1;D<=E.GetNumColl();D++){if(E.GetColl(D).ChildrenName.equals(q)){var K=l.CreateDocument(q);if(K==null){K=l.GetMainFrm().GetApplication().CreateDocument(q)}try{var I=l.GetCollByIndex(D);I.Add(K);I.set_Loaded(true)}catch(H){}var r=MDOInit.LoadXMLNode(K,k,true,G);if(!r){return false}break}}}}return true};MDOInit.LoadCollectionFromXML=function(g,b,l,k,h,d){if(h==undefined){h=XMLDoc.FT_XML}if(d==undefined){d=false}try{var j=new ProXMLDocument();if(k){j.Load(l,h)}else{j.loadFromString(l,h)}if(j.childNodes.length>0){for(var c=0;c<j.childNodes.length;c++){var a=j.childNodes[c];if(a instanceof ProXMLNode){break}}return MDOInit.LoadCollXMLNode(g,b,a,d)}return true}catch(f){return false}};MDOInit.LoadCollXMLNode=function(h,b,a,g){if(g==undefined){g=false}var l=a.nodeName;if(l.equals(XMLDoc.ROOT_JSON)){l="IDCollection"}else{if(a.getAttribute(XMLDoc.JSON_IGNORENAME)){a.removeAttribute(XMLDoc.JSON_IGNORENAME);l="IDCollection"}}if(l.equals("IDCollection")){var e=a.getAttribute("do_loaded");if(e!=""){b.set_Loaded(g?e=="-1":e.toLowerCase()=="true")}for(var f=0;f<a.childNodes.length;f++){var k=a.childNodes[f];var j=h.CreateDocument(k.nodeName);MDOInit.LoadXMLNode(j,k,true,g);b.Add(j)}return true}else{return false}};MDOInit.ConvertVariant=function(a,b){if(a.Type==IDVariant.NULL){return true}switch(b.DataType){case Glb.DT_NUM_INTEGER:a.changeType(IDVariant.INTEGER);break;case Glb.DT_NUM_FLOAT:a.changeType(IDVariant.FLOAT);break;case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:a.changeType(IDVariant.DECIMAL);break;case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:case Glb.DT_DOC_TEXT:a.changeType(IDVariant.STRING);break;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:a.changeType(IDVariant.DATETIME);break;case Glb.DT_BOOLEAN:a.changeType(IDVariant.INTEGER);break;case Glb.DT_DOC_OLE:a.changeType(IDVariant.BLOB);break}return a.Type!=IDVariant.NULL};MDOInit.VariantToString=function(a,b,c){switch(b.Type){case 0:return XMLDoc.NULL_VALUE;case 3:if(c!=null&&c.DataType==Glb.DT_DATE){return IDL.FormatDate(b.dateValue(),"yyyy-mm-dd")}if(c!=null&&c.DataType==Glb.DT_TIME){return IDL.FormatDate(b.dateValue(),"hh:mm:ss")}return IDL.FormatDate(b.dateValue(),"yyyy-mm-dd hh:nn:ss");case 5:if(c!=null&&"DO_ID".equals(c.Concept)){return GUID.DocID2GUID(b.stringValue())}break;case 6:return Glb.SaveBlob(a,b,new IDVariant(),new IDVariant(),true).stringValue()}return b.stringValue()};MDOInit.StringToVariant=function(b,c,d,f){if(f==undefined){f=false}if(f&&(c.equals(".")||c.equals("!"))){return new IDVariant(c)}if(c.equals(SyncService.NULL_Marker)){return new IDVariant()}else{if(d.DataType==Glb.DT_DOC_OLE){return c.length>0?new IDVariant(Glb.LoadBlob(b,c)):new IDVariant()}else{if("DO_ID".equals(d.Concept)&&c.length>0){if(f){var a=c.split(";");for(var e=0;e<a.length();e++){a[e]=GUID.GUID2DocID(a[e])}return new IDVariant(a.join(" "))}else{return new IDVariant(GUID.GUID2DocID(c))}}else{return new IDVariant(c)}}}};MDOInit.ReconnectFK=function(n,m){var e=n.GetMD();for(var h=1;h<=e.GetNumColl();h++){var b=e.GetColl(h);var l=n.GetCollByIndex(h);var a=l.GetCollection();for(var g=0;g<a.Count();g++){var k=a[g];for(var f=0;f<b.FKColl.Count();f++){k.SetPropByIndex(k.GetPropIndex(b.FKColl[f]),n.GetPropByIndex(n.GetPropIndex(b.PKColl[f])))}if(m>1){MDOInit.ReconnectFK(k,m-1)}}}};MDOInit.ToString=function(a){return a.GetName(3)};MDOInit.LoadLookupValues=function(o,b){var a=o.GetLookupCache();var c=o.GetMD();var j=false;for(var g=1;g<=c.GetNumProp();g++){if(c.GetProp(g).PK&&o.GetPropByIndex(g).Type!=IDVariant.NULL){j=true}}if(a!=null){var h=null;if(j){h=a[o.GetDNA().stringValue()]}else{var r=a.keys();for(var f=0;f<r.length;f++){var l=a[r[f]];for(var g=1;g<=c.GetNumProp();g++){var n=o.GetPropByIndex(g);if(n.Type==IDVariant.NULL){continue}if(n.equals(l.GetPropByIndex(g))){h=l}else{h=null;break}}}}if(h!=null&&(h.Loaded()||b)){o.CopyFrom(h);o.SetOriginal();o.set_Loaded(h.Loaded());return}}var m=new IDVariant();var q=new IDVariant();o.BeforeLookup(m,q);if(q.isTrue()){return}if(m.isFalse()){try{o.LoadFromDB(0,true)}catch(k){}}o.AfterLookup();if(a!=null&&(o.Loaded()||b)){var l=o.GetCopy();l.set_Loaded(o.Loaded());a[l.GetDNA().stringValue()]=l}};MDOInit.CopyFrom=function(u,c,t,r,o){var g=u.GetMD();for(var k=1;k<=g.GetNumProp();k++){u.ChangePropDirect(k,new IDVariant(c.GetPropByIndex(k)),true)}if(r||o){for(var k=1;k<=g.GetNumOtherProp();k++){var b=g.GetOtherProp(k);if(!r&&b.Private){continue}if(!o&&b.DataType==Glb.DT_OBJECT){continue}var n=false;if(o&&b.DataType==Glb.DT_OBJECT&&"IDCollection"==b.DataTypeName){for(var h=1;h<=g.GetNumColl()&&!n;h++){n=(c.GetOtherPropByIndex(k)==c.GetCollByIndex(h))}}if(!n){u.SetOtherPropByIndex(k,c.GetOtherPropByIndex(k))}}}u.set_Updated(c.Updated());u.set_Inserted(c.Inserted());u.set_Deleted(c.Deleted());if(t>0){for(var k=1;k<=g.GetNumColl();k++){var l=c.GetCollByIndex(k);var f=u.GetCollByIndex(k);f.Clear();var a=l.GetCollection();for(var j=0;j<a.Count();j++){var q=a[j];var s=u.CreateDocument(q.GetMD().ObjTag);try{f.Add(s)}catch(m){}s.CopyFrom(q,t-1,r,o)}}}};MDOInit.GetCopy=function(a){var b=a.GetMD();var c=a.CreateDocument(b.ObjTag);c.SetMainFrm(a.GetMainFrm(),a.GetIMDB());MDOInit.CopyFrom(c,a,9999,false,false);return c};MDOInit.LoadValueSource=function(f,e,g){var z=f.GetMD();var b=f.GetServiceConnector();if(b!=null){b.LoadValueSource(f,e,g);return}e.PrepareForValueSource();var t=new IDVariant();f.OnGetValueSource(e,t);if(t.isTrue()){if(!e.EOF()){e.MoveFirst()}return}var a=MDOInit.GetDOBase(z);var D="select ";var r=z.DBObj;if(r==null){r=f.GetDBObj()}for(var y=1;y<=z.GetNumProp();y++){var E=z.GetProp(y);if(E.PK){D+=MDOInit.GetPropExpr(E,f,a);if(String.compare(E.DBCode,E.ObjTag,true)!=0){D+=" as "+E.ObjTag}break}}for(var y=1;y<=z.GetNumProp();y++){var E=z.GetProp(y);var o=false;if(g!=null){for(var C=0;C<g.Count();C++){var u=g[C];if(String.compare(E.ObjTag,u,true)==0){o=true;break}}}else{o=E.DescribeRow}if(o){D+=", ";D+=MDOInit.GetPropExpr(E,f,a);if(String.compare(E.DBCode,E.ObjTag,true)!=0){D+=" as "+E.ObjTag}if(E.DescribeRow&&g==null){break}}}var l=false;var x=" where ";var c="";var A=new ArrayList();var h=new IDVariant();var d=new Array(Glb.SQL_MAXQUERIES);for(var y=0;y<Glb.SQL_MAXQUERIES;y++){d[y]=""}f.GetMasterQuery(d,h,A);if(d[0].length>0){D+=" ";for(var y=Glb.SQL_FROM;y<Glb.SQL_MAXQUERIES;y++){if(y==Glb.SQL_ORDERBY){c=d[y]}else{D+=d[y]}if(y==Glb.SQL_WHERE&&d[y].length>0){l=true;x=" and "}}}else{var B=new IDVariant(D);var F=MDOInit.GetFromList(f.GetMainFrm(),a,B,2);D=B.stringValue();if(F.length>0){D+=x;D+=F;l=true;x=" and "}}for(var y=1;y<=z.GetNumProp();y++){var E=z.GetProp(y);var m=f.GetPropByIndex(y);if(m.Type!=IDVariant.NULL){l=true;D+=x+MDOInit.GetPropExpr(E,f,a)+" = "+Glb.ToSql(m,z.GetDBType(),r,E.IsUnicode);x=" and "}}if(d[0].length==0){var j=MDOInit.HandleServiceFilters(f);if(j.length>0){l=true;D+=x+j}}var n=new IDVariant();f.OnSQLQuery(new IDVariant(D),new IDVariant(MDOInit.QRY_LOADVALUESOURCE),n);if(n.stringValue().length>0){if(!l){D+=" where "}else{D+=" and "}D+=n;D+=" "}if(D.indexOf("order by")==-1){if(c.length>0){D+=c}else{D+=MDOInit.GetNaturalSort(f,"")}}if(r!=null){try{var G=r.OpenRS(D);f.AfterSQLQuery(new IDVariant(D),new IDVariant(MDOInit.QRY_LOADVALUESOURCE),G,new IDVariant());if(!G.EOF()){G.MoveFirst()}e.CopyFrom(G);if(MDOInit.GetDTT(f)!=null){MDOInit.GetDTT(f).AddQuery("DOVS",f.GetName(1)+": loading value source","DO.LoadValueSource",DTTEngine.STMT_QRY_SELECT,D)}if(MDOInit.GetDTT(f)!=null){MDOInit.GetDTT(f).AddDBDataSource(e,D)}if(MDOInit.GetDTT(f)!=null){MDOInit.GetDTT(f).EndQuery("DOVS")}}catch(q){f.AfterSQLQuery(new IDVariant(D),new IDVariant(MDOInit.QRY_LOADVALUESOURCE),null,new IDVariant(q.toString()));if(this.GetDTT(f)!=null){this.GetDTT(f).AddException("","DO.LoadValueSource",f.TypeName()+": Exception while loading a value source",q)}}}};MDOInit.AddValueSourceRow=function(b,a,c){b.AddValueSourceRow(a.Value,c.Value)};MDOInit.GetAutoLookupCode=function(b){var c=b.GetMD();for(var a=1;a<=c.GetNumProp();a++){if(c.GetProp(a).PK){return b.GetPropByIndex(a)}}return new IDVariant()};MDOInit.GetAutoLookupDescription=function(b){var d=b.GetMD();var c=new IDVariant();for(var a=1;a<=d.GetNumProp();a++){if(d.GetProp(a).DescribeRow){if(c.stringValue().length>0){c=IDL.Add(c,new IDVariant(" - "))}c=IDL.Add(c,b.GetPropByIndex(a))}}return c};MDOInit.GetLKE=function(o,q,m,c,k){var b=o.GetMD();var d=o.GetServiceConnector();if(d!=null){return d.GetLKE(o,q,m,c,k)}var e=b.DBObj;var n=new IDVariant();var h=-1;var a=null;do{h++;if(q.IsOpen()){q.Close()}var r=new IDVariant();o.OnGetLKE(q,new IDVariant(h),m,n,r,k);if(q.pQuery!=null){if(o.GetMainFrm() instanceof WebEntryPointSrv){q.pQuery.LkeRSLimitedBySystem=o.GetMainFrm().ParamsObj().PanelLimitOnGetSmartLookup}else{q.pQuery.LkeRSLimitedBySystem=false}}if(r.isTrue()||q.RecordCount()>0){break}if(n.isFalse()){if(e==null){e=o.GetDBObj()}var g=MDOInit.GetLKEQbe(o,h,m,b.GetDBType(),c,e,q.pQuery);if(m.isFalse()&&!g.equals(a)&&g.length>0&&e!=null){if(q.IsOpen()){q.Close()}var l=30;if(o.GetMainFrm() instanceof WebEntryPointSrv){l=o.GetMainFrm().ParamsObj().MaxLookupRows}e.MaxRows=l+1;if(q.pQuery!=null){if(q.pQuery.Parent!=null){for(var f=0;f<q.pQuery.Parent.UFields();f++){if(q.pQuery.Parent.bFields(f).IdxPanel==q.pQuery.Index){e.MaxRows=q.pQuery.Parent.bFields(f).maxLKERows+1;break}}}q.pQuery.LkeRSLimitedBySystem=true}a=g;try{if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddQuery("DOLKE",o.GetName(1)+": Update LKE","Editable Lookup Query",DTTEngine.STMT_QRY_SELECT,g)}var j=e.OpenRS(g);if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddDBDataSource(j,g)}if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).EndQuery("DOLKE")}o.AfterSQLQuery(new IDVariant(g),new IDVariant(MDOInit.QRY_LOADSMARTLOOKUP),j,new IDVariant());if(!j.EOF()){j.MoveFirst()}q.CopyFrom(j)}catch(t){o.AfterSQLQuery(new IDVariant(g.toString()),new IDVariant(MDOInit.QRY_LOADSMARTLOOKUP),null,new IDVariant(t.toString()));if(this.GetDTT(o)!=null){this.GetDTT(o).AddException("","DO.GetLKE",o.TypeName()+": Exception while loading a smart lookup",t)}}if(q.RecordCount()>0){break}}}if(h>100){if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddMsg(DTTEngine.DTTMSG_ERROR,"",169,"DO.GetLKE",o.GetName(1)+": Too many Smart Lookup tries. Did you forget to set Cancel to TRUE?")}break}}while((h<5||n.isTrue())&&m.isFalse());return h};MDOInit.GetLKEQbe=function(N,o,T,P,s,L,z){var l=(z==null||z.Parent.MainFrm.ParamsObj().LKEDOAllProperties?null:z.HeaderColumns);var e=(z==null?null:z.VisibleColumns);var g=N.GetMD();var f="select ";var Q="";var R=0;var I=MDOInit.GetDOBase(g);for(var S=1;S<=g.GetNumProp();S++){var B=g.GetProp(S);if(B.DBCode!=null&&B.DBCode.length>0&&B.DataType!=Glb.DT_DOC_OLE){var a=false;if(l!=null&&!B.PK&&!"DO_CODE".equals(B.Concept)){a=true;var A=l.keys();for(var h=0;h<A.length;h++){var M=A[h];if(String.compare(M,B.ObjTag,true)==0){a=false;break}}}if(a){continue}if(R>0){f+=", "}R++;f+=MDOInit.GetPropExpr(B,N,I);if(String.compare(B.DBCode,B.ObjTag,true)!=0){f+=" as "+B.ObjTag}}}var J="";var q=new ArrayList();var x=new IDVariant();var F=new Array(Glb.SQL_MAXQUERIES);for(var S=0;S<Glb.SQL_MAXQUERIES;S++){F[S]=""}N.GetMasterQuery(F,x,q);if(F[0].length>0){f+=" ";var c=false;for(var S=Glb.SQL_FROM;S<Glb.SQL_MAXQUERIES;S++){if(S==Glb.SQL_ORDERBY){J=F[S]}else{f+=F[S]}if(S==Glb.SQL_WHERE&&F[S].length>0){c=true}}f+=(!c?" where ":" and ")}else{var n=new IDVariant(f);var t=MDOInit.GetFromList(N.GetMainFrm(),I,n,3);f=n.stringValue();f+=" where ";if(t.length>0){f+=t;f+=" and "}}T.set(IDVariant.TRUE);if(s!=null){Q="";for(var G=0;G<s.Count();G++){var r=s[G];var B=g.GetProp(r);var K=N.GetPropByIndex(r).stringValue();if(K.length>0){if(B.DBCode.length==0){return""}var m="";switch(Glb.ClassDT(B.DataType)){case Glb.DTC_CHAR:m=IDL.CSql(new IDVariant(K),IDL.FMT_CHAR,L,B.IsUnicode);break;case Glb.DTC_DATE:var u=IDL.FMT_DAT2;if(Glb.ClassDB(P)==Glb.DBC_ACCESS){u=IDL.FMT_DAT1}else{if(Glb.ClassDB(P)==Glb.DBC_ORACLE||Glb.ClassDB(P)==Glb.DBC_POSTGRES){u=IDL.FMT_DAT3}else{if(Glb.ClassDB(P)==Glb.DBC_SQLITE){u=IDL.FMT_DAT4}else{if(P==Glb.DBT_DB2400&&L.UseAS400Date){u=(B.DataType==Glb.DT_DATETIME?IDL.FMT_DAT6:IDL.FMT_DAT5)}}}}m=IDL.CSql(new IDVariant(K),u,L,B.IsUnicode);break;case Glb.DTC_NUMBER:m=IDL.CSql(new IDVariant(K),IDL.FMT_NUM,L,B.IsUnicode);break}m=MDOInit.GetPropExpr(B,N,I)+" = "+m;if(Q.length>0){Q+=" and "}Q+=m}}if(Q.length>0){f+="("+Q+") and ";Q=""}}for(var S=1;S<=g.GetNumProp();S++){var K=N.GetPropByIndex(S).stringValue();var B=g.GetProp(S);var a=false;if(l!=null){a=true;var A=l.keys();for(var h=0;h<A.length;h++){var M=A[h];if(String.compare(M,B.ObjTag,true)==0){a=false;break}}}if(a){continue}for(var G=0;G<s.Count();G++){if(s[G]==S){K="";break}}if(B.DBCode.length==0&&K.length>0){K="";T.set(IDVariant.FALSE)}if(K.length>0){var E=false;T.set(IDVariant.FALSE);K=K.replace(/\%/g,"*");if(K.charAt(0)!="*"&&K.charAt(K.length-1)!="*"){if(o==0){E=true}else{if(o==1){K+="*"}else{K="*"+K+"*"}}}var m=null;if(E){switch(Glb.ClassDT(B.DataType)){case Glb.DTC_CHAR:m=IDL.CSql(new IDVariant(K),IDL.FMT_CHAR,L,B.IsUnicode);break;case Glb.DTC_DATE:var u=IDL.FMT_DAT2;if(Glb.ClassDB(P)==Glb.DBC_ACCESS){u=IDL.FMT_DAT1}else{if(Glb.ClassDB(P)==Glb.DBC_ORACLE||Glb.ClassDB(P)==Glb.DBC_POSTGRES){u=IDL.FMT_DAT3}else{if(Glb.ClassDB(P)==Glb.DBC_SQLITE){u=IDL.FMT_DAT4}else{if(P==Glb.DBT_DB2400&&L.UseAS400Date){u=(B.DataType==Glb.DT_DATETIME?IDL.FMT_DAT6:IDL.FMT_DAT5)}}}}m=IDL.CSql(new IDVariant(K),u,L,B.IsUnicode);break;case Glb.DTC_NUMBER:m=IDL.CSql(new IDVariant(K),IDL.FMT_NUM,L,B.IsUnicode);break}m=MDOInit.GetPropExpr(B,N,I)+" = "+m}else{var C;if(B.Mask!=null&&B.Mask.equals(">")){C=new IDVariant(K.toUpperCase());m="(("}else{if(B.Mask!=null&&B.Mask.equals("<")){C=new IDVariant(K.toLowerCase());m="(("}else{C=new IDVariant(K.toLowerCase());switch(Glb.ClassDB(P)){case Glb.DBC_ACCESS:m="lcase(cstr('' & ";break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:m="lower((";break;case Glb.DBC_DB2:m="lower(char(";break;case Glb.DBC_SQLSRV:m="lower(convert("+(L.Unicode?"nvarchar(4000)":"varchar(8000)")+", ";break;case Glb.DBC_ORACLE:m="lower(to_char(";break;default:m="((";C=new IDVariant(K);break}}}var y=new IDVariant();IDL.LikeEscape(P,C,y);C=new IDVariant(C.stringValue().replace(/\*/g,"%"));m+=MDOInit.GetPropExpr(B,N,I)+")) like "+IDL.CSql(C,IDL.FMT_CHAR,L,B.IsUnicode)+y.stringValue()}if(Q.length>0){if(o>2){Q+=" or "}else{Q+=" and "}}Q+=m}}if(o>3){for(R=1;R<=g.GetNumProp();R++){var B=g.GetProp(R);var H=false;if(e!=null){for(var O=0;O<e.Count();O++){if(String.compare(e[O],B.ObjTag,true)==0){H=true;break}}}if(!H&&z!=null&&z.VisibilityColumnsMode==Glb.QRY_VISDEF){H=true;for(var G=0;G<s.Count();G++){if(s[G]==R){H=false;break}}if(H){if(l!=null){H=false;var A=l.keys();for(var h=0;h<A.length;h++){var M=A[h];if(String.compare(M,B.ObjTag,true)==0){H=true;break}}}else{H=(Glb.ClassDT(B.DataType)==Glb.DTC_CHAR&&B.MaxLength>4&&!B.PK&&!B.FK)}}}if(H&&N.GetPropByIndex(R).stringValue().length>0){H=false}if(H&&B.DBCode.length==0){H=false}if(H){for(var S=1;S<=g.GetNumProp();S++){var K=N.GetPropByIndex(S).stringValue();var b=g.GetProp(S);for(var G=0;G<s.Count();G++){if(s[G]==S){K="";break}}if(K.length>0){T.set(IDVariant.FALSE);K=K.replace(/\%/g,"*");if(K.charAt(0)!="*"&&K.charAt(K.length-1)!="*"){K="*"+K+"*"}var m;var C;if(b.Mask!=null&&b.Mask.equals(">")){C=new IDVariant(K.toUpperCase());m="(("}else{if(b.Mask!=null&&b.Mask.equals("<")){C=new IDVariant(K.toLowerCase());m="(("}else{C=new IDVariant(K.toLowerCase());switch(Glb.ClassDB(P)){case Glb.DBC_ACCESS:m="lcase(cstr('' & ";break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:m="lower((";break;case Glb.DBC_DB2:m="lower(char(";break;case Glb.DBC_SQLSRV:m="lower(convert("+(L.Unicode?"nvarchar(4000)":"varchar(8000)")+", ";break;case Glb.DBC_ORACLE:m="lower(to_char(";break;default:m="((";C=new IDVariant(K);break}}}var y=new IDVariant();IDL.LikeEscape(P,C,y);C=new IDVariant(C.stringValue().replace(/\*/g,"%"));m+=MDOInit.GetPropExpr(B,N,I)+")) like "+IDL.CSql(C,IDL.FMT_CHAR,L,B.IsUnicode)+y.stringValue();if(Q.length>0){if(o>2){Q+=" or "}else{Q+=" and "}}Q+=m}}}}}if(Q.length==0){return""}f+="("+Q+")";if(F[0].length==0){var d=MDOInit.HandleServiceFilters(N);if(d.length>0){f+=" and "+d}}var D=new IDVariant();N.OnSQLQuery(new IDVariant(f),new IDVariant(MDOInit.QRY_LOADSMARTLOOKUP),D);if(D.stringValue().length>0){f+=" and ";f+=D;f+=" "}if(f.indexOf("order by")==-1){if(J.length>0){f+=J}else{f+=MDOInit.GetNaturalSort(N,"")}}return f};MDOInit.InternalValidate=function(g,x,D){var B=g.GetMD();if(!g.Deleted()){for(var A=1;A<=B.GetNumProp();A++){var E=g.GetPropDOError(A);if(E!=null&&E.ErrType==IDDocument.ERR_ERROR){continue}var F=B.GetProp(A);var n=g.GetPropByIndex(A);if(n.Type==IDVariant.NULL){if(!F.Nullable&&!F.Counter){var l=true;var s=g.Parent();var h=g.ParentCollection();var o=F.ObjTag;while(s!=null&&h!=null&&l&&h.Parent()==s&&h.Index>0){var f=s.GetMD();var d=f.GetColl(h.Index);var b=false;for(var y=0;y<d.PKColl.Count();y++){var c=d.FKColl[y];var r=d.PKColl[y];if(c==o){b=true;var u=f.GetPropIndex(r);var a=f.GetProp(u);if(a.Counter){l=false}h=s.ParentCollection();s=s.Parent();o=r;break}}if(!b){break}}if(l){D.set(IDVariant.TRUE);var C="E' necessario inserire un valore";var q=MDOInit.GetRTC(g);if(q!=null){C=q.GetConst("A61E8784-7812-44E2-9001-937ED881302F",C)}if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",206,"DO.InternalValidate",g.GetName(1)+": "+F.UIName+" cannot be null")}g.SetPropError(A,C)}}}else{switch(Glb.ClassDT(F.DataType)){case Glb.DTC_CHAR:if(n.stringValue().length>F.MaxLength){D.set(IDVariant.TRUE);var C="[|1] è troppo lungo; sono consentiti al massimo |2 caratteri";var k=n.stringValue();if(k.length>40){k=k.substr(0,37)+"..."}var q=MDOInit.GetRTC(g);if(q!=null){C=q.GetConst("0A52C2C4-2943-43C0-8254-7706B8E7E090",C)}C=IDL.FormatMessage(new IDVariant(C),new IDVariant(k),new IDVariant(F.MaxLength)).stringValue();if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",206,"DO.InternalValidate",g.GetName(1)+": "+F.UIName+" is too long")}g.SetPropError(A,C)}else{if(F.DataType==Glb.DT_CHAR_FIXED&&n.stringValue().length<F.MaxLength){g.SetPropDirect(A,IDL.FillLR(n,new IDVariant(F.MaxLength),new IDVariant(" "),false))}}break;case Glb.DTC_DATE:if(!IDL.IsDate(n)){D.set(IDVariant.TRUE);var C="[|1] non è una data";var k=n.stringValue();if(k.length>40){k=k.substr(0,37)+"..."}var q=MDOInit.GetRTC(g);if(q!=null){C=q.GetConst("D93EF94D-866A-4CC5-AE35-020FDD80C7D5",C)}C=IDL.FormatMessage(new IDVariant(C),new IDVariant(k)).stringValue();if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",206,"DO.InternalValidate",g.GetName(1)+": "+F.UIName+" is not a date value")}g.SetPropError(A,C)}break;case Glb.DTC_NUMBER:case Glb.DTC_BOOL:if(!IDL.IsNumber(n)){D.set(IDVariant.TRUE);var C="[|1] non è un numero";var k=n.stringValue();if(k.length>40){k=k.substr(0,37)+"..."}var q=MDOInit.GetRTC(g);if(q!=null){C=q.GetConst("D435495C-D17A-46F0-A73E-FD231C22A9B4",C)}C=IDL.FormatMessage(new IDVariant(C),new IDVariant(k)).stringValue();if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",206,"DO.InternalValidate",g.GetName(1)+": "+F.UIName+" is not a number value")}g.SetPropError(A,C)}break}}}var m=g.UIPanel;if(!m&&g.ParentCollection()!=null){m=g.ParentCollection().UIPanel}if(m){var t=m.bQueries(0).IDColl!=null?m.bQueries(0).IDColl.FindDoc(g)-m.bQueries(0).GetAttRecNumber():0;if(t>=0&&t<m.NumRows){for(var y=1;y<m.UQueries();y++){m.bQueries(y).ValidateLookup(t,g)}}}}};MDOInit.GetNewDocID=function(){var a=new GUID().toAscii85();if(a.indexOf("\\")>=0){return MDOInit.GetNewDocID()}return new IDVariant(a)};MDOInit.GetDocID=function(b){var d=b.GetMD();while(d!=null){if(d.DocIDIdx>0){return b.GetPropByIndex(d.DocIDIdx)}d=d.BaseMD}d=b.GetMD();var c=b.TypeName();for(var a=1;a<=d.GetNumProp();a++){if(d.GetProp(a).PK){c+=":";c+=b.GetPropByIndex(a)}}return new IDVariant(c)};MDOInit.Init=function(d){var b=null;if(d.GetMainFrm() instanceof WebEntryPointSrv){b=d.GetMainFrm()}var e=d.GetMD();while(e!=null){if(e.DocIDIdx>0){d.SetPropDirect(e.DocIDIdx,MDOInit.GetNewDocID())}if((e.Services&MDOInit.SERV_DOMAIN)!=0&&b!=null){var a=d.GetPropertyIndex("DO_COMPANY",false,true);var c=d.GetPropertyIndex("DO_DOMAIN",false,true);if(a<1||c<1){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find domain properties")}d.SetPropDirect(a,new IDVariant(b.getRolObj().glbCompanyID));d.SetPropDirect(c,new IDVariant(b.getRolObj().glbDomainID))}e=e.BaseMD}d.SetOriginal();d.set_Inserted(true);d.OnInit()};MDOInit.Initialize=function(c){var d=c.GetMD();for(var b=1;b<=d.GetNumColl();b++){var a=c.GetCollByIndex(b);a.set_Parent(c);a.Index=b;a.set_Visible(d.GetColl(b).Visible);a.MaxRows=0}for(var b=1;b<=d.GetNumProp();b++){c.SetPropDirect(b,new IDVariant())}};MDOInit.Terminate=function(a){try{MDOInit.ReleaseLock(a,9999)}catch(b){}};MDOInit.GetName=function(d,g,c,b,e){var a=MDOInit.GetAutoLookupDescription(d);if(g==1){var f=d.GetMD();a.set(new IDVariant(f.UIName+" "+a))}if(g==2){var f=d.GetMD();a.set(new IDVariant(f.UIName+' <span class="DO">'+a+"</span>"))}d.OnGetName(a,new IDVariant(g),c,new IDVariant(b),new IDVariant(e));return a.stringValue()};MDOInit.GetTooltip=function(c,f,b,a,e){var d=new IDVariant();c.OnGetTooltip(d,new IDVariant(f),b,new IDVariant(a),new IDVariant(e));return d.stringValue()};MDOInit.GetIcon=function(e,c,d,b,f){var g=e.GetMD();var a=new IDVariant(g.ObjIcon);e.OnGetIcon(a,new IDVariant(c),d,new IDVariant(b),new IDVariant(f));return a.stringValue()};MDOInit.MayHaveChildren=function(d){var a=new IDVariant();var e=d.GetMD();for(var b=1;b<=e.GetNumColl();b++){var f=d.GetCollByIndex(b);if((f.Count()>0||(!d.Inserted()&&!f.Loaded()))&&f.Visible()){a.set(true);break}}d.OnMayHaveChildren(a);return a.isTrue()};MDOInit.Duplicate=function(h,x,n,u,a,m,r){var q=h.GetMD();var b=null;if(u){var k=h.CreateDocument(q.ObjTag);k.SetMainFrm(h.GetMainFrm(),h.GetIMDB());MDOInit.CopyFrom(k,h,x,m,r);if(n!=null){try{n.Add(k,h)}catch(s){}if(h.Parent()!=null){h.Parent().ReconnectChildren(9999)}}b=h;h=k;if(a){var j=-1,g=-1;for(var o=1;o<=q.GetNumProp();o++){if(q.GetProp(o).DescribeRow&&q.GetProp(o).MaxLength>g&&(q.GetProp(o).MaxLength>=h.GetPropByIndex(o).stringValue().length+8)){j=o;g=q.GetProp(o).MaxLength}}if(j>0){h.SetPropByIndex(j,IDL.Add(h.GetPropByIndex(j),new IDVariant(" (copia)")))}}}h.set_Inserted(true);while(q!=null){if(q.DocIDIdx>0){h.SetPropByIndex(q.DocIDIdx,MDOInit.GetNewDocID())}q=q.BaseMD}q=h.GetMD();h.OnDuplicate(b);for(var o=1;o<=q.GetNumColl();o++){var v=h.GetCollByIndex(o);var l=v.GetCollection();for(var f=0;f<l.Count();f++){var t=l[f];if(x>0){MDOInit.Duplicate(t,x-1,null,false,false,m,r)}}}return h};MDOInit.LoadChildren=function(d,c,h,a){if(h==undefined){h=""}if(a==undefined){a=9999}if(h.length==0||h.equals(d.TypeName())){try{c.Add(d,null,true,false)}catch(g){}}if(a>0){var f=d.GetMD();for(var b=1;b<=f.GetNumColl();b++){d.GetCollByIndex(b).LoadChildren(c,h,a-1)}}};MDOInit.StandardDrop=function(k,g,f,a,n){if(g.IsChildOf(k)){return null}var d=MDOInit.CanAdopt(g,k)!=null;var m=false;if(g.Parent()!=null){m=MDOInit.CanAdopt(g.Parent(),k)!=null}if(!d&&!m){return null}var h;var l=null;if(m&&(f||!d)){h=g.Parent();l=g}else{h=g}var b;if(n){b=k.Duplicate()}else{b=k}var c=MDOInit.CanAdopt(h,b);if(c!=null){try{c.Add(b,l,l==null)}catch(j){}}return b};MDOInit.CanAdopt=function(d,a){var e=d.GetMD();for(var c=1;c<=e.GetNumColl();c++){var b=e.GetColl(c);if(b.ChildrenName.equals(a.TypeName())){return d.GetCollByIndex(c)}}return null};MDOInit.GetPropertyIndex=function(l,f,m,k,c,a,j){var b=l.GetMD();for(var d=1;d<=b.GetNumProp();d++){var h=b.GetProp(d);if(f.equals(h.GUID)){return d}if(m&&f.equals(h.Name)){return d}if(k&&f.equals(h.Concept)){return d}if(a&&f.equals(h.ObjTag)){return d}if(c&&f.equals(h.DBCode)){return d}if(j&&f.equals(h.IOTCode)){return d}if(h.ExtPropIdx>0&&(b.Services&MDOInit.SERV_EXTSCHEMA)!=0){try{h=l.GetExtProp(h.ExtPropIdx)}catch(g){if(this.GetDTT(l)!=null){this.GetDTT(l).AddException("","DO.GetPropertyIndex",l.TypeName()+": Exception while getting the extended property schema for property "+h.ExtPropIdx,g)}}if(h!=null){if(f.equals(h.GUID)){return d}if(m&&f.equals(h.Name)){return d}if(k&&f.equals(h.Concept)){return d}if(a&&f.equals(h.ObjTag)){return d}if(c&&f.equals(h.DBCode)){return d}}}}return 0};MDOInit.GetExtProp=function(a,c){var b=a.GetExtSchema();if(b!=null&&c>0&&c<=b.GetNumProp()){return b.GetProp(c)}return null};MDOInit.GetExtSchema=function(a){var d=a.GetMD();var c=new IDVariant(d.ObjTag);a.GetSchemaName(c);var b;var f=c.stringValue();var e=a.GetSchemaCache();if(e.containsKey(f)){b=e[f]}else{b=MDOInit.LoadSchema(a,c);e[f]=b}return b};MDOInit.LoadSchema=function(h,k){var u=h.GetMD();var n=u.DBObj;if(n==null){n=h.GetDBObj()}if(n==null){throw new Error("ERR "+MDOInit.DOERR_NODBCONN+": "+u.ObjTag+" Not connected to DB")}try{WriteToConsoleOutput("Loading schema "+k);var y="select * from DO_SCHEME where DO_CODE = "+IDL.Quote(k);var f=n.OpenRS(y);if(f.RecordCount()!=1){return null}f.MoveFirst();var l=new DOMDObj();l.ObjTag=k.stringValue();l.UIName=f.Get("DO_DESCRIPTION").stringValue();y="select * from DO_PROPSCHEME where DO_SCHEMAID = "+IDL.Quote(f.Get("DO_SCHEMAID"))+" order by DO_SEQ";var z=n.OpenRS(y);l.SetNumProp(z.RecordCount());if(!z.EOF()){z.MoveFirst()}var t=0;while(!z.EOF()){var a=new DOMDProp();t++;l.SetProp(t,a);a.ObjTag=z.Get("DO_CODE").stringValue();a.Name=z.Get("DO_CODE").stringValue();a.UIName=z.Get("DO_DESCRIPTION").stringValue();a.Concept=z.Get("DO_CONCEPT").stringValue();a.MaxLength=z.Get("DO_MAXLEN").intValue();a.Mask=z.Get("DO_MASK").stringValue();a.IDList=z.Get("DO_LISTID").stringValue();a.DTString=z.Get("DO_DATATYPE").stringValue();a.DataType=Glb.DT_CHAR;if(a.DTString.equals("NM")){a.DataType=Glb.DT_NUM_CURRENCY}if(a.DTString.equals("DT")){a.DataType=Glb.DT_DATETIME}try{a.Nullable=z.Get("DO_NULLABLE").stringValue().equals("Y");a.ReadOnly=z.Get("DO_READONLY").stringValue().equals("Y");a.Lookup=z.Get("DO_LOOKUP").stringValue();var q=z.Get("DO_LNKDOC").stringValue();if(q.length>0){var x=h.CreateDocument(q);if(x!=null){var g=-1;var c=x.GetMD();for(var r=1;r<=c.GetNumProp();r++){var o=c.GetProp(r);if(o.PK){if(g==-1){g=r}else{g=-1;break}}}if(g>-1){var b=new DOMDLinkedDoc(q,1);b.SetLinkedProp(0,t,g);a.LinkedDoc=b}}}}catch(v){}z.MoveNext()}return l}catch(m){if(this.GetDTT(h)!=null){this.GetDTT(h).AddException("","DO.LoadSchema",h.TypeName()+": Can't load schema",m)}return null}};MDOInit.SetLoaded=function(j,g,h){j.set_Loaded(h);if(g>0){var b=j.GetMD();for(var c=1;c<=b.GetNumColl();c++){var f=j.GetCollByIndex(c);f.set_Loaded(h);var a=f.GetCollection();for(var k=0;k<a.Count();k++){var e=a[k];e.SetLoaded(g-1,h)}}}};MDOInit.SetInserted=function(j,g,h){j.set_Inserted(h);if(g>0){var b=j.GetMD();for(var c=1;c<=b.GetNumColl();c++){var f=j.GetCollByIndex(c);var a=f.GetCollection();for(var k=0;k<a.Count();k++){var e=a[k];e.SetInserted(g-1,h)}}}};MDOInit.GetNaturalSort=function(c,f){var e=c.GetMD();var b=0;var a=0;var d="";while(a<4){switch(a){case 0:d="DO_SEQUENCE";break;case 1:d="DO_CODE";break;case 2:d="DO_DATE";break;case 3:d="DO_NAME";break}b=c.GetPropertyIndex(d);if(b>0){if(e.GetProp(b).DBCode==null||e.GetProp(b).DBCode.length==0){b=0}else{break}}a++}if(b>0){return" order by "+f+e.GetProp(b).DBCode}else{return""}};MDOInit.GetDocErrors=function(j,h){if(h==undefined){h=9999}var b=j.GetMD();var l="*** "+j.GetName(1)+"\n";for(var d=1;d<=b.GetNumProp();d++){var f=j.GetPropError(d);if(f!=null&&f.length>0){l+=b.GetProp(d).UIName+" ("+j.GetPropByIndex(d)+"): "+f+"\n"}}var g=new ArrayList();j.GetDocErrors(g);for(var k=0;k<g.Count();k++){l+=g[k]+"\n"}if(h>0){for(var d=1;d<=b.GetNumColl();d++){var a=j.GetCollByIndex(d).GetCollection();for(var k=0;k<a.Count();k++){l+=MDOInit.GetDocErrors(a[k],h-1)}}}return l};MDOInit.GetDocErrorList=function(d,g,a){if(a==undefined){a=9999}if(d.HasErrors()){g.Add(d)}if(a>0){var f=d.GetMD();for(var c=1;c<=f.GetNumColl();c++){var b=d.GetCollByIndex(c).GetCollection();for(var e=0;e<b.Count();e++){GetDocErrorList(b[e],g,a-1)}}}};MDOInit.VerifyService=function(c,a){var b=c.GetMD();if((b.Services&a)==0){throw new Error("ERR "+MDOInit.DOERR_NOSERV+": ["+c.TypeName()+"] Service not active")}if(c.GetDocHelper()==null){throw new Error("ERR "+MDOInit.DOERR_NOHLP+": ["+c.TypeName()+"] Document helper not active")}};MDOInit.EditAttachments=function(a){MDOInit.VerifyService(a,MDOInit.SERV_ATTACH|MDOInit.SERV_COMMENT);a.GetDocHelper().OpenAttachmentForm(a)};MDOInit.ShowAttachment=function(c,b){var a=new IDVariant();MDOInit.VerifyService(c,MDOInit.SERV_ATTACH);c.GetDocHelper().ShowAttachment(c,new IDVariant(b),a);return a.booleanValue()};MDOInit.GetAttachment=function(c,b){var a=new IDVariant();MDOInit.VerifyService(c,MDOInit.SERV_ATTACH);c.GetDocHelper().GetAttachment(c,new IDVariant(b),a);return a.stringValue()};MDOInit.SetAttachment=function(f,e,c,g,b){var a=new IDVariant();MDOInit.VerifyService(f,MDOInit.SERV_ATTACH);f.GetDocHelper().SetAttachment(f,new IDVariant(e),new IDVariant(c),new IDVariant(g),new IDVariant(b),a);return a.stringValue()};MDOInit.DeleteAttachments=function(h,b){var g=h.GetMD();if((g.Services&MDOInit.SERV_ATTACH)!=0){if(h.GetDocHelper()!=null){h.GetDocHelper().DeleteAttachments(h)}}if(b>0){for(var e=1;e<=g.GetNumColl();e++){var j=h.GetCollByIndex(e);var c=j.GetCollection();for(var f=0;f<c.Count();f++){var a=c[f];MDOInit.DeleteAttachments(a,b-1)}}}};MDOInit.GetComment=function(f,c,e,a){var b=new IDVariant();MDOInit.VerifyService(f,MDOInit.SERV_COMMENT);f.GetDocHelper().GetComment(f,new IDVariant(c),new IDVariant(e),new IDVariant(a),b);return b.stringValue()};MDOInit.SetComment=function(g,a,f,e,c){var b=new IDVariant();MDOInit.VerifyService(g,MDOInit.SERV_COMMENT);g.GetDocHelper().SetComment(g,new IDVariant(a),new IDVariant(f),new IDVariant(e),new IDVariant(c),b);return b.stringValue()};MDOInit.DeleteComments=function(h,b){var g=h.GetMD();if((g.Services&MDOInit.SERV_COMMENT)!=0){if(h.GetDocHelper()!=null){h.GetDocHelper().DeleteComments(h)}}if(b>0){for(var e=1;e<=g.GetNumColl();e++){var j=h.GetCollByIndex(e);var c=j.GetCollection();for(var f=0;f<c.Count();f++){var a=c[f];MDOInit.DeleteComments(a,b-1)}}}};MDOInit.HandleServiceFilters=function(s){try{var h=s.GetMainFrm();var y="";var x="";var v="";var q=s.GetMD();if((q.Services&MDOInit.SERV_DOMAIN)!=0){var b=s.GetPropertyIndex("DO_COMPANY",false,true);var j=s.GetPropertyIndex("DO_DOMAIN",false,true);var c=s.GetPropertyIndex("DO_SCOPE",false,true);if(b<1||j<1||c<1){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find domain properties")}var m=q.GetProp(b).DBCode;var u=q.GetProp(j).DBCode;var n=q.GetProp(c).DBCode;if(m.length==0||u.length==0||n.length==0){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find domain fields")}if(h==null){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Framework object not set")}var g=h.getRolObj().glbCompanyID;var f=h.getRolObj().glbDomainID;if(g.length>0||f.length>0){y="(";if(g.length>0){y+=("("+m+" = '"+g+"' or "+n+" < 30)")}if(f.length>0){y+=((y.length>1?" and ":"")+"("+u+" = '"+f+"' or "+n+" < 20)")}y+=")"}}if((q.Services&MDOInit.SERV_USERINFO)!=0){var o=s.GetPropertyIndex("DO_AUTLEVEL",false,true);if(o<1){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find authorization level property")}var e=q.GetProp(o).DBCode;if(e.length==0){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find authorization level field")}if(h==null){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Framework object not set")}var k=h.getRolObj().glbAutLevel;x="("+e+" <= "+k+")"}if((q.Services&MDOInit.SERV_LDELETE)!=0){var t=s.GetPropertyIndex("DO_LDELETE",false,true);if(t<1){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find logical deletion property")}var a=q.GetProp(t).DBCode;if(a.length==0){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find logical deletion field")}v="("+a+" = 'N')"}var r=y;if(x.length>0){r=(r.length==0?"":r+" and ")+x}if(v.length>0){r=(r.length==0?"":r+" and ")+v}return r}catch(l){return""}};MDOInit.GetLock=function(d,c,b,f){if(d.Inserted()){return true}if(d.Locked()){return true}var e=d.GetMD();if((e.Services&MDOInit.SERV_LOCKING)!=0){if(d.GetDocHelper()!=null){var a=new IDVariant(IDVariant.TRUE);d.GetDocHelper().GetLock(d,new IDVariant(b),f,a);if(a.isTrue()){d.set_Locked(true)}return a.isTrue()}else{if(this.GetDTT(d)!=null){this.GetDTT(d).AddMsg(DTTEngine.DTTMSG_WARN,"",208,"DO.GetLock",d.GetName(1)+": document isn't unlockable because DocHelper is null")}return false}}else{if(c>0&&d.Parent()!=null){return d.Parent().GetLock(c-1,b,f)}else{return true}}};MDOInit.ReleaseLock=function(b,a){var c=b.GetMD();if((c.Services&MDOInit.SERV_LOCKING)!=0){if(!b.Locked()){return false}if(b.GetDocHelper()!=null){b.set_Locked(false);b.GetDocHelper().ReleaseLock(b);return true}else{return false}}else{if(a>0&&b.Parent()!=null&&b.ParentCollection()!=null){return b.Parent().ReleaseLock(a-1)}else{return true}}};MDOInit.LoadDocProp=function(m,o,u){var b=m.GetMD();u.getMetaData(true);var g=0;var n=0;if(o!=null){n=o.Count()}if(n==0){for(var k=1;k<=b.GetNumProp();k++){var a=b.GetProp(k);var x=IDL.DataType2IDVariantType(a.DataType);var r=null;var q=false;if(o==null){var t=u.findColumn(a.ObjTag);if(t==-1&&a.DBCode!=null&&a.DBCode.length>0){t=u.findColumn(a.DBCode)}if(t!=-1){try{r=u.Get(t,x);q=true}catch(l){}}}else{if(a.DBCode!=null&&a.DBCode.length>0){try{r=u.Get(g+1,x);q=true}catch(f){}}}if(q){if(a.Transformation<Glb.TRANSF_TRIM){m.SetPropDirect(k,r);g++}else{if(!MDOInit.UseRecord(a)){m.SetPropDirect(k,Glb.GetTD(r,a.Transformation,a.TrFormat,a.TrOffset,a.MaxLength));g++}}}}}else{for(var k=0;k<o.Count();k++){var s=o[k];var r=s;var a=b.GetProp(r);var x=IDL.DataType2IDVariantType(a.DataType);if(a.Transformation<Glb.TRANSF_TRIM){m.SetPropDirect(r,u.Get(g+1,x));g++}else{if(!MDOInit.UseRecord(a)){m.SetPropDirect(r,Glb.GetTD(u.Get(g+1,x),a.Transformation,a.TrFormat,a.TrOffset,a.MaxLength));g++}}}}for(var k=1;k<=b.GetNumProp();k++){var a=b.GetProp(k);if(MDOInit.UseRecord(a)){if(a.RecordIdxProp==0){a.RecordIdxProp=m.GetPropertyIndex(a.TrFormat,false,false,true,false)}if(a.RecordIdxProp>0){m.SetPropDirect(k,Glb.GetTD(m.GetPropByIndex(a.RecordIdxProp),a.Transformation,a.TrFormat,a.TrOffset,a.MaxLength))}}}if((b.Services&MDOInit.SERV_LOCKING)!=0){var h=m.GetPropertyIndex("DO_LOADTIME",false,true);if(h>0){m.SetPropDirect(h,IDL.Now())}}};MDOInit.GetTIExpr=function(e,b,d,a){if(b.Transformation<Glb.TRANSF_TRIM||(b.Transformation==Glb.TRANSF_TRIM&&d)){return e+b.DBCode}else{var c="";if(Glb.ClassDB(a)==Glb.DBC_SQLSRV){c="dbo."}c+="GetTD";switch(Glb.ClassDT(b.DataType)){case Glb.DTC_NUMBER:c+="N";break;case Glb.DTC_DATE:c+="D";break;default:c+="C";break}c+=("("+e);if(MDOInit.UseRecord(b)){c+=b.TrFormat}else{if(a==Glb.DBT_DB2400){c+="CHAR("}c+=b.DBCode;if(a==Glb.DBT_DB2400){c+=")"}}c+=(","+b.Transformation+",'"+b.TrFormat+"',"+b.TrOffset+","+b.MaxLength+")");return c}};MDOInit.UseRecord=function(a){return(a.Transformation==Glb.TRANSF_C2TOI||a.Transformation==Glb.TRANSF_SUBSTR)};MDOInit.GetDOBase=function(c,a){if(a==undefined){a=true}var b=new ArrayList();while(c!=null){if(a){b.Insert(0,c)}else{b.Add(c)}c=c.BaseMD}return b};MDOInit.GetPropExpr=function(c,f,h,b){if(b==undefined){b=true}var a=f.GetDBExpr(c.Index);if(a==""){if(c.DBCode!=null&&c.DBCode.length>0){var g=0;var j=h[g];while(j.GetNumProp()<c.Index){g++;j=h[g]}var e=(h.Count()==1?"":j.DBCode+".");if(b){a=MDOInit.GetTIExpr(e,c,true,j.GetDBType())}else{a=e+c.DBCode}}}return a};MDOInit.GetFromList=function(j,s,l,g){var r=j;var h=l.stringValue();var q="";var o=true;for(var f=0;f<s.Count();f++){var k=s[f];if(k.DBCode!=null&&k.DBCode.length>0){var b=k.DBCode;if(k.TableSubst&&r!=null){if(f==0){b=r.TableSubst("","",k.DBCode,0,g)}else{b=r.TableSubst(s[f-1].DBCode,"inner join",k.DBCode,0,g)}if(!b.equals(k.DBCode)){b+=" "+k.DBCode}}if(o){h+=" from "+b;o=false}else{h+=", "+b}}}if(s.Count()>1){for(var e=1;e<s.Count();e++){var n=s[e];if(n.DBCode!=null&&n.DBCode.length>0){var f=0;var k=s[f];for(var c=1;c<=n.GetNumProp();c++){var a=n.GetProp(c);if(a.PK&&c<=n.BaseProps&&a.DBCode!=null&&a.DBCode.length>0){var m=n.GetFieldConversion(c);if(m!=null){while(k.GetNumProp()<c){k=s[++f]}if(q.length>0){q+=" and "}q+=n.DBCode;q+=".";q+=m;q+=" = ";q+=k.DBCode;q+=".";q+=a.DBCode}}}}}}l.set(new IDVariant(h));return q};MDOInit.GetLinkedDocument=function(r,b,o,n,m,l,k){var a=r.GetMD();var c=MDOInit.GetDTT(r);var q=-1;var q=parseInt(o,10);if(isNaN(q)){for(var d=1;d<=a.GetNumProp();d++){var j=a.GetProp(d);if(j.LinkedDoc!=null&&j.LinkedDoc.GetDocumentClass()==o){q=d;break}}}else{o=a.GetProp(q).Name}if(q==-1){if(c!=null){c.AddMsg(DTTEngine.DTTMSG_WARN,"",209,"DO.GetLinkedDocument",r.GetName(1)+": cannot find the linked document requested ("+o+")")}return null}var f=a.GetProp(q).LinkedDoc;if(f==null){if(c!=null){c.AddMsg(DTTEngine.DTTMSG_WARN,"",209,"DO.GetLinkedDocument",r.GetName(1)+": no linked document cannot defined for property "+a.GetProp(q).Name)}return null}var h=r.CreateDocument(f.GetDocumentClass());if(h==null){if(c!=null){c.AddMsg(DTTEngine.DTTMSG_WARN,"",209,"DO.GetLinkedDocument",r.GetName(1)+": cannot create the linked document requested ("+f.GetDocumentClass()+")")}return null}for(var d=0;d<f.GetNumProp();d++){h.SetPropByIndex(f.GetSrcProp(d),r.GetPropByIndex(f.GetDstProp(d)))}if(b){h.LoadLookupValues()}else{try{h.LoadFromDB(0)}catch(g){}}if(!h.Loaded()){if(c!=null){c.AddMsg(DTTEngine.DTTMSG_WARN,"",209,"DO.GetLinkedDocument",r.GetName(1)+": cannot load the linked document (see previous messages)")}return null}if(n==null){return h}else{if(c!=null){c.AddMsg(DTTEngine.DTTMSG_INFO,"",209,"DO.GetLinkedDocument",r.GetName(1)+": "+o+" linked document loaded. Now searching for the next one ("+n+")")}return MDOInit.GetLinkedDocument(h,b,n,m,l,k,null)}};MDOInit.ResumeDocSync=function(b){if((b.GetMD().Services&MDOInit.SERV_SYNC)!=0){var a=MDOInit.GetSyncObj(b);if(a!=null){return a.ResumeDocSync(b)}}return true};SyncService.FL_SYNCME=1;SyncService.FL_SYNCPARTNER=2;SyncService.FL_RESYNCPARTNER=4;SyncService.FL_USEOPTLOCK=8;SyncService.NULL_Marker="~~NULL~~";function SyncService(a){this.MainFrm=a;this.DB=null;this.TablesAlreadyChecked=false;this.ResetSchemaCache=false;this.ServerURL="";this.ClientUsername="";this.ClientPassword="";this.IsSynchronizing=false;this.ResponseFormat=XMLDoc.FT_JSON;this.MaxAge=30;this.CheckServer=5;this.ConnectionTimeout=0;this.CancelReason="";this.DocToSync=new ArrayList();this.OptLockList=new ArrayList();this.ClassToResync=new ArrayList();this.ErrList=new ArrayList();this.ServerErrList=null;this.ConflictList=new ArrayList();this.ConflictPropList=new ArrayList();this.DontSyncMap=new IDMap();this.DontAddVariations=false;this.SessionFlags=0;this.MaxDocuments=0;this.TotalDocuments=-1;this.ActualDocument=0;this.Aborted=false;this.Completed=false;this.PreCount=false;this.ProcessedDocs=-1;this.iCanAbort=true;this.LastDocument="";this.iNativeSync=true;this.StartSyncTS;this.ServerElapsedTime=-1;this.NetworkElapsedTime=-1;this.ClientElapsedTime=-1;this.TotalChanges=-1;this.ResetSessionFlags()}SyncService.prototype.NativeSync=function(){return(this.iNativeSync&&this.MainFrm.ParamsObj().UseRD4&&!IDL.IsNull(this.MainFrm.ShellObject.IsInsideCaravel()))};SyncService.prototype.set_NativeSync=function(a){this.iNativeSync=a};SyncService.prototype.GetProgress=function(a){if(a==undefined){a=false}return(new IDVariant(parseFloat(this.MainFrm.ShellObject.SendCmd("SYNC_PROGRESS",{ABORTED:(a?"1":"0")}))))};SyncService.prototype.CanAbort=function(){return this.iCanAbort&&(this.MaxDocuments>0)};SyncService.prototype.set_CanAbort=function(a){this.iCanAbort=a};SyncService.prototype.SetSyncDB=function(a){this.DB=a};SyncService.prototype.AddDocToSync=function(a){if(this.DocToSync.IndexOf(a)==-1){this.DocToSync.Add(a)}};SyncService.prototype.EnableOptimisticLock=function(a){if(this.OptLockList.IndexOf(a)==-1){this.OptLockList.Add(a)}};SyncService.prototype.ResetSessionFlags=function(){this.SessionFlags=255};SyncService.prototype.TestSessionFlag=function(a){return(this.SessionFlags&a)!=0};SyncService.prototype.ResetSessionFlag=function(a){this.SessionFlags=this.SessionFlags&(~a)};SyncService.prototype.SetSessionFlag=function(a){this.SessionFlags=this.SessionFlags|a};SyncService.prototype.DontSync=function(b,a){var c=this.DontSyncMap.get_Object(new IDVariant(b.TypeName()));if(c==null){c=new BitArray(b.GetMD().GetNumProp());c.SetAll(true);this.DontSyncMap.set_Object(new IDVariant(b.TypeName()),c)}if(a>0){c[a-1]=false}};SyncService.prototype.ResyncClass=function(a){if(this.ClassToResync.IndexOf(a)==-1){this.ClassToResync.Add(a)}};SyncService.prototype.LastSync=function(){var a=new IDVariant();try{if(!this.CheckTables()){return a}var d="select TS from ZZ_SYNC where ID=1 and STATUS='.'";var b=this.DB.DBO().OpenRS(d);if(b.RecordCount()>0){b.MoveFirst();a=b.Get(1)}}catch(c){}return a};SyncService.prototype.VariationNumber=function(){var a=new IDVariant();try{if(!this.CheckTables()){return a}var d="select count(*) from ZZ_SYNC where ID>1";var b=this.DB.DBO().OpenRS(d);if(b.RecordCount()>0){b.MoveFirst();a=b.Get(1)}}catch(c){}return a};SyncService.prototype.ClearPartialCounters=function(){this.TotalDocuments=-1;this.ActualDocument=0;this.Aborted=false;this.Completed=false;this.ProcessedDocs=0;this.ServerElapsedTime=0;this.NetworkElapsedTime=0;this.ClientElapsedTime=0;this.TotalChanges=0};SyncService.prototype.CheckTables=function(){if(this.TablesAlreadyChecked){return true}if(this.DB==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",602,"SyncService.CheckTables","No database can contain sync data; verify your license");return false}this.TablesAlreadyChecked=true;var a=this.DB.DBO().OpenRS("select sql from sqlite_master where type = 'table' and name = 'ZZ_SYNC'");if(a.RecordCount()>0){return true}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",600,"SyncService.CheckTables","ZZ_SYNC is not readable");try{var c=this.GetZZSQL1().stringValue();this.MainFrm.DTTObj.AddQuery("SyncService.CheckTables","Creating table ZZ_SYNC","SyncService.CheckTables",DTTEngine.STMT_QRY_INSVAL,c);this.DB.DBO().Execute(c);this.MainFrm.DTTObj.EndQuery("SyncService.CheckTables");c=this.GetZZSQL2().stringValue();if(c!=""){this.DB.DBO().Execute(c)}c=this.GetZZSQL3().stringValue();if(c!=""){this.DB.DBO().Execute(c)}c=this.GetZZSQL4().stringValue();if(c!=""){this.DB.DBO().Execute(c)}return true}catch(b){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",601,"SyncService.CheckTables","ZZ_SYNC is not creatable "+b.message);return false}};SyncService.prototype.GetZZSQL1=function(){var a="";switch(Glb.ClassDB(this.DB.DBaseType())){case Glb.DBC_ACCESS:a="create table ZZ_SYNC( ID counter not null, DNA longtext not null, STATUS text(1) not null, DOCDOM text(200), CONTENT longtext, TS datetime default NOW())";break;case Glb.DBC_SQLSRV:a="create table ZZ_SYNC( ID int identity not null, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT text, TS datetime default GETDATE())";break;case Glb.DBC_ORACLE:a="create table ZZ_SYNC( ID number(10), DNA varchar2(1000) not null, STATUS varchar2(1) not null, DOCDOM varchar2(200), CONTENT clob, TS date default SYSDATE)";break;case Glb.DBC_DB2:a="create table ZZ_SYNC( ID integer generated by default as identity, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT clob, TS timestamp default CURRENT_TIMESTAMP)";break;case Glb.DBC_POSTGRES:a="create table ZZ_SYNC( ID serial not null, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT text, TS timestamp default NOW())";break;case Glb.DBC_MYSQL:a="create table ZZ_SYNC( ID int auto_increment not null primary key, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT longtext, TS timestamp default NOW())";break;case Glb.DBC_SQLITE:a="create table ZZ_SYNC( ID integer primary key autoincrement not null, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT varchar(10000), TS datetime default (datetime(CURRENT_TIMESTAMP,'localtime')))";break}return new IDVariant(a)};SyncService.prototype.GetZZSQL2=function(){var a="";switch(Glb.ClassDB(this.DB.DBaseType())){case Glb.DBC_ACCESS:a="create index ZZ_SYNC_PK on ZZ_SYNC (ID) with primary";break;case Glb.DBC_SQLSRV:case Glb.DBC_ORACLE:case Glb.DBC_DB2:case Glb.DBC_POSTGRES:a="alter table ZZ_SYNC add constraint ZZ_SYNC_PK primary key (ID)";break}return new IDVariant(a)};SyncService.prototype.GetZZSQL3=function(){var a="";switch(Glb.ClassDB(this.DB.DBaseType())){case Glb.DBC_ORACLE:a="create sequence ZZ_SYNC_ID start with 1 nocache";break}return new IDVariant(a)};SyncService.prototype.GetZZSQL4=function(){var a;switch(Glb.ClassDB(this.DB.DBaseType())){case Glb.DBC_ORACLE:a="insert into ZZ_SYNC(ID, DNA, STATUS, TS) values (ZZ_SYNC_ID.nextval, '0', '.', NULL)";break;default:a="insert into ZZ_SYNC(DNA, STATUS, TS) values ('0', '.', NULL)";break}return new IDVariant(a)};SyncService.prototype.AddVariation=function(e,c){if(this.DontAddVariations){return}if(!c){if(!e.Inserted()&&!e.Updated()&&!e.Deleted()){return}}if(e.Inserted()&&e.Deleted()){return}if(!this.CheckTables()){return}var d=this.GetCompleteDNA(e);var h=this.GetDomain(e);var a="";var b="I";if(!c&&!e.Inserted()){if(e.Updated()){b="U"}if(e.Deleted()){b="D"}}if(b!="D"){a=this.GetContent(e);if(a==""){return}}if(e.SuspendSync()){switch(b){case"I":b="0";break;case"U":b="1";break;case"D":b="2";break}}var g="insert into ZZ_SYNC(DNA, STATUS, DOCDOM, CONTENT) values (?, ?, ?, ?)";if(Glb.ClassDB(this.DB.DBaseType())==Glb.DBC_ORACLE){g="insert into ZZ_SYNC(ID, DNA, STATUS, DOCDOM, CONTENT) values (ZZ_SYNC_ID.nextval, ?, ?, ?, ?)"}var f=new IDPreparedStatement(true);f.SetCommand(g);f.AddParameter(new IDVariant(d));f.AddParameter(new IDVariant(b));f.AddParameter(h);f.AddParameter(new IDVariant(a));this.DB.DBO().ExecuteIDPS(f,false)};SyncService.prototype.GetCompleteDNA=function(b){var a="";while(b!=null){a="{"+b.GetDNA().stringValue()+"}"+a;b=b.Parent()}return a};SyncService.prototype.GetDomain=function(c){var b;var a=c.GetPropertyIndex("DO_DOMAIN",true,true,true,true);if(a>0){b=c.GetPropByIndex(a)}else{b=c.GetNamedPropertyValue("DO_DOMAIN")}return b};SyncService.prototype.GetContent=function(j){var l=new XMLDoc();var f=l.AddNewElement("do");var a=false;var c=this.OptLockList.IndexOf(j.TypeName())>-1;var b=j.GetMD();var h=this.DontSyncMap.get_Object(new IDVariant(j.TypeName()));if(h==null){this.DontSync(j,0);j.GetNamedPropertyValue("DO_DONTSYNC");h=this.DontSyncMap.get_Object(new IDVariant(j.TypeName()))}for(var e=1;e<=b.GetNumProp();e++){if(h!=null&&!h[e-1]){continue}var k=j.GetPropByIndex(e);var d=j.GetPropOrigValue(e);var g=b.GetProp(e);if(j.Inserted()||!k.equals(d)){f.SetAttribute(g.ObjTag,this.ValueToString(k));if(c&&g.DataType!=Glb.DT_DOC_OLE){f.SetAttribute(g.ObjTag+"_old",this.ValueToString(d))}a=true;if(g.PK&&!j.Inserted()){throw new Error("Cannot sync a primary key change")}}}if(a){return f.SaveToString()}else{return""}};SyncService.prototype.SyncToServer=function(b){this.StartSyncTS=new Date();if(!this.CheckSyncServer()){if(this.NativeSync()){this.EndSynchronization(false,false,new IDArray())}return false}if(this.DocToSync.Count()==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",630,"SyncToServer","There is no class to synchronize")}if(!this.CheckTables()){if(this.NativeSync()){this.EndSynchronization(false,false,new IDArray())}return false}this.ResetSchemaCache=false;this.ClearPartialCounters();if(!this.NativeSync()){this.IsSynchronizing=true;var c=true;var f=true;this.ServerErrList=new ArrayList();try{var j=true;this.MainFrm.StartPhase(0,this.MainFrm.RTCObj.GetConst("F163BC6B-AB8F-46bc-BCCD-74BBF92B0154","Sincronizzazione in corso...",false),this.CanAbort());while(this.Completed==false&&this.Aborted==false){var k=false;if(this.DB.DBO().TransCount==0){this.DB.BeginTrans();k=true}SyncService.prototype.SyncToServerTR=function(){var D=0;var m="";var G="select DNA,DOCDOM,TS,CONTENT from ZZ_SYNC where ID=1 and STATUS='.'";var q=null;var e="";var n="";var o=this.DB.DBO().OpenRS(G);if(o.RecordCount()>0){o.MoveFirst();D=o.Get(1).intValue();m=o.Get(2).stringValue();q=o.Get(3);e=IDL.CSql(q,IDL.FMT_DAT1,this.DB.DBO());e=e.Replace("#","");n=o.Get(4).stringValue()}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",603,"SyncToServer","Start synchronization from ID="+D);this.MainFrm.DTTObj.AddMsgToken("","Server",this.ServerURL);this.MainFrm.DTTObj.AddMsgToken("","UserName",this.ClientUsername);this.MainFrm.DTTObj.AddMsgToken("","Password",this.ClientPassword);this.MainFrm.DTTObj.AddMsgToken("","Last Dom",m);this.MainFrm.DTTObj.AddMsgToken("","Last Doc",n);this.MainFrm.DTTObj.AddMsgToken("","Time Stamp",e);this.MainFrm.DTTObj.AddMsgToken("","Pre Count",this.PreCount);var l="";l+='<ss username="'+Glb.HTMLEncode(this.ClientUsername)+'" ';l+='password="'+Glb.HTMLEncode(this.ClientPassword)+'" ';l+='dom="'+Glb.HTMLEncode(m)+'" ';l+='lastdoc="'+Glb.HTMLEncode(n)+'" ';l+='ts="'+e+'" ';l+='from="'+D+'" ';if(this.PreCount){l+='precount="1" '}if(this.MainFrm.ShellObject.IsInsideShell()){l+='dnid="'+this.MainFrm.ShellObject.GetDNID()+'" '}l+='max="'+this.MaxDocuments+'">';if(this.TestSessionFlag(SyncService.FL_SYNCPARTNER)){l=this.GetClientVariations(l)}for(var F=0;F<this.ClassToResync.Count();F++){var z=this.ClassToResync[F];l+='<rs cls="'+Glb.HTMLEncode(z)+'" />'}l+="</ss>";var I=new IDMap();I.set_Value(new IDVariant("SYNCDATA"),new IDVariant(l));I.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));I.set_Value(new IDVariant("FTR"),new IDVariant(this.ResponseFormat));I.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));if(this.ConnectionTimeout>0){I.set_Value(new IDVariant("ID_TIMEOUT"),new IDVariant(this.ConnectionTimeout))}var t=new Date();var u=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServerURL),I);var y=new Date();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"SyncToServer","Received "+u.stringValue().length+" bytes from server");if(u.stringValue().length<20000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",u.stringValue())}if(this.ResponseFormat!=XMLDoc.FT_XML&&u.stringValue().startsWith("<")){this.ResponseFormat=XMLDoc.FT_XML}var C=new XMLDoc();if(!C.LoadFromString(u.stringValue(),this.ResponseFormat)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"SyncToServer","Parse XML failed")}var v=C.GetRootNode();this.ErrList.Clear();if(v!=null&&v.Name()=="ss"){this.UpdateElapdedTimes(v,y.getTime()-t.getTime());if(!this.CheckResponse(v,"SyncToServer")){this.Aborted=true;f=false;if(k){this.DB.RollbackTrans()}return}if(j&&v.GetAttribute("resync")=="yes"){for(var F=0;F<this.DocToSync.Count();F++){var J=this.MainFrm.GetFromDNA(new IDVariant(this.DocToSync[F]),false,0);var E=J.GetMD();var A=E.DBObj;if(A==null){A=J.GetDBObj()}G="delete from "+E.DBSchema+E.DBCode;this.MainFrm.DTTObj.AddQuery("SyncService.SyncToServer",E.ObjTag+": delete all data","SyncService.SyncToServer",DTTEngine.STMT_QRY_INSVAL,G);A.Execute(G);this.MainFrm.DTTObj.EndQuery("SyncService.SyncToServer")}}if(!this.PreCount&&(v.GetAttribute("lastdoc").length==0||v.GetAttribute("resync")=="yes")){this.ClassToResync.Clear()}if(this.PreCount){this.TotalDocuments=new IDVariant(v.GetAttribute("total")).intValue();this.PreCount=false}else{if(this.TotalDocuments==-1&&this.MaxDocuments==0){this.TotalDocuments=0;var H=v.GetNode().childNodes;var r=H.length;for(var F=0;F<r;F++){var x=H[F];if(x.nodeName.equals("do")&&x.getAttribute("ss_err")!="2"){this.TotalDocuments++}}}}if(this.TotalDocuments!=-1){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",605,"SyncToServer","Total documents to sync = "+this.TotalDocuments)}this.DontAddVariations=true;if(this.TestSessionFlag(SyncService.FL_SYNCME)){c=this.ProcessAndSave(v,"",11)}this.DontAddVariations=false;this.Completed=!(v.GetAttribute("completed")=="no");f=f&&this.ErrList.Count()==0&&c&&!this.Aborted;var B=new IDPreparedStatement(true);B.SetCommand("update ZZ_SYNC set DNA=?, DOCDOM=?, TS=?, CONTENT=? where ID=1");B.AddParameter(new IDVariant(v.GetAttribute("maxid")));B.AddParameter(new IDVariant(v.GetAttribute("dom")));B.AddParameter(this.Completed&&f?IDL.Now():q);B.AddParameter(new IDVariant(v.GetAttribute("lastdoc")));this.DB.DBO().ExecuteIDPS(B,false);this.DB.DBO().Execute("delete from ZZ_SYNC where STATUS NOT IN ('.','0','1','2')");this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",605,"SyncToServer","End synchronization. Server MaxID="+v.GetAttribute("maxid"));if(!this.Completed){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",605,"SyncToServer","Synchronization is not yet completed. Running again.");this.MainFrm.DTTObj.AddMsgToken("","Aborted",this.Aborted)}}if(k){this.DB.CommitTrans()}j=false};this.DB.DBO().ExecuteTrans(SyncService.prototype.SyncToServerTR,this)}}catch(d){throw d}finally{this.IsSynchronizing=false;this.DontAddVariations=false;if(this.ResetSchemaCache){this.MainFrm.SchemaCache.clear()}this.ResetSchemaCache=false;this.ClassToResync.Clear()}this.ClientElapsedTime=(new Date()).getTime()-this.StartSyncTS.getTime()-this.ServerElapsedTime-this.NetworkElapsedTime;return f}else{this.ServerErrList=null;var g={DBNAME:this.DB.DefaultConnStr(),SERVERURL:this.ServerURL,USERNAME:this.ClientUsername,PASSWORD:this.ClientPassword,CONTIM:this.ConnectionTimeout,MAXDOCS:this.MaxDocuments,PRECOUNT:this.PreCount?"1":"0",SESSFLAGS:this.SessionFlags,CLASSTORESYNC:this.ClassToResync.join(",")};this.MainFrm.ShellObject.SendCmd("SYNC_START",g);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",603,"SyncToServer","Native synchronization started (Async="+b+"); for more detail see debug of shell");if(b){return true}this.MainFrm.StartPhase(0,this.MainFrm.RTCObj.GetConst("F163BC6B-AB8F-46bc-BCCD-74BBF92B0154","Sincronizzazione in corso...",false),this.CanAbort());var a=0;while(a>=0&&a<1){IDL.Sleep(500);var h=!this.MainFrm.TrackPhase(a*100,100);a=this.GetProgress(h).dblValue();if(a==-1){this.Aborted=true}}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",603,"SyncToServer","Native synchronization terminated (Success="+(a==1)+")");return(a==1)}};SyncService.prototype.GetClientVariations=function(j){var m="select ID, DNA, STATUS, CONTENT from ZZ_SYNC where STATUS NOT IN ('.','0','1','2') order by ID";var k=this.DB.DBO().OpenRS(m);if(k.RecordCount()>0){k.MoveFirst()}while(!k.EOF()){var b=k.Get(1).stringValue();var f=k.Get(2).stringValue();var h=k.Get(3).stringValue();var d=k.Get(4).stringValue();k.MoveNext();var e=false;for(var g=0;g<this.ClassToResync.Count();g++){var l=this.ClassToResync[g];var c='"'+l+'"';var a=f.indexOf(c);if(a>-1&&f.indexOf("}{",a)==-1){e=true;break}}if(e){continue}j+='<do ss_id="'+b+'"';j+=' ss_dna="'+Glb.HTMLEncode(f)+'"';j+=' ss_stt="'+h+'"';if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",606,"GetClientVariations","Send ID="+b+", ST="+h+", dna="+f);this.MainFrm.DTTObj.AddMsgToken("","Content",d)}if(d.length>3){j+=d.remove(0,3)}else{j+="/>"}}return j};SyncService.prototype.SyncToLocal=function(a,h){var k=new XMLDoc();var l=a.GetNextNode();if(l!=null&&l.Name()!="qry"){this.IsSynchronizing=true}try{if(l!=null){var g=l.GetAttribute("username");var b=l.GetAttribute("password");var q=parseInt(l.GetAttribute("from"),10);this.MaxDocuments=parseInt(l.GetAttribute("max"),10);this.set_NativeSync(l.GetAttribute("native")=="1");if(l.GetAttribute("precount").length>0){this.PreCount=true}this.TotalDocuments=0;this.LastDocument=l.GetAttribute("lastdoc");var y=this.LastDocument;var f=this.LastDocument!="";this.Completed=true;this.MainFrm.set_UserName(new IDVariant(this.Username));var j=new IDVariant(l.GetAttribute("dom"));var u=new IDVariant(l.GetAttribute("ts"));u.changeType(IDVariant.DATETIME);var n=new IDVariant();this.MainFrm.OnSynchronize(new IDVariant(this.Username),new IDVariant(this.Password),j,u,n);if(n.isTrue()){var c=k.AddNewElement(l.Name());c.SetAttribute("canceled","yes");if(this.CancelReason.length>0){c.SetAttribute("cancelReason",this.CancelReason)}}else{if(l.Name()=="qry"){var c=k.AddNewElement("qry");this.ExecQuery(c,l,j,h)}else{if(l.Name()=="sc"){var c=k.AddNewElement("sc");this.ExecSyncCollection(c,l,j)}else{if(l.Name()=="gl"){var c=k.AddNewElement("gl");this.ExecGetLock(c,l,j)}else{if(l.Name()=="ss"){if(!this.CheckTables()){throw new Error("CheckTables failed")}this.DeleteOldVariations();this.ErrList.Clear();this.ConflictList.Clear();this.ConflictPropList.Clear();this.MDMap.Clear();if(this.DocToSync.Count()==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",630,"SyncToLocal","There is no class to synchronize")}var x=0;var t="select max(ID) from ZZ_SYNC";var d=this.DB.DBO().OpenRS(t);if(d.RecordCount()>0){d.MoveFirst();x=d.Get(1).intValue()}if(this.TestSessionFlag(SyncService.FL_SYNCME)){this.ProcessAndSave(l,j.stringValue(),10)}var c=k.AddNewElement("ss");var o=this.GetServerVariations(c,j.stringValue(),l,q,x,u);if(f||this.PreCount){c.SetAttribute("maxid",q.toString())}else{c.SetAttribute("maxid",o.toString())}c.SetAttribute("dom",j.stringValue());if(this.PreCount){c.SetAttribute("total",this.TotalDocuments.toString())}for(var r=0;r<this.ClassToResync.Count();r++){var m=this.ClassToResync[r];this.GetAllDocumentClass(c,j.stringValue(),m,u)}this.ClassToResync.Clear();if(this.PreCount){this.LastDocument=y}c.SetAttribute("lastdoc",this.LastDocument);if(!this.Completed||f||this.PreCount){c.SetAttribute("completed","no")}this.ResyncErrors(c);if(this.iNativeSync){this.GetAllMD(c)}}}}}}}}catch(v){k=new XMLDoc();var c=k.AddNewElement(l.Name());c.SetAttribute("error",Glb.HTMLEncode(v));this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",608,"SyncToLocal","Synchronization aborted due to an exception: "+v.message);WriteToConsoleError("Synchronization aborted due to an exception: "+v.message)}finally{this.IsSynchronizing=false;k.GetRootNode().SetAttribute("elapsedMS",(new Date()).getTime()-this.MainFrm.StartRequestTS.getTime())}return k};SyncService.prototype.ProcessAndSave=function(g,c,l){var d=new IDMap();var a=new ArrayList();var b=true;while(g.HasNextNode()){var f=g.GetNextNode();var m=this.ProcessVariation(f,c,d,a);b=b&&m;this.UpdateProgressBar(l)}var h=true;while(h){h=false;this.ErrList.Clear();for(var e=0;e<a.Count();e++){var n=a[e];var k=n.GetMD();var j=(l==11&&k.FastResync&&n.IsInserted);if(j||n.Validate(l)){if(n.SaveToDB(9999,false)){if(!this.ResetSchemaCache){if(k.DBCode=="DO_SCHEME"||k.DBCode=="DO_PROPSCHEME"){this.ResetSchemaCache=true}}h=true;this.ActualDocument++;this.UpdateProgressBar(l)}else{this.ErrList.Add(n)}}else{this.ErrList.Add(n)}}if(this.ErrList.Count()==0){h=false}else{if(h){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",607,"ProcessAndSave",this.ErrList.Count().toString()+" documents cannot be saved. Trying again...")}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",608,"ProcessAndSave",this.ErrList.Count().toString()+" documents cannot be saved.")}a.Clear();a.AddRange(this.ErrList)}}if(!b){this.UpdatePanels()}return b};SyncService.prototype.UpdateProgressBar=function(a){if(a!=11){return}if((this.ProcessedDocs+this.ActualDocument)%100>0){return}this.ClientElapsedTime=(new Date()).getTime()-this.StartSyncTS.getTime()-this.ServerElapsedTime-this.NetworkElapsedTime;var b;if(this.TotalDocuments==-1){b=this.ProcessedDocs+this.ActualDocument+(this.MaxDocuments*2)}else{b=this.TotalDocuments*2}this.Aborted=!this.MainFrm.TrackPhase(this.ProcessedDocs+this.ActualDocument,b)};SyncService.prototype.ProcessVariation=function(t,j,c,m){var k=true;if(t.Name()=="rs"){var b=t.GetAttribute("cls");if(b!=""){this.ResyncClass(b)}return k}if(t.Name()!="do"){return k}var B=t.GetAttribute("ss_dna");var z=t.GetAttribute("ss_stt");var g=t.GetAttribute("ss_id");var l=t.GetAttribute("ss_err");var d=(g=="0");var L;if(l!="2"){L=this.GetFromCompleteDNA(B,c,m,true,false,z);this.ProcessedDocs++}else{L=this.GetFromCompleteDNA(B,new IDMap(),new ArrayList(),true)}if(L==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",609,"ProcessVariation","Cannot get document from DNA "+B);return k}var M=null;if(l.length>0){if(l=="1"){M=L.CreateDocument(L.TypeName());if(z=="I"){M.set_Inserted(true)}else{if(z=="D"){M.set_Deleted(true)}else{M.set_Updated(true)}}}else{if(l=="2"){M=L}}this.ServerErrList.Add(M)}if(!this.VerifyDocDomain(L,j)){return k}var I=this.GetUIDocs(L);var h=this.DontSyncMap.get_Object(new IDVariant(L.TypeName()));if(h==null){this.DontSync(L,0);L.GetNamedPropertyValue("DO_DONTSYNC");h=this.DontSyncMap.get_Object(new IDVariant(L.TypeName()))}var f=this.OptLockList.IndexOf(L.TypeName())>-1;if(z=="D"){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",611,"ProcessVariation",L.GetName(1)+": deleted")}L.set_Deleted(true);var s=I.GetLoopCollection();for(var E=0;E<s.Count();E++){var y=s[E];y.set_Deleted(true);if(y.ParentCollection()!=null){y.ParentCollection().PurgeDeleted()}}}else{if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",612,"ProcessVariation",L.GetName(1)+": updated")}var D=L.GetMD();var r=d&&!L.Loaded()&&D.FastResync;if(!r){L.BeginTrans()}if(d&&L.Loaded()){for(var E=1;E<=D.GetNumProp();E++){L.SetPropByIndex(E,new IDVariant())}}while(t.HasNextAttribute()){var A=new IDVariant();var o=new IDVariant();t.GetNextAttribute(A,o);var K=A.stringValue();if(K.startsWith("ss_")){continue}if(o.stringValue().equals(SyncService.NULL_Marker)){o=new IDVariant()}else{if(d){o=new IDVariant(Glb.HTMLDecode(o.stringValue(),true))}}if(K.endsWith("_old")){continue}if(K.endsWith("_err")){var a=K.substring(0,K.length-4);var C=L.GetPropertyIndex(a,false,false,false,true);if(C>0){var e=Glb.HTMLDecode(o.stringValue(),true);var s=I.GetLoopCollection();for(var E=0;E<s.Count();E++){var y=s[E];y.SetPropError(C,e)}M.SetPropError(C,e);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",614,"ProcessVariation",M.GetName(1)+": server error while saving document: property "+D.GetProp(C).UIName+": "+e);k=false}continue}var x=0;if(d&&D.FastResync){x=parseInt(K.substring(1),10)}else{x=L.GetPropertyIndex(K,false,false,false,true)}if(x==0){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&!K.startsWith("ss_")){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",613,"ProcessVariation",L.GetName(1)+" property "+A.stringValue()+" not found. Try using a named property")}L.SetNamedPropertyValue(K,o)}else{if(h==null||h[x-1]){var J=D.GetProp(x);if(o.Type!=IDVariant.NULL){o.changeType(IDL.DataType2IDVariantType(J.DataType))}var q=true;if(f&&J.DataType!=Glb.DT_DOC_OLE&&this.TestSessionFlag(SyncService.FL_USEOPTLOCK)&&!this.DontAddVariations){var F=new IDVariant(t.GetAttribute(J.ObjTag+"_old"));if(F.stringValue().equals(SyncService.NULL_Marker)){F=new IDVariant()}else{F.changeType(IDL.DataType2IDVariantType(J.DataType))}if(!F.equals(L.GetPropOrigValue(x))){q=false}}if(M&&M!=L){M.SetPropDirect(x,o)}if(q){this.TotalChanges++;if(r){L.SetPropDirect(x,o)}else{L.SetPropByIndex(x,o);var s=I.GetLoopCollection();for(var E=0;E<s.Count();E++){var y=s[E];var G=y.Updated();y.SetPropByIndex(x,o);y.SetPropOrigValue(x,o);y.set_Updated(G)}}}else{if(this.ConflictList.IndexOf(L)==-1){this.ConflictList.Add(L)}this.ConflictPropList.Add(L.GetDNA()+"§§§"+x.toString())}}}}if(!r){L.EndTrans()}var u=1;while(true){var H=t.GetAttribute("do_err"+u);if(H!=""){var s=I.GetLoopCollection();for(var E=0;E<s.Count();E++){var y=s[E];y.AddDocError(H)}M.AddDocError(H);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",614,"ProcessVariation",M.GetName(1)+": server error while saving document: "+H);k=false}else{break}u++}}return k};SyncService.prototype.GetFromCompleteDNA=function(u,g,m,o,s,q){if(s==undefined){s=false}if(q==undefined){q=null}var l=null;if(u.length<2){return null}if(u.charAt(0)!="{"&&u.charAt(u.length-1)!="}"){return null}u=u.substr(1,u.length-2);var t=u.indexOf("}{");var e=0;var b=true;while(b){b=false;var z=u.substr(e);if(t>0){b=true;z=u.substr(e,t-e);e=t+2;t=u.indexOf("}{",t+1)}if(s&&b){continue}if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",614,"GetFromCompleteDNA","searching for "+z)}if(l==null){l=g.get_Object(new IDVariant(z));if(l!=null&&l.IsDeleted&&!b){l=this.MainFrm.GetFromDNA(new IDVariant(z),false,0,true);l.Init();g.set_Object(new IDVariant(z),l);m.Add(l)}if(l==null&&o){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",615,"GetFromCompleteDNA","creating base object "+z)}l=this.MainFrm.GetFromDNA(new IDVariant(z),false,0,s);if(l!=null){if(!l.Loaded()&&!s){if(!this.MainFrm.ParamsObj().UseRD4&&"U"==q){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",624,"GetFromCompleteDNA","The client has updated this document, while here is deleted. I reject the variation")}return null}l.Init()}g.set_Object(new IDVariant(z),l);m.Add(l)}else{if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",616,"GetFromCompleteDNA","cannot create base object "+z)}return null}}}else{if(l.Loaded()){l.LoadFromDB(1)}var k=false;var y=l.GetMD();for(var x=1;x<=y.GetNumColl();x++){var A=l.GetCollByIndex(x);A.MoveFirst();while(!A.IsEof()){var r=A.GetAt();if(r.GetDNA().stringValue()==z){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",617,"GetFromCompleteDNA","document found in collection "+z)}var h=g.get_Object(new IDVariant(z));if(h!=null&&r!=h&&!h.IsDeleted){A.RemoveAt();A.Add(h);A.Parent().ReconnectChildren(1);r=h}else{g.set_Object(new IDVariant(z),r)}l=r;k=true;break}A.MoveNext()}if(k){break}}if(!k&&o){var a=new StringTokenizer();a.setString(new IDVariant(z),new IDVariant(","));var n=a.next().stringValue();if(n==""){return null}var v=n.indexOf("|");if(v>-1){n=n.substr(v+1)}v=n.indexOf("$");if(v>-1){n=n.substr(v+1)}for(var x=1;x<=y.GetNumColl();x++){var j=y.GetColl(x);if(j.ChildrenName==n){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",618,"GetFromCompleteDNA","creating child document in collection "+z)}var A=l.GetCollByIndex(x);var f=g.get_Object(new IDVariant(z));if(f==null||f.IsDeleted){f=l.CreateDocument(n);f.Init();g.set_Object(new IDVariant(z),f)}A.Add(f);A.Parent().ReconnectChildren(1);l=f;k=true;break}}}if(!k){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",619,"GetFromCompleteDNA","no collection can contain "+z)}return null}}if(l==null){b=false}}return l};SyncService.prototype.GetServerVariations=function(z,a,y,g,u,F){var I=g;var B="select max(ID) from ZZ_SYNC where STATUS NOT IN ('0','1','2')";var m=this.DB.DBO().OpenRS(B);if(m.RecordCount()>0){m.MoveFirst();I=m.Get(1).intValue()}if(!this.TestSessionFlag(SyncService.FL_SYNCPARTNER)){return I}B="select ID from ZZ_SYNC where ID = "+g.toString();m=this.DB.DBO().OpenRS(B);if(m.RecordCount()==0){this.ClassToResync.Clear()}if(m.RecordCount()==0||(this.LastDocument!=""&&this.ClassToResync.Count()==0)){z.SetAttribute("resync","yes");if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){if(this.LastDocument!=""){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",620,"GetServerVariations","Continue complete resync from document "+this.LastDocument)}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",620,"GetServerVariations","Client maxID="+g+" not found, perform full data download")}}this.GetAllDocuments(z,a,F);return I}var d=new IDVariant(a);var s=new IDVariant();IDL.LikeEscape(this.DB.DBaseType(),d,s);d=new IDVariant(d.stringValue()+"%");var f=new IDVariant("DOCDOM like "+IDL.Quote(d)+s.stringValue()+" or DOCDOM is null");this.MainFrm.OnSyncFilter(new IDVariant(a),f);var j=" and STATUS NOT IN ('0','1','2')";if(this.PreCount){B="select COUNT(*) from ZZ_SYNC where ID>"+g.toString();B+=j;B+=" and ("+f.stringValue()+")"}else{B="select ID, DNA, STATUS, CONTENT from ZZ_SYNC where ID>"+g.toString();B+=j;B+=" and ("+f.stringValue()+") order by ID";if(this.MaxDocuments>0){this.DB.DBO().MaxRows=this.MaxDocuments+1}}m=this.DB.DBO().OpenRS(B);if(m.RecordCount()>0){m.MoveFirst()}if(this.PreCount){this.TotalDocuments=m.Get(1).intValue();return g}if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",621,"GetServerVariations","Sending "+m.RecordCount()+" variations to client")}while(!m.EOF()){var D=m.Get(1).stringValue();var t=m.Get(2).stringValue();var x=m.Get(3).stringValue();var r=m.Get(4).stringValue();var k=parseInt(D,10);if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",622,"GetServerVariations","Send ID="+D+", ST="+x+", dna="+t);this.MainFrm.DTTObj.AddMsgToken("","Content",r)}var b=this.GetChangedAttr(t,y);var A=true;if(A&&b.ContainsKey(new IDVariant("do_deleted"))){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",623,"GetServerVariations","The client has deleted this document, cannot send data")}A=false}if(A){var c=null;var e=null;var N=null;if(this.iNativeSync){c=this.GetFromCompleteDNA(t,new IDMap(),new ArrayList(),true,true);N=c;e=c.GetMD()}while(e!=null||!this.iNativeSync){if(!this.iNativeSync||e.DBCode!=null){var C=false;var E=z.AddNewElement("do");E.SetAttribute("ss_id",D);if(this.iNativeSync){E.SetAttribute("ss_dna",e.DBCode)}else{E.SetAttribute("ss_dna",t)}if(r!=""){var h=new XMLDoc();if(!h.LoadFromString(r)){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"GetServerVariations","Parse XML failed")}}var K=h.GetNextNode();while(K.HasNextAttribute()){var J=new IDVariant();var H=new IDVariant();K.GetNextAttribute(J,H);var O;if(k<=u){O=!b.ContainsKey(J)}else{O=!H.equals(b.get_Value(J));if(x=="I"&&b.Size()>0){x="U"}}if(O){if(this.iNativeSync){var L=J.stringValue();var l=0;for(var M=1;M<=e.GetNumProp();M++){var q=e.GetProp(M);if(q.DBCode==null||q.DBCode.length==0){continue}if(M<=e.BaseProps&&!q.PK){continue}l++;if(L==q.ObjTag){E.SetAttribute("P"+l,H.stringValue());C=true;break}}}else{E.SetAttribute(J.stringValue(),H.stringValue());C=true}}else{if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",625,"GetServerVariations","Purging "+J.stringValue())}}}}E.SetAttribute("ss_stt",x);if(!C&&(x=="I"||x=="U")){z.RemoveNode(E)}else{if(this.iNativeSync){if(x=="D"||x=="U"){var l=0;for(var M=1;M<=e.GetNumProp();M++){var q=e.GetProp(M);if(q.DBCode==null||q.DBCode.length==0){continue}if(M<=e.BaseProps&&!q.PK){continue}l++;if(q.PK){E.SetAttribute("P"+l,this.ValueToString(c.GetPropByIndex(M)))}}}MDMap[N.GetDNA().stringValue().split(",")[0]]=e}}}if(this.iNativeSync){e=e.BaseMD;if(e!=null){N=new N.GetClass()();var G=null;var o=N.GetClass().GetClassName(true);if(o.indexOf(".")!=-1){G=c.GetMainFrm().GetCompFromNameSpace(o.substring(0,o.lastIndexOf(".")))}else{G=this.MainFrm}N.SetMainFrm(G,G.getIMDB())}}else{break}}}m.MoveNext();if(this.MaxDocuments>0){this.MaxDocuments--;if(this.MaxDocuments==0){this.Completed=m.EOF();I=k;break}}}return I};SyncService.prototype.GetChangedAttr=function(d,f){var a=new IDMap();f.Reset();while(f.HasNextNode()){var c=f.GetNextNode();if(c.GetAttribute("ss_dna")==d){if(c.GetAttribute("ss_stt")=="D"){a.Clear();a.set_Value(new IDVariant("do_deleted"),IDVariant.TRUE);return a}while(c.HasNextAttribute()){var e=new IDVariant();var b=new IDVariant();c.GetNextAttribute(e,b);a.set_Value(e,b)}}}return a};SyncService.prototype.ResyncErrors=function(f){var h=new ArrayList();for(var d=0;d<this.ErrList.Count();d++){var c=this.ErrList[d];MDOInit.GetDocErrorList(c,h)}if(this.TestSessionFlag(SyncService.FL_RESYNCPARTNER)){for(var d=0;d<h.Count();d++){var c=h[d];c.set_Loaded(false);c.LoadFromDB(0)}}for(var d=0;d<this.ConflictList.Count();d++){var c=this.ConflictList[d];var g=c.GetDNA().stringValue();for(var b=0;b<this.ConflictPropList.Count();b++){var e=this.ConflictPropList[b];if(e.startsWith(g+"§§§")){var a=parseInt(e.substr(e.indexOf("§§§")+3),10);if(a>0){c.SetPropError(a,"Already changed by another user")}}}if(h.IndexOf(c)==-1){h.Add(c)}}this.ResyncDocuments(f,h,true)};SyncService.prototype.ResyncDocuments=function(d,e,a){for(var c=0;c<e.Count();c++){var b=e[c];this.GetAllDocument(d,b,a)}};SyncService.prototype.GetAllDocuments=function(e,a,d){for(var b=0;b<this.DocToSync.Count();b++){var c=this.DocToSync[b];this.GetAllDocumentClass(e,a,c,d);if(!this.Completed){break}}};SyncService.prototype.GetAllDocumentClass=function(m,g,y,A){var t=new StringTokenizer();if(this.LastDocument!=""){t.setString(new IDVariant(this.LastDocument));if(t.hasNext()){var d=t.next().toString();if(!d.equals(y)&&!d.endsWith("$"+y)){return}}else{return}}var r=this.MainFrm.GetFromDNA(new IDVariant(y),true,0);if(r!=null){var u=r.GetDNA().stringValue().Replace('"',"").Replace(",","");if(u!=y&&!u.endsWith("$"+y)&&this.DocToSync.indexOf(u)!=-1&&m.GetAttribute("resync").equals("yes")){return}var B=new IDCollection();if(this.MaxDocuments>0&&!this.PreCount){B.MaxRows=this.MaxDocuments+1}var E=r.GetMD();var q=E.DBObj;if(q==null){q=r.GetDBObj(false)}var a=t.Count().intValue()-1;var k=new Array();var e=0;for(var x=1;x<=E.GetNumProp();x++){var D=E.GetProp(x);if(D.PK){var b=t.next();MDOInit.ConvertVariant(b,D);for(var v=0;v<a-e;v++){if(k[v]==undefined){k[v]=""}else{k[v]+=" and "}var z=r.GetDBExpr(D.Index);if(z.length==0){z=(E.BaseMD!=null&&E.DBCode!=null?E.DBCode+".":"")+D.DBCode}k[v]+=z+(v<a-e-1?"=":">")+Glb.ToSql(b,E.GetDBType(),q)}e++;B.SortBy(x)}}var h=null;if(a>0){h="(("+k[0]+")";for(var x=1;x<a;x++){h+=" or ";h+="("+k[x]+")"}h+=")"}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",626,"GetAllDocumentClass","Firing event OnResyncClient for document "+y);var s=new IDVariant(false);var l=new IDVariant();r.OnResyncClient(B,new IDVariant(g),A,s,l);this.LastDocument="";var C;if(s.isFalse()){C=r.LoadCollectionBE(B,true,0,h,this.PreCount)}else{C=l.intValue()}if(this.PreCount){this.TotalDocuments+=C;return}var n=B.Count();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",627,"GetAllDocumentClass",B.Count().toString()+" documents found");var o=B.GetLoopCollection();for(var x=0;x<o.Count();x++){var f=o[x];this.GetAllDocument(m,f,false);n--;if(this.MaxDocuments>0){this.MaxDocuments--;if(this.MaxDocuments==0&&n>=0){this.LastDocument=f.GetDNA().stringValue();this.Completed=false;break}}}}};SyncService.prototype.GetAllDocument=function(e,q,n){var a=q.GetMD();var f=q;while(a!=null){if(!this.iNativeSync||a.DBCode!=null){var d=e.AddNewElement("do");d.SetAttribute("ss_id","0");d.SetAttribute("ss_dna",(this.iNativeSync?a.DBCode:this.GetCompleteDNA(q)));if(q.Deleted()){d.SetAttribute("ss_stt","D")}else{d.SetAttribute("ss_stt","I")}if(this.iNativeSync){this.MDMap[f.GetDNA().stringValue().split(",")[0]]=a}var l=this.DontSyncMap.get_Object(new IDVariant(q.TypeName()));if(l==null){this.DontSync(q,0);q.GetNamedPropertyValue("DO_DONTSYNC");l=this.DontSyncMap.get_Object(new IDVariant(q.TypeName()))}var m=0;for(var b=1;b<=a.GetNumProp();b++){var r=q.GetPropByIndex(b);var k=a.GetProp(b);if(this.iNativeSync&&(k.DBCode==null||k.DBCode.length==0||(b<=a.BaseProps&&!k.PK))){m++;continue}if(l!=null&&!l[b-1]){continue}if(r.Type!=IDVariant.NULL&&(!n||this.TestSessionFlag(SyncService.FL_RESYNCPARTNER))){d.SetAttribute(a.FastResync?"P"+(b-m):k.ObjTag,Glb.HTMLEncode(this.ValueToString(r),false,false,true))}if(n){var t=q.GetPropError(b);if(t!=null){d.SetAttribute("ss_err",(this.TestSessionFlag(SyncService.FL_RESYNCPARTNER)?"1":"2"));d.SetAttribute(k.ObjTag+"_err",Glb.HTMLEncode(t))}}}if(n){var g=new ArrayList();q.GetDocErrors(g);if(g.Count()>0){var j=1;d.SetAttribute("ss_err",(this.TestSessionFlag(SyncService.FL_RESYNCPARTNER)?"1":"2"));for(var b=0;b<g.Count();b++){d.SetAttribute("do_err"+j,g[b]);j++}}}}if(this.iNativeSync){a=a.BaseMD;if(a!=null){f=new f.GetClass()();var o;var h=f.GetClass().GetClassName(true);if(h.indexOf(".")!=-1){o=q.GetMainFrm().GetCompFromNameSpace(h.substring(0,h.lastIndexOf(".")))}else{o=this.MainFrm}f.SetMainFrm(o,o.getIMDB())}}else{break}}};SyncService.prototype.GetUIDocs=function(n){var b=new IDCollection();for(var e=0;e<this.MainFrm.StackForm.Count();e++){var g=this.MainFrm.StackForm[e];for(var d=0;d<g.Frames.length;d++){var h=g.Frames[d];if(h==null){continue}var a=h.Content;if(a==null){continue}if(a instanceof IDPanelSrv){if(a.pCollection()!=null){var o=a.pCollection().GetLoopCollection();for(var c=0;c<o.Count();c++){var l=o[c];this.SearchForDocs(b,l,n)}}else{if(a.pDocument()!=null){this.SearchForDocs(b,a.pDocument(),n)}}}if(a instanceof ATreeSrv){for(var c=0;c<a.Nodes.Count();c++){var m=a.Nodes[c];if(m.Doc!=null&&m.Parent==null){this.SearchForDocs(b,m.Doc,n)}}}}}return b};SyncService.prototype.SearchForDocs=function(k,l,b){if(l.TypeName()==b.TypeName()&&l.GetDNA().stringValue()==b.GetDNA().stringValue()){k.Add(l,null,true,false);return true}var d=l.GetMD();for(var g=1;g<=d.GetNumColl();g++){var h=d.GetColl(g);if(h.ChildrenName==b.TypeName()){var f=l.GetCollByIndex(g);var m=f.GetLoopCollection();for(var e=0;e<m.Count();e++){var a=m[e];if(this.SearchForDocs(k,a,b)){return true}}}}return false};SyncService.prototype.UpdatePanels=function(){for(var c=0;c<this.MainFrm.StackForm.Count();c++){var e=this.MainFrm.StackForm[c];for(var b=0;b<e.Frames.length;b++){var a=e.Frames[b];if(a==null){continue}var d=a.Content;if(d==null){continue}if(d instanceof IDPanelSrv){if(d.pCollection()!=null||d.pDocument()!=null){d.DumpDOErrors()}}}}};SyncService.prototype.Query=function(a,g){if(g==undefined){g=null}if(this.CheckSyncServer()){var d=new IDCachedRowSet();var h="";h+='<qry username="'+Glb.HTMLEncode(this.ClientUsername)+'" ';h+='password="'+Glb.HTMLEncode(this.ClientPassword)+'" ';h+='cmd="'+Glb.HTMLEncode(a.stringValue())+'">';if(g!=null){for(var e=0;e<g.GetNative().length;e++){h+='<par val="'+Glb.HTMLEncode(g.GetNative()[e].stringValue())+'"/>'}}h+="</qry>";var j=new IDMap();j.set_Value(new IDVariant("SYNCDATA"),new IDVariant(h));j.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));j.set_Value(new IDVariant("FTR"),new IDVariant(this.ResponseFormat));j.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));if(this.ConnectionTimeout>0){j.set_Value(new IDVariant("ID_TIMEOUT"),new IDVariant(this.ConnectionTimeout))}var c=new Date();var b=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServerURL),j);var k=new Date();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"SyncService.Query","Received "+b.stringValue().length+" bytes from server");if(b.stringValue().length<20000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",b.stringValue())}if(this.ResponseFormat!=XMLDoc.FT_XML&&b.stringValue().startsWith("<")){this.ResponseFormat=XMLDoc.FT_XML}var l=new XMLDoc();if(!l.LoadFromString(b.stringValue(),this.ResponseFormat)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"SyncService.Query","Parse XML failed")}var f=l.GetRootNode();if(f!=null&&f.Name()=="qry"){this.UpdateElapdedTimes(f,k.getTime()-c.getTime());if(!this.CheckResponse(f,"SyncService.Query")){return null}if(this.ResponseFormat==XMLDoc.FT_XML){d.LoadFromXML(Glb.HTMLDecode(f.GetAttribute("rs"),true),true)}else{d.LoadFromXMLNode(f)}}this.MainFrm.DTTObj.AddQuery("SyncService.Query","Query: "+a.stringValue(),"SyncService.Query",DTTEngine.STMT_QRY_SELECT,a.toString());this.MainFrm.DTTObj.AddDBDataSource(d,a.toString());this.MainFrm.DTTObj.EndQuery("SyncService.Query");return d}else{return null}};SyncService.prototype.ExecQuery=function(a,f,h,d){var b=new IDCachedRowSet();var e=new IDVariant(f.GetAttribute("cmd"));var c=new IDArray();while(f.HasNextNode()){var g=f.GetNextNode();if(g.Name()=="par"){c.add_Value(new IDVariant(g.GetAttribute("val")))}}this.MainFrm.OnSyncQuery(e,c,h,b);if(d==XMLDoc.FT_XML){a.SetAttribute("rs",Glb.HTMLEncode(b.SaveToXML(true)))}else{b.SaveToXMLNode(a)}};SyncService.prototype.SyncDocument=function(c,a){if(a==undefined){a=9999}var b=new IDCollection();b.Add(c,null,true,false);return this.SyncCollection(b,a)};SyncService.prototype.SyncCollection=function(e,n){if(n==undefined){n=9999}if(!this.CheckSyncServer()){return false}var j="";j+='<sc username="'+Glb.HTMLEncode(this.ClientUsername)+'" ';j+='password="'+Glb.HTMLEncode(this.ClientPassword)+'" ';j+='numlev="'+n+'">';var a=e.GetLoopCollection();for(var f=0;f<a.Count();f++){var m=a[f];j+='<do dna="'+Glb.HTMLEncode(m.GetDNA())+'"/>'}j+="</sc>";var k=new IDMap();k.set_Value(new IDVariant("SYNCDATA"),new IDVariant(j));k.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));k.set_Value(new IDVariant("FTR"),new IDVariant(this.ResponseFormat));k.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));if(this.ConnectionTimeout>0){k.set_Value(new IDVariant("ID_TIMEOUT"),new IDVariant(this.ConnectionTimeout))}var d=new Date();var c=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServerURL),k);var l=new Date();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"SyncCollection","Received "+c.stringValue().length+" bytes from server");if(c.stringValue().length<20000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",c.stringValue())}if(this.ResponseFormat!=XMLDoc.FT_XML&&c.stringValue().startsWith("<")){this.ResponseFormat=XMLDoc.FT_XML}var o=new XMLDoc();if(!o.LoadFromString(c.stringValue(),this.ResponseFormat)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"SyncCollection","Parse XML failed")}var h=o.GetRootNode();if(h!=null&&h.Name()=="sc"){this.UpdateElapdedTimes(h,l.getTime()-d.getTime());if(!this.CheckResponse(h,"SyncCollection")){return false}while(h.HasNextNode()){var g=h.GetNextNode();if(g.Name()=="do"){var b=g.GetAttribute("dna");var a=e.GetLoopCollection();for(var f=0;f<a.Count();f++){var m=a[f];if(m.GetDNA().stringValue()==b){m.LoadFromXML(Glb.HTMLDecode(g.GetAttribute("cnt"),true),false);break}}}}}return true};SyncService.prototype.ExecSyncCollection=function(a,e,h){var d=parseInt(e.GetAttribute("numlev"),10);while(e.HasNextNode()){var g=e.GetNextNode();if(g.Name()=="do"){var f=g.GetAttribute("dna");var b=this.MainFrm.GetFromDNA(new IDVariant(f),false,d);if(b!=null){if(this.VerifyDocDomain(b,h.stringValue())){if(!b.Loaded()){b.set_Deleted(true)}var c=a.AddNewElement("do");c.SetAttribute("dna",f);c.SetAttribute("cnt",Glb.HTMLEncode(b.SaveToXML(false)))}}}}};SyncService.prototype.ReleaseLock=function(a){return this.GetLock(a,new IDVariant(),false)};SyncService.prototype.GetLock=function(k,e,a){if(e==undefined){e=new IDVariant()}if(a==undefined){a=true}if(!this.CheckSyncServer()){return false}var g=false;var f="";f+='<gl username="'+Glb.HTMLEncode(this.ClientUsername)+'" ';f+='password="'+Glb.HTMLEncode(this.ClientPassword)+'" ';f+='get="'+(a?"1":"0")+'" ';f+='dna="'+Glb.HTMLEncode(k.GetDNA())+'">';f+="</gl>";var h=new IDMap();h.set_Value(new IDVariant("SYNCDATA"),new IDVariant(f));h.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));h.set_Value(new IDVariant("FTR"),new IDVariant(this.ResponseFormat));h.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));if(this.ConnectionTimeout>0){h.set_Value(new IDVariant("ID_TIMEOUT"),new IDVariant(this.ConnectionTimeout))}var c=new Date();var b=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServerURL),h);var j=new Date();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"GetLock","Received "+b.stringValue().length+" bytes from server");if(b.stringValue().length<20000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",b.stringValue())}if(this.ResponseFormat!=XMLDoc.FT_XML&&b.stringValue().startsWith("<")){this.ResponseFormat=XMLDoc.FT_XML}var l=new XMLDoc();if(!l.LoadFromString(b.stringValue(),this.ResponseFormat)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"GetLock","Parse XML failed")}var d=l.GetRootNode();if(d!=null&&d.Name()=="gl"){this.UpdateElapdedTimes(d,j.getTime()-c.getTime());if(!this.CheckResponse(d,"GetLock")){return false}g=d.GetAttribute("ris")=="1";e.set(new IDVariant(Glb.HTMLDecode(d.GetAttribute("err"),true)))}return g};SyncService.prototype.ExecGetLock=function(a,d,g){var e=d.GetAttribute("dna");var c=this.MainFrm.GetFromDNA(new IDVariant(e),false,0);a.SetAttribute("ris","0");if(c!=null){if(this.VerifyDocDomain(c,g.stringValue())){if(d.GetAttribute("get")=="1"){var f=new IDVariant();var b=c.GetLock(9999,"",f);a.SetAttribute("ris",b?"1":"0");a.SetAttribute("err",Glb.HTMLEncode(f.stringValue()));c.set_Locked(false)}else{var b=c.ReleaseLock(9999);a.SetAttribute("ris",b?"1":"0")}}}};SyncService.prototype.VerifyDocDomain=function(b,e){var c=b;while(c!=null&&e!=""){var a=this.GetDomain(c).stringValue();if(a!=""){if(!a.startsWith(e)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",610,"VerifyDocDomain",b.GetName(1)+": client domain "+e+" cannot be match with document domain "+a+". The document won't be processed");return false}break}c=c.Parent()}return true};SyncService.prototype.AppendTo=function(a){for(var b=0;b<this.DocToSync.length;b++){a.AddDocToSync(this.MainFrm.CompNameSpace+"$"+this.DocToSync[b])}};SyncService.prototype.DeleteOldVariations=function(){if(this.MaxAge<=0){return}var b=IDL.Sub(IDL.Now(),new IDVariant(this.MaxAge,1));var a="delete from ZZ_SYNC where ID>1 and TS<"+Glb.ToSql(b,this.DB.DBaseType(),DB.DBO());this.DB.DBO().Execute(a)};SyncService.prototype.ValueToString=function(a){switch(a.Type){case 0:return SyncService.NULL_Marker;case 3:return IDL.FormatDate(a.dateValue(),"yyyy-mm-dd hh:nn:ss");default:return a.stringValue()}};SyncService.prototype.CheckSyncServer=function(){if(this.ServerURL==""){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",629,"CheckSyncServer","No sync server specified");return false}if(this.MainFrm.ShellObject&&this.MainFrm.ShellObject.IsInsideShell()&&this.CheckServer>0){if(!this.MainFrm.ShellObject.IsServerReachable(new IDVariant(this.ServerURL+"?WCI=ECHO"),new IDVariant(this.CheckServer))){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",629,"CheckSyncServer","Sync server "+this.ServerURL+" was not reached in "+this.CheckServer+" seconds");return false}}return true};SyncService.prototype.SetRTCDB=function(b,a){};SyncService.prototype.CheckResponse=function(a,c){this.CancelReason=a.GetAttribute("cancelReason");var d=a.GetAttribute("canceled");if(d=="yes"){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",605,c,"Synchronization canceled by the server");return false}var b=a.GetAttribute("error");if(b.length>0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",605,c,"Synchronization failed with error: "+Glb.HTMLDecode(b,true));return false}return true};SyncService.prototype.GetAllMD=function(a){};SyncService.prototype.EndSynchronization=function(a,b,h,e,l,j){if(e==undefined){e=-1}if(l==undefined){l=-1}if(j==undefined){j=""}if(b){this.MainFrm.SchemaCache.clear()}this.ClassToResync.Clear();this.TotalDocuments=e;this.TotalChanges=l;this.CancelReason=j;if(this.MainFrm.DTTObj.Level>0){var k=new IDCollection();var c=new IDCollection();this.GetAllDocsInError(k,c);k.MoveFirst();while(!k.IsEof()){var f=k.GetAt();this.DumpDocErrors(f,true);k.MoveNext()}c.MoveFirst();while(!c.IsEof()){var f=c.GetAt();this.DumpDocErrors(f,false);c.MoveNext()}}var g=new IDVariant(0);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,null,640,"SyncService.EndSynchronization","Native synchronization terminated: fire OnEndSynchronization event");this.MainFrm.OnEndSynchronization(new IDVariant(a),g,h);if(g.isFalse()&&h.Size()>0){this.RefreshPanels(h)}};SyncService.prototype.RefreshPanels=function(h){for(var c=0;c<this.MainFrm.StackForm.Count();c++){var d=this.MainFrm.StackForm[c];for(var b=0;b<d.Frames.length;b++){var e=d.Frames[b];if(e==null){continue}var a=e.Content;if(!a){continue}if(a instanceof IDPanelSrv){if(a.bQueries(0)==null){continue}if(a.IsIMDB()){continue}if(a.Status()==Glb.PS_QBE||a.IsContentModified()){continue}if(!a.IsDO()&&h.FindValue(new IDVariant(a.GetMasterTable(0)),false).intValue()!=-1){a.RefreshQuery(this.MainFrm);continue}if(a.IsDO()){var l=a.bQueries(0).DocTempl;if(l==null){l=a.bQueries(0).DocFilter}if(l==null){l=this.MainFrm.CreateDocument(a.GetMasterTable(0))}if(l==null){continue}var k=false;var g=l.GetMD();while(g!=null){if(h.FindValue(new IDVariant(g.DBCode),false).intValue()!=-1){k=true;break}g=g.BaseMD}if(k){if(a.bQueries(0).IsMasterDO){a.RefreshQuery(this.MainFrm)}else{if(a.MasterPanelIdx!=0&&a.bQueries(0).IDColl!=null){a.bQueries(0).IDColl.set_Loaded(false);a.CheckMasterDocument(true)}}}continue}}if(a instanceof ATreeSrv){if(!a.IsDO){continue}}}}};SyncService.prototype.ResumeDocSync=function(a){try{if(!this.CheckTables()){return true}var f=a.GetDNA().stringValue();var h="insert into ZZ_SYNC(STATUS, DNA, DOCDOM, CONTENT) select ";if(Glb.ClassDB(this.DB.DBaseType())==Glb.DBC_ACCESS){h+="IIF(STATUS='0', 'I', IIF(STATUS='1', 'U', 'D'))"}else{h+="CASE WHEN STATUS='0' THEN 'I' WHEN STATUS='1' THEN 'U' ELSE 'D' END"}var c=new IDVariant(f);var b=new IDVariant();IDL.LikeEscape(this.DB.DBaseType(),c,b);c=new IDVariant("%{"+c.stringValue()+"}");h+=", DNA, DOCDOM, CONTENT from ZZ_SYNC where DNA LIKE ?"+b.stringValue()+" and STATUS IN ('0','1','2')";this.MainFrm.DTTObj.AddQuery("SyncService.ResumeDocSync",a.GetName(1)+": Resuming variations","SyncService.ResumeDocSync",DTTEngine.STMT_QRY_INSSEL,h);this.MainFrm.DTTObj.AddParameter("","","DNA",f);var g=new IDPreparedStatement(true);g.SetCommand(h);g.AddParameter(c);this.DB.DBO().ExecuteIDPS(g,false);this.MainFrm.DTTObj.EndQuery("SyncService.ResumeDocSync");h="delete from ZZ_SYNC where DNA LIKE ?"+b.stringValue()+" and STATUS IN ('0','1','2')";this.MainFrm.DTTObj.AddQuery("SyncService.ResumeDocSync",a.GetName(1)+": Deleting temporary variations","SyncService.ResumeDocSync",DTTEngine.STMT_QRY_DELETE,h);this.MainFrm.DTTObj.AddParameter("","","DNA",f);g=new IDPreparedStatement(true);g.SetCommand(h);g.AddParameter(c);this.DB.DBO().ExecuteIDPS(g,false);this.MainFrm.DTTObj.EndQuery("SyncService.ResumeDocSync");return true}catch(d){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",601,"SyncService.ResumeDocSync","Unable to resume variations of "+a.GetName(1)+": "+d.Message);return false}};SyncService.prototype.UpdateElapdedTimes=function(b,c){if(b.GetAttribute("elapsedMS").length>0){var a=parseInt(b.GetAttribute("elapsedMS"));this.ServerElapsedTime+=a;this.NetworkElapsedTime+=c-a}};SyncService.prototype.GetElapsedTimes=function(b,f,d){if(this.NativeSync()&&this.ClientElapsedTime==0){var a=this.MainFrm.ShellObject.SendCmd("SYNC_ELAPSEDTIMES");var e=new XMLDoc();if(a.length>0&&e.LoadFromString(a,XMLDoc.FT_JSON)){var c=e.GetRootNode();b.set(new IDVariant(parseInt(c.GetAttribute("server"))));f.set(new IDVariant(parseInt(c.GetAttribute("network"))));d.set(new IDVariant(parseInt(c.GetAttribute("client"))));if(c.GetAttribute("final")=="1"){this.ServerElapsedTime=b.intValue();this.NetworkElapsedTime=f.intValue();this.ClientElapsedTime=d.intValue()}}}else{b.set(new IDVariant(this.ServerElapsedTime));f.set(new IDVariant(this.NetworkElapsedTime));d.set(new IDVariant(this.ClientElapsedTime))}};SyncService.prototype.GetTotalDocuments=function(){if(this.TotalDocuments!=-1){return this.TotalDocuments}else{return this.ProcessedDocs}};SyncService.prototype.GetAllDocsInError=function(h,a){try{if(this.NativeSync()&&this.ServerErrList==null){this.ServerErrList=new ArrayList();this.ErrList=new ArrayList();var s=this.MainFrm.ShellObject.SendCmd("SYNC_GETALLDOCSINERROR");var r=new XMLDoc();if(s.length>0&&r.LoadFromString(s,XMLDoc.FT_XML)){var l=r.GetRootNode();while(l.HasNextNode()){var g=l.GetNextNode();while(g.HasNextNode()){var d=g.GetNextNode();var m=IDDocument.GetFromDNA(new IDVariant(d.GetAttribute("ss_dna")),false,0,this.MainFrm,this.MainFrm.getIMDB(),true);if(!m){continue}while(d.HasNextAttribute()){var c=new IDVariant();var q=new IDVariant();d.GetNextAttribute(c,q);var k=c.stringValue();if(k.endsWith("_err")){var o=k.substring(0,k.length-4);var b=m.GetPropertyIndex(o,false,false,false,true);if(b>0){m.SetPropError(b,q.stringValue())}}else{if(k.startsWith("do_err")){m.AddDocError(q.stringValue())}}}if(g.Name()=="client"){this.ErrList.Add(m)}if(g.Name()=="server"){this.ServerErrList.Add(m)}}}}}if(this.ServerErrList!=null){for(var f=0;f<this.ServerErrList.Count();f++){h.Add(this.ServerErrList[f])}for(var f=0;f<this.ErrList.Count();f++){a.Add(this.ErrList[f])}}}catch(j){}};SyncService.prototype.DumpDocErrors=function(c,d){var a=new ArrayList();c.GetDocErrors(a);for(var b=0;b<a.Count();b=b+1){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",614,"DumpDocErrors",c.GetName(1)+": "+(d?"server":"client")+" error while saving document: "+a[b])}var f=c.GetMD();for(var b=1;b<=f.GetNumProp();b=b+1){var e=c.GetPropError(b);if(e!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",614,"DumpDocErrors",c.GetName(1)+": "+(d?"server":"client")+" error while saving document: property "+f.GetProp(b).UIName+": "+e)}}};function ADSEState(){this.ActualPosition=1;this.HideGroupLevel=-1}ADSEState.prototype.CopyFrom=function(a){this.ActualPosition=a.ActualPosition;this.HideGroupLevel=a.HideGroupLevel};function APage(g){this.PageNum;this.PageType;this.Width;this.Height;this.UM;this.Orientation;this.FitMode;this.ParentMastro;this.ReportStates=new ArrayList();this.Sections=new ArrayList();this.MastroBoxes=new ArrayList();this.RD3ObjMap=null;this.RD3ChangedObjects=null;if(g!=undefined){this.ParentMastro=g;this.PageType=g.PageType;this.Width=g.Width;this.Height=g.Height;this.UM=g.UM;this.Orientation=g.Orientation;this.FitMode=g.FitMode;var c=this.ParentMastro.Parent;var d=0;IDREGlb.SetArraySize(this.MastroBoxes,g.BoxList.Count());for(var a=0;a<g.BoxList.Count();a++){var f=g.BoxList[a];var h=true;if(!f.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){if(c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(f.BoxID),481,"APage.<constructor>","Box "+c.Parent.GetObjName(f.BoxID)+": Not used because it's invisible by design")}h=false}if(c.IsPrinting&&!f.GetFlag(IDREGlb.FL_RPTBOX_TOPRINT)){if(c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(f.BoxID),482,"APage.<constructor>","Box "+c.Parent.GetObjName(f.BoxID)+": Not used because the flag ShowWhenPrinted is disabled and the book is printing")}h=false}if(!c.IsPrinting&&!f.GetFlag(IDREGlb.FL_RPTBOX_TOPREVIEW)){if(c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(f.BoxID),483,"APage.<constructor>","Box "+c.Parent.GetObjName(f.BoxID)+": Not used because the flag ShowWhenPreviewed is disabled and the book is shown in preview")}h=false}if(h){var e=f.GetARptBox(null);e.ParentPage=this;this.MastroBoxes[d++]=e}}IDREGlb.SetArraySize(this.MastroBoxes,d)}}APage.prototype.GetRect=function(a){var b=this.ParentMastro.Parent;switch(a){case IDREGlb.RECT_WIDTH:return b.ConvertFromInternalValue(this.Width);case IDREGlb.RECT_HEIGHT:return b.ConvertFromInternalValue(this.Height)}return 0};APage.prototype.SetRect=function(a,c){var b=this.ParentMastro.Parent;switch(a){case IDREGlb.RECT_WIDTH:this.Width=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_HEIGHT:this.Height=b.ConvertToInternalValue(c);break}};APage.prototype.GetState=function(b){for(var c=0;c<this.ReportStates.Count();c++){var a=this.ReportStates[c];if(a.ParentReport==b){return a}}return null};APage.prototype.GetMastroBox=function(c){for(var a=0;a<this.MastroBoxes.Count();a++){var d=this.MastroBoxes[a];if(d.ParentRptBox==c){return d}}return null};APage.prototype.FindObject=function(d){if(this.ParentMastro==d){return this}for(var a=0;a<this.MastroBoxes.Count();a++){var e=this.MastroBoxes[a];if(e!=null&&e.ParentRptBox==d){return e}for(var f=0;f<e.Spans.Count();f++){var c=e.Spans[f];if(c.ParentRptSpan==d){return c}}}return null};APage.prototype.Arrange=function(){if(this.MastroBoxes.Count()==0){return}var l=(this.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.Width:this.Height);var c=(this.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.Height:this.Width);var h=(this.ParentMastro.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.ParentMastro.Width:this.ParentMastro.Height);var e=(this.ParentMastro.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.ParentMastro.Height:this.ParentMastro.Width);var k=h-l;var j=e-c;if(this.FitMode==IDREGlb.MASTRO_FM_NONE){k=j=0}if(this.FitMode==IDREGlb.MASTRO_FM_WIDTH){j=0}if(k!=0||j!=0){if(this.ParentMastro.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.ParentMastro.Parent.AddVerboseMsg(this.ParentMastro.Parent.Parent.GetRTCGuid(this.ParentMastro.MastroID),484,"APage.<constructor>","Page "+this.ParentMastro.Parent.Parent.GetObjName(this.ParentMastro.MastroID)+": Adapting page content to new page dimensions -> DeltaWidth = "+this.ParentMastro.Parent.InternalUnitToString(k)+", DeltaHeight = "+this.ParentMastro.Parent.InternalUnitToString(j))}var d=new ArrayList();for(var g=0;g<this.MastroBoxes.Count();g++){d.Add(this.MastroBoxes[g])}var f=new CBoxArranger();f.BookObj=this.ParentMastro.Parent;f.Init(d,k,j,new CRect(0,0,l,c));var a=100;if(this.ParentMastro.Parent.UM==IDREGlb.BOOKUM_INCH){a=254}if(f.BookObj.GridSize!=-1){a=f.BookObj.GridSize}f.Arrange(a);f.Apply(true)}};APage.prototype.RotateSections=function(r){var v;if(r==null){v=this.Sections}else{v=r.SubSections}var u,c=null;var n=-1;for(var h=0;h<v.Count();h++){var t=h;u=v[h];for(var x=0;x<u.BoxList.Count();x++){if(u.BoxList[x].SubSections!=null){this.RotateSections(u.BoxList[x])}}if(c==null&&!u.GetFlag(IDREGlb.FL_SECT_VERTICAL)){continue}if(c!=null&&u.ParentSection.SectType==IDREGlb.SECT_PAGEFOOTER&&u.MastroBox!=c.MastroBox){continue}if(c==null){n=t;c=u}if(u.MastroBox!=c.MastroBox||u.NumCol!=c.NumCol||h==v.Count()-1||!u.GetFlag(IDREGlb.FL_SECT_VERTICAL)){var m;if(u.MastroBox!=c.MastroBox){m=c.MastroBox.Height}else{m=u.YPos;if(u.NumCol==c.NumCol&&h==v.Count()-1){m+=u.Height}}if(c.NumCol>1&&c.GetFlag(IDREGlb.FL_SECT_VERTICAL)){var g=new ArrayList();for(var f=n;f<=t;f++){var o=v[f];if(o.ParentSection!=c.ParentSection||o.MastroBox!=c.MastroBox){continue}if(o.NumCol!=c.NumCol){break}g.Add(o)}if(g.Count()>c.NumCol){var l=Math.floor(g.Count()/c.NumCol);if((g.Count()%c.NumCol)!=0){l++}var k=(m-c.YPos)/l;var y=Math.floor((c.MastroBox.Width-(c.NumCol-1)*c.ColSpace)/c.NumCol);var j=0;var a=0;var d=c.YPos;for(var e=0;e<g.Count();e++){var q=g[e];q.XPos=j*(y+c.ColSpace);q.YPos=a*k+d;q.Height=k;a++;if(a==l){a=0;j++}}}}c=u;n=t}}};APage.prototype.GetRD3Ident=function(){return"pag:"+this.PageNum+":"+this.ParentMastro.Parent.FrIndex+":"+this.ParentMastro.Parent.Parent.Parent.Parent.FormIdx};APage.prototype.RD3RenderDifference=function(t,d,g){if(this.RD3ObjMap==null){this.RD3ObjMap=new HashTableSrv()}this.RD3ObjMap[this.GetRD3Ident()]=this;var f=(d?null:new BitArray(RD3Glb.PAG_MAXPROPS));var a=(d?true:this.CalcRD3Difference(g,f));var r=null;if(d){r=t.AddNewElement("pag")}if(r==null&&a){r=t.AddNewElement("chg")}if(r!=null){r.SetAttribute("id",this.GetRD3Ident())}if(d||a){for(var s=0;s<RD3Glb.PAG_MAXPROPS;s++){if(d||f[s]){this.SetRD3Property(s,r,d)}}}var u=(d)?r:t;var h=a;for(var x=0;x<this.MastroBoxes.Count();x++){var e=this.MastroBoxes[x];h|=e.RD3RenderDifference(u,d,g)}for(var x=0;x<this.Sections.Count();x++){var v=this.Sections[x];h|=v.RD3RenderDifference(u,d,g)}if(!d&&g!=null&&g.RD3ObjMap!=null){var j=g.RD3ObjMap.keys();for(var q=0;q<j.length;q++){var y=j[q];var c=g.RD3ObjMap[y];var l=this.RD3ObjMap[y];if(l==null){var k=null;if(y.substr(0,3)=="sec"){k=c.GetRD3Ident()}if(y.substr(0,3)=="box"){k=c.GetRD3Ident()}if(y.substr(0,3)=="spn"){k=c.GetRD3Ident()}if(k!=null){var m=u.AddNewElement("del");m.SetAttribute("id",k)}}}}this.RD3ChangedObjects=null;return h};APage.prototype.CalcRD3Difference=function(c,b){b[RD3Glb.PAG_PAGENUM]=(c!=null&&c.PageNum!=this.PageNum);b[RD3Glb.PAG_UM]=(c!=null&&c.UM!=this.UM);b[RD3Glb.PAG_WIDTH]=(c!=null&&(c.Width!=this.Width||c.Orientation!=this.Orientation));b[RD3Glb.PAG_HEIGHT]=(c!=null&&(c.Height!=this.Height||c.Orientation!=this.Orientation));b[RD3Glb.PAG_FITMODE]=(c!=null&&c.FitMode!=this.FitMode);for(var a=0;a<RD3Glb.PAG_MAXPROPS;a++){if(b[a]){return true}}return false};APage.prototype.SetRD3Property=function(a,e,d){switch(a){case RD3Glb.PAG_PAGENUM:e.SetAttribute("num",this.PageNum);break;case RD3Glb.PAG_WIDTH:var c=(this.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.Width:this.Height);e.SetAttribute("wid",c);break;case RD3Glb.PAG_HEIGHT:var b=(this.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.Height:this.Width);e.SetAttribute("hei",b);break;case RD3Glb.PAG_UM:if(this.UM==IDREGlb.BOOKUM_MM&&d){break}e.SetAttribute("um",(this.UM==IDREGlb.BOOKUM_MM)?"mm":"in");break;case RD3Glb.PAG_FITMODE:if(this.FitMode==IDREGlb.MASTRO_FM_NONE&&d){break}e.SetAttribute("fit",this.FitMode);break}};APage.prototype.RD3FindSpan=function(a){if(this.RD3ObjMap!=null){return this.RD3ObjMap[a]}else{var c=(a.indexOf("B")!=-1?"box:"+a.substr(a.indexOf("B")):"");var b=this.RD3FindBox(c);if(b!=null){for(var e=0;e<b.Spans.Count();e++){var d=b.Spans[e];if(d.GetRD3Ident()==a&&d.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){return d}}}return null}};APage.prototype.RD3FindBox=function(e){if(this.RD3ObjMap!=null){return this.RD3ObjMap[e]}else{for(var a=0;a<this.MastroBoxes.Count();a++){var f=this.MastroBoxes[a];if(f.GetRD3Ident()==e){return f}}for(var a=0;a<this.Sections.Count();a++){var d=this.Sections[a];var c=d.RD3FindBox(e);if(c!=null){return c}}return null}};APage.prototype.GetBoxesList=function(b){for(var a=0;a<this.Sections.Count();a++){var c=this.Sections[a];c.GetBoxesList(b)}};function AReportState(){this.Parent=null;this.ParentReport=null;this.DSEState=null;this.PrintPHPF=true;this.PrintedSomething=0;this.SectionStates=new ArrayList()}AReportState.prototype.GetState=function(a){for(var c=0;c<this.SectionStates.Count();c++){var b=this.SectionStates[c];if(b.ParentSection==a){return b}}return null};function ARptBox(){this.HashCode=Math.random();this.ParentSect=null;this.ParentPage=null;this.XPos=0;this.YPos=0;this.Width=0;this.Height=0;this.HRsz=IDREGlb.RSZ_NONE;this.VRsz=IDREGlb.RSZ_NONE;this.VisAttrIdx=-1;this.ImageIdx=0;this.LastColumnUsed=0;this.Interline=0;this.Stretch=IDREGlb.STRTC_AUTO;this.VisProp=-1;this.Rotation=0;this.Flags=0;this.ParentRptBox=null;this.BackColor=-1;this.ForeColor=-1;this.FontMod="";this.Alignment=IDREGlb.VISALN_AUTO;this.VAlignment=IDREGlb.VISVALN_TOP;this.Badge="";this.ClassName="";this.YFilledPosPrev=0;this.YFilledPos=0;this.ToolTip="";this.Spans=new ArrayList();this.SpanDivList=null;this.SubSections=null;this.DSEPositions=null;this.GraphFile=null;this.GraphClickMap=null;this.GraphRS=null;this.GraphIMDB=null;this.SubForm=null;this.RD3IdentName=null;this.ClickEventDef=RD3Glb.EVENT_ACTIVE}ARptBox.prototype.GetParentBook=function(){if(this.ParentRptBox.PSection!=null){return this.ParentRptBox.PSection.Parent.Parent}else{return this.ParentRptBox.PMastro.Parent}};ARptBox.prototype.FormatPage=function(F,r){this.GetRD3Ident();var e;if(r!=null&&this.SpanDivList==null){this.SpanDivList=this.ParentRptBox.PSection.Parent.Parent.PE.PrepareDivList(this)}if(this.SpanDivList!=null){var l=new IDVariant(0);var D=new IDVariant(0);var o=new IDVariant(0);var x=new IDVariant(0);this.GetPaddings(l,D,o,x);e=new ARptBox();e.CopyFrom(this,false);e.SpanDivList=new ArrayList();var C=Math.min(F.YFilledPos+this.YPos+this.Height,F.Height);var m;var b;for(var I=0;I<this.SpanDivList.Count();I++){b=this.SpanDivList[I];if(F.YFilledPos+this.YPos+l.intValue()+b.Point.Y+b.TextHeight-b.TextAscent+o.intValue()<=C){e.SpanDivList.Add(b);this.SpanDivList.RemoveAt(I--)}else{if(e.SpanDivList.Count()>0&&e.VRsz==IDREGlb.RSZ_STRETCH){b=e.SpanDivList[e.SpanDivList.Count()-1];e.Height=l.intValue()+b.Point.Y+b.TextHeight-b.TextAscent}break}}if(e.SpanDivList.Count()>0&&this.SpanDivList.Count()>0&&this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){for(var I=e.SpanDivList.Count()-1;I>=0;I--){b=e.SpanDivList[I];this.SpanDivList.Insert(0,b)}e.SpanDivList.Clear()}if(e.SpanDivList.Count()>0&&this.SpanDivList.Count()>0){b=this.SpanDivList[0];var c=b.Point.Y-b.TextAscent;for(m=0;m<this.SpanDivList.Count();m++){b=this.SpanDivList[m];b.Point.Y-=c}this.YPos+=c;this.Height-=c}var j=new ArrayList();var d=new ArrayList();var G=new ArrayList();for(m=0;m<this.SpanDivList.Count();m++){b=this.SpanDivList[m];if(j.IndexOf(b.Span)==-1){j.Add(b.Span)}}for(m=0;m<e.SpanDivList.Count();m++){b=e.SpanDivList[m];if(d.IndexOf(b.Span)==-1){d.Add(b.Span)}if(j.IndexOf(b.Span)!=-1&&G.IndexOf(b.Span)==-1){G.Add(b.Span)}}IDREGlb.SetArraySize(e.Spans,this.Spans.Count());for(var B=0;B<this.Spans.Count();B++){if(this.Spans[B]==null){continue}if(j.IndexOf(this.Spans[B])==-1&&G.IndexOf(this.Spans[B])==-1){e.Spans[B]=this.Spans[B];e.Spans[B].Parent=e;this.Spans[B]=null;continue}if(G.IndexOf(this.Spans[B])!=-1){e.Spans[B]=new ARptSpan();e.Spans[B].CopyFrom(this.Spans[B]);e.Spans[B].Parent=e;var h;this.Spans[B].Text="";for(m=0;m<this.SpanDivList.Count();m++){h=this.SpanDivList[m];if(h.Span==this.Spans[B]){if(h.DelSpaces>0){for(var a=0;a<h.DelSpaces;a++){h.Text+=" "}h.DelSpaces=h.DelSpacesWidth=0}this.Spans[B].Text+=(h.Text.length!=0?h.Text:"\n")}}e.Spans[B].Text="";for(m=0;m<e.SpanDivList.Count();m++){h=e.SpanDivList[m];if(h.Span==this.Spans[B]){if(h.DelSpaces>0){for(var a=0;a<h.DelSpaces;a++){h.Text+=" "}h.DelSpaces=h.DelSpacesWidth=0}e.Spans[B].Text+=(h.Text.length!=0?h.Text:"\n")}h.Span=e.Spans[B]}}}}else{if(this.SubSections!=null&&!this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)&&this.ParentRptBox.PSection!=null&&!this.ParentRptBox.PSection.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){var u=this.GetParentBook();if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),485,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Sub-report can split -> Calculating what can be placed on the page");u.DTTObj.AddParameter("","","Number of sub-sections",this.SubSections.Count)}e=new ARptBox();e.CopyFrom(this,true,false);e.SubSections=new ArrayList();e.Height=0;var y=false;for(var m=0;m<this.SubSections.Count();m++){var A=this.SubSections[m];if(F.YFilledPos+this.ParentRptBox.YPos+A.YPos+A.Height<=F.Height){this.SubSections.RemoveAt(m--);e.SubSections.Add(A);A.MastroBox=e;e.Height=A.YPos+A.Height;this.YPos=e.YPos+e.Height;if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){u.AddVerboseMsg(u.Parent.GetRTCGuid(A.ParentSection.SectionID),486,"ARptBox.FormatPage","Sub-Section "+u.Parent.GetObjName(A.ParentSection.SectionID)+": Sub-Section formatted successfully");u.DTTObj.AddParameter("","","Section YPos",u.InternalUnitToString(A.YPos));u.DTTObj.AddParameter("","","Section Height",u.InternalUnitToString(A.Height))}}else{if(!y){y=true;if(A.SplitSubSection(F,e)){if(A.BoxList.Count()==0){this.SubSections.RemoveAt(m--)}continue}if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){u.AddVerboseMsg(u.Parent.GetRTCGuid(A.ParentSection.SectionID),487,"ARptBox.FormatPage","Sub-Section "+u.Parent.GetObjName(A.ParentSection.SectionID)+": Sub-Section can't be placed on the box and can NOT be split -> Storing in the cache for next page");u.DTTObj.AddParameter("","","Section YPos",u.InternalUnitToString(A.YPos));u.DTTObj.AddParameter("","","Section Height",u.InternalUnitToString(A.Height));u.DTTObj.AddParameter("","","MastroBox Height",u.InternalUnitToString(F.Height));u.DTTObj.AddParameter("","","Box YPos",u.InternalUnitToString(this.ParentRptBox.YPos))}}A.YPos-=e.Height}}if(e.SubSections.Count()>0&&this.SubSections.Count()>0){var k=0;for(var m=0;m<this.ParentRptBox.SubReport.SectionsList.Count();m++){var E=this.ParentRptBox.SubReport.SectionsList[m];if(E.SectType==IDREGlb.SECT_GROUPHEADER&&E.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&this.SubSections[0].ParentSection!=E){var n=new MyBoolean(false);var t=new MyBoolean(false);var g=new MyBoolean(true);var H=new ARptBox();H.CopyFrom(this,false,false);H.YFilledPos=0;H.YFilledPosPrev=0;H.Height=2147483647;E.FormatPage(null,null,true,n,t,g,H);var q=H.SubSections[0];H.SubSections.Clear();q.YPos=this.SubSections[0].YPos;for(var f=0;f<this.SubSections.Count();f++){var z=this.SubSections[f];z.YPos+=q.Height}this.SubSections.Insert(k++,q);this.Height+=q.Height}}}this.Height-=this.YPos;if(this.SubSections.Count()==0){this.SubSections=null}if(e.SubSections!=null&&e.SubSections.Count()==0){e=null}if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){if(e!=null){u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),488,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Sub-Report has been partially formatted")}else{u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),489,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Sub-Report has NOT been formatted -> All sub-sections are kept in cache for next page")}}return e}else{e=new ARptBox();e.CopyFrom(this)}}if(F.YFilledPos+e.YPos+e.Height<=F.Height){if(r!=null){IDREGlb.SetArraySize(r.Spans,this.Spans.Count());for(var v=0;v<this.Spans.Count();v++){if(this.Spans[v]!=null){r.Spans[v]=this.Spans[v];r.Spans[v].Parent=r;this.Spans[v]=null}}}else{if(this.SpanDivList==null||this.SpanDivList.Count()==0){for(var v=0;v<this.Spans.Count();v++){this.Spans[v]=null}}}if(this.SpanDivList!=null&&e.SpanDivList!=null&&this.SpanDivList.Count()>0&&e.SpanDivList.Count()==0){e=null}var u=this.GetParentBook();if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e!=null){if(this.Spans.Count()==0||this.IsCompleted()){u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),490,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Formatted completely (Content = "+e.DumpContent()+")")}else{u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),491,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Partially formatted -> "+e.Spans.Count()+" span formatted and "+this.Spans.Count()+" left in cache for next formatting cycle (Formatted Content = "+e.DumpContent()+", Content left in cache = "+DumpContent()+")")}u.DTTObj.AddParameter("","","Box Left",u.InternalUnitToString(e.XPos));u.DTTObj.AddParameter("","","Box Top",u.InternalUnitToString(e.YPos));u.DTTObj.AddParameter("","","Box Width",u.InternalUnitToString(e.Width));u.DTTObj.AddParameter("","","Box Height",u.InternalUnitToString(e.Height))}return e}else{if(this.SpanDivList!=null){for(var v=0;v<e.Spans.Count();v++){if(e.Spans[v]!=null){if(this.Spans[v]!=null){this.Spans[v].Text=e.Spans[v].Text+this.Spans[v].Text}else{this.Spans[v]=e.Spans[v];this.Spans[v].Parent=this}e.Spans[v]=null}}}var u=this.GetParentBook();if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){if(this.SpanDivList!=null){u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),492,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": No spans formatted -> no space available on the page (Content = "+this.DumpContent()+")")}else{u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),493,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": No spans formatted -> KeepTogether flag set and space available on the page is not enough (Content = "+this.DumpContent()+")")}u.DTTObj.AddParameter("","","Space Left On Page",u.InternalUnitToString(F.Height-(F.YFilledPos+this.YPos)));u.DTTObj.AddParameter("","","Box Left",u.InternalUnitToString(this.XPos));u.DTTObj.AddParameter("","","Box Top",u.InternalUnitToString(this.YPos));u.DTTObj.AddParameter("","","Box Width",u.InternalUnitToString(this.Width));u.DTTObj.AddParameter("","","Box Height",u.InternalUnitToString(this.Height))}return null}};ARptBox.prototype.SplitSubBox=function(g,f,c){var d=g.GetParentBook();if(this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){if(d!=null&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentRptBox.BoxID),494,"ARptBox.SplitSubBox","Box "+d.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box has KeepTogether flag set thus can NOT be divided -> This sub-box will remain a single piece")}return false}if(this.SubSections!=null){var e=new ARptBox();e.SubSections=new ArrayList();e.CopyFrom(this,false,false);e.Height=0;var h=false;for(var j=0;j<this.SubSections.Count();j++){var k=this.SubSections[j];if(g.YFilledPos+c+f.YPos+this.YPos+k.YPos+k.Height<=g.Height){this.SubSections.RemoveAt(j--);e.SubSections.Add(k);k.MastroBox=e;e.Height=k.YPos+k.Height;if(d!=null&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(k.ParentSection.SectionID),495,"ARptBox.SplitSubBox","Sub-Section "+d.Parent.GetObjName(k.ParentSection.SectionID)+": Sub-Section formatted successfully");d.DTTObj.AddParameter("","","Section YPos",d.InternalUnitToString(k.YPos));d.DTTObj.AddParameter("","","Section Height",d.InternalUnitToString(k.Height))}}else{if(!h){h=true;if(k.SplitSubSection(g,e)){if(k.BoxList.Count()==0){this.SubSections.RemoveAt(j--)}continue}}if(d!=null&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(k.ParentSection.SectionID),496,"ARptBox.SplitSubBox","Sub-Section "+d.Parent.GetObjName(k.ParentSection.SectionID)+": Sub-Section can't be placed on the box and can NOT be split -> Storing in the cache for next page");d.DTTObj.AddParameter("","","Section YPos",d.InternalUnitToString(k.YPos));d.DTTObj.AddParameter("","","Section Height",d.InternalUnitToString(k.Height));d.DTTObj.AddParameter("","","MastroBox Height",d.InternalUnitToString(g.Height));d.DTTObj.AddParameter("","","Box YPos",d.InternalUnitToString(this.YPos))}k.YPos-=e.Height}}if(e.SubSections.Count()>0){f.BoxList.Add(e);f.Height=e.YPos+e.Height;e.ParentSect=f;this.Height-=e.Height;this.YPos=0;if(d!=null&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentRptBox.BoxID),497,"ARptBox.SplitSubBox","Box "+d.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box has been split in 2 parts (SubSections formatted = "+e.SubSections.Count()+", SubSections that remains in cache = "+this.SubSections.Count()+")")}return true}if(d!=null&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentRptBox.BoxID),498,"ARptBox.SplitSubBox","Box "+d.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box has NOT been split (meybe the box is too short to contain sub-sections)")}}else{if(this.SpanDivList!=null){var b=g.YFilledPos;g.YFilledPos+=c+f.YPos;var a=this.FormatPage(g,null);g.YFilledPos=b;if(a!=null){f.BoxList.Add(a);f.Height=a.YPos+a.Height;a.ParentSect=f;if(d!=null&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentRptBox.BoxID),497,"ARptBox.SplitSubBox","Box "+d.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box has been split in 2 parts (SpanDiv formatted = "+a.SpanDivList.Count()+", SpanDiv that remains in cache = "+this.SpanDivList.Count()+")")}if(this.IsCompleted()){return true}}else{if(d!=null&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentRptBox.BoxID),498,"ARptBox.SplitSubBox","Box "+d.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box has NOT been split (meybe the box is too short to contain span divs)")}}}}return false};ARptBox.prototype.CopyFrom=function(e,f,b){if(f==undefined){f=true}if(b==undefined){b=true}this.ParentSect=e.ParentSect;this.ParentPage=e.ParentPage;this.ParentRptBox=e.ParentRptBox;this.XPos=e.XPos;this.YPos=e.YPos;this.Width=e.Width;this.Height=e.Height;this.HRsz=e.HRsz;this.VRsz=e.VRsz;this.Interline=e.Interline;this.VisAttrIdx=e.VisAttrIdx;this.ImageIdx=e.ImageIdx;this.YFilledPos=e.YFilledPos;this.InitFlags(e.GetFlags());this.ToolTip=e.ToolTip;this.Stretch=e.Stretch;this.Rotation=e.Rotation;this.BackColor=e.BackColor;this.ForeColor=e.ForeColor;this.Alignment=e.Alignment;this.VAlignment=e.VAlignment;this.FontMod=e.FontMod;this.Badge=e.Badge;this.VisProp=e.VisProp;this.LastColumnUsed=e.LastColumnUsed;this.GraphFile=e.GraphFile;this.GraphClickMap=e.GraphClickMap;this.GraphRS=e.GraphRS;this.GraphIMDB=e.GraphIMDB;this.RD3IdentName=e.RD3IdentName;this.ClickEventDef=e.ClickEventDef;this.SubForm=e.SubForm;this.ClassName=e.ClassName;if(b){this.SubSections=null;this.SubSections=e.SubSections;e.SubSections=null;if(this.SubSections!=null){for(var g=0;g<this.SubSections.Count();g++){var a=this.SubSections[g];a.MastroBox=this}}}if(f){IDREGlb.SetArraySize(this.Spans,e.Spans.Count());for(var d=0;d<e.Spans.Count();d++){if(e.Spans[d]!=null){this.Spans[d]=new ARptSpan();this.Spans[d].CopyFrom(e.Spans[d]);this.Spans[d].Parent=this}}}if(this.DSEPositions!=null){this.DSEPositions=null}if(e.DSEPositions!=null){this.DSEPositions=new Array();for(var c=0;c<e.DSEPositions.length;c++){this.DSEPositions[c]=e.DSEPositions[c]}}};ARptBox.prototype.IsCompleted=function(){for(var a=0;a<this.Spans.Count();a++){if(this.Spans[a]!=null&&this.Spans[a].GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){return false}}if(this.SubSections!=null&&this.SubSections.Count()!=0){return false}return true};ARptBox.prototype.IsFullyPrinted=function(){if(this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){return true}for(var a=0;a<this.Spans.Count()-1;a++){if(this.Spans[a]!=null&&this.Spans[a+1]==null){return false}}return true};ARptBox.prototype.DeleteNullSpans=function(){for(var b=0;b<this.Spans.Count();b++){var c=this.Spans[b];var a=false;if(!c.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){a=true}else{if(c.Text!=null&&c.Text.length==0&&c.Value.Type==IDVariant.NULL){a=true}else{if(c.Value.Type==IDVariant.STRING&&c.Value.stringValue().length==0){a=true}}}if(a){this.Spans.RemoveAt(b);b--}}};ARptBox.prototype.IsZero=function(){for(var a=0;a<this.Spans.Count();a++){if(this.Spans[a]!=null&&!this.Spans[a].IsZero()){return false}}return true};ARptBox.prototype.IsEmpty=function(){for(var b=0;b<this.Spans.Count();b++){if(this.Spans[b]!=null&&!this.Spans[b].IsEmpty()){return false}}if(this.SubSections!=null){for(var c=0;c<this.SubSections.Count();c++){var a=this.SubSections[c];if(!a.IsEmpty()){return false}}}return true};ARptBox.prototype.SetRect=function(a,c){var b;if(this.ParentRptBox.PSection!=null){b=this.ParentRptBox.PSection.Parent.Parent}else{b=this.ParentRptBox.PMastro.Parent}switch(a){case IDREGlb.RECT_LEFT:this.XPos=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_TOP:this.YPos=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_WIDTH:this.Width=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_HEIGHT:this.Height=b.ConvertToInternalValue(c);break}};ARptBox.prototype.GetRect=function(a){if(a==undefined){return new CRect(this.XPos,this.YPos,this.XPos+this.Width,this.YPos+this.Height)}var b;if(this.ParentRptBox.PSection!=null){b=this.ParentRptBox.PSection.Parent.Parent}else{b=this.ParentRptBox.PMastro.Parent}switch(a){case IDREGlb.RECT_LEFT:return b.ConvertFromInternalValue(this.XPos);case IDREGlb.RECT_TOP:return b.ConvertFromInternalValue(this.YPos);case IDREGlb.RECT_WIDTH:return b.ConvertFromInternalValue(this.Width);case IDREGlb.RECT_HEIGHT:return b.ConvertFromInternalValue(this.Height)}return 0};ARptBox.prototype.InitFlags=function(a){this.Flags=a};ARptBox.prototype.GetFlags=function(){var a=this.Flags;if((this.ParentRptBox.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_RPTBOX_VISIBLE}return a};ARptBox.prototype.GetFlag=function(a){if(a==IDREGlb.FL_RPTBOX_VISIBLE&&(this.ParentRptBox.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}if(a==IDREGlb.FL_RPTBOX_KEEPTOGETHER&&(this.Flags&a)==0){if(this.Spans!=null&&this.Spans.length==1&&this.Spans[0]!=null&&this.Spans[0].GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){return true}}return((this.Flags&a)!=0)};ARptBox.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.ParentRptBox.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_RPTBOX_VISIBLE}};ARptBox.prototype.GetSubForm=function(){return this.SubForm};ARptBox.prototype.SetSubForm=function(a){this.SubForm=a;if(a!=null){a.ParentBox=this;if(a.Frames==null){a.SetSubMainFrm(a.MainFrm,a.MainFrm.IMDB)}}};ARptBox.prototype.GetVisualStyle=function(){return this.VisAttrIdx};ARptBox.prototype.SetVisualStyle=function(b){var a=this.GetParentBook();for(var d=0;d<this.Spans.Count();d++){var c=this.Spans[d];if(c!=null&&c.VisAttrIdx==this.VisAttrIdx){a.Parent.AObjectChanged(c);c.VisAttrIdx=b}}this.VisAttrIdx=b};ARptBox.prototype.GetBackColor=function(){return this.BackColor};ARptBox.prototype.SetBackColor=function(d){var a=this.GetParentBook();for(var c=0;c<this.Spans.Count();c++){var b=this.Spans[c];if(b!=null&&b.BackColor==this.BackColor){a.Parent.AObjectChanged(b);b.BackColor=d}}this.BackColor=d};ARptBox.prototype.GetForeColor=function(){return this.ForeColor};ARptBox.prototype.SetForeColor=function(d){var a=this.GetParentBook();for(var c=0;c<this.Spans.Count();c++){var b=this.Spans[c];if(b!=null&&b.ForeColor==this.ForeColor){a.Parent.AObjectChanged(b);b.ForeColor=d}}this.ForeColor=d};ARptBox.prototype.GetFontMod=function(){return this.FontMod};ARptBox.prototype.SetFontMod=function(b){var a=this.GetParentBook();for(var d=0;d<this.Spans.Count();d++){var c=this.Spans[d];if(c!=null&&c.FontMod.equals(this.FontMod)){a.Parent.AObjectChanged(c);c.FontMod=b}}this.FontMod=b};ARptBox.prototype.FormatSubReport=function(b){if(!this.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){return this.Height}if(this.ParentRptBox.SubReport!=null){this.YFilledPos=this.YFilledPosPrev=0;var a=this.Height;var e=false;if(this.VRsz==IDREGlb.RSZ_STRETCH||(this.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)&&this.ParentRptBox.PSection.Parent.Parent.PE.CanScroll)){this.Height=2147483647;if(this.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)&&this.ParentRptBox.PSection.Parent.Parent.PE.CanScroll){e=true}}if(this.SubSections==null||this.SubSections.Count()==0){this.ParentRptBox.SubReport.FormatSubReport(this)}this.Height=a;if(!e){var d=0;var c=null;if(this.SubSections!=null){c=this.SubSections[this.SubSections.Count()-1]}if(c!=null){d=c.YPos+c.Height}return d}else{return this.Height}}return this.Height};ARptBox.prototype.FormatGraph=function(){if(this.ParentRptBox.SubGraph!=null){if(this.GraphFile!=null&&this.GraphFile.length>0){return true}var c=new Object();c.Width=this.Width;c.Height=this.Height;this.ParentRptBox.PSection.Parent.Parent.ConvertFromPhysicalToPixel(c);this.ParentRptBox.SubGraph.Width=c.Width;this.ParentRptBox.SubGraph.Height=c.Height;this.ParentRptBox.SubGraph.FrIndex=(this.ParentRptBox.PSection.Parent.Parent.FrIndex==-1?99:this.ParentRptBox.PSection.Parent.Parent.FrIndex);this.ParentRptBox.SubGraph.UpdateGraph(this.ParentRptBox.PSection.Parent.Parent.MainFrm);this.GraphFile=this.ParentRptBox.SubGraph.getGraphFile();if(this.ParentRptBox.SubGraph.Hyperlink()){this.GraphClickMap="ena";if(this.ParentRptBox.SubGraph.IMDBDataSource==-1){this.GraphRS=new IDCachedRowSet();this.GraphRS.CopyFrom(this.ParentRptBox.SubGraph.QueryObj.RS)}else{var b=this.ParentRptBox.PSection.Parent.Parent.Parent.Parent.Parent.MainFrm.IMDB;this.GraphIMDB=new IMDBTableSrv(b);this.GraphIMDB.CopyFrom(b.Table(this.ParentRptBox.SubGraph.IMDBDataSource))}}var a=this.GetParentBook();if(a!=null&&a.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){a.AddVerboseMsg(a.Parent.GetRTCGuid(this.ParentRptBox.BoxID),499,"ARptBox.FormatGraph","Box "+a.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box Graph has been formatted");a.DTTObj.AddParameter("","","Box Width",a.InternalUnitToString(this.ParentRptBox.SubGraph.Width));a.DTTObj.AddParameter("","","Box Height",a.InternalUnitToString(this.ParentRptBox.SubGraph.Height))}return true}return false};ARptBox.prototype.HandleVertResize=function(){this.SpanDivList=this.ParentRptBox.PSection.Parent.Parent.PE.PrepareDivList(this);if(this.SpanDivList==null){return}var b=0;for(var g=0;g<this.SpanDivList.Count();g++){var f=this.SpanDivList[g];b=Math.max(b,f.Point.Y+f.TextHeight-f.TextAscent)}var a=new IDVariant(0);var e=new IDVariant(0);var d=new IDVariant(0);var c=new IDVariant(0);this.GetPaddings(a,e,d,c);b+=a.intValue()+d.intValue();if(this.VRsz==IDREGlb.RSZ_STRETCH&&b>this.Height){this.Height=b}};ARptBox.prototype.DeleteAllSpanDiv=function(){this.SpanDivList=null;if(this.SubSections!=null){for(var d=0;d<this.SubSections.Count();d++){var c=this.SubSections[d];for(var a=0;a<c.BoxList.Count();a++){c.BoxList[a].DeleteAllSpanDiv()}}}};ARptBox.prototype.CreateAllSpanDiv=function(d,e){var f=d.PrepareDivList(this);if(f!=null){e[this.HashCode]=f}if(this.SubSections!=null){for(var g=0;g<this.SubSections.Count();g++){var c=this.SubSections[g];for(var a=0;a<c.BoxList.Count();a++){c.BoxList[a].CreateAllSpanDiv(d,e)}}}};ARptBox.prototype.GetPaddings=function(a,f,e,c,b){if(b==undefined){b=null}var d=null;if(b!=null){d=b.Parent}else{if(this.ParentRptBox!=null){if(this.ParentRptBox.PSection!=null){d=this.ParentRptBox.PSection.Parent.Parent}else{d=this.ParentRptBox.PMastro.Parent}}else{if(this.ParentSect!=null){d=this.ParentSect.ParentSection.Parent.Parent}}}d.VisualStyleList.GetPaddings(this.VisAttrIdx,a,f,e,c,d.UM,b)};ARptBox.prototype.LogDSEpositions=function(){var b=false;if(this.HasHyperLink()){b=true}if(this.ParentRptBox.SubGraph!=null&&this.ParentRptBox.SubGraph.Hyperlink()){b=true}if(!b&&(this.GetFlag(IDREGlb.FL_RPTBOX_CANDRAG)||this.GetFlag(IDREGlb.FL_RPTBOX_CANDROP)||this.GetFlag(IDREGlb.FL_RPTBOX_CANTRANS))){b=true}if(!b){for(var f=0;f<this.Spans.Count();f++){var e=this.Spans[f];if(e!=null&&e.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){b=true;break}}}if(!b){return}var a=this.ParentRptBox;var d=new ArrayList();while(a!=null){d.Insert(0,a.PSection.Parent.DSE.GetCurrentPosition());a=a.PSection.Parent.ParentBox}this.DSEPositions=new Array();for(var c=0;c<d.Count();c++){this.DSEPositions[c]=d[c]}};ARptBox.prototype.GetHTMLName=function(){var c="B"+this.ParentRptBox.BoxID;if(this.ParentRptBox.PSection==null||this.DSEPositions==null){return c}var b=this.ParentRptBox;var a=this.DSEPositions.length-1;while(b!=null){c+="R"+this.DSEPositions[a--];b=b.PSection.Parent.ParentBox;if(b!=null){c+="B"+b.BoxID}}return c};ARptBox.prototype.ProcessRequest=function(o,h,j){var a=this.GetHTMLName();if(j){for(var c=0;c<this.Spans.Count();c++){var n=this.Spans[c];if(n!=null&&n.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){var d="F"+h.FrIndex+a+"S"+n.ParentRptSpan.SpanID;var q=new IDVariant(o.GetParameter(d));if(n.Value.Type==IDVariant.NULL&&q.stringValue().equals("")){continue}if(q.Type==IDVariant.NULL){continue}n.ProcessRequest(q);if(h.AbortProcessReq){return true}}}}else{if(this.HasHyperLink()||(this.ParentRptBox.SubGraph!=null&&this.ParentRptBox.SubGraph.Hyperlink())){var m="F"+h.FrIndex+a+".x";if(o.GetParameter(m)!=null){if(this.ParentRptBox.SubGraph!=null&&this.ParentRptBox.SubGraph.Hyperlink()){this.ParentRptBox.PSection.Parent.Parent.MoveDSEPositions(this);if(this.GraphRS!=null){this.ParentRptBox.SubGraph.QueryObj.RS.CopyFrom(this.GraphRS)}else{o.IMDB.Table(this.ParentRptBox.SubGraph.IMDBDataSource).CopyFrom(this.GraphIMDB)}var g=o.iwrd_wce;if(g==null||g.length==0){g=o.Request.WCE}if(g!=null&&g.length>2){this.ParentRptBox.SubGraph.FireGraphClick(g.substr(2),o)}return true}h.BoxActivated(this);return true}}}if(this.SubSections!=null){for(var l=0;l<this.SubSections.Count();l++){var f=this.SubSections[l];for(var k=0;k<f.BoxList.Count();k++){var e=f.BoxList[k];if(e.ProcessRequest(o,h,j)){return true}}}}return false};ARptBox.prototype.GetBoxByID=function(c){if(this.GetHTMLName().equals(c)){return this}if(this.SubSections!=null&&this.SubSections.Count()!=0){for(var g=0;g<this.SubSections.Count();g++){var d=this.SubSections[g];for(var a=0;a<d.BoxList.Count();a++){var f=d.BoxList[a];var e=f.GetBoxByID(c);if(e!=null){return e}}}}return null};ARptBox.prototype.GetStretch=function(a){if(this.Stretch==IDREGlb.STRTC_AUTO){if(a instanceof CPEPDF){return IDREGlb.STRTC_FILL}if(a instanceof CPEHTML){return IDREGlb.STRTC_FILL}}return this.Stretch};ARptBox.prototype.GetPage=function(){if(this.ParentPage!=null){return this.ParentPage}else{return this.ParentSect.GetPage()}};ARptBox.prototype.GetRD3Ident=function(){if(this.RD3IdentName==null){this.RD3IdentName="box:B"+this.ParentRptBox.BoxID;if(this.ParentRptBox.PSection!=null){var a=this.ParentRptBox;while(a!=null&&a.PSection.Parent!=null){this.RD3IdentName+="R"+(a.PSection.SectType==IDREGlb.SECT_DETAIL?a.PSection.Parent.DSE.GetRowId():a.PSection.Parent.DSE.GetCurrentPosition().toString());a=a.PSection.Parent.ParentBox;if(a!=null){this.RD3IdentName+="B"+a.BoxID}}}else{if(this.ParentPage!=null){this.RD3IdentName+="P"+this.ParentPage.PageNum}}this.RD3IdentName+=":"+this.ParentRptBox.PMastro.Parent.FrIndex+":"+this.ParentRptBox.PMastro.Parent.Parent.Parent.Parent.FormIdx}return this.RD3IdentName};ARptBox.prototype.RD3RenderDifference=function(q,f,j){var g=this.GetPage();g.RD3ObjMap[this.GetRD3Ident()]=this;var h=(f?null:new BitArray(RD3Glb.BOX_MAXPROPS));var d=new IDVariant();var c=f;if(!c){if(g.RD3ChangedObjects!=null){var u=g.RD3ChangedObjects[this.GetRD3Ident()];if(u!=null){c=this.CalcRD3Difference(u,h,d)}}else{if(j!=null&&j.RD3ObjMap!=null){c=this.CalcRD3Difference(j.RD3ObjMap[this.GetRD3Ident()],h,d);if(!c&&j.RD3ChangedObjects!=null&&j.RD3ChangedObjects[this.GetRD3Ident()]!=null){c=true;h.SetAll(true)}}}}var m=null;if(f){m=q.AddNewElement("box")}if(d.isTrue()){m=q.AddNewElement("ins");if(this.ParentSect!=null){m.SetAttribute("parid",this.ParentSect.GetRD3Ident());var e=this.ParentSect.BoxList.IndexOf(this);m.SetAttribute("previd",(e==this.ParentSect.BoxList.Count()-1?"":this.ParentSect.BoxList[e+1].GetRD3Ident()))}else{m.SetAttribute("parid",this.ParentPage.GetRD3Ident());var e=this.ParentPage.MastroBoxes.IndexOf(this);m.SetAttribute("previd",(e==this.ParentPage.MastroBoxes.Count()-1?"":this.ParentPage.MastroBoxes[e+1].GetRD3Ident()))}c=true;h.SetAll(true)}if(m==null&&c){m=q.AddNewElement("chg")}if(m!=null){m.SetAttribute("id",this.GetRD3Ident())}if(f||c){for(var o=0;o<RD3Glb.BOX_MAXPROPS;o++){if(f||h[o]){this.SetRD3Property(o,m,f)}}}if(f||d.isTrue()){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){m.SetAttribute("clk",this.ClickEventDef)}}var k=c;var r=(f)?m:q;for(var t=0;t<this.Spans.Count();t++){var n=this.Spans[t];if(n!=null){k|=n.RD3RenderDifference(r,f,j)}}if(this.SubSections!=null){var a=null;for(var t=0;t<this.SubSections.Count();t++){var s=this.SubSections[t];if(s!=null){k|=s.RD3RenderDifference(r,f,j);if(f&&s.GetFlag(IDREGlb.FL_SECT_OVERLAY)&&a!=null&&a.GetFlag(IDREGlb.FL_SECT_OVERLAY)&&s.MastroBox==a.MastroBox){var l=r.GetNode().childNodes[r.GetNode().childNodes.length-1];if(l.nodeName.equals("sec")){l.setAttribute("ohd","1")}}a=s}}}if(!f&&h[RD3Glb.BOX_SUBFORM]){f=true;r=m;m.SetAttribute("csf",(this.SubForm!=null?"1":"0"));k=true}if(this.SubForm!=null){k|=this.SubForm.RD3RenderDifferences(r,f)}return k};ARptBox.prototype.CalcRD3Difference=function(c,d,a){if(c==null){a.set(true);return true}d[RD3Glb.BOX_XPOS]=(c.XPos!=this.XPos);d[RD3Glb.BOX_YPOS]=(c.YPos!=this.YPos);d[RD3Glb.BOX_WIDTH]=(c.Width!=this.Width);d[RD3Glb.BOX_HEIGHT]=(c.Height!=this.Height||c.CanBeEdited()!=this.CanBeEdited());d[RD3Glb.BOX_VISATTR]=(c.VisAttrIdx!=this.VisAttrIdx);d[RD3Glb.BOX_IMAGE]=(c.ImageIdx!=this.ImageIdx);d[RD3Glb.BOX_INTERLINE]=(c.Interline!=this.Interline);d[RD3Glb.BOX_STRETCH]=(c.Stretch!=this.Stretch);d[RD3Glb.BOX_VISIBLE]=(c.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)!=this.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE));d[RD3Glb.BOX_CANDRAG]=(c.GetFlag(IDREGlb.FL_RPTBOX_CANDRAG)!=this.GetFlag(IDREGlb.FL_RPTBOX_CANDRAG));d[RD3Glb.BOX_CANDROP]=(c.GetFlag(IDREGlb.FL_RPTBOX_CANDROP)!=this.GetFlag(IDREGlb.FL_RPTBOX_CANDROP));d[RD3Glb.BOX_CANTRANSFORM]=(c.GetFlag(IDREGlb.FL_RPTBOX_CANTRANS)!=this.GetFlag(IDREGlb.FL_RPTBOX_CANTRANS));d[RD3Glb.BOX_CANSCROLL]=(c.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)!=this.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL));d[RD3Glb.BOX_TOOLTIP]=((c.ToolTip==null)!=(this.ToolTip==null)||(c.ToolTip!=null&&!c.ToolTip.equals(this.ToolTip)));d[RD3Glb.BOX_GRAPHFILE]=((c.GraphFile==null)!=(this.GraphFile==null)||(c.GraphFile!=null&&!c.GraphFile.equals(this.GraphFile)));d[RD3Glb.BOX_GRAPHMAP]=((c.GraphClickMap==null)!=(this.GraphClickMap==null)||(c.GraphClickMap!=null&&!c.GraphClickMap.equals(this.GraphClickMap)));d[RD3Glb.BOX_CANCLICK]=(c.CanClick()!=this.CanClick());d[RD3Glb.BOX_VISPROP]=(c.VisProp!=this.VisProp);d[RD3Glb.BOX_SUBFORM]=(c.SubForm!=this.SubForm);d[RD3Glb.BOX_BACKCOLOR]=(c.BackColor!=this.BackColor);d[RD3Glb.BOX_FORECOLOR]=(c.ForeColor!=this.ForeColor);d[RD3Glb.BOX_ALIGN]=(c.Alignment!=this.Alignment);d[RD3Glb.BOX_VALIGN]=(c.VAlignment!=this.VAlignment);d[RD3Glb.BOX_FONTMOD]=((c.FontMod==null)!=(this.FontMod==null)||(c.FontMod!=null&&!c.FontMod.equals(this.FontMod)));d[RD3Glb.BOX_BADGE]=((c.Badge==null)!=(this.Badge==null)||(c.Badge!=null&&!c.Badge.equals(this.Badge)));d[RD3Glb.BOX_CLASSNAME]=((c.ClassName==null)!=(this.ClassName==null)||(c.ClassName!=null&&!c.ClassName.equals(this.ClassName)));for(var b=0;b<RD3Glb.BOX_MAXPROPS;b++){if(d[b]){return true}}return false};ARptBox.prototype.SetRD3Property=function(a,e,d){switch(a){case RD3Glb.BOX_XPOS:if(this.XPos==0&&d){break}e.SetAttribute("xp",this.XPos.toString());break;case RD3Glb.BOX_YPOS:if(this.YPos==0&&d){break}e.SetAttribute("yp",this.YPos.toString());break;case RD3Glb.BOX_WIDTH:e.SetAttribute("wid",this.Width.toString());break;case RD3Glb.BOX_HEIGHT:e.SetAttribute("hei",this.Height.toString());var c=0;if(this.ParentRptBox!=null&&this.ParentRptBox.FontHeight>0){if(this.CanBeEdited()){c=Math.floor(this.Height/this.ParentRptBox.FontHeight)}else{c=Math.floor(this.Height/this.ParentRptBox.FontHeight+0.5)}}if(this.CanBeEdited()){var g=this.Spans[0];if(g.ParentRptSpan.DataType==IDREGlb.DT_NUM_INTEGER||g.ParentRptSpan.DataType==IDREGlb.DT_DATE||g.ParentRptSpan.DataType==IDREGlb.DT_DATETIME||g.ParentRptSpan.DataType==IDREGlb.DT_TIME){var b=this.GetParentBook();if(b!=null&&b.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){b.AddVerboseMsg(b.Parent.GetRTCGuid(this.ParentRptBox.BoxID),485,"ARptBox.SetRD3Property","Box "+b.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box contains a single span. Box NumRows was "+c+" but span inside is a numeric or date type -> force NumRows to 1")}c=1}}if(c==1&&d){break}e.SetAttribute("num",c.toString());break;case RD3Glb.BOX_VISATTR:e.SetAttribute("sty",this.GetParentBook().VisualStyleList.GetTrueIdx(this.VisAttrIdx).toString());break;case RD3Glb.BOX_IMAGE:if(this.ImageIdx==0&&d){break}if(this.ImageIdx==0){e.SetAttribute("img","")}else{var f=CBook.AdaptWebFileName(this.ParentRptBox.PMastro.Parent.ImagesPath[Math.abs(this.ImageIdx)-1]);e.SetAttribute("img",f)}break;case RD3Glb.BOX_INTERLINE:if(this.Interline==0&&d){break}e.SetAttribute("int",this.Interline.toString());break;case RD3Glb.BOX_VISPROP:if(this.VisProp==-1&&d){break}e.SetAttribute("vfl",this.VisProp.toString());break;case RD3Glb.BOX_STRETCH:if(this.Stretch==IDREGlb.STRTC_AUTO&&d){break}e.SetAttribute("str",this.Stretch.toString());break;case RD3Glb.BOX_VISIBLE:if((this.Flags&IDREGlb.FL_RPTBOX_VISIBLE)!=0&&d){break}e.SetAttribute("vis",((this.Flags&IDREGlb.FL_RPTBOX_VISIBLE)!=0)?"1":"0");break;case RD3Glb.BOX_CANDRAG:if((this.Flags&IDREGlb.FL_RPTBOX_CANDRAG)==0&&d){break}e.SetAttribute("dra",((this.Flags&IDREGlb.FL_RPTBOX_CANDRAG)!=0)?"1":"0");break;case RD3Glb.BOX_CANDROP:if((this.Flags&IDREGlb.FL_RPTBOX_CANDROP)==0&&d){break}e.SetAttribute("dro",((this.Flags&IDREGlb.FL_RPTBOX_CANDROP)!=0)?"1":"0");break;case RD3Glb.BOX_CANTRANSFORM:if((this.Flags&IDREGlb.FL_RPTBOX_CANTRANS)==0&&d){break}e.SetAttribute("tra",((this.Flags&IDREGlb.FL_RPTBOX_CANTRANS)!=0)?"1":"0");break;case RD3Glb.BOX_CANSCROLL:if((this.Flags&IDREGlb.FL_RPTBOX_CANSCROLL)==0&&d){break}e.SetAttribute("scr",((this.Flags&IDREGlb.FL_RPTBOX_CANSCROLL)!=0)?"1":"0");break;case RD3Glb.BOX_TOOLTIP:if(this.ToolTip.length==0&&d){break}e.SetAttribute("tip",this.ToolTip);break;case RD3Glb.BOX_GRAPHFILE:if((this.GraphFile==null||this.GraphFile.length==0)&&d){break}e.SetAttribute("grf",this.GraphFile!=null?this.GraphFile:"");break;case RD3Glb.BOX_GRAPHMAP:if((this.GraphClickMap==null||this.GraphClickMap.length==0)&&d){break}e.SetAttribute("grm",this.GraphClickMap!=null?this.GraphClickMap:"");break;case RD3Glb.BOX_CANCLICK:var h=this.CanClick();if(!h&&d){break}e.SetAttribute("act",(h?"1":"0"));break;case RD3Glb.BOX_BACKCOLOR:if(this.BackColor==-1&&d){break}e.SetAttribute("bkc",(this.BackColor==-1?"":Glb.GetWebColor(this.BackColor)));break;case RD3Glb.BOX_FORECOLOR:if(this.ForeColor==-1&&d){break}e.SetAttribute("frc",(this.ForeColor==-1?"":Glb.GetWebColor(this.ForeColor)));break;case RD3Glb.BOX_ALIGN:if(this.Alignment==IDREGlb.VISALN_AUTO&&d){break}e.SetAttribute("aln",this.Alignment.toString());break;case RD3Glb.BOX_VALIGN:if(this.VAlignment==IDREGlb.VISVALN_TOP&&d){break}e.SetAttribute("valn",this.VAlignment.toString());break;case RD3Glb.BOX_FONTMOD:if((this.FontMod==null||this.FontMod.length==0)&&d){break}e.SetAttribute("ftm",(this.FontMod==null)?"":this.FontMod);break;case RD3Glb.BOX_BADGE:if((this.Badge==null||this.Badge.length==0)&&d){break}e.SetAttribute("bdg",(this.Badge==null)?"":this.Badge);break;case RD3Glb.BOX_CLASSNAME:if((this.ClassName==null||this.ClassName.length==0)&&d){break}e.SetAttribute("cln",(this.ClassName==null)?"":this.ClassName);break}};ARptBox.prototype.RD3GraphClick=function(b){var a=this.ParentRptBox.PSection.Parent.Parent.MainFrm;if(this.ParentRptBox.SubGraph!=null&&this.ParentRptBox.SubGraph.Hyperlink()){this.ParentRptBox.PSection.Parent.Parent.MoveDSEPositions(this);if(this.GraphRS!=null){this.ParentRptBox.SubGraph.QueryObj.RS.CopyFrom(this.GraphRS)}else{a.IMDB.Table(this.ParentRptBox.SubGraph.IMDBDataSource).CopyFrom(this.GraphIMDB)}this.ParentRptBox.SubGraph.FireGraphClick(b,a)}};ARptBox.prototype.RD3Activate=function(){this.ParentRptBox.PMastro.Parent.BoxActivated(this)};ARptBox.prototype.RD3Drop=function(a){this.ParentRptBox.PMastro.Parent.BoxDrop(a,this)};ARptBox.prototype.RD3Transform=function(c,g,d,f){var a=this.ParentRptBox.PMastro.Parent;a.DDSrcBox=this;a.MoveDSEPositions(this);if(a.DTTObj.Level>0){a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.Parent.GetRTCGuid(this.ParentRptBox.BoxID),415,"ARptBox.RD3Transform","Box "+a.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box transformed -> Fire OnBoxTransform event")}var e=new IDVariant(false);a.FormattingObj=this.ParentSect;a.FormattingType=IDREGlb.FRM_SECTION_PERM;a.Parent.Fire_OnBoxTransform(this.ParentRptBox.BoxID,c,g,d,f,e);a.FormattingType=IDREGlb.FRM_NONE;a.FormattingObj=null};ARptBox.prototype.GetIndex=function(){return this.ParentRptBox.BoxID};ARptBox.prototype.CanClick=function(){var a=this.GetParentBook();if(this.Spans.Count()==1){var b=this.Spans[0];if(b!=null&&a.VisualStyleList.ControlType(b.VisAttrIdx)==IDREGlb.VISCTRL_BUTTON){return b.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)}}return this.HasHyperLink()};ARptBox.prototype.CanBeEdited=function(){if(this.Spans!=null&&this.Spans.Count()==1){var b=this.Spans[0];if(b==null){return false}var a=this.GetParentBook();if(a.VisualStyleList.ControlType(b.VisAttrIdx)!=IDREGlb.VISCTRL_AUTO&&a.VisualStyleList.ControlType(b.VisAttrIdx)!=IDREGlb.VISCTRL_EDIT){return false}return b.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)}return false};ARptBox.prototype.DumpContent=function(){var b="'";for(var a=0;a<this.Spans.Count();a++){var c=this.Spans[a];if(c==null){continue}b+=c.Text;if(b.length>50){return b.substr(0,50)+"...'"}}return b+"'"};ARptBox.prototype.HasHyperLink=function(){if((this.VisProp&IDREGlb.BOXVISPROP_HYPERLINK)!=0){return true}if((this.GetParentBook().VisualStyleList.Flags(this.VisAttrIdx)&IDREGlb.FL_VIS_HYPERLINK)!=0){return true}return false};ARptBox.prototype.GetToolTip=function(){return this.ToolTip};ARptBox.prototype.GetInnerText=function(){var b="";for(var a=0;a<this.Spans.Count();a++){b+=this.Spans[a].Text;b+=" "}return b};ARptBox.prototype.HandleHTML=function(f,k){var d=(this.ParentRptBox.PSection!=null?this.ParentRptBox.PSection.Parent.Parent:this.ParentRptBox.PMastro.Parent);if(d.PrintDestination!=IDREGlb.PRN_PDF){return}var g=new XMLDoc();for(var l=0;l<this.Spans.Count();l++){var h=this.Spans[l];if(h==null){continue}var a=d.VisualStyleList.Mask(h.VisAttrIdx);if(!h.Mask.equals("")){a=h.Mask}if(!a.equals("=")){continue}var e="<DIV>"+ARptBox.CleanUpHTML(h.Text)+"</DIV>";if(!g.LoadFromString(e,XMLDoc.FT_XML)){d.DTTObj.AddItem(DTTEngine.DTTMSG_WARN,DTTEngine.IT_EXCEPTION,d.Parent.GetRTCGuid(h.ParentRptSpan.SpanID),0,"ARptBox.HandleHTML","Span "+d.Parent.GetObjName(h.ParentRptSpan.SpanID)+": Invalid HTML text ("+Glb.HTMLEncode(h.Text,true,true)+")");continue}var c=g.GetRootNode();this.Spans.RemoveAt(l);var j=new ArrayList();var b=new IDMap();b.set_Object(new IDVariant("B"),new IDVariant(0));b.set_Object(new IDVariant("I"),new IDVariant(0));b.set_Value(new IDVariant("Back"),new IDVariant(-1));b.set_Value(new IDVariant("Fore"),new IDVariant(-1));ARptBox.CreateSpanFromHTML(h,k,c,j,b);this.Spans.AddRange(j);l+=j.Count()}};ARptBox.CleanUpHTML=function(b){b=b.replace(/<br>/gi,"<br/>");b=b.replace(/<wbr>/gi,"");b=b.Replace(/&nbsp;/gi," ");if(b.length>5&&String.compare(b.substring(0,5),"<META",true)==0){b=b.substring(b.indexOf(">")+1)}var a=b.indexOf("<img ");if(a==-1){a=b.indexOf("<IMG ")}while(a!=-1){var c=b.indexOf(">",a);if(c==-1){break}b=b.remove(a,c-a+1);a=b.indexOf("<img ");if(a==-1){a=b.indexOf("<IMG ")}}return b};ARptBox.AddSpanText=function(d,b,f,e){var a=(f.Count()>0?f[f.Count()-1]:null);if(a!=null&&a.Text!=null){a.Text+=e}else{var c=d.ParentRptSpan.GetARptSpan(b);c.Text=(e.equals("\n")?" ":"")+e;f.Add(c)}};ARptBox.CreateSpanFromHTML=function(q,f,x,a,t){var m,c=null;while(x.HasNextNode()){m=c;c=x.GetNextNode();var b=c.Name();if(String.compare(b,"STYLE",true)==0||String.compare(b,"SCRIPT",true)==0){continue}else{if(String.compare(b,"BR",true)==0){ARptBox.AddSpanText(q,f,a,"\n")}else{if(c.HasNextNode()){var u=t.get_Value(new IDVariant("B"));var s=t.get_Value(new IDVariant("I"));var n=t.get_Value(new IDVariant("Back"));var e=t.get_Value(new IDVariant("Fore"));if(String.compare(b,"B",true)==0||String.compare(b,"STRONG",true)==0){t.set_Value(new IDVariant("B"),new IDVariant(t.get_Value(new IDVariant("B")).intValue()+1))}if(String.compare(b,"I",true)==0){t.set_Value(new IDVariant("I"),new IDVariant(t.get_Value(new IDVariant("I")).intValue()+1))}while(c.HasNextAttribute()){var r=new IDVariant();var k=new IDVariant();c.GetNextAttribute(r,k);if(String.compare(r.stringValue(),"STYLE",true)==0){ARptBox.ColorsFromHTMLStyle(k.stringValue(),t)}if(String.compare(b,"FONT",true)==0&&String.compare(r.stringValue(),"COLOR",true)==0){ARptBox.ColorsFromHTMLStyle(r.stringValue()+":"+k.stringValue(),t)}}if(String.compare(b,"P",true)==0&&m!=null&&String.compare(m.Name(),"P",true)!=0&&String.compare(m.Name(),"BR",true)!=0){ARptBox.AddSpanText(q,f,a,"\n")}ARptBox.CreateSpanFromHTML(q,f,c,a,t);if(String.compare(b,"P",true)==0){ARptBox.AddSpanText(q,f,a,"\n")}t.set_Value(new IDVariant("B"),u);t.set_Value(new IDVariant("I"),s);t.set_Value(new IDVariant("Back"),n);t.set_Value(new IDVariant("Fore"),e);continue}else{if(c.GetNode().data.length>0){var l=(t.get_Value(new IDVariant("B")).intValue()>0);var g=(t.get_Value(new IDVariant("I")).intValue()>0);var v=t.get_Value(new IDVariant("Back")).intValue();var h=t.get_Value(new IDVariant("Fore")).intValue();var o=(a.Count()>0?a[a.Count()-1]:null);if(o!=null){if((o.FontMod.indexOf("B")!=-1)!=l){o=null}else{if((o.FontMod.indexOf("I")!=-1)!=g){o=null}else{if(o.BackColor!=v){o=null}else{if(o.ForeColor!=h){o=null}}}}}var j=c.GetNode().data;if(j){j=j.replace(/\n/g,"");if(o!=null){o.Text+=j}else{var d=q.ParentRptSpan.GetARptSpan(f);d.Text=j;d.FontMod=(l?"B":"")+(g?"I":"");d.BackColor=v;d.ForeColor=h;a.Add(d)}}}}}}}};ARptBox.HTMLColors={};ARptBox.HTMLColors.BLACK="#000000";ARptBox.HTMLColors.NAVY="#000080";ARptBox.HTMLColors.DARKBLUE="#00008B";ARptBox.HTMLColors.MEDIUMBLUE="#0000CD";ARptBox.HTMLColors.BLUE="#0000FF";ARptBox.HTMLColors.DARKGREEN="#006400";ARptBox.HTMLColors.GREEN="#008000";ARptBox.HTMLColors.TEAL="#008080";ARptBox.HTMLColors.DARKCYAN="#008B8B";ARptBox.HTMLColors.DEEPSKYBLUE="#00BFFF";ARptBox.HTMLColors.DARKTURQUOISE="#00CED1";ARptBox.HTMLColors.MEDIUMSPRINGGREEN="#00FA9A";ARptBox.HTMLColors.LIME="#00FF00";ARptBox.HTMLColors.SPRINGGREEN="#00FF7F";ARptBox.HTMLColors.AQUA="#00FFFF";ARptBox.HTMLColors.CYAN="#00FFFF";ARptBox.HTMLColors.MIDNIGHTBLUE="#191970";ARptBox.HTMLColors.DODGERBLUE="#1E90FF";ARptBox.HTMLColors.LIGHTSEAGREEN="#20B2AA";ARptBox.HTMLColors.FORESTGREEN="#228B22";ARptBox.HTMLColors.SEAGREEN="#2E8B57";ARptBox.HTMLColors.DARKSLATEGRAY="#2F4F4F";ARptBox.HTMLColors.DARKSLATEGREY="#2F4F4F";ARptBox.HTMLColors.LIMEGREEN="#32CD32";ARptBox.HTMLColors.MEDIUMSEAGREEN="#3CB371";ARptBox.HTMLColors.TURQUOISE="#40E0D0";ARptBox.HTMLColors.ROYALBLUE="#4169E1";ARptBox.HTMLColors.STEELBLUE="#4682B4";ARptBox.HTMLColors.DARKSLATEBLUE="#483D8B";ARptBox.HTMLColors.MEDIUMTURQUOISE="#48D1CC";ARptBox.HTMLColors["INDIGO "]="#4B0082";ARptBox.HTMLColors.DARKOLIVEGREEN="#556B2F";ARptBox.HTMLColors.CADETBLUE="#5F9EA0";ARptBox.HTMLColors.CORNFLOWERBLUE="#6495ED";ARptBox.HTMLColors.REBECCAPURPLE="#663399";ARptBox.HTMLColors.MEDIUMAQUAMARINE="#66CDAA";ARptBox.HTMLColors.DIMGRAY="#696969";ARptBox.HTMLColors.DIMGREY="#696969";ARptBox.HTMLColors.SLATEBLUE="#6A5ACD";ARptBox.HTMLColors.OLIVEDRAB="#6B8E23";ARptBox.HTMLColors.SLATEGRAY="#708090";ARptBox.HTMLColors.SLATEGREY="#708090";ARptBox.HTMLColors.LIGHTSLATEGRAY="#778899";ARptBox.HTMLColors.LIGHTSLATEGREY="#778899";ARptBox.HTMLColors.MEDIUMSLATEBLUE="#7B68EE";ARptBox.HTMLColors.LAWNGREEN="#7CFC00";ARptBox.HTMLColors.CHARTREUSE="#7FFF00";ARptBox.HTMLColors.AQUAMARINE="#7FFFD4";ARptBox.HTMLColors.MAROON="#800000";ARptBox.HTMLColors.PURPLE="#800080";ARptBox.HTMLColors.OLIVE="#808000";ARptBox.HTMLColors.GRAY="#808080";ARptBox.HTMLColors.GREY="#808080";ARptBox.HTMLColors.SKYBLUE="#87CEEB";ARptBox.HTMLColors.LIGHTSKYBLUE="#87CEFA";ARptBox.HTMLColors.BLUEVIOLET="#8A2BE2";ARptBox.HTMLColors.DARKRED="#8B0000";ARptBox.HTMLColors.DARKMAGENTA="#8B008B";ARptBox.HTMLColors.SADDLEBROWN="#8B4513";ARptBox.HTMLColors.DARKSEAGREEN="#8FBC8F";ARptBox.HTMLColors.LIGHTGREEN="#90EE90";ARptBox.HTMLColors.MEDIUMPURPLE="#9370DB";ARptBox.HTMLColors.DARKVIOLET="#9400D3";ARptBox.HTMLColors.PALEGREEN="#98FB98";ARptBox.HTMLColors.DARKORCHID="#9932CC";ARptBox.HTMLColors.YELLOWGREEN="#9ACD32";ARptBox.HTMLColors.SIENNA="#A0522D";ARptBox.HTMLColors.BROWN="#A52A2A";ARptBox.HTMLColors.DARKGRAY="#A9A9A9";ARptBox.HTMLColors.DARKGREY="#A9A9A9";ARptBox.HTMLColors.LIGHTBLUE="#ADD8E6";ARptBox.HTMLColors.GREENYELLOW="#ADFF2F";ARptBox.HTMLColors.PALETURQUOISE="#AFEEEE";ARptBox.HTMLColors.LIGHTSTEELBLUE="#B0C4DE";ARptBox.HTMLColors.POWDERBLUE="#B0E0E6";ARptBox.HTMLColors.FIREBRICK="#B22222";ARptBox.HTMLColors.DARKGOLDENROD="#B8860B";ARptBox.HTMLColors.MEDIUMORCHID="#BA55D3";ARptBox.HTMLColors.ROSYBROWN="#BC8F8F";ARptBox.HTMLColors.DARKKHAKI="#BDB76B";ARptBox.HTMLColors.SILVER="#C0C0C0";ARptBox.HTMLColors.MEDIUMVIOLETRED="#C71585";ARptBox.HTMLColors["INDIANRED "]="#CD5C5C";ARptBox.HTMLColors.PERU="#CD853F";ARptBox.HTMLColors.CHOCOLATE="#D2691E";ARptBox.HTMLColors.TAN="#D2B48C";ARptBox.HTMLColors.LIGHTGRAY="#D3D3D3";ARptBox.HTMLColors.LIGHTGREY="#D3D3D3";ARptBox.HTMLColors.THISTLE="#D8BFD8";ARptBox.HTMLColors.ORCHID="#DA70D6";ARptBox.HTMLColors.GOLDENROD="#DAA520";ARptBox.HTMLColors.PALEVIOLETRED="#DB7093";ARptBox.HTMLColors.CRIMSON="#DC143C";ARptBox.HTMLColors.GAINSBORO="#DCDCDC";ARptBox.HTMLColors.PLUM="#DDA0DD";ARptBox.HTMLColors.BURLYWOOD="#DEB887";ARptBox.HTMLColors.LIGHTCYAN="#E0FFFF";ARptBox.HTMLColors.LAVENDER="#E6E6FA";ARptBox.HTMLColors.DARKSALMON="#E9967A";ARptBox.HTMLColors.VIOLET="#EE82EE";ARptBox.HTMLColors.PALEGOLDENROD="#EEE8AA";ARptBox.HTMLColors.LIGHTCORAL="#F08080";ARptBox.HTMLColors.KHAKI="#F0E68C";ARptBox.HTMLColors.ALICEBLUE="#F0F8FF";ARptBox.HTMLColors.HONEYDEW="#F0FFF0";ARptBox.HTMLColors.AZURE="#F0FFFF";ARptBox.HTMLColors.SANDYBROWN="#F4A460";ARptBox.HTMLColors.WHEAT="#F5DEB3";ARptBox.HTMLColors.BEIGE="#F5F5DC";ARptBox.HTMLColors.WHITESMOKE="#F5F5F5";ARptBox.HTMLColors.MINTCREAM="#F5FFFA";ARptBox.HTMLColors.GHOSTWHITE="#F8F8FF";ARptBox.HTMLColors.SALMON="#FA8072";ARptBox.HTMLColors.ANTIQUEWHITE="#FAEBD7";ARptBox.HTMLColors.LINEN="#FAF0E6";ARptBox.HTMLColors.LIGHTGOLDENRODYELLOW="#FAFAD2";ARptBox.HTMLColors.OLDLACE="#FDF5E6";ARptBox.HTMLColors.RED="#FF0000";ARptBox.HTMLColors.FUCHSIA="#FF00FF";ARptBox.HTMLColors.MAGENTA="#FF00FF";ARptBox.HTMLColors.DEEPPINK="#FF1493";ARptBox.HTMLColors.ORANGERED="#FF4500";ARptBox.HTMLColors.TOMATO="#FF6347";ARptBox.HTMLColors.HOTPINK="#FF69B4";ARptBox.HTMLColors.CORAL="#FF7F50";ARptBox.HTMLColors.DARKORANGE="#FF8C00";ARptBox.HTMLColors.LIGHTSALMON="#FFA07A";ARptBox.HTMLColors.ORANGE="#FFA500";ARptBox.HTMLColors.LIGHTPINK="#FFB6C1";ARptBox.HTMLColors.PINK="#FFC0CB";ARptBox.HTMLColors.GOLD="#FFD700";ARptBox.HTMLColors.PEACHPUFF="#FFDAB9";ARptBox.HTMLColors.NAVAJOWHITE="#FFDEAD";ARptBox.HTMLColors.MOCCASIN="#FFE4B5";ARptBox.HTMLColors.BISQUE="#FFE4C4";ARptBox.HTMLColors.MISTYROSE="#FFE4E1";ARptBox.HTMLColors.BLANCHEDALMOND="#FFEBCD";ARptBox.HTMLColors.PAPAYAWHIP="#FFEFD5";ARptBox.HTMLColors.LAVENDERBLUSH="#FFF0F5";ARptBox.HTMLColors.SEASHELL="#FFF5EE";ARptBox.HTMLColors.CORNSILK="#FFF8DC";ARptBox.HTMLColors.LEMONCHIFFON="#FFFACD";ARptBox.HTMLColors.FLORALWHITE="#FFFAF0";ARptBox.HTMLColors.SNOW="#FFFAFA";ARptBox.HTMLColors.YELLOW="#FFFF00";ARptBox.HTMLColors.LIGHTYELLOW="#FFFFE0";ARptBox.HTMLColors.IVORY="#FFFFF0";ARptBox.HTMLColors.WHITE="#FFFFFF";ARptBox.ColorsFromHTMLStyle=function(a,e){var k=a.split(";");for(var f=0;f<k.length;f++){var c=k[f].indexOf(":");if(c==-1){continue}var b=k[f].substring(0,c).trim().toUpperCase();var h=k[f].substring(c+1).trim().toUpperCase();var j=null;if(b.equals("BACKGROUND-COLOR")){j="Back"}else{if(b.equals("COLOR")){j="Fore"}else{continue}}if(h.length>5&&(h.substring(0,4).equals("RGB(")||h.substring(0,5).equals("RGBA("))){h=h.substring(h.substring(0,4).equals("RGB(")?4:5);h=h.substring(0,h.length-1);var g=h.split(",");if(g.length>=3){e.set_Value(new IDVariant(j),new IDVariant(parseInt(g[0].trim())|(parseInt(g[1].trim())<<8)|(parseInt(g[2].trim())<<16)))}continue}if(h[0]!="#"){h=ARptBox.HTMLColors[h]}if(h!=null&&h[0]=="#"){var d=parseInt(h.substring(1),16);e.set_Value(new IDVariant(j),new IDVariant(((d&255)<<16)|(d&65280)|((d&16711680)>>16)))}}};function ARptSpan(){this.Parent=null;this.ParentRptSpan=null;this.Text="";this.Value=new IDVariant();this.VisAttrIdx=-1;this.Scale=0;this.MaxLen=0;this.ValueSourceIdx=-1;this.Flags=0;this.Stretch=IDREGlb.STRTC_AUTO;this.ToolTip="";this.MimeType="";this.ValueList=null;this.Image=new MyImage();this.BackColor=-1;this.ForeColor=-1;this.FontMod="";this.Mask="";this.Watermark="";this.ClassName="";this.ChangeEventDef=RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE}ARptSpan.prototype.CopyFrom=function(b){this.ParentRptSpan=b.ParentRptSpan;this.Text=b.Text;this.Value=b.Value;this.VisAttrIdx=b.VisAttrIdx;this.InitFlags(b.GetFlags());this.MimeType=b.MimeType;this.MaxLen=b.MaxLen;this.Scale=b.Scale;this.ToolTip=b.ToolTip;this.ValueSourceIdx=b.ValueSourceIdx;this.Stretch=b.Stretch;this.Image=b.Image;this.BackColor=b.BackColor;this.ForeColor=b.ForeColor;this.FontMod=b.FontMod;this.Mask=b.Mask;this.Watermark=b.Watermark;this.ChangeEventDef=b.ChangeEventDef;this.ClassName=b.ClassName;if(b.ValueList!=null){this.ValueList=new ArrayList();IDREGlb.SetArraySize(this.ValueList,b.ValueList.Count());for(var a=0;a<b.ValueList.Count();a++){this.ValueList[a]=new CRptSpanValItem();this.ValueList[a].CopyFrom(b.ValueList[a])}}};ARptSpan.prototype.SetNewValue=function(g){this.Value=g;if(g.Type!=IDVariant.NULL){switch(this.ParentRptSpan.DataType){case IDREGlb.DT_NUM_INTEGER:g.changeType(IDVariant.INTEGER);break;case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_CURRENCY:g.changeType(IDVariant.DECIMAL);break;case IDREGlb.DT_NUM_FLOAT:g.changeType(IDVariant.FLOAT);break;case IDREGlb.DT_CHAR:case IDREGlb.DT_CHAR_FIXED:case IDREGlb.DT_DOC_TEXT:g.changeType(IDVariant.STRING);break;case IDREGlb.DT_BOOLEAN:g.changeType(IDVariant.INTEGER);break;case IDREGlb.DT_DATE:case IDREGlb.DT_DATETIME:case IDREGlb.DT_TIME:if(this.Mask.length>0){g=IDL.ToDateTime(g,new IDVariant(this.Mask))}else{g.changeType(IDVariant.DATETIME)}break}var f=null;if(this.ParentRptSpan.Parent.PSection!=null){f=this.ParentRptSpan.Parent.PSection.Parent.Parent.VisualStyleList}else{f=this.ParentRptSpan.Parent.PMastro.Parent.VisualStyleList}this.Text=g.ToString();var e=new IDVariant(g);if(this.Mask.length>0){this.Text=IDL.Format(g,new IDVariant(this.Mask),this.GetMainFrm()).stringValue()}else{if(!f.ApplyMask(this.VisAttrIdx,g,e,this.GetMainFrm())){var a="";switch(this.ParentRptSpan.DataType){case IDREGlb.DT_NUM_FLOAT:a=f.Parent.Parent.FloatMsk;break;case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_CURRENCY:a=f.Parent.Parent.CurrencyMsk;break;case IDREGlb.DT_DATE:a=f.Parent.Parent.DateMsk;break;case IDREGlb.DT_DATETIME:a=f.Parent.Parent.DateMsk+" "+f.Parent.Parent.TimeMsk;break;case IDREGlb.DT_TIME:a=f.Parent.Parent.TimeMsk;break}if(!a.equals("")){this.Text=IDL.Format(g,new IDVariant(a),this.GetMainFrm()).stringValue()}}else{this.Text=e.stringValue()}}var d=(this.ValueList!=null?this.ValueList:this.ParentRptSpan.ValueList);if(d!=null&&d.Count()>0){var c=new IDVariant("");var b=new IDVariant("");this.ValueSourceIdx=this.ParentRptSpan.GetValueSourceVal(d,f,this.Value,c,b);if(f.ControlType(this.VisAttrIdx)!=IDREGlb.VISCTRL_EDIT){this.Text=c.ToString()}this.ToolTip=b.ToString();if(this.ValueSourceIdx!=-1&&d[this.ValueSourceIdx].VisualStyle!=-1){this.VisAttrIdx=d[this.ValueSourceIdx].VisualStyle}}}else{this.Text=""}};ARptSpan.prototype.IsZero=function(){switch(this.Value.Type){case IDVariant.NULL:return true;case IDVariant.INTEGER:return(this.Value.intValue()==0);case IDVariant.FLOAT:return(this.Value.dblValue()==0);case IDVariant.DATETIME:return false;case IDVariant.DECIMAL:return(this.Value.decValue()==0);case IDVariant.STRING:return(this.Value.stringValue()==null||this.Value.stringValue().length==0);case IDVariant.BLOB:return false}return false};ARptSpan.prototype.IsEmpty=function(){return this.Text.equals("")};ARptSpan.prototype.InitFlags=function(a){this.Flags=a};ARptSpan.prototype.GetFlags=function(){var a=this.Flags;if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_RPTSPAN_VISIBLE}if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_ENABLED)==0){a&=~IDREGlb.FL_RPTSPAN_ENABLED}return a};ARptSpan.prototype.GetFlag=function(a){if(a==IDREGlb.FL_RPTSPAN_VISIBLE&&(this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}if(a==IDREGlb.FL_RPTSPAN_ENABLED&&(this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_ENABLED)==0){return false}return(this.Flags&a)!=0};ARptSpan.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_RPTSPAN_VISIBLE}if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_ENABLED)==0){this.Flags&=~IDREGlb.FL_RPTSPAN_ENABLED}};ARptSpan.prototype.ProcessRequest=function(l){var c=this.ParentRptSpan.Parent.PMastro.Parent;if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_ENABLED)==0){if(c.DTTObj.Level>0){c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),416,"ARptSpan.ProcessRequest","Span "+c.Parent.GetObjName(this.ParentRptSpan.SpanID)+": Span has been activated but a Role item prevent the span to be ENABLED -> skipping activation")}return}var g=c.UpdateCount;var e=this.ParentRptSpan.Parent.PMastro.Parent.VisualStyleList.ControlType(this.VisAttrIdx);if(e==IDREGlb.VISCTRL_CHECK&&this.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){var j=this.GetMainFrm();if(!j.ParamsObj().UseRD3){var n=l.stringValue();var m=this.ValueList;if(m==null){m=this.ParentRptSpan.ValueList}if(m!=null&&m.Count()>=2&&e==IDREGlb.VISCTRL_CHECK){if(n.length>0){l=m[0].Value}else{l=m[1].Value}}}}if(this.ParentRptSpan.DataType!=IDREGlb.DT_UNSPEC){l.changeType(IDREGlb.GetOLEType(this.ParentRptSpan.DataType))}if(!l.equals(this.Value)){var f=new ArrayList();var h=new ArrayList();if(this.Parent.ParentSect!=null){var b=this.Parent.ParentRptBox;while(b!=null){h.Insert(0,b);b=b.PSection.Parent.ParentBox}for(var d=0;d<h.Count();d++){b=h[d];f.Add(b.PSection.Parent.DSE.GetCurrentPosition());if(b.PSection.Parent.ParentBox!=null){b.PSection.Parent.DSE.Close();b.PSection.Parent.DSE.UpdateIMDB(true);b.PSection.Parent.DSE.Open()}b.PSection.Parent.DSE.SetCurrentPosition(this.Parent.DSEPositions[d])}}if(c.DTTObj.Level>0){c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),417,"ARptSpan.ProcessRequest","Span "+c.Parent.GetObjName(this.ParentRptSpan.SpanID)+": Span value has changed from "+this.Value+" to "+l+" -> Fire OnChangingSpan event")}var o=new IDVariant(0);if(this.Parent.ParentSect!=null){c.FormattingObj=this.Parent.ParentSect;c.FormattingType=IDREGlb.FRM_SECTION_PERM}else{if(this.Parent.ParentPage!=null){c.FormattingObj=this.Parent.ParentPage;c.FormattingType=IDREGlb.FRM_PAGE}}var k=c.Parent.GetNewID2OldID(this.ParentRptSpan.SpanID);c.Parent.Fire_OnChangingSpan(k,this.Value,l,o);if(c.UpdateCount!=g){c.AbortProcessReq=true;if(c.DTTObj.Level>0){c.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,c.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),418,"ARptSpan.ProcessRequest","Book "+c.Parent.GetObjName(0)+": Book has been refreshed -> span change handling stopped")}if(this.Parent.ParentSect!=null){c.FormattingObj=this.Parent.ParentSect;c.FormattingType=IDREGlb.FRM_SECTION_PERM}else{if(this.Parent.ParentPage!=null){c.FormattingObj=this.Parent.ParentPage;c.FormattingType=IDREGlb.FRM_PAGE}}c.Parent.AObjectChanged(this)}else{if(o.intValue()!=-1){if(this.Parent.ParentSect!=null){this.SetNewValue(l);if(c.DTTObj.Level>0){c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),418,"ARptSpan.ProcessRequest","Span "+c.Parent.GetObjName(this.ParentRptSpan.SpanID)+": Storing value in book's memory")}if(this.ParentRptSpan.FldIdx!=-1){if(c.DTTObj.Level>0){c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),419,"ARptSpan.ProcessRequest","Span "+c.Parent.GetObjName(this.ParentRptSpan.SpanID)+": The span is directly connected with a Field -> storing value in DataSource")}this.Parent.ParentSect.ParentSection.Parent.DSE.SetFieldValue(this.ParentRptSpan.FldIdx,this.Value)}}}else{if(c.DTTObj.Level>0){c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),418,"ARptSpan.ProcessRequest","Span "+c.Parent.GetObjName(this.ParentRptSpan.SpanID)+": Value change has been canceled -> restoring original value")}var a=this.Value;this.SetNewValue(l);c.Parent.AObjectChanged(this);this.SetNewValue(a)}if(f.Count()!=0){for(var d=0;d<h.Count();d++){var b=h[d];b.PSection.Parent.DSE.SetCurrentPosition(f[d])}}}c.FormattingType=IDREGlb.FRM_NONE;c.FormattingObj=null}};ARptSpan.prototype.GetStretch=function(a){if(this.Stretch==IDREGlb.STRTC_AUTO){if(a instanceof CPEPDF){return IDREGlb.STRTC_ENLARGE}if(a instanceof CPEHTML){return IDREGlb.STRTC_NONE}}return this.Stretch};ARptSpan.prototype.IsLastLineOfParagraph=function(){if(this.Parent.ParentSect!=null&&this.Parent.ParentSect.Parent!=null){var a=this.Parent.ParentSect.Parent.GetState(this.Parent.ParentSect.ParentSection.Parent);if(a!=null&&a.DSEState.ActualPosition==this.Parent.ParentSect.DSEPosition){var b=a.GetState(this.Parent.ParentSect.ParentSection);if(b!=null&&b.FindObject(this.ParentRptSpan)!=null){return false}}}return true};ARptSpan.prototype.GetMainFrm=function(){if(this.ParentRptSpan.Parent.PSection!=null){return this.ParentRptSpan.Parent.PSection.Parent.Parent.MainFrm}else{return this.ParentRptSpan.Parent.PMastro.Parent.MainFrm}};ARptSpan.prototype.GetParentBook=function(){if(this.ParentRptSpan.Parent.PSection!=null){return this.ParentRptSpan.Parent.PSection.Parent.Parent}else{return this.ParentRptSpan.Parent.PMastro.Parent}};ARptSpan.prototype.GetClientMask=function(g,t,u,y,s,f){var v,n;var a=this.GetMainFrm();if(a!=null&&a.ParamsObj().UseClientMask){switch(Glb.ClassDT(this.ParentRptSpan.DataType)){case Glb.DTC_CHAR:f.set(new IDVariant("A"));v=y;if(y.equals(">")){g.set(new IDVariant(s.toUpperCase()));t.set(new IDVariant(y))}else{if(y.equals("<")){g.set(new IDVariant(s.toLowerCase()));t.set(new IDVariant(y))}else{if(y.length>0){var m=v.charAt(v.length-1);while(v.length<this.MaxLen){v+=m}if(v.length>this.MaxLen){v=v.remove(this.MaxLen,v.length-this.MaxLen)}n=v;var o=0;var b=true;for(var r=0;r<n.length;r++){var k=n.charAt(r);if(k=="A"||k=="a"||k=="&"||k=="#"||k=="%"){if(o>=s.length){n=n.remove(r,n.length-r);break}n=n.substr(0,r)+s.charAt(o)+n.substr(r+1);o++;b=false}else{if(b&&o<s.length){if(n.charAt(r)==s.charAt(o)){o++}else{o=0;b=false}}}}g.set(new IDVariant(n));t.set(new IDVariant(v))}else{g.set(new IDVariant(s))}}}break;case Glb.DTC_DATE:f.set(new IDVariant("D"));if(y.length>0){t.set(new IDVariant(y))}else{switch(this.ParentRptSpan.DataType){case Glb.DT_DATE:t.set(new IDVariant(a.ParamsObj().DefaultDateMask));break;case Glb.DT_TIME:t.set(new IDVariant(a.ParamsObj().DefaultTimeMask));break;case Glb.DT_DATETIME:t.set(new IDVariant(a.ParamsObj().DefaultDateMask+" "+a.ParamsObj().DefaultTimeMask));break}}if(t.stringValue().length==0){g.set(new IDVariant(s))}else{g.set(IDL.Format(u,t,a))}break;case Glb.DTC_NUMBER:f.set(new IDVariant("N"));if(y.length>0){t.set(new IDVariant(y))}else{switch(this.ParentRptSpan.DataType){case Glb.DT_NUM_CURRENCY:t.set(new IDVariant(a.ParamsObj().DefaultCurrencyMask));break;case Glb.DT_NUM_FIXED:t.set(new IDVariant(a.ParamsObj().DefaultCurrencyMask));break;case Glb.DT_NUM_FLOAT:t.set(new IDVariant(a.ParamsObj().DefaultFloatMask));break;case Glb.DT_NUM_INTEGER:t.set(IDL.Add(IDL.Replicate(new IDVariant("#"),new IDVariant(this.MaxLen-1)),new IDVariant("0")));break}}if(t.stringValue().length==0){g.set(new IDVariant(s))}else{v=t.stringValue();var x=-1;var d=-1;var h=v.indexOf(".");switch(this.ParentRptSpan.DataType){case Glb.DT_NUM_CURRENCY:x=this.MaxLen;if(h>-1){d=v.length-h-1}break;case Glb.DT_NUM_FIXED:x=this.MaxLen;d=this.Scale;break;case Glb.DT_NUM_INTEGER:x=this.MaxLen;d=0;break}var q=x-d;var c=0;if(q>0){if(h==-1){h=v.length}for(var e=h-1;e>=0;e--){if(v.charAt(e)=="0"||v.charAt(e)=="#"){c++;if(c==q){if(e>0){v=v.remove(0,e)}break}}}}h=v.indexOf(".");if(h>-1&&d>=0){q=d;if(q==0){v.length=h}else{c=0;for(var e=h+1;e<v.length;e++){if(v.charAt(e)=="0"||v.charAt(e)=="#"){c++;if(c==q){v=v.substr(0,e+1);break}}}}}t.set(new IDVariant(v));g.set(IDL.Format(u,t,a));for(var e=0;e<v.length;e++){if(v.charAt(e)=="."){break}if(v.charAt(e)=="0"){v=v.substr(0,e)+"#"+v.substr(e+1)}}if(!a.ParamsObj().UseDecimalDot){h=v.indexOf(".");v=v.Replace(",",".");if(h>=0){v=v.substr(0,h)+","+v.substr(h+1)}}t.set(new IDVariant(v))}break}}else{g.set(new IDVariant(s));t.set(new IDVariant(""))}};ARptSpan.prototype.GetRD3Ident=function(){return"spn:S"+this.ParentRptSpan.SpanID+this.Parent.GetRD3Ident().substr(4)};ARptSpan.prototype.RD3RenderDifference=function(f,m,c){var h=this.Parent.GetPage();h.RD3ObjMap[this.GetRD3Ident()]=this;var e=(m?null:new BitArray(RD3Glb.SPN_MAXPROPS));var a=new IDVariant();var n=m;if(!n){if(h.RD3ChangedObjects!=null){var j=h.RD3ChangedObjects[this.GetRD3Ident()];if(j!=null){n=this.CalcRD3Difference(j,e,a)}}else{if(c!=null&&c.RD3ObjMap!=null){n=this.CalcRD3Difference(c.RD3ObjMap[this.GetRD3Ident()],e,a);if(!n&&c.RD3ChangedObjects!=null&&c.RD3ChangedObjects[this.GetRD3Ident()]!=null){n=true;e.SetAll(true);if(this.ValueList==null&&this.ParentRptSpan.ValueList.Count()==0){e[RD3Glb.SPN_VALUELIST]=false}}}}}var b=null;if(m){b=f.AddNewElement("spn")}if(a.isTrue()){b=f.AddNewElement("ins");b.SetAttribute("parid",this.Parent.GetRD3Ident());var g=this.Parent.Spans.IndexOf(this);b.SetAttribute("previd",(g==this.Parent.Spans.Count()-1||this.Parent.Spans[g+1]==null?"":this.Parent.Spans[g+1].GetRD3Ident()));n=true;e.SetAll(true);if(this.ValueList==null&&this.ParentRptSpan.ValueList.Count()==0){e[RD3Glb.SPN_VALUELIST]=false}}if(b==null&&n){b=f.AddNewElement("chg")}if(b!=null){b.SetAttribute("id",this.GetRD3Ident())}if(m||n){for(var d=0;d<RD3Glb.SPN_MAXPROPS;d++){if(m||e[d]){this.SetRD3Property(d,b,m)}}}if(m||a.isTrue()){var l=this.ChangeEventDef;if((this.Flags&IDREGlb.FL_RPTSPAN_ACTIVE)!=0){l|=RD3Glb.EVENT_IMMEDIATE}if(l!=(RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE)){b.SetAttribute("chg",l)}}var k=n;return k};ARptSpan.prototype.CalcRD3Difference=function(c,d,a){if(c==null){a.set(true);return true}d[RD3Glb.SPN_TEXT]=((c.Text==null)!=(this.Text==null)||(c.Text!=null&&!c.Text.equals(this.Text)));if(!d[RD3Glb.SPN_TEXT]&&(c.ValueList!=this.ValueList||this.GetParentBook().ChangedObj.Contains(this.ParentRptSpan))){d[RD3Glb.SPN_TEXT]=true}d[RD3Glb.SPN_VALUE]=(!c.Value.equals(this.Value));d[RD3Glb.SPN_VISATTR]=(c.VisAttrIdx!=this.VisAttrIdx);d[RD3Glb.SPN_MAXLEN]=(c.MaxLen!=this.MaxLen);d[RD3Glb.SPN_VISIBLE]=(c.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)!=this.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE));d[RD3Glb.SPN_ENABLED]=(c.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)!=this.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED));d[RD3Glb.SPN_STRETCH]=(c.Stretch!=this.Stretch);d[RD3Glb.SPN_TOOLTIP]=((c.ToolTip==null)!=(this.ToolTip==null)||(c.ToolTip!=null&&!c.ToolTip.equals(this.ToolTip)));d[RD3Glb.SPN_MIME]=((c.MimeType==null)!=(this.MimeType==null)||(c.MimeType!=null&&!c.MimeType.equals(this.MimeType)));d[RD3Glb.SPN_HASIMAGE]=(c.Image.IsEmpty()!=this.Image.IsEmpty());d[RD3Glb.SPN_VALUELIST]=(c.ValueList!=this.ValueList||this.GetParentBook().ChangedObj.Contains(this.ParentRptSpan));d[RD3Glb.SPN_DATATYPE]=(c.ParentRptSpan.DataType!=this.ParentRptSpan.DataType);d[RD3Glb.SPN_SCALE]=(c.Scale!=this.Scale);d[RD3Glb.SPN_BACKCOLOR]=(c.BackColor!=this.BackColor);d[RD3Glb.SPN_FORECOLOR]=(c.ForeColor!=this.ForeColor);d[RD3Glb.SPN_FONTMOD]=((c.FontMod==null)!=(this.FontMod==null)||(c.FontMod!=null&&!c.FontMod.equals(this.FontMod)));d[RD3Glb.SPN_MASK]=((c.Mask==null)!=(this.Mask==null)||(c.Mask!=null&&!c.Mask.equals(this.Mask)));d[RD3Glb.SPN_WATERMARK]=((c.Watermark==null)!=(this.Watermark==null)||(c.Watermark!=null&&!c.Watermark.equals(this.Watermark)));d[RD3Glb.SPN_CLASSNAME]=((c.ClassName==null)!=(this.ClassName==null)||(c.ClassName!=null&&!c.ClassName.equals(this.ClassName)));for(var b=0;b<RD3Glb.SPN_MAXPROPS;b++){if(d[b]){return true}}return false};ARptSpan.prototype.SetRD3Property=function(m,o,k){switch(m){case RD3Glb.SPN_TEXT:if((this.Text==null||this.Text.length==0)&&k){break}var d=(this.Text==null)?"":this.Text;if((this.Flags&IDREGlb.FL_RPTSPAN_ENABLED)==0){var l=this.GetParentBook();var a=l.VisualStyleList.Mask(this.VisAttrIdx);if(!this.Mask.equals("")){a=this.Mask}if(!a.equals("=")&&l.PE instanceof CPEHTML){d=l.PE.HTMLEncode(d,true)}d=PFieldSrv.EncodeMultiLineSpaces(d)}var j=this.GetParentBook().VisualStyleList.Flags(this.VisAttrIdx);if((j&Glb.FL_VIS_PASSWORD)!=0){d="********"}if(this.ValueSourceIdx>=0&&(j&Glb.FL_VIS_SHOWIMAGE)!=0&&(j&Glb.FL_VIS_SHOWVALUE)==0){d=""}o.SetAttribute("txt",d);break;case RD3Glb.SPN_VALUE:if((this.ValueList!=null||this.ParentRptSpan.ValueList.Count()>0)){if((this.Value==null||this.Value.Type==IDVariant.NULL||this.Value.stringValue().length==0)&&k){break}o.SetAttribute("val",this.Value.ToString())}if(this.ValueSourceIdx>=0){var e=(this.ValueList==null)?this.ParentRptSpan.ValueList:this.ValueList;var h=e[this.ValueSourceIdx];if(h.ImagePath.length>0){o.SetAttribute("img",h.ImagePath)}o.SetAttribute("idx",this.ValueSourceIdx.toString())}break;case RD3Glb.SPN_VISATTR:if((this.VisAttrIdx==0||this.VisAttrIdx==this.Parent.VisAttrIdx)&&k){break}o.SetAttribute("sty",this.GetParentBook().VisualStyleList.GetTrueIdx(this.VisAttrIdx).toString());break;case RD3Glb.SPN_MAXLEN:if((this.MaxLen==255||this.MaxLen==0)&&k){break}o.SetAttribute("max",this.MaxLen.toString());break;case RD3Glb.SPN_DATATYPE:if(Glb.ClassDT(this.ParentRptSpan.DataType)==Glb.DTC_CHAR&&k){break}o.SetAttribute("dat",this.ParentRptSpan.DataType.toString());break;case RD3Glb.SPN_SCALE:if(this.Scale==0&&k){break}o.SetAttribute("sca",this.Scale.toString());break;case RD3Glb.SPN_VISIBLE:if((this.Flags&IDREGlb.FL_RPTSPAN_VISIBLE)!=0&&k){break}o.SetAttribute("vis",((this.Flags&IDREGlb.FL_RPTSPAN_VISIBLE)!=0)?"1":"0");break;case RD3Glb.SPN_ENABLED:if((this.Flags&IDREGlb.FL_RPTSPAN_ENABLED)==0&&k){break}o.SetAttribute("ena",((this.Flags&IDREGlb.FL_RPTSPAN_ENABLED)!=0)?"1":"0");break;case RD3Glb.SPN_STRETCH:if(this.Stretch==IDREGlb.STRTC_AUTO&&k){break}o.SetAttribute("str",this.Stretch.toString());break;case RD3Glb.SPN_TOOLTIP:if((this.ToolTip==null||this.ToolTip.length==0)&&k){break}o.SetAttribute("tip",(this.ToolTip==null)?"":this.ToolTip);break;case RD3Glb.SPN_MIME:if((this.MimeType==null||this.MimeType.length==0)&&k){break}o.SetAttribute("mim",(this.MimeType==null)?"":this.MimeType);break;case RD3Glb.SPN_HASIMAGE:if((this.Image==null||this.Image.IsEmpty())&&k){break}o.SetAttribute("him",(this.Image!=null&&!this.Image.IsEmpty())?"1":"0");break;case RD3Glb.SPN_VALUELIST:if(this.ValueList==null&&this.ParentRptSpan.ValueList.Count()==0&&k&&(this.Flags&IDREGlb.FL_RPTSPAN_ENABLED)==0){break}var e=(this.ValueList==null)?this.ParentRptSpan.ValueList:this.ValueList;if(e.Count()>0){var c=o.AddNewElement("val");for(var n=0;n<e.Count();n++){var g=e[n];g.RD3RenderDifference(c,k,this.GetMainFrm())}}else{if(!k&&(this.ValueList==null||this.ValueList.Count()==0)){o.AddNewElement("val")}}break;case RD3Glb.SPN_BACKCOLOR:if(this.BackColor==-1&&k){break}o.SetAttribute("bkc",(this.BackColor==-1?"":Glb.GetWebColor(this.BackColor)));break;case RD3Glb.SPN_FORECOLOR:if(this.ForeColor==-1&&k){break}o.SetAttribute("frc",(this.ForeColor==-1?"":Glb.GetWebColor(this.ForeColor)));break;case RD3Glb.SPN_FONTMOD:if((this.FontMod==null||this.FontMod.length==0)&&k){break}o.SetAttribute("ftm",(this.FontMod==null)?"":this.FontMod);break;case RD3Glb.SPN_MASK:if((this.Mask==null||this.Mask.length==0)&&k){break}o.SetAttribute("msk",(this.Mask==null)?"":this.Mask);break;case RD3Glb.SPN_WATERMARK:if((this.Watermark==null||this.Watermark.length==0)&&k){break}o.SetAttribute("wtk",(this.Watermark==null)?"":this.Watermark);break;case RD3Glb.SPN_CLASSNAME:if((this.ClassName==null||this.ClassName.length==0)&&k){break}o.SetAttribute("cln",(this.ClassName==null)?"":this.ClassName);break}};function ASection(){this.Parent=null;this.ParentSection=null;this.XPos=0;this.YPos=0;this.Height=0;this.Flags=0;this.VisAttrIdx=-1;this.ColSpace=0;this.NumCol=0;this.MastroBox=null;this.DSEPosition=-1;this.BoxList=new ArrayList();this.GH_DSEPos=-1;this.GH_PageNum=-1;this.PageChanged=false;this.ClassName="";this.RD3IdentName=null}ASection.prototype.CopyFrom=function(a){this.Parent=a.Parent;this.ParentSection=a.ParentSection;this.XPos=a.XPos;this.YPos=a.YPos;this.Height=a.Height;this.Flags=a.Flags;this.VisAttrIdx=a.VisAttrIdx;this.ColSpace=a.ColSpace;this.NumCol=a.NumCol;this.MastroBox=a.MastroBox;this.DSEPosition=a.DSEPosition;this.GH_DSEPos=a.GH_DSEPos;this.GH_PageNum=a.GH_PageNum;this.PageChanged=a.PageChanged;this.ClassName=a.ClassName};ASection.prototype.SetHeight=function(b){var a=this.ParentSection.Parent.Parent;this.Height=a.ConvertToInternalValue(b)};ASection.prototype.GetHeight=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.Height)};ASection.prototype.GetColSpace=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.ColSpace)};ASection.prototype.GetYPos=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.YPos)};ASection.prototype.ContainsBoxes=function(){for(var a=0;a<this.BoxList.Count();a++){if(this.BoxList[a]!=null&&this.BoxList[a].GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){return false}}return true};ASection.prototype.IsFullyPrinted=function(){for(var a=0;a<this.BoxList.Count();a++){if(this.BoxList[a]==null||!this.BoxList[a].IsFullyPrinted()){return false}}return true};ASection.prototype.IsEmpty=function(){for(var a=0;a<this.BoxList.Count();a++){if(this.BoxList[a]!=null&&!this.BoxList[a].IsEmpty()){return false}}return true};ASection.prototype.GetAsARptBox=function(){var a=new ARptBox();a.XPos=this.XPos;a.YPos=this.YPos;a.Height=this.Height;a.Width=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);a.VisAttrIdx=this.VisAttrIdx;if(this.GetFlag(IDREGlb.FL_SECT_VISIBLE)){a.InitFlags(IDREGlb.FL_RPTBOX_VISIBLE)}a.ParentSect=this;return a};ASection.prototype.FindObject=function(c){if(c==this.ParentSection){return this}for(var a=0;a<this.BoxList.Count();a++){var d=this.BoxList[a];if(d.ParentRptBox==c){return d}for(var e=0;e<d.Spans.Count();e++){if(d.Spans[e].ParentRptSpan==c){return d.Spans[e]}}}if(this.MastroBox!=null&&this.MastroBox.ParentSect!=null){return this.MastroBox.ParentSect.FindObject(c)}return null};ASection.prototype.InitFlags=function(a){this.Flags=a};ASection.prototype.GetFlags=function(){var a=this.Flags;if((this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_SECT_VISIBLE}return a};ASection.prototype.GetFlag=function(a){if(a==IDREGlb.FL_SECT_VISIBLE&&(this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return((this.Flags&a)!=0)};ASection.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_SECT_VISIBLE}};ASection.prototype.ArrangeColumn=function(){var a=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);this.XPos=this.MastroBox.LastColumnUsed*(a+this.ColSpace);this.MastroBox.LastColumnUsed++;if(this.MastroBox.LastColumnUsed>=this.NumCol){this.MastroBox.LastColumnUsed=0;return true}else{return false}};ASection.prototype.GetPage=function(){if(this.Parent!=null){return this.Parent}else{var b=null;var a=this;while(b==null){a=a.MastroBox.ParentSect;b=a.Parent}return b}};ASection.prototype.SplitSubSection=function(d,e){var c=this.ParentSection.Parent.Parent;if(this.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(this.ParentSection.SectionID),500,"ASection.SplitSubSection","Section "+c.Parent.GetObjName(this.ParentSection.SectionID)+": Section has KeepTogether flag set thus can NOT be divided -> This sub-section will remain a single piece")}return false}var g=new ASection();g.CopyFrom(this);g.Height=0;var j=false;for(var a=0;a<this.BoxList.Count();a++){var k=this.BoxList[a];if(d.YFilledPos+e.YPos+this.YPos+k.YPos+k.Height<=d.Height){this.BoxList.RemoveAt(a--);g.BoxList.Add(k);k.ParentSect=g;g.Height=k.YPos+k.Height;if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(k.ParentRptBox.BoxID),501,"ASection.SplitSubSection","Sub-Box "+c.Parent.GetObjName(k.ParentRptBox.BoxID)+": Sub-Box formatted successfully");c.DTTObj.AddParameter("","","Box XPos",c.InternalUnitToString(k.XPos));c.DTTObj.AddParameter("","","Box YPos",c.InternalUnitToString(k.YPos));c.DTTObj.AddParameter("","","Box Width",c.InternalUnitToString(k.Width));c.DTTObj.AddParameter("","","Box Height",c.InternalUnitToString(k.Height))}}else{if(!j){j=(k.SubSections!=null&&k.SubSections.Count()>0);if(k.SplitSubBox(d,g,e.YPos)){if(k.SubSections==null||k.SubSections.Count()==0){this.BoxList.RemoveAt(a--)}continue}}if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(k.ParentRptBox.BoxID),502,"ASection.SplitSubSection","Sub-Box "+c.Parent.GetObjName(k.ParentRptBox.BoxID)+": Sub-Box can't be placed on the box and can NOT be split -> Storing in the cache for next page");c.DTTObj.AddParameter("","","Box YPos",c.InternalUnitToString(k.YPos));c.DTTObj.AddParameter("","","Box Height",c.InternalUnitToString(k.Height));c.DTTObj.AddParameter("","","MastroBox Height",c.InternalUnitToString(d.Height));c.DTTObj.AddParameter("","","Section YPos",c.InternalUnitToString(this.YPos))}k.YPos-=g.Height}}if(g.BoxList.Count()>0){e.SubSections.Add(g);g.MastroBox=e;e.Height=g.YPos+g.Height;var f=0;for(var a=0;a<this.BoxList.Count();a++){var k=this.BoxList[a];f=Math.max(f,k.YPos+k.Height)}this.Height=f;this.YPos=0;if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(this.ParentSection.SectionID),503,"ASection.SplitSubSection","Section "+c.Parent.GetObjName(this.ParentSection.SectionID)+": Section has been split in 2 parts (SubBoxes formatted = "+g.BoxList.Count()+", SubBoxes that remains in cache = "+this.BoxList.Count()+")")}return true}if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(this.ParentSection.SectionID),504,"ASection.SplitSubSection","Section "+c.Parent.GetObjName(this.ParentSection.SectionID)+": Section has NOT been split (meybe the section is too short to contain sub-boxes)")}return false};ASection.prototype.GetRD3Ident=function(){if(this.RD3IdentName==null){this.RD3IdentName="sec:S"+this.ParentSection.SectionID+"R"+(this.ParentSection.SectType==IDREGlb.SECT_DETAIL?this.ParentSection.Parent.DSE.GetRowId():this.ParentSection.Parent.DSE.GetCurrentPosition());if(this.ParentSection.Parent.ParentBox!=null){this.RD3IdentName+=":";var a=this.ParentSection.Parent.ParentBox;while(a!=null&&a.PSection.Parent!=null){this.RD3IdentName+="R"+(a.PSection.SectType==IDREGlb.SECT_DETAIL?a.PSection.Parent.DSE.GetRowId():a.PSection.Parent.DSE.GetCurrentPosition());a=a.PSection.Parent.ParentBox;if(a!=null){this.RD3IdentName+="B"+a.BoxID}}}this.RD3IdentName+=":"+this.MastroBox.ParentRptBox.PMastro.Parent.FrIndex+":"+this.MastroBox.ParentRptBox.PMastro.Parent.Parent.Parent.Parent.FormIdx}return this.RD3IdentName};ASection.prototype.RD3RenderDifference=function(k,r,e){var n=this.GetPage();n.RD3ObjMap[this.GetRD3Ident()]=this;var h=(r?null:new BitArray(RD3Glb.SEC_MAXPROPS));var a=new IDVariant();var t=r;if(!t){if(n.RD3ChangedObjects!=null){var o=n.RD3ChangedObjects[this.GetRD3Ident()];if(o!=null){t=this.CalcRD3Difference(o,h,a)}}else{if(e!=null&&e.RD3ObjMap!=null){t=this.CalcRD3Difference(e.RD3ObjMap[this.GetRD3Ident()],h,a);if(!t&&e.RD3ChangedObjects!=null&&e.RD3ChangedObjects[this.GetRD3Ident()]!=null){t=true;h.SetAll(true)}}}}var c=null;if(r){c=k.AddNewElement("sec")}if(a.isTrue()){c=k.AddNewElement("ins");if(this.ParentSection.Parent.ParentBox!=null){c.SetAttribute("parid",this.MastroBox.GetRD3Ident());var m=this.MastroBox.SubSections.IndexOf(this);c.SetAttribute("previd",(m==this.MastroBox.SubSections.Count()-1?"":(this.MastroBox.SubSections[m+1]).GetRD3Ident()))}else{c.SetAttribute("parid",n.GetRD3Ident());var g=null;var m=n.Sections.IndexOf(this);for(var f=m+1;f<n.Sections.Count()&&g==null;f++){var u=n.Sections[f];if(u.MastroBox==this.MastroBox){g=u}}c.SetAttribute("previd",(g!=null?g.GetRD3Ident():""))}t=true;h.SetAll(true)}if(c==null&&t){c=k.AddNewElement("chg")}if(c!=null){c.SetAttribute("id",this.GetRD3Ident())}if(r||t){for(var f=0;f<RD3Glb.SEC_MAXPROPS;f++){if(r||h[f]){this.SetRD3Property(f,c,r)}}}var q=t;var d=(r)?c:k;for(var l=0;l<this.BoxList.Count();l++){var j=this.BoxList[l];q|=j.RD3RenderDifference(d,r,e)}return q};ASection.prototype.CalcRD3Difference=function(c,d,a){if(c==null){a.set(true);return true}d[RD3Glb.SEC_XPOS]=(c.XPos!=this.XPos);d[RD3Glb.SEC_YPOS]=(c.YPos!=this.YPos);d[RD3Glb.SEC_WIDTH]=(c.MastroBox.Width!=this.MastroBox.Width||c.NumCol!=this.NumCol||c.ColSpace!=this.ColSpace);d[RD3Glb.SEC_HEIGHT]=(c.Height!=this.Height);d[RD3Glb.SEC_VISATTR]=(c.VisAttrIdx!=this.VisAttrIdx);d[RD3Glb.SEC_VISIBLE]=(c.GetFlag(IDREGlb.FL_SECT_VISIBLE)!=this.GetFlag(IDREGlb.FL_SECT_VISIBLE));d[RD3Glb.SEC_NUMCOL]=(c.NumCol!=this.NumCol);d[RD3Glb.SEC_COLSPACE]=(c.ColSpace!=this.ColSpace);d[RD3Glb.SEC_MASTRO]=(!c.MastroBox.GetRD3Ident().equals(this.MastroBox.GetRD3Ident()));d[RD3Glb.SEC_RECNUM]=(c.DSEPosition!=this.DSEPosition);d[RD3Glb.SEC_OVERLAY]=(c.GetFlag(IDREGlb.FL_SECT_OVERLAY)!=this.GetFlag(IDREGlb.FL_SECT_OVERLAY));d[RD3Glb.SEC_CLASSNAME]=((c.ClassName==null)!=(this.ClassName==null)||(c.ClassName!=null&&!c.ClassName.equals(this.ClassName)));for(var b=0;b<RD3Glb.SEC_MAXPROPS;b++){if(d[b]){return true}}return false};ASection.prototype.SetRD3Property=function(a,d,c){switch(a){case RD3Glb.SEC_XPOS:if(this.XPos==0&&c){break}d.SetAttribute("xp",this.XPos.toString());break;case RD3Glb.SEC_YPOS:if(this.YPos==0&&c){break}d.SetAttribute("yp",this.YPos.toString());break;case RD3Glb.SEC_HEIGHT:d.SetAttribute("hei",this.Height.toString());break;case RD3Glb.SEC_WIDTH:var b=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);d.SetAttribute("wid",b.toString());break;case RD3Glb.SEC_VISATTR:if(this.VisAttrIdx==0&&c){break}d.SetAttribute("sty",this.ParentSection.Parent.Parent.VisualStyleList.GetTrueIdx(this.VisAttrIdx).toString());break;case RD3Glb.SEC_VISIBLE:if((this.Flags&IDREGlb.FL_SECT_VISIBLE)!=0&&c){break}d.SetAttribute("vis",((this.Flags&IDREGlb.FL_SECT_VISIBLE)!=0)?"1":"0");break;case RD3Glb.SEC_COLSPACE:if(this.ColSpace==0&&c){break}d.SetAttribute("csp",this.ColSpace.toString());break;case RD3Glb.SEC_NUMCOL:if(this.NumCol==1&&c){break}d.SetAttribute("col",this.NumCol.toString());break;case RD3Glb.SEC_MASTRO:d.SetAttribute("mas",this.MastroBox.GetRD3Ident());break;case RD3Glb.SEC_RECNUM:d.SetAttribute("rec",this.DSEPosition.toString());break;case RD3Glb.SEC_OVERLAY:if((this.Flags&IDREGlb.FL_SECT_OVERLAY)==0&&c){break}d.SetAttribute("ovr",((this.Flags&IDREGlb.FL_SECT_OVERLAY)!=0)?"1":"0");break;case RD3Glb.SEC_CLASSNAME:if((this.ClassName==null||this.ClassName.length==0)&&c){break}d.SetAttribute("cln",(this.ClassName==null)?"":this.ClassName);break}};ASection.prototype.RD3FindBox=function(e){for(var a=0;a<this.BoxList.Count();a++){var f=this.BoxList[a];if(f.GetRD3Ident()==e){return f}if(f.SubSections!=null){for(var d=0;d<f.SubSections.Count();d++){var g=f.SubSections[d];var c=g.RD3FindBox(e);if(c!=null){return c}}}}return null};ASection.prototype.GetBoxesList=function(c){for(var b=0;b<this.BoxList.Count();b++){var d=this.BoxList[b].SubSections;if(d!=null){for(var a=0;a<d.Count();a++){subSection[a].GetBoxesList(c)}}else{c.Add(this.BoxList[b])}}};function ASectionState(){this.Parent=null;this.ParentSection=null;this.MastroBox=null;this.Height=0;this.Flags=0;this.VisAttrIdx=-1;this.ColSpace=0;this.NumCol=0;this.SavedHeight=-1;this.PrevBottomBorder=0;this.Reprint=false;this.GH_DSEPos=-1;this.GH_PageNum=-1;this.PageChanged=false;this.ClassName="";this.BoxStates=new ArrayList();this.SavedBoxStates=new ArrayList();this.RD3IdentName=null}ASectionState.prototype.CopyFrom=function(e){this.ParentSection=e.ParentSection;this.MastroBox=e.MastroBox;this.Height=e.Height;this.InitFlags(e.GetFlags());this.VisAttrIdx=e.VisAttrIdx;this.NumCol=e.NumCol;this.ColSpace=e.ColSpace;this.PrevBottomBorder=e.PrevBottomBorder;this.PageChanged=e.PageChanged;this.ClassName=e.ClassName;var a=this.Parent.ParentReport.GetPermanentState(this);if(a!=null){this.InitFlags(a.Flags)}for(var d=0;d<e.BoxStates.Count();d++){var b=e.BoxStates[d];if(b.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){var c=new ARptBox();c.CopyFrom(b);this.BoxStates.Add(c)}}};ASectionState.prototype.IsEmpty=function(){for(var a=0;a<this.BoxStates.Count();a++){var b=this.BoxStates[a];if(!b.IsEmpty()){return false}}return true};ASectionState.prototype.FindObject=function(c){if(c==this.ParentSection){return this}for(var b=0;b<this.BoxStates.Count();b++){var d=this.BoxStates[b];if(d.ParentRptBox==c){return d}for(var f=0;f<d.Spans.Count();f++){var a=d.Spans[f];if(a!=null&&a.ParentRptSpan==c){return d.Spans[f]}}}var e=this.ParentSection.Parent;while(e.ParentBox!=null){var h=e.ParentBox.PSection.Parent;if(h.FormattingObj==null){break}var g=h.FormattingObj.FindObject(c);if(g!=null){return g}e=e.ParentBox.PSection.Parent}return null};ASectionState.prototype.SetHeight=function(b){var a=this.ParentSection.Parent.Parent;this.Height=a.ConvertToInternalValue(b)};ASectionState.prototype.SetColSpace=function(b){var a=this.ParentSection.Parent.Parent;this.ColSpace=a.ConvertToInternalValue(b)};ASectionState.prototype.GetHeight=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.Height)};ASectionState.prototype.GetColSpace=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.ColSpace)};ASectionState.prototype.GetYPos=function(){var a=this.ParentSection.Parent.Parent;if(this.MastroBox!=null){return a.ConvertFromInternalValue(this.MastroBox.YFilledPos)}else{return -1}};ASectionState.prototype.InitFlags=function(a){this.Flags=a};ASectionState.prototype.GetFlags=function(){var a=this.Flags;if((this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_SECT_VISIBLE}return a};ASectionState.prototype.GetFlag=function(a){if(a==IDREGlb.FL_SECT_VISIBLE&&(this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return((this.Flags&a)!=0)};ASectionState.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_SECT_VISIBLE}};ASectionState.prototype.GetBottomBorder=function(){var c=0;for(var a=0;a<this.BoxStates.Count();a++){var b=this.BoxStates[a];if(!b.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){continue}c=Math.max(c,b.YPos+b.Height)}return this.Height-c};ASectionState.prototype.Arrange=function(){this.SavedBoxStates.Clear();if(this.NumCol==0){this.NumCol=this.ParentSection.NumCol}if(this.BoxStates.Count()==0){return}this.SavedHeight=this.Height;for(var k=0;k<this.BoxStates.Count();k++){var f=this.BoxStates[k];var e=new ARptBox();e.CopyFrom(f,false,false);this.SavedBoxStates.Add(e)}var d=this.ParentSection.Parent.Parent;var m=Math.floor((this.ParentSection.RendersInto.Width-(this.ParentSection.NumCol-1)*this.ParentSection.ColSpace)/this.ParentSection.NumCol);var l=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);if((m-l)*100/m>20&&this.ParentSection.NumCol==this.NumCol&&this.ParentSection.ColSpace==this.ColSpace){var h=Math.floor((this.MastroBox.Width+this.ColSpace)/(m+this.ColSpace));if(h<1){h=1}if(this.NumCol!=h&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentSection.SectionID),650,"ASectionState.Arrange","Section "+d.Parent.GetObjName(this.ParentSection.SectionID)+": Section width is smaller than design time by more than 20% -> Suppressing columns (from "+this.NumCol+" to "+h+", OrigColWidth = "+d.InternalUnitToString(m)+", NewColWidth = "+d.InternalUnitToString(l)+")")}this.NumCol=h}l=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);var n=m-l;if(n==0){return}if(d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentSection.SectionID),505,"ASectionState.Arrange","Section "+d.Parent.GetObjName(this.ParentSection.SectionID)+": Section width is different from design time -> Adapting section's content -> DeltaWidth = "+d.InternalUnitToString(n))}var c=new ArrayList();for(var j=0;j<this.BoxStates.Count();j++){c.Add(this.BoxStates[j])}var g=new CBoxArranger();g.BookObj=d;g.Init(c,n,0,new CRect(0,0,l,this.Height));var a=100;if(this.ParentSection.Parent.Parent.UM==IDREGlb.BOOKUM_INCH){a=254}if(g.BookObj.GridSize!=-1){a=g.BookObj.GridSize}g.Arrange(a);g.Apply(true)};ASectionState.prototype.Reset=function(){if(this.SavedHeight>-1){this.Height=this.SavedHeight}for(var a=0;a<this.BoxStates.Count();a++){var c=this.BoxStates[a];if(c.SpanDivList!=null){c.SpanDivList=null}for(var b=0;b<this.SavedBoxStates.Count();b++){var d=this.SavedBoxStates[b];if(d.ParentRptBox==c.ParentRptBox){c.Width=d.Width;c.XPos=d.XPos;if(this.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){c.Height=d.Height;c.YPos=d.YPos}break}}}this.SavedBoxStates.Clear()};ASectionState.prototype.GetRD3Ident=function(){if(this.RD3IdentName==null){this.RD3IdentName="sec:S"+this.ParentSection.SectionID+"R"+(this.ParentSection.SectType==IDREGlb.SECT_DETAIL?this.ParentSection.Parent.DSE.GetRowId():this.ParentSection.Parent.DSE.GetCurrentPosition());if(this.ParentSection.Parent.ParentBox!=null){this.RD3IdentName+=":";var a=this.ParentSection.Parent.ParentBox;while(a!=null&&a.PSection.Parent!=null){this.RD3IdentName+="R"+(a.PSection.SectType==IDREGlb.SECT_DETAIL?a.PSection.Parent.DSE.GetRowId():a.PSection.Parent.DSE.GetCurrentPosition());a=a.PSection.Parent.ParentBox;if(a!=null){this.RD3IdentName+="B"+a.BoxID}}}this.RD3IdentName+=":"+this.MastroBox.ParentRptBox.PMastro.Parent.FrIndex+":"+this.MastroBox.ParentRptBox.PMastro.Parent.Parent.Parent.Parent.FormIdx}return this.RD3IdentName};function CBook(){this.Name="";this.UM=IDREGlb.BOOKUM_MM;this.Flags=0;this.VisualStyleList=new VisAttrListIDRE();this.IMDB=null;this.MastroList=new ArrayList();this.ReportsList=new ArrayList();this.FrIndex=-1;this.MainFrm=null;this.DTTObj=null;this.FormattingObj=null;this.FormattingType=IDREGlb.FRM_NONE;this.FormattingPage=null;this.Parent=null;this.PE=null;this.MultiplePE=null;this.PrintDestination=IDREGlb.PRN_NONE;this.OutputFileName="";this.AutoOutFileName=false;this.WebFileName="";this.PrinterName="";this.IsPrinting=false;this.TotalPagesNumber=0;this.TotalPagesNumberConf=false;this.IsPrecounting=false;this.Bookmark=null;this.FixedWidth=0;this.FixedHeight=0;this.PrintingFromPage=-1;this.PrintingToPage=-1;this.GridSize=-1;this.PagesList=new ArrayList();this.ImagesPath=new ArrayList();this.DDSrcBox=null;this.DDDstBox=null;this.UpdateCount=0;this.AbortProcessReq=false;this.HtmlFontHStretch=0;this.PDFDocInfo=new IDMap();this.EnabledCommands=-5;this.ChangedObj=new ArrayList()}CBook.prototype.SetMainFrm=function(a){this.MainFrm=a;this.DTTObj=a.getDTTObj()};CBook.prototype.UMastro=function(){return new IDVariant(this.MastroList.Count())};CBook.prototype.bMastro=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.MastroList.Count()?null:this.MastroList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.FindObjByID(this.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CBook.prototype.UReport=function(){return new IDVariant(this.ReportsList.Count())};CBook.prototype.bReport=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.ReportsList.Count()?null:this.ReportsList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.FindObjByID(this.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CBook.prototype.AddVerboseMsg=function(d,e,c,a,b){if(b==undefined){b=new IDVariant("")}this.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,d,e,c,a,b)};CBook.prototype.InternalUnitToString=function(a){return IDL.FormatNumber(this.ConvertFromInternalValue(a),"0.00",",","")+(this.UM==IDREGlb.BOOKUM_MM?" mm":" inch")};CBook.prototype.GetPEDevice=function(){switch(this.PrintDestination){case IDREGlb.PRN_SCREEN:return IDREGlb.DEV_SCREEN;case IDREGlb.PRN_PRINTER:return IDREGlb.DEV_PRINTER;default:return IDREGlb.DEV_NONE}};CBook.prototype.PrintPages=function(k,c){if(c==undefined){c=-1}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),401,"CBook.PrintPages","Book "+this.Name+": Printing from "+(k<=1?"beginning":"page "+k)+" to "+(c==-1?"end":"page "+c))}if((this.Flags&IDREGlb.FL_BOOK_PRECOUNT)!=0&&!this.IsPrecounting&&!this.TotalPagesNumberConf){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),402,"CBook.PrintPages","Book "+this.Name+": Precount flag active -> start precounting...")}this.IsPrecounting=true;var g=this.PrintPages(1,-1);this.RefreshPages(1);this.IsPrecounting=false;if(!g){return false}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),403,"CBook.PrintPages","Book "+this.Name+": Precount complete (Total Pages = "+this.TotalPagesNumber+") -> Restart printing from "+(k<=1?"beginning":"page "+k)+" to "+(c==-1?"end":"page "+c))}}var f=true;if(k<1){k=1}var m=c;if(this.CacheSize()!=1&&c!=-1){var n=new IDVariant(0);var e=new IDVariant(0);this.GetPageIntervals(c,n,e);k=n.intValue();c=e.intValue()}this.PE.Device=this.GetPEDevice();if(this.MultiplePE!=null){this.MultiplePE.Device=this.GetPEDevice()}var l=null;if(this.PrintDestination==IDREGlb.PRN_PDF){this.IsPrinting=true;l=this.PE;l.Device=IDREGlb.DEV_SCREEN;this.PE=new CPEPDF();this.PE.Parent=this;if(l instanceof CPEHTML){this.PE.Device=IDREGlb.DEV_PDF;if(!this.OutputFileName.equals("")&&this.AutoOutFileName){this.OutputFileName=""}if(this.OutputFileName.length==0){this.AutoOutFileName=true;while(true){var b="PDF"+Math.floor(Math.random()*2147483647)+".pdf";this.WebFileName="temp/"+b;this.OutputFileName=this.GetTempDir()+"/"+b;if(!VBFiles.FileExists(new IDVariant(this.OutputFileName))){break}}this.AddToTempFiles(this.OutputFileName);if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),404,"CBook.PrintPages","Book "+this.Name+": Printing book to PDF using random file name");this.DTTObj.AddParameter("","","Output File Name",new IDVariant(this.OutputFileName))}}else{if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),405,"CBook.PrintPages","Book "+this.Name+": Printing book to PDF");this.DTTObj.AddParameter("","","Output File Name",new IDVariant(this.OutputFileName))}}}this.PE.PDFFileName=this.OutputFileName}this.PrintingFromPage=k;this.PrintingToPage=c;if(this.PE.StartDocument()){if(this.DTTObj.Level>0){this.DTTObj.AddWhile(this.Parent.GetRTCGuid(0),"Book "+this.Name+".Print"+(this.IsPrecounting?" (pre-counting)":""),"")}var a=this.DTTObj.LoggedLoops;this.DTTObj.LoggedLoops=this.DTTObj.MaxLoopCycles;var j=k;var d;do{if(this.DTTObj.Level>0&&!this.DTTObj.CheckLoop(this.Parent.GetRTCGuid(0),j-k+1)){break}d=this.FormatPage(j-1);if(d!=null){var h=this.TotalPagesNumber;this.TotalPagesNumber=Math.max(this.TotalPagesNumber,j);if(this.Parent!=null&&h!=this.TotalPagesNumber){this.Parent.Parent.RD3Change(RD3Glb.BOK_PAGETOTAL)}if(!this.IsPrecounting&&(this.CacheSize()==1||j<=m)){this.ShowPage(d)}j++}else{this.TotalPagesNumberConf=true;if(this.Parent!=null){this.Parent.Parent.RD3Change(RD3Glb.BOK_PAGECONFIRMED)}}}while((c==-1||j<=c)&&d!=null);this.DTTObj.LoggedLoops=a;if(this.DTTObj.Level>0){this.DTTObj.EndWhile(this.Parent.GetRTCGuid(0),"Book "+this.Name,"",j-k)}this.PE.EndDocument()}else{f=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.GetRTCGuid(0),400,"CBook.PrintPages","Book "+this.Name+": Can't start the document")}if(this.IsPrinting){this.IsPrinting=false;this.PE=null;this.PE=l}return f};CBook.prototype.RefreshPages=function(g,b){if(b==undefined){b=-1}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),406,"CBook.RefreshPages","Book "+this.Name+": Deleting pages from "+(g<=1?"beginning":"page "+g)+" to "+(b==-1?"end":"page "+b))}this.UpdateCount++;if(g<1){g=1}if(b==-1||b>this.PagesList.Count()){b=this.PagesList.Count()}for(var a=g-1;a<b;a++){this.PagesList[a]=null}if(!this.IsPrecounting){var f=false;var d=this.TotalPagesNumber;for(this.TotalPagesNumber=this.PagesList.Count();this.TotalPagesNumber>1;this.TotalPagesNumber--){if(this.PagesList[this.TotalPagesNumber-1]==null){if(this.TotalPagesNumberConf&&this.Parent!=null){this.Parent.Parent.RD3Change(RD3Glb.BOK_PAGECONFIRMED)}this.TotalPagesNumberConf=false}else{f=true}}if(!f){this.TotalPagesNumber=0}if(this.Parent!=null&&d!=this.TotalPagesNumber){this.Parent.Parent.RD3Change(RD3Glb.BOK_PAGETOTAL)}}if(g==1){for(var c=0;c<this.ReportsList.Count();c++){var e=this.ReportsList[c];if(e.DSE.IsOpen()){e.DSE.Close(e.ParentBox!=null)}}}this.PE.Reset();if(this.MultiplePE!=null){this.MultiplePE.Reset()}if(this.Parent!=null){this.Parent.Parent.RD3ResetPageCache()}};CBook.prototype.FormatPage=function(d){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),465,"CBook.FormatPage","Book "+this.Name+": Start formatting page "+(d+1))}if(d<=this.PagesList.Count()-1&&(this.PagesList[d]!=null)){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),466,"CBook.FormatPage","Book "+this.Name+": Page "+(d+1)+" has been already printed. Retrieving it from cache")}return this.PagesList[d]}if(d!=0&&this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),467,"CBook.FormatPage","Book "+this.Name+": Page "+(d+1)+" was not printed before. Looking for a good starting point")}var c;for(c=Math.min(d,this.PagesList.Count()-1);c>=0;c--){if(this.PagesList[c]!=null){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),468,"CBook.FormatPage","Book "+this.Name+": Found page "+(c+1)+" in cache: starting from here")}break}}if(d!=0&&c<0&&this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),469,"CBook.FormatPage","Book "+this.Name+": Starting point not found -> start from beginning")}var f=false;if(this.PrintDestination==IDREGlb.PRN_NONE||this.PrintDestination==IDREGlb.PRN_SCREEN){for(var e=0;e<this.ReportsList.Count();e++){var h=this.ReportsList[e];if(h.ParentBox!=null&&!h.ParentBox.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)&&h.ParentBox.PSection!=null&&!h.ParentBox.PSection.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){f=true;break}}}if(d>=this.PagesList.Count()){IDREGlb.SetArraySize(this.PagesList,d+1)}var g=null;for(var b=c;b<d;b++){this.PagesList[b+1]=this.CreateNextPage(b==-1?null:this.PagesList[b]);g=this.PagesList[b+1];if(g==null){break}if(this.CacheSize()!=1&&d-c<this.CacheSize()){continue}if(b>-1&&(this.IsPrinting||b%10!=0)&&!f){if(this.PE.PrintingPage==this.PagesList[b]){this.PE.PrintingPage=null}this.PagesList[b]=null;if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),470,"CBook.FormatPage","Book "+this.Name+": Deleting page "+(b+1)+" in order to save memory")}}}if(g!=null&&this.PE.PrintingPage!=null&&(this.PE.PrintingPage.PageNum-1)%10!=0&&!f&&this.CacheSize()==1){var a=this.PE.PrintingPage.PageNum-1;this.PE.PrintingPage=null;if(this.PagesList[a]!=null){this.PagesList[a]=null;if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),471,"CBook.FormatPage","Book "+this.Name+": Deleting page "+(a+1)+" in order to save memory")}}}return g};CBook.prototype.CreateNextPage=function(e){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),472,"CBook.CreateNextPage","Book "+this.Name+": Looking for a report that needs to print something and asking him which page it needs")}var y=null;for(var n=0;n<this.ReportsList.Count();n++){var c=this.ReportsList[n];if(c.ParentBox!=null){continue}if(!c.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(c.GetFlag(IDREGlb.FL_REPORT_ANYPAGE)){continue}y=c.GetNextMastro(e);if(y!=null){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(c.ReportID),473,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(c.ReportID)+": Report asks for a new page of type '"+this.Parent.GetObjName(y.MastroID)+"'")}break}}if(y==null){for(var n=0;n<this.ReportsList.Count();n++){var c=this.ReportsList[n];if(c.ParentBox!=null){continue}if(!c.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(c.GetFlag(IDREGlb.FL_REPORT_ANYPAGE)){continue}var j=(e!=null?e.GetState(c):null);if(c.DSE.IsOpen()&&(j==null||j.PrintedSomething==0||j.PrintedSomething>e.PageNum)){var v=c.DSE.GetCurrentPosition();if(j==null||j.PrintedSomething==0){c.DSE.SetCurrentPosition(0)}if(!c.DSE.IsEof()){y=c.GetNextMastro(null);if(y!=null){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(c.ReportID),473,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(c.ReportID)+": Book was finished but report was never started and asks for a new page of type '"+this.Parent.GetObjName(y.MastroID)+"'")}c.DSE.SetCurrentPosition(v);break}}c.DSE.SetCurrentPosition(v)}}}if(y==null){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),474,"CBook.CreateNextPage","Book "+this.Name+": No report wants to print anything. Done printing")}return null}var x=new APage(y);this.FormattingPage=x;x.PageNum=(e!=null?e.PageNum+1:1);var a=this.PE.GetPageSize();if(x.Orientation==IDREGlb.MASTRO_OR_LANDSCAPE){var l=a.Width;a.Width=a.Height;a.Height=l}if(a.Width==0&&a.Height==0){a={Width:x.Width,Height:x.Height}}if(x.FitMode>=IDREGlb.MASTRO_FM_WIDTH){var k=new Object();k.Width=x.Width;k.Height=x.Height;if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(x.ParentMastro.MastroID),475,"CBook.CreateNextPage","Page "+this.Parent.GetObjName(x.ParentMastro.MastroID)+": FitMode = "+(x.FitMode==IDREGlb.MASTRO_FM_PAGE?"Page":"Width")+" -> handling "+(x.FitMode==IDREGlb.MASTRO_FM_PAGE?"page":"horizontal")+" resize")}var z=200;if(this.UM==IDREGlb.BOOKUM_INCH){z=Math.floor(z/2.54)}var q=0;var o=(this.MainFrm instanceof WebEntryPointSrv&&this.MainFrm.IsMobile());if(this.PE!=null&&this.PE instanceof CPEHTML&&x.FitMode==IDREGlb.MASTRO_FM_WIDTH&&!o){var s={Width:24,Height:0};this.ConvertFromPixelToPhysical(s,this.UM);q=s.Width}if(x.Orientation==IDREGlb.MASTRO_OR_PORTRAIT&&Math.abs(x.Width-a.Width)>z){x.Width=a.Width-q}if(x.Orientation==IDREGlb.MASTRO_OR_LANDSCAPE&&Math.abs(x.Height-a.Height)>z){x.Height=a.Height-q}if(x.FitMode==IDREGlb.MASTRO_FM_PAGE){if(x.Orientation==IDREGlb.MASTRO_OR_PORTRAIT&&Math.abs(x.Height-a.Height)>z){x.Height=a.Height}if(x.Orientation==IDREGlb.MASTRO_OR_LANDSCAPE&&Math.abs(x.Width-a.Width)>z){x.Width=a.Width}}if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){if(k.Width!=x.Width){this.AddVerboseMsg(this.Parent.GetRTCGuid(x.ParentMastro.MastroID),476,"CBook.CreateNextPage","Page "+this.Parent.GetObjName(x.ParentMastro.MastroID)+": Width changed from "+this.InternalUnitToString(k.Width)+" to "+this.InternalUnitToString(x.Width))}if(k.Height!=x.Height){this.AddVerboseMsg(this.Parent.GetRTCGuid(x.ParentMastro.MastroID),476,"CBook.CreateNextPage","Page "+this.Parent.GetObjName(x.ParentMastro.MastroID)+": Heigth changed from "+this.InternalUnitToString(k.Height)+" to "+this.InternalUnitToString(x.Height))}}}if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(x.ParentMastro.MastroID),477,"CBook.CreateNextPage","Page "+this.Parent.GetObjName(x.ParentMastro.MastroID)+": Fire OnFormatting event")}this.FormattingObj=x;this.FormattingType=IDREGlb.FRM_PAGE;var m=this.Parent.GetNewID2OldID(x.ParentMastro.MastroID);this.Parent.Fire_OnFormattingPage(m);this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null;x.Arrange();this.FormattingObj=x;this.FormattingType=IDREGlb.FRM_PAGE;this.Parent.Fire_OnAfterFormattingPage(m);this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null;var d=new HashTableSrv();for(var A=0;A<x.MastroBoxes.Count();A++){var h=x.MastroBoxes[A];if(h.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)&&this.PE.CanScroll){d[h]=h.Height;h.Height=2147483646}}for(var n=0;n<this.ReportsList.Count();n++){var u=this.ReportsList[n];if(u.ParentBox!=null){continue}if(!u.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(u.GetFlag(IDREGlb.FL_REPORT_ANYPAGE)){u.DSE.Close();if(e!=null&&e.GetState(u)!=null){for(var f=0;f<e.ReportStates.Count();f++){var g=e.ReportStates[f];if(g.ParentReport==u){e.ReportStates.Remove(g);break}}}}if(!u.DSE.IsOpen()){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(u.ReportID),478,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(u.ReportID)+": Opening data source")}u.OpenDSE()}else{if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(u.ReportID),479,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(u.ReportID)+": Data source was already open")}}if(u.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)&&u.DSE.GetNumRecords()==0){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(u.ReportID),480,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(u.ReportID)+": HideIfEmpty flag set and data source is empty -> skipping report")}continue}if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg("",0,"","---------- Report "+this.Parent.GetObjName(u.ReportID)+" ----------")}u.FormatPage(e,x)}x.RotateSections(null);this.FormattingPage=null;for(var A=0;A<x.MastroBoxes.Count();A++){var h=x.MastroBoxes[A];if(h.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)&&this.PE.CanScroll&&d[h]!=null){h.Height=d[h]}}if(x.Sections.Count()==0){x=null}return x};CBook.prototype.ShowPage=function(a){if(this.Parent!=null&&(this.PE.LastRD3Page==null||a==null||this.PE.LastRD3Page.PageNum!=a.PageNum)){this.Parent.Parent.RD3Change(RD3Glb.BOK_PAGENUM)}this.PE.PrintPage(a);if(this.MultiplePE!=null){this.MultiplePE.PrintPage(a)}};CBook.prototype.GetFormattingObj=function(a){switch(this.FormattingType){case IDREGlb.FRM_SECTION:return this.FormattingObj.FindObject(a);case IDREGlb.FRM_SECTION_AFT:return this.FormattingObj.FindObject(a);case IDREGlb.FRM_PAGE:return this.FormattingObj.FindObject(a);case IDREGlb.FRM_SECTION_PERM:return this.FormattingObj.FindObject(a)}return null};CBook.prototype.IsChildOfFormattingObj=function(a){switch(this.FormattingType){case IDREGlb.FRM_SECTION:return this.FormattingObj.ParentSection.IsChildOf(a);case IDREGlb.FRM_SECTION_AFT:return this.FormattingObj.ParentSection.IsChildOf(a);case IDREGlb.FRM_PAGE:return this.FormattingObj.ParentMastro.IsChildOf(a);case IDREGlb.FRM_SECTION_PERM:return this.FormattingObj.ParentSection.IsChildOf(a)}return false};CBook.prototype.Update=function(d){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),407,"CBook.Update","Book "+this.Name+": IMDB is changed")}this.UpdateCount++;var b=false;for(var e=0;e<this.ReportsList.Count();e++){var f=this.ReportsList[e];if(f.ParentBox!=null){continue}if(!f.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(f.DSE.UpdateIMDB(d)){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(f.ReportID),408,"CBook.Update","Report "+this.Parent.GetObjName(f.ReportID)+": Query has changed.")}b=true}}if(!b){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),409,"CBook.Update","Book "+this.Name+": None of reports query have changed. Skipping update")}return}var c=-1;if(this.PE!=null&&this.PE.PrintingPage!=null){c=this.PE.PrintingPage.PageNum;if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),410,"CBook.Update","Book "+this.Name+": Page "+c+" was shown at the moment. Updating book from beginning to this page")}}var a=this.PagesList.Count();this.PagesList.Clear();if(this.Parent!=null){this.Parent.Parent.RD3ResetPageCache();this.Parent.Parent.RD3Change(RD3Glb.BOK_PAGENUM);this.Parent.Parent.RD3Change(RD3Glb.BOK_PAGETOTAL);this.Parent.Parent.RD3Change(RD3Glb.BOK_PAGECONFIRMED)}this.PE.PrintingPage=null;this.TotalPagesNumber=0;this.TotalPagesNumberConf=false;if(c==-1){c=1}this.PrintPages(1,c);if(a!=0&&(this.PagesList.Count()==0||(this.PagesList.Count()==1&&this.PagesList[0]==null))){this.Parent.set_RD(true)}};CBook.prototype.ProcessRequest=function(s,o){this.AbortProcessReq=false;var k=this.UpdateCount;this.DDSrcBox=null;this.DDDstBox=null;if(!this.PE.ProcessRequest(s,o)&&!o){var d=s.GetParameter("DDDstID");if(d!=null){var h=s.GetParameter("DDSrcID");this.DDSrcBox=this.GetABoxByID(h);this.DDDstBox=this.GetABoxByID(d);this.BoxDrop(this.DDSrcBox,this.DDDstBox);if(this.UpdateCount!=k){this.AbortProcessReq=true}return}var g=s.GetParameter("DDTrID");if(g!=null){var c=s.GetParameter("DDNewX");var a=s.GetParameter("DDNewY");var e=s.GetParameter("DDNewW");var r=s.GetParameter("DDNewH");var m=this.GetABoxByID(g);if(m!=null){if((m.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){return}var l,j,n,f;if(c!=null){l=parseFloat(c)}else{l=this.ConvertFromInternalValue(m.XPos)}if(a!=null){j=parseFloat(a)}else{j=this.ConvertFromInternalValue(m.YPos)}if(e!=null){n=parseFloat(e)}else{n=this.ConvertFromInternalValue(m.Width)}if(r!=null){f=parseFloat(r)}else{f=this.ConvertFromInternalValue(m.Height)}this.MoveDSEPositions(m);var q=m;while(q.ParentSect!=null){if(c!=null){l-=this.ConvertFromInternalValue(q.ParentSect.XPos)}if(a!=null){j-=this.ConvertFromInternalValue(q.ParentSect.YPos)}q=q.ParentSect.MastroBox;if(c!=null){l-=this.ConvertFromInternalValue(q.XPos)}if(a!=null){j-=this.ConvertFromInternalValue(q.YPos)}}var t=new IDVariant(false);this.FormattingObj=m.ParentSect;this.FormattingType=IDREGlb.FRM_SECTION_PERM;this.Parent.Fire_OnBoxTransform(m.ParentRptBox.BoxID,l,j,n,f,t);this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null;if(this.UpdateCount!=k){this.AbortProcessReq=true}}}}};CBook.prototype.GetABoxByID=function(f){var l="F"+this.FrIndex;if(f.indexOf(l)<0){return null}f=f.substr(l.length);for(var c=0;c<this.PagesList.Count();c++){var e=this.PagesList[c];for(var j=0;j<e.MastroBoxes.Count();j++){var k=e.MastroBoxes[j];var a=k.GetBoxByID(f);if(a!=null){return a}}for(var h=0;h<e.Sections.Count();h++){var d=e.Sections[h];for(var j=0;j<d.BoxList.Count();j++){var g=d.BoxList[j];var a=g.GetBoxByID(f);if(a!=null){return a}}}}return null};CBook.prototype.ConvertToInternalValue=function(a){return Math.floor(a*(this.UM==IDREGlb.BOOKUM_MM?100:1000))};CBook.prototype.ConvertFromInternalValue=function(a){return(a/(this.UM==IDREGlb.BOOKUM_MM?100:1000))};CBook.prototype.ConvertFromPixelToPhysical=function(b,a){b.Width=Math.floor(b.Width/96*1000);b.Height=Math.floor(b.Height/96*1000);if(a==IDREGlb.BOOKUM_MM){b.Width=Math.floor(b.Width*2.54);b.Height=Math.floor(b.Height*2.54)}return b};CBook.prototype.ConvertFromPhysicalToPixel=function(c){var a=0,b=0;if(this.UM==IDREGlb.BOOKUM_MM){a=c.Width/100/25.4;b=c.Height/100/25.4}else{if(this.UM==IDREGlb.BOOKUM_INCH){a=c.Width/1000;b=c.Height/1000}}c.Width=Math.floor(a*96);c.Height=Math.floor(b*96);return c};CBook.prototype.MoveDSEPositions=function(d){if(d.ParentSect!=null){var c=new ArrayList();var a=d.ParentRptBox;while(a!=null){c.Insert(0,a);a=a.PSection.Parent.ParentBox}for(var b=0;b<c.Count();b++){a=c[b];if(a.PSection.Parent.ParentBox!=null){a.PSection.Parent.DSE.Close();a.PSection.Parent.DSE.UpdateIMDB(true);a.PSection.Parent.DSE.Open()}a.PSection.Parent.DSE.SetCurrentPosition(d.DSEPositions[b])}}};CBook.prototype.BoxActivated=function(a){this.DTTObj.SetRequestName("Activate Box","Book "+this.Name+": box "+a.ParentRptBox.BoxID+" activated",DTTRequest.PRI_CMD);if((a.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(a.ParentRptBox.BoxID),411,"CBook.BoxActivated","Box "+this.Parent.GetObjName(a.ParentRptBox.BoxID)+": Box has been activated but a Role item prevent the box to be ENABLED -> skipping activation")}return}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(a.ParentRptBox.BoxID),412,"CBook.BoxActivated","Box "+this.Parent.GetObjName(a.ParentRptBox.BoxID)+": Box has been activated -> Activating object connected with the box")}if(a.ParentSect!=null){this.MoveDSEPositions(a);this.FormattingObj=a.ParentSect;this.FormattingType=IDREGlb.FRM_SECTION_PERM;var b=this.Parent.GetNewID2OldID(a.ParentRptBox.BoxID);this.Parent.Fire_Activated(b,a.GetHTMLName());this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null}else{this.FormattingObj=a.ParentPage;this.FormattingType=IDREGlb.FRM_PAGE;var b=this.Parent.GetNewID2OldID(a.ParentRptBox.BoxID);this.Parent.Fire_Activated(b,a.GetHTMLName());this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null}};CBook.prototype.AddToTempFiles=function(a){this.Parent.Parent.Parent.MainFrm.AddTempFile(a)};CBook.prototype.GetBaseDir=function(){return this.Parent.Parent.Parent.MainFrm.RealPath};CBook.prototype.GetTempDir=function(){return this.Parent.Parent.Parent.MainFrm.TempPath()};CBook.prototype.GetLastCachedPage=function(){for(var a=this.PagesList.Count()-1;a>=0;a--){if(this.PagesList[a]!=null){return this.PagesList[a]}}return null};CBook.AdaptWebFileName=function(a){if(a.indexOf("/")!=-1||a.indexOf("\\")!=-1){return a}return"images/"+a};CBook.prototype.RD3RenderDifference=function(d,b,c){var a=this.PE.RD3RenderDifference(d,b,c);this.ChangedObj.Clear();return a};CBook.prototype.RD3FindSpan=function(a){return this.PE.RD3FindSpan(a)};CBook.prototype.RD3FindBox=function(a){return this.PE.RD3FindBox(a)};CBook.prototype.BoxDrop=function(a,b){if(a==null||b==null){return}this.DDSrcBox=a;this.DDDstBox=b;if((this.DDSrcBox.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0||(this.DDDstBox.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){if(this.DTTObj.Level>0){var c="";if((this.DDSrcBox.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){c="source"}else{if((this.DDDstBox.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){c="destination"}}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(a.ParentRptBox.BoxID),413,"CBook.BoxDrop","Box "+this.Parent.GetObjName(a.ParentRptBox.BoxID)+": Box has been dropped onto box "+this.Parent.GetObjName(b.ParentRptBox.BoxID)+" but "+c+" box's Role prevent the box to handle the operation > Skipping")}return}this.MoveDSEPositions(this.DDDstBox);if(this.DDDstBox.ParentSect!=null){this.FormattingObj=this.DDDstBox.ParentSect;this.FormattingType=IDREGlb.FRM_SECTION_PERM}else{this.FormattingObj=this.DDDstBox.ParentPage;this.FormattingType=IDREGlb.FRM_PAGE}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(a.ParentRptBox.BoxID),414,"CBook.BoxDrop","Box "+this.Parent.GetObjName(a.ParentRptBox.BoxID)+": Box has been dropped onto box "+this.Parent.GetObjName(b.ParentRptBox.BoxID)+" -> Fire OnBoxDrop event")}this.Parent.Fire_OnBoxDrop(this.Parent.GetNewID2OldID(this.DDSrcBox.ParentRptBox.BoxID),this.Parent.GetNewID2OldID(this.DDDstBox.ParentRptBox.BoxID));this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null};CBook.prototype.GetSubForm=function(h){var e=new ArrayList(this.PagesList);if(this.FormattingPage!=null&&!e.Contains(this.FormattingPage)){e.Add(this.FormattingPage)}for(var g=0;g<e.Count();g++){var j=e[g];if(j==null){continue}for(var a=0;a<j.MastroBoxes.Count();a++){var f=j.MastroBoxes[a];if(f.SubForm!=null&&!h.Contains(f.SubForm)){h.Add(f.SubForm);f.SubForm.GetSubForm(h)}}for(var d=0;d<j.Sections.Count();d++){var c=j.Sections[d];for(var a=0;a<c.BoxList.Count();a++){var f=c.BoxList[a];if(f.SubForm!=null&&!h.Contains(f.SubForm)){h.Add(f.SubForm);f.SubForm.GetSubForm(h)}}}}if(this.FormattingType==IDREGlb.FRM_SECTION&&this.FormattingObj!=null){var c=this.FormattingObj;for(var a=0;a<c.BoxStates.Count();a++){var f=c.BoxStates[a];if(f.SubForm!=null&&f.SubForm.FormIdx>65536&&!h.Contains(f.SubForm)){h.Add(f.SubForm);f.SubForm.GetSubForm(h)}}}};CBook.prototype.CacheSize=function(){if(this.PE==null||!(this.PE instanceof CPEHTML)){return 1}return this.PE.CacheSize};CBook.prototype.set_CacheSize=function(c){if(this.PE==null||!(this.PE instanceof CPEHTML)){return}this.PE.CacheSize=c;var a=this.PE.LastRD3MultiPages;this.PE.LastRD3MultiPages=new Array(this.PE.CacheSize);if(a!=null){for(var b=0;b<Math.min(a.length,this.PE.CacheSize);b++){this.PE.LastRD3MultiPages[b]=a[b]}}};CBook.prototype.GetPageIntervals=function(f,e,a){var d=this.CacheSize();var b=f-Math.floor(d/2);var c=f+Math.floor(d/2);if(d%2==0){b++}if(this.TotalPagesNumberConf&&this.TotalPagesNumber<d){b=1;c=this.TotalPagesNumber}else{if(this.TotalPagesNumberConf&&f>this.TotalPagesNumber-d){c=this.TotalPagesNumber;b=Math.max(c-d+1,1)}if(b<=0){c+=-b+1;b+=-b+1}}e.set(new IDVariant(b));a.set(new IDVariant(c))};CBook.prototype.getPage=function(c){var b=null;if(c<this.PagesList.Count()){b=this.PagesList[c]}if(b==null){var a=this.PE.PrintingPage.PageNum;this.PrintPages(c+1,c+1);if(this.PE.PrintingPage.PageNum==a){return null}b=this.PagesList[c]}return b};function CCell(){this.BoxList=new ArrayList();this.Top=0;this.Height=0;this.Left=0;this.Width=0}function CBoxArranger(){this.Rows=0;this.Columns=0;this.MissingWidth=0;this.MissingHeight=0;this.Container;this.GridSize=0;this.BookObj=null;this.Matrix;this.BoxList}CBoxArranger.prototype.Init=function(g,h,u,e){this.Rows=0;this.Columns=0;this.BoxList=g;this.MissingWidth=h;this.MissingHeight=u;this.Container=e;var d,s;var l=new ArrayList();var q=new ArrayList();for(var t=0;t<this.BoxList.Count();t++){var o=this.BoxList[t];var k=o.XPos;var j=o.YPos;var m=o.Width;var a=o.Height;for(d=0;d<l.Count();d++){if(l[d]==j){break}}if(d==l.Count()){var n=0;for(n=0;n<l.Count();n++){if(l[n]>j){break}}l.Insert(n,j)}for(d=0;d<l.Count();d++){if(l[d]==j+a){break}}if(d==l.Count()){var n=0;for(n=0;n<l.Count();n++){if(l[n]>j+a){break}}l.Insert(n,(j+a))}for(s=0;s<q.Count();s++){if(q[s]==k){break}}if(s==q.Count()){var n=0;for(n=0;n<q.Count();n++){if(q[n]>k){break}}q.Insert(n,k)}for(s=0;s<q.Count();s++){if(q[s]==k+m){break}}if(s==q.Count()){var n=0;for(n=0;n<q.Count();n++){if(q[n]>k+m){break}}q.Insert(n,(k+m))}}this.Matrix=new Array(l.Count());for(var n=0;n<l.Count();n++){this.Matrix[n]=new Array(q.Count())}for(d=0;d<l.Count()-1;d++){for(s=0;s<q.Count()-1;s++){var f=new CCell();this.Matrix[d][s]=f;f.Top=l[d];f.Height=l[d+1]-l[d];f.Left=q[s];f.Width=q[s+1]-q[s];for(var t=0;t<this.BoxList.Count();t++){var o=this.BoxList[t];var k=o.XPos;var j=o.YPos;var m=o.Width;var a=o.Height;if(k<=f.Left&&k+m>=f.Left+f.Width&&j<=f.Top&&j+a>=f.Top+f.Height){f.BoxList.Add(o)}}}}this.Rows=l.Count()-1;this.Columns=q.Count()-1};CBoxArranger.prototype.Arrange=function(a){if(this.Rows==0||this.Columns==0){return}this.GridSize=a;if(this.MissingWidth!=0){this.ArrangeBand(false)}if(this.MissingHeight!=0){this.ArrangeBand(true)}};CBoxArranger.prototype.ArrangeBand=function(o){var l,k;var f=0;var r=new Array(o?this.Rows:this.Columns);var m=new Array(o?this.Rows:this.Columns);var e=(o?this.MissingHeight:this.MissingWidth);var s=0;for(l=0;l<(o?this.Rows:this.Columns);l++){m[l]=true;r[l]=false;for(k=0;k<(o?this.Columns:this.Rows);k++){var d;if(o){d=this.Matrix[l][k]}else{d=this.Matrix[k][l]}if(d.BoxList.Count()>0){m[l]=false;for(var q=0;q<d.BoxList.Count();q++){var n=d.BoxList[q];r[l]|=(o?n.VRsz:n.HRsz)!=IDREGlb.RSZ_STRETCH}}}if(!r[l]){if(m[l]){s+=(o?this.Matrix[l][0].Height:this.Matrix[0][l].Width)*e/(o?this.Container.height:this.Container.width)}else{f+=(o?this.Matrix[l][0].Height:this.Matrix[0][l].Width)-this.GridSize}}}if(this.GridSize>0){s=Math.floor(s/this.GridSize)*this.GridSize}var c=e;e-=s;if(e>f){e=f}if(e==0||f==0){return}for(l=0;l<(o?this.Rows:this.Columns);l++){var g=0;if(!r[l]){if(m[l]){g=(o?this.Matrix[l][0].Height:this.Matrix[0][l].Width)*c/(o?this.Container.height:this.Container.width)}else{g=((o?this.Matrix[l][0].Height:this.Matrix[0][l].Width)-this.GridSize)*e/f}}if(g!=0){for(k=0;k<(o?this.Columns:this.Rows);k++){var d;if(o){d=this.Matrix[l][k]}else{d=this.Matrix[k][l]}if(o){d.Height-=g}else{d.Width-=g}}for(var j=l+1;j<(o?this.Rows:this.Columns);j++){for(var h=0;h<(o?this.Columns:this.Rows);h++){var a;if(o){a=this.Matrix[j][h]}else{a=this.Matrix[h][j]}if(o){a.Top-=g}else{a.Left-=g}}}}}};CBoxArranger.prototype.Apply=function(a){if(this.MissingWidth!=0){this.ApplyBand(false)}if(this.MissingHeight!=0){this.ApplyBand(true)}if(a){this.DoKeepInside()}};CBoxArranger.prototype.ApplyBand=function(f){var l=new HashTableSrv();var n=new HashTableSrv();var d,c;for(d=0;d<(f?this.Columns:this.Rows);d++){for(c=0;c<(f?this.Rows:this.Columns);c++){var a;if(f){a=this.Matrix[c][d]}else{a=this.Matrix[d][c]}if(a.BoxList.Count()>0){for(var k=0;k<a.BoxList.Count();k++){var e=a.BoxList[k];var o=l[e.GetRD3Ident()];if(o==null){o=new CCell();if(f){o.Top=a.Top}else{o.Left=a.Left}l[e.GetRD3Ident()]=o;n[e.GetRD3Ident()]=e}if(o.Left==a.Left){o.Width=0}if(o.Top==a.Top){o.Height=0}if(f){o.Height+=a.Height}else{o.Width+=a.Width}}}}}if(this.GridSize>0){var j=l.keys();for(var m=0;m<j.length;m++){var e=n[j[m]];var o=l[e.GetRD3Ident()];if(e!=null&&o!=null){if(f){o.Top=Math.floor(o.Top/this.GridSize+0.5)*this.GridSize;o.Height=Math.floor(o.Height/this.GridSize+0.5)*this.GridSize}else{o.Left=Math.floor(o.Left/this.GridSize+0.5)*this.GridSize;o.Width=Math.floor(o.Width/this.GridSize+0.5)*this.GridSize}}}}var h=l.keys();for(var g=0;g<h.length;g++){var e=n[h[g]];var o=l[e.GetRD3Ident()];if(e!=null&&o!=null){if(f){if(e.VRsz>=IDREGlb.RSZ_MOVE){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e.YPos!=o.Top){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(e.ParentRptBox.BoxID),506,"CBoxArranger.ApplyBand","Box "+this.BookObj.Parent.GetObjName(e.ParentRptBox.BoxID)+": Box moved and changed Top from "+this.BookObj.InternalUnitToString(e.YPos)+" to "+this.BookObj.InternalUnitToString(o.Top))}e.YPos=o.Top}if(e.VRsz==IDREGlb.RSZ_STRETCH){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e.Height!=o.Height){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(e.ParentRptBox.BoxID),507,"CBoxArranger.ApplyBand","Box "+this.BookObj.Parent.GetObjName(e.ParentRptBox.BoxID)+": Box adapted and changed Height from "+this.BookObj.InternalUnitToString(e.Height)+" to "+this.BookObj.InternalUnitToString(o.Height))}e.Height=o.Height}}else{if(e.HRsz>=IDREGlb.RSZ_MOVE){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e.XPos!=o.Left){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(e.ParentRptBox.BoxID),506,"CBoxArranger.ApplyBand","Box "+this.BookObj.Parent.GetObjName(e.ParentRptBox.BoxID)+": Box moved and changed Left from "+this.BookObj.InternalUnitToString(e.XPos)+" to "+this.BookObj.InternalUnitToString(o.Left))}e.XPos=o.Left}if(e.HRsz==IDREGlb.RSZ_STRETCH){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e.Width!=o.Width){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(e.ParentRptBox.BoxID),507,"CBoxArranger.ApplyBand","Box "+this.BookObj.Parent.GetObjName(e.ParentRptBox.BoxID)+": Box adapted and changed Width from "+this.BookObj.InternalUnitToString(e.Width)+" to "+this.BookObj.InternalUnitToString(o.Width))}e.Width=o.Width}}}}};CBoxArranger.prototype.DoKeepInside=function(){for(var a=0;a<this.BoxList.Count();a++){var c=this.BoxList[a];var e=new CRect(c.XPos,c.YPos,c.XPos+c.Width,c.YPos+c.Height);var d=new CRect();d.Intersect(this.Container,e);if(d!=e){if(e.width>this.Container.width){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&c.Width!=this.Container.width){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),508,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was too big for its container and changed Width from "+this.BookObj.InternalUnitToString(c.Width)+" to "+this.BookObj.InternalUnitToString(this.Container.width))}c.Width=this.Container.width;e.setRight(e.left()+this.Container.width)}if(e.height>this.Container.height){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&c.Height!=this.Container.height){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),508,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was too big for its container and changed Height from "+this.BookObj.InternalUnitToString(c.Height)+" to "+this.BookObj.InternalUnitToString(this.Container.height))}c.Height=this.Container.height;e.setBottom(e.top()+this.Container.height)}if(e.left()<0){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),509,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was exiting from its container and moved horizzontally from "+this.BookObj.InternalUnitToString(c.XPos)+" to "+this.BookObj.InternalUnitToString(0))}c.XPos=0}if(e.top()<0){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),509,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was exiting from its container and moved vertically from "+this.BookObj.InternalUnitToString(c.YPos)+" to "+this.BookObj.InternalUnitToString(0))}c.YPos=0}if(e.right()>this.Container.right()){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),509,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was exiting from its container and moved horizzontally from "+this.BookObj.InternalUnitToString(c.XPos)+" to "+this.BookObj.InternalUnitToString(this.Container.right()-e.width))}c.XPos=this.Container.right()-e.width}if(e.bottom()>this.Container.bottom()){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),509,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was exiting from its container and moved vertically from "+this.BookObj.InternalUnitToString(c.YPos)+" to "+this.BookObj.InternalUnitToString(this.Container.bottom()-e.height))}c.YPos=this.Container.bottom()-e.height}}}};function CDSEAggr(){this.CountNN=0;this.Sum=new IDVariant();this.Sum2=0;this.Min=new IDVariant();this.Max=new IDVariant();this.DistinctSum=new IDVariant();this.UpdateDistinctSum=true}CDSEAggr.prototype.Update=function(a){if(a instanceof IDVariant){if(a.Type==IDVariant.NULL){return}this.CountNN++;if(this.Max.Type==IDVariant.NULL||a.CompareTo(this.Max)>0){this.Max=a}if(this.Min.Type==IDVariant.NULL||a.CompareTo(this.Min)<0){this.Min=a}if(this.IsNumber(a)){this.Sum.set(IDL.Add(this.Sum,a));var c=a.dblValue();this.Sum2+=c*c;if(this.UpdateDistinctSum){this.UpdateDistinctSum=false;this.DistinctSum.set(IDL.Add(this.DistinctSum,a))}}}else{if(a instanceof CDSEAggr){var b=a;this.CountNN+=b.CountNN;if(this.Max.Type==IDVariant.NULL||b.Max.CompareTo(this.Max)>0){this.Max=b.Max}if(this.Min.Type==IDVariant.NULL||b.Min.CompareTo(this.Min)<0){this.Min=b.Min}this.Sum.set(IDL.Add(this.Sum,b.Sum));this.DistinctSum.set(IDL.Add(this.DistinctSum,b.DistinctSum));this.Sum2+=b.Sum2}}};CDSEAggr.prototype.Compare=function(b,a){return b.CompareTo(a)};CDSEAggr.prototype.IsNumber=function(a){switch(a.Type){case IDVariant.INTEGER:case IDVariant.FLOAT:case IDVariant.DECIMAL:return true;default:return false}};CDSEAggr.prototype.GetAggrFunct=function(c,e){switch(c){case IDREGlb.AGGR_SUM:e.set(this.Sum);break;case IDREGlb.AGGR_AVE:if(this.CountNN==0){break}e.set(IDL.Div(this.Sum,new IDVariant(this.CountNN)));break;case IDREGlb.AGGR_VAR:this.GetAggrFunct(IDREGlb.AGGR_DEV,e);e.set(IDL.Mul(e,e));break;case IDREGlb.AGGR_DEV:var b=this.Sum.dblValue();var a=b/this.CountNN;var d=Math.sqrt((this.Sum2+this.CountNN*a*a-2*a*b)/(this.CountNN-1));e.set(new IDVariant(d));break;case IDREGlb.AGGR_CNT:e.set(new IDVariant(this.CountNN));break;case IDREGlb.AGGR_MIN:e.set(this.Min);break;case IDREGlb.AGGR_MAX:e.set(this.Max);break;case IDREGlb.AGGR_DSUM:e.set(this.DistinctSum);break}};function CDSEBase(){this.OpenState=false;this.flOrderData=false;this.MaxRows=0;this.Parent=null;this.GroupStringArray=new ArrayList();this.GroupArray=new ArrayList();this.Root=null;this.iGuid="";this.iAbsolutePosition=0;this.iRecordCount=0;this.iColumnCount=0;this.FieldNames=new ArrayList()}CDSEBase.prototype.GetFldIdx=function(a){return -1};CDSEBase.prototype.FieldName=function(a){return null};CDSEBase.prototype.GetFldParam=function(d,b,a,c){};CDSEBase.prototype.IsMyGroupTime=function(d,b,a){var c=(a!=null)?a.ActualPosition:this.iAbsolutePosition;if(this.Root==null){return false}if(c==0||this.IsEof()){return false}return this.Root.IsMyGroupTime(c,b,d)};CDSEBase.prototype.Next=function(a,c){if(a==undefined){a=null}if(c==undefined){c=false}if(a!=null){this.SetCurrentPosition(a.ActualPosition)}if(a!=null&&this.IsEof()){return null}if(!this.IsOpen()){return null}if(this.iAbsolutePosition==0||(this.IsEof()&&a==null)){this.MoveFirst();this.iAbsolutePosition=1}else{this.MoveNext();this.iAbsolutePosition++}var b=null;if(c){b=new ADSEState();b.ActualPosition=this.GetCurrentPosition()}return b};CDSEBase.prototype.GetCurrentPosition=function(){return this.iAbsolutePosition};CDSEBase.prototype.SetCurrentPosition=function(a){if(a==0){this.MoveFirst();this.MovePrevious();this.iAbsolutePosition=a}else{if(a>this.GetNumRecords()){this.MoveLast();this.MoveNext();this.iAbsolutePosition=this.GetNumRecords()+1}else{if(a>this.iAbsolutePosition){if(this.iAbsolutePosition==0){this.MoveFirst();this.iAbsolutePosition=1}while(this.iAbsolutePosition<a){this.iAbsolutePosition++;this.MoveNext()}}else{if(a<this.iAbsolutePosition){if(this.iAbsolutePosition>this.GetNumRecords()){this.MoveLast();this.iAbsolutePosition=this.GetNumRecords()}while(this.iAbsolutePosition>a){this.iAbsolutePosition--;this.MovePrevious()}}}}}};CDSEBase.prototype.GetNumRecords=function(){return this.iRecordCount};CDSEBase.prototype.IsEof=function(){return true};CDSEBase.prototype.IsOpen=function(){return this.OpenState};CDSEBase.prototype.GetFieldValue=function(a,b){a.set(new IDVariant(0))};CDSEBase.prototype.SetFieldValue=function(b,a){};CDSEBase.prototype.GetNumColumns=function(){return this.iColumnCount};CDSEBase.prototype.GetFieldName=function(a){return this.FieldNames[a]};CDSEBase.prototype.AddGroup=function(b){for(var a=0;a<this.GroupStringArray.Count();a++){if(this.GroupStringArray[a]==b){return a}}this.GroupStringArray.Add(b);return this.GroupStringArray.Count()-1};CDSEBase.prototype.Open=function(){this.OpenState=true;this.iAbsolutePosition=1;this.iRecordCount=this.RecordCount();this.iColumnCount=this.ColumnCount();if(this.iRecordCount>0){IDREGlb.SetArraySize(this.FieldNames,this.iColumnCount);for(var a=0;a<this.iColumnCount;a++){this.FieldNames[a]=this.FieldName(a+1)}this.CreateGroups()}this.SetCurrentPosition(0);return true};CDSEBase.prototype.Close=function(a){if(a==undefined){a=false}this.OpenState=false;this.Root=null};CDSEBase.prototype.CreateGroups=function(){IDREGlb.SetArraySize(this.GroupArray,this.GroupStringArray.Count());for(var a=0;a<this.GroupStringArray.Count();a++){this.GroupArray[a]=this.GetFldIdx(this.GroupStringArray[a])}if(this.flOrderData){this.SortRecords()}this.Root=new CDSEGroup();this.Root.AddGroup(-1,this)};CDSEBase.prototype.GetWEBBlobContent=function(g,o,f,t,b,s){try{if(!b&&g.length<16){return}var h="";if(!b){h=g.substr(0,16)}if(b||h.substr(0,4)=="BLOB"){var j;if(b){j="bin"}else{var d="";for(var n=4;n<16;n++){if(h.charCodeAt(n)==0){break}d+=h.charAt(n)}j=d}var y=this.Parent.Parent.Parent.Parent.Parent.MainFrm.GetMimeType(j);f.set(new IDVariant(y));if(y!=null&&y.indexOf("/")!=-1){y=y.substr(0,y.indexOf("/"))}var u=g.substr(16);if(y!="text"||t){var c=this.Parent.Parent.Parent.Parent.Parent.MainFrm;if(c.ShellObject.IsInsideShell()){var a=new IDVariant();a.Type=IDVariant.BLOB;a.Value=g;var l=Glb.SaveBlob(c,a).stringValue();this.Parent.Parent.AddToTempFiles(l);if(l.length>0){l=Glb.ToRelativeUrl(c,l)}o.set(new IDVariant(l))}else{var k=new Uint8Array(u.length);for(var n=0;n<u.length;n++){k[n]=u.charCodeAt(n)}var m=new BlobBuilder();m.append(k.buffer);var a=m.getBlob(f);var x=URL.createObjectURL(a);o.set(new IDVariant(x))}}else{var r=u;o.set(new IDVariant(r))}}}catch(q){this.Parent.Parent.Parent.Parent.Parent.MainFrm.DTTObj.AddException(this.iGuid,"CDSEBase.GetWebBlobContent","Can't get Web-BLOB content",q)}};CDSEBase.prototype.GetAggrFunct=function(b,e,d,c){var a=this.GetCurrentPosition();if(b==0&&e==-1){c.set(new IDVariant(a));return}if(this.Root!=null){this.Root.GetAggrFunct(a,b,e,d,c)}};CDSEBase.prototype.UpdateIMDB=function(a){return false};CDSEBase.prototype.MoveFirst=function(){};CDSEBase.prototype.MoveLast=function(){};CDSEBase.prototype.MoveNext=function(){};CDSEBase.prototype.MovePrevious=function(){};CDSEBase.prototype.RecordCount=function(){return 0};CDSEBase.prototype.ColumnCount=function(){return 0};CDSEBase.prototype.OrderGroups=function(){this.flOrderData=true};CDSEBase.prototype.SortRecords=function(){return false};CDSEBase.prototype.GetRowId=function(){return this.GetCurrentPosition()+""};CDSEBase.prototype.MasterRS=function(){return null};CDSEBase.prototype.set_MasterRS=function(a){};function CDSEDB(){CDSEBase.call(this);this.SQLstr="";this.OldSQLstr=null;this.RS=new IDCachedRowSet();this.RSDT=new ArrayList();this.Connection=null;this.QueryOK=false;this.QueryParameters=new ArrayList();this.RSParam=new ArrayList();this.SortColumns=null;this.SortAscending=null;this.NumSort=0;this.LookupRows=null;this.CursorPos=0}CDSEDB.prototype=new CDSEBase();for(var i=0;i<Object.keys(CDSEBase).length;i++){var obj=Object.keys(CDSEBase)[i];CDSEDB[obj]=CDSEBase[obj]}CDSEDB.prototype.Open=function(){var a=this.FindData();if(a){CDSEBase.prototype.Open.call(this)}return a};CDSEDB.prototype.Close=function(a){CDSEBase.prototype.Close.call(this,a);if(a){try{this.RS.Close()}catch(b){}}if(this.RS.IsOpen()){this.MoveFirst()}};CDSEDB.prototype.GotoAbsolute=function(a){try{if(a<=0){this.RS.MoveFirst();this.RS.MovePrevious()}else{if(a>this.LookupRows.length){this.RS.MoveLast();this.RS.MoveNext()}else{this.RS.absolute(this.LookupRows[a-1]);this.CursorPos=a}}}catch(b){}};CDSEDB.prototype.IsEof=function(){if(this.LookupRows==null){try{return(this.MaxRows>0&&this.GetCurrentPosition()==this.MaxRows+1)||this.RS.EOF()}catch(a){return true}}else{return(this.MaxRows>0&&this.CursorPos==this.MaxRows+1)||this.CursorPos>this.LookupRows.length}};CDSEDB.prototype.FindData=function(){var j=true;if(this.RS.IsOpen()){return j}var c=null;try{if(!this.QueryOK){this.UpdateParam(false)}c=this.SQLstr;this.SQLstr=this.Parent.Parent.Parent.Parent.MainFrm.HandleTableSubst(this.SQLstr,0);if(this.Connection!=null){if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddQuery(this.iGuid,(this.Parent.ParentBox!=null?"Sub-Report '":"Report '")+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"' loading data from DB","CDSEDB.FindData",DTTEngine.STMT_QRY_SELECT,this.SQLstr);try{var a=1;for(var h=0;h<this.RSParam.Count();h++){var k=this.RSParam[h];this.Parent.Parent.DTTObj.AddParameter("","","Param "+a++,k)}}catch(g){}}if(!this.Connection.IsOpen()){this.Parent.Parent.Parent.Fire_OnConnecting(this.Connection)}this.RS.setMaxRows(this.MaxRows);this.RS.setUpdatable();this.RS.setCommand((this.Connection!=null)?this.Connection.ApplySubstitutions(this.SQLstr):this.SQLstr);this.RS.execute(this.RSParam,this.Connection);var b=this.RS.getMetaData();if(b){var d=b.getColumnCount();for(var f=0;f<d;f++){b.setColumnType(f+1,this.RSDT[f])}}if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddDBDataSource(this.RS,this.RS.getCommand());this.Parent.Parent.DTTObj.EndQuery(this.iGuid)}}if(!this.RS.EOF()){this.MoveFirst()}if(this.Parent.Parent.DTTObj.Level>0&&this.RS.RecordCount()==0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,420,"CDSEDB.FindData","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}catch(g){if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",421,"CDSEDB.FindData","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"' - Error: "+g);this.Parent.Parent.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()))}j=false}finally{if(c!=null&&!this.SQLstr.equals(c)){this.SQLstr=c}}return j};CDSEDB.prototype.GetFldIdx=function(a){try{return this.RS.findColumn(a)}catch(b){return -1}};CDSEDB.prototype.FieldName=function(b){try{return this.RS.GetName(b)}catch(a){return null}};CDSEDB.prototype.GetFldParam=function(g,c,a,d){if(g!=-1){try{var b=this.RS.getMetaData();if(b==null){return}c.set(new IDVariant(IDL.Type2DT(b.getColumnType(g+1))));a.set(new IDVariant(b.getColumnDisplaySize(g+1)));d.set(new IDVariant(b.getScale(g+1)))}catch(f){}}};CDSEDB.prototype.GetFieldValue=function(a,c){if(c==-1){a.set(new IDVariant("???"))}else{try{a.set(this.RS.Get(c))}catch(b){a.set(new IDVariant())}}};CDSEDB.prototype.SetFieldValue=function(c,a){try{this.RS.Set(c,a)}catch(b){}};CDSEDB.prototype.GetWEBBlobContent=function(h,d,g,a,b){d.set(new IDVariant(""));g.set(new IDVariant(""));var c=null;try{c=this.RS.getBlob(h)}catch(f){}if(c==null){try{c=this.RS.getBinaryStream(h)}catch(f){}}if(c==null){return}CDSEBase.prototype.GetWEBBlobContent.call(this,c,d,g,a,b,(this.Connection!=null&&this.Connection.Unicode))};CDSEDB.prototype.UpdateParam=function(e){var g=false;var a=false;if(!this.QueryOK){this.PrepareParam();g=this.QueryParameters.Count()>0}var c=0;for(var h=0;h<this.QueryParameters.Count();h++){var f=this.QueryParameters[h];if(f.RepIdx>-1&&f.FldIdx>-1){var b=this.Parent.Parent.Parent.FindObjByID(f.RepIdx);var d=new IDVariant();b.DSE.GetFieldValue(d,f.FldIdx);a=true;if(d.CompareTo(f.AttValue)!=0&&!(f.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){f.AttValue=d;g=true}}if(f.TblIdx>-1&&f.FldIdx>-1){if(this.Parent.Parent.IMDB.TblModified(f.TblIdx,1)||e){var d=new IDVariant(this.Parent.Parent.IMDB.Value(f.TblIdx,f.FldIdx,0));a=true;if(d.CompareTo(f.AttValue)!=0&&!(f.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){f.AttValue=d;g=true}}}c++}if(g){this.RSParam.Clear();c=0;for(var h=0;h<this.QueryParameters.Count();h++){var f=this.QueryParameters[h];this.RSParam.Add(f.AttValue)}c++}return g&&a};CDSEDB.prototype.PrepareParam=function(){var m=-1;var j;this.QueryParameters.Clear();do{m=this.SQLstr.indexOf("~~",m+1);j=this.SQLstr.indexOf("~~",m+1);if(m>-1&&j>-1){var n=this.SQLstr.substr(m+2,j-(m+2));this.SQLstr=this.SQLstr.substr(0,m)+"?"+this.SQLstr.substr(j+2);var d=new CQueryParam();this.QueryParameters.Add(d);var b=n.lastIndexOf(".");if(b>-1){var a=0;try{a=parseInt(n.substr(0,b),10)}catch(f){}if(a>0&&!isNaN(a)){d.RepIdx=a;var h=this.Parent.Parent.Parent.FindObjByID(d.RepIdx);if(d.RepIdx>-1){d.FldIdx=h.DSE.GetFldIdx(n.substr(b+1))}}else{var l=this.Parent.Parent.Parent.Parent.MainFrm;d.TblIdx=this.Parent.Parent.IMDB.TblByCode(n.substr(0,b),l);if(d.TblIdx>-1){d.FldIdx=this.Parent.Parent.IMDB.FldByCode(d.TblIdx,n.substr(b+1))}}}if(d.FldIdx>-1){if(d.RepIdx>-1){var h=this.Parent.Parent.Parent.FindObjByID(d.RepIdx);h.DSE.GetFieldValue(d.AttValue,d.FldIdx);var g=new IDVariant();var k=new IDVariant();var c=new IDVariant();h.DSE.GetFldParam(d.FldIdx,g,k,c);d.DataType=g.intValue();d.MaxLength=k.intValue();d.Scale=c.intValue()}else{d.AttValue.set(this.Parent.Parent.IMDB.Value(d.TblIdx,d.FldIdx,0));d.DataType=this.Parent.Parent.IMDB.GetFldDataType(d.TblIdx,d.FldIdx);d.MaxLength=this.Parent.Parent.IMDB.GetFldMaxLength(d.TblIdx,d.FldIdx);d.Scale=this.Parent.Parent.IMDB.GetFldScale(d.TblIdx,d.FldIdx)}}}}while(m>-1&&j>-1);this.QueryOK=true};CDSEDB.prototype.UpdateIMDB=function(c){if(this.Parent.Freezed){var b=this.Parent.Parent.MainFrm;if(b.getDTTObj()!=null){b.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,71,"CDSEDB.UpdateIMDB","Report "+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+": update not performed (the report is freezed)")}return false}var a=this.UpdateParam(c);if(a){if(this.RS.IsOpen()){this.Close(true)}}return a};CDSEDB.prototype.MoveFirst=function(){try{if(this.LookupRows==null){this.RS.MoveFirst()}else{this.GotoAbsolute(1)}}catch(a){}};CDSEDB.prototype.MoveLast=function(){try{if(this.LookupRows==null){this.RS.MoveLast()}else{this.GotoAbsolute(this.LookupRows.length)}}catch(a){}};CDSEDB.prototype.MoveNext=function(){try{if(this.LookupRows==null){this.RS.MoveNext()}else{this.GotoAbsolute(++this.CursorPos)}}catch(a){}};CDSEDB.prototype.MovePrevious=function(){try{if(this.LookupRows==null){this.RS.MovePrevious()}else{this.GotoAbsolute(--this.CursorPos)}}catch(a){}};CDSEDB.prototype.RecordCount=function(){return this.RS.RecordCount()};CDSEDB.prototype.ColumnCount=function(){try{return this.RS.GetNumFields()}catch(a){return 0}};CDSEDB.prototype.SortRecords=function(){if(this.GroupStringArray.Count()==0){return true}this.InitSort();for(var a=0;a<this.GroupStringArray.Count();a++){this.SortBy(this.GroupArray[a],true)}this.StartSort();this.MoveFirst();return true};CDSEDB.prototype.InitSort=function(){this.LookupRows=null;this.NumSort=0;this.CursorPos=1};CDSEDB.prototype.SortBy=function(b,a){if(this.SortColumns==null){this.SortColumns=new Array(32);this.SortAscending=new Array(32)}this.SortColumns[this.NumSort]=b;this.SortAscending[this.NumSort]=a;this.NumSort++};CDSEDB.prototype.StartSort=function(){if(this.NumSort==0||this.RS.size()==0){return}var b=new Array(this.RS.size());for(var d=0;d<this.RS.size();d++){b[d]=(d+1)}function c(j,g,a,e,f){function h(n,l){var m=n;var k=l;var o=0;for(var s=0;s<e&&o==0;s++){var r=null;var q=null;try{r=f.GetObjectDirect(m,g[s]);q=f.GetObjectDirect(k,g[s]);if(r==null){o=(q==null)?0:-1}else{if(q==null){o=(r==null)?0:1}else{if(typeof(r)=="string"&&typeof(q)=="string"){o=(String.compare(r,q,true))}else{if(r==q){o=0}else{o=(r>q?1:-1)}}}}if(!a[s]){o=-o}}catch(t){WriteToConsoleError("[SortRS::Compare] Exception while sorting: "+t)}}return o}j.sort(h)}c(b,this.SortColumns,this.SortAscending,this.NumSort,this.RS);this.LookupRows=new Array(this.RS.size());for(var d=0;d<this.RS.size();d++){this.LookupRows[d]=b[d]}};CDSEDB.prototype.MergeWhereClause=function(j,c,b){if(this.OldSQLstr==null){this.OldSQLstr=this.SQLstr}this.SQLstr=this.OldSQLstr;if(j.length>0||c.length>0){var h=this.SQLstr.toUpperCase();var e=-1;var a=0;for(var g=0;g<h.length;g++){var l=h.substr(g,1);if(l.equals("(")){a++}if(l.equals(")")){a--}if(a==0&&(g<=h.length-7)&&h.substr(g,7).equals(" WHERE ")){e=g;break}}var d=h.indexOf(" GROUP BY ");var f=h.indexOf(" ORDER BY ");if(j.length>0){if(e>0){j=" and "+j}else{j=" where "+j}var k=2147483647;if(f>0&&f<k){k=f}if(d>0&&d<k){k=d}if(k!=2147483647){this.SQLstr=this.SQLstr.insert(k,j);if(d>0){d+=j.length}if(f>0){f+=j.length}}else{this.SQLstr+=j}}if(c.length>0){c=" order by "+c;if(f==-1){this.SQLstr+=c}else{if(b){this.SQLstr=this.SQLstr.substr(0,f)+c}}}}if(this.SQLstr.indexOf("~~")!=-1){this.QueryOK=false}};CDSEDB.prototype.GetRowId=function(){try{var a=this.RS.findColumn("HASH");if(a!=-1){return this.RS.Get("HASH").stringValue()}}catch(b){}return CDSEBase.prototype.GetRowId.call(this)};CDSEDB.prototype.MasterRS=function(){return this.RS};CDSEDB.prototype.set_MasterRS=function(a){this.RS=a};function CDSEDO(){CDSEBase.call(this);this.MstTableName="";this.WC=null;this.WCOK=true;this.IDColl=null;this.CursorPos=0;this.Document=null;this.DocTemplate=null;this.Master=true;this.QueryColumns=new ArrayList();this.LastUpdCount=0;this.LastUpdCountCol;this.WCParameters=new ArrayList();this.RSParam=new ArrayList();this.SortArray=new ArrayList();this.flOrderData=true;this.UserColl=false}CDSEDO.prototype=new CDSEBase();for(var i=0;i<Object.keys(CDSEBase).length;i++){var obj=Object.keys(CDSEBase)[i];CDSEDO[obj]=CDSEBase[obj]}function t_ColDef(){this.DBCode;this.PropIdx}CDSEDO.prototype.AddQueryColumn=function(a){var b=new t_ColDef();b.DBCode=a;b.PropIdx=-999;this.QueryColumns.Add(b)};CDSEDO.prototype.AddSortColumn=function(a){this.SortArray.Add(a)};CDSEDO.prototype.GetColumnPropIdx=function(c,e){var b=this.QueryColumns[e-1];if(b.PropIdx!=-999){return b.PropIdx}else{b.PropIdx=c.GetPropIndex(b.DBCode);if(b.PropIdx==-1){var a=c.GetNamedPropertyDefinition(b.DBCode);if(a.DataType!=0){b.PropIdx=0}}return b.PropIdx}};CDSEDO.prototype.Open=function(){if(!this.Master&&this.Parent.ParentBox!=null){var a=this.Parent.ParentBox.PSection.Parent.DSE;if(a instanceof CDSEDO){var l=a.GetDocument();if(l!=null){var f=l.GetMD();for(var g=1;g<=f.GetNumColl();g++){var d=f.GetColl(g);if(d.ChildrenName.equals(this.MstTableName)){this.IDColl=l.GetCollByIndex(g);if(!this.IDColl.Loaded()){try{l.LoadCollectionFromDB(0,g)}catch(j){if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': can't read data - ERROR = "+j.message)}}if(this.Parent.Parent.DTTObj.Level>0&&this.IDColl.Count()==0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}this.IDColl.set_UIBound(true);break}}}}}else{if(this.IDColl!=null&&!this.IDColl.Loaded()){try{if(this.IDColl.Parent()!=null){this.IDColl.Parent().LoadCollectionDirect(this.IDColl,0,true)}else{if(this.WC!=null&&this.WC.length>0&&!this.WCOK){this.UpdateParam(false)}var m=null;if(this.WC!=null&&this.WC.length>0){m=this.WC;if(this.WCParameters.Count()>0){var b=this.DocTemplate.GetDBObj();var n=0;var c=false;for(var g=0;g<m.length;g++){if(m[g]=="'"){c=!c}else{if(!c&&m[g]=="?"){var k=this.RSParam[n++];var h=Glb.ToSql(k,b.DBType,b);m=m.substring(0,g)+h+m.substring(g+1);g+=h.length-1}}}}}this.DocTemplate.LoadCollectionBE(this.IDColl,false,0,m)}}catch(j){if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': can't read data - ERROR = "+j.message)}}if(this.Parent.Parent.DTTObj.Level>0&&this.IDColl.Count()==0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}else{if(this.Document!=null&&!this.Document.Loaded()&&!this.Document.Inserted()){try{this.Document.LoadFromDB(0)}catch(j){if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}}}}if(this.IDColl!=null){this.IDColl.set_UIMode(true)}if(this.IDColl!=null){this.LastUpdCount=this.IDColl.UpdateCount();this.LastUpdCountCol=new Array(this.IDColl.Count());for(var g=0;g<this.LastUpdCountCol.length;g++){this.LastUpdCountCol[g]=-1}}else{if(this.Document!=null){this.LastUpdCount=this.Document.UpdateCount()}}this.MoveFirst();CDSEBase.prototype.Open.call(this);return true};CDSEDO.prototype.Close=function(a){CDSEBase.prototype.Close.call(this,a);if(a){if(this.Master&&this.IDColl!=null&&!this.UserColl){this.IDColl.Clear()}}if(this.IDColl!=null){this.IDColl.set_UIMode(false)}};CDSEDO.prototype.IsEof=function(){return((this.MaxRows>0&&this.CursorPos==this.MaxRows+1)||(this.IDColl!=null&&this.CursorPos>this.IDColl.Count())||(this.Document!=null&&this.CursorPos>1))};CDSEDO.prototype.GetFldIdx=function(b){for(var a=0;a<this.QueryColumns.Count();a++){var c=this.QueryColumns[a];if(c.DBCode.equals(b)){return a+1}}return 0};CDSEDO.prototype.FieldName=function(b){var a=this.QueryColumns[b-1];return a.DBCode};CDSEDO.prototype.GetFldParam=function(f,c,b,d){var a=this.GetColumnPropIdx(this.DocTemplate,f);var e=null;if(a>0){e=this.DocTemplate.GetMD().GetProp(a)}else{if(a==0){e=this.DocTemplate.GetNamedPropertyDefinition(this.QueryColumns[f-1].DBCode)}}if(e!=null){c.set(new IDVariant(e.DataType));b.set(new IDVariant(e.MaxLength));d.set(new IDVariant(e.vScale))}};CDSEDO.prototype.GetFieldValue=function(b,e){var c=this.GetDocument();if(c==null){b.set(new IDVariant());return}var a=this.GetColumnPropIdx(c,e);if(a>0){b.set(c.GetPropByIndex(a))}else{if(a==0){b.set(c.GetNamedPropertyValue(this.QueryColumns[e-1].DBCode))}}};CDSEDO.prototype.SetFieldValue=function(g,b){var f=this.GetDocument();var e=new IDVariant();var c=f.GetLock(9999,"",e);if(c){f.BeginTrans();var a=this.GetColumnPropIdx(f,g);if(a>0){f.SetPropByIndex(a,b)}else{if(a==0){f.SetNamedPropertyValue(this.QueryColumns[g-1].DBCode,b)}}f.EndTrans();f.Validate(1,0,true)}};CDSEDO.prototype.GetWEBBlobContent=function(h,c,k,a,j){c.set(new IDVariant(""));k.set(new IDVariant(""));var g=this.GetDocument();var f=this.GetColumnPropIdx(g,h);var b=null;if(f>0){b=g.GetPropByIndex(f)}else{if(f==0){b=g.GetNamedPropertyValue(this.QueryColumns[h-1].DBCode)}}if(b==null||b.Type!=IDVariant.BLOB){return}var e=b.Value;CDSEBase.prototype.GetWEBBlobContent.call(this,e,c,k,a,j,true)};CDSEDO.prototype.UpdateParam=function(e){var g=false;var a=false;if(!this.WCOK){this.PrepareParam();g=this.WCParameters.Count()>0}var c=0;for(var h=0;h<this.WCParameters.Count();h++){var f=this.WCParameters[h];if(f.RepIdx>-1&&f.FldIdx>-1){var b=this.Parent.Parent.Parent.FindObjByID(f.RepIdx);var d=new IDVariant();b.DSE.GetFieldValue(d,f.FldIdx);a=true;if(d.CompareTo(f.AttValue)!=0&&!(f.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){f.AttValue=d;g=true}}if(f.TblIdx>-1&&f.FldIdx>-1){if(this.Parent.Parent.IMDB.TblModified(f.TblIdx,1)||e){var d=new IDVariant(this.Parent.Parent.IMDB.Value(f.TblIdx,f.FldIdx,0));a=true;if(d.CompareTo(f.AttValue)!=0&&!(f.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){f.AttValue=d;g=true}}}c++}if(g){this.RSParam.Clear();c=0;for(var h=0;h<this.WCParameters.Count();h++){var f=this.WCParameters[h];this.RSParam.Add(f.AttValue)}c++}return g&&a};CDSEDO.prototype.PrepareParam=function(){var m=-1;var j;this.WCParameters.Clear();do{m=this.WC.indexOf("~~",m+1);j=this.WC.indexOf("~~",m+1);if(m>-1&&j>-1){var n=this.WC.substr(m+2,j-(m+2));this.WC=this.WC.substr(0,m)+"?"+this.WC.substr(j+2);var d=new CQueryParam();this.WCParameters.Add(d);var b=n.lastIndexOf(".");if(b>-1){var a=0;try{a=parseInt(n.substr(0,b),10)}catch(f){}if(a>0&&!isNaN(a)){d.RepIdx=a;var h=this.Parent.Parent.Parent.FindObjByID(d.RepIdx);if(d.RepIdx>-1){d.FldIdx=h.DSE.GetFldIdx(n.substr(b+1))}}else{var l=this.Parent.Parent.Parent.Parent.MainFrm;d.TblIdx=this.Parent.Parent.IMDB.TblByCode(n.substr(0,b),l);if(d.TblIdx>-1){d.FldIdx=this.Parent.Parent.IMDB.FldByCode(d.TblIdx,n.substr(b+1))}}}if(d.FldIdx>-1){if(d.RepIdx>-1){var h=this.Parent.Parent.Parent.FindObjByID(d.RepIdx);h.DSE.GetFieldValue(d.AttValue,d.FldIdx);var g=new IDVariant();var k=new IDVariant();var c=new IDVariant();h.DSE.GetFldParam(d.FldIdx,g,k,c);d.DataType=g.intValue();d.MaxLength=k.intValue();d.Scale=c.intValue()}else{d.AttValue.set(this.Parent.Parent.IMDB.Value(d.TblIdx,d.FldIdx,0));d.DataType=this.Parent.Parent.IMDB.GetFldDataType(d.TblIdx,d.FldIdx);d.MaxLength=this.Parent.Parent.IMDB.GetFldMaxLength(d.TblIdx,d.FldIdx);d.Scale=this.Parent.Parent.IMDB.GetFldScale(d.TblIdx,d.FldIdx)}}}}while(m>-1&&j>-1);this.WCOK=true};CDSEDO.prototype.UpdateIMDB=function(e){if(this.Parent.Freezed){var b=this.Parent.Parent.MainFrm;if(b.getDTTObj()!=null){b.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,71,"CDSEDO.UpdateIMDB","Report "+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+": update not performed (the report is freezed)")}return false}var a=this.UpdateParam(e);if(a){this.Close(true)}if(!a&&this.IDColl!=null){if(this.LastUpdCount!=this.IDColl.UpdateCount()){a=true}else{for(var c=0;c<this.IDColl.Count();c++){var f=this.IDColl.GetDirect(c+1);if(f!=null&&f.UpdateCount()!=this.LastUpdCountCol[c]){a=true;break}}}}else{if(!a&&this.Document!=null&&this.LastUpdCount!=this.Document.UpdateCount()){a=true}}if(a&&this.IsOpen()){this.Close()}return a};CDSEDO.prototype.MoveFirst=function(){this.CursorPos=1};CDSEDO.prototype.MoveLast=function(){this.CursorPos=(this.IDColl!=null?this.IDColl.Count():1)};CDSEDO.prototype.MoveNext=function(){if(this.IDColl!=null){if(this.CursorPos<=this.IDColl.Count()){this.CursorPos++}}else{this.CursorPos++}};CDSEDO.prototype.MovePrevious=function(){if(this.IDColl!=null){if(this.CursorPos>=1){this.CursorPos--}}};CDSEDO.prototype.RecordCount=function(){if(this.IDColl!=null){return this.IDColl.Count()}else{return 1}};CDSEDO.prototype.ColumnCount=function(){return this.QueryColumns.Count()};CDSEDO.prototype.GetFieldName=function(b){var a=this.QueryColumns[b];return a.DBCode};CDSEDO.prototype.SortRecords=function(){if(this.IDColl==null){return false}this.IDColl.ClearSort();for(var b=0;b<this.GroupArray.Count();b++){var a=this.GetColumnPropIdx(this.DocTemplate,this.GroupArray[b]);this.IDColl.SortBy(a)}for(var b=0;b<this.SortArray.Count();b++){this.IDColl.SortBy(this.SortArray[b])}this.IDColl.EnableSort();this.MoveFirst();if(this.IDColl.UIMode()&&(this.GroupArray.Count()>0||this.SortArray.Count()>0)){this.IDColl.set_UIMode(true)}return true};CDSEDO.prototype.SetQueryCollection=function(a){this.IDColl=a;this.IDColl.set_UIBound(true);this.IDColl.set_ShowDeleted(false);this.Document=null;this.Master=true;this.LastUpdCount=-1;this.LastUpdCountCol=null;this.UserColl=true;if(this.IsOpen()){this.Close()}};CDSEDO.prototype.SetQueryDocument=function(a){this.Document=a;if(this.Document!=null){this.Document.set_UIBound(true)}this.IDColl=null;this.LastUpdCount=-1;this.LastUpdCountCol=null;if(this.IsOpen()){this.Close()}};CDSEDO.prototype.GetDocument=function(){if(this.IDColl!=null){var b=this.IDColl.GetDirect(this.CursorPos);if(b==null&&this.Parent.Parent.PE!=null){var a=false;if(this.Parent.Parent.PE instanceof CPEPDF){a=true}else{if(this.Parent.Parent.FormattingPage!=null&&this.Parent.Parent.FormattingPage.PageNum>=this.Parent.Parent.PrintingFromPage-1&&this.Parent.Parent.FormattingPage.PageNum<=this.Parent.Parent.PrintingToPage){a=true}else{if(this.Parent.Parent.FormattingPage!=null&&((this.Parent.Parent.FormattingPage.PageNum-1)%10==0||(this.Parent.Parent.FormattingPage.PageNum-1)%10==9)){a=true}}}if(a){this.IDColl.GetMissingDoc(this.CursorPos);b=this.IDColl.GetDirect(this.CursorPos);if(b!=null){this.LastUpdCount=this.IDColl.UpdateCount()}}}if(b!=null&&this.LastUpdCountCol[this.CursorPos-1]==-1){this.LastUpdCountCol[this.CursorPos-1]=b.UpdateCount()}return b}else{return this.Document}};CDSEDO.prototype.SetDocumentClass=function(b){this.MstTableName=b;try{var a=this.Parent.Parent.MainFrm;var f=new IDCollection();a.CreateDocument(f,this.MstTableName);f.MoveFirst();var d=f.GetAt();if(d==null){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,100,"CDSEDO.SetDocumentClass","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': can't create a "+this.MstTableName+" class")}else{d.Clear();d.SetMainFrm(a,a.IMDB)}this.DocTemplate=d;this.IDColl=new IDCollection();this.IDColl.set_MainFrm(a);this.IDColl.set_imdb(a.IMDB);this.IDColl.set_UIBound(true);this.IDColl.set_ShowDeleted(false)}catch(c){this.Parent.Parent.DTTObj.AddException(this.iGuid,"CDSEDO.SetDocumentClass","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': exception while setting document class",c)}};function CDSEGroup(){this.StartGroupIdx=0;this.EndGroupIdx=0;this.Level=0;this.FieldIdx=-1;this.ValuesArray=new ArrayList();this.GroupList=new ArrayList();this.AggrMap=new HashTableSrv()}CDSEGroup.prototype.AddGroup=function(f,b){this.StartGroupIdx=b.GetCurrentPosition();this.Level=f;if(f>=0){this.FieldIdx=b.GroupArray[f];IDREGlb.SetArraySize(this.ValuesArray,f+1);for(var e=0;e<this.ValuesArray.Count();e++){if(this.ValuesArray[e]==null){this.ValuesArray[e]=new IDVariant()}b.GetFieldValue(this.ValuesArray[e],b.GroupArray[e])}}while(!b.IsEof()){if(f!=-1){var d=false;for(var e=0;e<this.ValuesArray.Count()&&!d;e++){var j=new IDVariant();b.GetFieldValue(j,b.GroupArray[e]);if(j.CompareTo(this.ValuesArray[e])!=0){d=true}}if(d){break}}if(f<b.GroupArray.Count()-1){var h=new CDSEGroup();this.GroupList.Add(h);h.AddGroup(f+1,b);for(var e=0;e<b.GetNumColumns();e++){var c=this.AggrMap[b.GetFieldName(e).toUpperCase()];if(c==null){c=new CDSEAggr();this.AggrMap[b.GetFieldName(e).toUpperCase()]=c}c.Update(h.AggrMap[b.GetFieldName(e).toUpperCase()])}}else{for(var e=0;e<b.GetNumColumns();e++){var c=this.AggrMap[b.GetFieldName(e).toUpperCase()];if(c==null){c=new CDSEAggr();this.AggrMap[b.GetFieldName(e).toUpperCase()]=c}var j=new IDVariant();b.GetFieldValue(j,e+1);c.Update(j)}b.Next()}}if(!b.IsEof()){this.EndGroupIdx=b.GetCurrentPosition()-1}else{this.EndGroupIdx=b.GetNumRecords()}};CDSEGroup.prototype.IsMyGroupTime=function(b,a,e){if(this.Level==e){if(a){return b==this.StartGroupIdx}else{return b==this.EndGroupIdx}}for(var d=0;d<this.GroupList.Count();d++){var c=this.GroupList[d];if(b>=c.StartGroupIdx&&b<=c.EndGroupIdx){return c.IsMyGroupTime(b,a,e)}}return false};CDSEGroup.prototype.GetGroup=function(a,d){if(this.Level==d){return this}for(var c=0;c<this.GroupList.Count();c++){var b=this.GroupList[c];if(a>=b.StartGroupIdx&&a<=b.EndGroupIdx){return b.GetGroup(a,d)}}return null};CDSEGroup.prototype.GetAggrFunct=function(d,c,k,j,f){if(this.Level==k){var b=this.AggrMap[j.toUpperCase()];if(c==0){f.set(new IDVariant(this.StartGroupIdx));return}if(b!=null){b.GetAggrFunct(c,f)}return}for(var h=0;h<this.GroupList.Count();h++){var e=this.GroupList[h];if(d>=e.StartGroupIdx&&d<=e.EndGroupIdx){e.GetAggrFunct(d,c,k,j,f);return}}};function CDSEIMDB(){CDSEBase.call(this);this.IMDBTable=-1;this.IsBOF=false;this.IsFirstRow=false}CDSEIMDB.prototype=new CDSEBase();for(var i=0;i<Object.keys(CDSEBase).length;i++){var obj=Object.keys(CDSEBase)[i];CDSEIMDB[obj]=CDSEBase[obj]}CDSEIMDB.prototype.Open=function(){var a=this.Parent.Parent.Parent.GetNewID2OldID(this.Parent.ReportID);this.Parent.Parent.Parent.Fire_OnIMDBUpdate(a);this.MoveFirst();CDSEBase.prototype.Open.call(this);if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddQuery(this.iGuid,(this.Parent.ParentBox!=null?"Sub-Report '":"Report '")+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"' loading data from IMDB","CDSEIMDB.FindData",DTTEngine.STMT_QRY_SELECT,"");this.Parent.Parent.DTTObj.AddIMDBDataSource(this.IMDBTable,this.Parent.Parent.Parent.Parent.Parent.IMDB);this.Parent.Parent.DTTObj.EndQuery(this.iGuid);if(this.Parent.Parent.IMDB.TblNumRows(this.IMDBTable)==0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,422,"CDSEIMDB.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}return true};CDSEIMDB.prototype.Close=function(a){CDSEBase.prototype.Close.call(this,a);this.MoveFirst()};CDSEIMDB.prototype.IsEof=function(){return((this.MaxRows>0&&this.GetCurrentPosition()==this.MaxRows+1)||this.Parent.Parent.IMDB.Eof(this.IMDBTable,IDREGlb.IMDB_CURSOR))};CDSEIMDB.prototype.GetFldIdx=function(a){return this.Parent.Parent.IMDB.FldByCode(this.IMDBTable,a)+1};CDSEIMDB.prototype.FieldName=function(a){return this.Parent.Parent.IMDB.FldCode(this.IMDBTable,a-1)};CDSEIMDB.prototype.GetFldParam=function(d,b,a,c){b.set(new IDVariant(this.Parent.Parent.IMDB.GetFldDataType(this.IMDBTable,d-1)));a.set(new IDVariant(this.Parent.Parent.IMDB.GetFldMaxLength(this.IMDBTable,d-1)));c.set(new IDVariant(this.Parent.Parent.IMDB.GetFldScale(this.IMDBTable,d-1)))};CDSEIMDB.prototype.GetFieldValue=function(a,b){a.set(this.Parent.Parent.IMDB.Value(this.IMDBTable,b-1,IDREGlb.IMDB_CURSOR))};CDSEIMDB.prototype.SetFieldValue=function(b,a){this.Parent.Parent.IMDB.set_Value(this.IMDBTable,b-1,IDREGlb.IMDB_CURSOR,a)};CDSEIMDB.prototype.GetWEBBlobContent=function(g,e,f,b,c){e.set(new IDVariant(""));f.set(new IDVariant(""));var a=this.Parent.Parent.IMDB.Value(this.IMDBTable,g-1,IDREGlb.IMDB_CURSOR);if(a.Type!=IDVariant.BLOB){return}var d=a.Value;CDSEBase.prototype.GetWEBBlobContent.call(this,d,e,f,b,c,true)};CDSEIMDB.prototype.UpdateIMDB=function(c){if(this.Parent.Freezed){var b=this.Parent.Parent.MainFrm;if(b.getDTTObj()!=null){b.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,71,"CDSEIMDB.UpdateIMDB","Report "+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+": update not performed (the report is freezed)")}return false}var a=this.Parent.Parent.IMDB.TblModified(this.IMDBTable,1)||c;if(a){if(this.IsOpen()){this.Close()}}return a};CDSEIMDB.prototype.MoveFirst=function(){this.Parent.Parent.IMDB.TblMoveFirst(this.IMDBTable,IDREGlb.IMDB_CURSOR);this.IsFirstRow=true;this.IsBOF=false};CDSEIMDB.prototype.MoveLast=function(){this.Parent.Parent.IMDB.TblMoveLast(this.IMDBTable,IDREGlb.IMDB_CURSOR);this.IsFirstRow=false;this.IsBOF=false};CDSEIMDB.prototype.MoveNext=function(){this.Parent.Parent.IMDB.TblMoveNext(this.IMDBTable,IDREGlb.IMDB_CURSOR);this.IsFirstRow=false;this.IsBOF=false};CDSEIMDB.prototype.MovePrevious=function(){if(!this.IsBOF&&this.IsFirstRow){this.IsFirstRow=false;this.IsBOF=true}else{this.Parent.Parent.IMDB.TblMovePrev(this.IMDBTable,IDREGlb.IMDB_CURSOR);this.IsFirstRow=false;this.IsBOF=false}};CDSEIMDB.prototype.RecordCount=function(){return this.Parent.Parent.IMDB.TblNumRows(this.IMDBTable)};CDSEIMDB.prototype.ColumnCount=function(){return this.Parent.Parent.IMDB.TblNumField(this.IMDBTable)};CDSEIMDB.prototype.GetFieldName=function(a){return this.Parent.Parent.IMDB.FldCode(this.IMDBTable,a)};CDSEIMDB.prototype.SortRecords=function(){this.Parent.Parent.IMDB.TblInitSort(this.IMDBTable);for(var a=0;a<this.GroupArray.Count();a++){this.Parent.Parent.IMDB.TblSortBy(this.IMDBTable,this.GroupArray[a]-1,true)}this.Parent.Parent.IMDB.TblStartSort(this.IMDBTable);this.MoveFirst();return true};CDSEIMDB.prototype.GetRowId=function(){var a=this.Parent.Parent.IMDB.FldByCode(this.IMDBTable,"HASH");if(a!=-1){return this.Parent.Parent.IMDB.Value(this.IMDBTable,a,IDREGlb.IMDB_CURSOR).stringValue()}return CDSEBase.prototype.GetRowId.call(this)};function CFloatRect(b,e,a,c){this.x=0;this.y=0;this.width=0;this.height=0;if(b instanceof CFloatRect){var d=b;this.x=d.x;this.y=d.y;this.width=d.width;this.height=d.height}else{this.x=b;this.y=e;this.width=Math.abs(a-b);this.height=Math.abs(c-e)}}CFloatRect.prototype.left=function(){return this.x};CFloatRect.prototype.top=function(){return this.y};CFloatRect.prototype.right=function(){return this.x+this.width};CFloatRect.prototype.bottom=function(){return this.y+this.height};CFloatRect.prototype.setLeft=function(a){this.x=a};CFloatRect.prototype.setTop=function(a){this.y=a};CFloatRect.prototype.setRight=function(a){this.width=a-this.x};CFloatRect.prototype.setBottom=function(a){this.height=a-this.y};CFloatRect.prototype.setWidth=function(a){this.width=a};CFloatRect.prototype.setHeight=function(a){this.height=a};CFloatRect.prototype.IsRectNull=function(){return(this.x==0&&this.y==0&&this.width==0&&this.height==0)};CFloatRect.prototype.Deflate=function(d,c,a,e){if(d==undefined){d=c}if(e==undefined){e=c}if(a==undefined){a=d}this.x+=c;this.y+=d;this.width-=(c+e);this.height-=(a+d)};CFloatRect.prototype.Inflate=function(d,c,a,e){if(d==undefined){d=c}if(e==undefined){e=c}if(a==undefined){a=d}this.x-=c;this.y-=d;this.width+=c+e;this.height+=a+d};CFloatRect.prototype.Intersect=function(b,a){this.x=Math.max(b.left(),a.left());this.y=Math.max(b.top(),a.top());this.setRight(Math.floor(Math.min(b.left()+b.width,a.left()+a.width)));this.setBottom(Math.floor(Math.min(b.top()+b.height,a.top()+a.height)))};CFloatRect.prototype.toString=function(){return"X="+this.x+", Y="+this.y+", W="+this.width+", H="+this.height};function CIDREObj(a){this.Parent=a;this.Book=new CBook();this.ObjMap=new ArrayList();this.GUIDMap=new ArrayList();this.NameMap=new ArrayList();this.Code2IndexMap={};this.Index2CodeMap=new ArrayList();this.OldGUIDMap=null;this.OldID2NewIDArray=new ArrayList();this.NewID2OldIDArray=new ArrayList();this.CurrencyMsk="";this.FloatMsk="";this.DateMsk="";this.TimeMsk="";this.ForceSnap=true;this.OptimizeDOM=false;this.ScrollDir=0;this.Book.Parent=this;if(a!=null&&a.Parent!=null){this.Book.MainFrm=a.Parent.MainFrm}}CIDREObj.prototype.FindObjByID=function(a){if(a>this.ObjMap.Count()-1){return null}return this.ObjMap[a]};CIDREObj.prototype.GetOldID2NewID=function(a){if(this.OldGUIDMap!=null&&this.OldID2NewIDArray.Count()>0){if(a>this.OldID2NewIDArray.Count()-1){return 0}return this.OldID2NewIDArray[a]}else{return a}};CIDREObj.prototype.GetNewID2OldID=function(a){if(this.OldGUIDMap!=null&&this.NewID2OldIDArray.Count()>0){if(a>this.NewID2OldIDArray.Count()-1){return 0}return this.NewID2OldIDArray[a]}else{return a}};CIDREObj.prototype.ResetBook=function(){this.ObjMap.Clear();if(this.OldGUIDMap==null){this.OldGUIDMap=new ArrayList(this.GUIDMap)}this.GUIDMap.Clear();this.NameMap.Clear();this.Code2IndexMap={};this.Index2CodeMap.Clear();this.OldID2NewIDArray=new ArrayList();this.NewID2OldIDArray=new ArrayList();this.Book.PagesList=new ArrayList();this.Book.PE.PrintingPage=null;this.Book.MastroList=new ArrayList();this.Book.ReportsList=new ArrayList();this.Book.ImagesPath=new ArrayList()};CIDREObj.prototype.CalcBookNewIDs=function(){this.OldID2NewIDArray.Clear();for(var d=this.OldID2NewIDArray.Count();d<this.OldGUIDMap.Count();d++){this.OldID2NewIDArray.Add(0)}this.NewID2OldIDArray.Clear();for(var d=this.NewID2OldIDArray.Count();d<this.GUIDMap.Count();d++){this.NewID2OldIDArray.Add(0)}for(var c=0;c<this.OldGUIDMap.Count();c++){var a=this.OldGUIDMap[c];var e=0;for(var b=0;b<this.GUIDMap.Count()&&e==0;b++){if(this.GUIDMap[b].equals(a)){e=b}}this.OldID2NewIDArray[c]=e;this.NewID2OldIDArray[e]=c}};CIDREObj.prototype.InitBook=function(b,e,d,a,c){this.Book.UM=b;this.Book.Flags=e;this.Book.Name=d;this.Book.IMDB=a;this.Book.VisualStyleList.set_VisualStyleList(c);this.Book.VisualStyleList.Parent=this.Book};CIDREObj.prototype.InitHTML=function(){this.Book.PE=new CPEHTML();this.Book.PE.Parent=this.Book};CIDREObj.prototype.FrIndex=function(){return this.Book.FrIndex};CIDREObj.prototype.set_FrIndex=function(a){this.Book.FrIndex=a};CIDREObj.prototype.ProcessRequest=function(a,b){this.Book.ProcessRequest(a,b)};CIDREObj.prototype.PrintBook=function(h,f){try{var b=false;if(this.Book.PrintDestination<=IDREGlb.PRN_SCREEN&&this.Parent.MainFrm.ParamsObj().UseRD3&&this.Parent.RD3PageCache.containsKey(f)){b=true}var a=new HashTableSrv();var g=Object.keys(this.Parent.RD3PageCache);for(var e=0;e<g.length;e++){var d=g[e];a[d]=this.Parent.RD3PageCache[d]}this.Book.PrintPages(h,f);if(b){this.Parent.RD3PageCache=a;if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),570,"CIDREObj.PrintBook","Book "+this.GetObjName(0)+": the page "+f+" is already available on client side -> skipping send")}}}catch(c){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.GetRTCGuid(0),423,"CIDREObj.PrintBook","Book "+this.GetObjName(0)+": Error while printing book (Msg = "+c.message+")")}throw c}};CIDREObj.prototype.OpenMultiPDF=function(a){};CIDREObj.prototype.CloseMultiPDF=function(){};CIDREObj.prototype.SetScrollMode=function(a,b,c){if(a!=this.ScrollDir){this.ScrollDir=a;this.Parent.RD3Change(RD3Glb.BOK_SCROLLDIR)}if(b!=this.ForceSnap){this.ForceSnap=b;this.Parent.RD3Change(RD3Glb.BOK_FORCESNAP)}if(c!=this.OptimizeDOM){this.OptimizeDOM=c;this.Parent.RD3Change(RD3Glb.BOK_OPTIMIZEDOM)}};CIDREObj.prototype.SetSize=function(c,a){var b={Width:c-10,Height:a-10};this.Book.ConvertFromPixelToPhysical(b,this.Book.UM);if(this.Book.PE.Width!=b.Width||this.Book.PE.Height!=b.Height){this.Book.PE.Width=b.Width;this.Book.PE.Height=b.Height;for(var d=0;d<this.Book.PagesList.Count();d++){var e=this.Book.PagesList[d];if(e!=null&&e.FitMode!=IDREGlb.MASTRO_FM_NONE){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),424,"CIDREObj.SetSize","Book "+this.GetObjName(0)+": content size changed and page '"+this.GetObjName(e.ParentMastro.MastroID)+"' has FitMode != NONE -> Refreshing book's content using new dimensions")}this.RefreshBook(1,-1);break}}}};CIDREObj.prototype.IsPrinting=function(){return this.Book.IsPrinting};CIDREObj.prototype.set_IsPrinting=function(a){this.Book.IsPrinting=a};CIDREObj.prototype.PrinterName=function(){return this.Book.PrinterName};CIDREObj.prototype.set_PrinterName=function(a){this.Book.PrinterName=a};CIDREObj.prototype.OutputFileName=function(){return this.Book.OutputFileName};CIDREObj.prototype.set_OutputFileName=function(a){this.Book.OutputFileName=a;this.Book.AutoOutFileName=false};CIDREObj.prototype.GetWebFileName=function(){return this.Book.WebFileName.replace(/\\/g,"/")};CIDREObj.prototype.Bookmark=function(){return this.Book.Bookmark};CIDREObj.prototype.set_Bookmark=function(a){this.Book.Bookmark=a};CIDREObj.prototype.CacheSize=function(){return this.Book.CacheSize()};CIDREObj.prototype.set_CacheSize=function(a){if(this.Book.CacheSize()!=a){this.Book.set_CacheSize(a);this.Parent.RD3Change(RD3Glb.BOK_CACHESIZE)}};CIDREObj.prototype.GridSize=function(){return this.Book.ConvertFromInternalValue(this.Book.GridSize)};CIDREObj.prototype.set_GridSize=function(c){var a=(c<0?-1:this.Book.ConvertToInternalValue(c));if(this.Book.GridSize!=a){this.Book.GridSize=a;var b=-1;if(this.Book.PE.PrintingPage!=null){b=this.Book.PE.PrintingPage.PageNum}this.Book.RefreshPages(1);if(b!=-1){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),569,"CIDREObj.set_GridSize","Book "+this.GetObjName(0)+": The book was showing page "+b+" in preview -> Reformatting up to that page")}this.Book.PrintPages(b,b)}}};CIDREObj.prototype.FixedWidth=function(){return this.Book.ConvertFromInternalValue(this.Book.FixedWidth)};CIDREObj.prototype.set_FixedWidth=function(a){this.Book.FixedWidth=this.Book.ConvertToInternalValue(a);this.Parent.RD3Change(RD3Glb.BOK_FIXEDWIDTH)};CIDREObj.prototype.FixedHeight=function(){return this.Book.ConvertFromInternalValue(this.Book.FixedHeight)};CIDREObj.prototype.set_FixedHeight=function(a){this.Book.FixedHeight=this.Book.ConvertToInternalValue(a);this.Parent.RD3Change(RD3Glb.BOK_FIXEDHEIGHT)};CIDREObj.prototype.RefreshBook=function(c,b){var a=-1;if(this.Book.PE!=null&&this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}this.Book.RefreshPages(c,b);if(a!=-1){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),425,"CIDREObj.RefreshBook","Book "+this.GetObjName(0)+": Book refresh done. The book was showing page "+a+" in preview -> Reformatting up to that page")}this.Book.PrintPages(1,a);if(this.GetPageNumber()!=a){this.Parent.RD3DeletePage=a}if(this.GetPageNumber()==0){this.set_RD(true);this.Parent.RD3Change(RD3Glb.BOK_PAGECONFIRMED);this.Parent.RD3Change(RD3Glb.BOK_PAGENUM);this.Parent.RD3Change(RD3Glb.BOK_PAGETOTAL)}}};CIDREObj.prototype.RefreshQuery=function(){for(var b=0;b<this.Book.ReportsList.Count();b++){var c=this.Book.ReportsList[b];if(c.ParentBox==null){this.ReportRefreshQuery(c.ReportID,false)}}var a=-1;if(this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}this.Book.RefreshPages(1);if(a!=-1){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),569,"CIDREObj.RefreshQuery","Book "+this.GetObjName(0)+": The book was showing page "+a+" in preview -> Reformatting up to that page")}this.Book.PrintPages(a,a)}};CIDREObj.prototype.UpdateBook=function(a){if(a==undefined){a=false}if(!this.Parent.Visible||this.Parent.Collapsed||!this.Parent.Exposed()){this.Parent.WasHidden=true;this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),72,"CIDREObj.UpdateBook","Book "+this.GetObjName(0)+": update not performed (the book is either invisible, collapsed or not exposed)");return}this.Book.Update(a)};CIDREObj.prototype.GetName=function(){return this.Book.Name};CIDREObj.prototype.HideBorder=function(){return(this.Book.Flags&IDREGlb.FL_BOOK_HIDEBORD)!=0};CIDREObj.prototype.set_HideBorder=function(a){var b=this.Book.Flags;if(a){b|=IDREGlb.FL_BOOK_HIDEBORD}else{b&=~IDREGlb.FL_BOOK_HIDEBORD}if(this.Book.Flags!=b){this.Book.Flags=b;this.set_RD(true);this.Parent.RD3Change(RD3Glb.BOK_HIDEBORDER)}};CIDREObj.prototype.SetCommandEnabled=function(c,a){var b=this.Book.EnabledCommands;this.Book.EnabledCommands=(this.Book.EnabledCommands&(~c))|((a)?c:0);if(b!=this.Book.EnabledCommands){this.Parent.RD3Change(RD3Glb.BOK_ENABLEDCOMMANDS)}};CIDREObj.prototype.IsCommandEnabled=function(a){return(this.Book.EnabledCommands&a)!=0};CIDREObj.prototype.SetZoom=function(a){this.Book.PE.SetZoomLevel(a)};CIDREObj.prototype.GetZoom=function(){return this.Book.PE.ZoomLevel};CIDREObj.prototype.PrintDestination=function(){return this.Book.PrintDestination};CIDREObj.prototype.set_PrintDestination=function(a){if(a==IDREGlb.PRN_ABCPDF){a=IDREGlb.PRN_PDF}if(this.Book.PrintDestination!=a){this.Book.RefreshPages(1)}this.Book.PrintDestination=a};CIDREObj.prototype.GetTotalPagesNumber=function(){return this.Book.TotalPagesNumber};CIDREObj.prototype.GetTotalPagesNumberConf=function(){return this.Book.TotalPagesNumberConf};CIDREObj.prototype.InitMastro=function(g,c,a,h,d,f,e){var b=new CMastro();b.MastroID=g;b.PageType=c;b.Width=a;b.Height=h;b.UM=d;b.Orientation=f;b.FitMode=e;b.Parent=this.Book;this.Book.MastroList.Add(b);IDREGlb.SetArraySize(this.ObjMap,g+1);this.ObjMap[g]=b};CIDREObj.prototype.InitMastroBox=function(a,q,e,d,s,l,g,r,b,o,m,x,c,u,f,h,n,v,k){if(h==undefined){h=-1}if(n==undefined){n=-1}if(v==undefined){v=""}if(k==undefined){k=IDREGlb.VISALN_AUTO}var t=this.FindObjByID(a);var j=new CRptBox();j.BoxID=q;j.XPos=e;j.YPos=d;j.Width=s;j.Height=l;j.Interline=g;j.HRsz=r;j.VRsz=b;j.VisAttrIdx=o;j.FontHeight=x;j.InitFlags(m);j.ToolTip=c;j.Stretch=u;j.VisProp=f;j.SetBackColor(h);j.SetForeColor(n);j.SetFontMod(v);j.Alignment=k;j.PMastro=t;j.PSection=null;t.BoxList.Add(j);IDREGlb.SetArraySize(this.ObjMap,q+1);this.ObjMap[q]=j};CIDREObj.prototype.InitBoxSpan=function(q,a,r,h,j,b,o,k,d,g,l,c,n,e){if(l==undefined){l=-1}if(c==undefined){c=-1}if(n==undefined){n=""}if(e==undefined){e=""}var f=this.FindObjByID(q);var m=new CRptSpan();m.SpanID=a;m.Text=d;m.VisAttrIdx=r;m.DataType=h;m.MaxLen=j;m.Scale=b;m.InitFlags(o);m.ToolTip=k;m.Stretch=g;if(l!=-1){m.BackColor=l}else{if(f.GetBackColor()!=-1){m.BackColor=f.GetBackColor()}}if(c!=-1){m.ForeColor=c}else{if(f.GetForeColor()!=-1){m.ForeColor=f.GetForeColor()}}if(!n.equals("")){m.FontMod=n}else{if(f.GetFontMod().length>0){m.FontMod=f.GetFontMod()}}if(!e.equals("")){m.Mask=e}m.Parent=f;f.SpanList.Add(m);IDREGlb.SetArraySize(this.ObjMap,a+1);this.ObjMap[a]=m};CIDREObj.prototype.InitReport=function(c,b){var a=new CReport();a.ReportID=c;a.InitFlags(b);a.Parent=this.Book;a.ParentBox=null;this.Book.ReportsList.Add(a);IDREGlb.SetArraySize(this.ObjMap,c+1);this.ObjMap[c]=a};CIDREObj.prototype.SetReportQuery=function(c,g,e,d,b){var a=this.FindObjByID(c);var f;if(e==-1){f=new CDSEDB();f.Connection=g;f.SQLstr=d}else{f=new CDSEIMDB();f.IMDBTable=e}a.DSE=f;f.Parent=a;f.iGuid=b};CIDREObj.prototype.SetReportQueryColumnDT=function(b,d,c){var a=this.FindObjByID(b);a.DSE.RSDT[d]=c};CIDREObj.prototype.SetReportQueryDO=function(d,e,c,b){var f=new CDSEDO();var a=this.FindObjByID(d);a.DSE=f;f.Parent=a;f.iGuid=b;f.SetDocumentClass(e);f.Master=c};CIDREObj.prototype.AddReportQueryColumnDO=function(c,b){var a=this.FindObjByID(c);a.DSE.AddQueryColumn(b)};CIDREObj.prototype.AddReportOrderByColumnDO=function(c,a){var b=this.FindObjByID(c);b.DSE.AddSortColumn(a)};CIDREObj.prototype.SetReportWhereClauseDO=function(b,c){var a=this.FindObjByID(b);a.DSE.WC=c;a.DSE.WCOK=false};CIDREObj.prototype.set_ReportDocument=function(b,c){var a=this.FindObjByID(b);if(!(a.DSE instanceof CDSEDO)){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(0),572,"CIDREObj.set_ReportDocument","Report "+this.GetObjName(b)+": report is not DocumentOriented")}return}a.DSE.SetQueryDocument(c);this.ReportRefreshQuery(b,(a.ParentBox==null))};CIDREObj.prototype.ReportDocument=function(b){var a=this.FindObjByID(b);if(!(a.DSE instanceof CDSEDO)){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(0),572,"CIDREObj.ReportDocument","Report "+this.GetObjName(b)+": report is not DocumentOriented")}return null}return a.DSE.GetDocument()};CIDREObj.prototype.set_ReportCollection=function(c,b){var a=this.FindObjByID(c);if(!(a.DSE instanceof CDSEDO)){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(0),572,"CIDREObj.set_ReportCollection","Report "+this.GetObjName(c)+": report is not DocumentOriented")}return}a.DSE.SetQueryCollection(b);this.ReportRefreshQuery(c,(a.ParentBox==null))};CIDREObj.prototype.ReportCollection=function(b){var a=this.FindObjByID(b);if(!(a.DSE instanceof CDSEDO)){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(0),572,"CIDREObj.ReportCollection","Report "+this.GetObjName(b)+": report is not DocumentOriented")}return null}return a.DSE.IDColl};CIDREObj.prototype.SetSubReportBox=function(d,b){var a=this.FindObjByID(d);var c=this.FindObjByID(b);c.SubReport=a;a.ParentBox=c};CIDREObj.prototype.ReportFreezed=function(b){var a=this.FindObjByID(b);return a.Freezed};CIDREObj.prototype.set_ReportFreezed=function(c,b){var a=this.FindObjByID(c);a.Freezed=b};CIDREObj.prototype.InitSection=function(h,j,b,g,a,e,l,k,d){var c=this.FindObjByID(h);var f=new CSection();f.SectionID=j;f.Height=b;f.NumCol=g;f.ColSpace=a;f.SectType=e;f.VisAttrIdx=l;f.InitFlags(k);f.DBFieldName=d;if(e==IDREGlb.SECT_GROUPHEADER||e==IDREGlb.SECT_GROUPFOOTER){f.GroupLevel=c.DSE.AddGroup(f.DBFieldName)}f.Parent=c;c.SectionsList.Add(f);IDREGlb.SetArraySize(this.ObjMap,j+1);this.ObjMap[j]=f};CIDREObj.prototype.AddReportGroup=function(a,b){var c=this.FindObjByID(a);if(c.Parent.ReInitGroups){c.Parent.ReInitGroups=false;c.Parent.DSE.GroupStringArray.Clear()}c.GroupLevel=c.Parent.DSE.AddGroup(c.DBFieldName)};CIDREObj.prototype.SetSectionRendersInto=function(b,a){var d=this.FindObjByID(b);var c=this.FindObjByID(a);d.RendersInto=c};CIDREObj.prototype.InitReportBox=function(a,r,e,d,t,m,g,s,b,q,n,x,c,u,f,j,o,v,l){if(j==undefined){j=-1}if(o==undefined){o=-1}if(v==undefined){v=""}if(l==undefined){l=IDREGlb.VISALN_AUTO}var h=this.FindObjByID(a);var k=new CRptBox();k.BoxID=r;k.XPos=e;k.YPos=d;k.Width=t;k.Height=m;k.Interline=g;k.HRsz=s;k.VRsz=b;k.VisAttrIdx=q;k.FontHeight=x;k.InitFlags(n);k.ToolTip=c;k.Stretch=u;k.VisProp=f;k.SetBackColor(j);k.SetForeColor(o);k.SetFontMod(v);k.Alignment=l;k.PMastro=(h.RendersInto!=null?h.RendersInto.PMastro:null);k.PSection=h;h.BoxList.Add(k);IDREGlb.SetArraySize(this.ObjMap,r+1);this.ObjMap[r]=k};CIDREObj.prototype.SetBoxImage=function(d,b,a){d=this.GetOldID2NewID(d);if(d==0){return}if(this.Parent.MainFrm.RealPath&&a.length>this.Parent.MainFrm.RealPath.length&&a.toUpperCase().startsWith(this.Parent.MainFrm.RealPath.toUpperCase())){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d),426,"CIDREObj.SetBoxImage","Box "+this.GetObjName(d)+": SetBoxImage path must be relative to application's root directory -> fixing it");a=a.substring(this.Parent.MainFrm.RealPath.length+1)}var g=this.FindObjByID(d);var f=null;var e=0;if(this.Book.FormattingObj!=null){f=this.Book.GetFormattingObj(g)}if(!a.equals("")){e=0;for(var c=0;c<this.Book.ImagesPath.Count();c++){var h=this.Book.ImagesPath[c];if(String.compare(h,a,false)==0){e=c+1;break}}if(e==0){this.Book.ImagesPath.Add(a);e=this.Book.ImagesPath.Count()}}if(f!=null){if(f.ImageIdx!=e){this.AObjectChanged(f);f.ImageIdx=e;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(g)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(g.BoxID),426,"CIDREObj.SetBoxImage","Box "+this.GetObjName(g.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}g.ImageIdx=e}}};CIDREObj.prototype.SetBoxNextBox=function(a,d){var c=this.FindObjByID(a);var b=this.FindObjByID(d);c.NextBox=b};CIDREObj.prototype.SetBoxGraph=function(a,c){var b=this.FindObjByID(a);b.SubGraph=c;b.SubGraph.QueryObj.ParentRep=b.PSection.Parent};CIDREObj.prototype.SetSpanValueListItem=function(a,g,b,h,c,j,e){a=this.GetOldID2NewID(a);if(a==0){return}var k=this.FindObjByID(a);var f=new CRptSpanValItem();f.Name=g;f.Value.set(h);f.Description=b;f.VisualStyle=e;f.Image.set_ServletImage(c);f.ImagePath=j;var d=null;if(this.Book.FormattingObj!=null){d=this.Book.GetFormattingObj(k)}if(d!=null){this.AObjectChanged(d);if(d.ValueList==null){d.ValueList=new ArrayList()}d.ValueList.Add(f);if(d.ValueSourceIdx<d.ValueList.Count()){d.SetNewValue(d.Value)}this.set_RD(true)}else{if(!this.Book.IsChildOfFormattingObj(k)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(k.SpanID),427,"CIDREObj.SetSpanValueListItem","Span "+this.GetObjName(k.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the object that fired the event -> Changing object's design time property")}if(k.ValueList==null){k.ValueList=new ArrayList()}k.ValueList.Add(f);if(!this.Book.ChangedObj.Contains(k)){this.Book.ChangedObj.Add(k)}}}};CIDREObj.prototype.GetReportColumn=function(c,e){c=this.GetOldID2NewID(c);if(c==0){return new IDVariant()}var a=this.FindObjByID(c);var d=a.DSE.GetFldIdx(e);var b=new IDVariant();if(a.DSE.IsOpen()&&!a.DSE.IsEof()){a.DSE.GetFieldValue(b,d)}else{if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.ReportID),428,"CIDREObj.GetReportColumn","Report "+this.GetObjName(a.ReportID)+": Report's DataSource is closed or in EOF -> Can't read report's column value")}b.set(new IDVariant())}return b};CIDREObj.prototype.GetReportTotalRecords=function(b){b=this.GetOldID2NewID(b);if(b==0){return 0}var a=this.FindObjByID(b);if(a.DSE!=null){return a.DSE.GetNumRecords()}else{return 0}};CIDREObj.prototype.GetAggrFunct=function(c,b,e){b=this.GetOldID2NewID(b);if(b==0){return new IDVariant()}var d=this.FindObjByID(b);var a=new IDVariant();d.Parent.DSE.GetAggrFunct(c,d.GroupLevel,e,a);return a};CIDREObj.prototype.GetPageNumber=function(){var a=0;if(this.Book.FormattingPage!=null){a=this.Book.FormattingPage.PageNum}else{if(this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}}return a};CIDREObj.prototype.GetLastCachedPage=function(){var a=this.Book.GetLastCachedPage();if(a!=null){return a.PageNum}else{return 0}};CIDREObj.prototype.MastroRect=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return 0}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){return c.GetRect(a)}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.MastroID),573,"CIDREObj.MastroRect","Page "+this.GetObjName(b.MastroID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return b.GetRect(a)}};CIDREObj.prototype.set_MastroRect=function(e,a,c){e=this.GetOldID2NewID(e);if(e==0){return}var b=this.FindObjByID(e);var d=null;if(this.Book.FormattingObj!=null){d=this.Book.GetFormattingObj(b)}if(d!=null){d.SetRect(a,c)}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.MastroID),429,"CIDREObj.set_MastroRect","Page "+this.GetObjName(b.MastroID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}b.SetRect(a,c)}};CIDREObj.prototype.MastroOrientation=function(c){c=this.GetOldID2NewID(c);if(c==0){return 0}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Orientation}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.MastroID),574,"CIDREObj.MastroOrientation","Page "+this.GetObjName(a.MastroID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Orientation}};CIDREObj.prototype.set_MastroOrientation=function(d,b){d=this.GetOldID2NewID(d);if(d==0){return}var a=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(a)}if(c!=null){c.Orientation=b}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.MastroID),430,"CIDREObj.set_MastroOrientation","Page "+this.GetObjName(a.MastroID)+": Changing properties while a formatting event is firing but the object is not inside the object that fired the event -> Changing object's design time property")}a.Orientation=b}};CIDREObj.prototype.MastroFitMode=function(c){c=this.GetOldID2NewID(c);if(c==0){return 0}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.FitMode}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.MastroID),575,"CIDREObj.MastroFitMode","Page "+this.GetObjName(a.MastroID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.FitMode}};CIDREObj.prototype.set_MastroFitMode=function(d,b){d=this.GetOldID2NewID(d);if(d==0){return}var a=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(a)}if(c!=null){c.FitMode=b}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.MastroID),431,"CIDREObj.set_MastroFitMode","Page "+this.GetObjName(a.MastroID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}a.FitMode=b}};CIDREObj.prototype.BoxRect=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return 0}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){return c.GetRect(a)}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),576,"CIDREObj.BoxRect","Box "+this.GetObjName(d.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return d.GetRect(a)}}return 0};CIDREObj.prototype.set_BoxRect=function(c,a,b){c=this.GetOldID2NewID(c);if(c==0){return}var e=this.FindObjByID(c);var d=null;if(this.Book.FormattingObj!=null){d=this.Book.GetFormattingObj(e)}if(d!=null){if(d.GetRect(a)!=b){this.AObjectChanged(d);d.SetRect(a,b);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(e)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(e.BoxID),432,"CIDREObj.set_BoxRect","Box "+this.GetObjName(e.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}e.SetRect(a,b)}}};CIDREObj.prototype.BoxVisible=function(a){a=this.GetOldID2NewID(a);if(a==0){return false}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),577,"CIDREObj.BoxVisible","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)}}return false};CIDREObj.prototype.set_BoxVisible=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)!=a){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_RPTBOX_VISIBLE,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),433,"CIDREObj.set_BoxVisible","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.SetFlag(IDREGlb.FL_RPTBOX_VISIBLE,a)}}};CIDREObj.prototype.BoxInterline=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Interline}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),578,"CIDREObj.BoxInterline","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Interline}}return 0};CIDREObj.prototype.set_BoxInterline=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.Interline!=a){this.AObjectChanged(c);c.Interline=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),434,"CIDREObj.set_BoxInterline","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Interline=a}}};CIDREObj.prototype.BoxVisualStyle=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.VisAttrIdx}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),579,"CIDREObj.BoxVisualStyle","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.VisAttrIdx}}return 0};CIDREObj.prototype.set_BoxVisualStyle=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.VisAttrIdx!=a){this.AObjectChanged(c);c.SetVisualStyle(a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),435,"CIDREObj.set_BoxVisualStyle","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.SetVisualStyle(a)}}};CIDREObj.prototype.BoxToolTip=function(a){a=this.GetOldID2NewID(a);if(a==0){return""}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.ToolTip}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),580,"CIDREObj.BoxToolTip","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.ToolTip}}return""};CIDREObj.prototype.set_BoxToolTip=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(!c.ToolTip.equals(a)){this.AObjectChanged(c);c.ToolTip=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),436,"CIDREObj.set_BoxToolTip","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.ToolTip=a}}};CIDREObj.prototype.BoxFlag=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return false}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetFlag(d)}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),581,"CIDREObj.BoxFlag","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFlag(d)}}return false};CIDREObj.prototype.set_BoxFlag=function(b,e,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.GetFlag(e)!=a){this.AObjectChanged(c);c.SetFlag(e,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),437,"CIDREObj.set_BoxFlag","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.SetFlag(e,a)}}};CIDREObj.prototype.BoxStretch=function(a){a=this.GetOldID2NewID(a);if(a==0){return -1}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Stretch}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),582,"CIDREObj.BoxStretch","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Stretch}}return -1};CIDREObj.prototype.set_BoxStretch=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.Stretch!=a){this.AObjectChanged(c);c.Stretch=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),438,"CIDREObj.set_BoxStretch","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Stretch=a}}};CIDREObj.prototype.BoxRotation=function(a){a=this.GetOldID2NewID(a);if(a==0){return -1}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Rotation}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),583,"CIDREObj.BoxRotation","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Rotation}}return -1};CIDREObj.prototype.set_BoxRotation=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.Rotation!=a){this.AObjectChanged(c);c.Rotation=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),439,"CIDREObj.set_BoxRotation","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Rotation=a}}};CIDREObj.prototype.BoxBackgroundColor=function(a){a=this.GetOldID2NewID(a);if(a==0){return -2}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetBackColor()}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),584,"CIDREObj.BoxBackgroundColor","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetBackColor()}}return -2};CIDREObj.prototype.set_BoxBackgroundColor=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){if(b.GetBackColor()!=d){this.AObjectChanged(b);b.SetBackColor(d);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),464,"CIDREObj.set_BoxBackgroundColor","Box "+this.GetObjName(c.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}c.SetBackColor(d)}}};CIDREObj.prototype.BoxForegroundColor=function(a){a=this.GetOldID2NewID(a);if(a==0){return -2}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetForeColor()}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),585,"CIDREObj.BoxForegroundColor","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetForeColor()}}return -2};CIDREObj.prototype.set_BoxForegroundColor=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){if(b.GetForeColor()!=d){this.AObjectChanged(b);b.SetForeColor(d);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),473,"CIDREObj.set_BoxForegroundColor","Box "+this.GetObjName(c.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}c.SetForeColor(d)}}};CIDREObj.prototype.BoxAlignment=function(a){a=this.GetOldID2NewID(a);if(a==0){return -1}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Alignment}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),586,"CIDREObj.BoxAlignment","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Alignment}}return -1};CIDREObj.prototype.set_BoxAlignment=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.Alignment!=a){this.AObjectChanged(c);c.Alignment=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),474,"CIDREObj.set_BoxAlignment","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Alignment=a}}};CIDREObj.prototype.BoxVAlignment=function(a){a=this.GetOldID2NewID(a);if(a==0){return -1}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.VAlignment}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),586,"CIDREObj.BoxVAlignment","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.VAlignment}}return -1};CIDREObj.prototype.set_BoxVAlignment=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.VAlignment!=a){this.AObjectChanged(c);c.VAlignment=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),474,"CIDREObj.set_BoxVAlignment","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.VAlignment=a}}};CIDREObj.prototype.BoxFontModifiers=function(a){a=this.GetOldID2NewID(a);if(a==0){return""}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetFontMod()}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),587,"CIDREObj.BoxFontModifiers","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFontMod()}}return""};CIDREObj.prototype.set_BoxFontModifiers=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(!c.GetFontMod().equals(a)){this.AObjectChanged(c);c.SetFontMod(a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),475,"CIDREObj.set_BoxFontModifiers","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.SetFontMod(a)}}};CIDREObj.prototype.BoxSubForm=function(a){a=this.GetOldID2NewID(a);if(a==0){return null}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetSubForm()}else{if(this.Book.DTTObj.Level>0){if(c.PSection!=null){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),465,"CIDREObj.BoxSubForm","Box "+this.GetObjName(c.BoxID)+": The sub-form property can be read only inside BeforeFormatting or AfterFormatting of the section that contains this box")}else{this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),465,"CIDREObj.BoxSubForm","Box "+this.GetObjName(c.BoxID)+": The sub-form property can be read only inside OnFormatting event of the page that contains this box")}}}return null};CIDREObj.prototype.set_BoxSubForm=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){if(c.SubGraph!=null){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),466,"CIDREObj.set_BoxSubForm","Box "+this.GetObjName(c.BoxID)+": This box contains a graph thus you can't insert a form into it")}}else{if(c.SubReport!=null){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),466,"CIDREObj.set_BoxSubForm","Box "+this.GetObjName(c.BoxID)+": This box contains a sub-report thus you can't insert a form into it")}}else{if(b.SubForm!=d){b.SetSubForm(d)}}}}else{if(this.Book.DTTObj.Level>0){if(c.PSection!=null){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),467,"CIDREObj.set_BoxSubForm","Box "+this.GetObjName(c.BoxID)+": SubForm can be set only inside BeforeFormatting or AfterFormatting of the section that contains this box")}else{this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),467,"CIDREObj.set_BoxSubForm","Box "+this.GetObjName(c.BoxID)+": SubForm can be set only inside OnFormatting event of the page that contains this box")}}}};CIDREObj.prototype.BoxVisProp=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return -1}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){return(a==undefined?c.VisProp:(c.VisProp&a)!=0)}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),588,"CIDREObj.BoxVisProp","Box "+this.GetObjName(d.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return(a==undefined?d.VisProp:(d.VisProp&a)!=0)}}return -1};CIDREObj.prototype.set_BoxVisProp=function(c,a,b){c=this.GetOldID2NewID(c);if(c==0){return}var e=this.FindObjByID(c);var d=null;if(this.Book.FormattingObj!=null){d=this.Book.GetFormattingObj(e)}if(d!=null){var f=(d.VisProp&~a)|(b?a:0);if(d.VisProp!=f){this.AObjectChanged(d);d.VisProp=f;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(e)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(e.BoxID),439,"CIDREObj.set_BoxVisProp","Box "+this.GetObjName(e.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}e.VisProp=(e.VisProp&~a)|(b?a:0)}}};CIDREObj.prototype.BoxBadge=function(a){a=this.GetOldID2NewID(a);if(a==0){return""}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Badge}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),589,"CIDREObj.BoxBadge","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Badge}}return""};CIDREObj.prototype.set_BoxBadge=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(!c.Badge.equals(a)){this.AObjectChanged(c);c.Badge=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),439,"CIDREObj.set_BoxBadge","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Badge=a}}};CIDREObj.prototype.BoxClassName=function(a){a=this.GetOldID2NewID(a);if(a==0){return""}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.ClassName}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),589,"CIDREObj.BoxClassName","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.ClassName}}return""};CIDREObj.prototype.set_BoxClassName=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(!c.ClassName.equals(a)){this.AObjectChanged(c);c.ClassName=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),439,"CIDREObj.set_BoxClassName","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.ClassName=a}}};CIDREObj.prototype.SpanText=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Text}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),590,"CIDREObj.SpanText","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Text}}return""};CIDREObj.prototype.set_SpanText=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.Text.equals(a)){this.AObjectChanged(c);c.Text=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),440,"CIDREObj.set_SpanText","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.Text=a}}};CIDREObj.prototype.SpanValue=function(c){c=this.GetOldID2NewID(c);if(c==0){return new IDVariant()}var a=this.FindObjByID(c);if(this.Book.FormattingObj!=null){var b=this.Book.GetFormattingObj(a);if(b!=null){return b.Value}}return new IDVariant()};CIDREObj.prototype.set_SpanValue=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);if(this.Book.FormattingObj!=null){var c=this.Book.GetFormattingObj(b);if(c!=null){if(!c.Value.equals(a)){this.AObjectChanged(c);c.SetNewValue(a);this.set_RD(true)}}}};CIDREObj.prototype.SpanVisible=function(c){c=this.GetOldID2NewID(c);if(c==0){return false}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),591,"CIDREObj.SpanVisible","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)}}return false};CIDREObj.prototype.set_SpanVisible=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)!=a){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_RPTSPAN_VISIBLE,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),441,"CIDREObj.set_SpanVisible","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.SetFlag(IDREGlb.FL_RPTSPAN_VISIBLE,a)}}};CIDREObj.prototype.SpanEnabled=function(c){c=this.GetOldID2NewID(c);if(c==0){return false}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),592,"CIDREObj.SpanEnabled","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)}}return false};CIDREObj.prototype.set_SpanEnabled=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)!=a){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_RPTSPAN_ENABLED,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),442,"CIDREObj.set_SpanEnabled","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.SetFlag(IDREGlb.FL_RPTSPAN_ENABLED,a)}}};CIDREObj.prototype.SpanActive=function(c){c=this.GetOldID2NewID(c);if(c==0){return false}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.GetFlag(IDREGlb.FL_RPTSPAN_ACTIVE)}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),593,"CIDREObj.SpanActive","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.GetFlag(IDREGlb.FL_RPTSPAN_ACTIVE)}}return false};CIDREObj.prototype.set_SpanActive=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.GetFlag(IDREGlb.FL_RPTSPAN_ACTIVE)!=a){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_RPTSPAN_ACTIVE,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),443,"CIDREObj.set_SpanActive","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.SetFlag(IDREGlb.FL_RPTSPAN_ACTIVE,a)}}};CIDREObj.prototype.SpanVisualStyle=function(c){c=this.GetOldID2NewID(c);if(c==0){return 0}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.VisAttrIdx}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),594,"CIDREObj.SpanVisualStyle","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.VisAttrIdx}}return 0};CIDREObj.prototype.set_SpanVisualStyle=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.VisAttrIdx!=a){this.AObjectChanged(c);c.VisAttrIdx=a;if(c.Value.Type!=IDVariant.NULL){c.SetNewValue(c.Value)}c.VisAttrIdx=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),444,"CIDREObj.set_SpanVisualStyle","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.VisAttrIdx=a}}};CIDREObj.prototype.SpanToolTip=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.ToolTip}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),595,"CIDREObj.SpanToolTip","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.ToolTip}}return""};CIDREObj.prototype.set_SpanToolTip=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.ToolTip.equals(a)){this.AObjectChanged(c);c.ToolTip=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),445,"CIDREObj.set_SpanToolTip","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.ToolTip=a}}};CIDREObj.prototype.SpanStretch=function(c){c=this.GetOldID2NewID(c);if(c==0){return -1}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Stretch}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),596,"CIDREObj.SpanStretch","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Stretch}}return -1};CIDREObj.prototype.set_SpanStretch=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.Stretch!=a){this.AObjectChanged(c);c.Stretch=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),446,"CIDREObj.set_SpanStretch","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.Stretch=a}}};CIDREObj.prototype.SpanBackgroundColor=function(c){c=this.GetOldID2NewID(c);if(c==0){return -2}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.BackColor}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),597,"CIDREObj.SpanBackgroundColor","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.BackColor}}return -2};CIDREObj.prototype.set_SpanBackgroundColor=function(d,b){d=this.GetOldID2NewID(d);if(d==0){return}var a=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(a)}if(c!=null){if(c.BackColor!=b){this.AObjectChanged(c);c.BackColor=b;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),468,"CIDREObj.set_SpanBackgroundColor","Span "+this.GetObjName(a.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}a.BackColor=b}}};CIDREObj.prototype.SpanForegroundColor=function(c){c=this.GetOldID2NewID(c);if(c==0){return -2}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.ForeColor}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),598,"CIDREObj.SpanForegroundColor","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.ForeColor}}return -2};CIDREObj.prototype.set_SpanForegroundColor=function(d,b){d=this.GetOldID2NewID(d);if(d==0){return}var a=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(a)}if(c!=null){if(c.ForeColor!=b){this.AObjectChanged(c);c.ForeColor=b;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),469,"CIDREObj.set_SpanForegroundColor","Span "+this.GetObjName(a.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}a.ForeColor=b}}};CIDREObj.prototype.SpanFontModifiers=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.FontMod}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),599,"CIDREObj.SpanFontModifiers","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.FontMod}}return""};CIDREObj.prototype.set_SpanFontModifiers=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.FontMod.equals(a)){this.AObjectChanged(c);c.FontMod=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),470,"CIDREObj.set_SpanFontModifiers","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.FontMod=a}}};CIDREObj.prototype.SpanMask=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Mask}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),600,"CIDREObj.SpanMask","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Mask}}return""};CIDREObj.prototype.set_SpanMask=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.Mask.equals(a)){this.AObjectChanged(c);c.Mask=a;if(c.Value.Type!=IDVariant.NULL){c.SetNewValue(c.Value)}this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),471,"CIDREObj.set_SpanMask","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.Mask=a}}};CIDREObj.prototype.SpanWatermark=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Watermark}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),601,"CIDREObj.SpanWatermark","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Watermark}}return""};CIDREObj.prototype.set_SpanWatermark=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.Watermark.equals(a)){this.AObjectChanged(c);c.Watermark=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),472,"CIDREObj.set_SpanWatermark","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.Watermark=a}}};CIDREObj.prototype.SpanClassName=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.ClassName}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),601,"CIDREObj.SpanClassName","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.ClassName}}return""};CIDREObj.prototype.set_SpanClassName=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.ClassName.equals(a)){this.AObjectChanged(c);c.ClassName=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),472,"CIDREObj.set_SpanClassName","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.ClassName=a}}};CIDREObj.prototype.EmptySpanValueList=function(c){c=this.GetOldID2NewID(c);if(c==0){return}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){this.AObjectChanged(b);b.ValueList=new ArrayList();this.set_RD(true)}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),447,"CIDREObj.EmptySpanValueList","Span "+this.GetObjName(a.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}a.ValueList=new ArrayList()}}};CIDREObj.prototype.SectionHeight=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetHeight()}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetHeight()}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),602,"CIDREObj.SectionHeight","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetHeight()};CIDREObj.prototype.set_SectionHeight=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.SetHeight(b);return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if(c.GetHeight()!=b){this.AObjectChanged(c);c.SetHeight(b);this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),448,"CIDREObj.set_SectionHeight","Section "+this.GetObjName(d.SectionID)+": Changing Height during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),449,"CIDREObj.set_SectionHeight","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.SetHeight(b)};CIDREObj.prototype.SectionVisible=function(a){a=this.GetOldID2NewID(a);if(a==0){return false}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetFlag(IDREGlb.FL_SECT_VISIBLE)}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetFlag(IDREGlb.FL_SECT_VISIBLE)}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),603,"CIDREObj.SectionVisible","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFlag(IDREGlb.FL_SECT_VISIBLE)};CIDREObj.prototype.set_SectionVisible=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.SetFlag(IDREGlb.FL_SECT_VISIBLE,b);return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if(c.GetFlag(IDREGlb.FL_SECT_VISIBLE)!=b){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_SECT_VISIBLE,b);this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),450,"CIDREObj.set_SectionVisible","Section "+this.GetObjName(d.SectionID)+": Changing Visibility during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),451,"CIDREObj.set_SectionVisible","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.SetFlag(IDREGlb.FL_SECT_VISIBLE,b)};CIDREObj.prototype.SectionShowChildren=function(a){a=this.GetOldID2NewID(a);if(a==0){return false}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(d);if(b!=null){return b.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){var c=this.Book.GetFormattingObj(d);if(c!=null){return c.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){return c.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)}}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),604,"CIDREObj.SectionShowChildren","Section "+this.GetObjName(d.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return d.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)};CIDREObj.prototype.set_SectionShowChildren=function(l,c){l=this.GetOldID2NewID(l);if(l==0){return}var f=this.FindObjByID(l);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var e=this.Book.GetFormattingObj(f);if(e!=null){e.SetFlag(IDREGlb.FL_SECT_SHOWCHILD,c);var h=f.Parent.GetPermanentState(e);if(h==null){h=new PSectionState();f.Parent.PermStatesList.Add(h);h.SectionID=f.SectionID;h.DSECurrentPosition=f.Parent.DSE.GetCurrentPosition();h.Flags=e.GetFlags();h.PageNum=-1}h.SetFlag(IDREGlb.FL_SECT_SHOWCHILD,c);return}}if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){var d=this.Book.GetFormattingObj(f);if(d!=null){var h=d.ParentSection.Parent.GetPermanentState(d.ParentSection.SectionID,d.DSEPosition);if(h==null){h=new PSectionState();d.ParentSection.Parent.PermStatesList.Add(h);h.SectionID=d.ParentSection.SectionID;h.DSECurrentPosition=d.DSEPosition;h.Flags=d.GetFlags();h.PageNum=d.Parent.PageNum}h.SetFlag(IDREGlb.FL_SECT_SHOWCHILD,c);if(this.Book.PE.PrintingPage!=null){var g=this.Book.PE.PrintingPage.PageNum;if(h.GH_PageNum!=-1){g=h.GH_PageNum}if(f.SectType==IDREGlb.SECT_GROUPHEADER&&f.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)){for(var b=0;b<this.Book.ReportsList.Count();b++){var k=this.Book.ReportsList[b];for(var j=0;j<k.PermStatesList.Count();j++){var a=k.PermStatesList[j];if((a.PageNum==-1||a.PageNum>g)&&a.SectionID==f.SectionID&&a.GH_DSECurrentPosition==h.GH_DSECurrentPosition){k.PermStatesList.RemoveAt(j--)}}}}this.Book.RefreshPages(g);this.Book.PrintPages(g,g)}return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(f.SectionID),452,"CIDREObj.set_SectionShowChildren","Section "+this.GetObjName(f.SectionID)+": Changing ShowChildren flag during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(f.SectionID),453,"CIDREObj.set_SectionShowChildren","Section "+this.GetObjName(f.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}if(f.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)!=c){f.SetFlag(IDREGlb.FL_SECT_SHOWCHILD,c);for(var b=0;b<this.Book.ReportsList.Count();b++){var k=this.Book.ReportsList[b];for(var j=0;j<k.PermStatesList.Count();j++){var a=k.PermStatesList[j];if(a.SectionID==f.SectionID){k.PermStatesList.RemoveAt(j--)}}}}};CIDREObj.prototype.SectionFlag=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return false}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetFlag(d)}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetFlag(d)}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),605,"CIDREObj.SectionFlag","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFlag(d)};CIDREObj.prototype.set_SectionFlag=function(a,e,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.SetFlag(e,b);return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if(c.GetFlag(e)!=b){this.AObjectChanged(c);c.SetFlag(e,b);this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),454,"CIDREObj.set_SectionFlag","Section "+this.GetObjName(d.SectionID)+": Changing flag during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),455,"CIDREObj.set_SectionFlag","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.SetFlag(e,b)};CIDREObj.prototype.SectionVisualStyle=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.VisAttrIdx}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.VisAttrIdx}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),606,"CIDREObj.SectionVisualStyle","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.VisAttrIdx};CIDREObj.prototype.set_SectionVisualStyle=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.VisAttrIdx=b;return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if(c.VisAttrIdx!=b){this.AObjectChanged(c);c.VisAttrIdx=b;this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),456,"CIDREObj.set_SectionVisualStyle","Section "+this.GetObjName(d.SectionID)+": Changing VisualStyle during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),457,"CIDREObj.set_SectionVisualStyle","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.VisAttrIdx=b};CIDREObj.prototype.SectionGroupLevel=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var b=this.FindObjByID(a);if(this.Book.FormattingObj!=null){}return b.GroupLevel+1};CIDREObj.prototype.set_SectionGroupLevel=function(f,a){f=this.GetOldID2NewID(f);if(f==0){return}var e=this.FindObjByID(f);if(this.Book.FormattingObj!=null){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(e.SectionID),458,"CIDREObj.set_SectionGroupLevel","Section "+this.GetObjName(e.SectionID)+": Changing of GroupLevel property is not is not allowed during a formatting event -> Skipping operation")}}else{if(e.Parent.DSE.GroupArray.Count()==0&&e.Parent.DSE.GroupStringArray.Count()>0){e.Parent.DSE.CreateGroups()}a--;if(a>=0&&a<e.Parent.DSE.GroupArray.Count()&&e.GroupLevel!=a){var j=e.GroupLevel;var m=e.Parent.DSE.GroupStringArray[j];var b=e.Parent.DSE.GroupArray[j];for(var l=0;l<e.Parent.SectionsList.Count();l++){var k=e.Parent.SectionsList[l];if(k.SectType!=IDREGlb.SECT_GROUPHEADER&&k.SectType!=IDREGlb.SECT_GROUPFOOTER){continue}if(k==e){continue}if(k.DBFieldName.equals(e.DBFieldName)){k.GroupLevel=a;continue}if(k.GroupLevel<=Math.max(e.GroupLevel,a)&&k.GroupLevel>=Math.min(e.GroupLevel,a)){if(a>e.GroupLevel){k.GroupLevel--}else{k.GroupLevel++}}}e.GroupLevel=a;e.Parent.DSE.GroupStringArray.RemoveAt(j);e.Parent.DSE.GroupArray.RemoveAt(j);e.Parent.DSE.GroupStringArray.Insert(a,m);e.Parent.DSE.GroupArray.Insert(a,b);var h;for(h=0;h<e.Parent.SectionsList.Count();h++){var d=e.Parent.SectionsList[h];if(d.SectType==IDREGlb.SECT_GROUPHEADER){for(var g=h;g<e.Parent.SectionsList.Count();g++){var c=e.Parent.SectionsList[g];if(c.SectType==IDREGlb.SECT_GROUPHEADER&&d.GroupLevel>c.GroupLevel){e.Parent.SectionsList[h]=c;e.Parent.SectionsList[g]=d;h=-1;break}}}}for(h=0;h<e.Parent.SectionsList.Count();h++){var d=e.Parent.SectionsList[h];if(d.SectType==IDREGlb.SECT_GROUPFOOTER){for(var g=h;g<e.Parent.SectionsList.Count();g++){var c=e.Parent.SectionsList[g];if(c.SectType==IDREGlb.SECT_GROUPFOOTER&&d.GroupLevel<c.GroupLevel){e.Parent.SectionsList[h]=c;e.Parent.SectionsList[g]=d;h=-1;break}}}}e.Parent.DSE.OrderGroups()}}};CIDREObj.prototype.SectionColumns=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.NumCol}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.NumCol}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),607,"CIDREObj.SectionColumns","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.NumCol};CIDREObj.prototype.set_SectionColumns=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.NumCol=b;return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),459,"CIDREObj.set_SectionColumns","Section "+this.GetObjName(d.SectionID)+": Changing ColumnNumber during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),460,"CIDREObj.set_SectionColumns","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.NumCol=b};CIDREObj.prototype.SectionColSpace=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetColSpace()}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetColSpace()}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),608,"CIDREObj.SectionColSpace","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetColSpace()};CIDREObj.prototype.set_SectionColSpace=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.SetColSpace(b);return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),461,"CIDREObj.set_SectionColSpace","Section "+this.GetObjName(d.SectionID)+": Changing ColumnSpace during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),462,"CIDREObj.set_SectionColSpace","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.SetColSpace(b)};CIDREObj.prototype.SectionClassName=function(a){a=this.GetOldID2NewID(a);if(a==0){return""}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.ClassName}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.ClassName}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),606,"CIDREObj.SectionClassName","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.ClassName};CIDREObj.prototype.set_SectionClassName=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.ClassName=b;return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if((c.ClassName!=null&&!c.ClassName.equals(b))||(c.ClassName==null&&b!=null)){this.AObjectChanged(c);c.ClassName=b;this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),456,"CIDREObj.set_SectionClassName","Section "+this.GetObjName(d.SectionID)+": Changing ClassName during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),457,"CIDREObj.set_SectionClassName","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.ClassName=b};CIDREObj.prototype.GetSectionYPos=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetYPos()}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetYPos()}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),609,"CIDREObj.GetSectionYPos","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return 0};CIDREObj.prototype.SetSectionReprint=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.Reprint=b}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){}}}}else{}if(this.Book.DTTObj.Level>0&&(this.Book.FormattingObj==null||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT)){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),463,"CIDREObj.SetSectionReprint","Section "+this.GetObjName(d.SectionID)+": Reprint can only be called during BeforeFormatting event -> Skipping operation")}};CIDREObj.prototype.ReportVisible=function(a){a=this.GetOldID2NewID(a);if(a==0){return false}var b=this.FindObjByID(a);if(b!=null){return b.GetFlag(IDREGlb.FL_REPORT_VISIBLE)}else{return false}};CIDREObj.prototype.set_ReportVisible=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var c=this.FindObjByID(b);if(c!=null){c.SetFlag(IDREGlb.FL_REPORT_VISIBLE,a)}};CIDREObj.prototype.ReportMaxRows=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var b=this.FindObjByID(a);if(b!=null){return b.DSE.MaxRows}return 0};CIDREObj.prototype.set_ReportMaxRows=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var c=this.FindObjByID(b);if(c!=null){c.DSE.MaxRows=a}};CIDREObj.prototype.ReportRecordSet=function(a){a=this.GetOldID2NewID(a);if(a==0){return null}var b=this.FindObjByID(a);if(b!=null){return b.DSE.MasterRS()}else{return null}};CIDREObj.prototype.set_ReportRecordSet=function(c,b){c=this.GetOldID2NewID(c);if(c==0){return}var d=this.FindObjByID(c);if(d!=null&&d.DSE instanceof CDSEDB){d.DSE.set_MasterRS(b);var a=-1;if(this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}this.Book.RefreshPages(1);if(a!=-1){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),569,"CIDREObj.set_ReportRecordSet","Book "+this.GetObjName(0)+": The book was showing page "+a+" in preview -> Reformatting up to that page")}this.Book.PrintPages(a,a)}}};CIDREObj.prototype.ReportRefreshQuery=function(c,b){if(b==undefined){b=true}c=this.GetOldID2NewID(c);if(c==0){return}var d=this.FindObjByID(c);d.DSE.Close(true);if(d.DSE instanceof CDSEDB){d.DSE.UpdateParam(true)}if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(d.ReportID),568,"CIDREObj.ReportRefreshQuery","Report "+this.GetObjName(d.ReportID)+": Refreshing report's query")}this.Book.TotalPagesNumberConf=false;if(b){var a=-1;if(this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}this.Book.RefreshPages(1);if(a!=-1){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(d.ReportID),569,"CIDREObj.ReportRefreshQuery","Report "+this.GetObjName(d.ReportID)+": The book was showing page "+a+" in preview -> Reformatting up to that page")}this.Book.PrintPages(a,a)}}};CIDREObj.prototype.SetReportWhereClause=function(e,d,b,a){if(b==undefined){b=""}if(a==undefined){a=true}var c;if(e==-1){c=this.Book.ReportsList[0];e=c.ReportID}else{e=this.GetOldID2NewID(e);if(e==0){return}c=this.FindObjByID(e)}if(c!=null&&c.DSE instanceof CDSEDB){c.DSE.MergeWhereClause(d,b,a);this.ReportRefreshQuery(e)}};CIDREObj.prototype.ReportSelectSection=function(c,a,b){var c=this.GetOldID2NewID(c);if(c==0){return false}var d=this.FindObjByID(c);if(d!=null){return d.SelectSection(a,b)}else{return false}};CIDREObj.prototype.SetObjName=function(b,a){IDREGlb.SetArraySize(this.NameMap,b+1);this.NameMap[b]=a};CIDREObj.prototype.GetObjName=function(a){a=this.GetOldID2NewID(a);var b="";if(a<this.NameMap.Count()){b=this.NameMap[a]}return b};CIDREObj.prototype.SetObjCode=function(a,b){this.Code2IndexMap[b]=a;IDREGlb.SetArraySize(this.Index2CodeMap,a+1);this.Index2CodeMap[a]=b};CIDREObj.prototype.GetObjCode=function(a){a=this.GetOldID2NewID(a);var b="";if(a<this.Index2CodeMap.Count()){b=this.Index2CodeMap[a]}return b};CIDREObj.prototype.GetObjByCode=function(b){var a=this.Code2IndexMap[b];var c=this.FindObjByID(a);return c};CIDREObj.prototype.SetRTCGuid=function(b,a){IDREGlb.SetArraySize(this.GUIDMap,b+1);this.GUIDMap[b]=a};CIDREObj.prototype.GetRTCGuid=function(b){b=this.GetOldID2NewID(b);var a="";if(b<this.GUIDMap.Count()){a=this.GUIDMap[b]}return a};CIDREObj.prototype.GetRTCID=function(a){for(var b=0;b<this.GUIDMap.Count();b++){if(this.GUIDMap[b].equals(a)){return b}}return -1};CIDREObj.prototype.SetFlags=function(a,b,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);if(c instanceof CBook){c.Flags=(c.Flags&~d)|(b&d)}if(c instanceof CRptBox){c.SetFlag(d,(b&d)!=0)}if(c instanceof CRptSpan){c.SetFlag(d,(b&d)!=0)}if(c instanceof CReport){c.SetFlag(d,(b&d)!=0)}if(c instanceof CSection){c.SetFlag(d,(b&d)!=0)}};CIDREObj.prototype.GetNumObjects=function(){return this.GUIDMap.Count()};CIDREObj.prototype.GetObjType=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);var b=IDREGlb.OBJ_UNKNOWN;if(c instanceof CBook){b=IDREGlb.OBJ_BOOK}if(c instanceof CMastro){b=IDREGlb.OBJ_MASTRO}if(c instanceof CRptBox){b=IDREGlb.OBJ_RPTBOX}if(c instanceof CRptSpan){b=IDREGlb.OBJ_RPTSPAN}if(c instanceof CReport){b=IDREGlb.OBJ_REPORT}if(c instanceof CSection){b=IDREGlb.OBJ_SECTION}return b};CIDREObj.prototype.SetRoleFlags=function(a,b,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);if(c instanceof CRptBox){c.SetRoleFlag(b&d)}if(c instanceof CRptSpan){c.SetRoleFlag(b&d)}if(c instanceof CReport){c.SetRoleFlag(b&d)}if(c instanceof CSection){c.SetRoleFlag(b&d)}};CIDREObj.prototype.UpdateMastro=function(f,a,g,c,e,d){f=this.GetOldID2NewID(f);if(f==0){return}var b=this.FindObjByID(f);if(a instanceof IDVariant){a=(a.Type==IDVariant.NULL?b.Width:a.intValue());g=(g.Type==IDVariant.NULL?b.Height:g.intValue());c=(c.Type==IDVariant.NULL?b.UM:c.intValue());e=(e.Type==IDVariant.NULL?b.Orientation:e.intValue());d=(d.Type==IDVariant.NULL?b.FitMode:d.intValue())}b.Width=a;b.Height=g;b.UM=c;b.Orientation=e;b.FitMode=d};CIDREObj.prototype.UpdateRptBox=function(q,c,a,m,d,l,j,k,o,n,g,h,f,b){q=this.GetOldID2NewID(q);if(q==0){return}var e=this.FindObjByID(q);if(c instanceof IDVariant){c=(c.Type==IDVariant.NULL?e.XPos:c.intValue());a=(a.Type==IDVariant.NULL?e.YPos:a.intValue());m=(m.Type==IDVariant.NULL?e.Width:m.intValue());d=(d.Type==IDVariant.NULL?e.Height:d.intValue());l=(l.Type==IDVariant.NULL?e.Interline:l.intValue());j=(j.Type==IDVariant.NULL?e.HRsz:j.intValue());k=(k.Type==IDVariant.NULL?e.VRsz:k.intValue());if(o==null){o=e.VisAttrIdx}h=(h.Type==IDVariant.NULL?e.ToolTip:h.stringValue());f=(f.Type==IDVariant.NULL?e.Stretch:f.intValue())}e.XPos=c;e.YPos=a;e.Width=m;e.Height=d;e.Interline=l;e.HRsz=j;e.VRsz=k;e.Stretch=f;e.VisProp=b;if(o!=0){e.VisAttrIdx=o}e.InitFlags((e.GetFlags()&~g)|(n&g));e.InitFlags(e.GetFlags());e.ToolTip=h};CIDREObj.prototype.UpdateRptSpan=function(a,l,e,g,b,k,f,h,c,d){a=this.GetOldID2NewID(a);if(a==0){return}var j=this.FindObjByID(a);if(e instanceof IDVariant){if(l==null){l=j.VisAttrIdx}e=(e.Type==IDVariant.NULL?j.DataType:e.intValue());g=(g.Type==IDVariant.NULL?j.MaxLen:g.intValue());b=(b.Type==IDVariant.NULL?j.Scale:b.intValue());h=(h.Type==IDVariant.NULL?j.ToolTip:h.stringValue());c=(c.Type==IDVariant.NULL?j.Text:c.stringValue());d=(d.Type==IDVariant.NULL?j.Stretch:d.intValue())}if(l!=0){j.VisAttrIdx=l}j.DataType=e;j.MaxLen=g;j.Scale=b;j.Stretch=d;j.InitFlags((j.GetFlags()&~f)|(k&f));j.InitFlags(j.GetFlags());j.ToolTip=h;j.Text=c};CIDREObj.prototype.UpdateReport=function(c,d,b){c=this.GetOldID2NewID(c);if(c==0){return}var a=this.FindObjByID(c);a.InitFlags((a.GetFlags()&~b)|(d&b));a.InitFlags(a.GetFlags())};CIDREObj.prototype.UpdateReportQuery=function(c,b,d){c=this.GetOldID2NewID(c);if(c==0){return}var a=this.FindObjByID(c);if(d!=-1&&a.DSE instanceof CDSEIMDB){a.DSE.IMDBTable=d}if(b!=null&&a.DSE instanceof CDSEDB){}};CIDREObj.prototype.UpdateSection=function(c,h,b,g,a,f,d){c=this.GetOldID2NewID(c);if(c==0){return}var e=this.FindObjByID(c);if(h instanceof IDVariant){h=(h.Type==IDVariant.NULL?e.Height:h.intValue());b=(b.Type==IDVariant.NULL?e.NumCol:b.intValue());g=(g.Type==IDVariant.NULL?e.ColSpace:g.intValue());if(a==null){a=e.VisAttrIdx}}e.Height=h;e.NumCol=b;e.ColSpace=g;if(a!=0){e.VisAttrIdx=a}if(e.RendersInto==null){f&=~IDREGlb.FL_SECT_VISIBLE}e.InitFlags((e.GetFlags()&~d)|(f&d));e.InitFlags(e.GetFlags())};CIDREObj.prototype.set_RD=function(a){if(this.Book.FormattingObj!=null){if(this.Book.FormattingObj instanceof ASectionState){this.Book.FormattingObj.PageChanged=true}if(this.Book.FormattingObj instanceof ASection){this.Book.FormattingObj.PageChanged=true}}};CIDREObj.prototype.Fire_OnFormattingPage=function(a){this.Parent.Fire_OnFormattingPage(a)};CIDREObj.prototype.Fire_OnAfterFormattingPage=function(a){this.Parent.Fire_OnAfterFormattingPage(a)};CIDREObj.prototype.Fire_OnFormattingSection=function(a){this.Parent.Fire_OnFormattingSection(a)};CIDREObj.prototype.Fire_OnAfterFormattingSection=function(a){this.Parent.Fire_OnAfterFormattingSection(a);if(this.Book.FormattingObj!=null&&this.Book.FormattingPage!=null&&this.Book.FormattingObj.PageChanged){this.Parent.RD3PageCache.remove(this.Book.FormattingPage.PageNum);this.Parent.RD3Changed=true}};CIDREObj.prototype.Fire_OnChangingSpan=function(d,a,b,c){this.Parent.Fire_OnChangingSpan(d,a,b,c)};CIDREObj.prototype.Fire_OnBoxDrop=function(b,a){this.Parent.Fire_OnBoxDrop(new IDVariant(b),new IDVariant(a))};CIDREObj.prototype.Fire_OnBoxTransform=function(d,e,c,f,a,b){this.Parent.Fire_OnBoxTransform(new IDVariant(d),new IDVariant(e),new IDVariant(c),new IDVariant(f),new IDVariant(a),b)};CIDREObj.prototype.Fire_OnConnecting=function(a){this.Parent.Fire_OnConnecting(a)};CIDREObj.prototype.Fire_Activated=function(b,a){this.Parent.Fire_Activated(b,a)};CIDREObj.prototype.Fire_OnIMDBUpdate=function(a){this.Parent.Fire_OnIMDBUpdate(a)};CIDREObj.prototype.Fire_OnPreview=function(){this.Parent.Fire_OnPreview()};CIDREObj.prototype.ShowDragBox=function(){if(this.Book.DDSrcBox!=null){if(this.Book.DDSrcBox.ParentSect!=null){this.Book.FormattingObj=this.Book.DDSrcBox.ParentSect;this.Book.FormattingType=IDREGlb.FRM_SECTION_PERM}else{if(this.Book.DDSrcBox.ParentPage!=null){this.Book.FormattingObj=this.Book.DDSrcBox.ParentPage;this.Book.FormattingType=IDREGlb.FRM_PAGE}}this.Book.MoveDSEPositions(this.Book.DDSrcBox)}};CIDREObj.prototype.ShowDropBox=function(){if(this.Book.DDDstBox!=null){if(this.Book.DDDstBox.ParentSect!=null){this.Book.FormattingObj=this.Book.DDDstBox.ParentSect;this.Book.FormattingType=IDREGlb.FRM_SECTION_PERM}else{if(this.Book.DDDstBox.ParentPage!=null){this.Book.FormattingObj=this.Book.DDDstBox.ParentPage;this.Book.FormattingType=IDREGlb.FRM_PAGE}}this.Book.MoveDSEPositions(this.Book.DDDstBox)}};CIDREObj.prototype.SetHTMLValidate=function(a,b){this.Book.PE.BrowserClass=a;this.Book.PE.ValidType=b};CIDREObj.prototype.SetDefaultMasks=function(a,d,c,b){this.CurrencyMsk=a;this.FloatMsk=d;this.DateMsk=c;this.TimeMsk=b};CIDREObj.prototype.RD3RenderDifference=function(c,a,b){return this.Book.RD3RenderDifference(c,a,b)};CIDREObj.prototype.RD3ResendPage=function(a){return(this.Book.PE==null||this.Book.PE.LastRD3Page==null||this.Book.PE.LastRD3Page.PageNum!=a)};CIDREObj.prototype.GetLastRD3Page=function(){if(this.Book.PE!=null&&this.Book.PE.LastRD3Page!=null){return this.Book.PE.LastRD3Page.PageNum}return -1};CIDREObj.prototype.RD3ResetLastPage=function(){if(this.Book.PE!=null){this.Book.PE.LastRD3Page=null;if(this.Book.PE.LastRD3MultiPages!=null){this.Book.PE.LastRD3MultiPages=new Array(this.Book.CacheSize())}}};CIDREObj.prototype.RD3FindSpan=function(a){return this.Book.RD3FindSpan(a)};CIDREObj.prototype.RD3FindBox=function(a){return this.Book.RD3FindBox(a)};CIDREObj.prototype.FindBox=function(a){a=this.GetOldID2NewID(a);if(a==0){return null}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}return b};CIDREObj.prototype.FindSpan=function(c){c=this.GetOldID2NewID(c);if(c==0){return null}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}return b};CIDREObj.prototype.MoveDSEToBox=function(c){var a=c.ParentRptBox.BoxID;if(c.ParentSect!=null){var e=c;if(e.DSEPositions==null){for(var b=0;b<c.ParentSect.BoxList.Count();b++){var d=c.ParentSect.BoxList[b];if(d.DSEPositions!=null){e=d;break}}}if(e.DSEPositions!=null){this.Book.MoveDSEPositions(e)}}return a};CIDREObj.prototype.GetReportByIndex=function(a){a=this.GetOldID2NewID(a);if(a==0){return null}return this.FindObjByID(a)};CIDREObj.prototype.GetRD3ID=function(b){b=this.GetOldID2NewID(b);if(b==0){return""}var c=this.FindObjByID(b);if(c==null){return""}var a=null;if(this.Book.FormattingObj!=null){a=this.Book.GetFormattingObj(c)}if(a==null){return""}if(a instanceof ARptBox){return a.GetRD3Ident()}else{if(a instanceof ARptSpan){return a.GetRD3Ident()}else{if(a instanceof ASection){return a.GetRD3Ident()}else{if(a instanceof ASectionState){return a.GetRD3Ident()}else{return""}}}}};CIDREObj.prototype.AObjectChanged=function(d){if(this.Book.FormattingType!=IDREGlb.FRM_SECTION_PERM){return}var b;var a;if(d instanceof ARptBox){b=d.GetRD3Ident();a=d.GetPage()}else{if(d instanceof ARptSpan){b=d.GetRD3Ident();a=d.Parent.GetPage()}else{if(d instanceof ASection){b=d.GetRD3Ident();a=d.GetPage()}else{return}}}if(a.RD3ChangedObjects==null){a.RD3ChangedObjects=new HashTableSrv()}else{if(a.RD3ChangedObjects[b]!=null){return}}var c=null;if(d instanceof ARptBox){c=new ARptBox();c.CopyFrom(d,false,false)}else{if(d instanceof ARptSpan){c=new ARptSpan();c.CopyFrom(d)}else{if(d instanceof ASection){c=new ASection();c.CopyFrom(d)}}}a.RD3ChangedObjects[b]=c;this.Parent.RD3PageCache.remove(a.PageNum);this.Parent.RD3Changed=true};function CMastro(){this.MastroID=0;this.Parent=null;this.PageType=IDREGlb.MASTRO_PT_CUSTOM;this.Width=0;this.Height=0;this.UM=IDREGlb.BOOKUM_MM;this.Orientation=IDREGlb.MASTRO_OR_PORTRAIT;this.FitMode=IDREGlb.MASTRO_FM_NONE;this.BoxList=new ArrayList()}CMastro.prototype.GetID=function(){return this.MastroID};CMastro.prototype.GetBook=function(){return this.Parent};CMastro.prototype.UBox=function(){return new IDVariant(this.BoxList.Count())};CMastro.prototype.bBox=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.BoxList.Count()?null:this.BoxList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.Parent.FindObjByID(this.Parent.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CMastro.prototype.SetRect=function(a,b){switch(a){case IDREGlb.RECT_WIDTH:this.Width=this.Parent.ConvertToInternalValue(b);break;case IDREGlb.RECT_HEIGHT:this.Height=this.Parent.ConvertToInternalValue(b);break}};CMastro.prototype.GetRect=function(a){switch(a){case IDREGlb.RECT_WIDTH:return this.Parent.ConvertFromInternalValue(this.Width);case IDREGlb.RECT_HEIGHT:return this.Parent.ConvertFromInternalValue(this.Height)}return 0};CMastro.prototype.IsChildOf=function(d){if(d==this){return true}for(var a=0;a<this.BoxList.Count();a++){var e=this.BoxList[a];if(e==d){return true}for(var f=0;f<e.SpanList.Count();f++){var c=e.SpanList[f];if(c==d){return true}}}return false};function CPEBase(){this.ZoomLevel=100;this.Device=IDREGlb.DEV_NONE;this.Parent=null;this.PrintingPage=null;this.RefreshSpanDiv=false;this.SpanDivMap=new HashTableSrv();this.CanScroll=false;this.AbsPosition=true;this.LastRD3Page=null;this.CacheSize=1;this.LastRD3MultiPages=null}CPEBase.prototype.StartDocument=function(){return true};CPEBase.prototype.EndDocument=function(){return true};CPEBase.prototype.PrintPage=function(a){this.PrintingPage=a};CPEBase.prototype.DeleteAllSpanDiv=function(){this.SpanDivMap.clear();if(this.PrintingPage!=null){for(var a=0;a<this.PrintingPage.MastroBoxes.Count();a++){this.PrintingPage.MastroBoxes[a].DeleteAllSpanDiv()}for(var d=0;d<this.PrintingPage.Sections.Count();d++){var c=this.PrintingPage.Sections[d];for(var a=0;a<c.BoxList.Count();a++){c.BoxList[a].DeleteAllSpanDiv()}}}};CPEBase.prototype.CreateAllSpanDiv=function(){this.DeleteAllSpanDiv();for(var a=0;a<this.PrintingPage.MastroBoxes.Count();a++){this.PrintingPage.MastroBoxes[a].CreateAllSpanDiv(this,this.SpanDivMap)}for(var d=0;d<this.PrintingPage.Sections.Count();d++){var c=this.PrintingPage.Sections[d];if(!c.GetFlag(IDREGlb.FL_SECT_VISIBLE)){continue}for(var a=0;a<c.BoxList.Count();a++){c.BoxList[a].CreateAllSpanDiv(this,this.SpanDivMap)}}};CPEBase.prototype.RenderPage=function(){if(this.PrintingPage!=null){for(var c=0;c<this.PrintingPage.MastroBoxes.Count();c++){var a=this.PrintingPage.MastroBoxes[c];if(a.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){this.PrintBox(a);var e=null;for(var f=0;f<this.PrintingPage.Sections.Count();f++){var j=this.PrintingPage.Sections[f];if(j.MastroBox!=a){continue}if(!j.GetFlag(IDREGlb.FL_SECT_VISIBLE)){continue}var h=j.GetAsARptBox();if(this.AbsPosition){h.XPos+=j.MastroBox.XPos;h.YPos+=j.MastroBox.YPos}var d=true;if(j.GetFlag(IDREGlb.FL_SECT_OVERLAY)){if(e==null){e=h}else{d=false}}else{if(e!=null){this.PrintBoxEnd(e);e=null}}if(d){this.PrintBox(h)}for(var k=0;k<j.BoxList.Count();k++){var g=j.BoxList[k];if(!g.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){continue}if(this.AbsPosition){g.XPos+=j.MastroBox.XPos+j.XPos;g.YPos+=j.MastroBox.YPos+j.YPos;if(g.Rotation==0&&(g.XPos<0||g.XPos>j.MastroBox.XPos+j.XPos+j.MastroBox.Width||g.YPos<0||g.YPos>j.MastroBox.YPos+j.YPos+j.MastroBox.Height)){continue}}else{if(g.Rotation==0&&(g.XPos<0||g.XPos>j.MastroBox.Width||g.YPos<0||g.YPos>j.MastroBox.Height)){continue}}this.PrintBox(g);this.PrintBoxEnd(g);if(this.AbsPosition){g.XPos-=j.MastroBox.XPos+j.XPos;g.YPos-=j.MastroBox.YPos+j.YPos}}if(d&&e==null){this.PrintBoxEnd(h)}h=null}if(e!=null){this.PrintBoxEnd(e);e=null}this.PrintBoxEnd(a)}}}else{this.RenderEmptyPage()}return true};CPEBase.prototype.Reset=function(){this.PrintingPage=null};CPEBase.prototype.RenderEmptyPage=function(){};CPEBase.prototype.PrintBox=function(d){if(d.SubSections!=null){for(var e=0;e<d.SubSections.Count();e++){var f=d.SubSections[e];if(f.MastroBox!=d){continue}if(!f.GetFlag(IDREGlb.FL_SECT_VISIBLE)){continue}var c=f.GetAsARptBox();if(this.AbsPosition){c.XPos+=f.MastroBox.XPos;c.YPos+=f.MastroBox.YPos}this.PrintBox(c);for(var a=0;a<f.BoxList.Count();a++){var g=f.BoxList[a];if(!g.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){continue}if(this.AbsPosition){g.XPos+=f.MastroBox.XPos+f.XPos;g.YPos+=f.MastroBox.YPos+f.YPos;if(g.Rotation==0&&(g.XPos<0||g.XPos>f.MastroBox.XPos+f.XPos+f.MastroBox.Width||g.YPos<0||g.YPos>f.MastroBox.YPos+f.YPos+f.MastroBox.Height)){continue}}else{if(g.Rotation==0&&(g.XPos<0||g.XPos>f.MastroBox.Width||g.YPos<0||g.YPos>f.MastroBox.Height)){continue}}this.PrintBox(g);this.PrintBoxEnd(g);if(this.AbsPosition){g.XPos-=f.MastroBox.XPos+f.XPos;g.YPos-=f.MastroBox.YPos+f.YPos}}this.PrintBoxEnd(c);c=null}}};CPEBase.prototype.PrintBoxEnd=function(a){};CPEBase.prototype.SetZoomLevel=function(a){this.ZoomLevel=a};CPEBase.prototype.ProcessRequest=function(a,b){return true};CPEBase.prototype.GetPageSize=function(){return{Width:0,Height:0}};CPEBase.prototype.GetBorderSize=function(){return 1/96*72*4};CPEBase.prototype.PrepareDivList=function(S){if(!S.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){return null}if(S.Spans.Count()==0){return null}var F=new ArrayList();var g=S.GetRect();var s=new IDVariant(0);var E=new IDVariant(0);var B=new IDVariant(0);var I=new IDVariant(0);if(S.ImageIdx==0){S.GetPaddings(s,E,B,I)}g.Deflate(E.intValue(),s.intValue(),I.intValue(),B.intValue());var b=this.Parent.VisualStyleList.Alignment(S.VisAttrIdx,1);var R=0;var d=0;for(var r=0;r<S.Spans.Count();r++){var u=S.Spans[r];if(u==null){continue}if(u.Image!=null&&!u.Image.IsEmpty()){continue}if(!u.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){continue}var X=u.ValueList;if(X==null){X=u.ParentRptSpan.ValueList}if(X!=null&&X.Count()>0&&b==IDREGlb.VISALN_AUTO){b=IDREGlb.VISALN_SX}if(u.ValueSourceIdx!=-1&&(this.Parent.VisualStyleList.Flags(u.VisAttrIdx)&IDREGlb.FL_VIS_SHOWIMAGE)!=0){var j=100;if(this.Parent.UM==IDREGlb.BOOKUM_INCH){j=254}var G=X[u.ValueSourceIdx];if(G!=null&&G.ImagePath.length>0){if(G.Image.ServletImage()==null){G.Image.LoadServletImage(Glb.ToAbsolutePath(this.Parent.MainFrm,CBook.AdaptWebFileName(G.ImagePath)))}}R+=this.FromPointsToPhysical(G.Image.width()/96*72)+j}if(this.Device==IDREGlb.DEV_PDF&&u.Text.length>0&&u.ParentRptSpan.FldIdx!=-1&&u.ParentRptSpan.DataType==IDREGlb.DT_DOC_OLE&&u.MimeType.length>0){var P=u.MimeType;if(P.indexOf("/")!=-1){P=P.substr(0,P.indexOf("/"))}if(P=="image"&&u.Image.IsEmpty()){u.Image.LoadServletImage(Glb.ToAbsolutePath(this.Parent.MainFrm,u.Text));continue}else{if(P=="text"){try{var m=this.Parent.Parent.Parent.Parent.MainFrm;u.Text="";var a=m.VBFile.FreeFile();m.VBFile.OpenForInput(new IDVariant(Glb.ToAbsolutePath(this.Parent.MainFrm,u.Text)),a);while(!m.VBFile.EOF(a)){u.Text+=m.VBFile.ReadLine(a).stringValue()}m.VBFile.Close(a);u.MimeType=""}catch(V){}}else{if(P!=""){this.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.Parent.GetRTCGuid(0),625,"CPEBase.PrepareDivList","Span mime type not supported. Skip formatting... (Mimetype = "+u.MimeType+")");continue}}}}var O=this.Parent.VisualStyleList.Font(u.VisAttrIdx,IDREGlb.VISFNT_VALUE,u.FontMod,(this.Parent.MultiplePE==this?2:1));var T=this.FromPointsToPhysical(O.Height);var o=this.FromPointsToPhysical(O.Ascent);var K=this.FromPointsToPhysical(O.LineGap);var W=F.length;var y=u.Text;y=y.Replace("\r\n","\n");y=y.Replace("\r","\n");while(y.length>0){var z=y.indexOf("\n");var k=y;if(z!=-1){if(z==0){k="";y=y.substr(1)}else{k=y.substr(0,z+1);y=y.substr(z+1)}}else{y=""}if(k==""&&z!=-1&&F.Count()>0){var Q=new CSpanDiv();Q.Span=u;Q.Point=new Object();Q.Point.X=0;Q.Point.Y=0;Q.Riga=d;Q.Text="";var c=F[F.Count()-1];Q.TextHeight=c.TextHeight;Q.TextAscent=c.TextAscent;Q.TextLineGap=c.TextLineGap;F.Add(Q);d++;R=0;continue}while(k.length>0){var Q=new CSpanDiv();Q.Span=u;O.GetCharacterPlacement(k,k.length,Q.CharPos,this);var N;while(true){var C=0;for(N=0;N<k.length;N++){if(k.charAt(N)!="\r"&&k.charAt(N)!="\n"){C+=Q.CharPos[N]}if(C>g.width-R){break}}if(N<k.length){var U;for(U=N-1;U>=0;U--){if(this.IsWordBreak(k.charAt(U))){break}}if(U<0){if(R==0){U=N-1}else{d++;R=0;continue}}N=U+1}break}if(N==0){N=1}Q.Point={X:R,Y:0};Q.Riga=d;Q.Text=k.substr(0,N);Q.TextHeight=T;Q.TextAscent=o;Q.TextLineGap=K;if(k.length>0){k=k.substr(N)}k=k.trimLeft();Q.TextWidth=0;for(var U=0;U<N;U++){if(Q.Text.charAt(U)!="\r"&&Q.Text.charAt(U)!="\n"){Q.TextWidth=(Q.TextWidth+Q.CharPos[U])}}R+=Q.TextWidth;F.Add(Q)}if(z!=-1&&R!=0){R=0;d++}}if(F.length==W&&u.ValueSourceIdx!=-1){var Q=new CSpanDiv();Q.Span=u;Q.Point={X:0,Y:0};Q.Riga=d;Q.Text="";if(F.length>0){var c=F[F.length-1];Q.TextHeight=c.TextHeight;Q.TextAscent=c.TextAscent;Q.TextLineGap=c.TextLineGap}else{if(u.Parent!=null&&u.Parent.ParentRptBox!=null){Q.TextHeight=u.Parent.ParentRptBox.FontHeight;Q.TextAscent=u.Parent.ParentRptBox.FontHeight;Q.TextLineGap=0}else{Q.TextHeight=S.Height;Q.TextAscent=S.Height;Q.TextLineGap=0}}F.Add(Q)}}if(b==IDREGlb.VISALN_AUTO){b=IDREGlb.VISALN_SX;if(S.Spans.Count()==1&&S.Spans[0]!=null&&IDREGlb.ClassDT(S.Spans[0].ParentRptSpan.DataType)==IDREGlb.DTC_NUMBER){b=IDREGlb.VISALN_DX;var A=S.Spans[0];if((A.ValueList!=null&&A.ValueList.Count()>0)||A.ParentRptSpan.ValueList.Count()>0){b=IDREGlb.VISALN_SX}}}if(S.Alignment!=IDREGlb.VISALN_AUTO){b=S.Alignment}var f=Math.floor(S.Interline*25.4*100/72);if(this.Parent.UM==IDREGlb.BOOKUM_INCH){f=Math.floor(f*2.54)}d=0;var q=new IDVariant(0);for(var H=0;H<F.Count();H++){var v=F[H];if(v.Riga!=d){this.ProcessLine(F,g.width,d,q,b,f);d=v.Riga}}this.ProcessLine(F,g.width,d,q,b,f);for(var H=0;H<F.Count();H++){var v=F[H];if(v.Riga==1&&v.Point.Y+v.TextHeight-v.TextAscent>S.Height&&S.VRsz!=IDREGlb.RSZ_STRETCH){var M=-999;for(H=0;H<F.Count();H++){v=F[H];v.Riga=0;if(M==-999){M=v.Point.X}else{v.Point.X=M}v.JustSpace=0;if(v.DelSpaces!=0){for(var U=0;U<v.DelSpaces;U++){v.Text+=" "}v.TextWidth+=v.DelSpacesWidth}M+=v.TextWidth}q.set(new IDVariant(0));d=0;this.ProcessLine(F,g.width,d,q,b,f);break}}if(b==IDREGlb.VISALN_JX){for(var H=0;H<F.Count();H++){var v=F[H];if(v.Riga==d){if(v.Span.IsLastLineOfParagraph()){for(var h=0;h<F.Count();h++){var J=F[h];if(J.Riga==d&&J.Point.X>v.Point.X){J.Point.X-=v.JustSpace}}v.JustSpace=0}}}}var l=S.VAlignment;if(l!=IDREGlb.VISVALN_TOP&&F.Count()!=0){var n=F[0];var t=F[F.Count()-1];var L=t.Point.Y-t.TextAscent+t.TextHeight-(n.Point.Y-n.TextAscent);var D=0;if(l==IDREGlb.VISVALN_CENTER){D=(g.height-L)/2}else{if(l==IDREGlb.VISVALN_BOTTOM){D=g.height-L}}if(D>0){for(var H=0;H<F.Count();H++){var v=F[H];v.Point.Y+=D}}}return F};CPEBase.prototype.ProcessLine=function(g,k,b,j,m,c){var e=0;var n=0;var t=0;var a=null;for(var h=0;h<g.Count();h++){var s=g[h];if(s.Riga==b){e=Math.max(e,s.TextHeight);n=Math.max(n,s.TextAscent);t+=s.TextWidth;a=s}}if(a!=null&&a.Text.length>0&&a.Text.charAt(a.Text.length-1)==" "){var d=a.Text.length;a.Text=a.Text.trimRight();var o=a.TextWidth;a.TextWidth=0;for(var r=0;r<a.Text.length;r++){if(a.Text.charAt(r)!="\r"&&a.Text.charAt(r)!="\n"){a.TextWidth=a.TextWidth+a.CharPos[r]}}t-=o-a.TextWidth;a.DelSpaces=d-a.Text.length;a.DelSpacesWidth=o-a.TextWidth}if(m==IDREGlb.VISALN_JX&&a!=null&&a.Text.length>0&&a.Text.charAt(a.Text.Length-1)=="\n"){m=IDREGlb.VISALN_SX}if(m==IDREGlb.VISALN_JX&&t>0){for(var h=0;h<g.Count();h++){var s=g[h];if(s.Riga==b){s.JustSpace=k*s.TextWidth/t;for(var r=s.Text.length-1;r>=0;r--){if(s.Text.charAt(r)!="\r"&&s.Text.charAt(r)!="\n"){s.JustSpace-=s.CharPos[r]}}for(var f=0;f<g.Count();f++){var q=g[f];if(q.Riga==b&&q.Point.X>s.Point.X){q.Point.X+=s.JustSpace}}}}}if(c>0){j.set(new IDVariant(j.intValue()+c))}else{j.set(new IDVariant(j.intValue()+(b==0?n:e)))}var l=this.GetOffsetAlign(k,m,t);if(l<0){l=0}for(var h=0;h<g.Count();h++){var s=g[h];if(s.Riga==b){s.Point.Y=j.intValue();s.Point.X+=l}}};CPEBase.prototype.GetOffsetAlign=function(c,a,b){switch(a){case IDREGlb.VISALN_SX:return 0;case IDREGlb.VISALN_CX:return(c-b)/2;case IDREGlb.VISALN_DX:return c-b}return 0};CPEBase.prototype.IsWordBreak=function(a){if(a==" "){return true}if(a=="-"){if(this.Parent.MainFrm instanceof WebEntryPointSrv&&this.Parent.MainFrm.BrowserClass==Glb.BRWCLS_FIREFOX){return false}return true}return false};CPEBase.prototype.FromPhysicalToPoints=function(a){var b=(this.Parent.UM==IDREGlb.BOOKUM_MM?a/100/25.4:a/1000);return b*72};CPEBase.prototype.FromPointsToPhysical=function(a){var b=a/72;if(this.Parent.UM==IDREGlb.BOOKUM_MM){return Math.floor(b*25.4*100)}else{return Math.floor(b*1000)}};CPEBase.prototype.RemoveEOLandLF=function(a){a.Replace("\r","\n");var b=a.indexOf("\n");while(b!=-1){a=a.remove(b,1);b=a.indexOf("\n")}return a};CPEBase.prototype.HandleStretch=function(y,s,e,a,f,l,n,c,m,d,o,q){if(y==IDREGlb.STRTC_FILL){return}if(y==IDREGlb.STRTC_NONE&&this instanceof CPEHTML){o.set(new IDVariant(-1));q.set(new IDVariant(-1));return}var k=false;if(e==null&&a.length>0){try{if(a.startsWith("$SHELL")){a=a.substring(6)}if(a[0]=="/"){a=a.substring(1)}var z=IDL.LoadFile(RD4_WebEntryPoint.GetAppUrl(false)+a);var t=new Uint8Array(z);e=PdfDocument.AddImage(t,t.length)}catch(x){this.Parent.MainFrm.getDTTObj().AddException(this.Parent.Parent.Parent.iGuid,"CPEBase::HandleStretch","Book "+this.Parent.Parent.GetObjName(0)+"': Error while loading image",x);return}k=true}if(e==null){return}var g=e.Width;var u=e.Height;var r=u/g;if(y==IDREGlb.STRTC_NONE&&this instanceof CPEPDF){o.set(new IDVariant(m.dblValue()+(g/96*72)));q.set(new IDVariant(d.dblValue()+(u/96*72)*-1));return}var v=(n-f)*r;var j=(c-l)/r*(this instanceof CPEPDF?-1:1);if(v>(c-l)*(this instanceof CPEPDF?-1:1)){if(y==IDREGlb.STRTC_ENLARGE){o.set(new IDVariant(m.dblValue()+j));var b=((n-f)-(o.dblValue()-m.dblValue()))/2;m.set(new IDVariant(m.dblValue()+b));o.set(new IDVariant(o.dblValue()+b))}else{if(y==IDREGlb.STRTC_CROP){q.set(new IDVariant(d.dblValue()+v));var b=((c-l)-(q.dblValue()-d.dblValue()))/2;d.set(new IDVariant(d.dblValue()+b));q.set(new IDVariant(q.dblValue()+b))}}}else{if(y==IDREGlb.STRTC_ENLARGE){q.set(new IDVariant(d.dblValue()+v));var b=((c-l)-(q.dblValue()-d.dblValue()))/2;d.set(new IDVariant(d.dblValue()+b));q.set(new IDVariant(q.dblValue()+b))}else{if(y==IDREGlb.STRTC_CROP){o.set(new IDVariant(m.dblValue()+j));var b=((n-f)-(o.dblValue()-m.dblValue()))/2;m.set(new IDVariant(m.dblValue()+b));o.set(new IDVariant(o.dblValue()+b))}}}if(k){e=null}};CPEBase.prototype.RD3RenderDifference=function(b,g,n){var l=false;if(this.CacheSize!=1){if(this.PrintingPage!=null){var o=new IDVariant(0);var k=new IDVariant(0);this.Parent.GetPageIntervals(this.PrintingPage.PageNum,o,k);var a=o.intValue()-1;var m=k.intValue()-1;if(m>=this.Parent.PagesList.Count()){m=this.Parent.PagesList.Count()-1}var f=this.LastRD3MultiPages;this.LastRD3MultiPages=new Array(f.length);for(var e=a;e<=m;e++){var h=this.Parent.PagesList[e];if(h!=null){this.LastRD3MultiPages[e-a]=h;if(this.Parent.Parent.Parent.RD3PageCache.containsKey(h.PageNum)){continue}var q=null;if(!n){for(var d=0;d<f.length&&q==null;d++){if(f[d]!=null&&f[d].PageNum==h.PageNum){q=f[d]}}}if(q==null){if(h.RD3RenderDifference(b,true,null)){l=true}}else{l|=h.RD3RenderDifference(g,false,q)}this.Parent.Parent.Parent.RD3PageCache[h.PageNum]=true}}}else{this.LastRD3MultiPages=new Array(this.CacheSize)}}else{if(this.PrintingPage!=null){var c=(n?b:g);l=this.PrintingPage.RD3RenderDifference(c,n,this.LastRD3Page)}}this.LastRD3Page=this.PrintingPage;return l};CPEBase.prototype.RD3FindSpan=function(a){return this.PrintingPage.RD3FindSpan(a)};CPEBase.prototype.RD3FindBox=function(a){return this.PrintingPage.RD3FindBox(a)};function CPEHTML(){CPEBase.call(this);this.Width=0;this.Height=0;this.DivFactor=100;this.UMstr="mm";this.HTMLBuffer="";this.MainFrm;this.RespWriter=null;this.BrowserClass=IDREGlb.BRWCLS_IENORMAL;this.ValidType=IDREGlb.WEBVALID_NONE;this.nf=null;this.CanScroll=true;this.AbsPosition=false}CPEHTML.prototype=new CPEBase();for(var i=0;i<Object.keys(CPEBase).length;i++){var obj=Object.keys(CPEBase)[i];CPEHTML[obj]=CPEBase[obj]}CPEHTML.prototype.PrintPage=function(a){if(this.Parent.PrintDestination==IDREGlb.PRN_SCREEN){this.Parent.Parent.Fire_OnPreview()}this.Parent.Parent.set_RD(true);CPEBase.prototype.PrintPage.call(this,a)};CPEHTML.prototype.RenderPage=function(){return true};CPEHTML.prototype.PrintBox=function(a){CPEBase.prototype.PrintBox.call(this,a)};CPEHTML.prototype.PrintBoxEnd=function(a){};CPEHTML.prototype.ProcessRequest=function(c,d){if(this.PrintingPage!=null){for(var a=0;a<this.PrintingPage.MastroBoxes.Count();a++){var f=this.PrintingPage.MastroBoxes[a];if(f.ProcessRequest(c,this.Parent,d)){return true}}for(var g=0;this.PrintingPage.Sections.Count();g++){var e=this.PrintingPage.Sections[g];for(var a=0;a<e.BoxList.Count();a++){var f=e.BoxList[a];if(f.ProcessRequest(c,this.Parent,d)){return true}}}}return false};CPEHTML.prototype.GetPageSize=function(){var a=new Object();a.Width=this.Width;a.Height=this.Height;return a};CPEHTML.prototype.HTMLEncode=function(b,a){if(a==undefined){a=false}return Glb.HTMLEncode(b,a)};CPEHTML.prototype.RenderCombo=function(b,a,c){};CPEHTML.prototype.RenderOption=function(b,a,c){};CPEHTML.prototype.RenderCheck=function(b,a,c){};CPEHTML.prototype.WriteHTML=function(a){this.HTMLBuffer+=a};function CPEPDF(){CPEBase.call(this);this.MyPDF=new PdfDocument();this.PDFFileName="";this.PageSizeX;this.PageSizeY;this.IsFirstPage=true;this.MyPDF.SetPreference(PdfDocument.VP_FITWINDOW)}CPEPDF.prototype=new CPEBase();for(var i=0;i<Object.keys(CPEBase).length;i++){var obj=Object.keys(CPEBase)[i];CPEPDF[obj]=CPEBase[obj]}CPEPDF.prototype.StartDocument=function(){if(this.Parent.IsPrecounting){return true}this.MyPDF.SetDocumentInfo(PdfDocument.DI_TITLE,this.Parent.Name);this.MyPDF.SetDocumentInfo(PdfDocument.DI_PRODUCER,"IDRE Pro-Gamma");var d=this.Parent.PDFDocInfo.GetKeys();for(var c=0;c<d.Size();c++){var b=d.get_Value(new IDVariant(c)).stringValue();var a=this.Parent.PDFDocInfo.get_Value(new IDVariant(b)).stringValue();if(b.equals("TITLE")){this.MyPDF.SetDocumentInfo(PdfDocument.DI_TITLE,a)}else{if(b.equals("AUTHOR")){this.MyPDF.SetDocumentInfo(PdfDocument.DI_AUTHOR,a)}else{if(b.equals("SUBJECT")){this.MyPDF.SetDocumentInfo(PdfDocument.DI_SUBJECT,a)}else{if(b.equals("KEYWORDS")){this.MyPDF.SetDocumentInfo(PdfDocument.DI_KEYWORDS,a)}else{if(b.equals("CREATOR")){this.MyPDF.SetDocumentInfo(PdfDocument.DI_CREATOR,a)}else{if(b.equals("PRODUCER")){this.MyPDF.SetDocumentInfo(PdfDocument.DI_PRODUCER,a)}else{this.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.Parent.GetRTCGuid(0),625,"CPEPDF.StartDocument","Wrong PDF Document Info value: "+b)}}}}}}}this.Parent.VisualStyleList.ResetFonts(this.Parent.MultiplePE==this?2:1);this.IsFirstPage=true;if(this.Parent.MultiplePE!=null){this.Parent.MultiplePE.IsFirstPage=true}return true};CPEPDF.prototype.PrintPage=function(a){CPEBase.prototype.PrintPage.call(this,a);this.CreateAllSpanDiv();if(a.Orientation==IDREGlb.MASTRO_OR_PORTRAIT){this.PageSizeX=this.FromPhysicalToPoints(a.Width);this.PageSizeY=this.FromPhysicalToPoints(a.Height)}else{this.PageSizeX=this.FromPhysicalToPoints(a.Height);this.PageSizeY=this.FromPhysicalToPoints(a.Width)}this.MyPDF.AddPage(this.PageSizeX,this.PageSizeY);if(this.Parent.MultiplePE==this&&this.Parent.Bookmark!=null&&this.Parent.Bookmark.length>0&&this.IsFirstPage){this.MyPDF.AddOutline(this.Parent.Bookmark)}this.RenderPage();this.DeleteAllSpanDiv();this.IsFirstPage=false};CPEPDF.prototype.EndDocument=function(){if(this.Parent.IsPrecounting){return true}if(this.PDFFileName.length==0){this.PDFFileName=this.Parent.Name+".pdf";this.Parent.WebFileName="temp/"+this.PDFFileName;this.Parent.OutputFileName=this.Parent.GetTempDir()+"/"+this.PDFFileName}else{this.Parent.OutputFileName=this.PDFFileName;this.Parent.WebFileName=this.PDFFileName;var c=this.Parent.WebFileName.toUpperCase();var h=this.Parent.GetTempDir().toUpperCase()+"/";c=c.replace(/\\/g,"/");h=h.replace(/\\/g,"/");if(c.startsWith(h)){this.Parent.WebFileName="temp/"+this.Parent.WebFileName.substr(h.length)}}var f={data:""};if(this.MyPDF.Save(this.Parent.OutputFileName,f)==0){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("SAVEFILE",{CONTENT:btoa(f.data),FILENAME:this.Parent.OutputFileName});if(a!="OK"){throw new Error(a)}}else{var b=new Uint8Array(f.data.length);for(var g=0;g<f.data.length;g++){b[g]=f.data.charCodeAt(g)}var e=new BlobBuilder();e.append(b.buffer);var d=e.getBlob("application/pdf");this.Parent.WebFileName=URL.createObjectURL(d)}return true}return false};CPEPDF.prototype.PrintBox=function(ac){var L=this.FromPhysicalToPoints(ac.XPos);var Z=this.FromPhysicalToPoints(ac.YPos);var ag=this.FromPhysicalToPoints(ac.XPos+ac.Width);var O=this.FromPhysicalToPoints(ac.YPos+ac.Height);if(ac.ParentSect!=null&&ac.ParentRptBox!=null){var G=new CRect(0,0,0,0);G.setLeft(ac.ParentSect.MastroBox.XPos+ac.ParentSect.XPos);G.setRight(G.left()+ac.ParentSect.MastroBox.Width);G.setTop(ac.ParentSect.MastroBox.YPos+ac.ParentSect.YPos);G.setBottom(G.top()+ac.ParentSect.Height);if(ac.ParentSect.NumCol>1){G.setRight(G.left()+(ac.ParentSect.MastroBox.Width-(ac.ParentSect.NumCol-1)*ac.ParentSect.ColSpace)/ac.ParentSect.NumCol)}if(ac.Rotation==0){var aa=ac.GetRect();if(G.top()>aa.top()){Z=this.FromPhysicalToPoints(G.top())}if(G.bottom()<aa.bottom()){O=this.FromPhysicalToPoints(G.bottom())}if(G.left()>aa.left()){L=this.FromPhysicalToPoints(G.left())}if(G.right()<aa.right()){ag=this.FromPhysicalToPoints(G.right())}}if(L>=ag||Z>=O){return}}Z=this.PageSizeY-Z;O=this.PageSizeY-O;var o=new IDVariant(0);var B=new IDVariant(0);var x=new IDVariant(0);var N=new IDVariant(0);ac.GetPaddings(o,B,x,N,this);if(ac.ImageIdx!=0||ac.GraphFile!=null){var af=this.Parent.VisualStyleList.BorderType(ac.VisAttrIdx,IDREGlb.VISBDI_VALUE);if(af!=IDREGlb.VISBRD_CUSTOM){this.Parent.VisualStyleList.GetBorderWidths(ac.VisAttrIdx,o,B,x,N,this.Parent.UM,this)}}var A=this.Parent.VisualStyleList.Color(ac.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);var n=this.Parent.VisualStyleList.GradCol(ac.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);var Q=this.Parent.VisualStyleList.GradDir(ac.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);var s=this.Parent.VisualStyleList.Opacity(ac.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);if(ac.ParentSect!=null&&ac.ParentSect.ParentSection.SectType==IDREGlb.SECT_DETAIL&&ac.ParentSect.DSEPosition%2==0){var V=this.Parent.VisualStyleList.Color(ac.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE);var y=this.Parent.VisualStyleList.GradCol(ac.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE);var F=this.Parent.VisualStyleList.GradDir(ac.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE);var m=this.Parent.VisualStyleList.Opacity(ac.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE);if(V!=IDREGlb.CLR_NONE){A=V;if(y!=IDREGlb.CLR_NONE){n=y;Q=F}else{if(m<100){s=m}}}}if(ac.GetBackColor()!=-1){A=ac.GetBackColor();Q=-2;s=100}if(ac.Rotation!=0){this.MyPDF.SetRotation(ac.Rotation,L+(ag-L)/2,O+(Z-O)/2)}if(A!=IDREGlb.CLR_NONE){if(n!=IDREGlb.CLR_NONE){if(Q==IDREGlb.VISGRADDIR_HORIZ){this.MyPDF.SetFillGradient(L,(Z+O)/2,ag,(Z+O)/2,A,n)}else{this.MyPDF.SetFillGradient((L+ag)/2,Z,(L+ag)/2,O,A,n)}}else{this.MyPDF.SetFillColor(A&255,(A&65280)>>8,(A&16711680)>>16)}this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(L,O,ag-L,Z-O,true,s);if(n!=IDREGlb.CLR_NONE){this.MyPDF.CloseFillGradient()}}this.DrawBorder(ac.VisAttrIdx,L,Z,ag,O);if(ac.ImageIdx!=0||ac.GraphFile!=null){if(ac.ImageIdx==0||(this.Parent.ImagesPath.Count()>=Math.abs(ac.ImageIdx)&&this.Parent.ImagesPath[Math.abs(ac.ImageIdx)-1]!=null)){var ae;if(ac.ImageIdx!=0){ae=Glb.ToAbsolutePath(this.Parent.MainFrm,CBook.AdaptWebFileName(this.Parent.ImagesPath[Math.abs(ac.ImageIdx)-1]))}else{ae=ac.GraphFile}if(ae.length>0){var j=new IDVariant(L,IDVariant.FLOAT);var R=new IDVariant(ag,IDVariant.FLOAT);var c=new IDVariant(Z,IDVariant.FLOAT);var t=new IDVariant(O,IDVariant.FLOAT);var C=new CFloatRect(j.dblValue(),t.dblValue(),R.dblValue(),c.dblValue());this.HandleStretch(ac.GetStretch(this),ac,null,ae,L,Z,ag,O,j,c,R,t);this.MyPDF.AddImage(ae,j.dblValue(),c.dblValue(),R.dblValue()-j.dblValue(),t.dblValue()-c.dblValue(),-9999,C)}}}for(var l=0;l<ac.Spans.Count();l++){var v=ac.Spans[l];if(v==null||!v.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){continue}if(v.Image.ServletImage()!=null){var af=this.Parent.VisualStyleList.BorderType(ac.VisAttrIdx,IDREGlb.VISBDI_VALUE);if(af!=IDREGlb.VISBRD_CUSTOM){this.Parent.VisualStyleList.GetBorderWidths(ac.VisAttrIdx,o,B,x,N,this.Parent.UM,this)}var j=new IDVariant(L+this.FromPhysicalToPoints(B.intValue()),IDVariant.FLOAT);var R=new IDVariant(ag-this.FromPhysicalToPoints(N.intValue()),IDVariant.FLOAT);var c=new IDVariant(Z-this.FromPhysicalToPoints(o.intValue()),IDVariant.FLOAT);var t=new IDVariant(O+this.FromPhysicalToPoints(x.intValue()),IDVariant.FLOAT);var C=new CFloatRect(j.dblValue(),t.dblValue(),R.dblValue(),c.dblValue());this.HandleStretch(v.GetStretch(this),ac,v.Image.ServletImage(),"",L,Z,ag,O,j,c,R,t);if(v.Text.length>0&&v.Text.indexOf("data:")==-1){this.MyPDF.AddImage(Glb.ToAbsolutePath(this.Parent.MainFrm,v.Text),j.dblValue(),c.dblValue(),R.dblValue()-j.dblValue(),t.dblValue()-c.dblValue(),-9999,C)}else{this.MyPDF.AddImage(v.Image.ServletImage(),j.dblValue(),c.dblValue(),R.dblValue()-j.dblValue(),t.dblValue()-c.dblValue(),C)}}var P=this.Parent.VisualStyleList.ControlType(v.VisAttrIdx);var ai=v.ValueList;if(ai==null){ai=v.ParentRptSpan.ValueList}if(ai!=null&&ai.Count()!=0){var f=this.Parent.VisualStyleList.Color(v.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);if(ac.ParentSect!=null&&ac.ParentSect.ParentSection.SectType==IDREGlb.SECT_DETAIL&&ac.ParentSect.DSEPosition%2==0){f=this.Parent.VisualStyleList.Color(v.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE)}if(v.BackColor!=-1){f=v.BackColor}if(f==A){f=IDREGlb.CLR_NONE}if(P==IDREGlb.VISCTRL_OPTION){this.RenderOption(v,f,L,Z,ag,O,B.intValue(),o.intValue(),N.intValue(),x.intValue());return}else{if(P==IDREGlb.VISCTRL_CHECK){this.RenderCheck(v,f,L,Z,ag,O,B.intValue(),o.intValue(),N.intValue(),x.intValue());return}else{if(P==IDREGlb.VISCTRL_COMBO||P==IDREGlb.VISCTRL_AUTO||P==IDREGlb.VISCTRL_EDIT){if(f!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(f&255,(f&65280)>>8,(f&16711680)>>16);this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(L,Z,ag-L,O-Z,true)}this.DrawBorder(v.VisAttrIdx,L,Z,ag,O)}}}}}var I=ac.SpanDivList;if(I==null&&ac.ParentRptBox){I=this.SpanDivMap[ac.HashCode]}if(I!=null){var J=new ArrayList();for(var M=0;M<I.Count();M++){var g=I[M];if((g.Text.length==0&&g.Span.ValueSourceIdx==-1)||!g.Span.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){continue}var q=Z-this.FromPhysicalToPoints(g.Point.Y);if(q<O){continue}if(g.Span.MimeType.length>0){var X=g.Span.MimeType;if(X.indexOf("/")!=-1){X=X.substr(0,X.indexOf("/"))}if(X!="image"&&X!="text"){continue}}if(g.Span.ValueSourceIdx!=-1&&(this.Parent.VisualStyleList.Flags(g.Span.VisAttrIdx)&IDREGlb.FL_VIS_SHOWIMAGE)!=0&&J.IndexOf(g.Span)==-1){var ai=g.Span.ValueList;if(ai==null){ai=g.Span.ParentRptSpan.ValueList}var K=ai[g.Span.ValueSourceIdx];if(K!=null&&K.Image.ServletImage()==null&&K.ImagePath.length>0){K.Image.LoadServletImage(Glb.ToAbsolutePath(this.Parent.MainFrm,CBook.AdaptWebFileName(K.ImagePath)))}if(K.Image.ServletImage()!=null){var ad=this.FromPointsToPhysical(K.Image.height()*72/96);var U=this.FromPointsToPhysical(K.Image.width()*72/96);var d=100;if(this.Parent.UM==IDREGlb.BOOKUM_INCH){d=254}var j=g.Point.X+ac.XPos-U-d+B.intValue();var c=g.Point.Y+ac.YPos-g.TextAscent+(g.TextHeight-ad)/2;if(j<ac.XPos){j=ac.XPos}var R=j+U;var t=c+ad;j=this.FromPhysicalToPoints(Math.floor(j));R=this.FromPhysicalToPoints(Math.floor(R));c=this.PageSizeY-this.FromPhysicalToPoints(Math.floor(c));t=this.PageSizeY-this.FromPhysicalToPoints(Math.floor(t));var ae=ai[g.Span.ValueSourceIdx].ImagePath;if(ae.length>0&&ae.indexOf("data:")==-1){this.MyPDF.AddImage(this.Parent.GetBaseDir()+"/"+CBook.AdaptWebFileName(ae),j,c,R-j,t-c)}else{this.MyPDF.AddImage(K.Image.ServletImage(),j,c,R-j,t-c)}}J.Add(g.Span)}var f=this.Parent.VisualStyleList.Color(g.Span.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);if(ac.ParentSect!=null&&ac.ParentSect.ParentSection.SectType==IDREGlb.SECT_DETAIL&&ac.ParentSect.DSEPosition%2==0){f=this.Parent.VisualStyleList.Color(g.Span.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE)}if(g.Span.BackColor!=-1){f=g.Span.BackColor}if(f==A){f=IDREGlb.CLR_NONE}if(f!=IDREGlb.CLR_NONE){var b=L+this.FromPhysicalToPoints(g.Point.X+B.intValue());var S=this.FromPhysicalToPoints(g.TextWidth)+0.5;var T=Z-this.FromPhysicalToPoints(g.Point.Y-g.TextAscent+(this.Parent.VisualStyleList.BorderType(ac.VisAttrIdx,IDREGlb.VISBDI_VALUE)==IDREGlb.VISBRD_CUSTOM?o.intValue():0));var ab=-this.FromPhysicalToPoints(g.TextHeight);this.MyPDF.SetColor(f&255,(f&65280)>>8,(f&16711680)>>16);this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(b,T,S,ab,true)}var e=this.Parent.VisualStyleList.Color(g.Span.VisAttrIdx,IDREGlb.VISCLR_FOREVALUE);if(g.Span.ForeColor!=-1){e=g.Span.ForeColor}this.MyPDF.SetColor(e&255,(e&65280)>>8,(e&16711680)>>16);var W=this.Parent.VisualStyleList.Font(g.Span.VisAttrIdx,IDREGlb.VISFNT_VALUE,g.Span.FontMod,(this.Parent.MultiplePE==this?2:1));if(W.ServletFont()!=null&&W.ServletFont().ID==-1){var k=(this.Parent.VisualStyleList.Flags(g.Span.VisAttrIdx)&IDREGlb.FL_VIS_EMBEDFONT)!=0;W.ServletFont().ID=this.MyPDF.AddFont(W.ServletFont(),k)}var a=L+this.FromPhysicalToPoints(g.Point.X+B.intValue());var ah=Z-this.FromPhysicalToPoints(g.Point.Y+(this.Parent.VisualStyleList.BorderType(ac.VisAttrIdx,IDREGlb.VISBDI_VALUE)==IDREGlb.VISBRD_CUSTOM?o.intValue():0));var D=(W.Bold&&!W.ServletFont().IsBold);var Y=(W.Italic&&!W.ServletFont().IsItalic);var u=g.GetText(this.FromPointsToPhysical(ag-L)-g.Point.X);u=this.RemoveEOLandLF(u);if(u.length==0){continue}if(g.Span.ValueSourceIdx!=-1&&(this.Parent.VisualStyleList.Flags(g.Span.VisAttrIdx)&IDREGlb.FL_VIS_SHOWVALUE)===0){continue}this.MyPDF.AddText(u,a,ah,0.5,W.Size,-1,W.ServletFont().ID,D,Y,(g.JustSpace!=0?this.FromPhysicalToPoints(g.JustSpace):-1),100,W.LetterSpacing,W.WordSpacing,(W.HorizontalScale==0?100:W.HorizontalScale));if(W.Underline){this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddLine(a,ah-W.Size*0.15,a+this.FromPhysicalToPoints(g.TextWidth+g.JustSpace),ah-W.Size*0.15)}if(W.StrikeOut){this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddLine(a,ah+W.Size*0.25,a+this.FromPhysicalToPoints(g.TextWidth+g.JustSpace),ah+W.Size*0.25)}if((this.Parent.VisualStyleList.Flags(g.Span.VisAttrIdx)&IDREGlb.FL_VIS_HYPERLINK)!=0){var H=g.Span.Value.stringValue();var E=(H.toLowerCase().startsWith("http://")||H.toLowerCase().startsWith("https://"));var z=(g.Text.toLowerCase().startsWith("http://")||g.Text.toLowerCase().startsWith("https://"));if(E&&(!z||!H.equals(g.Text))){this.MyPDF.AddLink(a,ah-W.Size*0.15,this.FromPhysicalToPoints(g.TextWidth+g.JustSpace),W.Size+W.Size*0.15,H)}}}}CPEBase.prototype.PrintBox.call(this,ac);if(ac.Rotation!=0){this.MyPDF.UndoRotation()}};CPEPDF.prototype.DrawBorder=function(l,c,g,d,b){var k=this.Parent.VisualStyleList.BorderType(l,IDREGlb.VISBDI_VALUE);if(k==IDREGlb.VISBRD_NONE){return}if(k==IDREGlb.VISBRD_CUSTOM){for(var h=1;h<=4;h++){var f=this.Parent.VisualStyleList.CBorWidth(l,h)/4;var j=this.Parent.VisualStyleList.CBorColor(l,h);var a=this.Parent.VisualStyleList.CBorType(l,h);if(f==0||j==IDREGlb.CLR_NONE){continue}switch(a){case IDREGlb.VISCTYP_SOLID:this.MyPDF.SetLineDashPattern(0);break;case IDREGlb.VISCTYP_DOTTED:this.MyPDF.SetLineDashPattern(0,f);break;case IDREGlb.VISCTYP_DASHED:this.MyPDF.SetLineDashPattern(0,5*f);break;case IDREGlb.VISCTYP_DOUBLE:this.MyPDF.SetLineDashPattern(0);f/=3;break;default:continue}this.MyPDF.SetLineWidth(f);this.MyPDF.SetLineColor(j&255,(j&65280)>>8,(j&16711680)>>16);switch(h){case IDREGlb.VISCBOR_TOP:this.MyPDF.AddLine(c,g-f/2,d,g-f/2);if(a==IDREGlb.VISCTYP_DOUBLE){this.MyPDF.AddLine(c,g-2*f-f/2,d,g-2*f-f/2)}break;case IDREGlb.VISCBOR_RIGHT:this.MyPDF.AddLine(d-f/2,g,d-f/2,b);if(a==IDREGlb.VISCTYP_DOUBLE){this.MyPDF.AddLine(d-2*f-f/2,g,d-2*f-f/2,b)}break;case IDREGlb.VISCBOR_BOTTOM:this.MyPDF.AddLine(c,b+f/2,d,b+f/2);if(a==IDREGlb.VISCTYP_DOUBLE){this.MyPDF.AddLine(c,b+2*f+f/2,d,b+2*f+f/2)}break;case IDREGlb.VISCBOR_LEFT:this.MyPDF.AddLine(c+f/2,g,c+f/2,b);if(a==IDREGlb.VISCTYP_DOUBLE){this.MyPDF.AddLine(c+2*f+f/2,g,c+2*f+f/2,b)}break}}this.MyPDF.SetLineDashPattern(0)}else{var e=this.Parent.VisualStyleList.Color(l,IDREGlb.VISCLR_BORDERS);this.MyPDF.SetLineDashPattern(0);this.MyPDF.SetLineWidth(0.5);this.MyPDF.SetLineColor(e&255,(e&65280)>>8,(e&16711680)>>16);switch(k){case IDREGlb.VISBRD_FRAME:case IDREGlb.VISBRD_SUNKEN:case IDREGlb.VISBRD_RAISED:case IDREGlb.VISBRD_ETCHED:case IDREGlb.VISBRD_BUMP:this.MyPDF.AddRectangle(c,g,d-c,b-g);break;case IDREGlb.VISBRD_HORIZ:this.MyPDF.AddLine(c,g,d,g);break;case IDREGlb.VISBRD_VERT:this.MyPDF.AddLine(c,g,c,b);this.MyPDF.AddLine(d,g,d,b);break}}};CPEPDF.prototype.RenderOption=function(r,j,h,o,q,c,v,e,m,g){var t=this.Parent.VisualStyleList.Font(r.VisAttrIdx,IDREGlb.VISFNT_VALUE,r.FontMod,(this.Parent.MultiplePE==this?2:1));if(t.ServletFont()!=null&&t.ServletFont().ID==-1){var u=(this.Parent.VisualStyleList.Flags(r.VisAttrIdx)&IDREGlb.FL_VIS_EMBEDFONT)!=0;t.ServletFont().ID=this.MyPDF.AddFont(t.ServletFont(),u)}var f=this.Parent.VisualStyleList.Color(r.VisAttrIdx,IDREGlb.VISCLR_FOREVALUE);if(r.ForeColor!=-1){f=r.ForeColor}var k=r.ValueList;if(k==null){k=r.ParentRptSpan.ValueList}var n=((o-c)/t.Height>=2);if(j!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(j&255,(j&65280)>>8,(j&16711680)>>16);this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(h,o,q-h,c-o,true);this.MyPDF.SetColor(0,0,0)}var a=4;var s=o-a-2;var b=h;for(var x=0;x<k.Count();x++){var l=k[x];var d=this.FromPhysicalToPoints(t.GetStringWidth(l.Name,this));if(j!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(255,255,255);this.MyPDF.AddCircle(b+a+2,s,a,true);this.MyPDF.SetColor(0,0,0)}this.MyPDF.AddCircle(b+a+2,s,a);if(l.Value.equals(r.Value)){this.MyPDF.AddCircle(b+a+2,s,a-2,true)}this.MyPDF.SetColor(f&255,(f&65280)>>8,(f&16711680)>>16);this.MyPDF.AddText(l.Name,b+a*2+2+2,s-2,-1,-1,-1,t.ServletFont().ID);if(n){s-=t.Height+t.LineGap}else{b+=d+a*2+2+4+4}}};CPEPDF.prototype.RenderCheck=function(j,h,n,k,o,s,a,q,r,g){var b=10;var m=n+(o-n-b)/2;if(h!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(h&255,(h&65280)>>8,(h&16711680)>>16);this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(n,k,o-n,s-k,true)}this.DrawBorder(j.VisAttrIdx,n,k,o,s);var l=this.Parent.VisualStyleList.BorderType(j.VisAttrIdx,IDREGlb.VISBDI_VALUE);if(l!=IDREGlb.VISBRD_NONE){var f=new IDVariant(0);var d=new IDVariant(0);var c=new IDVariant(0);var e=new IDVariant(0);this.Parent.VisualStyleList.GetBorderWidths(j.VisAttrIdx,f,d,c,e,this.Parent.UM,this);n+=this.FromPhysicalToPoints(d.intValue())+1;k-=this.FromPhysicalToPoints(f.intValue())+1}if(h!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(255,255,255);this.MyPDF.AddRectangle(m,k,b,-b,true);this.MyPDF.SetColor(0,0,0)}this.MyPDF.SetLineWidth(0.8);this.MyPDF.SetLineColor(176,176,176);this.MyPDF.AddLine(m-0.4,k,m+b+0.4,k);this.MyPDF.AddLine(m,k+0.4,m,k-b+0.4);this.MyPDF.SetLineColor(128,128,128);this.MyPDF.AddLine(m+0.4,k-0.8,m+b-0.4,k-0.8);this.MyPDF.AddLine(m+0.8,k-0.8,m+0.8,k-b+0.4);this.MyPDF.SetLineColor(224,224,224);this.MyPDF.AddLine(m-0.4,k-b,m+b+0.4,k-b);this.MyPDF.AddLine(m+b,k-b,m+b,k+0.4);if(j.ValueSourceIdx==0){this.MyPDF.SetLineWidth(1.2);this.MyPDF.SetLineColor(0,0,0);this.MyPDF.AddLine(m+b*3/10,k-b/2,m+b*5/10,k-b*8/10);this.MyPDF.AddLine(m+b*5/10,k-b*8/10,m+b*7/10,k-b*3/10)}};CPEPDF.prototype.GetPageSize=function(){return{Width:0,Height:0}};CPEPDF.prototype.GetBorderSize=function(){return 0.5*4};function CQueryParam(){this.RepIdx=-1;this.TblIdx=-1;this.FldIdx=-1;this.AttValue=new IDVariant();this.DataType=0;this.MaxLength=0;this.Scale=0}function CRect(b,e,a,c){this.x=0;this.y=0;this.width=0;this.height=0;if(b instanceof CRect){var d=b;this.x=d.x;this.y=d.y;this.width=d.width;this.height=d.height}else{if(b!=undefined){this.x=b}if(e!=undefined){this.y=e}if(a!=undefined){this.width=Math.abs(a-b)}if(c!=undefined){this.height=Math.abs(c-e)}}}CRect.prototype.left=function(){return this.x};CRect.prototype.top=function(){return this.y};CRect.prototype.right=function(){return this.x+this.width};CRect.prototype.bottom=function(){return this.y+this.height};CRect.prototype.setLeft=function(a){this.x=a};CRect.prototype.setTop=function(a){this.y=a};CRect.prototype.setRight=function(a){this.width=a-this.x};CRect.prototype.setBottom=function(a){this.height=a-this.y};CRect.prototype.setWidth=function(a){this.width=a};CRect.prototype.setHeight=function(a){this.height=a};CRect.prototype.IsRectNull=function(){return(this.x==0&&this.y==0&&this.width==0&&this.height==0)};CRect.prototype.Deflate=function(c,d,e,a){if(d==undefined){d=c}if(e==undefined){e=c}if(a==undefined){a=d}this.x+=Math.floor(c);this.y+=Math.floor(d);this.width-=Math.floor(c+e);this.height-=Math.floor(a+d)};CRect.prototype.Inflate=function(c,d,e,a){if(d==undefined){d=c}if(e==undefined){e=c}if(a==undefined){a=d}this.x-=Math.floor(c);this.y-=Math.floor(d);this.width+=Math.floor(c+e);this.height+=Math.floor(a+d)};CRect.prototype.Intersect=function(b,a){this.x=Math.max(b.left(),a.left());this.y=Math.max(b.top(),a.top());this.setRight(Math.min(b.left()+b.width,a.left()+a.width));this.setBottom(Math.min(b.top()+b.height,a.top()+a.height))};CRect.prototype.toString=function(){return"X="+this.x+", Y="+this.y+", W="+this.width+", H="+this.height};function CReport(){this.ReportID=0;this.ParentBox=null;this.Parent=null;this.Flags=0;this.DSE=null;this.SectionsList=new ArrayList();this.PermStatesList=new ArrayList();this.RoleFlag=-1;this.ReInitGroups=true;this.FormattingObj=null;this.Freezed=false}CReport.prototype.GetID=function(){return this.ReportID};CReport.prototype.GetBook=function(){return this.Parent};CReport.prototype.USection=function(){return new IDVariant(this.SectionsList.Count())};CReport.prototype.bSection=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.SectionsList.Count()?null:this.SectionsList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.Parent.FindObjByID(this.Parent.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CReport.prototype.GetNextMastro=function(c){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&this.DSE.IsOpen()){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),510,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Data source is already open. Using cached data")}if(!this.DSE.IsOpen()&&!this.OpenDSE()){if(this.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),511,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Can't open data source and HideIfEmpty flag set -> Skipping report")}return null}}else{if(this.DSE.IsOpen()&&this.DSE.RecordCount()==0){if(this.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),511,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Report's query has no data and HideIfEmpty flag set -> Skipping report")}return null}}}var g=null;if(c!=null){g=c.GetState(this)}var b=null;if(g!=null){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),512,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Check if sections printed partially in previous page needs a particular page to be completed")}for(var e=0;e<this.SectionsList.Count();e++){var d=this.SectionsList[e];if(!d.IsCompleted(g,null)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),513,"CReport.GetNextMastro","Section "+this.Parent.Parent.GetObjName(d.SectionID)+": Section was not fully printed in previous page. Asking which page it needs to continue")}b=d.GetNextMastro(g,c,null);if(b!=null){return b}}}if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),514,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": No page is needed by partially printed sections. Check if sections wants to print something")}}else{if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),515,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Check if any section wants to print something")}}var f=null;if(this.DSE.IsOpen()){f=this.DSE.Next(g!=null?g.DSEState:null,true)}for(var e=0;e<this.SectionsList.Count()&&b==null;e++){var d=this.SectionsList[e];var a=((!this.DSE.IsOpen()||this.DSE.RecordCount()==0)&&g==null&&(d.SectType==IDREGlb.SECT_REPORTHEADER||d.SectType==IDREGlb.SECT_PAGEHEADER||d.SectType==IDREGlb.SECT_REPORTFOOTER||d.SectType==IDREGlb.SECT_PAGEFOOTER));if(a||d.WantToPrint(g,f)){b=d.GetNextMastro(g,c,f)}if(b!=null){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),516,"CReport.GetNextMastro","Section "+this.Parent.Parent.GetObjName(d.SectionID)+": Section requested a page of type '"+this.Parent.Parent.GetObjName(b.MastroID)+"'")}break}}f=null;return b};CReport.prototype.FormatPage=function(e,k){var t=null;if(e!=null){t=e.GetState(this)}var q=new AReportState();q.Parent=k;q.ParentReport=this;k.ReportStates.Add(q);if(t!=null){q.PrintedSomething=t.PrintedSomething}var g=new ADSEState();q.DSEState=g;if(t!=null){g.CopyFrom(t.DSEState);if(this.DSE.IsOpen()){this.DSE.SetCurrentPosition(t.DSEState.ActualPosition)}}else{if(this.DSE.IsOpen()){this.DSE.SetCurrentPosition(1)}}var n=true;var c=true;var f=false;if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),517,"CReport.FormatPage","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Start formatting sections on the current page")}var o=new MyBoolean(false);while(n){for(var r=0;r<this.SectionsList.Count();r++){var m=this.SectionsList[r];if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg("",0,"","-------------------- Section "+this.Parent.Parent.GetObjName(m.SectionID)+" (RecNum = "+this.DSE.GetCurrentPosition()+" out of "+this.DSE.RecordCount()+") --------------------")}if(!m.GetFlag(IDREGlb.FL_SECT_VISIBLE)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(m.SectionID),518,"CReport.FormatPage","Section "+this.Parent.Parent.GetObjName(m.SectionID)+": Section is invisible. Skipping...")}continue}if(m.SectType!=IDREGlb.SECT_PAGEHEADER&&m.SectType!=IDREGlb.SECT_PAGEFOOTER&&g.HideGroupLevel!=-1&&(m.GroupLevel>g.HideGroupLevel||m.SectType==IDREGlb.SECT_DETAIL||(m.GroupLevel==g.HideGroupLevel&&m.SectType==IDREGlb.SECT_GROUPFOOTER))){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(m.SectionID),519,"CReport.FormatPage","Section "+this.Parent.Parent.GetObjName(m.SectionID)+": One previous section has ShowChildren flag set to False and I'm included into that section -> Skipping section")}continue}var h=new MyBoolean(false);var l=new MyBoolean(true);var a=true;var d=0;while(l.get()&&a){l.set(false);a=m.FormatPage(e,k,c,h,o,l,null);if(a&&(l.get()||d>0)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(m.SectionID),520,"CReport.FormatPage","Section "+this.Parent.Parent.GetObjName(m.SectionID)+": Reprint requested -> Reformatting section")}if(d>0){(k.Sections[k.Sections.Count()-1]).RD3IdentName+="-"+d}d++}}if(m.SectType!=IDREGlb.SECT_PAGEHEADER&&m.SectType!=IDREGlb.SECT_PAGEFOOTER){n&=a}if(h.get()){n=true;f=true;o.set(false);break}}c=false;n&=this.DSE.IsOpen();if(n){if(f){f=false}else{this.DSE.Next(g);g.ActualPosition=this.DSE.GetCurrentPosition()}if(this.DSE.IsEof()){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),521,"CReport.FormatPage","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Data source has no more records. Continue with other reports")}q.PrintPHPF=false;n=false}}}if(this.Parent.DTTObj.Level>0&&this.ParentBox==null&&e!=null&&k!=null&&this.DSE.IsOpen()&&!this.DSE.IsEof()){var j=this.DSE.GetCurrentPosition();var b=e.GetState(this);if(b!=null&&j==b.DSEState.ActualPosition){this.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.Parent.GetRTCGuid(0),464,"CReport.FormatPage","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Report DataSource position did't change from previous page -> Maybe one of my sections can't print and a potential LOOP will be hit")}}};CReport.prototype.OpenDSE=function(){if(!this.DSE.Open()){return false}for(var e=0;e<this.SectionsList.Count();e++){var d=this.SectionsList[e];for(var a=0;a<d.BoxList.Count();a++){var f=d.BoxList[a];for(var g=0;g<f.SpanList.Count();g++){var c=f.SpanList[g];if(c.Text.length>2&&c.Text.substr(0,2)=="::"){c.FldIdx=this.DSE.GetFldIdx(c.Text.substr(2))}}}}return true};CReport.prototype.GetPermanentState=function(f,e,b){if(f instanceof ASectionState){var a=f;var b=e;if(b==undefined){b=true}return this.GetPermanentState(a.ParentSection.SectionID,this.DSE.GetCurrentPosition(),b)}else{if(b==undefined){b=true}var g=null;for(var d=0;d<this.PermStatesList.Count();d++){var c=this.PermStatesList[d];if(c.DSECurrentPosition==e&&c.SectionID==f){g=c;break}}if(b&&g!=null&&g.GH_DSECurrentPosition!=-1&&g.GH_DSECurrentPosition!=e){g=this.GetPermanentState(f,g.GH_DSECurrentPosition)}return g}};CReport.prototype.FormatSubReport=function(d){if(this.DSE.IsOpen()){this.DSE.Close()}this.DSE.UpdateIMDB(true);if(!this.OpenDSE()){if(this.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),651,"CReport.FormatSubReport","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Can't open data source and HideIfEmpty flag set -> Skipping report")}return}}else{if(this.DSE.IsOpen()&&this.DSE.RecordCount()==0){if(this.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),651,"CReport.FormatSubReport","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Report's query has no data and HideIfEmpty flag set -> Skipping report")}return}}}if(this.DSE.IsOpen()){this.DSE.SetCurrentPosition(1)}var j=true;var b=true;var e=new ADSEState();while(j){for(var l=0;l<this.SectionsList.Count();l++){var h=this.SectionsList[l];if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg("",0,"","-------------------- Sub-Section "+this.Parent.Parent.GetObjName(h.SectionID)+" (RecNum = "+this.DSE.GetCurrentPosition()+" out of "+this.DSE.RecordCount()+") --------------------")}if(!h.GetFlag(IDREGlb.FL_SECT_VISIBLE)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(h.SectionID),522,"CReport.FormatSubReport","Sub-Section "+this.Parent.Parent.GetObjName(h.SectionID)+": Section is invisible. Skipping...")}continue}if(h.SectType!=IDREGlb.SECT_PAGEHEADER&&h.SectType!=IDREGlb.SECT_PAGEFOOTER&&e.HideGroupLevel!=-1&&(h.GroupLevel>e.HideGroupLevel||h.SectType==IDREGlb.SECT_DETAIL)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(h.SectionID),523,"CReport.FormatSubReport","Sub-Section "+this.Parent.Parent.GetObjName(h.SectionID)+": One previous sub-section has ShowChildren flag set to False and I'm included into that sub-section -> Skipping sub-section")}continue}var f=new MyBoolean(false);var k=new MyBoolean(false);var g=new MyBoolean(true);var a=true;var c=0;while(g.get()&&a){g.set(false);a=h.FormatPage(null,null,b,f,k,g,d);if(a&&(g.get()||c>0)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(h.SectionID),524,"CReport.FormatSubReport","Sub-Section "+this.Parent.Parent.GetObjName(h.SectionID)+": Reprint requested -> Reformatting sub-section")}if(c>0){(d.SubSections[d.SubSections.Count()-1]).RD3IdentName+="-"+c}c++}}if(h.SectType!=IDREGlb.SECT_PAGEHEADER&&h.SectType!=IDREGlb.SECT_PAGEFOOTER){j&=a}}b=false;j&=this.DSE.IsOpen();if(j){this.DSE.Next(e);e.ActualPosition=this.DSE.GetCurrentPosition();if(this.DSE.IsEof()){j=false}}}e=null};CReport.prototype.InitFlags=function(a){this.Flags=a};CReport.prototype.GetFlags=function(){var a=this.Flags;if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_REPORT_VISIBLE}return a};CReport.prototype.GetFlag=function(a){if(a==IDREGlb.FL_REPORT_VISIBLE&&(this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return((this.Flags&a)!=0)};CReport.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_REPORT_VISIBLE}};CReport.prototype.SetRoleFlag=function(a){this.RoleFlag=a;for(var b=0;b<this.SectionsList.Count();b++){(this.SectionsList[b]).SetRoleFlag(a)}};CReport.prototype.ExportData=function(o,C,b){if(C==undefined){C=true}if(b==undefined){b=o.ParamsObj().ExportUTF8?"UTF-8":"windows-1252"}var x=new StringTokenizer();x.UseDecimalDot=o.ParamsObj().UseDecimalDot;var u=new IDVariant(x.UseDecimalDot?",":";");try{var s="";var n=this.DSE.IsOpen();if(!n){this.DSE.Open()}x.setString(new IDVariant(),u);for(var y=0;y<this.DSE.GetNumColumns();y++){var h=new IDVariant();var r=new IDVariant();var A=new IDVariant();this.DSE.GetFldParam(y+1,h,r,A);if(h.intValue()!=Glb.DT_DOC_OLE){x.addToken(new IDVariant(this.DSE.GetFieldName(y)))}}s+=x.getString()+"\n";this.DSE.MoveFirst();while(!this.DSE.IsEof()){x.setString(new IDVariant(),u);for(var y=0;y<this.DSE.GetNumColumns();y++){var h=new IDVariant();var r=new IDVariant();var A=new IDVariant();this.DSE.GetFldParam(y+1,h,r,A);if(h.intValue()!=Glb.DT_DOC_OLE){var D=new IDVariant();this.DSE.GetFieldValue(D,y+1);if(IDL.IsNumber(D)&&Glb.ClassDT(h.intValue())==Glb.DTC_CHAR&&D.Type==IDVariant.STRING){var k=D.stringValue();var m=false;if(k.length>8&&D.longValue()>100000000){m=true}else{if(k.length>1&&k[0]=="0"&&k[1]!="."&&k[1]!=","&&IDL.IsNumber(new IDVariant(k.substring(1)))){m=true}}if(m){D=new IDVariant(k+"\t")}}if(D.stringValue().startsWith("=")){D=new IDVariant('="'+D+'"')}x.addToken(new IDVariant(D))}}s+=x.getString()+"\n";this.DSE.MoveNext()}var c;if(o.ShellObject.IsInsideShell()){var l=GUID.DocID2GUID(MDOInit.GetNewDocID().stringValue())+".csv";var f=o.TempPath()+"/"+l;var t=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForOutput(new IDVariant(f),t,b);RD4_WebEntryPoint.VBFile.WriteLine(t,new IDVariant(s));RD4_WebEntryPoint.VBFile.Close(t);c="temp/"+l}else{var q=new Uint8Array(s.length);for(var z=0;z<s.length;z++){q[z]=s.charCodeAt(z)}var v=new BlobBuilder();v.append(q.buffer);var d=o.GetMimeType("csv");var a=v.getBlob(d);c=URL.createObjectURL(a)}if(!n){this.DSE.Close()}else{this.DSE.MoveFirst();var g=this.DSE.GetCurrentPosition();for(var z=1;z<g;z++){this.DSE.MoveNext()}}if(C){if(o.ShellObject.IsInsideShell()){o.AddTempFile(o.RealPath+"/"+c)}o.set_RedirectTo(new IDVariant(c));o.set_RedirectNewWindow(true)}return c}catch(B){this.GetBook().DTTObj.AddException(this.GetBook().Parent.GetRTCGuid(this.ReportID),"CReport.ExportData","Report "+this.GetBook().Parent.GetObjName(this.ReportID)+": Can't export data",B)}return""};CReport.prototype.SelectSection=function(a,b){var f=this.GetBook();var e=-1;if(b.Type==IDVariant.NULL||(b.Type==IDVariant.STRING&&b.stringValue().length==0)||(b.Type==IDVariant.INTEGER&&b.intValue()==0)){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),800,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Removing section selection")}f.FormattingType=IDREGlb.FRM_NONE;f.FormattingObj=null;return true}else{if(b.Type==IDVariant.INTEGER){var h=b.intValue();if(h<0||h>this.DSE.RecordCount()){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),801,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Removing section selection (record number "+h+" out of range 0-"+this.DSE.RecordCount()+")")}f.FormattingType=IDREGlb.FRM_NONE;f.FormattingObj=null;return true}}else{if(b.Type==IDVariant.STRING){for(var n=0;n<this.DSE.GetNumColumns()&&e==-1;n++){var u=this.DSE.GetFieldName(n);if(u.equals("HASH")){e=n}}if(e==-1){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),802,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Column HASH not found in the data source")}return false}}}}if(this.ParentBox!=null&&(f.FormattingObj==null||!(f.FormattingObj instanceof ASection))){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),803,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": You need to select the section that contains the sub-report before you can select a sub-report section")}return false}var o=null;for(var g=0;g<this.SectionsList.Count()&&o==null;g++){var q=this.SectionsList[g];if(q.SectionID==a){o=q}}if(o==null){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),804,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Can't find section inside the report")}return false}var l=this.DSE.GetCurrentPosition();if(this.ParentBox!=null){var c=null;var m=f.FormattingObj;for(var k=0;k<m.BoxList.Count()&&c==null;k++){var d=m.BoxList[k];if(d.ParentRptBox!=this.ParentBox){continue}c=d}if(c==null){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),805,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Can't find an instance of my box inside the activated section")}return false}for(var g=0;g<c.SubSections.Count();g++){var q=c.SubSections[g];if(q.ParentSection.SectionID!=a){continue}if(b.Type==IDVariant.INTEGER&&q.DSEPosition!=b.intValue()){continue}else{if(b.Type==IDVariant.STRING){this.DSE.SetCurrentPosition(q.DSEPosition);var t=new IDVariant();this.DSE.GetFieldValue(t,e);if(!t.equals(b)){continue}}}if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),806,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Section for record "+q.DSEPosition+" selected")}this.DSE.Close();this.DSE.UpdateIMDB(true);this.DSE.Open();this.DSE.SetCurrentPosition(q.DSEPosition);f.FormattingObj=q;f.FormattingType=IDREGlb.FRM_SECTION_PERM;return true}if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),807,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": The activated section does not contain the right sub-section instance")}}else{for(var j=0;j<f.PagesList.Count();j++){var r=f.PagesList[j];if(r==null){if(f.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),808,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": The page "+(j+1)+" has not been printed yet")}continue}if(r.ParentMastro!=o.RendersInto.PMastro){if(f.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),809,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": The page "+r.PageNum+" is not of the right type (section renders in a different page)")}continue}if(f.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),810,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Page "+r.PageNum+" contains instances of requested section -> Checking if it contains the right instance")}for(var g=0;g<r.Sections.Count();g++){var q=r.Sections[g];if(q.ParentSection.SectionID!=a){continue}if(b.Type==IDVariant.INTEGER&&q.DSEPosition!=b.intValue()){continue}else{if(b.Type==IDVariant.STRING){this.DSE.SetCurrentPosition(q.DSEPosition);var t=new IDVariant();this.DSE.GetFieldValue(t,e);if(!t.equals(b)){continue}}}if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),806,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Section for record "+q.DSEPosition+" selected")}this.DSE.SetCurrentPosition(q.DSEPosition);f.FormattingObj=q;f.FormattingType=IDREGlb.FRM_SECTION_PERM;return true}if(f.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),811,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Page "+r.PageNum+" does not contain the right section instance")}}}if(b.Type==IDVariant.STRING){this.DSE.SetCurrentPosition(l)}if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),812,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Can't locate the right section")}return false};function CRptBox(){this.BoxID=0;this.XPos=0;this.YPos=0;this.Width=0;this.Height=0;this.HRsz=IDREGlb.RSZ_NONE;this.VRsz=IDREGlb.RSZ_NONE;this.Interline=0;this.VisAttrIdx=-1;this.Flags=0;this.ImageIdx=0;this.FontHeight=0;this.ToolTip="";this.RoleFlag=-1;this.Stretch=IDREGlb.STRTC_AUTO;this.VisProp=-1;this.Rotation=0;this.BackColor=-1;this.ForeColor=-1;this.FontMod="";this.Alignment=IDREGlb.VISALN_AUTO;this.VAlignment=IDREGlb.VISVALN_TOP;this.Badge="";this.ClassName="";this.NextBox=null;this.SubReport=null;this.PMastro=null;this.PSection=null;this.SubGraph=null;this.SpanList=new ArrayList()}CRptBox.prototype.GetID=function(){return this.BoxID};CRptBox.prototype.GetBook=function(){return(this.PSection!=null?this.PSection.Parent.Parent:this.PMastro.Parent)};CRptBox.prototype.USpan=function(){return new IDVariant(this.SpanList.Count())};CRptBox.prototype.bSpan=function(b){var a=this.GetBook();if(b.Type==IDVariant.INTEGER){return(b.intValue()<0||b.intValue()>=this.SpanList.Count()?null:this.SpanList[b.intValue()])}else{if(b.Type==IDVariant.STRING){return a.Parent.FindObjByID(a.Parent.Code2IndexMap[b.stringValue()])}else{return null}}};CRptBox.prototype.GetARptBox=function(a){var d=new ARptBox();d.ParentRptBox=this;d.InitFlags(this.GetFlags());d.XPos=this.XPos;d.YPos=this.YPos;d.Width=this.Width;d.Height=this.Height;d.HRsz=this.HRsz;d.VRsz=this.VRsz;d.Interline=this.Interline;d.SetVisualStyle(this.VisAttrIdx);d.ImageIdx=this.ImageIdx;d.YFilledPos=0;d.ToolTip=this.ToolTip;d.Stretch=this.Stretch;d.Rotation=this.Rotation;d.VisProp=this.VisProp;d.SetBackColor(this.BackColor);d.SetForeColor(this.ForeColor);d.Alignment=this.Alignment;d.VAlignment=this.VAlignment;d.SetFontMod(this.FontMod);d.Badge=this.Badge;d.ClassName=this.ClassName;IDREGlb.SetArraySize(d.Spans,this.SpanList.Count());for(var c=0;c<this.SpanList.Count();c++){var b=this.SpanList[c];if(b.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){d.Spans[c]=b.GetARptSpan(a);d.Spans[c].Parent=d}else{d.Spans[c]=null}}return d};CRptBox.prototype.SetRect=function(a,c){var b;if(this.PSection!=null){b=this.PSection.Parent.Parent}else{b=this.PMastro.Parent}switch(a){case IDREGlb.RECT_LEFT:this.XPos=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_TOP:this.YPos=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_WIDTH:this.Width=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_HEIGHT:this.Height=b.ConvertToInternalValue(c);break}};CRptBox.prototype.GetRect=function(a){var b;if(this.PSection!=null){b=this.PSection.Parent.Parent}else{b=this.PMastro.Parent}switch(a){case IDREGlb.RECT_LEFT:return b.ConvertFromInternalValue(this.XPos);case IDREGlb.RECT_TOP:return b.ConvertFromInternalValue(this.YPos);case IDREGlb.RECT_WIDTH:return b.ConvertFromInternalValue(this.Width);case IDREGlb.RECT_HEIGHT:return b.ConvertFromInternalValue(this.Height)}return 0};CRptBox.prototype.InitFlags=function(a){this.Flags=a};CRptBox.prototype.GetFlags=function(){var a=this.Flags;if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_RPTBOX_VISIBLE}return a};CRptBox.prototype.GetFlag=function(a){if(a==IDREGlb.FL_RPTBOX_VISIBLE&&(this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return((this.Flags&a)!=0)};CRptBox.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_RPTBOX_VISIBLE}};CRptBox.prototype.SetRoleFlag=function(a){this.RoleFlag=a;for(var b=0;b<this.SpanList.Count();b++){SpanList[b].SetRoleFlag(a)}};CRptBox.prototype.GetVisualStyle=function(){return this.VisAttrIdx};CRptBox.prototype.SetVisualStyle=function(a){for(var c=0;c<this.SpanList.Count();c++){var b=this.SpanList[c];if(b.VisAttrIdx==this.VisAttrIdx){b.VisAttrIdx=a}}this.VisAttrIdx=a};CRptBox.prototype.GetBackColor=function(){return this.BackColor};CRptBox.prototype.SetBackColor=function(c){for(var b=0;b<this.SpanList.Count();b++){var a=this.SpanList[b];if(a.BackColor==this.BackColor){a.BackColor=c}}this.BackColor=c};CRptBox.prototype.GetForeColor=function(){return this.ForeColor};CRptBox.prototype.SetForeColor=function(c){for(var b=0;b<this.SpanList.Count();b++){var a=this.SpanList[b];if(a.ForeColor==this.ForeColor){a.ForeColor=c}}this.ForeColor=c};CRptBox.prototype.GetFontMod=function(){return this.FontMod};CRptBox.prototype.SetFontMod=function(a){for(var c=0;c<this.SpanList.Count();c++){var b=this.SpanList[c];if(b.FontMod.equals(this.FontMod)){b.FontMod=a}}this.FontMod=a};function CRptSpan(){this.SpanID=0;this.Parent=null;this.Text="";this.ToolTip="";this.FldIdx=-1;this.VisAttrIdx;this.DataType=IDREGlb.DT_UNSPEC;this.Scale=0;this.MaxLen=0;this.Flags=0;this.RoleFlag=-1;this.Stretch=IDREGlb.STRTC_AUTO;this.BackColor=-1;this.ForeColor=-1;this.FontMod="";this.Mask="";this.Watermark="";this.ClassName="";this.ValueList=new ArrayList()}CRptSpan.prototype.GetID=function(){return this.SpanID};CRptSpan.prototype.GetBook=function(){return(this.Parent.PSection!=null?this.Parent.PSection.Parent.Parent:this.Parent.PMastro.Parent)};CRptSpan.prototype.GetARptSpan=function(a){var c=new ARptSpan();c.ParentRptSpan=this;c.VisAttrIdx=this.VisAttrIdx;c.Scale=this.Scale;c.MaxLen=this.MaxLen;c.InitFlags(this.GetFlags());c.ToolTip=this.ToolTip;c.Stretch=this.Stretch;c.BackColor=this.BackColor;c.ForeColor=this.ForeColor;c.FontMod=this.FontMod;c.Mask=this.Mask;c.Watermark=this.Watermark;c.ClassName=this.ClassName;if(this.FldIdx!=-1&&a!=null){if(this.DataType==IDREGlb.DT_DOC_OLE){var g=null;if(this.Parent.PMastro!=null&&this.Parent.PMastro.Parent!=null){g=this.Parent.PMastro.Parent}if(this.Parent.PSection!=null&&this.Parent.PSection.Parent.Parent!=null){g=this.Parent.PSection.Parent.Parent}if(g.PE!=null){var f=g.Parent.Parent.Parent.MainFrm.ParamsObj().NativeBlob;var b=false;if((g.VisualStyleList.Flags(this.VisAttrIdx)&IDREGlb.FL_VIS_HYPERLINK)!=0){b=true}var h=new IDVariant("");var e=new IDVariant("");a.GetWEBBlobContent(this.FldIdx,h,e,b,f);c.Text=h.ToString().replace(/\\/g,"/");c.MimeType=e.ToString()}}else{var d=new IDVariant();if(this.FldIdx>=1){a.GetFieldValue(d,this.FldIdx);c.SetNewValue(d)}else{c.Text=this.Text}}}else{c.Text=this.Text}return c};CRptSpan.prototype.GetValueSourceVal=function(j,e,d,b,f){var c=null;var g;for(g=0;g<j.Count();g++){if((j[g]).Value.equals(d)){c=j[g];break}}if(c==null){return -1}var a=c.Name;if((e.Flags(this.VisAttrIdx)&IDREGlb.FL_VIS_SHOWVALUE)!=0){var h=new IDVariant(c.Value);a=h.stringValue()+" - "+a}b.set(new IDVariant(a));if((e.Flags(this.VisAttrIdx)&IDREGlb.FL_VIS_SHOWDESCR)!=0){f.set(new IDVariant(c.Description))}return g};CRptSpan.prototype.InitFlags=function(a){this.Flags=a};CRptSpan.prototype.GetFlags=function(){var a=this.Flags;if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_RPTSPAN_VISIBLE}if((this.RoleFlag&IDREGlb.OBJ_ENABLED)==0){a&=~IDREGlb.FL_RPTSPAN_ENABLED}return a};CRptSpan.prototype.GetFlag=function(a){if(a==IDREGlb.FL_RPTSPAN_VISIBLE&&(this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}if(a==IDREGlb.FL_RPTSPAN_ENABLED&&(this.RoleFlag&IDREGlb.OBJ_ENABLED)==0){return false}return(this.Flags&a)!=0};CRptSpan.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_RPTSPAN_VISIBLE}if((this.RoleFlag&IDREGlb.OBJ_ENABLED)==0){this.Flags&=~IDREGlb.FL_RPTSPAN_ENABLED}};CRptSpan.prototype.SetRoleFlag=function(a){this.RoleFlag=a};function CRptSpanValItem(){this.Name="";this.Description="";this.Value=new IDVariant();this.Image=new MyImage();this.ImagePath="";this.VisualStyle=-1}CRptSpanValItem.prototype.CopyFrom=function(a){this.Name=a.Name;this.Description=a.Description;this.ImagePath=a.ImagePath;this.Value=a.Value;this.Image=a.Image;this.VisualStyle=a.VisualStyle};CRptSpanValItem.prototype.RD3RenderDifference=function(b,d,a){var c=b.AddNewElement("vli");if(this.Name!=null&&this.Name.length>0){c.SetAttribute("txt",this.Name)}if(this.Value!=null&&this.Value.stringValue().length>0){c.SetAttribute("val",this.Value.stringValue())}if(this.Description!=null&&this.Description.length>0){c.SetAttribute("tip",this.Description)}if(this.ImagePath!=null&&this.ImagePath.length>0){c.SetAttribute("img",this.ImagePath)}if(this.VisualStyle!=-1){c.SetAttribute("sty",a.VisualStyleList.GetTrueIdx(this.VisualStyle).toString())}return true};function CSection(){this.SectionID=0;this.Parent=null;this.NumCol;this.ColSpace;this.SectType;this.Height;this.VisAttrIdx;this.Flags;this.DBFieldName="";this.GroupLevel=-1;this.RendersInto=null;this.BoxList=new ArrayList();this.RoleFlag=-1;this.GH_DSEPos=-1;this.GH_PageNum=-1;this.ClassName=""}CSection.prototype.GetID=function(){return this.SectionID};CSection.prototype.GetBook=function(){return this.Parent.Parent};CSection.prototype.UBox=function(){return new IDVariant(this.BoxList.Count())};CSection.prototype.bBox=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.BoxList.Count()?null:this.BoxList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.Parent.Parent.FindObjByID(this.Parent.Parent.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CSection.prototype.SetHeight=function(b){var a=this.Parent.Parent;this.Height=a.ConvertToInternalValue(b)};CSection.prototype.SetColSpace=function(b){var a=this.Parent.Parent;this.ColSpace=a.ConvertToInternalValue(b)};CSection.prototype.GetHeight=function(){var a=this.Parent.Parent;return a.ConvertFromInternalValue(this.Height)};CSection.prototype.GetColSpace=function(){var a=this.Parent.Parent;return a.ConvertFromInternalValue(this.ColSpace)};CSection.prototype.GetNextMastro=function(d,c,f){var b=null;if(d!=null){b=d.GetState(this)}if(this.RendersInto==null){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),525,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section does not render anywhere. Skipping...")}return null}if(c==null){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),526,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section asks for box '"+this.Parent.Parent.Parent.GetObjName(this.RendersInto.BoxID)+"' that is in page '"+this.Parent.Parent.Parent.GetObjName(this.RendersInto.PMastro.MastroID)+"' (first page)")}return this.RendersInto.PMastro}var a=this.SearchMyCurrentBox(c.ParentMastro);if(a==null||a.NextBox==null){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),527,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section was previously printed into box '"+(a!=null?this.Parent.Parent.Parent.GetObjName(a.BoxID):"???")+"' but this box does NOT continue in any other box (NextBox=NULL) -> this section will not be printed anymore")}return null}var e=new ArrayList();e.Add(a);while(a.PMastro==c.ParentMastro){a=a.NextBox;if(a==null){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),528,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Box chain ended. This section will not be printed anymore")}return null}if(e.IndexOf(a)!=-1){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),529,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section will continue into box '"+this.Parent.Parent.Parent.GetObjName(a.BoxID)+"'")}return a.PMastro}e.Add(a)}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),530,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section will continue into box '"+this.Parent.Parent.Parent.GetObjName(a.BoxID)+"'")}return a.PMastro};CSection.prototype.SearchMyCurrentBox=function(b){if(b==null){return this.RendersInto}var c=this.RendersInto;var a=new ArrayList();while(c.PMastro!=b){c=c.NextBox;if(c==null||a.IndexOf(c)!=-1){return null}a.Add(c)}return c};CSection.prototype.IsCompleted=function(f,e){if(f!=null&&e!=null&&f.DSEState.ActualPosition!=e.ParentReport.DSE.GetCurrentPosition()){return true}var a=(f!=null?f.GetState(this):null);if(a==null){return true}if(this.GetFlag(IDREGlb.FL_SECT_HIDEEMPTY)){var d=true;for(var b=0;b<a.BoxStates.Count()&&d;b++){var c=a.BoxStates[b];d&=c.IsEmpty()}return(d&&this.BoxList.Count()!=0)}else{return(a.BoxStates.Count()==0&&this.BoxList.Count()!=0)}};CSection.prototype.WantToPrint=function(d,c){var a=(c!=null&&d!=null&&d.GetState(this)==null&&d.DSEState.ActualPosition==c.ActualPosition);if(this.RendersInto==null){return false}if(a&&d!=null&&d.DSEState.HideGroupLevel!=-1){if(this.SectType!=IDREGlb.SECT_PAGEHEADER&&this.SectType!=IDREGlb.SECT_PAGEFOOTER&&(this.GroupLevel>d.DSEState.HideGroupLevel||this.SectType==IDREGlb.SECT_DETAIL||(this.GroupLevel==d.DSEState.HideGroupLevel&&this.SectType==IDREGlb.SECT_GROUPFOOTER))){a=false}}if(this.SectType==IDREGlb.SECT_DETAIL){if(a){return false}return(this.Parent.DSE.IsOpen()&&this.Parent.DSE.GetNumRecords()>0&&!this.Parent.DSE.IsEof())}else{if(this.SectType==IDREGlb.SECT_PAGEHEADER||this.SectType==IDREGlb.SECT_PAGEFOOTER){return false}else{if(c==null&&this.Parent.ParentBox==null){return false}var b=(this.Parent.DSE.IsMyGroupTime(this.GroupLevel,(this.SectType==IDREGlb.SECT_REPORTHEADER||this.SectType==IDREGlb.SECT_GROUPHEADER),c));if((this.SectType==IDREGlb.SECT_REPORTHEADER||this.SectType==IDREGlb.SECT_REPORTFOOTER)&&(!this.Parent.DSE.IsOpen()||this.Parent.DSE.RecordCount()==0)){b=true}if(a){return false}return b}}};CSection.prototype.FormatPage=function(t,B,ab,O,C,j,c){var x=null;var ag=null;if(t!=null){x=t.GetState(this.Parent);if(x!=null){ag=x.GetState(this)}}var K=(B!=null?B.GetState(this.Parent):null);var aj=ab&&(this.SectType==IDREGlb.SECT_PAGEHEADER||this.SectType==IDREGlb.SECT_PAGEFOOTER||(this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)))&&(x==null||x.PrintPHPF);if(aj&&this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),531,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Wants to print (first request for this page)")}if(aj&&ab&&this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&K!=null&&K.DSEState.ActualPosition==this.Parent.DSE.RecordCount()){var e=false;var G=(K!=null?K.DSEState:null);for(var Q=0;Q<this.Parent.SectionsList.Count();Q++){var I=this.Parent.SectionsList[Q];if(I.SectType!=IDREGlb.SECT_DETAIL){continue}if(!I.IsCompleted(x,K)||(x!=null&&I.WantToPrint(x,G))){e=true;break}}if(!e){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),532,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section is GH and it has ShowOnNewPage flag set but all details have been already printed before -> Skipping")}aj=false}}if(!aj&&x!=null){aj|=!this.IsCompleted(x,K);if(aj&&this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),533,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section did NOT want to be printed but it was partially printed on previous page -> Printing section")}}if(!aj){aj|=this.WantToPrint(x,(K!=null?K.DSEState:null))}if(aj){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),534,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section wants to print something on the page")}var u=this.GetASectionState(K);var X=new ArrayList();if(c!=null){X.Add(c)}else{this.FindMastroBoxesInThisPage(X,B)}if(ag==null||c!=null||x.DSEState.ActualPosition!=K.DSEState.ActualPosition){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),535,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Creating a new instance from design time section")}for(var ap=0;ap<this.BoxList.Count();ap++){if(this.BoxList[ap].GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){var P=this.BoxList[ap].GetARptBox(this.Parent.DSE);u.BoxStates.Add(P)}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),536,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Fire OnBeforeFormatting event")}if(X.Count()>0){u.MastroBox=X[0]}else{u.MastroBox=null}this.Parent.Parent.FormattingObj=u;this.Parent.Parent.FormattingType=IDREGlb.FRM_SECTION;this.Parent.FormattingObj=u;var d=this.Parent.Parent.Parent.GetNewID2OldID(this.SectionID);this.Parent.Parent.Parent.Fire_OnFormattingSection(d);this.Parent.Parent.FormattingType=IDREGlb.FRM_NONE;this.Parent.Parent.FormattingObj=null;for(var af=0;af<u.BoxStates.Count();af++){var h=u.BoxStates[af];h.HandleHTML(this.Parent.DSE)}for(var af=0;af<u.BoxStates.Count();af++){var h=u.BoxStates[af];if(!h.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){h.DeleteNullSpans()}}j.set(u.Reprint);if(!u.GetFlag(IDREGlb.FL_SECT_VISIBLE)){u=null;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),537,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has been hidden during OnBeforeFormatting event. Skipping...")}return true}for(var ai=0;ai<u.BoxStates.Count();ai++){var N=u.BoxStates[ai];if(N.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){N.LogDSEpositions()}}u.PrevBottomBorder=u.GetBottomBorder()}else{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),538,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section was previously formatted -> Retrieving instance from cache")}u.CopyFrom(ag);this.GH_PageNum=u.GH_PageNum}if(u.GetFlag(IDREGlb.FL_SECT_NEWPGBEFORE)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),539,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Flag NewPageBefore set -> filling all boxes in the current page (except PH or PF if they are in a box different from mine)")}this.FillAllReportsMastros(B,true)}var o=null;var R=false;var ac;for(var D=0;D<X.Count();D++){var T=X[D];TryNextColumn:do{u.Reset();u.MastroBox=T;u.Arrange();TryNextBox:{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),540,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Formatting Sub-Reports or Sub-Graphs")}for(var n=0;n<u.BoxStates.Count();n++){var S=u.BoxStates[n];if(S.FormatGraph()){continue}var aa=0;for(var am=0;am<X.Count();am++){var M=X[am];aa=Math.max(aa,M.Height-M.YFilledPos-S.YPos-u.PrevBottomBorder)}if(aa<S.Height){aa=S.Height}var aq=S.FormatSubReport(aa);if(aq>S.Height){S.Height=aq}}for(var n=0;n<u.BoxStates.Count();n++){var S=u.BoxStates[n];if(S.VRsz==IDREGlb.RSZ_STRETCH||!S.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){S.HandleVertResize()}}var a=u.GetBottomBorder();if(a<u.PrevBottomBorder){var al=u.Height;u.Height+=u.PrevBottomBorder-a;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),541,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Bottom border has changed. Fixing it (PreviousHeight = "+this.Parent.Parent.InternalUnitToString(al)+", NewHeight = "+this.Parent.Parent.InternalUnitToString(u.Height)+")")}}if(u.GetFlag(IDREGlb.FL_SECT_OVERLAY)){T.YFilledPos=T.YFilledPosPrev}var z;if(c!=null){z=c.SubSections}else{z=B.Sections}var H=null;if(z!=null){for(var af=z.Count()-1;af>=0;af--){var I=z[af];if(I.MastroBox==u.MastroBox){H=I;break}}}if(H!=null&&H.NumCol!=((u.NumCol!=0)?u.NumCol:this.NumCol)&&H.MastroBox.LastColumnUsed>0){H.MastroBox.LastColumnUsed=0;if(H.MastroBox.YFilledPos<H.MastroBox.Height){if(H.MastroBox.YFilledPos+H.Height>H.MastroBox.Height){H.Height=H.MastroBox.Height-H.MastroBox.YFilledPos}H.MastroBox.YFilledPos+=H.Height;H.MastroBox.YFilledPosPrev=H.MastroBox.YFilledPos}}o=this.GetASection(u);o.Parent=B;ac=0;for(var af=0;af<u.BoxStates.Count();af++){var S=u.BoxStates[af];var L=true;if(!S.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(S.ParentRptBox.BoxID),542,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(S.ParentRptBox.BoxID)+": Box is invisible -> Skipping")}L=false}if(S.GetFlag(IDREGlb.FL_RPTBOX_OMITZERO)&&S.IsZero()){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(S.ParentRptBox.BoxID),543,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(S.ParentRptBox.BoxID)+": Box has OmitIfZero flag set and it is ZERO -> Skipping")}L=false}if(this.Parent.Parent.IsPrinting&&!S.GetFlag(IDREGlb.FL_RPTBOX_TOPRINT)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(S.ParentRptBox.BoxID),544,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(S.ParentRptBox.BoxID)+": Box has ShowWhenPrinted flag set and the book is printing -> Skipping")}L=false}if(!this.Parent.Parent.IsPrinting&&!S.GetFlag(IDREGlb.FL_RPTBOX_TOPREVIEW)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(S.ParentRptBox.BoxID),545,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(S.ParentRptBox.BoxID)+": Box has ShowWhenPreviewed flag set and the book is shown in preview -> Skipping")}L=false}if(S.GetFlag(IDREGlb.FL_RPTBOX_OMITDUPL)&&z!=null){var J=null;for(var f=z.Count()-1;f>=0;f--){var I=z[f];for(var ap=0;ap<I.BoxList.Count();ap++){if(I.BoxList[ap].ParentRptBox==S.ParentRptBox){J=I.BoxList[ap];break}}if(J!=null){break}}if(J!=null){var r;for(r=0;r<S.Spans.Count();r++){var y=S.Spans[r];if(y.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)&&J.Spans[r]!=null&&!y.Value.equals((J.Spans[r]).Value)){break}}if(r==S.Spans.Count()){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(S.ParentRptBox.BoxID),546,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(S.ParentRptBox.BoxID)+": Box has OmitDuplicate flag set and the previous instance was exactly equal to me -> Skipping")}L=false}}}if(!L){S=null;u.BoxStates.RemoveAt(af--);continue}var ao=null;if(S.ParentRptBox.NextBox!=null){for(var ad=0;ad<u.BoxStates.Count();ad++){var ap=u.BoxStates[ad];if(ap.ParentRptBox==S.ParentRptBox.NextBox){ao=ap;break}}}var W=S.FormatPage(T,ao);if(W!=null){W.ParentSect=o;o.BoxList[ac++]=W;if(S.IsCompleted()){S=null;u.BoxStates.RemoveAt(af--)}else{if(S.VRsz==IDREGlb.RSZ_STRETCH){S.Height=0;if(S.SubSections!=null){u.Height=u.GetBottomBorder()+u.PrevBottomBorder}}}}}IDREGlb.SetArraySize(o.BoxList,ac);if(T.YFilledPos==0){for(var Q=0;Q<this.Parent.SectionsList.Count();Q++){var I=this.Parent.SectionsList[Q];if(I==this){break}if(I.SectType==IDREGlb.SECT_GROUPHEADER&&I.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)){var Z=new ArrayList();I.FindMastroBoxesInThisPage(Z,B);if(Z.Contains(T)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(I.SectionID),547,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(I.SectionID)+": Section is a GH and has ShowOnNewPage flag set -> Printing it now")}I.FormatPage(t,B,true,O,C,j,c)}}}o.YPos=T.YFilledPos}if(K!=null&&this.SectType!=IDREGlb.SECT_REPORTHEADER&&this.SectType!=IDREGlb.SECT_PAGEHEADER&&this.SectType!=IDREGlb.SECT_PAGEFOOTER){for(var af=0;af<K.SectionStates.Count();af++){var q=K.SectionStates[af];if(q.ParentSection.SectType==IDREGlb.SECT_PAGEHEADER||q.ParentSection.SectType==IDREGlb.SECT_PAGEFOOTER){continue}if(q.ParentSection.SectType<this.SectType){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),571,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section was formatted but will NOT be printed in this page at this moment because section '"+this.Parent.Parent.Parent.GetObjName(q.ParentSection.SectionID)+"' was not completely printed on this page.")}for(var ap=0;ap<o.BoxList.Count();ap++){var N=o.BoxList[ap];var ak=0;for(var ae=0;ae<u.BoxStates.Count();ae++){var an=u.BoxStates[ae];if(N.ParentRptBox.BoxID<an.ParentRptBox.BoxID){break}ak++}u.BoxStates.Insert(ak,N)}o.BoxList.Clear();for(var U=u.BoxStates.Count()-1;U>=0;U--){var h=u.BoxStates[U];if(h.ParentRptBox.SubReport!=null){h.LastColumnUsed=0}var ao=null;if(h.ParentRptBox.NextBox!=null){for(var ah=0;ah<u.BoxStates.Count();ah++){var ap=u.BoxStates[ah];if(ap.ParentRptBox==h.ParentRptBox.NextBox){ao=ap;break}}for(var r=0;r<ao.Spans.Count();r++){if(ao.Spans[r]!=null){if(h.Spans[r]!=null){h.Spans[r].Text+=ao.Spans[r].Text}else{h.Spans[r]=ao.Spans[r];h.Spans[r].Parent=h}ao.Spans[r]=null}}}}o=null;R=true;break TryNextBox}}}if(T.Height-T.YFilledPos>0&&(!o.ContainsBoxes()||ac==0)){if(!o.IsFullyPrinted()||u.BoxStates.Count()>0){if(o.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){for(var ap=0;ap<o.BoxList.Count();ap++){var N=o.BoxList[ap];var ak=0;for(var ae=0;ae<u.BoxStates.Count();ae++){var an=u.BoxStates[ae];if(N.ParentRptBox.BoxID<an.ParentRptBox.BoxID){break}ak++}u.BoxStates.Insert(ak,N)}o.BoxList.Clear();for(var U=u.BoxStates.Count()-1;U>=0;U--){var h=u.BoxStates[U];if(h.ParentRptBox.SubReport!=null){h.LastColumnUsed=0}var ao=null;if(h.ParentRptBox.NextBox!=null){for(var ah=0;ah<u.BoxStates.Count();ah++){var ap=u.BoxStates[ah];if(ap.ParentRptBox==h.ParentRptBox.NextBox){ao=ap;break}}for(var r=0;r<ao.Spans.Count();r++){if(ao.Spans[r]!=null){if(h.Spans[r]!=null){h.Spans[r].Text+=ao.Spans[r].Text}else{h.Spans[r]=ao.Spans[r];h.Spans[r].Parent=h}ao.Spans[r]=null}}}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),548,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section was partially printed but it can't be split (KeepTogether flag set). Trying next box in the box chain")}o=null;R=true;break TryNextBox}else{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),549,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has been partially printed")}}o.Height=T.Height-T.YFilledPos;if(o.GetFlag(IDREGlb.FL_SECT_HIDEEMPTY)&&o.IsEmpty()&&u.IsEmpty()){u=null;o=null;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),550,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section is empty and it has the HideIfEmpty flag set -> Skipping")}if(K!=null&&K.PrintedSomething==0){K.PrintedSomething=(B!=null?B.PageNum:-1)}return true}if(this.SectType==IDREGlb.SECT_GROUPHEADER&&o.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)){var m=this.Parent.GetPermanentState(this.SectionID,this.Parent.DSE.GetCurrentPosition());if(m!=null&&m.PageNum==-1){m.PageNum=o.Parent.PageNum}}if(this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&K!=null){if(this.Parent.DSE.IsMyGroupTime(this.GroupLevel,true,K.DSEState)){this.GH_PageNum=o.Parent.PageNum}o.GH_PageNum=this.GH_PageNum;var F=this.Parent.GetPermanentState(this.SectionID,this.Parent.DSE.GetCurrentPosition(),false);if(F!=null){F.PageNum=o.Parent.PageNum;F.GH_PageNum=o.GH_PageNum}else{this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),100,"CSection.FormatPage","Section '"+this.Parent.Parent.Parent.GetObjName(this.SectionID)+"': Can't locate the PermanentState for a GH with ShowNewPage set")}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),551,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Fire OnAfterFormatting event")}this.Parent.Parent.FormattingObj=o;this.Parent.Parent.FormattingType=IDREGlb.FRM_SECTION_AFT;var d=this.Parent.Parent.Parent.GetNewID2OldID(this.SectionID);this.Parent.Parent.Parent.Fire_OnAfterFormattingSection(d);this.Parent.Parent.FormattingType=IDREGlb.FRM_NONE;this.Parent.Parent.FormattingObj=null;this.Parent.FormattingObj=null;if(K!=null&&K.PrintedSomething==0){K.PrintedSomething=(B!=null?B.PageNum:-1)}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),552,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Adding section to the page");this.Parent.Parent.DTTObj.AddParameter("","","Section YPos",this.Parent.Parent.InternalUnitToString(o.YPos));this.Parent.Parent.DTTObj.AddParameter("","","Section Height",this.Parent.Parent.InternalUnitToString(o.Height))}if(c!=null){if(c.SubSections==null){c.SubSections=new ArrayList()}c.SubSections.Add(o)}else{B.Sections.Add(o)}if(o.GetFlag(IDREGlb.FL_SECT_OVERLAY)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),553,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has Overlay flag set but it has been partially printed. Remaining part will NOT be printed anymore -> removing it from cache")}T.YFilledPosPrev=T.YFilledPos;T.YFilledPos=T.Height;u=null;return true}C.set(false);var E=2147483647;for(var g=0;g<u.BoxStates.Count();g++){var S=u.BoxStates[g];E=Math.min(E,S.YPos)}for(var g=0;g<u.BoxStates.Count();g++){var S=u.BoxStates[g];S.YPos-=E}u.Height-=u.PrevBottomBorder;u.Height-=(E-u.PrevBottomBorder);u.SavedHeight=u.Height;if(o.ArrangeColumn()){break TryNextBox}continue TryNextColumn}else{if(T.YFilledPos+o.Height>T.Height){o.Height=T.Height-T.YFilledPos;if(!o.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)&&o.BoxList.Count()==1){var h=o.BoxList[0];if(!h.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)&&h.SubSections!=null&&h.SubSections.Count()>0){if(h.Height<o.Height){var l=o.ParentSection.Height-h.ParentRptBox.Height;o.Height=h.Height+l}}}}if(o.GetFlag(IDREGlb.FL_SECT_HIDEEMPTY)&&o.IsEmpty()){u=null;o=null;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),554,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section is empty and it has the HideIfEmpty flag set -> Skipping")}if(K!=null&&K.PrintedSomething==0){K.PrintedSomething=(B!=null?B.PageNum:-1)}return true}T.YFilledPosPrev=T.YFilledPos;if(o.ArrangeColumn()){var A=o.Height;if(o.XPos!=0&&z!=null){for(var v=z.Count()-1;v>=0;v--){var I=z[v];if(I.MastroBox!=o.MastroBox){break}A=Math.max(A,I.Height);if(I.XPos==0){break}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&o.Height!=A){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),555,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has ColumnNumber!=1 -> Adapting MastroBox filling state to the maximum heigth of other sections in the current 'row'");this.Parent.Parent.DTTObj.AddParameter("","","Section Height",this.Parent.Parent.InternalUnitToString(o.Height));this.Parent.Parent.DTTObj.AddParameter("","",'"Row" Height',this.Parent.Parent.InternalUnitToString(A))}}T.YFilledPos+=A}if(!o.GetFlag(IDREGlb.FL_SECT_OVERLAY)){T.YFilledPosPrev=T.YFilledPos}u=null;if(this.SectType==IDREGlb.SECT_GROUPHEADER&&o.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)){var m=this.Parent.GetPermanentState(this.SectionID,this.Parent.DSE.GetCurrentPosition());if(m!=null&&m.PageNum==-1){m.PageNum=o.Parent.PageNum}}if(this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&K!=null){if(this.Parent.DSE.IsMyGroupTime(this.GroupLevel,true,K.DSEState)){this.GH_PageNum=o.Parent.PageNum}o.GH_PageNum=this.GH_PageNum;var F=this.Parent.GetPermanentState(this.SectionID,this.Parent.DSE.GetCurrentPosition(),false);if(F!=null){F.PageNum=o.Parent.PageNum;F.GH_PageNum=o.GH_PageNum}else{this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),100,"CSection.FormatPage","Section '"+this.Parent.Parent.Parent.GetObjName(this.SectionID)+"': Can't locate the PermanentState for a GH with ShowNewPage set")}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),556,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Fire OnAfterFormatting event")}this.Parent.Parent.FormattingObj=o;this.Parent.Parent.FormattingType=IDREGlb.FRM_SECTION_AFT;var d=this.Parent.Parent.Parent.GetNewID2OldID(this.SectionID);this.Parent.Parent.Parent.Fire_OnAfterFormattingSection(d);this.Parent.Parent.FormattingType=IDREGlb.FRM_NONE;this.Parent.Parent.FormattingObj=null;this.Parent.FormattingObj=null;if(K!=null&&K.PrintedSomething==0){K.PrintedSomething=(B!=null?B.PageNum:-1)}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),557,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Adding section to the page");this.Parent.Parent.DTTObj.AddParameter("","","Section YPos",this.Parent.Parent.InternalUnitToString(o.YPos));this.Parent.Parent.DTTObj.AddParameter("","","Section Height",this.Parent.Parent.InternalUnitToString(o.Height))}if(c!=null){if(c.SubSections==null){c.SubSections=new ArrayList()}c.SubSections.Add(o)}else{B.Sections.Add(o)}if(K!=null&&K.DSEState.HideGroupLevel!=-1){var V=false;if(this.SectType==IDREGlb.SECT_GROUPFOOTER&&this.GroupLevel>=K.DSEState.HideGroupLevel){V=true;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),558,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": ShowChildren of one of previous GH sections is False,  this is a GF and its level is equal to the GH level -> Remove filtering. From now on sections will be shown")}}else{if(this.SectType==IDREGlb.SECT_GROUPHEADER){if(o.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)&&this.GroupLevel>=K.DSEState.HideGroupLevel){V=true;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),559,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": ShowChildren of one of previous GH sections is False,  this is a GH and its level is equal to the GH level -> Remove filtering. From now on sections will be shown")}}else{if(!o.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)&&this.GroupLevel>K.DSEState.HideGroupLevel){V=true;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),560,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": ShowChildren of one of previous GH sections is False,  my level is equal to the GH level -> Remove filtering. From now on sections will be shown")}}}}}if(V){K.DSEState.HideGroupLevel=-1}}if(K!=null&&this.SectType==IDREGlb.SECT_GROUPHEADER&&!o.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)){K.DSEState.HideGroupLevel=this.GroupLevel;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),561,"CSection.FormatPage","Section '"+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has ShowChildren flag set to False -> Adding filtering. From now on all sections with level below "+this.GroupLevel+" will be hidden")}}if(o.GetFlag(IDREGlb.FL_SECT_NEWPGAFTER)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),562,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Flag NewPageBefore set -> Filling all boxes in the current page (except for PH or PF if they are in a box different from mine)")}this.FillAllReportsMastros(B)}C.set(true);if(o.GetFlag(IDREGlb.FL_SECT_SHOWBOTTOMBOX)){o.YPos=T.Height-o.Height;T.YFilledPos=T.Height;if(!o.GetFlag(IDREGlb.FL_SECT_OVERLAY)){T.YFilledPosPrev=T.YFilledPos}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),563,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Flag ShowBottomBox set -> Moving the section to the bottom of the Mastro box (YPos = "+this.Parent.Parent.InternalUnitToString(o.YPos)+", MastroBoxHeight = "+this.Parent.Parent.InternalUnitToString(T.Height)+")")}C.set(false)}return true}}else{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),564,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has not been printed. Trying next box in the mastro chain (if available)")}o=null;R=true;break TryNextBox}}if(c==null&&R&&C.get()){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),565,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has NOT been printed -> Kept in cache for next page")}var k=null;var v;for(v=B.Sections.Count()-1;v>=0;v--){var Y=B.Sections[v];if(Y.MastroBox!=T){k=null;break}if(Y.ParentSection==this){break}if(!Y.ParentSection.GetFlag(IDREGlb.FL_SECT_KEEPNEXT)){break}if(k!=null&&k.ParentSection==Y.ParentSection){break}k=Y}if(k!=null){v++}if(k!=null&&v>0){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),566,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has not been printed and previous instance of section "+this.Parent.Parent.Parent.GetObjName(k.ParentSection.SectionID)+" had the KeepWithNextSection flag set -> Removing that from the current page and storing it in cache with me (will print on next page)")}O.set(true);T.YFilledPos=T.Height;T.YFilledPosPrev=T.Height;this.Parent.DSE.SetCurrentPosition(k.DSEPosition);K.DSEState.ActualPosition=k.DSEPosition;B.Sections.splice(v,B.Sections.Count()-v);u=null;o=null;return true}}T.YFilledPosPrev=T.YFilledPos;T.YFilledPos=T.Height;if(o!=null&&!o.GetFlag(IDREGlb.FL_SECT_OVERLAY)){T.YFilledPosPrev=T.YFilledPos}}while(false)}u.Reset();if((u.BoxStates.Count()!=0||this.BoxList.Count()==0)&&c==null){K.SectionStates.Add(u)}else{u=null}return false}else{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),567,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section does NOT want to print (maybe is not the right time to do it and was not partially printed before)")}}return true};CSection.prototype.FillAllReportsMastros=function(e,b){if(b==undefined){b=false}var g=new ArrayList();for(var j=0;j<this.Parent.SectionsList.Count();j++){var f=this.Parent.SectionsList[j];if(f.SectType==IDREGlb.SECT_PAGEHEADER||f.SectType==IDREGlb.SECT_PAGEFOOTER){continue}if(!f.GetFlag(IDREGlb.FL_SECT_VISIBLE)){continue}if(f.RendersInto==null){continue}var h=new ArrayList();f.FindMastroBoxesInThisPage(h,e);g.AddRange(h)}if(b){var c=true;for(var a=0;a<g.Count();a++){var d=g[a];if(d.YFilledPos!=0){c=false;break}}if(c){return}}for(var a=0;a<g.Count();a++){var d=g[a];d.YFilledPos=d.Height;d.YFilledPosPrev=d.Height}};CSection.prototype.FindMastroBoxesInThisPage=function(e,d){var g=this.SearchMyCurrentBox(d.ParentMastro);if(g==null){return}e.Add(g);while(g.PMastro==d.ParentMastro){g=g.NextBox;if(g==null||e.IndexOf(g)!=-1){break}e.Add(g)}for(var h=0;h<e.Count();h++){var f=e[h];var c=null;for(var a=0;a<d.MastroBoxes.Count();a++){if(d.MastroBoxes[a].ParentRptBox==f){c=d.MastroBoxes[a];break}}if(c!=null&&(c.YFilledPos<c.Height||(this.GetFlag(IDREGlb.FL_SECT_OVERLAY)&&c.YFilledPosPrev<c.Height))){e[h]=c}else{e.RemoveAt(h--)}}};CSection.prototype.GetASection=function(a){var b=new ASection();b.ParentSection=this;b.MastroBox=a.MastroBox;b.XPos=0;b.YPos=a.MastroBox.YFilledPos;b.Height=a.Height;b.InitFlags(a.GetFlags());b.VisAttrIdx=a.VisAttrIdx;b.ColSpace=a.ColSpace;b.NumCol=a.NumCol;b.GH_DSEPos=a.GH_DSEPos;b.PageChanged=a.PageChanged;b.ClassName=a.ClassName;if(a.Parent!=null){b.DSEPosition=a.Parent.DSEState.ActualPosition}else{b.DSEPosition=a.ParentSection.Parent.DSE.GetCurrentPosition()}b.GetRD3Ident();IDREGlb.SetArraySize(b.BoxList,a.BoxStates.Count());return b};CSection.prototype.GetASectionState=function(c){var a=new ASectionState();a.Parent=c;a.ParentSection=this;a.Height=this.Height;a.InitFlags(this.GetFlags());a.VisAttrIdx=this.VisAttrIdx;a.ColSpace=this.ColSpace;a.NumCol=0;a.ClassName=this.ClassName;if(this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&c!=null){if(this.Parent.DSE.IsMyGroupTime(this.GroupLevel,true,c.DSEState)){this.GH_DSEPos=c.DSEState.ActualPosition}a.GH_DSEPos=this.GH_DSEPos;var d=this.Parent.GetPermanentState(this.SectionID,this.Parent.DSE.GetCurrentPosition());if(d==null){d=new PSectionState();this.Parent.PermStatesList.Add(d);d.SectionID=this.SectionID;d.DSECurrentPosition=this.Parent.DSE.GetCurrentPosition();d.Flags=this.GetFlags();d.GH_DSECurrentPosition=a.GH_DSEPos}}var b=this.Parent.GetPermanentState(a);if(b!=null){a.InitFlags(b.Flags)}return a};CSection.prototype.InitFlags=function(a){this.Flags=a};CSection.prototype.GetFlags=function(){var a=this.Flags;if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_SECT_VISIBLE}return a};CSection.prototype.GetFlag=function(a){if(a==IDREGlb.FL_SECT_VISIBLE&&(this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return(this.Flags&a)!=0};CSection.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_SECT_VISIBLE}};CSection.prototype.SetRoleFlag=function(c){this.RoleFlag=c;for(var a=0;a<this.BoxList.Count();a++){this.BoxList[a].SetRoleFlag(c)}};CSection.prototype.IsChildOf=function(d){if(d==this){return true}for(var a=0;a<this.BoxList.Count();a++){var e=this.BoxList[a];if(e==d){return true}for(var f=0;f<e.SpanList.Count();f++){var c=e.SpanList[f];if(c==d){return true}}}return false};function CSpanDiv(){this.DataType=0;this.Riga=0;this.TextHeight=0;this.TextWidth=0;this.TextAscent=0;this.TextLineGap=0;this.Point=new Object();this.Point.X=0;this.Point.Y=0;this.Text="";this.Span=null;this.CharPos=new ArrayList();this.JustSpace=0;this.DelSpaces=0;this.DelSpacesWidth=0}CSpanDiv.prototype.GetText=function(a){if(a<0){return""}a+=2;if(this.TextWidth>a){var b=0;for(var c=0;c<this.Text.length;c++){b+=this.CharPos[c];if(b>a){return this.Text.substr(0,c)}}}return this.Text};function IDREGlb(){}IDREGlb.INT_MAX=2147483647;IDREGlb.CLR_NONE=-1;IDREGlb.IMDB_CURSOR=10;IDREGlb.DT_LEFT=0;IDREGlb.DT_CENTER=1;IDREGlb.DT_RIGHT=2;IDREGlb.PRN_NONE=0;IDREGlb.PRN_SCREEN=1;IDREGlb.PRN_PRINTER=2;IDREGlb.PRN_PDF=3;IDREGlb.PRN_ABCPDF=4;IDREGlb.DEV_NONE=0;IDREGlb.DEV_SCREEN=1;IDREGlb.DEV_PRINTER=2;IDREGlb.DEV_PDF=3;IDREGlb.RECT_LEFT=1;IDREGlb.RECT_TOP=2;IDREGlb.RECT_WIDTH=3;IDREGlb.RECT_HEIGHT=4;IDREGlb.DTC_NONE=0;IDREGlb.DTC_NUMBER=1;IDREGlb.DTC_CHAR=2;IDREGlb.DTC_DATE=3;IDREGlb.DTC_DOC=4;IDREGlb.DTC_BOOL=5;IDREGlb.DTC_OBJECT=6;IDREGlb.DT_UNSPEC=0;IDREGlb.DT_NUM_INTEGER=1;IDREGlb.DT_NUM_FLOAT=2;IDREGlb.DT_NUM_FIXED=3;IDREGlb.DT_NUM_CURRENCY=4;IDREGlb.DT_CHAR=5;IDREGlb.DT_CHAR_FIXED=12;IDREGlb.DT_DATE=6;IDREGlb.DT_TIME=7;IDREGlb.DT_DATETIME=8;IDREGlb.DT_DOC_TEXT=9;IDREGlb.DT_DOC_OLE=10;IDREGlb.DT_BOOLEAN=11;IDREGlb.DT_OBJECT=13;IDREGlb.PR_USER=32;IDREGlb.RSZ_NONE=1;IDREGlb.RSZ_MOVE=2;IDREGlb.RSZ_STRETCH=3;IDREGlb.STRTC_AUTO=1;IDREGlb.STRTC_NONE=2;IDREGlb.STRTC_FILL=3;IDREGlb.STRTC_ENLARGE=4;IDREGlb.STRTC_CROP=5;IDREGlb.BCM_PRINT=1;IDREGlb.BCM_NAVIGATION=2;IDREGlb.BCM_CSV=4;IDREGlb.PR_VIS_COLORS=IDREGlb.PR_USER;IDREGlb.PR_VIS_FONTS=IDREGlb.PR_USER+1;IDREGlb.PR_VIS_BORDER=IDREGlb.PR_USER+2;IDREGlb.PR_VIS_OFFSET=IDREGlb.PR_USER+3;IDREGlb.PR_VIS_MASK=IDREGlb.PR_USER+4;IDREGlb.PR_VIS_CONTROL=IDREGlb.PR_USER+5;IDREGlb.PR_VIS_ALIGN=IDREGlb.PR_USER+6;IDREGlb.FL_VIS_PASSWORD=65536;IDREGlb.FL_VIS_SHOWVALUE=131072;IDREGlb.FL_VIS_SHOWDESCR=262144;IDREGlb.FL_VIS_SHOWIMAGE=524288;IDREGlb.FL_VIS_PREVFORM=1048576;IDREGlb.FL_VIS_HYPERLINK=2097152;IDREGlb.FL_VIS_EMBEDFONT=4194304;IDREGlb.FL_VIS_UNICODE=8388608;IDREGlb.VISCLR_FOREVALUE=1;IDREGlb.VISCLR_FOREHEAD=2;IDREGlb.VISCLR_FOREGROUP=3;IDREGlb.VISCLR_BACKVALUE=4;IDREGlb.VISCLR_ALTVALUE=5;IDREGlb.VISCLR_BACKPANEL=6;IDREGlb.VISCLR_BACKHEAD=7;IDREGlb.VISCLR_BACKGROUP=8;IDREGlb.VISCLR_HILIGHT=9;IDREGlb.VISCLR_EDITING=10;IDREGlb.VISCLR_BORDERS=11;IDREGlb.VISCLR_BACKGRPFORM=12;IDREGlb.VISCLR_FOREGRPFORM=13;IDREGlb.VISCLR_BACKQBE=14;IDREGlb.VISCLR_BACKREADONLY=15;IDREGlb.VISCLR_HILIGHTREADONLY=16;IDREGlb.VISCLR_BACKHEADFRM=17;IDREGlb.VISFNT_VALUE=1;IDREGlb.VISFNT_HEAD=2;IDREGlb.VISFNT_GROUP=3;IDREGlb.VISBRD_NONE=1;IDREGlb.VISBRD_HORIZ=2;IDREGlb.VISBRD_VERT=3;IDREGlb.VISBRD_FRAME=4;IDREGlb.VISBRD_SUNKEN=5;IDREGlb.VISBRD_RAISED=6;IDREGlb.VISBRD_ETCHED=7;IDREGlb.VISBRD_BUMP=8;IDREGlb.VISBRD_CUSTOM=9;IDREGlb.VISBDI_VALUE=1;IDREGlb.VISBDI_HEAD=2;IDREGlb.VISBDI_GROUP=3;IDREGlb.VISBDI_HDRFORM=4;IDREGlb.VISBDI_GRPFORM=5;IDREGlb.VISBDI_VALFORM=6;IDREGlb.VISCBOR_TOP=1;IDREGlb.VISCBOR_RIGHT=2;IDREGlb.VISCBOR_BOTTOM=3;IDREGlb.VISCBOR_LEFT=4;IDREGlb.VISCTYP_SOLID=1;IDREGlb.VISCTYP_DOTTED=2;IDREGlb.VISCTYP_DASHED=3;IDREGlb.VISCTYP_DOUBLE=4;IDREGlb.VISGRADDIR_NONE=1;IDREGlb.VISGRADDIR_HORIZ=2;IDREGlb.VISGRADDIR_VERT=3;IDREGlb.VISALN_AUTO=1;IDREGlb.VISALN_SX=2;IDREGlb.VISALN_CX=3;IDREGlb.VISALN_DX=4;IDREGlb.VISALN_JX=5;IDREGlb.VISVALN_TOP=1;IDREGlb.VISVALN_CENTER=2;IDREGlb.VISVALN_BOTTOM=3;IDREGlb.VISALI_VALUE=1;IDREGlb.VISALI_HDRLIST=2;IDREGlb.VISALI_HDRFORM=3;IDREGlb.VISCTRL_AUTO=1;IDREGlb.VISCTRL_EDIT=2;IDREGlb.VISCTRL_COMBO=3;IDREGlb.VISCTRL_CHECK=4;IDREGlb.VISCTRL_OPTION=5;IDREGlb.VISCTRL_BUTTON=6;IDREGlb.VISCTRL_HTMLEDIT=7;IDREGlb.AGGR_REC=0;IDREGlb.AGGR_SUM=1;IDREGlb.AGGR_AVE=2;IDREGlb.AGGR_VAR=3;IDREGlb.AGGR_DEV=4;IDREGlb.AGGR_CNT=5;IDREGlb.AGGR_MIN=6;IDREGlb.AGGR_MAX=7;IDREGlb.AGGR_DSUM=8;IDREGlb.FRM_NONE=0;IDREGlb.FRM_SECTION=1;IDREGlb.FRM_PAGE=2;IDREGlb.FRM_SECTION_PERM=3;IDREGlb.FRM_SECTION_AFT=4;IDREGlb.OBJ_UNKNOWN=-1;IDREGlb.OBJ_BOOK=0;IDREGlb.OBJ_MASTRO=1;IDREGlb.OBJ_RPTBOX=2;IDREGlb.OBJ_RPTSPAN=3;IDREGlb.OBJ_REPORT=4;IDREGlb.OBJ_SECTION=5;IDREGlb.OBJ_ENABLED=1;IDREGlb.OBJ_VISIBLE=2;IDREGlb.WEBVALID_NONE=0;IDREGlb.WEBVALID_STRICT=1;IDREGlb.BRWCLS_IENORMAL=0;IDREGlb.BRWCLS_IESTRICT=1;IDREGlb.BRWCLS_FIREFOX=2;IDREGlb.BOOKUM_MM=1;IDREGlb.BOOKUM_INCH=2;IDREGlb.FL_BOOK_PRECOUNT=1048576;IDREGlb.FL_BOOK_HIDEBORD=2097152;IDREGlb.MASTRO_PT_CUSTOM=1;IDREGlb.MASTRO_PT_A3=2;IDREGlb.MASTRO_PT_A4=3;IDREGlb.MASTRO_PT_A5=4;IDREGlb.MASTRO_PT_LETTER=5;IDREGlb.MASTRO_PT_LEGAL=6;IDREGlb.MASTRO_PT_EXECUTIVE=7;IDREGlb.MASTRO_PT_FANFOLD_US=8;IDREGlb.MASTRO_PT_FANFOLD_GER=9;IDREGlb.MASTRO_PT_B5=10;IDREGlb.MASTRO_PT_ENVELOPE10=11;IDREGlb.MASTRO_PT_ENVELOPEDL=12;IDREGlb.MASTRO_PT_ENVELOPEC5=13;IDREGlb.MASTRO_PT_ENVELOPEB5=14;IDREGlb.MASTRO_PT_ENVELOPEMONARCH=15;IDREGlb.MASTRO_PT_ENVELOPEITALY=16;IDREGlb.MASTRO_OR_PORTRAIT=1;IDREGlb.MASTRO_OR_LANDSCAPE=2;IDREGlb.MASTRO_FM_NONE=1;IDREGlb.MASTRO_FM_WIDTH=2;IDREGlb.MASTRO_FM_PAGE=3;IDREGlb.FL_RPTBOX_VISIBLE=65536;IDREGlb.FL_RPTBOX_TOPREVIEW=131072;IDREGlb.FL_RPTBOX_TOPRINT=262144;IDREGlb.FL_RPTBOX_KEEPTOGETHER=524288;IDREGlb.FL_RPTBOX_CLOSEBORDER=1048576;IDREGlb.FL_RPTBOX_OMITZERO=2097152;IDREGlb.FL_RPTBOX_OMITDUPL=4194304;IDREGlb.FL_RPTBOX_CANDRAG=8388608;IDREGlb.FL_RPTBOX_CANDROP=16777216;IDREGlb.FL_RPTBOX_CANTRANS=33554432;IDREGlb.FL_RPTBOX_CANSCROLL=67108864;IDREGlb.BOXVISPROP_RESW=1;IDREGlb.BOXVISPROP_RESH=2;IDREGlb.BOXVISPROP_MOVEX=4;IDREGlb.BOXVISPROP_MOVEY=8;IDREGlb.BOXVISPROP_CANCELMOVE=16;IDREGlb.BOXVISPROP_HYPERLINK=32;IDREGlb.RPTBOX_RECTI_X=0;IDREGlb.RPTBOX_RECTI_Y=1;IDREGlb.RPTBOX_RECTI_WIDTH=2;IDREGlb.RPTBOX_RECTI_HEIGHT=3;IDREGlb.FL_REPORT_HIDEIFEMPTY=65536;IDREGlb.FL_REPORT_VISIBLE=131072;IDREGlb.FL_REPORT_ANYPAGE=262144;IDREGlb.FL_SECT_VISIBLE=65536;IDREGlb.FL_SECT_NEWPGAFTER=131072;IDREGlb.FL_SECT_NEWPGBEFORE=262144;IDREGlb.FL_SECT_KEEPTOGETHER=524288;IDREGlb.FL_SECT_KEEPNEXT=1048576;IDREGlb.FL_SECT_HIDEEMPTY=2097152;IDREGlb.FL_SECT_VERTICAL=4194304;IDREGlb.FL_SECT_SHOWCHILD=8388608;IDREGlb.FL_SECT_OVERLAY=16777216;IDREGlb.FL_SECT_SHOWNEWPAGE=33554432;IDREGlb.FL_SECT_SHOWBOTTOMBOX=67108864;IDREGlb.SECT_REPORTHEADER=1;IDREGlb.SECT_PAGEHEADER=2;IDREGlb.SECT_GROUPHEADER=3;IDREGlb.SECT_DETAIL=4;IDREGlb.SECT_GROUPFOOTER=5;IDREGlb.SECT_PAGEFOOTER=6;IDREGlb.SECT_REPORTFOOTER=7;IDREGlb.PR_SPAN_DOMAIN=IDREGlb.PR_USER;IDREGlb.FL_RPTSPAN_VISIBLE=268435456;IDREGlb.FL_RPTSPAN_ENABLED=536870912;IDREGlb.FL_RPTSPAN_ACTIVE=1073741824;IDREGlb.ClassDT=function(a){switch(a){case IDREGlb.DT_NUM_CURRENCY:case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_FLOAT:case IDREGlb.DT_NUM_INTEGER:return IDREGlb.DTC_NUMBER;case IDREGlb.DT_DATE:case IDREGlb.DT_TIME:case IDREGlb.DT_DATETIME:return IDREGlb.DTC_DATE;case IDREGlb.DT_CHAR:case IDREGlb.DT_CHAR_FIXED:case IDREGlb.DT_DOC_TEXT:return IDREGlb.DTC_CHAR;case IDREGlb.DT_DOC_OLE:return IDREGlb.DTC_DOC;case IDREGlb.DT_UNSPEC:return IDREGlb.DTC_NONE;case IDREGlb.DT_BOOLEAN:return IDREGlb.DTC_BOOL;case IDREGlb.DT_OBJECT:return IDREGlb.DTC_OBJECT;default:return IDREGlb.DTC_NONE}};IDREGlb.GetADOSize=function(b,a){switch(b){case IDREGlb.DT_NUM_INTEGER:case IDREGlb.DT_NUM_FLOAT:case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_CURRENCY:if(a<29){return a}else{return 28}case IDREGlb.DT_DATETIME:case IDREGlb.DT_DATE:case IDREGlb.DT_TIME:case IDREGlb.DT_CHAR:case IDREGlb.DT_CHAR_FIXED:return a;case IDREGlb.DT_DOC_TEXT:case IDREGlb.DT_DOC_OLE:return IDREGlb.INT_MAX;default:return 0}};IDREGlb.GetOLEType=function(a){switch(a){case IDREGlb.DT_NUM_INTEGER:case IDREGlb.DT_BOOLEAN:return IDVariant.INTEGER;case IDREGlb.DT_NUM_FLOAT:return IDVariant.FLOAT;case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_CURRENCY:return IDVariant.DECIMAL;case IDREGlb.DT_DATE:case IDREGlb.DT_TIME:case IDREGlb.DT_DATETIME:return IDVariant.DATETIME;case IDREGlb.DT_CHAR:case IDREGlb.DT_CHAR_FIXED:case IDREGlb.DT_DOC_TEXT:return IDVariant.STRING;default:return IDVariant.NULL}};IDREGlb.SetArraySize=function(c,a){if(a==c.Count()){return}if(a<c.Count()){for(var b=c.Count();b>a;b--){c.RemoveAt(c.Count()-1)}}else{for(var b=c.Count();b<a;b++){c.Add(null)}}};function MyBoolean(a){this.Value=false;if(a!=undefined){this.Value=a}}MyBoolean.prototype.set=function(a){this.Value=a};MyBoolean.prototype.get=function(){return this.Value};function MyFont(d,b,a){this.Name="";this.Bold=false;this.Italic=false;this.Underline=false;this.StrikeOut=false;this.EmbedFont=false;this.UnicoFont=false;this.Size=0;this.Ascent=0;this.Height=0;this.LineGap=0;this.LetterSpacing=-1;this.WordSpacing=-1;this.HorizontalScale=-1;this.Font=null;this.Name=d.substr(0,d.indexOf(","));d=d.substr(d.indexOf(",")+1);var c=d.substr(0,d.indexOf(","));this.EmbedFont=b;this.UnicoFont=a;this.Bold=c.indexOf("B")!=-1;this.Italic=c.indexOf("I")!=-1;this.Underline=c.indexOf("U")!=-1;this.StrikeOut=c.indexOf("S")!=-1;d=d.substr(d.indexOf(",")+1);this.Size=parseFloat(d);if(isNaN(this.Size)){WriteToConsoleError("[MyFont::<Init>] NumberFormatException: "+this.Size)}this.Font=PdfFont.getFont(this.Name,this.Bold,this.Italic);this.Font.iIsUnicode=this.UnicoFont;this.Ascent=this.Font.getAscent()*this.Size;this.LineGap=-this.Font.getDescent()*this.Size+this.Font.getLeading()*this.Size;this.Height=this.Ascent+this.LineGap}MyFont.prototype.ServletFont=function(){return this.Font};MyFont.prototype.GetCharacterPlacement=function(e,d,c,b){c.Clear();if(this.Font!=null){for(var a=0;a<d;a++){var f=this.Font.GetCharWidth(e.charCodeAt(a))/1000*this.Size;if(a>0){f+=this.Font.GetKerning(e.charCodeAt(a-1),e.charCodeAt(a))*this.Size}if(this.HorizontalScale!=0&&this.HorizontalScale!=100){f=(f*this.HorizontalScale/100)+0}if(this.LetterSpacing!=0){f+=(this.LetterSpacing+0)/100}if(this.WordSpacing!=0&&e.charAt(a)==" "){f+=(this.WordSpacing+0)/100}if(b!=null&&b instanceof CPEHTML&&b.Parent.HtmlFontHStretch!=0){f*=(1+(b.Parent.HtmlFontHStretch+0)/100)}c.Add(b.FromPointsToPhysical(f))}}};MyFont.prototype.GetStringWidth=function(c,b){var e=0;if(this.Font!=null){for(var a=0;a<c.length;a++){var d=this.Font.GetCharWidth(c.charCodeAt(a))/1000*this.Size;if(a>0){d+=this.Font.GetKerning(c.charCodeAt(a-1),c.charCodeAt(a))*this.Size}if(this.HorizontalScale!=0&&this.HorizontalScale!=100){d=(d*this.HorizontalScale/100)+0}if(this.LetterSpacing!=0){d+=(this.LetterSpacing+0)/100}if(this.WordSpacing!=0&&c.charAt(a)==" "){d+=(this.WordSpacing+0)/100}e+=b.FromPointsToPhysical(d)}}return e};MyFont.prototype.Reset=function(){if(this.Font!=null){this.Font.Reset()}};MyFont.prototype.ToString=function(){var a="";a+="Name = "+this.Name+",";a+=this.Bold?"B":"";a+=this.Italic?"I":"";a+=", "+this.Size;a+="\nHeight = "+this.Height;a+="\nAscent = "+this.Ascent;a+="\nLineGap = "+this.LineGap;a+="\nEMBED = "+this.EmbedFont;a+="\nUNICODE = "+this.UnicoFont;if(this.Font!=null){a+="\nServlet";a+="   FontName = "+this.Font.FontName;a+="   FontPath = "+this.Font.FontPath;a+="   FamilyName = "+this.Font.FamilyName;a+="   FullName = "+this.Font.FullName;a+="   IsBold = "+this.Font.IsBold;a+="   IsItalic = "+this.Font.IsItalic}return a};function MyImage(){this.Image=null}MyImage.prototype.Empty=function(){this.Image=null};MyImage.prototype.IsEmpty=function(){return(this.Image==null)};MyImage.prototype.set_Image=function(a){this.Image=a};MyImage.prototype.set_ServletImage=function(a){if(a instanceof Uint8Array){try{this.Image=PdfDocument.AddImage(a,a.length)}catch(b){WriteToConsoleError("[MyImage::set_ServletImage] Exception: "+b.message)}}else{this.Image=a}};MyImage.prototype.ServletImage=function(){return this.Image};MyImage.prototype.width=function(){if(this.Image!=null){return this.Image.Width}return 0};MyImage.prototype.height=function(){if(this.Image!=null){return this.Image.Height}return 0};MyImage.prototype.LoadServletImage=function(d){try{var g=null;if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(d.startsWith("$SHELL")){d=d.substring(6)}if(d[0]=="/"){d=d.substring(1)}var c=IDL.LoadFile(RD4_WebEntryPoint.GetAppUrl(false)+d);g=new Uint8Array(c)}else{if(d.indexOf(",")!=-1){d=d.substring(d.indexOf(",")+1);var a=atob(d);g=new Uint8Array(a.length);for(var b=0;b<a.length;b++){g[b]=a.charCodeAt(b)}}else{if(d[0]=="/"){d=d.substring(1)}var c=IDL.LoadFile(RD4_WebEntryPoint.GetAppUrl(false)+d);g=new Uint8Array(c)}}this.Image=PdfDocument.AddImage(g,g.length);if(this.Image==null){WriteToConsoleError("[MyImage::LoadServletImage] Image "+d+" not loaded")}return this.Image}catch(f){WriteToConsoleError("[MyImage::LoadServletImage] Image "+d+" Exception: "+f);return null}};function PSectionState(){this.Flags=0;this.DSECurrentPosition=-1;this.SectionID=-1;this.PageNum=-1;this.GH_DSECurrentPosition=-1;this.GH_PageNum=-1}PSectionState.prototype.GetFlag=function(a){return(this.Flags&a)!=0};PSectionState.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}};function VisAttrListIDRE(){this.IVSlist=null;this.CachedFonts=null;this.CachedFonts2=null;this.Parent=null;PdfFont.scanFontDirectory()}VisAttrListIDRE.prototype.set_VisualStyleList=function(d){this.IVSlist=d;this.CachedFonts=new Array(d.Size());for(var b=0;b<d.Size();b++){this.CachedFonts[b]=new Array(VisAttrObjSrv.MAX_FONTS+1);for(var a=0;a<this.CachedFonts[b].length;a++){this.CachedFonts[b][a]=new HashTableSrv()}}this.CachedFonts2=new Array(d.Size());for(var c=0;c<d.Size();c++){this.CachedFonts2[c]=new Array(VisAttrObjSrv.MAX_FONTS+1);for(var a=0;a<this.CachedFonts2[c].length;a++){this.CachedFonts2[c][a]=new HashTableSrv()}}};VisAttrListIDRE.prototype.Size=function(){return this.IVSlist.Size()};VisAttrListIDRE.prototype.set_Size=function(a){this.IVSlist.set_Size(a)};VisAttrListIDRE.prototype.VisualAttribute=function(a){return this.IVSlist.VisualAttribute(a)};VisAttrListIDRE.prototype.set_VisualAttribute=function(a,b){this.IVSlist.set_VisualAttribute(a,b)};VisAttrListIDRE.prototype.Derived=function(a){return this.IVSlist.Derived(a)};VisAttrListIDRE.prototype.set_Derived=function(a,b){this.IVSlist.set_Derived(a,b)};VisAttrListIDRE.prototype.Alignment=function(a,b){return this.IVSlist.Alignment(a,b)};VisAttrListIDRE.prototype.set_Alignment=function(a,c,b){this.IVSlist.set_Alignment(a,c,b)};VisAttrListIDRE.prototype.ControlType=function(a){return this.IVSlist.ControlType(a)};VisAttrListIDRE.prototype.set_ControlType=function(a,b){this.IVSlist.set_ControlType(a,b)};VisAttrListIDRE.prototype.Mask=function(a){return this.IVSlist.Mask(a)};VisAttrListIDRE.prototype.set_Mask=function(a,b){this.IVSlist.set_Mask(a,b)};VisAttrListIDRE.prototype.RowOffset=function(a){return this.IVSlist.RowOffset(a)};VisAttrListIDRE.prototype.set_RowOffset=function(a,b){this.IVSlist.set_RowOffset(a,b)};VisAttrListIDRE.prototype.BorderType=function(a,b){return this.IVSlist.BorderType(a,b)};VisAttrListIDRE.prototype.set_BorderType=function(a,c,b){this.IVSlist.set_BorderType(a,c,b)};VisAttrListIDRE.prototype.Color=function(a,b){return this.IVSlist.Color(a,b)};VisAttrListIDRE.prototype.set_Color=function(a,c,b){this.IVSlist.set_Color(a,c,b)};VisAttrListIDRE.prototype.GradCol=function(a,b){return this.IVSlist.GradCol(a,b)};VisAttrListIDRE.prototype.set_GradCol=function(a,c,b){this.IVSlist.set_GradCol(a,c,b)};VisAttrListIDRE.prototype.GradDir=function(a,b){return this.IVSlist.GradDir(a,b)};VisAttrListIDRE.prototype.set_GradDir=function(a,c,b){this.IVSlist.set_GradDir(a,c,b)};VisAttrListIDRE.prototype.Opacity=function(a,b){return this.IVSlist.Opacity(a,b)};VisAttrListIDRE.prototype.set_Opacity=function(a,c,b){this.IVSlist.set_Opacity(a,c,b)};VisAttrListIDRE.prototype.Font=function(k,b,e,d){if(e==undefined){e=""}if(d==undefined){d=1}var h=null;if(d==2){h=this.CachedFonts2}else{h=this.CachedFonts}var j=this.IVSlist.Font(k,b);if(e.length!=0){var f=j.split(",");f[1]=e;j=f.join(",")}if(h[k][b][j]!=null){return h[k][b][j]}var c=((this.IVSlist.Flags(k)&IDREGlb.FL_VIS_EMBEDFONT)!=0);var a=((this.IVSlist.Flags(k)&IDREGlb.FL_VIS_UNICODE)!=0);var g=new MyFont(j,c,a);g.LetterSpacing=this.IVSlist.LetterSpacing(k);g.HorizontalScale=this.IVSlist.HorizontalScale(k);g.WordSpacing=this.IVSlist.WordSpacing(k);h[k][b][j]=g;return g};VisAttrListIDRE.prototype.set_Font=function(a,c,b){this.IVSlist.set_Font(a,c,b);this.CachedFonts[a][c][b]=null};VisAttrListIDRE.prototype.Flags=function(a){return this.IVSlist.Flags(a)};VisAttrListIDRE.prototype.set_Flags=function(a,b){this.IVSlist.set_Flags(a,b)};VisAttrListIDRE.prototype.CBorColor=function(a,b){return this.IVSlist.CBorColor(a,b)};VisAttrListIDRE.prototype.set_CBorColor=function(a,c,b){this.IVSlist.set_CBorColor(a,c,b)};VisAttrListIDRE.prototype.CBorWidth=function(a,b){return this.IVSlist.CBorWidth(a,b)};VisAttrListIDRE.prototype.set_CBorWidth=function(a,c,b){this.IVSlist.set_CBorWidth(a,c,b)};VisAttrListIDRE.prototype.CBorPadding=function(a,b){return this.IVSlist.CBorPadding(a,b)};VisAttrListIDRE.prototype.set_CBorPadding=function(a,c,b){this.IVSlist.set_CBorPadding(a,c,b)};VisAttrListIDRE.prototype.CBorType=function(a,b){return this.IVSlist.CBorType(a,b)};VisAttrListIDRE.prototype.set_CBorType=function(a,c,b){this.IVSlist.set_CBorType(a,c,b)};VisAttrListIDRE.prototype.ApplyMask=function(e,c,d,b){var a=this.IVSlist.Mask(e);if(a==null||a.length==0){return false}if(!a.equals("=")){d.set(IDL.Format(c,new IDVariant(a),b))}else{d.set(c)}return true};VisAttrListIDRE.prototype.GetPaddings=function(o,q,d,m,r,e,b){if(e==undefined){e=-1}if(b==undefined){b=null}var c=this.BorderType(o,IDREGlb.VISBDI_VALUE);var n=0,h=0,a=0,j=0;switch(c){case IDREGlb.VISBRD_NONE:n=0;h=0;a=0;j=0;break;case IDREGlb.VISBRD_FRAME:case IDREGlb.VISBRD_SUNKEN:case IDREGlb.VISBRD_RAISED:case IDREGlb.VISBRD_ETCHED:case IDREGlb.VISBRD_BUMP:n=12;h=12;a=12;j=12;break;case IDREGlb.VISBRD_HORIZ:n=12;h=0;a=12;j=0;break;case IDREGlb.VISBRD_VERT:n=0;h=12;a=0;j=12;break;case IDREGlb.VISBRD_CUSTOM:n=this.CBorPadding(o,IDREGlb.VISCBOR_TOP);h=this.CBorPadding(o,IDREGlb.VISCBOR_LEFT);a=this.CBorPadding(o,IDREGlb.VISCBOR_BOTTOM);j=this.CBorPadding(o,IDREGlb.VISCBOR_RIGHT);break}if(e!=-1){if(e==IDREGlb.BOOKUM_MM){n=(25.4*100/72/4)*n;h=(25.4*100/72/4)*h;a=(25.4*100/72/4)*a;j=(25.4*100/72/4)*j}else{n=(1000/72/4)*n;h=(1000/72/4)*h;a=(1000/72/4)*a;j=(1000/72/4)*j}}if(b==null||!(b instanceof CPEHTML)){var l=new IDVariant(0);var g=new IDVariant(0);var f=new IDVariant(0);var k=new IDVariant(0);this.GetBorderWidths(o,l,g,f,k,e,b);q.set(new IDVariant(Math.floor(n)+l.intValue()));d.set(new IDVariant(Math.floor(h)+g.intValue()));m.set(new IDVariant(Math.floor(a)+f.intValue()));r.set(new IDVariant(Math.floor(j)+k.intValue()))}};VisAttrListIDRE.prototype.GetBorderWidths=function(n,k,g,e,l,d,b){if(d==undefined){d=-1}if(b==undefined){b=null}var c=this.BorderType(n,IDREGlb.VISBDI_VALUE);var m=0,f=0,a=0,j=0;var h=(b!=null?b.GetBorderSize():1);switch(c){case IDREGlb.VISBRD_NONE:m=0;f=0;a=0;j=0;break;case IDREGlb.VISBRD_FRAME:case IDREGlb.VISBRD_SUNKEN:case IDREGlb.VISBRD_RAISED:case IDREGlb.VISBRD_ETCHED:case IDREGlb.VISBRD_BUMP:m=h;f=h;a=h;j=h;break;case IDREGlb.VISBRD_HORIZ:m=h;f=0;a=h;j=0;break;case IDREGlb.VISBRD_VERT:m=0;f=h;a=0;j=h;break;case IDREGlb.VISBRD_CUSTOM:m=this.CBorWidth(n,IDREGlb.VISCBOR_TOP);f=this.CBorWidth(n,IDREGlb.VISCBOR_LEFT);a=this.CBorWidth(n,IDREGlb.VISCBOR_BOTTOM);j=this.CBorWidth(n,IDREGlb.VISCBOR_RIGHT);break}if(d!=-1){if(d==IDREGlb.BOOKUM_MM){m=(25.4*100/72/4)*m;f=(25.4*100/72/4)*f;a=(25.4*100/72/4)*a;j=(25.4*100/72/4)*j}else{m=(1000/72/4)*m;f=(1000/72/4)*f;a=(1000/72/4)*a;j=(1000/72/4)*j}}k.set(new IDVariant(Math.floor(m)));g.set(new IDVariant(Math.floor(f)));e.set(new IDVariant(Math.floor(a)));l.set(new IDVariant(Math.floor(j)))};VisAttrListIDRE.prototype.ResetFonts=function(e){if(e==undefined){e=1}var f=null;if(e==2){f=this.CachedFonts2}else{f=this.CachedFonts}for(var d=0;d<f.length;d++){for(var b=0;b<f[d].length;b++){var a=f[d][b].values();for(var c=0;c<a.length;c++){if(a[c]!=null){a[c].Reset()}}}}};VisAttrListIDRE.prototype.GetTrueIdx=function(a){return this.IVSlist.GetTrueIdx(a)};function PdfObject(){this.PosOnFile=-1;this.ID=-1;this.Data=null;this.DataSize=-1;this.Doc=null;this.Dict=null;this.HasStream=false}function Boxer(a){this.IntObj=null;this.set(a)}Boxer.prototype.set=function(a){this.IntObj=a};Boxer.prototype.intValue=function(){return this.IntObj};Boxer.prototype.stringValue=function(){return this.IntObj};Boxer.prototype.arrayValue=function(){return this.IntObj};function MemoryStream(a){this.Data=a;this.Pos=0}MemoryStream.prototype.ReadByte=function(){return this.Data[this.Pos++]};MemoryStream.prototype.Read=function(a,d,c){for(var b=d;b<d+c;b++){a[b-d]=this.Data[b]}this.Pos+=c};MemoryStream.prototype.Seek=function(a){this.Pos+=a};PdfObject.ENC_NONE=0;PdfObject.ENC_HEX=1;PdfObject.ENC_A85=2;PdfObject.ENC_FLATE=3;PdfObject.DEFAULT_ENCODING=PdfObject.ENC_A85;PdfObject.GetNUINT=function(d,e,a){if(a==undefined){a=false}var c=0;if(!a){for(var b=0;b<e;b++){c|=d.ReadByte()<<(b*8)}}else{for(var b=0;b<e;b++){c=(c<<8)+d.ReadByte()}}return c};PdfObject.GetUINT=function(b,a){return PdfObject.GetNUINT(b,4,a)};PdfObject.GetSHORT=function(c,a){var b=PdfObject.GetNUINT(c,2,a);if(b>32767){b-=65536}return b};PdfObject.GetUNICODEString=function(c,d){var e="";for(var a=0;a<d/2;a++){var b=((c.ReadByte()<<8)|(c.ReadByte()&255));e+=b}return e};PdfObject.GetString=function(d,e){var a=new Uint8Array(e);for(var c=0;c<e;c++){a[c]=d.ReadByte()}return String.fromCharCode.apply(null,a)};PdfObject.prototype.FormatObject=function(){if(this.HasStream&&this.DataSize>110){this.Encode(PdfObject.DEFAULT_ENCODING)}if(this.Dict!=null){this.Dict.FormatObject()}};PdfObject.prototype.WriteData=function(a){if(this.HasStream){a.data+=PdfDocument.CR;a.data+="stream";a.data+=PdfDocument.CR}if(this.DataSize>0){for(var b=0;b<this.DataSize;b++){a.data+=String.fromCharCode(this.Data[b])}}if(this.HasStream){a.data+=PdfDocument.CR;a.data+="endstream"}};PdfObject.prototype.Save=function(b){try{this.PosOnFile=b.data.length;var a=this.ID+" 0 obj"+PdfDocument.CR;b.data+=a;if(this.Dict!=null){this.Dict.WriteData(b)}this.WriteData(b);a=PdfDocument.CR+"endobj"+PdfDocument.CR;b.data+=a}catch(c){}};PdfObject.prototype.CopyFrom=function(b){this.ID=b.ID;this.PosOnFile=b.PosOnFile;this.DataSize=b.DataSize;this.Data=new Uint8Array(this.DataSize);for(var a=0;a<this.DataSize;a++){this.Data[a]=b.Data[a]}};PdfObject.prototype.GetIndirectRef=function(){return(this.ID+" 0 R")};PdfObject.Src=new Array("\\","\n","\r","\t","\b","\f","(",")");PdfObject.Rep=new Array("\\\\","\\n","\\r","\\t","\\b","\\f","\\(","\\)");PdfObject.AdaptString=function(e){var f=e;for(var a=0;a<PdfObject.Src.length;a++){var d=PdfObject.Src[a];var b=PdfObject.Rep[a];var c=0;while(true){c=f.indexOf(d,c);if(c==-1){break}else{f=f.substring(0,c)+b+f.substring(c+d.length);c=c-d.length+b.length+1}}}return f};PdfObject.prototype.Encode=function(c){if(this.DataSize==0){WriteToConsoleError("[PdfObject::Encode] DataSize = 0!");return}if(c==PdfObject.ENC_FLATE){WriteToConsoleError("[PdfObject::Encode] DEFLATE not available. Using ASCII85 instead of FLATE for encoding.");c=PdfObject.ENC_A85}var e="";switch(c){case PdfObject.ENC_NONE:return;case PdfObject.ENC_HEX:e="/ASCIIHexDecode";break;case PdfObject.ENC_A85:e="/ASCII85Decode";break;case PdfObject.ENC_FLATE:e="/FlateDecode";break;default:WriteToConsoleError("[PdfObject::Encode] Unhandled encoding type (= "+c+")");return}if(this.Dict==null){this.Dict=new PdfDictionary();this.Dict.Doc=this.Doc}var b=this.Dict.Get("/Filter");if(b==null){var a=new PdfArray();a.Doc=this.Doc;b=this.Dict.Add("/Filter",a)}else{var a=b.Value;if(a.Get(e)!=null){return}}b.Value.Add(e,false,true);var d=new Boxer(this.Data);var f=new Boxer(this.DataSize);switch(c){case PdfObject.ENC_HEX:PdfObject.EncodeHex(d,f);break;case PdfObject.ENC_A85:PdfObject.EncodeA85(d,f);break;case PdfObject.ENC_FLATE:PdfObject.EncodeFlate(d,f);break}this.Data=d.arrayValue();this.DataSize=f.intValue();b=this.Dict.Get("/Length");b.Value=this.DataSize};PdfObject.EncodeHex=function(f,a){var c=f.arrayValue();var d=a.intValue();var m=new Uint8Array(d*2+PdfDocument.CR_LEN*d/40+10);var n=0;for(var g=0;g<d;g++){var k=c[g]>>4;var b=c[g]&15;m[n++]=(k>9?k-10+65:k+48);m[n++]=(b>9?b-10+65:b+48);if((g+1)%40==0){for(var e=0;e<PdfDocument.CR_LEN;e++){m[n++]=PdfDocument.CR.charCodeAt(e)}}}m[n++]=62;f.set(m);a.set(n)};PdfObject.EncodeA85=function(h,a){var d=h.arrayValue();var f=a.intValue();var m=new Uint8Array(Math.floor(f*5/4+2*f/100+10));var o=0;var b;var k=0;for(k=0;k+4<=f;k+=4){b=(d[k]<<24)+(d[k+1]<<16)+(d[k+2]<<8)+d[k+3];if(b<0){b+=4294967296}if(b==0){m[o++]=122;continue}var n=new Uint8Array(5);for(var e=4;e>=0;e--){n[e]=(b%85+33);b=b/85}for(var g=0;g<5;g++){m[o++]=n[g]}if((k+4)%100==0){for(var g=0;g<PdfDocument.CR_LEN;g++){m[o++]=PdfDocument.CR.charCodeAt(g)}}}if(k<f){var c=f-k;b=0;for(var l=24;l>=0;l-=8){b|=d[k]<<l;if(++k>=f){break}}if(b<0){b+=4294967296}var n=new Uint8Array(5);for(var e=4;e>=0;e--){n[e]=(b%85+33);b=b/85}for(var g=0;g<c+1;g++){m[o++]=n[g]}}m[o++]=126;m[o++]=62;h.set(m);a.set(o)};PdfObject.EncodeFlate=function(b,a){};function PdfArray(){PdfObject.call(this);this.ObjArray=new ArrayList()}PdfArray.prototype=new PdfObject();for(var i=0;i<Object.keys(PdfObject).length;i++){var obj=Object.keys(PdfObject)[i];PdfArray[obj]=PdfObject[obj]}PdfArray.prototype.FormatObject=function(){try{this.Data=null;var a={data:""};a.data="[ ";for(var b=0;b<this.ObjArray.Count();b++){if(b>0){a.data+=" "}var d=this.ObjArray[b];d.WriteData(a)}a.data+=" ]";this.DataSize=a.data.length;this.Data=new Uint8Array(a.data.length);for(var b=0;b<a.data.length;b++){this.Data[b]=a.data.charCodeAt(b)}a=null}catch(c){}PdfObject.prototype.FormatObject.call(this)};PdfArray.prototype.RemoveAll=function(){this.ObjArray.Clear();this.ObjArray=null};PdfArray.prototype.Add=function(m,l,k,j){if(m instanceof Uint8Array){var g=m;var e=l;var f=new PdfCollectionElem();f.SetData(g,e);this.ObjArray.Add(f);return f}var g=m;var c;var h;var b;if(g instanceof PdfObject){c=l;h=k;b=j;if(c==undefined){c=false}if(h==undefined){h=true}if(b==undefined){b=false}}else{h=l;b=k;if(h==undefined){h=true}if(b==undefined){b=false}}if(h){for(var d=0;d<this.ObjArray.Count();d++){var a=this.ObjArray[d];if(g instanceof PdfObject){if(c){if(a.Type==PdfCollectionElem.VAL_STRING&&a.Value==g.GetIndirectRef()){return a}}else{if(a.Type==PdfCollectionElem.VAL_PDFOBJ&&a.Value==g){return a}}}else{if(typeof(g)=="number"&&a.Type==(PdfCollectionElem.VAL_INT||a.Type==PdfCollectionElem.VAL_FLOAT)&&a.Value==g){return a}if(typeof(g)=="string"&&a.Type==PdfCollectionElem.VAL_STRING&&a.Value==g){return a}}}}var f=new PdfCollectionElem();if(g instanceof PdfObject){if(c){f.SetData(g.GetIndirectRef())}else{f.SetData(g)}}else{f.SetData(g)}if(b){this.ObjArray.splice(0,0,f)}else{this.ObjArray.Add(f)}return f};PdfArray.prototype.Get=function(a){for(var b=0;b<this.ObjArray.Count();b++){var c=this.ObjArray[b];if(c.Type==PdfCollectionElem.VAL_STRING&&c.Value==a){return c}}return null};function PdfCollectionElem(){this.Type=0;this.Value=null;this.ValueLen=-1}PdfCollectionElem.VAL_NULL=0;PdfCollectionElem.VAL_INT=1;PdfCollectionElem.VAL_FLOAT=2;PdfCollectionElem.VAL_STRING=3;PdfCollectionElem.VAL_PDFOBJ=4;PdfCollectionElem.VAL_BYTEBUFF=5;PdfCollectionElem.prototype.SetData=function(b,a){if(typeof(b)=="number"){if((b+"").indexOf(".")==-1){this.Type=PdfCollectionElem.VAL_INT}else{this.Type=PdfCollectionElem.VAL_FLOAT}this.Value=b}else{if(typeof(b)=="string"){this.Type=PdfCollectionElem.VAL_STRING;this.Value=b}else{if(b instanceof PdfObject){this.Type=PdfCollectionElem.VAL_PDFOBJ;this.Value=b}else{if(b instanceof Uint8Array){this.Type=PdfCollectionElem.VAL_BYTEBUFF;this.ValueLen=a;this.Value=b}else{if(b instanceof PdfCollectionElem){this.Type=b.Type;this.Value=b.Value;this.ValueLen=b.ValueLen;b.Value=null}}}}}};PdfCollectionElem.prototype.WriteData=function(a){var b="";switch(this.Type){case PdfCollectionElem.VAL_NULL:return;case PdfCollectionElem.VAL_INT:b=this.Value.toString();break;case PdfCollectionElem.VAL_FLOAT:b=this.Value.toFixed(2);break;case PdfCollectionElem.VAL_STRING:b=this.Value;break;case PdfCollectionElem.VAL_PDFOBJ:this.Value.FormatObject();a.data+=String.fromCharCode.apply(null,this.Value.Data);return;case PdfCollectionElem.VAL_BYTEBUFF:a.data+=String.fromCharCode.apply(null,this.Value);return}a.data+=b};PdfCollectionElem.prototype.ChangeToArray=function(){var c=this.Type;var b=this.Value;var a=this.ValueLen;if(c!=PdfCollectionElem.VAL_PDFOBJ&&c!=PdfCollectionElem.VAL_STRING){this.Value=null}var d=new PdfArray();this.SetData(d);if(c==PdfCollectionElem.VAL_BYTEBUFF){d.Add(b,a)}else{d.Add(b)}return d};PdfCollectionElem.prototype.intValue=function(){if(this.Type!=PdfCollectionElem.VAL_INT){WriteToConsoleError("[PdfCollectionElem::intValue] wrong type ("+this.Type+")")}return this.Value};PdfCollectionElem.prototype.floatValue=function(){if(this.Type!=PdfCollectionElem.VAL_FLOAT){WriteToConsoleError("[PdfCollectionElem::floatValue] wrong type ("+this.Type+")")}return this.Value};PdfCollectionElem.prototype.stringValue=function(){if(this.Type!=PdfCollectionElem.VAL_STRING){WriteToConsoleError("[PdfCollectionElem::stringValue] wrong type ("+this.Type+")")}return this.Value};PdfCollectionElem.prototype.pdfObjectValue=function(){if(this.Type!=PdfCollectionElem.VAL_PDFOBJ){WriteToConsoleError("[PdfCollectionElem::pdfObjectValue] wrong type ("+this.Type+")")}return this.Value};function PdfDictionary(){PdfObject.call(this);this.Dictionary=new HashTableSrv()}PdfDictionary.prototype=new PdfObject();for(var i=0;i<Object.keys(PdfObject).length;i++){var obj=Object.keys(PdfObject)[i];PdfDictionary[obj]=PdfObject[obj]}PdfDictionary.prototype.FormatObject=function(){try{var f;this.Data=null;var b={data:""};b.data="<< ";var g=this.Dictionary.keys();for(var c=0;c<g.length;c++){var a=g[c];var d=this.Dictionary[a];b.data+=a+" ";d.WriteData(b);b.data+=PdfDocument.CR}b.data+=">>";this.DataSize=b.data.length;this.Data=new Uint8Array(b.data.length);for(var c=0;c<b.data.length;c++){this.Data[c]=b.data.charCodeAt(c)}b=null}catch(h){}PdfObject.prototype.FormatObject.call(this)};PdfDictionary.prototype.RemoveAll=function(){this.Dictionary.clear()};PdfDictionary.prototype.Add=function(d,c,b,a){if(typeof(d)=="string"){var k;var u;var n;var o;if(c instanceof PdfObject){k=d;u=c;o=b;n=a;if(o==undefined){o=false}}else{k=d;u=c;n=b}if(n==undefined){n=true}var f=this.Get(k);if(n){if(u instanceof PdfObject){if(o){if(f!=null&&f.Type==PdfCollectionElem.VAL_STRING&&f.Value==u.GetIndirectRef()){return f}}else{if(f!=null&&f.Type==PdfCollectionElem.VAL_PDFOBJ&&f.Value==u){return f}}}else{if(typeof(u)=="number"&&f!=null&&f.Type==(PdfCollectionElem.VAL_INT||PdfCollectionElem.VAL_FLOAT)&&f.Value==u){return f}if(typeof(u)=="string"&&f!=null&&f.Type==PdfCollectionElem.VAL_STRING&&f.Value==u){return f}}}if(f==null){f=new PdfCollectionElem();if(u instanceof PdfObject&&o){f.SetData(u.GetIndirectRef())}else{f.SetData(u)}this.Dictionary[k]=f}else{if(u instanceof PdfObject){if(f.Value instanceof PdfArray){if(o){f.Value.Add(u.GetIndirectRef(),n)}else{f.Value.Add(u,n)}}else{if(f.Value instanceof PdfDictionary){f.Value.Add(k,u,o,n)}else{var l=f.ChangeToArray();l.Add(u)}}}else{var l=f.ChangeToArray();l.Add(u)}}return f}else{if(d instanceof PdfDictionary){var g=d;var v=c;var m=g.Dictionary.keys();for(var r=0;r<m.length;r++){var k=m[r];var f=g.Dictionary[k];switch(f.Type){case PdfCollectionElem.VAL_INT:case PdfCollectionElem.VAL_FLOAT:case PdfCollectionElem.VAL_STRING:this.Add(k,f.Value);break;case PdfCollectionElem.VAL_PDFOBJ:if(v){this.Add(k,f.pdfObjectValue());f.Type=PdfCollectionElem.VAL_NULL;f.Value=null}else{var h=f.pdfObjectValue();if(h instanceof PdfArray){var s=new PdfArray();this.Add(k,s);for(var q=0;q<h.ObjArray.Count();q++){var t=h.ObjArray[q];if(t.Type==PdfCollectionElem.VAL_INT){s.Add(t.intValue(),false)}else{if(t.Type==PdfCollectionElem.VAL_FLOAT){s.Add(t.floatValue(),false)}else{if(t.Type==PdfCollectionElem.VAL_STRING){s.Add(t.stringValue(),false)}else{WriteToConsoleError("[PdfDictionary::Add] Can't add a PdfObject contained in an array")}}}}}else{WriteToConsoleError("[PdfDictionary::Add] Don't know how to move a PdfObject between two dictionaries")}}break}}if(v){g.RemoveAll()}}}};PdfDictionary.prototype.Get=function(a){return this.Dictionary[a]};function CDblSize(d,c){this.cx=d;this.cy=c}function PdfDocument(){this.Version=1.3;this.LastXREFPos=-1;this.CurrPage=null;this.CurrFont=null;this.CurrFontHeight=-1;this.CurrGraphState=null;this.LastID=0;this.DocOutlines=null;this.LastOutlineObj=null;this.Children=new ArrayList();this.AddedImages=new HashTableSrv();this.ExtGRStates=new ArrayList();this.DocCatalog=new PdfDictionary();this.AddChild(this.DocCatalog);this.DocPages=new PdfDictionary();this.AddChild(this.DocPages);this.DocPages.Add("/Type","/Pages");var a=new PdfArray();a.Doc=this;this.DocPages.Add("/Kids",a);this.DocPages.Add("/Count",0);this.DocCatalog.Add("/Type","/Catalog");this.DocCatalog.Add("/Pages",this.DocPages,true);this.DocCatalog.Add("/PageMode","/UseNone");this.DocInfo=new PdfDictionary();this.AddChild(this.DocInfo);this.Trailer=new PdfDictionary();this.Trailer.Add("/Info",this.DocInfo,true)}PdfDocument.PAGE_LETTER=new CDblSize(612,792);PdfDocument.PAGE_LEGAL=new CDblSize(612,1008);PdfDocument.PAGE_A0=new CDblSize(2380,3368);PdfDocument.PAGE_A1=new CDblSize(1684,2380);PdfDocument.PAGE_A2=new CDblSize(1190,1684);PdfDocument.PAGE_A3=new CDblSize(842,1190);PdfDocument.PAGE_A4=new CDblSize(595,842);PdfDocument.PAGE_A5=new CDblSize(421,595);PdfDocument.PAGE_B0=new CDblSize(2836,4008);PdfDocument.PAGE_B1=new CDblSize(2004,2836);PdfDocument.PAGE_B2=new CDblSize(1418,2004);PdfDocument.PAGE_B3=new CDblSize(1002,1418);PdfDocument.PAGE_B4=new CDblSize(709,1002);PdfDocument.PAGE_B5=new CDblSize(501,709);PdfDocument.PAGE_11X17=new CDblSize(792,1224);PdfDocument.LANDSCAPE=function(b){var a=b.cx;b.cx=b.cy;b.cy=a;return b};PdfDocument.VP_HIDETOOLBAR="/HideToolbar";PdfDocument.VP_HIDEMENUBAR="/HideMenubar";PdfDocument.VP_FITWINDOW="/FitWindow";PdfDocument.VP_CENTERWINDOW="/CenterWindow";PdfDocument.DI_TITLE="/Title";PdfDocument.DI_AUTHOR="/Author";PdfDocument.DI_SUBJECT="/Subject";PdfDocument.DI_KEYWORDS="/Keywords";PdfDocument.DI_CREATOR="/Creator";PdfDocument.DI_PRODUCER="/Producer";PdfDocument.CR="\n";PdfDocument.CR_LEN=PdfDocument.CR.length;PdfDocument.prototype.AddChild=function(a){a.ID=++this.LastID;a.Doc=this;this.Children.Add(a)};PdfDocument.prototype.GetObjectByID=function(a){for(var b=0;b<this.Children.Count();b++){var c=this.Children[b];if(c.ID==a){return c}}return null};PdfDocument.prototype.Save=function(c,g){var o=new Date();var q=IDL.FormatDate(new Date(),"'D:'yyyymmddhhnnss");var b=o.getTimezoneOffset()*60*1000;if(o.dstOffset()){b-=3600000}var l=Math.round(Math.abs(b/1000)/3600);var f=Math.round(Math.abs(b/1000)%3600);var a=(b>0?"+":"-")+(l<=9?"0":"")+l+"'"+(f<=9?"0":"")+f;this.DocInfo.Add("/CreationDate","("+q+a+")");if(this.DocOutlines!=null&&this.LastOutlineObj!=null){this.DocOutlines.Add("/Last",this.LastOutlineObj,true)}try{for(var k=0;k<this.Children.Count();k++){var j=this.Children[k];j.FormatObject()}this.WriteHeader(g);for(var k=0;k<this.Children.Count();k++){var j=this.Children[k];j.Save(g)}this.WriteXref(g);this.WriteTrailer(g);return 0}catch(n){WriteToConsoleError("[PdfDocument::Save] Error: "+n);return 2}};PdfDocument.prototype.WriteHeader=function(a){var b="%PDF-"+this.Version.toFixed(1)+PdfDocument.CR;a.data+=b;a.data+="%";a.data+=String.fromCharCode(226);a.data+=String.fromCharCode(227);a.data+=String.fromCharCode(207);a.data+=String.fromCharCode(211);a.data+=PdfDocument.CR};PdfDocument.prototype.WriteXref=function(a){this.LastXREFPos=a.data.length;var d="xref"+PdfDocument.CR;a.data+=d;d="0 "+(this.LastID+1)+PdfDocument.CR;a.data+=d;d="0000000000 65536 f\r\n";a.data+=d;for(var c=0;c<this.Children.Count();c++){var e=this.Children[c];d=e.PosOnFile.toString();for(var b=d.length;b<10;b++){d="0"+d}d+=" 00000 n\r\n";a.data+=d}};PdfDocument.prototype.WriteTrailer=function(a){this.Trailer.Add("/Size",this.LastID+1);this.Trailer.Add("/Root",this.DocCatalog.GetIndirectRef());var b="trailer"+PdfDocument.CR;a.data+=b;this.Trailer.FormatObject();a.data+=String.fromCharCode.apply(null,this.Trailer.Data);b=PdfDocument.CR+"startxref"+PdfDocument.CR+this.LastXREFPos+PdfDocument.CR;a.data+=b;b="%%EOF"+PdfDocument.CR;a.data+=b};PdfDocument.prototype.SetPreference=function(c,a){if(a==undefined){a=true}var d=null;var b=this.DocCatalog.Get("/ViewerPreferences");if(b==null){d=new PdfDictionary();d.Doc=this;b=this.DocCatalog.Add("/ViewerPreferences",d)}else{d=b.Value}b=d.Get(c);if(b!=null){b.Value=(a?"true":"false")}else{d.Add(c,(a?"true":"false"))}};PdfDocument.prototype.SetDocumentInfo=function(b,a){a="("+PdfObject.AdaptString(a)+")";var c=this.DocInfo.Get(b);if(c!=null){c.Value=a}else{this.DocInfo.Add(b,a)}};PdfDocument.prototype.AddToResource=function(j,d,h,g,b){if(g==undefined){g=null}if(b==undefined){b=true}var f=null;var e=null;var c=null;var a=j.Get("/Resources");if(a==null){f=new PdfDictionary();f.Doc=this;j.Add("/Resources",f)}else{f=a.Value}a=f.Get(d);if(a==null){if(g!=null){c=new PdfDictionary();c.Doc=this;f.Add(d,c)}else{e=new PdfArray();e.Doc=this;f.Add(d,e)}}else{if(g!=null){c=a.Value}else{e=a.Value}}if(g!=null){c.Add(h,g,b)}else{e.Add(h)}return f};PdfDocument.prototype.AddPage=function(d,c){if(d instanceof CDblSize){var b=d;d=b.cx;c=b.cy}this.CurrPage=new PdfDictionary();this.AddChild(this.CurrPage);this.CurrPage.Add("/Type","/Page");this.CurrPage.Add("/Parent",this.DocPages,true);var f=new PdfArray();f.Doc=this;f.Add(0,false);f.Add(0,false);f.Add(d,false);f.Add(c,false);this.CurrPage.Add("/MediaBox",f);var a=this.DocPages.Get("/Kids");var e=this.DocPages.Get("/Count");e.Value=e.Value+1;a.Value.Add(this.CurrPage,true);this.CurrGraphState=null;return this.CurrPage.ID};PdfDocument.prototype.AddFont=function(e,c){if(typeof(e)=="string"){if(c==undefined){var b=this.GetFont(e);if(b!=null){this.CurrFont=b}else{var a=new PdfFont();a.Init(e);a.AddToDoc(this,false);this.CurrFont=a}return this.CurrFont.ID}else{var a=new PdfFont();a.Init(FntPath,c);var b=this.GetFont(a.BaseFont);if(b!=null){this.CurrFont=b}else{a.AddToDoc(this,c);this.CurrFont=a}return this.CurrFont.ID}}else{if(e instanceof PdfFont){var d=e;var b=this.GetFont(d.BaseFont);if(b!=null){this.CurrFont=b}else{d.AddToDoc(this,c);this.CurrFont=d}return this.CurrFont.ID}}};PdfDocument.prototype.GetFont=function(a){for(var c=0;c<this.Children.Count();c++){var b=this.Children[c];if(b instanceof PdfFont&&b.IsSameFont(a)){return b}}return null};PdfDocument.prototype.GetExtGS=function(b){for(var c=0;c<this.ExtGRStates.Count();c++){var e=this.ExtGRStates[c];var d=e.Get("/Type");if(d!=null&&d.Type==PdfCollectionElem.VAL_STRING&&d.stringValue()=="/ExtGState"){d=e.Get("/ca");if(d!=null&&d.Type==PdfCollectionElem.VAL_FLOAT){var a=b;if(d.floatValue()==a){return e}}}}return null};PdfDocument.prototype.NewGraphicState=function(){if(this.CurrPage==null){return null}var b=new PdfGraphics();this.AddChild(b);b.ParentPage=this.CurrPage;var a=null;var c=this.CurrPage.Get("/Contents");if(c==null){a=new PdfArray();a.Doc=this;this.CurrPage.Add("/Contents",a)}else{a=c.Value}a.Add(b,true);this.AddToResource(this.CurrPage,"/ProcSet","/PDF");return b};PdfDocument.prototype.AddImage=function(g,c,b,a,F,D,C){if(typeof(g)=="string"){var d=g;var o=c;var n=b;var q=a;var z=F;var s=D;var v=C;if(q==undefined){q=-1}if(z==undefined){z=-1}if(s==undefined){s=-9999}if(v==undefined){v=null}var B=this.AddedImages[d];if(B==null){var u=null;try{if(d.startsWith("$SHELL")){d=d.substring(6)}if(d.length&&d[0]=="/"){d=d.substring(1)}var G=IDL.LoadFile(RD4_WebEntryPoint.GetAppUrl(false)+d);if(!G){G=IDL.LoadFile(RD4_WebEntryPoint.GetAppUrl(false)+"Images/"+d)}u=new Uint8Array(G)}catch(A){WriteToConsoleError("[PdfDocument::AddImage] Exception while adding image "+d);return -1}try{var r=u.length;B=PdfDocument.AddImage(u,r,s);if(B!=null){this.AddedImages[d]=B}else{WriteToConsoleError("  [PdfDocument::AddImage] Image "+d+" not added")}}catch(A){WriteToConsoleError("[PdfDocument::AddImage] Exception while reading image "+d+"\n"+A)}}if(B!=null){return this.AddImage(B,o,n,q,z,v)}else{return -1}}else{if(g instanceof PdfImage){var m=g;var o=c;var n=b;var q=a;var z=F;var v=D;if(v==undefined){v=null}if(m.ID==-1){this.AddChild(m)}var j=null;var f=this.CurrPage.Get("/Contents");if(f==null){j=new PdfArray();j.Doc=this;this.CurrPage.Add("/Contents",j)}else{j=f.Value}if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}j.Add(this.CurrGraphState,true);var G=this.AddToResource(this.CurrPage,"/ProcSet","/PDF");switch(m.ColorSpace){case 1:this.AddToResource(this.CurrPage,"/ProcSet","/ImageB");break;case 4:this.AddToResource(this.CurrPage,"/ProcSet","/ImageC");break;case 3:if(m.Palette!=null){this.AddToResource(this.CurrPage,"/ProcSet","/ImageI")}else{this.AddToResource(this.CurrPage,"/ProcSet","/ImageC")}break}var k="/Image"+m.ID;var t=G.Get("/XObject");if(t!=null){var l=t.Value;l.Add(k,m,true)}else{var E=new PdfDictionary();E.Add(k,m,true);G.Add("/XObject",E)}if(z==-1){z=m.Height/96*72}if(q==-1){q=m.Width/96*72}if(z<0){z=-z;n-=z}this.CurrGraphState.AddImage(o,n,m,q,z,v);return m.ID}}};PdfDocument.AddImage=function(f,c,a){if(a==undefined){a=-9999}var b=null;if(f[0]==71&&f[1]==73&&f[2]==70){b=new Gif()}else{if(f[0]==255&&f[1]==216){b=new Jpeg()}else{if(f[0]==137&&f[1]==80&&f[2]==78&&f[3]==71){}else{if(f[0]==215&&f[1]==205){b=new Wmf()}else{if(f[0]==66&&f[1]==77){b=new Bitmap()}else{if((f[0]==77&&f[1]==77&&f[2]==0&&f[3]==42)||(f[0]=="I"&&f[1]=="I"&&f[2]==42&&f[3]==0)){b=new Tiff()}else{if(f[0]==154&&f[1]==198&&f[0]==205&&f[1]==215){b=new Wmf()}else{return null}}}}}}}if(a!=-9999){b.Param=a}try{b.Init(f,c)}catch(d){WriteToConsoleError(d);b=null}return b};PdfDocument.prototype.AddOutline=function(a){if(this.DocOutlines==null){this.DocOutlines=new PdfDictionary();this.DocOutlines.Add("/Type","/Outlines");this.AddChild(this.DocOutlines);this.DocCatalog.Add("/Outlines",this.DocOutlines,true)}var b=new PdfDictionary();this.AddChild(b);if(this.LastOutlineObj==null){this.DocOutlines.Add("/First",b,true)}else{this.LastOutlineObj.Add("/Next",b,true)}this.LastOutlineObj=b;this.LastOutlineObj.Add("/Title","("+PdfObject.AdaptString(a)+")");this.LastOutlineObj.Add("/Parent",this.DocOutlines,true);this.LastOutlineObj.Add("/Dest","["+this.CurrPage.GetIndirectRef()+" /XYZ null null null]")};PdfDocument.prototype.SetLineWidth=function(a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineWidth(a)};PdfDocument.prototype.SetLineCap=function(a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineCap(a)};PdfDocument.prototype.SetLineJoin=function(a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineJoin(a)};PdfDocument.prototype.SetLineMiterLimit=function(a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineMiterLimit(a)};PdfDocument.prototype.SetLineDashPattern=function(b,a,c){if(a==undefined){a=-1}if(c==undefined){c=-1}if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineDashPattern(b,a,c)};PdfDocument.prototype.SetLineColor=function(d,c,a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineColor(d,c,a)};PdfDocument.prototype.SetFillColor=function(d,c,a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetFillColor(d,c,a)};PdfDocument.prototype.SetFillGradient=function(e,d,c,b,G,E,D,C,B,s){if(D==undefined){var A=e;var h=d;var z=c;var g=b;var q=G;var r=E;this.SetFillGradient(A,h,z,g,q&255,(q>>8)&255,(q>>16)&255,r&255,(r>>8)&255,(r>>16)&255)}else{var A=e;var h=d;var z=c;var g=b;var x=G;var a=E;var l=D;var u=C;var F=B;var k=s;var t=new PdfDictionary();this.AddChild(t);t.Add("/FunctionType",2);var o=new PdfArray();o.Add(0);o.Add(1);t.Add("/Domain",o);var y=new PdfArray();y.Add(x/255,false);y.Add(a/255,false);y.Add(l/255,false);t.Add("/C0",y);var v=new PdfArray();v.Add(u/255,false);v.Add(F/255,false);v.Add(k/255,false);t.Add("/C1",v);t.Add("/N",1);var n=new PdfDictionary();this.AddChild(n);n.Add("/ShadingType",2);n.Add("/ColorSpace","/DeviceRGB");n.Add("/Function",t,true);var j=new PdfArray();j.Add(A,false);j.Add(h,false);j.Add(z,false);j.Add(g,false);n.Add("/Coords",j);var m=new PdfDictionary();this.AddChild(m);m.Add("/Type","/Pattern");m.Add("/PatternType",2);m.Add("/Shading",n,true);if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetFillPattern(m);this.CurrGraphState.CurrState.FillColorRGB=(l<<16)|(a<<8)|x;var f="/P"+m.ID;this.AddToResource(this.CurrPage,"/Pattern",f,m)}};PdfDocument.prototype.CloseFillGradient=function(){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.CloseFillPattern();this.CurrGraphState.CurrState.FillColorRGB=-1};PdfDocument.prototype.SetColor=function(d,c,a){this.SetLineColor(d,c,a);this.SetFillColor(d,c,a)};PdfDocument.prototype.SetTextMode=function(a){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.SetTextMode(a)};PdfDocument.prototype.SetTextFont=function(b,a){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.SetTextFont(b,a)};PdfDocument.prototype.SetTextPosition=function(a,b){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.SetTextPosition(a,b)};PdfDocument.prototype.SetRotation=function(c,b,d){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.SetRotation(c,b,d)};PdfDocument.prototype.UndoRotation=function(){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.UndoRotation()};PdfDocument.prototype.AddText=function(h,d,c,o,e,g,m,j,n,f,b,k,a,l){if(d==undefined){d=-1}if(c==undefined){c=-1}if(o==undefined){o=-1}if(e==undefined){e=-1}if(g==undefined){g=-1}if(m==undefined){m=-1}if(j==undefined){j=false}if(n==undefined){n=false}if(f==undefined){f=-1}if(b==undefined){b=100}if(k==undefined){k=0}if(a==undefined){a=0}if(l==undefined){l=100}if(e==-1){e=this.CurrFontHeight}if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddText(h,d,c,o,e,g,m,j,n,f,b,k,a,l);this.CurrFontHeight=e};PdfDocument.prototype.AddRectangle=function(b,f,a,e,d,c){if(d==undefined){d=false}if(c==undefined){c=100}if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddRectangle(b,f,a,e,d,c)};PdfDocument.prototype.AddBezier=function(c,h,b,g,a,f,j,e,d){if(d==undefined){d=false}if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddBezier(c,h,b,g,a,f,j,e,d)};PdfDocument.prototype.AddCircle=function(a,d,c,b){if(b==undefined){b=false}if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddCircle(a,d,c,b)};PdfDocument.prototype.AddLine=function(b,d,a,c){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddLine(b,d,a,c)};PdfDocument.prototype.AddLink=function(d,b,k,e,a){var h=new PdfDictionary();this.AddChild(h);h.Add("/Type","/Annot");h.Add("/Subtype","/Link");h.Add("/BS","<< /W 0 >>");var j=new PdfArray();h.Add("/Rect",j);j.Add(d.toFixed(2));j.Add(b.toFixed(2));j.Add((d+k).toFixed(2));j.Add((b+e).toFixed(2));var g=new PdfDictionary();h.Add("/A",g);g.Add("/Type","/Action");g.Add("/S","/URI");g.Add("/URI","("+PdfObject.AdaptString(a)+")");var f=null;var c=this.CurrPage.Get("/Annots");if(c==null){f=new PdfArray();f.Doc=this;this.CurrPage.Add("/Annots",f)}else{f=c.Value}f.Add(h,true)};function PdfFont(){PdfDictionary.call(this);this.head=null;this.hhea=null;this.os_2=null;this.EncodingTable=null;this.KerningTable=null;this.IsPredefined=false;this.UsedGlyps=new HashTableSrv();this.ToUnicode=null;this.DescFont=null;this.iIsUnicode=false;this.CharWidths=null;this.FntDescriptor=null;this.FontFile=null;this.GlyphWidths=null;this.IsSymbolicFont=false;this.BaseFont="";this.IsItalic=false;this.IsBold=false;this.FontsMap=null;this.FontPath="";this.FontName="";this.FamilyName="";this.FullName="";this.SrcFont=null}PdfFont.prototype=new PdfDictionary();for(var i=0;i<Object.keys(PdfDictionary).length;i++){var obj=Object.keys(PdfDictionary)[i];PdfFont[obj]=PdfDictionary[obj]}function t_Header(){this.unitsPerEm}function t_HorizontalHeader(){this.Ascender;this.Descender;this.LineGap;this.numberOfHMetrics}function t_Glyph(){this.glyph;this.width}function t_FontDATA(){this.FontName;this.IsBold;this.IsItalic;this.FontPath;this.Fnt}PdfFont.COURIER="Courier";PdfFont.COURIER_BOLD="Courier-Bold";PdfFont.COURIER_BOLDOBLIQUE="Courier-BoldOblique";PdfFont.COURIER_OBLIQUE="Courier-Oblique";PdfFont.HELVETICA="Helvetica";PdfFont.HELVETICA_BOLD="Helvetica-Bold";PdfFont.HELVETICA_BOLDOBLIQUE="Helvetica-BoldOblique";PdfFont.HELVETICA_OBLIQUE="Helvetica-Oblique";PdfFont.SYMBOL="Symbol";PdfFont.TIMES_ROMAN="Times-Roman";PdfFont.TIMES_BOLD="Times-Bold";PdfFont.TIMES_BOLDITALIC="Times-BoldItalic";PdfFont.TIMES_ITALIC="Times-Italic";PdfFont.ZAPFDINGBATS="ZapfDingbats";PdfFont.prototype.Init=function(c,b,a){if(b==undefined){var z=c;this.Add("/Type","/Font");this.Add("/Subtype","/Type1");z=z.Replace(" ","");this.Add("/BaseFont","/"+z);this.IsPredefined=true}else{var E=c;var f=b;var H=a;if(H==undefined){H=false}this.BaseFont="";try{var G=IDL.LoadFile(RD4_WebEntryPoint.GetAppUrl(true)+E);var l=new MemoryStream(new Uint8Array(G));this.FontPath=E;this.head=new t_Header();this.hhea=new t_HorizontalHeader();this.EncodingTable=new HashTableSrv();this.KerningTable=new HashTableSrv();var B=PdfObject.GetSHORT(l,true);this.BaseFont=PdfObject.GetString(l,B);B=PdfObject.GetSHORT(l,true);this.FamilyName=PdfObject.GetString(l,B);var x=PdfObject.GetSHORT(l,true);var j=PdfObject.GetSHORT(l,true);var g=PdfObject.GetSHORT(l,true);this.head.unitsPerEm=PdfObject.GetSHORT(l,true);var m=PdfObject.GetSHORT(l,true);var t=PdfObject.GetSHORT(l,true);var q=PdfObject.GetSHORT(l,true);var u=PdfObject.GetSHORT(l,true);var n=PdfObject.GetSHORT(l,true);if((n&1)!=0){this.IsBold=true;if((n&2)!=0){this.IsItalic=true}}else{if((n&2)!=0){this.IsItalic=true}}if(!H){this.hhea.numberOfHMetrics=PdfObject.GetSHORT(l,true);this.hhea.Ascender=PdfObject.GetSHORT(l,true);this.hhea.Descender=PdfObject.GetSHORT(l,true);this.hhea.LineGap=PdfObject.GetSHORT(l,true);var F=PdfObject.GetNUINT(l,1,true)!=0;this.IsSymbolicFont=PdfObject.GetNUINT(l,1,true)!=0;var d=PdfObject.GetSHORT(l,true);B=PdfObject.GetUINT(l,true);this.GlyphWidths=new Uint16Array(B);for(var A=0;A<B;A++){this.GlyphWidths[A]=PdfObject.GetUINT(l,true)}B=PdfObject.GetUINT(l,true);for(var A=0;A<B;A++){var y=PdfObject.GetUINT(l,true);var o=new t_Glyph();o.glyph=PdfObject.GetUINT(l,true);o.width=PdfObject.GetUINT(l,true);this.EncodingTable.add(y,o)}B=PdfObject.GetUINT(l,true);for(var A=0;A<B;A++){var y=PdfObject.GetUINT(l,true);var o=PdfObject.GetUINT(l,true);this.KerningTable.add(y,o)}this.Add("/Type","/Font");this.Add("/Subtype","/TrueType");this.Add("/BaseFont","/"+this.BaseFont);this.Add("/Encoding","/WinAnsiEncoding");this.FntDescriptor=new PdfDictionary();this.FntDescriptor.Add("/Type","/FontDescriptor");this.FntDescriptor.Add("/Ascent",x*1000/this.head.unitsPerEm);this.FntDescriptor.Add("/CapHeight",j*1000/this.head.unitsPerEm);this.FntDescriptor.Add("/Descent",g*1000/this.head.unitsPerEm);var s=new PdfArray();s.Add((m*1000/this.head.unitsPerEm),false);s.Add((t*1000/this.head.unitsPerEm),false);s.Add((q*1000/this.head.unitsPerEm),false);s.Add((u*1000/this.head.unitsPerEm),false);this.FntDescriptor.Add("/FontBBox",s);this.FntDescriptor.Add("/FontName","/"+this.BaseFont);this.FntDescriptor.Add("/ItalicAngle",d);this.FntDescriptor.Add("/StemV",80);var h=0;if(F){h|=1}h|=(this.IsSymbolicFont?4:32);if((n&2)!=0){h|=64}if((n&1)!=0){h|=262144}this.FntDescriptor.Add("/Flags",h);if(f){this.FontFile=new PdfObject();var D=this.FontPath;D=D.Replace(".idf",".ttf");var G=IDL.LoadFile(RD4_WebEntryPoint.GetAppUrl(true)+D);var B=G.byteLength;var r=new Uint8Array(G);this.FontFile.Dict=new PdfDictionary();this.FontFile.Dict.Add("/Length",B);this.FontFile.Dict.Add("/Length1",B);this.FontFile.Data=new Uint8Array(B);for(var A=0;A<B;A++){this.FontFile.Data[A]=r[A]}this.FontFile.DataSize=B;this.FontFile.HasStream=true}}return true}catch(C){WriteToConsoleError("[PdfFont::Init] Error while reading font ("+E+"): "+C);return false}}};PdfFont.prototype.Reset=function(){this.ID=-1;this.UsedGlyps.clear()};PdfFont.prototype.AddToDoc=function(d,c){this.Doc=d;this.Doc.AddChild(this);if(!this.IsUnicode()&&this.FontPath.length>0){this.CharWidths=new PdfArray();this.CharWidths.Doc=this.Doc;this.Doc.AddChild(this.CharWidths);var b=this.Get("/Widths");if(b==null){this.Add("/Widths",this.CharWidths,true)}else{b.SetData(this.CharWidths.GetIndirectRef())}}if(this.FntDescriptor!=null){this.FntDescriptor.Doc=this.Doc;this.Doc.AddChild(this.FntDescriptor);if(!this.IsUnicode()){b=this.Get("/FontDescriptor");if(b==null){this.Add("/FontDescriptor",this.FntDescriptor,true)}else{b.SetData(this.FntDescriptor.GetIndirectRef())}}}if(c&&this.FontFile!=null){this.FontFile.Doc=this.Doc;this.Doc.AddChild(this.FontFile);var b=this.FntDescriptor.Get("/FontFile2");if(b==null){this.FntDescriptor.Add("/FontFile2",this.FontFile,true)}else{b.SetData(this.FontFile.GetIndirectRef())}}if(this.IsUnicode()){var b=null;this.Get("/Subtype").SetData("/Type0");this.Get("/Encoding").SetData("/Identity-H");this.DescFont=new PdfDictionary();this.DescFont.Doc=this.Doc;this.Doc.AddChild(this.DescFont);this.DescFont.Add("/Type","/Font");this.DescFont.Add("/Subtype","/CIDFontType2");this.DescFont.Add("/BaseFont","/"+this.BaseFont);this.DescFont.Add("/CIDToGIDMap","/Identity");var a=new PdfDictionary();a.Add("/Supplement","0");a.Add("/Ordering","(Identity)");a.Add("/Registry","(Adobe)");this.DescFont.Add("/CIDSystemInfo",a);this.DescFont.Add("/DW","1000");this.DescFont.Add("/FontDescriptor",this.FntDescriptor,true);var e=new PdfArray();e.Add(this.DescFont.GetIndirectRef());b=this.Get("/DescendantFonts");if(b==null){this.Add("/DescendantFonts",e)}else{b.SetData(e)}this.ToUnicode=new PdfObject();this.ToUnicode.Doc=this.Doc;this.ToUnicode.Dict=new PdfDictionary();this.Doc.AddChild(this.ToUnicode);b=this.Get("/ToUnicode");if(b==null){this.Add("/ToUnicode",this.ToUnicode.GetIndirectRef())}else{b.SetData(this.ToUnicode.GetIndirectRef())}}};PdfFont.WinAnsiEncode=function(a){if(typeof(a)=="string"){a=a.charCodeAt(0)}switch(a){case 128:a=8364;break;case 129:a=65533;break;case 130:a=8218;break;case 131:a=402;break;case 132:a=8222;break;case 133:a=8230;break;case 134:a=8224;break;case 135:a=8225;break;case 136:a=710;break;case 137:a=8240;break;case 138:a=352;break;case 139:a=8249;break;case 140:a=338;break;case 141:a=65533;break;case 142:a=381;break;case 143:a=65533;break;case 144:a=65533;break;case 145:a=8216;break;case 146:a=8217;break;case 147:a=8220;break;case 148:a=8221;break;case 149:a=8226;break;case 150:a=8211;break;case 151:a=8212;break;case 152:a=732;break;case 153:a=8482;break;case 154:a=353;break;case 155:a=8250;break;case 156:a=339;break;case 157:a=65533;break;case 158:a=382;break;case 159:a=376;break}return a};PdfFont.WinAnsiDecode=function(a){if(typeof(a)=="string"){a=a.charCodeAt(0)}switch(a){case 8364:a=128;break;case 8218:a=130;break;case 402:a=131;break;case 8222:a=132;break;case 8230:a=133;break;case 8224:a=134;break;case 8225:a=135;break;case 710:a=136;break;case 8240:a=137;break;case 352:a=138;break;case 8249:a=139;break;case 338:a=140;break;case 381:a=142;break;case 8216:a=145;break;case 8217:a=146;break;case 8220:a=147;break;case 8221:a=148;break;case 8226:a=149;break;case 8211:a=150;break;case 8212:a=151;break;case 732:a=152;break;case 8482:a=153;break;case 353:a=154;break;case 8250:a=155;break;case 339:a=156;break;case 382:a=158;break;case 376:a=159;break;case 65533:a=129;break}return a};PdfFont.prototype.GetCharWidth=function(a){if(this.EncodingTable!=null&&this.hhea!=null){if(!this.IsSymbolicFont&&a>=128&&a<=159){a=PdfFont.WinAnsiEncode(a)}var b=this.EncodingTable[a];if(b!=null){return b.width}else{if(a<this.hhea.numberOfHMetrics){return this.GlyphWidths[a]}else{return this.GlyphWidths[this.hhea.numberOfHMetrics-1]}}}if(this.IsPredefined){return 200}return 0};PdfFont.prototype.GetKerning=function(f,e){if(this.EncodingTable!=null){var d=-1;var c=this.EncodingTable[f];if(c!=null){d=c.glyph}var b=-1;c=this.EncodingTable[e];if(c!=null){b=c.glyph}if(d==-1||b==-1){return 0}var a=this.KerningTable[(d<<16)+b];if(a!=null){return a/1000}}return 0};PdfFont.prototype.IsSameFont=function(a){var b=this.Get("/BaseFont");if(b!=null&&b.Type==PdfCollectionElem.VAL_STRING&&b.Value=="/"+a){return true}return false};PdfFont.prototype.getAscent=function(){if(this.head!=null&&this.head.unitsPerEm!=0){return this.hhea.Ascender/this.head.unitsPerEm}else{return 0.8}};PdfFont.prototype.getDescent=function(){if(this.head!=null&&this.head.unitsPerEm!=0){return this.hhea.Descender/this.head.unitsPerEm}else{return -0.1}};PdfFont.prototype.getLeading=function(){if(this.head!=null&&this.head.unitsPerEm!=0){return this.hhea.LineGap/this.head.unitsPerEm}else{return 0}};PdfFont.scanFontDirectory=function(){if(this.FontsMap){return}var k=0;var d=new ArrayList();RD4_WebEntryPoint.GetFontsList(d);if(d.Count()==0){return}if(this.FontsMap==null){this.FontsMap=new HashTableSrv()}for(var f=0;f<d.Count();f++){var n=d[f];if(n[0]=="+"){n=n.substring(1)}n=n.replace(/\|/g,"_");n="?WCI=RD3&WCE=GZ&FN=fonts/"+n+".idf";var l=new PdfFont();if(l.Init(n,false,true)){var a=this.FontsMap[l.FamilyName];if(a==null){a=new ArrayList();this.FontsMap.add(l.FamilyName,a)}else{var h=false;for(var e=0;e<a.Count();e++){var c=a[e];if(c.FontPath.equals(l.FontPath)){h=true;break}}if(h){continue}}var b=new t_FontDATA();b.FontName=l.FontName;b.IsBold=l.IsBold;b.IsItalic=l.IsItalic;b.FontPath=l.FontPath;b.Fnt=null;a.Add(b);k++}l=null}var g=0;var m=this.FontsMap.keys();for(var f=0;f<m.length;f++){g+=this.FontsMap[m[f]].Count()}WriteToConsoleOutput("[PdfFont::scanFontDirectory] Found "+k+" NEW fonts");WriteToConsoleOutput("    Total: "+g+" fonts in "+this.FontsMap.count()+" families")};PdfFont.getFont=function(f,b,a){if(this.FontsMap==null){WriteToConsoleError("[PdfFont::getFont] No fonts found")}else{var c=this.FontsMap[f];if(c!=null){for(var g=0;g<c.length;g++){var e=c[g];if(e.IsBold==b&&e.IsItalic==a){if(e.Fnt==null){e.Fnt=new PdfFont();e.Fnt.Init(e.FontPath,true)}return e.Fnt.Clone()}}WriteToConsoleError("[PdfFont::getFont] Font "+f+","+(b?"B":"")+(a?"I":"")+" not found in family");for(var g=0;g<c.length;g++){var e=c[g];if((b&&a&&(e.IsBold||e.IsItalic))||(!(b&&a)&&(b||a)&&!e.IsBold&&!e.IsItalic)){WriteToConsoleError("  -->  Replacing with "+f+","+(e.IsBold?"B":"")+(e.IsItalic?"I":""));if(e.Fnt==null){e.Fnt=new PdfFont();e.Fnt.Init(e.FontPath,true)}return e.Fnt.Clone()}}for(var g=0;g<c.length;g++){var e=c[g];if(e.Fnt==null){e.Fnt=new PdfFont();e.Fnt.Init(e.FontPath,true)}}return e.Fnt.Clone()}else{WriteToConsoleError("[PdfFont::getFont] Font "+f+" family not found")}}WriteToConsoleError("  -->  Replacing with HELVETICA,"+(b?"B":"")+(a?"I":""));var d=new PdfFont();if(b&&a){d.Init(PdfFont.HELVETICA_BOLDOBLIQUE)}else{if(b){d.Init(PdfFont.HELVETICA_BOLD)}else{if(a){d.Init(PdfFont.HELVETICA_OBLIQUE)}else{d.Init(PdfFont.HELVETICA)}}}return d};PdfFont.prototype.Clone=function(){var a=new PdfFont();if(this.FntDescriptor!=null){a.FntDescriptor=new PdfDictionary();a.FntDescriptor.Doc=this.Doc;if(this.FntDescriptor.Dictionary!=null){a.FntDescriptor.Add(this.FntDescriptor,false)}}if(this.FontFile!=null){this.FontFile.FormatObject();a.FontFile=new PdfObject();a.FontFile.Doc=this.Doc;a.FontFile.Data=this.FontFile.Data;a.FontFile.DataSize=this.FontFile.DataSize;a.FontFile.HasStream=this.FontFile.HasStream;if(this.FontFile.Dict!=null){a.FontFile.Dict=new PdfDictionary();a.FontFile.Dict.Doc=this.Doc;a.FontFile.Dict.Add(this.FontFile.Dict,false)}}a.head=this.head;a.hhea=this.hhea;a.os_2=this.os_2;a.GlyphWidths=this.GlyphWidths;a.EncodingTable=this.EncodingTable;a.KerningTable=this.KerningTable;a.IsSymbolicFont=this.IsSymbolicFont;a.BaseFont=this.BaseFont;a.IsItalic=this.IsItalic;a.IsBold=this.IsBold;a.FontPath=this.FontPath;a.FontName=this.FontName;a.FamilyName=this.FamilyName;a.FullName=this.FullName;a.iIsUnicode=this.iIsUnicode;a.Add(this,false);a.SrcFont=this;return a};PdfFont.prototype.IsUnicode=function(){return this.iIsUnicode&&this.FontPath.length>0};PdfFont.prototype.AddedText=function(a){if(a==null||a.length==0){return}var d=-1;var b=null;for(var c=0;c<a.length;c++){var e=PdfFont.WinAnsiDecode(a.charCodeAt(c));if((e>>8)!=d||d==-1){d=(e>>8);b=this.UsedGlyps[d];if(b==null){b=new Uint8Array(256);this.UsedGlyps[d]=b}}b[e&255]=true}};PdfFont.prototype.FormatObject=function(){if(!this.IsPredefined){if(this.IsUnicode()){var u="";var t="";var o=0;t+="[ ";var q=Object.keys(this.UsedGlyps);for(var A=0;A<q.length;A++){var k=q[A];var n=this.UsedGlyps[k];var h=0;var g=0;for(h=0;h<n.length&&!n[h];h++){}for(g=n.length-1;g>=0&&!n[g];g--){}for(var x=h;x<=g;x++){if(n[x]){var B=this.EncodingTable[(k<<8)+x];if(B==null&&PdfFont.WinAnsiEncode((k<<8)+x)!=(k<<8)+x){B=this.EncodingTable[PdfFont.WinAnsiEncode((k<<8)+x)]}if(B==null){WriteToConsoleError("[PdfFont::FormatObject] Can't find glyph "+((k<<8)+x)+" for USE");continue}t+=B.glyph;t+=" ["+B.width;var f=-1;var y=0;var s=B;for(y=x+1;y<=g;y++){var z=this.EncodingTable[(k<<8)+y];if(z!=null){if(f!=-1&&z.glyph!=f+1){break}f=z.glyph;s=z;t+=" "+(n[y]?z.width:0)}else{break}}var e=B.glyph.toString(16);e="0000".substring(0,4-e.length)+e;var d=s.glyph.toString(16);d="0000".substring(0,4-d.length)+d;var b=((k<<8)+x).toString(16);b="0000".substring(0,4-b.length)+b;u+="<";u+=e;u+="><";u+=d;u+="><";u+=b;u+=">\n";t+="] ";o++;x=y-1}}}t+="]";var c=this.DescFont.Get("/W");if(c==null){this.DescFont.Add("/W",t.toString())}else{c.SetData(t.toString())}var a="";a+="/CIDInit /ProcSet findresource begin\n";a+="12 dict begin\n";a+="begincmap\n";a+="/CIDSystemInfo\n";a+="<< /Registry (Adobe)\n";a+="/Ordering (UCS)\n";a+="/Supplement 0\n";a+=">> def\n";a+="/CMapName /Adobe-Identity-UCS def\n";a+="/CMapType 2 def\n";a+="1 begincodespacerange\n";a+="<0000><FFFF>\n";a+="endcodespacerange\n";a+=o+" beginbfrange\n";a+=u;a+="endbfrange\n";a+="endcmap\n";a+="CMapName currentdict /CMap defineresource pop\n";a+="end end";this.ToUnicode.Data=new Uint8Array(a.length);for(var A=0;A<a.length;A++){this.ToUnicode.Data[A]=a.charCodeAt(A)}this.ToUnicode.DataSize=this.ToUnicode.Data.length;this.ToUnicode.HasStream=true;this.ToUnicode.Dict.Add("/Length",this.ToUnicode.DataSize)}else{var r=0;var m=0;if(this.UsedGlyps.count()>0){var n=null;var q=Object.keys(this.UsedGlyps);for(var A=0;A<q.length;A++){var k=q[A];n=this.UsedGlyps[k];if(k==0){break}}n["?"]=true;for(r=0;r<256&&(!n[r]||this.GetCharWidth(r)==0);r++){}for(m=255;m>r&&(!n[m]||this.GetCharWidth(m)==0);m--){}for(var l=r;l<=m;l++){this.CharWidths.Add((n[l]?this.GetCharWidth(l):0),false)}}var c=this.Get("/FirstChar");if(c==null){this.Add("/FirstChar",r)}else{c.SetData(r)}c=this.Get("/LastChar");if(c==null){this.Add("/LastChar",m)}else{c.SetData(m)}}}PdfDictionary.prototype.FormatObject.call(this)};PdfFont.ToString=function(e,c,g,f){if(PdfFont.FontsMap==null){new VisAttrListIDRE()}var h="";var d=PdfFont.getFont(e,c,g);h+="  PdfFont pf = new PdfFont();\n";h+="  pf.IsItalic = "+d.IsItalic+";\n";h+="  pf.IsBold = "+d.IsBold+";\n";h+='  pf.FontName = "'+d.FontName+'";\n';h+='  pf.FamilyName = "'+d.FamilyName+'";\n';h+="  pf.IsSymbolicFont = "+d.IsSymbolicFont+";\n";h+="  pf.Ascent = "+d.getAscent()+";\n";h+="  pf.Descent = "+d.getDescent()+";\n";h+="  pf.LineGap = "+d.getLeading()+";\n";var j=0;if(d.GlyphWidths!=null){h+="  pf.GlyphWidths = new Array(";j=0;for(;j<d.GlyphWidths.length;j++){h+=(j>0?", ":"")+d.GlyphWidths[j];if(j%40==39){h+="\n    "}}h+="  );\n"}if(d.KerningTable!=null){h+="  pf.KerningTable = {";j=0;var m=Object.keys(d.KerningTable);for(var b=0;b<m.length;b++){var a=m[b];var l=d.KerningTable[a];h+=(j>0?", ":"")+'"'+a+'" : "'+l+'"';if(++j%40==39){h+="\n    "}}h+="  };\n"}if(d.EncodingTable!=null){h+="  pf.EncodingTable = {";j=0;var m=Object.keys(d.EncodingTable);for(var b=0;b<m.length;b++){var a=m[b];var l=d.EncodingTable[a];h+=(j>0?", ":"")+'"'+a+'" : {"glyph" : "'+l.glyph+'" , "width" : "'+l.width+'"}';if(++j%40==39){h+="\n    "}}h+="  };\n"}};function t_GRState(){this.LineWidth;this.LineCap;this.LineJoin;this.LineMiterLimit;this.DashPhase;this.DashOn;this.DashOff;this.LineColorRGB;this.LineColorGray;this.FillColorRGB;this.FillColorGray;this.TextMode;this.TextFont;this.Rotation}t_GRState.prototype.Reset=function(){this.LineWidth=1;this.LineCap=PdfGraphics.LINE_CAP_BUTTCAP;this.LineJoin=PdfGraphics.LINE_JOIN_MITER;this.LineMiterLimit=10;this.DashPhase=0;this.DashOn=-1;this.DashOff=-1;this.LineColorRGB=-1;this.LineColorGray=-1;this.FillColorRGB=-1;this.FillColorGray=-1;this.TextMode=PdfGraphics.TEXT_FILL;this.TextFont="";this.Rotation=0};function PdfGraphics(){PdfObject.call(this);this.ParentPage=null;this.Fonts=new ArrayList();this.CursTx=0;this.CursTy=0;this.CurrState=new t_GRState();this.CurrState.Reset();this.CurrentLen=0;this.HasStream=true}PdfGraphics.prototype=new PdfObject();for(var i=0;i<Object.keys(PdfObject).length;i++){var obj=Object.keys(PdfObject)[i];PdfGraphics[obj]=PdfObject[obj]}PdfGraphics.LINE_CAP_BUTTCAP=0;PdfGraphics.LINE_CAP_ROUND=1;PdfGraphics.LINE_CAP_SQUARE=2;PdfGraphics.LINE_JOIN_MITER=0;PdfGraphics.LINE_JOIN_ROUND=1;PdfGraphics.LINE_JOIN_BEVEL=2;PdfGraphics.TEXT_FILL=0;PdfGraphics.TEXT_STRO=1;PdfGraphics.TEXT_FILL_STRO=2;PdfGraphics.TEXT_NONE=3;PdfGraphics.TEXT_FILL_CLIP=4;PdfGraphics.TEXT_STRO_CLIP=5;PdfGraphics.TEXT_FILL_STRO_CLIP=6;PdfGraphics.TEXT_CLIP=7;PdfGraphics.prototype.FormatDouble=function(a){return a.toFixed(2)};PdfGraphics.prototype.Add=function(d){if(this.DataSize==-1){this.DataSize=200;if(PdfDocument.CR_LEN+d.length>this.DataSize){this.DataSize=PdfDocument.CR_LEN+d.length+10}this.Data=new Uint8Array(this.DataSize)}if(PdfDocument.CR_LEN+this.CurrentLen+d.length>this.DataSize){this.DataSize=Math.max(this.DataSize*2,PdfDocument.CR_LEN+this.CurrentLen+d.length);var e=this.Data;this.Data=new Uint8Array(this.DataSize);for(var c=0;c<e.length;c++){this.Data[c]=e[c]}}if(this.CurrentLen>0){for(var c=0;c<PdfDocument.CR_LEN;c++){this.Data[this.CurrentLen+c]=PdfDocument.CR.charCodeAt(c)}this.CurrentLen+=PdfDocument.CR_LEN}for(var c=0;c<d.length;c++){var a=d.charCodeAt(c);if(a>255){a=PdfFont.WinAnsiDecode(a)}this.Data[this.CurrentLen+c]=a}this.CurrentLen+=d.length};PdfGraphics.prototype.FormatObject=function(){this.DataSize=this.CurrentLen;if(this.Dict==null){this.Dict=new PdfDictionary();this.Dict.Doc=this.Doc}var c=this.Dict.Get("/Length");if(c==null){c=this.Dict.Add("/Length",0)}c.Value=this.DataSize;if(this.Fonts.Count()>0){for(var b=0;b<this.Fonts.Count();b++){var d=this.Fonts[b];var a="/F"+d.ID;this.Doc.AddToResource(this.ParentPage,"/Font",a,d)}this.Doc.AddToResource(this.ParentPage,"/ProcSet","/Text");this.ParentPage.FormatObject()}PdfObject.prototype.FormatObject.call(this)};PdfGraphics.prototype.AddExtGS=function(c){var b=this.Doc.GetExtGS(c);if(b==null){b=new PdfDictionary();b.Add("/Type","/ExtGState");b.Add("/ca",c);b.Add("/CA",c);this.Doc.AddChild(b);this.Doc.ExtGRStates.Add(b)}var a="/GS"+b.ID;this.Doc.AddToResource(this.Doc.CurrPage,"/ExtGState",a,b);return b};PdfGraphics.prototype.SetLineWidth=function(a){if(this.CurrState.LineWidth!=a){this.CurrState.LineWidth=a;this.Add(this.FormatDouble(a)+" w")}};PdfGraphics.prototype.SetLineCap=function(a){if(this.CurrState.LineCap!=a){this.CurrState.LineCap=a;this.Add(a+" J")}};PdfGraphics.prototype.SetLineJoin=function(a){if(this.CurrState.LineJoin!=a){this.CurrState.LineJoin=a;this.Add(a+" j")}};PdfGraphics.prototype.SetLineMiterLimit=function(a){if(this.CurrState.LineMiterLimit!=a){this.CurrState.LineMiterLimit=a;this.Add(this.FormatDouble(a)+" M")}};PdfGraphics.prototype.SetLineDashPattern=function(b,a,e){if(this.CurrState.DashPhase!=b||this.CurrState.DashOn!=a||this.CurrState.DashOff!=e){this.CurrState.DashPhase=b;this.CurrState.DashOn=a;this.CurrState.DashOff=e;var d;if(a!=-1){if(e!=-1){d="["+this.FormatDouble(a)+" "+this.FormatDouble(e)}else{d="["+this.FormatDouble(a)}}else{d="["}var c="] "+b+" d";this.Add(d+c)}};PdfGraphics.prototype.SetLineColor=function(j,h,f){if(h==undefined){var c=j;if(this.CurrState.LineColorGray!=c){this.CurrState.LineColorGray=c;this.Add(this.FormatDouble(c/256)+" G")}}else{var e=j;var d=h;var a=f;if(this.CurrState.LineColorRGB!=((e<<16)|(d<<8)|a)){this.CurrState.LineColorRGB=(e<<16)|(d<<8)|a;this.Add(this.FormatDouble(e/256)+" "+this.FormatDouble(d/256)+" "+this.FormatDouble(a/256)+" RG")}}};PdfGraphics.prototype.SetFillColor=function(j,h,f){if(h==undefined){var c=j;if(this.CurrState.FillColorGray!=c){this.CurrState.FillColorGray=c;this.Add(this.FormatDouble(c/256)+" g")}}else{var e=j;var d=h;var a=f;if(this.CurrState.FillColorRGB!=((a<<16)|(d<<8)|e)){this.CurrState.FillColorRGB=(a<<16)|(d<<8)|e;this.Add(this.FormatDouble(e/256)+" "+this.FormatDouble(d/256)+" "+this.FormatDouble(a/256)+" rg")}}};PdfGraphics.prototype.SetFillPattern=function(a){this.Add("q"+PdfDocument.CR+"/Pattern cs"+PdfDocument.CR+"/P"+a.ID+" scn")};PdfGraphics.prototype.CloseFillPattern=function(){this.Add("Q")};PdfGraphics.prototype.SetColor=function(j,h,f){if(h==undefined){var c=j;this.SetLineColor(c);this.SetFillColor(c)}else{var e=j;var d=h;var a=f;this.SetLineColor(e,d,a);this.SetFillColor(e,d,a)}};PdfGraphics.prototype.SetTextMode=function(a){if(this.CurrState.TextMode!=a){this.CurrState.TextMode=a;this.Add(a+" Tr")}};PdfGraphics.prototype.SetTextFont=function(c,a){var b="/F"+c.ID+" "+this.FormatDouble(a)+" Tf";if(!this.CurrState.TextFont==b){this.CurrState.TextFont=b;this.Add(b)}};PdfGraphics.prototype.SetTextPosition=function(a,b){this.Add(this.FormatDouble(a)+" "+this.FormatDouble(b)+" Td")};PdfGraphics.prototype.SetRotation=function(c,b,g){if(this.CurrState.Rotation!=c){this.CurrState.Rotation=c;var f=this.CurrState.Rotation*Math.PI/180;var e=Math.cos(f);var d=Math.sin(f);this.Add("q");this.Add("1 0 0 1 "+this.FormatDouble(b)+" "+this.FormatDouble(g)+" cm");this.Add(this.FormatDouble(e)+" "+this.FormatDouble(d)+" "+this.FormatDouble(-d)+" "+this.FormatDouble(e)+" 0 0 cm");this.Add("1 0 0 1 "+this.FormatDouble(-b)+" "+this.FormatDouble(-g)+" cm")}};PdfGraphics.prototype.UndoRotation=function(){this.Add("Q");this.CurrState.Reset()};PdfGraphics.prototype.AddText=function(z,o,m,q,K,e,k,L,g,c,t,F,f,E){if(L==undefined){L=false}if(g==undefined){g=false}if(c==undefined){c=-1}if(t==undefined){t=100}if(F==undefined){F=0}if(f==undefined){f=0}if(E==undefined){E=100}var v="BT";if(K==-1){K=this.Doc.CurrFontHeight}var b=0;var a=0;if(o!=-1&&m!=-1){var d=PdfDocument.CR+this.FormatDouble(o)+" "+this.FormatDouble(m)+" Td";b=o;a=m;v+=d}else{if(CursTx!=0||CursTy-K!=0){var d=PdfDocument.CR+"1 0 0 1 "+this.FormatDouble(CursTx)+" "+this.FormatDouble(CursTy-K)+" cm";v+=d;b=this.CursTx;a=this.CursTy-K;this.CursTx=0;this.CursTy=0}}if(q!=-1&&this.CurrState.LineWidth!=q){this.CurrState.LineWidth=q;var d=PdfDocument.CR+this.FormatDouble(q)+" w";v+=d}if(e!=-1&&this.CurrState.TextMode!=e){this.CurrState.TextMode=e;var d=PdfDocument.CR+e+" Tr";v+=v}var l=null;if(k!=-1){var J=this.Doc.GetObjectByID(k);if(J instanceof PdfFont){l=J}}else{l=this.Doc.CurrFont}if(l!=null){var C=false;for(var I=0;I<this.Fonts.Count()&&!C;I++){if(this.Fonts[I]==l){C=true}}if(!C){this.Fonts.Add(l)}var d=PdfDocument.CR+"/F"+l.ID+" "+this.FormatDouble(K)+" Tf";if(this.CurrState.TextFont!=d){this.CurrState.TextFont=d;v+=d}}if(L){v+=PdfDocument.CR+this.FormatDouble(K/30)+" w";v+=PdfDocument.CR+""+PdfGraphics.TEXT_FILL_STRO+" Tr"}if(g){v+=PdfDocument.CR+"1 0 0.21256 1 "+this.FormatDouble(b)+" "+this.FormatDouble(a)+" Tm"}if(c>0&&E!=100){c=c/E*100}if(c>0){var H=0;var n=0;var A=false;for(var I=z.length-1;I>=0;I--){if(z[I]!=" "){A=true}if(A){if(z[I]==" "){H++}n++}}var j=-1;var B=-1;if(H>0){var D=l.GetCharWidth(" ")/1000*K;if(c/D>4){j=c*0.4/H;B=c*0.6/(n-1)}else{j=c/H}}else{B=c/(n-1)}if(f!=0){j=(j==-1?0:j)+f/100}if(F!=0){B=(B==-1?0:B)+F/100}if(j!=-1){v+=PdfDocument.CR+this.FormatDouble(j)+" Tw"}if(B!=-1){v+=PdfDocument.CR+this.FormatDouble(B)+" Tc"}}else{if(f!=0){v+=PdfDocument.CR+this.FormatDouble(f/100)+" Tw"}if(F!=0){v+=PdfDocument.CR+this.FormatDouble(F/100)+" Tc"}}if(E!=100){v+=PdfDocument.CR+E+" Tz"}if(!l.IsUnicode()){v+=PdfDocument.CR+"("+PdfObject.AdaptString(z)+")Tj"}else{v+=PdfDocument.CR+"(";for(var u=0;u<z.length;u++){var r=z.charCodeAt(u);var G=l.EncodingTable[r];if(G!=null){var d=""+String.fromCharCode(PdfFont.WinAnsiEncode(G.glyph>>8))+String.fromCharCode(PdfFont.WinAnsiEncode(G.glyph&255));v+=PdfObject.AdaptString(d)}else{WriteToConsoleError("[PdfGraphics::AddText] Can't find encoding for glyph '"+String.fromCharCode(r)+"' ("+r+")")}}v+=")Tj"}if(L){v+=PdfDocument.CR+this.FormatDouble(this.CurrState.LineWidth)+" w";v+=PdfDocument.CR+this.CurrState.TextMode+" Tr"}if(g){v+=PdfDocument.CR+"1 0 0 1 "+this.FormatDouble(b)+" "+this.FormatDouble(a)+" Tm"}if(c!=-1){v+=PdfDocument.CR+"0 Tc"+PdfDocument.CR+"0 Tw"}else{if(f!=0){v+=PdfDocument.CR+"0 Tw"}if(F!=0){v+=PdfDocument.CR+"0 Tc"}}if(E!=100){v+=PdfDocument.CR+"100 Tz"}v+=PdfDocument.CR+"ET";this.Add(v);l.AddedText(z)};PdfGraphics.prototype.AddRectangle=function(b,h,a,g,e,d){if(e==undefined){e=false}if(d==undefined){d=100}if(d<100){var c=this.AddExtGS(d/100);this.Add("q"+PdfDocument.CR+"/GS"+c.ID+" gs")}var f=this.FormatDouble(b)+" "+this.FormatDouble(h)+" "+this.FormatDouble(a)+" "+this.FormatDouble(g)+" re"+PdfDocument.CR+(e?"f":"s");this.Add(f);if(d<100){this.Add("Q")}this.CursTx+=b;this.CursTy+=h+g};PdfGraphics.prototype.AddBezier=function(c,h,b,g,a,f,k,e,d){if(d==undefined){d=false}var j=this.FormatDouble(c)+" "+this.FormatDouble(h)+" "+PdfDocument.CR+this.FormatDouble(b)+" "+this.FormatDouble(g)+" "+this.FormatDouble(a)+" "+this.FormatDouble(f)+"  c"+PdfDocument.CR;if(d){j+="b"}else{j+="s"}this.Add(j)};PdfGraphics.KAPPA=0.5522847498;PdfGraphics.prototype.AddCircle=function(a,f,e,b){if(b==undefined){b=false}var d="";var c="";c=this.FormatDouble(a-e)+" "+this.FormatDouble(f)+" m"+PdfDocument.CR;d+=c;c=this.FormatDouble(a-e)+" "+this.FormatDouble(f+PdfGraphics.KAPPA*e)+" "+this.FormatDouble(a-PdfGraphics.KAPPA*e)+" "+this.FormatDouble(f+e)+" "+this.FormatDouble(a)+" "+this.FormatDouble(f+e)+" c"+PdfDocument.CR;d+=c;c=this.FormatDouble(a+PdfGraphics.PdfGraphics.KAPPA*e)+" "+this.FormatDouble(f+e)+" "+this.FormatDouble(a+e)+" "+this.FormatDouble(f+PdfGraphics.KAPPA*e)+" "+this.FormatDouble(a+e)+" "+this.FormatDouble(f)+" c"+PdfDocument.CR;d+=c;c=this.FormatDouble(a+e)+" "+this.FormatDouble(f-PdfGraphics.KAPPA*e)+" "+this.FormatDouble(a+PdfGraphics.KAPPA*e)+" "+this.FormatDouble(f-e)+" "+this.FormatDouble(a)+" "+this.FormatDouble(f-e)+" c"+PdfDocument.CR;d+=c;c=this.FormatDouble(a-PdfGraphics.KAPPA*e)+" "+this.FormatDouble(f-e)+" "+this.FormatDouble(a-e)+" "+this.FormatDouble(f-PdfGraphics.KAPPA*e)+" "+this.FormatDouble(a-e)+" "+this.FormatDouble(f)+" c"+PdfDocument.CR;d+=c;if(b){d+="b"}else{d+="s"}this.Add(d)};PdfGraphics.prototype.AddLine=function(b,e,a,c){var d=this.FormatDouble(b)+" "+this.FormatDouble(e)+" m"+PdfDocument.CR+this.FormatDouble(a)+" "+this.FormatDouble(c)+" l"+PdfDocument.CR+"S";this.Add(d)};PdfGraphics.prototype.AddImage=function(a,g,f,b,e,d){var c;if(d!=null){c="q"+PdfDocument.CR+this.FormatDouble(d.left())+" "+this.FormatDouble(d.top())+" "+this.FormatDouble(d.right()-d.left())+" "+this.FormatDouble(d.bottom()-d.top())+" re"+PdfDocument.CR+"W n";this.Add(c)}c="q"+PdfDocument.CR+this.FormatDouble(b)+" 0 0 "+this.FormatDouble(e)+" "+this.FormatDouble(a)+" "+this.FormatDouble(g)+" cm"+PdfDocument.CR+"/Image"+f.ID+" Do"+PdfDocument.CR+"Q";this.Add(c);if(d!=null){this.Add("Q")}};function PdfImage(){PdfObject.call(this);this.Height=-1;this.Width=-1;this.Palette=null;this.PaletteLen=-1;this.PaletteSize=-1;this.BitsPerComponent=-1;this.ColorSpace=-1;this.Param;this.Dict=new PdfDictionary()}PdfImage.prototype=new PdfObject();for(var i=0;i<Object.keys(PdfObject).length;i++){var obj=Object.keys(PdfObject)[i];PdfImage[obj]=PdfObject[obj]}PdfImage.prototype.Init=function(c,a){this.Dict.Add("/Type","/XObject");this.Dict.Add("/Subtype","/Image");this.Dict.Add("/Width",this.Width);this.Dict.Add("/Height",this.Height);this.Dict.Add("/BitsPerComponent",this.BitsPerComponent);switch(this.ColorSpace){case 0:break;case 1:this.Dict.Add("/ColorSpace","/DeviceGray");break;case 3:if(this.Palette!=null){var b=new PdfArray();b.Add("/Indexed");b.Add("/DeviceRGB");b.Add(this.PaletteSize/3-1);b.Add(this.Palette,this.PaletteLen);this.Palette=null;this.Dict.Add("/ColorSpace",b)}else{this.Dict.Add("/ColorSpace","/DeviceRGB")}break;case 4:this.Dict.Add("/ColorSpace","/DeviceCMYK");break}this.HasStream=true;this.Dict.Add("/Length",this.DataSize)};function Bitmap(){PdfImage.call(this);this.bmih=new t_BITMAPINFOHEADER();this.bmfh=new t_BITMAPFILEHEADER()}Bitmap.prototype=new PdfImage();for(var i=0;i<Object.keys(PdfImage).length;i++){var obj=Object.keys(PdfImage)[i];Bitmap[obj]=PdfImage[obj]}Bitmap.BMP_BI_RGB=0;Bitmap.BMP_BI_RLE8=1;Bitmap.BMP_BI_RLE4=2;Bitmap.BMP_BI_BITFIELDS=3;function t_BITMAPFILEHEADER(){this.bfType;this.bfSize;this.bfReserved1;this.bfReserved2;this.bfOffBits}function t_BITMAPINFOHEADER(){this.biSize;this.biWidth;this.biHeight;this.biPlanes;this.biBitCount;this.biCompression;this.biSizeImage;this.biXPelsPerMeter;this.biYPelsPerMeter;this.biClrUsed;this.biClrImportant}Bitmap.prototype.Init=function(c,b){var a=new MemoryStream(c);this.bmfh.bfType=PdfObject.GetSHORT(a);this.bmfh.bfSize=PdfObject.GetUINT(a);this.bmfh.bfReserved1=PdfObject.GetSHORT(a);this.bmfh.bfReserved2=PdfObject.GetSHORT(a);this.bmfh.bfOffBits=PdfObject.GetUINT(a);if(this.bmfh.bfType!=(66+(77<<8))){throw new Error("[Bitmap::Init] Wrong start type (BM)")}this.bmih.biSize=PdfObject.GetUINT(a);this.bmih.biWidth=PdfObject.GetUINT(a);this.bmih.biHeight=PdfObject.GetUINT(a);this.bmih.biPlanes=PdfObject.GetSHORT(a);this.bmih.biBitCount=PdfObject.GetSHORT(a);this.bmih.biCompression=PdfObject.GetUINT(a);this.bmih.biSizeImage=PdfObject.GetUINT(a);this.bmih.biXPelsPerMeter=PdfObject.GetUINT(a);this.bmih.biYPelsPerMeter=PdfObject.GetUINT(a);this.bmih.biClrUsed=PdfObject.GetUINT(a);this.bmih.biClrImportant=PdfObject.GetUINT(a);if(this.bmih.biCompression!=Bitmap.BMP_BI_RGB&&this.bmih.biCompression!=Bitmap.BMP_BI_RLE4&&this.bmih.biCompression!=Bitmap.BMP_BI_RLE8){throw new Error("[Bitmap::Init] Wrong compression type ("+this.bmih.biCompression+")")}if(this.bmih.biBitCount==1||this.bmih.biBitCount==4||this.bmih.biBitCount==8){this.ComputePalette(a,((this.bmfh.bfOffBits-14-this.bmih.biSize)/4))}switch(this.bmih.biBitCount){case 1:case 4:case 8:this.readNBit(this.bmih.biBitCount,a);break;case 24:case 32:this.read2432Bit(a,(this.bmih.biBitCount==32));break;default:throw new Error("[Bitmap::Init] Unsupported bit count ("+this.bmih.biBitCount+")")}this.Height=this.bmih.biHeight;this.Width=this.bmih.biWidth;this.BitsPerComponent=this.bmih.biBitCount;this.ColorSpace=3;if(this.BitsPerComponent==24||this.BitsPerComponent==32){this.BitsPerComponent=8}PdfImage.prototype.Init.call(this,c,b)};Bitmap.prototype.readNBit=function(c,a){var b=Math.floor(this.bmih.biWidth/(8/this.nBitsPerPixel)+0.9999);this.DataSize=b*this.bmih.biHeight;this.Data=new Uint8Array(this.DataSize);var l=(b%4==0?0:4-b%4);var g=null;if(this.bmih.biCompression!=0){if(!(c==4||c==8)||!(c!=4||this.bmih.biCompression==Bitmap.BMP_BI_RLE4)||!(c!=8||this.bmih.biCompression==Bitmap.BMP_BI_RLE8)){throw new Exception("[Bitmap::readNBit] Unsupported combination of bitPerPixel and Compression (BPP = "+c+", COMRP = "+this.bmih.biCompression+")")}g=new Uint8Array(this.bmih.biWidth*this.bmih.biHeight);var k=new Boxer(g);this.DecodeRLE(c==8,a,k);g=k.arrayValue();if(c==4){for(var m=0;m<this.bmih.biHeight;m++){for(var n=0;n<this.bmih.biWidth;n+=2){g[n/2+m*this.bmih.biWidth/2]=((g[n+m*this.bmih.biWidth]<<4)+(g[n+1+m*this.bmih.biWidth]&15))}}}}else{g=new Uint8Array(a.Length-a.Position);try{a.Read(g,0,g.length)}catch(h){throw new Error("[Bitmap::readNBit] Exception while reading from DataPixel buffer")}}for(var f=0;f<this.bmih.biHeight;f++){for(var d=0;d<b;d++){this.Data[f*b+d]=g[(b+l)*this.bmih.biHeight-(f+1)*(b+l)+d]}}if(this.bmih.biCompression!=0){g=null}};Bitmap.prototype.read2432Bit=function(g,d){this.DataSize=this.bmih.biWidth*this.bmih.biHeight*3;this.Data=new Uint8Array(this.DataSize);var e=this.bmih.biWidth*24/8;var f=(e%4==0?0:4-e%4);if(d){f=0}for(var c=0;c<this.bmih.biHeight;c++){var a=(this.bmih.biWidth*this.bmih.biHeight*3-1)-(c+1)*this.bmih.biWidth*3+1;for(var b=0;b<this.bmih.biWidth;b++){this.Data[a+2]=PdfObject.GetNUINT(g,1);this.Data[a+1]=PdfObject.GetNUINT(g,1);this.Data[a]=PdfObject.GetNUINT(g,1);if(d){PdfObject.GetNUINT(g,1)}a+=3}g.Seek(f)}};Bitmap.prototype.DecodeRLE=function(c,a,h){var b=h.arrayValue();var g=0;var l;var j;var k=false;l=j=0;while(g<this.bmih.biSizeImage&&!k){var d=a.ReadByte();g++;if(d!=0){var f=a.ReadByte();g++;if(c){for(var e=0;e<d;e++){b[l+e+j*this.bmih.biWidth]=f}}else{for(var e=0;e<d;e++){b[l+e+j*this.bmih.biWidth]=((e%2)==0?f>>4:f&15)}}l+=d}else{d=a.ReadByte();g++;switch(d){case 0:l=0;j++;break;case 1:k=true;break;case 2:l+=a.ReadByte();j+=a.ReadByte();g+=2;break;default:if(c){for(var e=0;e<d;e++){b[l+e+j*this.bmih.biWidth]=a.ReadByte();g++}}else{var f=0;for(var e=0;e<d;e++){if((e%2)==0){f=a.ReadByte();g++}b[l+e+j*this.bmih.biWidth]=((e%2)==0?f>>4:f&15)}}l+=d;if(c){if(d%2!=0){a.Seek(1);g++}}else{if((d&3)==1||(d&3)==2){a.Seek(1);g++}}break}}}};Bitmap.prototype.ComputePalette=function(e,a){this.Palette=new Uint8Array(a*6+2);this.PaletteSize=a*3;this.PaletteLen=0;this.Palette[this.PaletteLen++]=40;var c=new Uint8Array(3);for(var d=0;d<a;d++){c[2]=e.ReadByte();c[1]=e.ReadByte();c[0]=e.ReadByte();e.ReadByte();for(var b=0;b<3;b++){switch(c[b]){case 10:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=110;break;case 13:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=114;break;case 9:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=116;break;case 8:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=98;break;case 12:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=102;break;case 40:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=40;break;case 41:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=41;break;case 92:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=92;break;default:this.Palette[this.PaletteLen++]=c[b];break}}}this.Palette[this.PaletteLen++]=41};function GifLZWDictionary(b){this.pNext=new Int16Array(4096);this.pAdded=new Int16Array(4096);this.StartSize;this.Size;this.PostBytes=new Int16Array(4096);this.PostBytesLen=0;this.StartSize=b;for(var a=0;a<4096;a++){if(a<this.StartSize){this.pNext[a]=a}else{this.pNext[a]=-1}this.pAdded[a]=-1}this.Size=this.StartSize+2}GifLZWDictionary.prototype.Reset=function(){this.Size=this.StartSize+2};GifLZWDictionary.prototype.AddItem=function(a,b){this.pNext[this.Size]=a;this.pAdded[this.Size]=b;this.Size++};GifLZWDictionary.prototype.GetString=function(c,b,a){this.PostBytesLen=0;while(true){if(c<=this.StartSize){b[a++]=c;if(this.pAdded[c]!=-1){this.PostBytes[this.PostBytesLen++]=this.pAdded[c]}break}else{if(this.pAdded[c]!=-1){this.PostBytes[this.PostBytesLen++]=this.pAdded[c]}c=this.pNext[c]}}for(var d=this.PostBytesLen-1;d>=0;d--){b[a++]=this.PostBytes[d]}return a};function Gif(){PdfImage.call(this);this.gifh=new t_GIFHEADER();this.giim=new t_GIFIMAGEBLOCK();this.Param=1;this.Block=new Uint8Array(256)}Gif.prototype=new PdfImage();for(var i=0;i<Object.keys(PdfImage).length;i++){var obj=Object.keys(PdfImage)[i];Gif[obj]=PdfImage[obj]}function t_GIFHEADER(){this.ghTag;this.ghType;this.ghLogWidth;this.ghLogHeight;this.ghGlobColTable;this.ghColResol;this.ghSortGlobColTable;this.ghGlobColTableSize;this.ghBackColIdx;this.ghAspectRatio}function t_GIFIMAGEBLOCK(){this.gimLeft;this.gimTop;this.gimWidth;this.gimHeight;this.gimLocColTable;this.gimInterlace;this.gimSort;this.gimLocColTableSize}Gif.prototype.Init=function(c,f){var o=new MemoryStream(c);this.gifh.ghTag=PdfObject.GetNUINT(o,3);this.gifh.ghType=PdfObject.GetNUINT(o,3);this.gifh.ghLogWidth=PdfObject.GetSHORT(o);this.gifh.ghLogHeight=PdfObject.GetSHORT(o);var n=PdfObject.GetNUINT(o,1);if(n<0){n+=256}this.gifh.ghGlobColTable=((n>>7)&1)!=0;this.gifh.ghColResol=((n>>4)&7);this.gifh.ghSortGlobColTable=((n>>3)&1)!=0;this.gifh.ghGlobColTableSize=(n&7);this.gifh.ghBackColIdx=PdfObject.GetNUINT(o,1);this.gifh.ghAspectRatio=PdfObject.GetNUINT(o,1);switch(this.gifh.ghGlobColTableSize){case 0:case 1:case 3:this.BitsPerComponent=this.gifh.ghGlobColTableSize+1;break;case 2:this.BitsPerComponent=4;break;default:this.BitsPerComponent=8;break}if(this.gifh.ghTag!=(71+(73<<8)+(70<<16))){throw new Error("[Gif::Init] Not a GIF file! (TAG = 0x"+this.gifh.ghTag.toString(16)+")")}if(this.gifh.ghType!=(56+(55<<8)+(97<<16))&&this.gifh.ghType!=(56+(57<<8)+(97<<16))){throw new Error("[Gif::Init] Only GIF87a and GIF89a are supported (TYPE = 0x"+this.gifh.ghType.toString(16)+")")}if(this.gifh.ghGlobColTable){this.ComputePalette(o,(1<<(this.gifh.ghGlobColTableSize+1)))}var j=-1;var g=1;var m=false;var d;while(!m){var k=o.ReadByte();switch(k){case 44:this.readImageData(o,g==this.Param);g++;break;case 33:var e=o.ReadByte();switch(e){case 249:o.Seek(1);d=(PdfObject.GetNUINT(o,1)&1);o.Seek(2);if(d!=0){if(g==this.Param){j=PdfObject.GetNUINT(o,1)}else{o.Seek(1)}}d=PdfObject.GetNUINT(o,1);if(d!=0){throw new Error("[Gif::Init] GCEB block not terminated! (b = 0x"+d.toString(16)+")")}break;case 254:d=PdfObject.GetNUINT(o,1);o.Seek(d);d=PdfObject.GetNUINT(o,1);if(d!=0){throw new Error("[Gif::Init] CEB block not terminated! (b = 0x"+d.toString(16)+")")}break;case 1:o.Seek(13);d=PdfObject.GetNUINT(o,1);o.Seek(d);d=PdfObject.GetNUINT(o,1);if(d!=0){throw new Error("[Gif::Init] PTEB block not terminated! (b = 0x"+d.toString(16)+")")}break;case 255:o.Seek(1);var h=PdfObject.GetString(o,8);var l=PdfObject.GetString(o,3);if(h.equals("XMP Data")&&l.equals("XMP")){this.readZeroTerminatedBlock(o)}else{d=PdfObject.GetNUINT(o,1);while(this.readSubBlock(o)!=0){}}d=PdfObject.GetNUINT(o,1);if(d!=0){throw new Error("[Gif::Init] AEB block not terminated! (b = 0x"+d.toString(16)+")")}break}break;case 59:m=true;break;case 0:break;default:throw new Error("[Gif::Init] Unknown block type (Type = 0x"+k.toString(16)+")")}}this.ColorSpace=3;if(j!=-1){var a=new PdfArray();a.Add(j);a.Add(j,false);this.Dict.Add("/Mask",a)}PdfImage.prototype.Init.call(this,c,f)};Gif.prototype.ComputePalette=function(e,c){this.Palette=new Uint8Array(c*6+2);this.PaletteSize=c*3;this.PaletteLen=0;this.Palette[this.PaletteLen++]=40;for(var d=0;d<c*3;d++){var a=e.ReadByte();switch(a){case 10:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=110;break;case 13:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=114;break;case 9:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=116;break;case 8:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=98;break;case 12:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=102;break;case 40:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=40;break;case 41:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=41;break;case 92:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=92;break;default:this.Palette[this.PaletteLen++]=a;break}}this.Palette[this.PaletteLen++]=41};Gif.prototype.readImageData=function(e,o){this.giim.gimLeft=PdfObject.GetSHORT(e);this.giim.gimTop=PdfObject.GetSHORT(e);this.giim.gimWidth=PdfObject.GetSHORT(e);this.giim.gimHeight=PdfObject.GetSHORT(e);if(o){this.Height=this.giim.gimHeight;this.Width=this.giim.gimWidth}var B=PdfObject.GetNUINT(e,1);this.giim.gimLocColTable=((B>>7)&1)!=0;this.giim.gimInterlace=((B>>6)&1)!=0;this.giim.gimSort=((B>>5)&4)!=0;this.giim.gimLocColTableSize=(B&7);if(this.giim.gimLocColTable){switch(this.giim.gimLocColTableSize){case 0:case 1:case 3:this.BitsPerComponent=this.giim.gimLocColTableSize+1;break;case 2:this.BitsPerComponent=4;break;default:this.BitsPerComponent=8;break}this.ComputePalette(e,(1<<(this.giim.gimLocColTableSize+1)))}if(o){if(this.BitsPerComponent==8){this.DataSize=this.giim.gimWidth*this.giim.gimHeight}else{this.DataSize=(this.giim.gimWidth*this.BitsPerComponent+7)/8*this.giim.gimHeight}this.Data=new Uint8Array(this.DataSize);if(this.BitsPerComponent!=8){for(var u=0;u<this.DataSize;u++){this.Data[u]=0}}}var r=PdfObject.GetNUINT(e,1);var c=1<<r;var t=c+1;var g=0;var n=0;var l=0;var j=0;var k=this.readSubBlock(e);var f=0;var v=0;var h=0;var A=false;var m=new GifLZWDictionary(c);var d=new Uint16Array(4096);var s;var a=0;var D=(this.giim.gimInterlace?8:1);while(g!=t){g=-1;var C;if(m.Size>=2048){C=12}else{if(m.Size>=1024){C=11}else{if(m.Size>=512){C=10}else{if(m.Size>=256){C=9}else{if(m.Size>=128){C=8}else{if(m.Size>=64){C=7}else{if(m.Size>=32){C=6}else{if(m.Size>=16){C=5}else{if(m.Size>=8){C=4}else{if(m.Size>=4){C=3}else{if(m.Size>=2){C=2}else{C=1}}}}}}}}}}}if(h<C){v|=(this.Block[f++]<<h);h+=8;if(f==k){k=this.readSubBlock(e);f=0;if(k==0){g=t;e.Seek(-1)}}if(g!=t&&h<C){v|=(this.Block[f++]<<h);h+=8;if(f==k){k=this.readSubBlock(e);f=0;if(k==0){g=t;e.Seek(-1)}}}}if(g!=t){g=v&((1<<C)-1);v>>=C;h-=C}s=0;if(g>m.Size+2){throw new Error("[Gif::readImageData] Wrong dict size (Code = "+g+", DictSize = "+m.Size)}if(g==c){m.Reset();A=true}else{if(g==t){break}else{if(A){A=false;s=m.GetString(g,d,s);n=g}else{if(g<m.Size){s=m.GetString(g,d,s);m.AddItem(n,d[0]);n=g}else{s=m.GetString(n,d,s);d[s++]=d[0];m.AddItem(n,d[0]);n=g}}}}if(s!=0&&o){for(var u=0;u<s;u++){if(this.BitsPerComponent==8){this.Data[l+j*this.giim.gimWidth]=d[u]}else{var z=(this.giim.gimWidth*this.BitsPerComponent+7)/8*j+l/(8/this.BitsPerComponent);var q=(d[u]<<(8-this.BitsPerComponent*(l%(8/this.BitsPerComponent))-this.BitsPerComponent));this.Data[z]|=q}l++;if(l>=this.giim.gimWidth){l=0;j=j+D;if(j>this.giim.gimHeight){if(!this.giim.gimInterlace){throw new Error("[Gif::readImageData] Too many bits for an un-interlaced image")}switch(a++){case 0:j=4;D=8;break;case 1:j=2;D=4;break;case 2:j=1;D=2;break}}}}}}m=null;d=null};Gif.prototype.readSubBlock=function(c){var b=PdfObject.GetNUINT(c,1);for(var a=0;a<b;a++){this.Block[a]=c.ReadByte()}return b};Gif.prototype.readZeroTerminatedBlock=function(c){var a=0;do{a=c.ReadByte()}while(a!=0)};function Jpeg(){PdfImage.call(this);this.Width=this.Height=0;this.ColorSpace=-1}Jpeg.prototype=new PdfImage();for(var i=0;i<Object.keys(PdfImage).length;i++){var obj=Object.keys(PdfImage)[i];Jpeg[obj]=PdfImage[obj]}Jpeg.prototype.Init=function(c,e){var l=new MemoryStream(c);var h=PdfObject.GetNUINT(l,2);if((h>>8)!=216||(h&255)!=255){throw new Error("[Jpeg::Init] Wrong start TAG (T1 = 0x"+(h>>8).toString(16)+", T2 = 0x"+(h&255).toString(16)+")")}var a=false;while(true){h=PdfObject.GetNUINT(l,1);if(h==255){var g=PdfObject.GetNUINT(l,1);var d=0;if((g<208||g>215)&&g!=1){d=PdfObject.GetNUINT(l,2,true)}if(g==224){if(d<16){throw new Error("[Jpeg::Init] Wrong Segment Length (="+d+")")}var f=(l.ReadByte()==74)&&(l.ReadByte()==70)&&(l.ReadByte()==73)&&(l.ReadByte()==70)&&(l.ReadByte()==0);d-=5;if(!f){throw new Error("[Jpeg::Init] Can't find the JFIF+0x00 marker")}}else{if(g==238){var k=PdfObject.GetString(l,5);if(d>12&&k=="Adobe"){a=true}d-=5}else{if(g==192||g==193||g==194){this.BitsPerComponent=PdfObject.GetNUINT(l,1);if(this.BitsPerComponent!=8){throw new Error("[Jpeg::Init] Unexpected BPC ("+this.BitsPerComponent+") for Marker 0x"+g.toString(16))}this.Height=PdfObject.GetSHORT(l,true);this.Width=PdfObject.GetSHORT(l,true);this.ColorSpace=PdfObject.GetNUINT(l,1);d-=6}else{if(g==218||g==217){break}}}}if(d!=0){l.Seek(d-2)}}else{throw new Error("[Jpeg::Init] Wrong block start byte (found 0x"+h.toString(16)+" expected 0xFF)")}}this.DataSize=e;this.Data=c;this.BitsPerComponent=8;var j=new PdfArray();j.Add("/DCTDecode");this.Dict.Add("/Filter",j);if(this.ColorSpace==4&&a){this.Dict.Add("/Decode","[1 0 1 0 1 0 1 0]")}PdfImage.prototype.Init.call(this,c,e)};